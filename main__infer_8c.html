<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Inference Engine (Clocher): engine/src/main_infer.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Inference Engine (Clocher)<span id="projectnumber">&#160;0.2</span>
   </div>
   <div id="projectbrief">C11 CPU/GPU inference baseline with strict metrics &amp; harness</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('main__infer_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">main_infer.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>CLI entry point for the inference engine (benchmark-friendly, strict-run safe).  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;dlfcn.h&gt;</code><br />
<code>#include &lt;errno.h&gt;</code><br />
<code>#include &lt;fcntl.h&gt;</code><br />
<code>#include &lt;inttypes.h&gt;</code><br />
<code>#include &lt;limits.h&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;sys/mman.h&gt;</code><br />
<code>#include &lt;sys/resource.h&gt;</code><br />
<code>#include &lt;sys/stat.h&gt;</code><br />
<code>#include &lt;time.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &quot;<a class="el" href="ie__api_8h_source.html">ie_api.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="ie__io_8h_source.html">ie_io.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="ie__kv__instrumentation_8h_source.html">ie_kv_instrumentation.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="ie__tokenizer__gptoss_8h_source.html">ie_tokenizer_gptoss.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="util__logging_8h_source.html">util_logging.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for main_infer.c:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="main__infer_8c__incl.svg" width="100%" height="437"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
</div>
<p><a href="main__infer_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmodel__mmap__touch.html">model_mmap_touch</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A file-backed mmap context for deterministic "touch" work.  <a href="structmodel__mmap__touch.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcudart__api.html">cudart_api</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Dynamically loaded cudart API table.  <a href="structcudart__api.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcli__extras.html">cli_extras</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parsed CLI options and derived configuration.  <a href="structcli__extras.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structprompt__list.html">prompt_list</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prompt list (preloaded) to avoid file I/O in the timed window.  <a href="structprompt__list.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structexpected__tokens__entry.html">expected_tokens_entry</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">An entry in the expected-tokens table.  <a href="structexpected__tokens__entry.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structexpected__tokens__table.html">expected_tokens_table</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A table of expected tokens, loaded from a text file.  <a href="structexpected__tokens__table.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structreport__token__buf.html">report_token_buf</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A token buffer owned by the report (copy of engine output).  <a href="structreport__token__buf.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structprompt__round__record.html">prompt_round_record</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Per-prompt per-round record, suitable for JSON reporting.  <a href="structprompt__round__record.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a3024ccd4a9af5109d24e6c57565d74a1" id="r_a3024ccd4a9af5109d24e6c57565d74a1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a3024ccd4a9af5109d24e6c57565d74a1">_POSIX_C_SOURCE</a>&#160;&#160;&#160;200809L</td></tr>
<tr class="separator:a3024ccd4a9af5109d24e6c57565d74a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a78c99ffd76a7bb3c8c74db76207e9ab4" id="r_a78c99ffd76a7bb3c8c74db76207e9ab4"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a78c99ffd76a7bb3c8c74db76207e9ab4">_XOPEN_SOURCE</a>&#160;&#160;&#160;700</td></tr>
<tr class="separator:a78c99ffd76a7bb3c8c74db76207e9ab4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae688d728e1acdfe5988c7db45d6f0166" id="r_ae688d728e1acdfe5988c7db45d6f0166"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>&#160;&#160;&#160;4096</td></tr>
<tr class="separator:ae688d728e1acdfe5988c7db45d6f0166"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a86d500a34c624c2cae56bc25a31b12f3" id="r_a86d500a34c624c2cae56bc25a31b12f3"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(x)&#160;&#160;&#160;(void)(x)</td></tr>
<tr class="separator:a86d500a34c624c2cae56bc25a31b12f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="typedef-members" name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a54f0d9b3968af3eb368f8847cd420950" id="r_a54f0d9b3968af3eb368f8847cd420950"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structmodel__mmap__touch.html">model_mmap_touch</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a54f0d9b3968af3eb368f8847cd420950">model_mmap_touch_t</a></td></tr>
<tr class="memdesc:a54f0d9b3968af3eb368f8847cd420950"><td class="mdescLeft">&#160;</td><td class="mdescRight">A file-backed mmap context for deterministic "touch" work.  <br /></td></tr>
<tr class="separator:a54f0d9b3968af3eb368f8847cd420950"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7056b1ed3833957f6045353293d33a10" id="r_a7056b1ed3833957f6045353293d33a10"><td class="memItemLeft" align="right" valign="top">typedef int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a7056b1ed3833957f6045353293d33a10">cudart_err_t</a></td></tr>
<tr class="memdesc:a7056b1ed3833957f6045353293d33a10"><td class="mdescLeft">&#160;</td><td class="mdescRight">CUDA runtime error code type (opaque int for dynamic loading).  <br /></td></tr>
<tr class="separator:a7056b1ed3833957f6045353293d33a10"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0493a5218ac1cfe7720fd33073a26a4" id="r_ac0493a5218ac1cfe7720fd33073a26a4"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="main__infer_8c.html#a7056b1ed3833957f6045353293d33a10">cudart_err_t</a>(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#ac0493a5218ac1cfe7720fd33073a26a4">cudaFree_fn_t</a>) (void *)</td></tr>
<tr class="memdesc:ac0493a5218ac1cfe7720fd33073a26a4"><td class="mdescLeft">&#160;</td><td class="mdescRight">cudart function pointer types used by the strict-touch path.  <br /></td></tr>
<tr class="separator:ac0493a5218ac1cfe7720fd33073a26a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a75d810977debadf83c51df3a9caf508e" id="r_a75d810977debadf83c51df3a9caf508e"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="main__infer_8c.html#a7056b1ed3833957f6045353293d33a10">cudart_err_t</a>(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a75d810977debadf83c51df3a9caf508e">cudaMalloc_fn_t</a>) (void **, size_t)</td></tr>
<tr class="separator:a75d810977debadf83c51df3a9caf508e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a012d3ce1c3e56c941279966779621a25" id="r_a012d3ce1c3e56c941279966779621a25"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="main__infer_8c.html#a7056b1ed3833957f6045353293d33a10">cudart_err_t</a>(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a012d3ce1c3e56c941279966779621a25">cudaMemcpy_fn_t</a>) (void *, const void *, size_t, int)</td></tr>
<tr class="separator:a012d3ce1c3e56c941279966779621a25"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ad4e178cd6cc2f9b58919ba9e4ca7b6" id="r_a2ad4e178cd6cc2f9b58919ba9e4ca7b6"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="main__infer_8c.html#a7056b1ed3833957f6045353293d33a10">cudart_err_t</a>(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a2ad4e178cd6cc2f9b58919ba9e4ca7b6">cudaMemset_fn_t</a>) (void *, int, size_t)</td></tr>
<tr class="separator:a2ad4e178cd6cc2f9b58919ba9e4ca7b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84c3a6f8fc81d43ea3d5343bc866773c" id="r_a84c3a6f8fc81d43ea3d5343bc866773c"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="main__infer_8c.html#a7056b1ed3833957f6045353293d33a10">cudart_err_t</a>(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a84c3a6f8fc81d43ea3d5343bc866773c">cudaDeviceSynchronize_fn_t</a>) (void)</td></tr>
<tr class="separator:a84c3a6f8fc81d43ea3d5343bc866773c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a47a2371d08ac2298f34240909805e945" id="r_a47a2371d08ac2298f34240909805e945"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structcudart__api.html">cudart_api</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a47a2371d08ac2298f34240909805e945">cudart_api_t</a></td></tr>
<tr class="memdesc:a47a2371d08ac2298f34240909805e945"><td class="mdescLeft">&#160;</td><td class="mdescRight">Dynamically loaded cudart API table.  <br /></td></tr>
<tr class="separator:a47a2371d08ac2298f34240909805e945"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9973434ae2443cc726369b714df7b2cb" id="r_a9973434ae2443cc726369b714df7b2cb"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structcli__extras.html">cli_extras</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a9973434ae2443cc726369b714df7b2cb">cli_extras_t</a></td></tr>
<tr class="memdesc:a9973434ae2443cc726369b714df7b2cb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parsed CLI options and derived configuration.  <br /></td></tr>
<tr class="separator:a9973434ae2443cc726369b714df7b2cb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa2c236bcd5a489e1a409ffd5f4c532f7" id="r_aa2c236bcd5a489e1a409ffd5f4c532f7"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structprompt__list.html">prompt_list</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#aa2c236bcd5a489e1a409ffd5f4c532f7">prompt_list_t</a></td></tr>
<tr class="memdesc:aa2c236bcd5a489e1a409ffd5f4c532f7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prompt list (preloaded) to avoid file I/O in the timed window.  <br /></td></tr>
<tr class="separator:aa2c236bcd5a489e1a409ffd5f4c532f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae3d72519a21dd8c22c60d86104a0c151" id="r_ae3d72519a21dd8c22c60d86104a0c151"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structexpected__tokens__entry.html">expected_tokens_entry</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#ae3d72519a21dd8c22c60d86104a0c151">expected_tokens_entry_t</a></td></tr>
<tr class="memdesc:ae3d72519a21dd8c22c60d86104a0c151"><td class="mdescLeft">&#160;</td><td class="mdescRight">An entry in the expected-tokens table.  <br /></td></tr>
<tr class="separator:ae3d72519a21dd8c22c60d86104a0c151"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac519a155900b9eda4cab9d3a9a74dd62" id="r_ac519a155900b9eda4cab9d3a9a74dd62"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structexpected__tokens__table.html">expected_tokens_table</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#ac519a155900b9eda4cab9d3a9a74dd62">expected_tokens_table_t</a></td></tr>
<tr class="memdesc:ac519a155900b9eda4cab9d3a9a74dd62"><td class="mdescLeft">&#160;</td><td class="mdescRight">A table of expected tokens, loaded from a text file.  <br /></td></tr>
<tr class="separator:ac519a155900b9eda4cab9d3a9a74dd62"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeaf1944cb54f4e8f7a914be88b362163" id="r_aeaf1944cb54f4e8f7a914be88b362163"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structreport__token__buf.html">report_token_buf</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#aeaf1944cb54f4e8f7a914be88b362163">report_token_buf_t</a></td></tr>
<tr class="memdesc:aeaf1944cb54f4e8f7a914be88b362163"><td class="mdescLeft">&#160;</td><td class="mdescRight">A token buffer owned by the report (copy of engine output).  <br /></td></tr>
<tr class="separator:aeaf1944cb54f4e8f7a914be88b362163"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af8802263c4d59c173623fe774ce0abb0" id="r_af8802263c4d59c173623fe774ce0abb0"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structprompt__round__record.html">prompt_round_record</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#af8802263c4d59c173623fe774ce0abb0">prompt_round_record_t</a></td></tr>
<tr class="memdesc:af8802263c4d59c173623fe774ce0abb0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Per-prompt per-round record, suitable for JSON reporting.  <br /></td></tr>
<tr class="separator:af8802263c4d59c173623fe774ce0abb0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="enum-members" name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:adf764cbdea00d65edcd07bb9953ad2b7" id="r_adf764cbdea00d65edcd07bb9953ad2b7"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom">{ <a class="el" href="main__infer_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a27d0e750ab6de4620beed5f2c3662c77">CUDA_MEMCPY_HOST_TO_DEVICE</a> = 1
, <a class="el" href="main__infer_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a866c5293b3ba22bb820c78bfae10f9ed">CUDA_MEMCPY_DEVICE_TO_HOST</a> = 2
, <a class="el" href="main__infer_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a72dd74565a54b7fc09708f72ccf8fd5d">CUDA_MEMCPY_DEVICE_TO_DEVICE</a> = 3
 }</td></tr>
<tr class="memdesc:adf764cbdea00d65edcd07bb9953ad2b7"><td class="mdescLeft">&#160;</td><td class="mdescRight">cudaMemcpyKind values used by the strict-touch path.  <a href="main__infer_8c.html#adf764cbdea00d65edcd07bb9953ad2b7">More...</a><br /></td></tr>
<tr class="separator:adf764cbdea00d65edcd07bb9953ad2b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae715f0cc745f58eebd4be50b187dd41d" id="r_ae715f0cc745f58eebd4be50b187dd41d"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#ae715f0cc745f58eebd4be50b187dd41d">cli_pretranspose_t</a> { <a class="el" href="main__infer_8c.html#ae715f0cc745f58eebd4be50b187dd41da382ceb68dddaaf8b27ac21f144305e74">CLI_PRETX_NONE</a> = 0
, <a class="el" href="main__infer_8c.html#ae715f0cc745f58eebd4be50b187dd41da9d22d4f265254a65af9fc3a7d648fe5d">CLI_PRETX_WOH</a> = 1
, <a class="el" href="main__infer_8c.html#ae715f0cc745f58eebd4be50b187dd41da1a251ee24fdcadcaf9c888e0a96140e7">CLI_PRETX_WXH</a> = 2
, <a class="el" href="main__infer_8c.html#ae715f0cc745f58eebd4be50b187dd41da4fad867319e4f9197a9c373762a3ad54">CLI_PRETX_ALL</a> = 3
 }</td></tr>
<tr class="memdesc:ae715f0cc745f58eebd4be50b187dd41d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pretranspose modes for optional weight transforms.  <a href="main__infer_8c.html#ae715f0cc745f58eebd4be50b187dd41d">More...</a><br /></td></tr>
<tr class="separator:ae715f0cc745f58eebd4be50b187dd41d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a42d8c2f3c8817b30177d0a7e39742b03" id="r_a42d8c2f3c8817b30177d0a7e39742b03"><td class="memItemLeft" align="right" valign="top">static size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a42d8c2f3c8817b30177d0a7e39742b03">min_size</a> (size_t a, size_t b)</td></tr>
<tr class="memdesc:a42d8c2f3c8817b30177d0a7e39742b03"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the smaller of two size_t values.  <br /></td></tr>
<tr class="separator:a42d8c2f3c8817b30177d0a7e39742b03"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9675b1f5b8b73e24233f92cb11e31f6a" id="r_a9675b1f5b8b73e24233f92cb11e31f6a"><td class="memItemLeft" align="right" valign="top">static long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a9675b1f5b8b73e24233f92cb11e31f6a">env_long</a> (const char *name, long defv)</td></tr>
<tr class="memdesc:a9675b1f5b8b73e24233f92cb11e31f6a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read a long integer from an environment variable with a default.  <br /></td></tr>
<tr class="separator:a9675b1f5b8b73e24233f92cb11e31f6a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1da65df4642943745d356d6de2983f02" id="r_a1da65df4642943745d356d6de2983f02"><td class="memItemLeft" align="right" valign="top">static const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a1da65df4642943745d356d6de2983f02">env_str</a> (const char *name, const char *defv)</td></tr>
<tr class="memdesc:a1da65df4642943745d356d6de2983f02"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read a string from an environment variable with a default.  <br /></td></tr>
<tr class="separator:a1da65df4642943745d356d6de2983f02"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a72ab94aafe7740f1343d317daa89ca15" id="r_a72ab94aafe7740f1343d317daa89ca15"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a72ab94aafe7740f1343d317daa89ca15">ascii_ieq</a> (const char *a, const char *b)</td></tr>
<tr class="memdesc:a72ab94aafe7740f1343d317daa89ca15"><td class="mdescLeft">&#160;</td><td class="mdescRight">Case-insensitive ASCII equality.  <br /></td></tr>
<tr class="separator:a72ab94aafe7740f1343d317daa89ca15"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a55469391e7680b876a48cdc0d3d24632" id="r_a55469391e7680b876a48cdc0d3d24632"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a55469391e7680b876a48cdc0d3d24632">starts_with</a> (const char *s, const char *prefix)</td></tr>
<tr class="memdesc:a55469391e7680b876a48cdc0d3d24632"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check whether a string begins with a given prefix (case-sensitive).  <br /></td></tr>
<tr class="separator:a55469391e7680b876a48cdc0d3d24632"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fdbfffdaa0f22a01822f6a62bb7e95e" id="r_a4fdbfffdaa0f22a01822f6a62bb7e95e"><td class="memItemLeft" align="right" valign="top">static double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a4fdbfffdaa0f22a01822f6a62bb7e95e">now_sec</a> (void)</td></tr>
<tr class="memdesc:a4fdbfffdaa0f22a01822f6a62bb7e95e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return monotonic time in seconds.  <br /></td></tr>
<tr class="separator:a4fdbfffdaa0f22a01822f6a62bb7e95e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0cbea455e9868581360f43c63db6554c" id="r_a0cbea455e9868581360f43c63db6554c"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a0cbea455e9868581360f43c63db6554c">path_exists</a> (const char *p)</td></tr>
<tr class="memdesc:a0cbea455e9868581360f43c63db6554c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Determine whether a filesystem path exists (stat succeeds).  <br /></td></tr>
<tr class="separator:a0cbea455e9868581360f43c63db6554c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2392f4f2060045de53b484a90f85f15f" id="r_a2392f4f2060045de53b484a90f85f15f"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a2392f4f2060045de53b484a90f85f15f">dir_accessible</a> (const char *p)</td></tr>
<tr class="memdesc:a2392f4f2060045de53b484a90f85f15f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Determine whether a directory exists and is accessible (R_OK|X_OK).  <br /></td></tr>
<tr class="separator:a2392f4f2060045de53b484a90f85f15f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a35a9aadd511e6b3688d01a67a12c7651" id="r_a35a9aadd511e6b3688d01a67a12c7651"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a35a9aadd511e6b3688d01a67a12c7651">path_is_abs</a> (const char *p)</td></tr>
<tr class="memdesc:a35a9aadd511e6b3688d01a67a12c7651"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if a path is absolute (POSIX).  <br /></td></tr>
<tr class="separator:a35a9aadd511e6b3688d01a67a12c7651"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a210133797f21fcee710ec892841dce42" id="r_a210133797f21fcee710ec892841dce42"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a210133797f21fcee710ec892841dce42">safe_strcpy</a> (char *dst, size_t dstsz, const char *src)</td></tr>
<tr class="memdesc:a210133797f21fcee710ec892841dce42"><td class="mdescLeft">&#160;</td><td class="mdescRight">Safe string copy using snprintf.  <br /></td></tr>
<tr class="separator:a210133797f21fcee710ec892841dce42"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adca9b33a342b8635e28ba51aecb365f6" id="r_adca9b33a342b8635e28ba51aecb365f6"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#adca9b33a342b8635e28ba51aecb365f6">join_path</a> (char *out, size_t outsz, const char *dir, const char *leaf)</td></tr>
<tr class="memdesc:adca9b33a342b8635e28ba51aecb365f6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Join directory and filename into a single path.  <br /></td></tr>
<tr class="separator:adca9b33a342b8635e28ba51aecb365f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a680d5eb9763f52ea89ce1764e01121dc" id="r_a680d5eb9763f52ea89ce1764e01121dc"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a680d5eb9763f52ea89ce1764e01121dc">canon_dir</a> (char *out, size_t outsz, const char *dir)</td></tr>
<tr class="memdesc:a680d5eb9763f52ea89ce1764e01121dc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Canonicalize a directory path with realpath when possible.  <br /></td></tr>
<tr class="separator:a680d5eb9763f52ea89ce1764e01121dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a937426768611822fbe840722069c7043" id="r_a937426768611822fbe840722069c7043"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a937426768611822fbe840722069c7043">is_int4_precision</a> (const char *p)</td></tr>
<tr class="memdesc:a937426768611822fbe840722069c7043"><td class="mdescLeft">&#160;</td><td class="mdescRight">Determine if precision string requests int4 family.  <br /></td></tr>
<tr class="separator:a937426768611822fbe840722069c7043"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad6b894571e18a35f21d8451e008fae37" id="r_ad6b894571e18a35f21d8451e008fae37"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#ad6b894571e18a35f21d8451e008fae37">resolve_model_paths</a> (const char *model_dir, const char *model_json_opt, const char *model_bin_opt, const char *precision, char *out_json, size_t out_json_sz, char *out_bin, size_t out_bin_sz)</td></tr>
<tr class="memdesc:ad6b894571e18a35f21d8451e008fae37"><td class="mdescLeft">&#160;</td><td class="mdescRight">Resolve model JSON/BIN paths based on model_dir and precision defaults.  <br /></td></tr>
<tr class="separator:ad6b894571e18a35f21d8451e008fae37"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d90177eef91d08c3d9a38fb00df3e62" id="r_a0d90177eef91d08c3d9a38fb00df3e62"><td class="memItemLeft" align="right" valign="top">static uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a0d90177eef91d08c3d9a38fb00df3e62">rss_peak_mib</a> (void)</td></tr>
<tr class="memdesc:a0d90177eef91d08c3d9a38fb00df3e62"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read ru_maxrss and convert to MiB (Linux: ru_maxrss is KiB).  <br /></td></tr>
<tr class="separator:a0d90177eef91d08c3d9a38fb00df3e62"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39103ce72021a890c3e333b949068a1c" id="r_a39103ce72021a890c3e333b949068a1c"><td class="memItemLeft" align="right" valign="top">static char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a39103ce72021a890c3e333b949068a1c">heap_strdup</a> (const char *s)</td></tr>
<tr class="memdesc:a39103ce72021a890c3e333b949068a1c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Heap-duplicate a string (portable replacement for strdup).  <br /></td></tr>
<tr class="separator:a39103ce72021a890c3e333b949068a1c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a82ba5822565056bddf97d8b9d425d9b9" id="r_a82ba5822565056bddf97d8b9d425d9b9"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a82ba5822565056bddf97d8b9d425d9b9">ends_with</a> (const char *s, const char *suf)</td></tr>
<tr class="memdesc:a82ba5822565056bddf97d8b9d425d9b9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if a string ends with a given suffix (case-sensitive).  <br /></td></tr>
<tr class="separator:a82ba5822565056bddf97d8b9d425d9b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac67780918b483167f77ec879306c781c" id="r_ac67780918b483167f77ec879306c781c"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#ac67780918b483167f77ec879306c781c">model_touch_open</a> (<a class="el" href="main__infer_8c.html#a54f0d9b3968af3eb368f8847cd420950">model_mmap_touch_t</a> *ctx, const char *path)</td></tr>
<tr class="memdesc:ac67780918b483167f77ec879306c781c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize a file-backed read-only mmap for the given path.  <br /></td></tr>
<tr class="separator:ac67780918b483167f77ec879306c781c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6d67a99243e339c4acabd9ed9b84002c" id="r_a6d67a99243e339c4acabd9ed9b84002c"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a6d67a99243e339c4acabd9ed9b84002c">model_touch_close</a> (<a class="el" href="main__infer_8c.html#a54f0d9b3968af3eb368f8847cd420950">model_mmap_touch_t</a> *ctx)</td></tr>
<tr class="memdesc:a6d67a99243e339c4acabd9ed9b84002c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Close and unmap a model touch context.  <br /></td></tr>
<tr class="separator:a6d67a99243e339c4acabd9ed9b84002c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af5ac8d51b8d24639015faa2a2e699ba2" id="r_af5ac8d51b8d24639015faa2a2e699ba2"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#af5ac8d51b8d24639015faa2a2e699ba2">model_touch_bytes</a> (<a class="el" href="main__infer_8c.html#a54f0d9b3968af3eb368f8847cd420950">model_mmap_touch_t</a> *ctx, size_t bytes_to_touch, size_t stride_bytes, int verify_touch)</td></tr>
<tr class="memdesc:af5ac8d51b8d24639015faa2a2e699ba2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Deterministically read bytes from the mapped model to force page faults.  <br /></td></tr>
<tr class="separator:af5ac8d51b8d24639015faa2a2e699ba2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca4f099fbc130845b4af6c57ca21b3ef" id="r_aca4f099fbc130845b4af6c57ca21b3ef"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="main__infer_8c.html#a47a2371d08ac2298f34240909805e945">cudart_api_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#aca4f099fbc130845b4af6c57ca21b3ef">cudart_get_api</a> (void)</td></tr>
<tr class="memdesc:aca4f099fbc130845b4af6c57ca21b3ef"><td class="mdescLeft">&#160;</td><td class="mdescRight">Load cudart symbols via dlopen/dlsym (lazy singleton).  <br /></td></tr>
<tr class="separator:aca4f099fbc130845b4af6c57ca21b3ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44a0de9d17f6eff8a4764537268ab5d1" id="r_a44a0de9d17f6eff8a4764537268ab5d1"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a44a0de9d17f6eff8a4764537268ab5d1">cudart_touch_bytes</a> (size_t bytes_per_token, uint64_t tokens, size_t stride_bytes, int verify_touch)</td></tr>
<tr class="memdesc:a44a0de9d17f6eff8a4764537268ab5d1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Strict CUDA touch: cudaMalloc + repeated cudaMemset + optional D2H copy.  <br /></td></tr>
<tr class="separator:a44a0de9d17f6eff8a4764537268ab5d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7427a4a1579fb747a4ce22a4a1d4a80a" id="r_a7427a4a1579fb747a4ce22a4a1d4a80a"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a7427a4a1579fb747a4ce22a4a1d4a80a">json_print_escaped_string</a> (const char *s)</td></tr>
<tr class="memdesc:a7427a4a1579fb747a4ce22a4a1d4a80a"><td class="mdescLeft">&#160;</td><td class="mdescRight">JSON-escape and print a string value.  <br /></td></tr>
<tr class="separator:a7427a4a1579fb747a4ce22a4a1d4a80a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0271a21f39c53534b7a1a3cc7eb94596" id="r_a0271a21f39c53534b7a1a3cc7eb94596"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a0271a21f39c53534b7a1a3cc7eb94596">resolve_tokenizer_path</a> (const char *model_dir, const char *tokenizer_opt, char *out, size_t outsz)</td></tr>
<tr class="memdesc:a0271a21f39c53534b7a1a3cc7eb94596"><td class="mdescLeft">&#160;</td><td class="mdescRight">Resolve a tokenizer path under a model directory.  <br /></td></tr>
<tr class="separator:a0271a21f39c53534b7a1a3cc7eb94596"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4e30eb4737647a78c4dbebb5b008a5bd" id="r_a4e30eb4737647a78c4dbebb5b008a5bd"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a4e30eb4737647a78c4dbebb5b008a5bd">decode_tokens_best_effort</a> (const char *tok_path, const int *ids, size_t n, char **out_text)</td></tr>
<tr class="memdesc:a4e30eb4737647a78c4dbebb5b008a5bd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Decode token IDs into UTF-8 text (best-effort).  <br /></td></tr>
<tr class="separator:a4e30eb4737647a78c4dbebb5b008a5bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad96d407a911fbb914fa8e4cfbf2faf0f" id="r_ad96d407a911fbb914fa8e4cfbf2faf0f"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a> (void)</td></tr>
<tr class="memdesc:ad96d407a911fbb914fa8e4cfbf2faf0f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Print CLI usage to stderr.  <br /></td></tr>
<tr class="separator:ad96d407a911fbb914fa8e4cfbf2faf0f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a25c42477bc56f4eb2d2a5c53e4510d70" id="r_a25c42477bc56f4eb2d2a5c53e4510d70"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a25c42477bc56f4eb2d2a5c53e4510d70">cli_extras_defaults</a> (<a class="el" href="main__infer_8c.html#a9973434ae2443cc726369b714df7b2cb">cli_extras_t</a> *e)</td></tr>
<tr class="memdesc:a25c42477bc56f4eb2d2a5c53e4510d70"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize CLI defaults.  <br /></td></tr>
<tr class="separator:a25c42477bc56f4eb2d2a5c53e4510d70"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a42cabe54dce1190125a12e4c0360ce22" id="r_a42cabe54dce1190125a12e4c0360ce22"><td class="memItemLeft" align="right" valign="top">static long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a42cabe54dce1190125a12e4c0360ce22">safe_atoi</a> (const char *s)</td></tr>
<tr class="memdesc:a42cabe54dce1190125a12e4c0360ce22"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parse a decimal integer safely (fatal on invalid input).  <br /></td></tr>
<tr class="separator:a42cabe54dce1190125a12e4c0360ce22"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a50f7fd00c4c5f36d1ee065443d688251" id="r_a50f7fd00c4c5f36d1ee065443d688251"><td class="memItemLeft" align="right" valign="top">static uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a50f7fd00c4c5f36d1ee065443d688251">safe_atoull</a> (const char *s)</td></tr>
<tr class="memdesc:a50f7fd00c4c5f36d1ee065443d688251"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parse an unsigned 64-bit integer safely (fatal on invalid input).  <br /></td></tr>
<tr class="separator:a50f7fd00c4c5f36d1ee065443d688251"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a040e339c57d801547a44a21545914526" id="r_a040e339c57d801547a44a21545914526"><td class="memItemLeft" align="right" valign="top">static double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a040e339c57d801547a44a21545914526">safe_atof</a> (const char *s)</td></tr>
<tr class="memdesc:a040e339c57d801547a44a21545914526"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parse a double safely (fatal on invalid input).  <br /></td></tr>
<tr class="separator:a040e339c57d801547a44a21545914526"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac50de02cf90e21f66e0681932f39334f" id="r_ac50de02cf90e21f66e0681932f39334f"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#ac50de02cf90e21f66e0681932f39334f">apply_cli_debug_env</a> (const <a class="el" href="main__infer_8c.html#a9973434ae2443cc726369b714df7b2cb">cli_extras_t</a> *opt)</td></tr>
<tr class="memdesc:ac50de02cf90e21f66e0681932f39334f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Apply CLI deterministic/debug knobs by setting environment variables.  <br /></td></tr>
<tr class="separator:ac50de02cf90e21f66e0681932f39334f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a456ba954f3884bcf5f72fc3e779de284" id="r_a456ba954f3884bcf5f72fc3e779de284"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a456ba954f3884bcf5f72fc3e779de284">parse_flags</a> (int argc, char **argv, <a class="el" href="main__infer_8c.html#a9973434ae2443cc726369b714df7b2cb">cli_extras_t</a> *out)</td></tr>
<tr class="memdesc:a456ba954f3884bcf5f72fc3e779de284"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parse CLI flags into cli_extras_t.  <br /></td></tr>
<tr class="separator:a456ba954f3884bcf5f72fc3e779de284"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a609fc6d778b714530dadf2ef012acf5c" id="r_a609fc6d778b714530dadf2ef012acf5c"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a609fc6d778b714530dadf2ef012acf5c">read_first_nonempty_line</a> (const char *path, char *buf, size_t bufsz)</td></tr>
<tr class="memdesc:a609fc6d778b714530dadf2ef012acf5c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read the first non-empty line from a text file.  <br /></td></tr>
<tr class="separator:a609fc6d778b714530dadf2ef012acf5c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9891db61dca3c60715c6b2f7aad7f5a1" id="r_a9891db61dca3c60715c6b2f7aad7f5a1"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a9891db61dca3c60715c6b2f7aad7f5a1">prompt_list_init</a> (<a class="el" href="main__infer_8c.html#aa2c236bcd5a489e1a409ffd5f4c532f7">prompt_list_t</a> *pl)</td></tr>
<tr class="memdesc:a9891db61dca3c60715c6b2f7aad7f5a1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize an empty prompt list.  <br /></td></tr>
<tr class="separator:a9891db61dca3c60715c6b2f7aad7f5a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab06a46b9f23d08de776ec7d3258b6588" id="r_ab06a46b9f23d08de776ec7d3258b6588"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#ab06a46b9f23d08de776ec7d3258b6588">prompt_list_free</a> (<a class="el" href="main__infer_8c.html#aa2c236bcd5a489e1a409ffd5f4c532f7">prompt_list_t</a> *pl)</td></tr>
<tr class="memdesc:ab06a46b9f23d08de776ec7d3258b6588"><td class="mdescLeft">&#160;</td><td class="mdescRight">Free a prompt list and all owned strings.  <br /></td></tr>
<tr class="separator:ab06a46b9f23d08de776ec7d3258b6588"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9be857b0051297813c2cb218accbb5c8" id="r_a9be857b0051297813c2cb218accbb5c8"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a9be857b0051297813c2cb218accbb5c8">prompt_list_push_copy</a> (<a class="el" href="main__infer_8c.html#aa2c236bcd5a489e1a409ffd5f4c532f7">prompt_list_t</a> *pl, const char *s)</td></tr>
<tr class="memdesc:a9be857b0051297813c2cb218accbb5c8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Push a prompt string copy into the list.  <br /></td></tr>
<tr class="separator:a9be857b0051297813c2cb218accbb5c8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3d826199fc8a9ddb8a49f324c2ff1dc5" id="r_a3d826199fc8a9ddb8a49f324c2ff1dc5"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a3d826199fc8a9ddb8a49f324c2ff1dc5">prompt_list_read_file</a> (const char *path, <a class="el" href="main__infer_8c.html#aa2c236bcd5a489e1a409ffd5f4c532f7">prompt_list_t</a> *out)</td></tr>
<tr class="memdesc:a3d826199fc8a9ddb8a49f324c2ff1dc5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read all non-empty lines from a prompts file into memory.  <br /></td></tr>
<tr class="separator:a3d826199fc8a9ddb8a49f324c2ff1dc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad7f42b712b3e86af5d9f8c9942bc8875" id="r_ad7f42b712b3e86af5d9f8c9942bc8875"><td class="memItemLeft" align="right" valign="top">static uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#ad7f42b712b3e86af5d9f8c9942bc8875">prompt_id_fnv1a64</a> (const char *s)</td></tr>
<tr class="memdesc:ad7f42b712b3e86af5d9f8c9942bc8875"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compute a stable 64-bit prompt ID (FNV-1a over bytes).  <br /></td></tr>
<tr class="separator:ad7f42b712b3e86af5d9f8c9942bc8875"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2749355bb9d419963e15e9a58395f63e" id="r_a2749355bb9d419963e15e9a58395f63e"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a2749355bb9d419963e15e9a58395f63e">parse_u64_auto</a> (const char *s, uint64_t *out)</td></tr>
<tr class="memdesc:a2749355bb9d419963e15e9a58395f63e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parse an unsigned 64-bit integer in decimal or 0x-prefixed hex.  <br /></td></tr>
<tr class="separator:a2749355bb9d419963e15e9a58395f63e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7170af3ba79ee074b29ac13736ec97bf" id="r_a7170af3ba79ee074b29ac13736ec97bf"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a7170af3ba79ee074b29ac13736ec97bf">expected_tokens_table_init</a> (<a class="el" href="main__infer_8c.html#ac519a155900b9eda4cab9d3a9a74dd62">expected_tokens_table_t</a> *t)</td></tr>
<tr class="memdesc:a7170af3ba79ee074b29ac13736ec97bf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize an expected-tokens table.  <br /></td></tr>
<tr class="separator:a7170af3ba79ee074b29ac13736ec97bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a470ca5b37dd720b5de391932c452af36" id="r_a470ca5b37dd720b5de391932c452af36"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a470ca5b37dd720b5de391932c452af36">expected_tokens_table_free</a> (<a class="el" href="main__infer_8c.html#ac519a155900b9eda4cab9d3a9a74dd62">expected_tokens_table_t</a> *t)</td></tr>
<tr class="memdesc:a470ca5b37dd720b5de391932c452af36"><td class="mdescLeft">&#160;</td><td class="mdescRight">Free an expected-tokens table.  <br /></td></tr>
<tr class="separator:a470ca5b37dd720b5de391932c452af36"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adc35a14cb1b2caeca261416dfa41edee" id="r_adc35a14cb1b2caeca261416dfa41edee"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#adc35a14cb1b2caeca261416dfa41edee">expected_tokens_table_push</a> (<a class="el" href="main__infer_8c.html#ac519a155900b9eda4cab9d3a9a74dd62">expected_tokens_table_t</a> *t, uint64_t prompt_id, int *tokens, size_t n_tokens)</td></tr>
<tr class="memdesc:adc35a14cb1b2caeca261416dfa41edee"><td class="mdescLeft">&#160;</td><td class="mdescRight">Append an entry to the expected-tokens table.  <br /></td></tr>
<tr class="separator:adc35a14cb1b2caeca261416dfa41edee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a307125ca4048deb177277c8e72bbfe" id="r_a3a307125ca4048deb177277c8e72bbfe"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a3a307125ca4048deb177277c8e72bbfe">expected_tokens_compare</a> (const int *expected, size_t n_expected, const int *actual, size_t n_actual, size_t *mismatch_index, int *expected_at, int *actual_at)</td></tr>
<tr class="memdesc:a3a307125ca4048deb177277c8e72bbfe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compare actual tokens against expected tokens for one prompt.  <br /></td></tr>
<tr class="separator:a3a307125ca4048deb177277c8e72bbfe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adaa53124eb0654f14346cf02af06b891" id="r_adaa53124eb0654f14346cf02af06b891"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#adaa53124eb0654f14346cf02af06b891">parse_token_list_inplace</a> (char *s, int **out_tokens, size_t *out_n)</td></tr>
<tr class="memdesc:adaa53124eb0654f14346cf02af06b891"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parse a comma-separated list of integers.  <br /></td></tr>
<tr class="separator:adaa53124eb0654f14346cf02af06b891"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84acee847ca644179eff86e6406bf230" id="r_a84acee847ca644179eff86e6406bf230"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a84acee847ca644179eff86e6406bf230">expected_tokens_table_load</a> (const char *path, <a class="el" href="main__infer_8c.html#ac519a155900b9eda4cab9d3a9a74dd62">expected_tokens_table_t</a> *out)</td></tr>
<tr class="memdesc:a84acee847ca644179eff86e6406bf230"><td class="mdescLeft">&#160;</td><td class="mdescRight">Load expected tokens from a text file.  <br /></td></tr>
<tr class="separator:a84acee847ca644179eff86e6406bf230"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0b4d248d44b83ac2a6b5f47b47fe15df" id="r_a0b4d248d44b83ac2a6b5f47b47fe15df"><td class="memItemLeft" align="right" valign="top">static const <a class="el" href="main__infer_8c.html#ae3d72519a21dd8c22c60d86104a0c151">expected_tokens_entry_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a0b4d248d44b83ac2a6b5f47b47fe15df">expected_tokens_find</a> (const <a class="el" href="main__infer_8c.html#ac519a155900b9eda4cab9d3a9a74dd62">expected_tokens_table_t</a> *t, uint64_t prompt_id)</td></tr>
<tr class="memdesc:a0b4d248d44b83ac2a6b5f47b47fe15df"><td class="mdescLeft">&#160;</td><td class="mdescRight">Find an expected entry by prompt ID.  <br /></td></tr>
<tr class="separator:a0b4d248d44b83ac2a6b5f47b47fe15df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af91bda098d580c2cf56b5beda68bd2d5" id="r_af91bda098d580c2cf56b5beda68bd2d5"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#af91bda098d580c2cf56b5beda68bd2d5">report_token_buf_free</a> (<a class="el" href="main__infer_8c.html#aeaf1944cb54f4e8f7a914be88b362163">report_token_buf_t</a> *b)</td></tr>
<tr class="memdesc:af91bda098d580c2cf56b5beda68bd2d5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Free a report token buffer.  <br /></td></tr>
<tr class="separator:af91bda098d580c2cf56b5beda68bd2d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a23f6c5852d73ecbdb1dead2be803bcf0" id="r_a23f6c5852d73ecbdb1dead2be803bcf0"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a23f6c5852d73ecbdb1dead2be803bcf0">report_token_buf_copy</a> (const int *ids, size_t n, size_t max_keep, <a class="el" href="main__infer_8c.html#aeaf1944cb54f4e8f7a914be88b362163">report_token_buf_t</a> *out)</td></tr>
<tr class="memdesc:a23f6c5852d73ecbdb1dead2be803bcf0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Copy tokens into a report token buffer (truncating if requested).  <br /></td></tr>
<tr class="separator:a23f6c5852d73ecbdb1dead2be803bcf0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa8860ddc49714b553fe669c784885cff" id="r_aa8860ddc49714b553fe669c784885cff"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#aa8860ddc49714b553fe669c784885cff">prompt_round_record_free</a> (<a class="el" href="main__infer_8c.html#af8802263c4d59c173623fe774ce0abb0">prompt_round_record_t</a> *r)</td></tr>
<tr class="memdesc:aa8860ddc49714b553fe669c784885cff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Free a prompt-round record.  <br /></td></tr>
<tr class="separator:aa8860ddc49714b553fe669c784885cff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9205188606b8d4265d29fa8911259cac" id="r_a9205188606b8d4265d29fa8911259cac"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a9205188606b8d4265d29fa8911259cac">json_print_int_array</a> (const int *ids, size_t n)</td></tr>
<tr class="memdesc:a9205188606b8d4265d29fa8911259cac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Print a JSON array of integers.  <br /></td></tr>
<tr class="separator:a9205188606b8d4265d29fa8911259cac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84b40472513bc66398c6d3049891f553" id="r_a84b40472513bc66398c6d3049891f553"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a84b40472513bc66398c6d3049891f553">print_json_result</a> (size_t n_tok, const int *tokens, double wall_s_in, double prefill_s_in, double decode_s_in, uint64_t kv_hits, uint64_t kv_misses, uint32_t rss_peak_mb, const char *text_decoded, const char *tokenizer_path_used, const char *expected_file, const <a class="el" href="main__infer_8c.html#aa2c236bcd5a489e1a409ffd5f4c532f7">prompt_list_t</a> *prompts, int rounds, const <a class="el" href="main__infer_8c.html#af8802263c4d59c173623fe774ce0abb0">prompt_round_record_t</a> *recs)</td></tr>
<tr class="memdesc:a84b40472513bc66398c6d3049891f553"><td class="mdescLeft">&#160;</td><td class="mdescRight">Print the single JSON result object to stdout.  <br /></td></tr>
<tr class="separator:a84b40472513bc66398c6d3049891f553"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43b384fdf1f1e4cc7304e6164461af44" id="r_a43b384fdf1f1e4cc7304e6164461af44"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a43b384fdf1f1e4cc7304e6164461af44">device_is_cuda</a> (const char *dev)</td></tr>
<tr class="memdesc:a43b384fdf1f1e4cc7304e6164461af44"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check whether device string selects CUDA.  <br /></td></tr>
<tr class="separator:a43b384fdf1f1e4cc7304e6164461af44"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae26c03bc6150b42f62a01df020935733" id="r_ae26c03bc6150b42f62a01df020935733"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#ae26c03bc6150b42f62a01df020935733">device_is_cpu</a> (const char *dev)</td></tr>
<tr class="memdesc:ae26c03bc6150b42f62a01df020935733"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check whether device string selects CPU.  <br /></td></tr>
<tr class="separator:ae26c03bc6150b42f62a01df020935733"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c04138a5bfe5d72780bb7e82a18e627" id="r_a3c04138a5bfe5d72780bb7e82a18e627"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="main__infer_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (int argc, char **argv)</td></tr>
<tr class="memdesc:a3c04138a5bfe5d72780bb7e82a18e627"><td class="mdescLeft">&#160;</td><td class="mdescRight">main.  <br /></td></tr>
<tr class="separator:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>CLI entry point for the inference engine (benchmark-friendly, strict-run safe). </p>
<p>This file implements the standalone CLI binary used by the benchmark harness. It prints exactly one JSON object to stdout (even on errors) so that scripts can reliably parse results.</p>
<p>Timing policy (low-overhead, benchmark-correct):</p><ul>
<li>All setup is performed outside the timed window:<ul>
<li>CLI parsing, path resolution, model open, engine create, warmup, tokenizer resolution, prompt file I/O (prompt list is preloaded), strict-touch preflight (mmap open / cudart dlopen).</li>
</ul>
</li>
<li>The timed window measures only the steady-state "work loop":<ul>
<li>ie_engine_generate calls (and, when enabled, strict-touch work that must be attributed to the run by design).</li>
</ul>
</li>
</ul>
<p>Strict-run goals (CPU/CUDA):</p><ul>
<li>When IE_REQUIRE_MODEL=1, model files must open successfully.</li>
<li>When IE_VERIFY_TOUCH=1 and IE_BYTES_PER_TOKEN&gt;0, the timed window includes deterministic, measurable work that cannot be optimized away.</li>
<li>For CPU, the strict "touch" work is file-backed: it reads from the model weights mmap (not anonymous memory), so RSS/majflt reflect real paging.</li>
<li>For CUDA, the strict work uses cudart (if present) to force driver activity inside the timed window without relying on custom kernels.</li>
</ul>
<p>Text output:</p><ul>
<li>By default, the CLI prints tokens in JSON for benchmark tooling.</li>
<li>If &ndash;print-text is provided (or IE_PRINT_TEXT=1), the CLI will also decode the generated token IDs into UTF-8 using the project tokenizer.</li>
<li>Tokenizer resolution prefers .tiktoken files (when present) and falls back to tokenizer.json paths.</li>
</ul>
<p>Prompts file behavior (Goal A):</p><ul>
<li>If &ndash;prompts-file is provided and &ndash;prompt is NOT provided, the CLI runs all non-empty lines from the prompts file (newline-delimited) in order.</li>
<li>This mode is internally treated as "aggregate" mode and still prints exactly one JSON object (aggregated over all prompts and rounds).</li>
<li>Empty/whitespace-only lines are ignored.</li>
</ul>
<p>Notes:</p><ul>
<li>This CLI validates model_dir accessibility, resolves default model paths, and supports prompts-file batching for harnesses.</li>
<li>Token output types follow <a class="el" href="ie__api_8h.html" title="Public C API for creating an inference engine instance and generating tokens.">ie_api.h</a>: out_tokens is int[], out_n_tokens is size_t. </li>
</ul>

<p class="definition">Definition in file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a3024ccd4a9af5109d24e6c57565d74a1" name="a3024ccd4a9af5109d24e6c57565d74a1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3024ccd4a9af5109d24e6c57565d74a1">&#9670;&#160;</a></span>_POSIX_C_SOURCE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _POSIX_C_SOURCE&#160;&#160;&#160;200809L</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00052">52</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>

</div>
</div>
<a id="a78c99ffd76a7bb3c8c74db76207e9ab4" name="a78c99ffd76a7bb3c8c74db76207e9ab4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a78c99ffd76a7bb3c8c74db76207e9ab4">&#9670;&#160;</a></span>_XOPEN_SOURCE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _XOPEN_SOURCE&#160;&#160;&#160;700</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00056">56</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>

</div>
</div>
<a id="ae688d728e1acdfe5988c7db45d6f0166" name="ae688d728e1acdfe5988c7db45d6f0166"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae688d728e1acdfe5988c7db45d6f0166">&#9670;&#160;</a></span>PATH_MAX</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PATH_MAX&#160;&#160;&#160;4096</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00081">81</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>

</div>
</div>
<a id="a86d500a34c624c2cae56bc25a31b12f3" name="a86d500a34c624c2cae56bc25a31b12f3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a86d500a34c624c2cae56bc25a31b12f3">&#9670;&#160;</a></span>UNUSED</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define UNUSED</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">x</td><td>)</td>
          <td>&#160;&#160;&#160;(void)(x)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00085">85</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="a9973434ae2443cc726369b714df7b2cb" name="a9973434ae2443cc726369b714df7b2cb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9973434ae2443cc726369b714df7b2cb">&#9670;&#160;</a></span>cli_extras_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structcli__extras.html">cli_extras</a> <a class="el" href="main__infer_8c.html#a9973434ae2443cc726369b714df7b2cb">cli_extras_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Parsed CLI options and derived configuration. </p>

</div>
</div>
<a id="a84c3a6f8fc81d43ea3d5343bc866773c" name="a84c3a6f8fc81d43ea3d5343bc866773c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a84c3a6f8fc81d43ea3d5343bc866773c">&#9670;&#160;</a></span>cudaDeviceSynchronize_fn_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="main__infer_8c.html#a7056b1ed3833957f6045353293d33a10">cudart_err_t</a>(* cudaDeviceSynchronize_fn_t) (void)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00627">627</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>

</div>
</div>
<a id="ac0493a5218ac1cfe7720fd33073a26a4" name="ac0493a5218ac1cfe7720fd33073a26a4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac0493a5218ac1cfe7720fd33073a26a4">&#9670;&#160;</a></span>cudaFree_fn_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="main__infer_8c.html#a7056b1ed3833957f6045353293d33a10">cudart_err_t</a>(* cudaFree_fn_t) (void *)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>cudart function pointer types used by the strict-touch path. </p>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00623">623</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>

</div>
</div>
<a id="a75d810977debadf83c51df3a9caf508e" name="a75d810977debadf83c51df3a9caf508e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a75d810977debadf83c51df3a9caf508e">&#9670;&#160;</a></span>cudaMalloc_fn_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="main__infer_8c.html#a7056b1ed3833957f6045353293d33a10">cudart_err_t</a>(* cudaMalloc_fn_t) (void **, size_t)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00624">624</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>

</div>
</div>
<a id="a012d3ce1c3e56c941279966779621a25" name="a012d3ce1c3e56c941279966779621a25"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a012d3ce1c3e56c941279966779621a25">&#9670;&#160;</a></span>cudaMemcpy_fn_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="main__infer_8c.html#a7056b1ed3833957f6045353293d33a10">cudart_err_t</a>(* cudaMemcpy_fn_t) (void *, const void *, size_t, int)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00625">625</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>

</div>
</div>
<a id="a2ad4e178cd6cc2f9b58919ba9e4ca7b6" name="a2ad4e178cd6cc2f9b58919ba9e4ca7b6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2ad4e178cd6cc2f9b58919ba9e4ca7b6">&#9670;&#160;</a></span>cudaMemset_fn_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="main__infer_8c.html#a7056b1ed3833957f6045353293d33a10">cudart_err_t</a>(* cudaMemset_fn_t) (void *, int, size_t)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00626">626</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>

</div>
</div>
<a id="a47a2371d08ac2298f34240909805e945" name="a47a2371d08ac2298f34240909805e945"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a47a2371d08ac2298f34240909805e945">&#9670;&#160;</a></span>cudart_api_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structcudart__api.html">cudart_api</a> <a class="el" href="main__infer_8c.html#a47a2371d08ac2298f34240909805e945">cudart_api_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Dynamically loaded cudart API table. </p>

</div>
</div>
<a id="a7056b1ed3833957f6045353293d33a10" name="a7056b1ed3833957f6045353293d33a10"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7056b1ed3833957f6045353293d33a10">&#9670;&#160;</a></span>cudart_err_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef int <a class="el" href="main__infer_8c.html#a7056b1ed3833957f6045353293d33a10">cudart_err_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>CUDA runtime error code type (opaque int for dynamic loading). </p>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00618">618</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>

</div>
</div>
<a id="ae3d72519a21dd8c22c60d86104a0c151" name="ae3d72519a21dd8c22c60d86104a0c151"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae3d72519a21dd8c22c60d86104a0c151">&#9670;&#160;</a></span>expected_tokens_entry_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structexpected__tokens__entry.html">expected_tokens_entry</a> <a class="el" href="main__infer_8c.html#ae3d72519a21dd8c22c60d86104a0c151">expected_tokens_entry_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>An entry in the expected-tokens table. </p>
<p>The token list is compared against the engine-generated token IDs for a prompt. </p>

</div>
</div>
<a id="ac519a155900b9eda4cab9d3a9a74dd62" name="ac519a155900b9eda4cab9d3a9a74dd62"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac519a155900b9eda4cab9d3a9a74dd62">&#9670;&#160;</a></span>expected_tokens_table_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structexpected__tokens__table.html">expected_tokens_table</a> <a class="el" href="main__infer_8c.html#ac519a155900b9eda4cab9d3a9a74dd62">expected_tokens_table_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>A table of expected tokens, loaded from a text file. </p>

</div>
</div>
<a id="a54f0d9b3968af3eb368f8847cd420950" name="a54f0d9b3968af3eb368f8847cd420950"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a54f0d9b3968af3eb368f8847cd420950">&#9670;&#160;</a></span>model_mmap_touch_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structmodel__mmap__touch.html">model_mmap_touch</a> <a class="el" href="main__infer_8c.html#a54f0d9b3968af3eb368f8847cd420950">model_mmap_touch_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>A file-backed mmap context for deterministic "touch" work. </p>

</div>
</div>
<a id="aa2c236bcd5a489e1a409ffd5f4c532f7" name="aa2c236bcd5a489e1a409ffd5f4c532f7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa2c236bcd5a489e1a409ffd5f4c532f7">&#9670;&#160;</a></span>prompt_list_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structprompt__list.html">prompt_list</a> <a class="el" href="main__infer_8c.html#aa2c236bcd5a489e1a409ffd5f4c532f7">prompt_list_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prompt list (preloaded) to avoid file I/O in the timed window. </p>

</div>
</div>
<a id="af8802263c4d59c173623fe774ce0abb0" name="af8802263c4d59c173623fe774ce0abb0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af8802263c4d59c173623fe774ce0abb0">&#9670;&#160;</a></span>prompt_round_record_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structprompt__round__record.html">prompt_round_record</a> <a class="el" href="main__infer_8c.html#af8802263c4d59c173623fe774ce0abb0">prompt_round_record_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Per-prompt per-round record, suitable for JSON reporting. </p>

</div>
</div>
<a id="aeaf1944cb54f4e8f7a914be88b362163" name="aeaf1944cb54f4e8f7a914be88b362163"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeaf1944cb54f4e8f7a914be88b362163">&#9670;&#160;</a></span>report_token_buf_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structreport__token__buf.html">report_token_buf</a> <a class="el" href="main__infer_8c.html#aeaf1944cb54f4e8f7a914be88b362163">report_token_buf_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>A token buffer owned by the report (copy of engine output). </p>

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="adf764cbdea00d65edcd07bb9953ad2b7" name="adf764cbdea00d65edcd07bb9953ad2b7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adf764cbdea00d65edcd07bb9953ad2b7">&#9670;&#160;</a></span>anonymous enum</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>cudaMemcpyKind values used by the strict-touch path. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="adf764cbdea00d65edcd07bb9953ad2b7a27d0e750ab6de4620beed5f2c3662c77" name="adf764cbdea00d65edcd07bb9953ad2b7a27d0e750ab6de4620beed5f2c3662c77"></a>CUDA_MEMCPY_HOST_TO_DEVICE&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="adf764cbdea00d65edcd07bb9953ad2b7a866c5293b3ba22bb820c78bfae10f9ed" name="adf764cbdea00d65edcd07bb9953ad2b7a866c5293b3ba22bb820c78bfae10f9ed"></a>CUDA_MEMCPY_DEVICE_TO_HOST&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="adf764cbdea00d65edcd07bb9953ad2b7a72dd74565a54b7fc09708f72ccf8fd5d" name="adf764cbdea00d65edcd07bb9953ad2b7a72dd74565a54b7fc09708f72ccf8fd5d"></a>CUDA_MEMCPY_DEVICE_TO_DEVICE&#160;</td><td class="fielddoc"></td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00632">632</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  632</span>     {</div>
<div class="line"><span class="lineno">  633</span>  <a class="code hl_enumvalue" href="main__infer_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a27d0e750ab6de4620beed5f2c3662c77">CUDA_MEMCPY_HOST_TO_DEVICE</a> = 1,</div>
<div class="line"><span class="lineno">  634</span>  <a class="code hl_enumvalue" href="main__infer_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a866c5293b3ba22bb820c78bfae10f9ed">CUDA_MEMCPY_DEVICE_TO_HOST</a> = 2,</div>
<div class="line"><span class="lineno">  635</span>  <a class="code hl_enumvalue" href="main__infer_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a72dd74565a54b7fc09708f72ccf8fd5d">CUDA_MEMCPY_DEVICE_TO_DEVICE</a> = 3</div>
<div class="line"><span class="lineno">  636</span>};</div>
<div class="ttc" id="amain__infer_8c_html_adf764cbdea00d65edcd07bb9953ad2b7a27d0e750ab6de4620beed5f2c3662c77"><div class="ttname"><a href="main__infer_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a27d0e750ab6de4620beed5f2c3662c77">CUDA_MEMCPY_HOST_TO_DEVICE</a></div><div class="ttdeci">@ CUDA_MEMCPY_HOST_TO_DEVICE</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00633">main_infer.c:633</a></div></div>
<div class="ttc" id="amain__infer_8c_html_adf764cbdea00d65edcd07bb9953ad2b7a72dd74565a54b7fc09708f72ccf8fd5d"><div class="ttname"><a href="main__infer_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a72dd74565a54b7fc09708f72ccf8fd5d">CUDA_MEMCPY_DEVICE_TO_DEVICE</a></div><div class="ttdeci">@ CUDA_MEMCPY_DEVICE_TO_DEVICE</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00636">main_infer.c:635</a></div></div>
<div class="ttc" id="amain__infer_8c_html_adf764cbdea00d65edcd07bb9953ad2b7a866c5293b3ba22bb820c78bfae10f9ed"><div class="ttname"><a href="main__infer_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a866c5293b3ba22bb820c78bfae10f9ed">CUDA_MEMCPY_DEVICE_TO_HOST</a></div><div class="ttdeci">@ CUDA_MEMCPY_DEVICE_TO_HOST</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00634">main_infer.c:634</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae715f0cc745f58eebd4be50b187dd41d" name="ae715f0cc745f58eebd4be50b187dd41d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae715f0cc745f58eebd4be50b187dd41d">&#9670;&#160;</a></span>cli_pretranspose_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="main__infer_8c.html#ae715f0cc745f58eebd4be50b187dd41d">cli_pretranspose_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Pretranspose modes for optional weight transforms. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="ae715f0cc745f58eebd4be50b187dd41da382ceb68dddaaf8b27ac21f144305e74" name="ae715f0cc745f58eebd4be50b187dd41da382ceb68dddaaf8b27ac21f144305e74"></a>CLI_PRETX_NONE&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="ae715f0cc745f58eebd4be50b187dd41da9d22d4f265254a65af9fc3a7d648fe5d" name="ae715f0cc745f58eebd4be50b187dd41da9d22d4f265254a65af9fc3a7d648fe5d"></a>CLI_PRETX_WOH&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="ae715f0cc745f58eebd4be50b187dd41da1a251ee24fdcadcaf9c888e0a96140e7" name="ae715f0cc745f58eebd4be50b187dd41da1a251ee24fdcadcaf9c888e0a96140e7"></a>CLI_PRETX_WXH&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="ae715f0cc745f58eebd4be50b187dd41da4fad867319e4f9197a9c373762a3ad54" name="ae715f0cc745f58eebd4be50b187dd41da4fad867319e4f9197a9c373762a3ad54"></a>CLI_PRETX_ALL&#160;</td><td class="fielddoc"></td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00974">974</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  974</span>             {</div>
<div class="line"><span class="lineno">  975</span>  <a class="code hl_enumvalue" href="main__infer_8c.html#ae715f0cc745f58eebd4be50b187dd41da382ceb68dddaaf8b27ac21f144305e74">CLI_PRETX_NONE</a> = 0,</div>
<div class="line"><span class="lineno">  976</span>  <a class="code hl_enumvalue" href="main__infer_8c.html#ae715f0cc745f58eebd4be50b187dd41da9d22d4f265254a65af9fc3a7d648fe5d">CLI_PRETX_WOH</a>  = 1,</div>
<div class="line"><span class="lineno">  977</span>  <a class="code hl_enumvalue" href="main__infer_8c.html#ae715f0cc745f58eebd4be50b187dd41da1a251ee24fdcadcaf9c888e0a96140e7">CLI_PRETX_WXH</a>  = 2,</div>
<div class="line"><span class="lineno">  978</span>  <a class="code hl_enumvalue" href="main__infer_8c.html#ae715f0cc745f58eebd4be50b187dd41da4fad867319e4f9197a9c373762a3ad54">CLI_PRETX_ALL</a>  = 3</div>
<div class="line"><span class="lineno">  979</span>} <a class="code hl_enumeration" href="main__infer_8c.html#ae715f0cc745f58eebd4be50b187dd41d">cli_pretranspose_t</a>;</div>
<div class="ttc" id="amain__infer_8c_html_ae715f0cc745f58eebd4be50b187dd41d"><div class="ttname"><a href="main__infer_8c.html#ae715f0cc745f58eebd4be50b187dd41d">cli_pretranspose_t</a></div><div class="ttdeci">cli_pretranspose_t</div><div class="ttdoc">Pretranspose modes for optional weight transforms.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00974">main_infer.c:974</a></div></div>
<div class="ttc" id="amain__infer_8c_html_ae715f0cc745f58eebd4be50b187dd41da1a251ee24fdcadcaf9c888e0a96140e7"><div class="ttname"><a href="main__infer_8c.html#ae715f0cc745f58eebd4be50b187dd41da1a251ee24fdcadcaf9c888e0a96140e7">CLI_PRETX_WXH</a></div><div class="ttdeci">@ CLI_PRETX_WXH</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00977">main_infer.c:977</a></div></div>
<div class="ttc" id="amain__infer_8c_html_ae715f0cc745f58eebd4be50b187dd41da382ceb68dddaaf8b27ac21f144305e74"><div class="ttname"><a href="main__infer_8c.html#ae715f0cc745f58eebd4be50b187dd41da382ceb68dddaaf8b27ac21f144305e74">CLI_PRETX_NONE</a></div><div class="ttdeci">@ CLI_PRETX_NONE</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00975">main_infer.c:975</a></div></div>
<div class="ttc" id="amain__infer_8c_html_ae715f0cc745f58eebd4be50b187dd41da4fad867319e4f9197a9c373762a3ad54"><div class="ttname"><a href="main__infer_8c.html#ae715f0cc745f58eebd4be50b187dd41da4fad867319e4f9197a9c373762a3ad54">CLI_PRETX_ALL</a></div><div class="ttdeci">@ CLI_PRETX_ALL</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00979">main_infer.c:978</a></div></div>
<div class="ttc" id="amain__infer_8c_html_ae715f0cc745f58eebd4be50b187dd41da9d22d4f265254a65af9fc3a7d648fe5d"><div class="ttname"><a href="main__infer_8c.html#ae715f0cc745f58eebd4be50b187dd41da9d22d4f265254a65af9fc3a7d648fe5d">CLI_PRETX_WOH</a></div><div class="ttdeci">@ CLI_PRETX_WOH</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00976">main_infer.c:976</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ac50de02cf90e21f66e0681932f39334f" name="ac50de02cf90e21f66e0681932f39334f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac50de02cf90e21f66e0681932f39334f">&#9670;&#160;</a></span>apply_cli_debug_env()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void apply_cli_debug_env </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="main__infer_8c.html#a9973434ae2443cc726369b714df7b2cb">cli_extras_t</a> *&#160;</td>
          <td class="paramname"><em>opt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Apply CLI deterministic/debug knobs by setting environment variables. </p>
<p>This avoids widening the public API and keeps debug behavior available to the benchmark harness and humans consistently.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">opt</td><td>Parsed CLI options (may be NULL).</td></tr>
  </table>
  </dd>
</dl>
<p>apply_cli_debug_env.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">opt</td><td>See implementation for details. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l01231">1231</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1231</span>                                                         {</div>
<div class="line"><span class="lineno"> 1232</span>  <span class="keywordflow">if</span> (!opt) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1233</span> </div>
<div class="line"><span class="lineno"> 1234</span>  <span class="keywordtype">char</span> buf[128];</div>
<div class="line"><span class="lineno"> 1235</span> </div>
<div class="line"><span class="lineno"> 1236</span>  <span class="keywordflow">if</span> (opt-&gt;<a class="code hl_variable" href="structcli__extras.html#a3a19163210b87343cff3a796a2ed7c5a">trace_ids_path</a> &amp;&amp; *opt-&gt;<a class="code hl_variable" href="structcli__extras.html#a3a19163210b87343cff3a796a2ed7c5a">trace_ids_path</a>) {</div>
<div class="line"><span class="lineno"> 1237</span>    (void)setenv(<span class="stringliteral">&quot;IE_TRACE_IDS_JSONL&quot;</span>, opt-&gt;<a class="code hl_variable" href="structcli__extras.html#a3a19163210b87343cff3a796a2ed7c5a">trace_ids_path</a>, 1);</div>
<div class="line"><span class="lineno"> 1238</span>  }</div>
<div class="line"><span class="lineno"> 1239</span> </div>
<div class="line"><span class="lineno"> 1240</span>  <span class="keywordflow">if</span> (opt-&gt;<a class="code hl_variable" href="structcli__extras.html#a9f8297928fead9608d99d8f612797a86">log_tokens</a>) {</div>
<div class="line"><span class="lineno"> 1241</span>    (void)setenv(<span class="stringliteral">&quot;IE_API_LOG_TOKENS&quot;</span>, <span class="stringliteral">&quot;1&quot;</span>, 1);</div>
<div class="line"><span class="lineno"> 1242</span>  }</div>
<div class="line"><span class="lineno"> 1243</span>  <span class="keywordflow">if</span> (opt-&gt;<a class="code hl_variable" href="structcli__extras.html#af40082e05bf7e8eabeabec31f850da27">log_every</a> &gt; 0) {</div>
<div class="line"><span class="lineno"> 1244</span>    (void)snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%d&quot;</span>, opt-&gt;<a class="code hl_variable" href="structcli__extras.html#af40082e05bf7e8eabeabec31f850da27">log_every</a>);</div>
<div class="line"><span class="lineno"> 1245</span>    (void)setenv(<span class="stringliteral">&quot;IE_API_LOG_EVERY&quot;</span>, buf, 1);</div>
<div class="line"><span class="lineno"> 1246</span>  }</div>
<div class="line"><span class="lineno"> 1247</span> </div>
<div class="line"><span class="lineno"> 1248</span>  <span class="keywordflow">if</span> (opt-&gt;<a class="code hl_variable" href="structcli__extras.html#a4803d565f63afbb9307628d9dd82ed76">debug_decode</a>) {</div>
<div class="line"><span class="lineno"> 1249</span>    (void)setenv(<span class="stringliteral">&quot;IE_API_DEBUG_DECODE&quot;</span>, <span class="stringliteral">&quot;1&quot;</span>, 1);</div>
<div class="line"><span class="lineno"> 1250</span>  }</div>
<div class="line"><span class="lineno"> 1251</span>  <span class="keywordflow">if</span> (opt-&gt;<a class="code hl_variable" href="structcli__extras.html#a5bae3dc5d381b3cfbb8e83a259adfd87">debug_decode_every</a> &gt; 0) {</div>
<div class="line"><span class="lineno"> 1252</span>    (void)snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%d&quot;</span>, opt-&gt;<a class="code hl_variable" href="structcli__extras.html#a5bae3dc5d381b3cfbb8e83a259adfd87">debug_decode_every</a>);</div>
<div class="line"><span class="lineno"> 1253</span>    (void)setenv(<span class="stringliteral">&quot;IE_API_DEBUG_DECODE_EVERY&quot;</span>, buf, 1);</div>
<div class="line"><span class="lineno"> 1254</span>  }</div>
<div class="line"><span class="lineno"> 1255</span> </div>
<div class="line"><span class="lineno"> 1256</span>  <span class="keywordflow">if</span> (opt-&gt;<a class="code hl_variable" href="structcli__extras.html#abc6b3f1feda1b61a09d60cd8057de580">debug_topk</a> &gt; 0) {</div>
<div class="line"><span class="lineno"> 1257</span>    (void)snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%d&quot;</span>, opt-&gt;<a class="code hl_variable" href="structcli__extras.html#abc6b3f1feda1b61a09d60cd8057de580">debug_topk</a>);</div>
<div class="line"><span class="lineno"> 1258</span>    (void)setenv(<span class="stringliteral">&quot;IE_DEBUG_TOPK&quot;</span>, buf, 1);</div>
<div class="line"><span class="lineno"> 1259</span>  }</div>
<div class="line"><span class="lineno"> 1260</span>  <span class="keywordflow">if</span> (opt-&gt;<a class="code hl_variable" href="structcli__extras.html#adf504da6e8c550785c800720a31b9d5c">debug_topk_every</a> &gt; 0) {</div>
<div class="line"><span class="lineno"> 1261</span>    (void)snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%d&quot;</span>, opt-&gt;<a class="code hl_variable" href="structcli__extras.html#adf504da6e8c550785c800720a31b9d5c">debug_topk_every</a>);</div>
<div class="line"><span class="lineno"> 1262</span>    (void)setenv(<span class="stringliteral">&quot;IE_DEBUG_TOPK_EVERY&quot;</span>, buf, 1);</div>
<div class="line"><span class="lineno"> 1263</span>  }</div>
<div class="line"><span class="lineno"> 1264</span> </div>
<div class="line"><span class="lineno"> 1265</span>  <span class="keywordflow">if</span> (opt-&gt;<a class="code hl_variable" href="structcli__extras.html#afb0601c5b2854fd3375bfb96482cb92f">seed_set</a>) {</div>
<div class="line"><span class="lineno"> 1266</span>    (void)snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%&quot;</span> PRIu64, (uint64_t)opt-&gt;<a class="code hl_variable" href="structcli__extras.html#a1afc1a4316a4a51394f6e5de9cdeff65">seed</a>);</div>
<div class="line"><span class="lineno"> 1267</span>    (void)setenv(<span class="stringliteral">&quot;IE_SEED&quot;</span>, buf, 1);</div>
<div class="line"><span class="lineno"> 1268</span>  }</div>
<div class="line"><span class="lineno"> 1269</span> </div>
<div class="line"><span class="lineno"> 1270</span>  <span class="keywordflow">if</span> (opt-&gt;<a class="code hl_variable" href="structcli__extras.html#a9254cd2a3a77105eebdf34d7a1157176">greedy</a>) {</div>
<div class="line"><span class="lineno"> 1271</span>    (void)setenv(<span class="stringliteral">&quot;IE_GREEDY&quot;</span>, <span class="stringliteral">&quot;1&quot;</span>, 1);</div>
<div class="line"><span class="lineno"> 1272</span>  }</div>
<div class="line"><span class="lineno"> 1273</span> </div>
<div class="line"><span class="lineno"> 1274</span>  <span class="keywordflow">if</span> (opt-&gt;<a class="code hl_variable" href="structcli__extras.html#aa3770ad7c181aa251c580ca669993f74">temperature_set</a>) {</div>
<div class="line"><span class="lineno"> 1275</span>    (void)snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%.17g&quot;</span>, opt-&gt;<a class="code hl_variable" href="structcli__extras.html#a272fb04cda4afdb3b9b7d83ce4fe2c8b">temperature</a>);</div>
<div class="line"><span class="lineno"> 1276</span>    (void)setenv(<span class="stringliteral">&quot;IE_TEMPERATURE&quot;</span>, buf, 1);</div>
<div class="line"><span class="lineno"> 1277</span>  }</div>
<div class="line"><span class="lineno"> 1278</span>  <span class="keywordflow">if</span> (opt-&gt;<a class="code hl_variable" href="structcli__extras.html#ae8fc1e6538cc0dcf7113755e23a5af2f">top_p_set</a>) {</div>
<div class="line"><span class="lineno"> 1279</span>    (void)snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%.17g&quot;</span>, opt-&gt;<a class="code hl_variable" href="structcli__extras.html#a9e2c7ce1dc9e8e4c4d3f110e880ed8c2">top_p</a>);</div>
<div class="line"><span class="lineno"> 1280</span>    (void)setenv(<span class="stringliteral">&quot;IE_TOP_P&quot;</span>, buf, 1);</div>
<div class="line"><span class="lineno"> 1281</span>  }</div>
<div class="line"><span class="lineno"> 1282</span>  <span class="keywordflow">if</span> (opt-&gt;<a class="code hl_variable" href="structcli__extras.html#aa5d005be050ff9fc83025db8ef23076e">top_k_set</a>) {</div>
<div class="line"><span class="lineno"> 1283</span>    (void)snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%d&quot;</span>, opt-&gt;<a class="code hl_variable" href="structcli__extras.html#ae32e771fdfaebdff9ef1f9c9d8cc3f8a">top_k</a>);</div>
<div class="line"><span class="lineno"> 1284</span>    (void)setenv(<span class="stringliteral">&quot;IE_TOP_K&quot;</span>, buf, 1);</div>
<div class="line"><span class="lineno"> 1285</span>  }</div>
<div class="line"><span class="lineno"> 1286</span>}</div>
<div class="ttc" id="astructcli__extras_html_a1afc1a4316a4a51394f6e5de9cdeff65"><div class="ttname"><a href="structcli__extras.html#a1afc1a4316a4a51394f6e5de9cdeff65">cli_extras::seed</a></div><div class="ttdeci">uint64_t seed</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01032">main_infer.c:1032</a></div></div>
<div class="ttc" id="astructcli__extras_html_a272fb04cda4afdb3b9b7d83ce4fe2c8b"><div class="ttname"><a href="structcli__extras.html#a272fb04cda4afdb3b9b7d83ce4fe2c8b">cli_extras::temperature</a></div><div class="ttdeci">double temperature</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01035">main_infer.c:1035</a></div></div>
<div class="ttc" id="astructcli__extras_html_a3a19163210b87343cff3a796a2ed7c5a"><div class="ttname"><a href="structcli__extras.html#a3a19163210b87343cff3a796a2ed7c5a">cli_extras::trace_ids_path</a></div><div class="ttdeci">const char * trace_ids_path</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01017">main_infer.c:1017</a></div></div>
<div class="ttc" id="astructcli__extras_html_a4803d565f63afbb9307628d9dd82ed76"><div class="ttname"><a href="structcli__extras.html#a4803d565f63afbb9307628d9dd82ed76">cli_extras::debug_decode</a></div><div class="ttdeci">int debug_decode</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01023">main_infer.c:1023</a></div></div>
<div class="ttc" id="astructcli__extras_html_a5bae3dc5d381b3cfbb8e83a259adfd87"><div class="ttname"><a href="structcli__extras.html#a5bae3dc5d381b3cfbb8e83a259adfd87">cli_extras::debug_decode_every</a></div><div class="ttdeci">int debug_decode_every</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01024">main_infer.c:1024</a></div></div>
<div class="ttc" id="astructcli__extras_html_a9254cd2a3a77105eebdf34d7a1157176"><div class="ttname"><a href="structcli__extras.html#a9254cd2a3a77105eebdf34d7a1157176">cli_extras::greedy</a></div><div class="ttdeci">int greedy</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01029">main_infer.c:1029</a></div></div>
<div class="ttc" id="astructcli__extras_html_a9e2c7ce1dc9e8e4c4d3f110e880ed8c2"><div class="ttname"><a href="structcli__extras.html#a9e2c7ce1dc9e8e4c4d3f110e880ed8c2">cli_extras::top_p</a></div><div class="ttdeci">double top_p</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01038">main_infer.c:1038</a></div></div>
<div class="ttc" id="astructcli__extras_html_a9f8297928fead9608d99d8f612797a86"><div class="ttname"><a href="structcli__extras.html#a9f8297928fead9608d99d8f612797a86">cli_extras::log_tokens</a></div><div class="ttdeci">int log_tokens</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01020">main_infer.c:1020</a></div></div>
<div class="ttc" id="astructcli__extras_html_aa3770ad7c181aa251c580ca669993f74"><div class="ttname"><a href="structcli__extras.html#aa3770ad7c181aa251c580ca669993f74">cli_extras::temperature_set</a></div><div class="ttdeci">int temperature_set</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01034">main_infer.c:1034</a></div></div>
<div class="ttc" id="astructcli__extras_html_aa5d005be050ff9fc83025db8ef23076e"><div class="ttname"><a href="structcli__extras.html#aa5d005be050ff9fc83025db8ef23076e">cli_extras::top_k_set</a></div><div class="ttdeci">int top_k_set</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01040">main_infer.c:1040</a></div></div>
<div class="ttc" id="astructcli__extras_html_abc6b3f1feda1b61a09d60cd8057de580"><div class="ttname"><a href="structcli__extras.html#abc6b3f1feda1b61a09d60cd8057de580">cli_extras::debug_topk</a></div><div class="ttdeci">int debug_topk</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01026">main_infer.c:1026</a></div></div>
<div class="ttc" id="astructcli__extras_html_adf504da6e8c550785c800720a31b9d5c"><div class="ttname"><a href="structcli__extras.html#adf504da6e8c550785c800720a31b9d5c">cli_extras::debug_topk_every</a></div><div class="ttdeci">int debug_topk_every</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01027">main_infer.c:1027</a></div></div>
<div class="ttc" id="astructcli__extras_html_ae32e771fdfaebdff9ef1f9c9d8cc3f8a"><div class="ttname"><a href="structcli__extras.html#ae32e771fdfaebdff9ef1f9c9d8cc3f8a">cli_extras::top_k</a></div><div class="ttdeci">int top_k</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01041">main_infer.c:1041</a></div></div>
<div class="ttc" id="astructcli__extras_html_ae8fc1e6538cc0dcf7113755e23a5af2f"><div class="ttname"><a href="structcli__extras.html#ae8fc1e6538cc0dcf7113755e23a5af2f">cli_extras::top_p_set</a></div><div class="ttdeci">int top_p_set</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01037">main_infer.c:1037</a></div></div>
<div class="ttc" id="astructcli__extras_html_af40082e05bf7e8eabeabec31f850da27"><div class="ttname"><a href="structcli__extras.html#af40082e05bf7e8eabeabec31f850da27">cli_extras::log_every</a></div><div class="ttdeci">int log_every</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01021">main_infer.c:1021</a></div></div>
<div class="ttc" id="astructcli__extras_html_afb0601c5b2854fd3375bfb96482cb92f"><div class="ttname"><a href="structcli__extras.html#afb0601c5b2854fd3375bfb96482cb92f">cli_extras::seed_set</a></div><div class="ttdeci">int seed_set</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01031">main_infer.c:1031</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="main__infer_8c_source.html#l01023">cli_extras::debug_decode</a>, <a class="el" href="main__infer_8c_source.html#l01024">cli_extras::debug_decode_every</a>, <a class="el" href="main__infer_8c_source.html#l01026">cli_extras::debug_topk</a>, <a class="el" href="main__infer_8c_source.html#l01027">cli_extras::debug_topk_every</a>, <a class="el" href="main__infer_8c_source.html#l01029">cli_extras::greedy</a>, <a class="el" href="main__infer_8c_source.html#l01021">cli_extras::log_every</a>, <a class="el" href="main__infer_8c_source.html#l01020">cli_extras::log_tokens</a>, <a class="el" href="main__infer_8c_source.html#l01032">cli_extras::seed</a>, <a class="el" href="main__infer_8c_source.html#l01031">cli_extras::seed_set</a>, <a class="el" href="main__infer_8c_source.html#l01035">cli_extras::temperature</a>, <a class="el" href="main__infer_8c_source.html#l01034">cli_extras::temperature_set</a>, <a class="el" href="main__infer_8c_source.html#l01041">cli_extras::top_k</a>, <a class="el" href="main__infer_8c_source.html#l01040">cli_extras::top_k_set</a>, <a class="el" href="main__infer_8c_source.html#l01038">cli_extras::top_p</a>, <a class="el" href="main__infer_8c_source.html#l01037">cli_extras::top_p_set</a>, and <a class="el" href="main__infer_8c_source.html#l01017">cli_extras::trace_ids_path</a>.</p>

<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l02362">main()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_ac50de02cf90e21f66e0681932f39334f_icgraph.svg" width="272" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a72ab94aafe7740f1343d317daa89ca15" name="a72ab94aafe7740f1343d317daa89ca15"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a72ab94aafe7740f1343d317daa89ca15">&#9670;&#160;</a></span>ascii_ieq()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int ascii_ieq </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Case-insensitive ASCII equality. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">a</td><td>String A. </td></tr>
    <tr><td class="paramname">b</td><td>String B. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 when equal (ASCII case-insensitive), 0 otherwise.</dd></dl>
<p>ascii_ieq.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">a</td><td>See implementation for details. </td></tr>
    <tr><td class="paramname">b</td><td>See implementation for details.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>See implementation for details. </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00166">166</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  166</span>                                                   {</div>
<div class="line"><span class="lineno">  167</span>  <span class="keywordflow">if</span> (!a || !b) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  168</span>  <span class="keywordflow">while</span> (*a &amp;&amp; *b) {</div>
<div class="line"><span class="lineno">  169</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> ca = (<span class="keywordtype">unsigned</span> char)*a++;</div>
<div class="line"><span class="lineno">  170</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> cb = (<span class="keywordtype">unsigned</span> char)*b++;</div>
<div class="line"><span class="lineno">  171</span>    <span class="keywordflow">if</span> (ca &gt;= <span class="charliteral">&#39;A&#39;</span> &amp;&amp; ca &lt;= <span class="charliteral">&#39;Z&#39;</span>) ca = (<span class="keywordtype">unsigned</span> char)(ca + 32);</div>
<div class="line"><span class="lineno">  172</span>    <span class="keywordflow">if</span> (cb &gt;= <span class="charliteral">&#39;A&#39;</span> &amp;&amp; cb &lt;= <span class="charliteral">&#39;Z&#39;</span>) cb = (<span class="keywordtype">unsigned</span> char)(cb + 32);</div>
<div class="line"><span class="lineno">  173</span>    <span class="keywordflow">if</span> (ca != cb) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  174</span>  }</div>
<div class="line"><span class="lineno">  175</span>  <span class="keywordflow">return</span> (*a == <span class="charliteral">&#39;\0&#39;</span> &amp;&amp; *b == <span class="charliteral">&#39;\0&#39;</span>);</div>
<div class="line"><span class="lineno">  176</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l02352">device_is_cpu()</a>, <a class="el" href="main__infer_8c_source.html#l02345">device_is_cuda()</a>, <a class="el" href="main__infer_8c_source.html#l02362">main()</a>, and <a class="el" href="main__infer_8c_source.html#l01308">parse_flags()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a72ab94aafe7740f1343d317daa89ca15_icgraph.svg" width="362" height="187"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a680d5eb9763f52ea89ce1764e01121dc" name="a680d5eb9763f52ea89ce1764e01121dc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a680d5eb9763f52ea89ce1764e01121dc">&#9670;&#160;</a></span>canon_dir()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int canon_dir </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>outsz</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>dir</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Canonicalize a directory path with realpath when possible. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">out</td><td>Output buffer. </td></tr>
    <tr><td class="paramname">outsz</td><td>Output capacity. </td></tr>
    <tr><td class="paramname">dir</td><td>Input directory path. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 when realpath succeeded, 0 otherwise (out still set to dir).</dd></dl>
<p>canon_dir.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">out</td><td>See implementation for details. </td></tr>
    <tr><td class="paramname">outsz</td><td>See implementation for details. </td></tr>
    <tr><td class="paramname">dir</td><td>See implementation for details.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>See implementation for details. </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00332">332</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  332</span>                                                               {</div>
<div class="line"><span class="lineno">  333</span>  <span class="keywordflow">if</span> (!out || outsz == 0) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  334</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  335</span>  <span class="keywordflow">if</span> (!dir || !*dir) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  336</span> </div>
<div class="line"><span class="lineno">  337</span>  <span class="keywordtype">char</span> tmp[<a class="code hl_define" href="main__infer_8c.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>];</div>
<div class="line"><span class="lineno">  338</span>  tmp[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  339</span>  <span class="keywordflow">if</span> (realpath(dir, tmp)) {</div>
<div class="line"><span class="lineno">  340</span>    <a class="code hl_function" href="main__infer_8c.html#a210133797f21fcee710ec892841dce42">safe_strcpy</a>(out, outsz, tmp);</div>
<div class="line"><span class="lineno">  341</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  342</span>  }</div>
<div class="line"><span class="lineno">  343</span>  <a class="code hl_function" href="main__infer_8c.html#a210133797f21fcee710ec892841dce42">safe_strcpy</a>(out, outsz, dir);</div>
<div class="line"><span class="lineno">  344</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  345</span>}</div>
<div class="ttc" id="amain__infer_8c_html_a210133797f21fcee710ec892841dce42"><div class="ttname"><a href="main__infer_8c.html#a210133797f21fcee710ec892841dce42">safe_strcpy</a></div><div class="ttdeci">static void safe_strcpy(char *dst, size_t dstsz, const char *src)</div><div class="ttdoc">Safe string copy using snprintf.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00273">main_infer.c:273</a></div></div>
<div class="ttc" id="amain__infer_8c_html_ae688d728e1acdfe5988c7db45d6f0166"><div class="ttname"><a href="main__infer_8c.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a></div><div class="ttdeci">#define PATH_MAX</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00081">main_infer.c:81</a></div></div>
<div class="ttc" id="anamespaceconvert__dtypes__to__numeric_html_a0332296ea5bde95f8e72005df06144a8"><div class="ttname"><a href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">convert_dtypes_to_numeric.out</a></div><div class="ttdeci">dict out</div><div class="ttdef"><b>Definition</b> <a href="convert__dtypes__to__numeric_8py_source.html#l00029">convert_dtypes_to_numeric.py:29</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="main__infer_8c_source.html#l00081">PATH_MAX</a>, and <a class="el" href="main__infer_8c_source.html#l00273">safe_strcpy()</a>.</p>

<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l00378">resolve_model_paths()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a680d5eb9763f52ea89ce1764e01121dc_cgraph.svg" width="242" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a680d5eb9763f52ea89ce1764e01121dc_icgraph.svg" width="408" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a25c42477bc56f4eb2d2a5c53e4510d70" name="a25c42477bc56f4eb2d2a5c53e4510d70"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a25c42477bc56f4eb2d2a5c53e4510d70">&#9670;&#160;</a></span>cli_extras_defaults()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void cli_extras_defaults </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="main__infer_8c.html#a9973434ae2443cc726369b714df7b2cb">cli_extras_t</a> *&#160;</td>
          <td class="paramname"><em>e</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Initialize CLI defaults. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">e</td><td>Options struct to fill.</td></tr>
  </table>
  </dd>
</dl>
<p>cli_extras_defaults.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">e</td><td>See implementation for details. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l01082">1082</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1082</span>                                                 {</div>
<div class="line"><span class="lineno"> 1083</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#aa45c7376781454d767d2202800c27a3e">prompt</a> = NULL;</div>
<div class="line"><span class="lineno"> 1084</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#a5eb0317aa09b90f400b657245b41e92c">max_new</a> = 8;</div>
<div class="line"><span class="lineno"> 1085</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#a4e8cdca32127b81f8fcb41047a320844">threads</a> = 0;</div>
<div class="line"><span class="lineno"> 1086</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#a313d0562dfb63a6350db5c84128fc074">affinity</a> = <span class="stringliteral">&quot;auto&quot;</span>;</div>
<div class="line"><span class="lineno"> 1087</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#a648dda8436ede182650f29f0460fa6a3">pretx</a> = <a class="code hl_enumvalue" href="main__infer_8c.html#ae715f0cc745f58eebd4be50b187dd41da382ceb68dddaaf8b27ac21f144305e74">CLI_PRETX_NONE</a>;</div>
<div class="line"><span class="lineno"> 1088</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#a50cd2ee771a9eee3fd448d2a1c0b5645">device</a> = <span class="stringliteral">&quot;auto&quot;</span>;</div>
<div class="line"><span class="lineno"> 1089</span> </div>
<div class="line"><span class="lineno"> 1090</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#a992ba8185b17f227f60e2e570441b63f">prompts_file</a> = NULL;</div>
<div class="line"><span class="lineno"> 1091</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#a4af612c719a80234b4e753bc559f358c">batch</a> = 1;</div>
<div class="line"><span class="lineno"> 1092</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#a01be4e3c92d754527967d04b729e4ee6">prefetch</a> = <span class="stringliteral">&quot;auto&quot;</span>;</div>
<div class="line"><span class="lineno"> 1093</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#a628bf363ee35fe852bbb6510455647bd">warmup_tokens</a> = 1;</div>
<div class="line"><span class="lineno"> 1094</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#a4e233e0c7d76b4fb4338d7460a552707">aggregate</a> = 0;</div>
<div class="line"><span class="lineno"> 1095</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#a8c1b8fdbf9dc75a774e8b451608c961b">rounds</a> = 1;</div>
<div class="line"><span class="lineno"> 1096</span> </div>
<div class="line"><span class="lineno"> 1097</span> </div>
<div class="line"><span class="lineno"> 1098</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#a3b9c2202e0ba68aa4b3112779697a28e">expected_tokens_file</a> = NULL;</div>
<div class="line"><span class="lineno"> 1099</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#a69d2dd2e3fe09f5ff877aec31e16de34">report_tokens</a> = 1;</div>
<div class="line"><span class="lineno"> 1100</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#a9a0cdb8214e4f1b8cd375e78dc81f064">report_tokens_max</a> = 0;</div>
<div class="line"><span class="lineno"> 1101</span> </div>
<div class="line"><span class="lineno"> 1102</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#aa52e671b92aa5a9099153b609a0c5792">model_dir</a> = NULL;</div>
<div class="line"><span class="lineno"> 1103</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#a96d26a6a2f436fb0b232d383f321c3e6">model_json</a> = NULL;</div>
<div class="line"><span class="lineno"> 1104</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#ae2401ceced12a603aabefd22f57584bd">model_bin</a> = NULL;</div>
<div class="line"><span class="lineno"> 1105</span> </div>
<div class="line"><span class="lineno"> 1106</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#a061a8ed1f6671ad018d99db180df06c2">precision_label</a> = IE_PREC_FP32;</div>
<div class="line"><span class="lineno"> 1107</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#a49d7c958a59c223a1f66d6aedc796e68">precision_from_flag</a> = 0;</div>
<div class="line"><span class="lineno"> 1108</span> </div>
<div class="line"><span class="lineno"> 1109</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#af5f02b3c69e6a0e4882a5427db0ab994">sparsity</a> = <span class="stringliteral">&quot;none&quot;</span>;</div>
<div class="line"><span class="lineno"> 1110</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#aeac7b5044a46ca251e3414887e1e712e">sparsity_from_flag</a> = 0;</div>
<div class="line"><span class="lineno"> 1111</span> </div>
<div class="line"><span class="lineno"> 1112</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#a553c6e455b22c4ff3cd6f00beb166eb7">print_text</a> = 0;</div>
<div class="line"><span class="lineno"> 1113</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#af46939020f3ada099f4c932676dec6b7">tokenizer_path</a> = NULL;</div>
<div class="line"><span class="lineno"> 1114</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#a3a19163210b87343cff3a796a2ed7c5a">trace_ids_path</a> = NULL;</div>
<div class="line"><span class="lineno"> 1115</span> </div>
<div class="line"><span class="lineno"> 1116</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#a9f8297928fead9608d99d8f612797a86">log_tokens</a> = 0;</div>
<div class="line"><span class="lineno"> 1117</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#af40082e05bf7e8eabeabec31f850da27">log_every</a> = 0;</div>
<div class="line"><span class="lineno"> 1118</span> </div>
<div class="line"><span class="lineno"> 1119</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#a4803d565f63afbb9307628d9dd82ed76">debug_decode</a> = 0;</div>
<div class="line"><span class="lineno"> 1120</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#a5bae3dc5d381b3cfbb8e83a259adfd87">debug_decode_every</a> = 0;</div>
<div class="line"><span class="lineno"> 1121</span> </div>
<div class="line"><span class="lineno"> 1122</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#abc6b3f1feda1b61a09d60cd8057de580">debug_topk</a> = 0;</div>
<div class="line"><span class="lineno"> 1123</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#adf504da6e8c550785c800720a31b9d5c">debug_topk_every</a> = 0;</div>
<div class="line"><span class="lineno"> 1124</span> </div>
<div class="line"><span class="lineno"> 1125</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#a9254cd2a3a77105eebdf34d7a1157176">greedy</a> = 0;</div>
<div class="line"><span class="lineno"> 1126</span> </div>
<div class="line"><span class="lineno"> 1127</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#afb0601c5b2854fd3375bfb96482cb92f">seed_set</a> = 0;</div>
<div class="line"><span class="lineno"> 1128</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#a1afc1a4316a4a51394f6e5de9cdeff65">seed</a> = 0;</div>
<div class="line"><span class="lineno"> 1129</span> </div>
<div class="line"><span class="lineno"> 1130</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#aa3770ad7c181aa251c580ca669993f74">temperature_set</a> = 0;</div>
<div class="line"><span class="lineno"> 1131</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#a272fb04cda4afdb3b9b7d83ce4fe2c8b">temperature</a> = 0.0;</div>
<div class="line"><span class="lineno"> 1132</span> </div>
<div class="line"><span class="lineno"> 1133</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#ae8fc1e6538cc0dcf7113755e23a5af2f">top_p_set</a> = 0;</div>
<div class="line"><span class="lineno"> 1134</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#a9e2c7ce1dc9e8e4c4d3f110e880ed8c2">top_p</a> = 0.0;</div>
<div class="line"><span class="lineno"> 1135</span> </div>
<div class="line"><span class="lineno"> 1136</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#aa5d005be050ff9fc83025db8ef23076e">top_k_set</a> = 0;</div>
<div class="line"><span class="lineno"> 1137</span>  e-&gt;<a class="code hl_variable" href="structcli__extras.html#ae32e771fdfaebdff9ef1f9c9d8cc3f8a">top_k</a> = 0;</div>
<div class="line"><span class="lineno"> 1138</span>}</div>
<div class="ttc" id="astructcli__extras_html_a01be4e3c92d754527967d04b729e4ee6"><div class="ttname"><a href="structcli__extras.html#a01be4e3c92d754527967d04b729e4ee6">cli_extras::prefetch</a></div><div class="ttdeci">const char * prefetch</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00994">main_infer.c:994</a></div></div>
<div class="ttc" id="astructcli__extras_html_a061a8ed1f6671ad018d99db180df06c2"><div class="ttname"><a href="structcli__extras.html#a061a8ed1f6671ad018d99db180df06c2">cli_extras::precision_label</a></div><div class="ttdeci">const char * precision_label</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01008">main_infer.c:1008</a></div></div>
<div class="ttc" id="astructcli__extras_html_a313d0562dfb63a6350db5c84128fc074"><div class="ttname"><a href="structcli__extras.html#a313d0562dfb63a6350db5c84128fc074">cli_extras::affinity</a></div><div class="ttdeci">const char * affinity</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00988">main_infer.c:988</a></div></div>
<div class="ttc" id="astructcli__extras_html_a3b9c2202e0ba68aa4b3112779697a28e"><div class="ttname"><a href="structcli__extras.html#a3b9c2202e0ba68aa4b3112779697a28e">cli_extras::expected_tokens_file</a></div><div class="ttdeci">const char * expected_tokens_file</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01000">main_infer.c:1000</a></div></div>
<div class="ttc" id="astructcli__extras_html_a49d7c958a59c223a1f66d6aedc796e68"><div class="ttname"><a href="structcli__extras.html#a49d7c958a59c223a1f66d6aedc796e68">cli_extras::precision_from_flag</a></div><div class="ttdeci">int precision_from_flag</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01009">main_infer.c:1009</a></div></div>
<div class="ttc" id="astructcli__extras_html_a4af612c719a80234b4e753bc559f358c"><div class="ttname"><a href="structcli__extras.html#a4af612c719a80234b4e753bc559f358c">cli_extras::batch</a></div><div class="ttdeci">int batch</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00993">main_infer.c:993</a></div></div>
<div class="ttc" id="astructcli__extras_html_a4e233e0c7d76b4fb4338d7460a552707"><div class="ttname"><a href="structcli__extras.html#a4e233e0c7d76b4fb4338d7460a552707">cli_extras::aggregate</a></div><div class="ttdeci">int aggregate</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00996">main_infer.c:996</a></div></div>
<div class="ttc" id="astructcli__extras_html_a4e8cdca32127b81f8fcb41047a320844"><div class="ttname"><a href="structcli__extras.html#a4e8cdca32127b81f8fcb41047a320844">cli_extras::threads</a></div><div class="ttdeci">int threads</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00987">main_infer.c:987</a></div></div>
<div class="ttc" id="astructcli__extras_html_a50cd2ee771a9eee3fd448d2a1c0b5645"><div class="ttname"><a href="structcli__extras.html#a50cd2ee771a9eee3fd448d2a1c0b5645">cli_extras::device</a></div><div class="ttdeci">const char * device</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00990">main_infer.c:990</a></div></div>
<div class="ttc" id="astructcli__extras_html_a553c6e455b22c4ff3cd6f00beb166eb7"><div class="ttname"><a href="structcli__extras.html#a553c6e455b22c4ff3cd6f00beb166eb7">cli_extras::print_text</a></div><div class="ttdeci">int print_text</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01015">main_infer.c:1015</a></div></div>
<div class="ttc" id="astructcli__extras_html_a5eb0317aa09b90f400b657245b41e92c"><div class="ttname"><a href="structcli__extras.html#a5eb0317aa09b90f400b657245b41e92c">cli_extras::max_new</a></div><div class="ttdeci">size_t max_new</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00986">main_infer.c:986</a></div></div>
<div class="ttc" id="astructcli__extras_html_a628bf363ee35fe852bbb6510455647bd"><div class="ttname"><a href="structcli__extras.html#a628bf363ee35fe852bbb6510455647bd">cli_extras::warmup_tokens</a></div><div class="ttdeci">int warmup_tokens</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00995">main_infer.c:995</a></div></div>
<div class="ttc" id="astructcli__extras_html_a648dda8436ede182650f29f0460fa6a3"><div class="ttname"><a href="structcli__extras.html#a648dda8436ede182650f29f0460fa6a3">cli_extras::pretx</a></div><div class="ttdeci">cli_pretranspose_t pretx</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00989">main_infer.c:989</a></div></div>
<div class="ttc" id="astructcli__extras_html_a69d2dd2e3fe09f5ff877aec31e16de34"><div class="ttname"><a href="structcli__extras.html#a69d2dd2e3fe09f5ff877aec31e16de34">cli_extras::report_tokens</a></div><div class="ttdeci">int report_tokens</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01001">main_infer.c:1001</a></div></div>
<div class="ttc" id="astructcli__extras_html_a8c1b8fdbf9dc75a774e8b451608c961b"><div class="ttname"><a href="structcli__extras.html#a8c1b8fdbf9dc75a774e8b451608c961b">cli_extras::rounds</a></div><div class="ttdeci">int rounds</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00997">main_infer.c:997</a></div></div>
<div class="ttc" id="astructcli__extras_html_a96d26a6a2f436fb0b232d383f321c3e6"><div class="ttname"><a href="structcli__extras.html#a96d26a6a2f436fb0b232d383f321c3e6">cli_extras::model_json</a></div><div class="ttdeci">const char * model_json</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01005">main_infer.c:1005</a></div></div>
<div class="ttc" id="astructcli__extras_html_a992ba8185b17f227f60e2e570441b63f"><div class="ttname"><a href="structcli__extras.html#a992ba8185b17f227f60e2e570441b63f">cli_extras::prompts_file</a></div><div class="ttdeci">const char * prompts_file</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00992">main_infer.c:992</a></div></div>
<div class="ttc" id="astructcli__extras_html_a9a0cdb8214e4f1b8cd375e78dc81f064"><div class="ttname"><a href="structcli__extras.html#a9a0cdb8214e4f1b8cd375e78dc81f064">cli_extras::report_tokens_max</a></div><div class="ttdeci">size_t report_tokens_max</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01002">main_infer.c:1002</a></div></div>
<div class="ttc" id="astructcli__extras_html_aa45c7376781454d767d2202800c27a3e"><div class="ttname"><a href="structcli__extras.html#aa45c7376781454d767d2202800c27a3e">cli_extras::prompt</a></div><div class="ttdeci">const char * prompt</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00985">main_infer.c:985</a></div></div>
<div class="ttc" id="astructcli__extras_html_aa52e671b92aa5a9099153b609a0c5792"><div class="ttname"><a href="structcli__extras.html#aa52e671b92aa5a9099153b609a0c5792">cli_extras::model_dir</a></div><div class="ttdeci">const char * model_dir</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01004">main_infer.c:1004</a></div></div>
<div class="ttc" id="astructcli__extras_html_ae2401ceced12a603aabefd22f57584bd"><div class="ttname"><a href="structcli__extras.html#ae2401ceced12a603aabefd22f57584bd">cli_extras::model_bin</a></div><div class="ttdeci">const char * model_bin</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01006">main_infer.c:1006</a></div></div>
<div class="ttc" id="astructcli__extras_html_aeac7b5044a46ca251e3414887e1e712e"><div class="ttname"><a href="structcli__extras.html#aeac7b5044a46ca251e3414887e1e712e">cli_extras::sparsity_from_flag</a></div><div class="ttdeci">int sparsity_from_flag</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01012">main_infer.c:1012</a></div></div>
<div class="ttc" id="astructcli__extras_html_af46939020f3ada099f4c932676dec6b7"><div class="ttname"><a href="structcli__extras.html#af46939020f3ada099f4c932676dec6b7">cli_extras::tokenizer_path</a></div><div class="ttdeci">const char * tokenizer_path</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01016">main_infer.c:1016</a></div></div>
<div class="ttc" id="astructcli__extras_html_af5f02b3c69e6a0e4882a5427db0ab994"><div class="ttname"><a href="structcli__extras.html#af5f02b3c69e6a0e4882a5427db0ab994">cli_extras::sparsity</a></div><div class="ttdeci">const char * sparsity</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01011">main_infer.c:1011</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="main__infer_8c_source.html#l00988">cli_extras::affinity</a>, <a class="el" href="main__infer_8c_source.html#l00996">cli_extras::aggregate</a>, <a class="el" href="main__infer_8c_source.html#l00993">cli_extras::batch</a>, <a class="el" href="main__infer_8c_source.html#l00975">CLI_PRETX_NONE</a>, <a class="el" href="main__infer_8c_source.html#l01023">cli_extras::debug_decode</a>, <a class="el" href="main__infer_8c_source.html#l01024">cli_extras::debug_decode_every</a>, <a class="el" href="main__infer_8c_source.html#l01026">cli_extras::debug_topk</a>, <a class="el" href="main__infer_8c_source.html#l01027">cli_extras::debug_topk_every</a>, <a class="el" href="main__infer_8c_source.html#l00990">cli_extras::device</a>, <a class="el" href="main__infer_8c_source.html#l01000">cli_extras::expected_tokens_file</a>, <a class="el" href="main__infer_8c_source.html#l01029">cli_extras::greedy</a>, <a class="el" href="main__infer_8c_source.html#l01021">cli_extras::log_every</a>, <a class="el" href="main__infer_8c_source.html#l01020">cli_extras::log_tokens</a>, <a class="el" href="main__infer_8c_source.html#l00986">cli_extras::max_new</a>, <a class="el" href="main__infer_8c_source.html#l01006">cli_extras::model_bin</a>, <a class="el" href="main__infer_8c_source.html#l01004">cli_extras::model_dir</a>, <a class="el" href="main__infer_8c_source.html#l01005">cli_extras::model_json</a>, <a class="el" href="main__infer_8c_source.html#l01009">cli_extras::precision_from_flag</a>, <a class="el" href="main__infer_8c_source.html#l01008">cli_extras::precision_label</a>, <a class="el" href="main__infer_8c_source.html#l00994">cli_extras::prefetch</a>, <a class="el" href="main__infer_8c_source.html#l00989">cli_extras::pretx</a>, <a class="el" href="main__infer_8c_source.html#l01015">cli_extras::print_text</a>, <a class="el" href="main__infer_8c_source.html#l00985">cli_extras::prompt</a>, <a class="el" href="main__infer_8c_source.html#l00992">cli_extras::prompts_file</a>, <a class="el" href="main__infer_8c_source.html#l01001">cli_extras::report_tokens</a>, <a class="el" href="main__infer_8c_source.html#l01002">cli_extras::report_tokens_max</a>, <a class="el" href="main__infer_8c_source.html#l00997">cli_extras::rounds</a>, <a class="el" href="main__infer_8c_source.html#l01032">cli_extras::seed</a>, <a class="el" href="main__infer_8c_source.html#l01031">cli_extras::seed_set</a>, <a class="el" href="main__infer_8c_source.html#l01011">cli_extras::sparsity</a>, <a class="el" href="main__infer_8c_source.html#l01012">cli_extras::sparsity_from_flag</a>, <a class="el" href="main__infer_8c_source.html#l01035">cli_extras::temperature</a>, <a class="el" href="main__infer_8c_source.html#l01034">cli_extras::temperature_set</a>, <a class="el" href="main__infer_8c_source.html#l00987">cli_extras::threads</a>, <a class="el" href="main__infer_8c_source.html#l01016">cli_extras::tokenizer_path</a>, <a class="el" href="main__infer_8c_source.html#l01041">cli_extras::top_k</a>, <a class="el" href="main__infer_8c_source.html#l01040">cli_extras::top_k_set</a>, <a class="el" href="main__infer_8c_source.html#l01038">cli_extras::top_p</a>, <a class="el" href="main__infer_8c_source.html#l01037">cli_extras::top_p_set</a>, <a class="el" href="main__infer_8c_source.html#l01017">cli_extras::trace_ids_path</a>, and <a class="el" href="main__infer_8c_source.html#l00995">cli_extras::warmup_tokens</a>.</p>

<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l01308">parse_flags()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a25c42477bc56f4eb2d2a5c53e4510d70_icgraph.svg" width="403" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="aca4f099fbc130845b4af6c57ca21b3ef" name="aca4f099fbc130845b4af6c57ca21b3ef"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aca4f099fbc130845b4af6c57ca21b3ef">&#9670;&#160;</a></span>cudart_get_api()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="main__infer_8c.html#a47a2371d08ac2298f34240909805e945">cudart_api_t</a> * cudart_get_api </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Load cudart symbols via dlopen/dlsym (lazy singleton). </p>
<dl class="section return"><dt>Returns</dt><dd>Pointer to API table on success, NULL otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00655">655</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  655</span>                                          {</div>
<div class="line"><span class="lineno">  656</span>  <span class="keyword">static</span> <a class="code hl_struct" href="structcudart__api.html">cudart_api_t</a> api;</div>
<div class="line"><span class="lineno">  657</span>  <span class="keyword">static</span> <span class="keywordtype">int</span> inited = 0;</div>
<div class="line"><span class="lineno">  658</span>  <span class="keywordflow">if</span> (inited) <span class="keywordflow">return</span> api.<a class="code hl_variable" href="structcudart__api.html#ad3b6ea8382433674c94c19f638d1224e">ok</a> ? &amp;api : NULL;</div>
<div class="line"><span class="lineno">  659</span>  inited = 1;</div>
<div class="line"><span class="lineno">  660</span> </div>
<div class="line"><span class="lineno">  661</span>  memset(&amp;api, 0, <span class="keyword">sizeof</span>(api));</div>
<div class="line"><span class="lineno">  662</span> </div>
<div class="line"><span class="lineno">  663</span>  api.<a class="code hl_variable" href="structcudart__api.html#ae8f421003c605dc77bebe8fab65624cc">handle</a> = dlopen(<span class="stringliteral">&quot;libcudart.so&quot;</span>, RTLD_NOW | RTLD_LOCAL);</div>
<div class="line"><span class="lineno">  664</span>  <span class="keywordflow">if</span> (!api.<a class="code hl_variable" href="structcudart__api.html#ae8f421003c605dc77bebe8fab65624cc">handle</a>) api.<a class="code hl_variable" href="structcudart__api.html#ae8f421003c605dc77bebe8fab65624cc">handle</a> = dlopen(<span class="stringliteral">&quot;libcudart.so.12&quot;</span>, RTLD_NOW | RTLD_LOCAL);</div>
<div class="line"><span class="lineno">  665</span>  <span class="keywordflow">if</span> (!api.<a class="code hl_variable" href="structcudart__api.html#ae8f421003c605dc77bebe8fab65624cc">handle</a>) api.<a class="code hl_variable" href="structcudart__api.html#ae8f421003c605dc77bebe8fab65624cc">handle</a> = dlopen(<span class="stringliteral">&quot;libcudart.so.11.0&quot;</span>, RTLD_NOW | RTLD_LOCAL);</div>
<div class="line"><span class="lineno">  666</span> </div>
<div class="line"><span class="lineno">  667</span>  <span class="keywordflow">if</span> (!api.<a class="code hl_variable" href="structcudart__api.html#ae8f421003c605dc77bebe8fab65624cc">handle</a>) {</div>
<div class="line"><span class="lineno">  668</span>    api.<a class="code hl_variable" href="structcudart__api.html#ad3b6ea8382433674c94c19f638d1224e">ok</a> = 0;</div>
<div class="line"><span class="lineno">  669</span>    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  670</span>  }</div>
<div class="line"><span class="lineno">  671</span> </div>
<div class="line"><span class="lineno">  672</span>  { <span class="keyword">union </span>{ <span class="keywordtype">void</span> *p; <a class="code hl_typedef" href="main__infer_8c.html#ac0493a5218ac1cfe7720fd33073a26a4">cudaFree_fn_t</a> f; } u; u.p = dlsym(api.<a class="code hl_variable" href="structcudart__api.html#ae8f421003c605dc77bebe8fab65624cc">handle</a>, <span class="stringliteral">&quot;cudaFree&quot;</span>); api.<a class="code hl_variable" href="structcudart__api.html#a2c3660d016022d753aa36e57b5ed469c">cudaFree</a> = u.f; }</div>
<div class="line"><span class="lineno">  673</span>  { <span class="keyword">union </span>{ <span class="keywordtype">void</span> *p; <a class="code hl_typedef" href="main__infer_8c.html#a75d810977debadf83c51df3a9caf508e">cudaMalloc_fn_t</a> f; } u; u.p = dlsym(api.<a class="code hl_variable" href="structcudart__api.html#ae8f421003c605dc77bebe8fab65624cc">handle</a>, <span class="stringliteral">&quot;cudaMalloc&quot;</span>); api.<a class="code hl_variable" href="structcudart__api.html#a90ebdb0591a336ef47414cd285d15371">cudaMalloc</a> = u.f; }</div>
<div class="line"><span class="lineno">  674</span>  { <span class="keyword">union </span>{ <span class="keywordtype">void</span> *p; <a class="code hl_typedef" href="main__infer_8c.html#a012d3ce1c3e56c941279966779621a25">cudaMemcpy_fn_t</a> f; } u; u.p = dlsym(api.<a class="code hl_variable" href="structcudart__api.html#ae8f421003c605dc77bebe8fab65624cc">handle</a>, <span class="stringliteral">&quot;cudaMemcpy&quot;</span>); api.<a class="code hl_variable" href="structcudart__api.html#a6e790e818a18bd526582a098649f2f92">cudaMemcpy</a> = u.f; }</div>
<div class="line"><span class="lineno">  675</span>  { <span class="keyword">union </span>{ <span class="keywordtype">void</span> *p; <a class="code hl_typedef" href="main__infer_8c.html#a2ad4e178cd6cc2f9b58919ba9e4ca7b6">cudaMemset_fn_t</a> f; } u; u.p = dlsym(api.<a class="code hl_variable" href="structcudart__api.html#ae8f421003c605dc77bebe8fab65624cc">handle</a>, <span class="stringliteral">&quot;cudaMemset&quot;</span>); api.<a class="code hl_variable" href="structcudart__api.html#a7e9b278453c583049fcbb790bfa32c5d">cudaMemset</a> = u.f; }</div>
<div class="line"><span class="lineno">  676</span>  { <span class="keyword">union </span>{ <span class="keywordtype">void</span> *p; <a class="code hl_typedef" href="main__infer_8c.html#a84c3a6f8fc81d43ea3d5343bc866773c">cudaDeviceSynchronize_fn_t</a> f; } u; u.p = dlsym(api.<a class="code hl_variable" href="structcudart__api.html#ae8f421003c605dc77bebe8fab65624cc">handle</a>, <span class="stringliteral">&quot;cudaDeviceSynchronize&quot;</span>); api.<a class="code hl_variable" href="structcudart__api.html#a8885e8aa343a956388d6fc359994b5b6">cudaDeviceSynchronize</a> = u.f; }</div>
<div class="line"><span class="lineno">  677</span> </div>
<div class="line"><span class="lineno">  678</span>  <span class="keywordflow">if</span> (!api.<a class="code hl_variable" href="structcudart__api.html#a2c3660d016022d753aa36e57b5ed469c">cudaFree</a> || !api.<a class="code hl_variable" href="structcudart__api.html#a90ebdb0591a336ef47414cd285d15371">cudaMalloc</a> || !api.<a class="code hl_variable" href="structcudart__api.html#a6e790e818a18bd526582a098649f2f92">cudaMemcpy</a> || !api.<a class="code hl_variable" href="structcudart__api.html#a7e9b278453c583049fcbb790bfa32c5d">cudaMemset</a> || !api.<a class="code hl_variable" href="structcudart__api.html#a8885e8aa343a956388d6fc359994b5b6">cudaDeviceSynchronize</a>) {</div>
<div class="line"><span class="lineno">  679</span>    (void)dlclose(api.<a class="code hl_variable" href="structcudart__api.html#ae8f421003c605dc77bebe8fab65624cc">handle</a>);</div>
<div class="line"><span class="lineno">  680</span>    api.<a class="code hl_variable" href="structcudart__api.html#ae8f421003c605dc77bebe8fab65624cc">handle</a> = NULL;</div>
<div class="line"><span class="lineno">  681</span>    api.<a class="code hl_variable" href="structcudart__api.html#ad3b6ea8382433674c94c19f638d1224e">ok</a> = 0;</div>
<div class="line"><span class="lineno">  682</span>    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  683</span>  }</div>
<div class="line"><span class="lineno">  684</span> </div>
<div class="line"><span class="lineno">  685</span>  api.<a class="code hl_variable" href="structcudart__api.html#ad3b6ea8382433674c94c19f638d1224e">ok</a> = 1;</div>
<div class="line"><span class="lineno">  686</span>  <span class="keywordflow">return</span> &amp;api;</div>
<div class="line"><span class="lineno">  687</span>}</div>
<div class="ttc" id="amain__infer_8c_html_a012d3ce1c3e56c941279966779621a25"><div class="ttname"><a href="main__infer_8c.html#a012d3ce1c3e56c941279966779621a25">cudaMemcpy_fn_t</a></div><div class="ttdeci">cudart_err_t(* cudaMemcpy_fn_t)(void *, const void *, size_t, int)</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00625">main_infer.c:625</a></div></div>
<div class="ttc" id="amain__infer_8c_html_a2ad4e178cd6cc2f9b58919ba9e4ca7b6"><div class="ttname"><a href="main__infer_8c.html#a2ad4e178cd6cc2f9b58919ba9e4ca7b6">cudaMemset_fn_t</a></div><div class="ttdeci">cudart_err_t(* cudaMemset_fn_t)(void *, int, size_t)</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00626">main_infer.c:626</a></div></div>
<div class="ttc" id="amain__infer_8c_html_a75d810977debadf83c51df3a9caf508e"><div class="ttname"><a href="main__infer_8c.html#a75d810977debadf83c51df3a9caf508e">cudaMalloc_fn_t</a></div><div class="ttdeci">cudart_err_t(* cudaMalloc_fn_t)(void **, size_t)</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00624">main_infer.c:624</a></div></div>
<div class="ttc" id="amain__infer_8c_html_a84c3a6f8fc81d43ea3d5343bc866773c"><div class="ttname"><a href="main__infer_8c.html#a84c3a6f8fc81d43ea3d5343bc866773c">cudaDeviceSynchronize_fn_t</a></div><div class="ttdeci">cudart_err_t(* cudaDeviceSynchronize_fn_t)(void)</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00627">main_infer.c:627</a></div></div>
<div class="ttc" id="amain__infer_8c_html_ac0493a5218ac1cfe7720fd33073a26a4"><div class="ttname"><a href="main__infer_8c.html#ac0493a5218ac1cfe7720fd33073a26a4">cudaFree_fn_t</a></div><div class="ttdeci">cudart_err_t(* cudaFree_fn_t)(void *)</div><div class="ttdoc">cudart function pointer types used by the strict-touch path.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00623">main_infer.c:623</a></div></div>
<div class="ttc" id="astructcudart__api_html"><div class="ttname"><a href="structcudart__api.html">cudart_api</a></div><div class="ttdoc">Dynamically loaded cudart API table.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00641">main_infer.c:641</a></div></div>
<div class="ttc" id="astructcudart__api_html_a2c3660d016022d753aa36e57b5ed469c"><div class="ttname"><a href="structcudart__api.html#a2c3660d016022d753aa36e57b5ed469c">cudart_api::cudaFree</a></div><div class="ttdeci">cudaFree_fn_t cudaFree</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00644">main_infer.c:644</a></div></div>
<div class="ttc" id="astructcudart__api_html_a6e790e818a18bd526582a098649f2f92"><div class="ttname"><a href="structcudart__api.html#a6e790e818a18bd526582a098649f2f92">cudart_api::cudaMemcpy</a></div><div class="ttdeci">cudaMemcpy_fn_t cudaMemcpy</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00646">main_infer.c:646</a></div></div>
<div class="ttc" id="astructcudart__api_html_a7e9b278453c583049fcbb790bfa32c5d"><div class="ttname"><a href="structcudart__api.html#a7e9b278453c583049fcbb790bfa32c5d">cudart_api::cudaMemset</a></div><div class="ttdeci">cudaMemset_fn_t cudaMemset</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00647">main_infer.c:647</a></div></div>
<div class="ttc" id="astructcudart__api_html_a8885e8aa343a956388d6fc359994b5b6"><div class="ttname"><a href="structcudart__api.html#a8885e8aa343a956388d6fc359994b5b6">cudart_api::cudaDeviceSynchronize</a></div><div class="ttdeci">cudaDeviceSynchronize_fn_t cudaDeviceSynchronize</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00648">main_infer.c:648</a></div></div>
<div class="ttc" id="astructcudart__api_html_a90ebdb0591a336ef47414cd285d15371"><div class="ttname"><a href="structcudart__api.html#a90ebdb0591a336ef47414cd285d15371">cudart_api::cudaMalloc</a></div><div class="ttdeci">cudaMalloc_fn_t cudaMalloc</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00645">main_infer.c:645</a></div></div>
<div class="ttc" id="astructcudart__api_html_ad3b6ea8382433674c94c19f638d1224e"><div class="ttname"><a href="structcudart__api.html#ad3b6ea8382433674c94c19f638d1224e">cudart_api::ok</a></div><div class="ttdeci">int ok</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00643">main_infer.c:643</a></div></div>
<div class="ttc" id="astructcudart__api_html_ae8f421003c605dc77bebe8fab65624cc"><div class="ttname"><a href="structcudart__api.html#ae8f421003c605dc77bebe8fab65624cc">cudart_api::handle</a></div><div class="ttdeci">void * handle</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00642">main_infer.c:642</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="main__infer_8c_source.html#l00648">cudart_api::cudaDeviceSynchronize</a>, <a class="el" href="main__infer_8c_source.html#l00644">cudart_api::cudaFree</a>, <a class="el" href="main__infer_8c_source.html#l00645">cudart_api::cudaMalloc</a>, <a class="el" href="main__infer_8c_source.html#l00646">cudart_api::cudaMemcpy</a>, <a class="el" href="main__infer_8c_source.html#l00647">cudart_api::cudaMemset</a>, <a class="el" href="main__infer_8c_source.html#l00642">cudart_api::handle</a>, and <a class="el" href="main__infer_8c_source.html#l00643">cudart_api::ok</a>.</p>

<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l00697">cudart_touch_bytes()</a>, and <a class="el" href="main__infer_8c_source.html#l02362">main()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_aca4f099fbc130845b4af6c57ca21b3ef_icgraph.svg" width="430" height="62"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a44a0de9d17f6eff8a4764537268ab5d1" name="a44a0de9d17f6eff8a4764537268ab5d1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a44a0de9d17f6eff8a4764537268ab5d1">&#9670;&#160;</a></span>cudart_touch_bytes()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int cudart_touch_bytes </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>bytes_per_token</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>tokens</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>stride_bytes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>verify_touch</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Strict CUDA touch: cudaMalloc + repeated cudaMemset + optional D2H copy. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">bytes_per_token</td><td>Bytes per token (0 disables). </td></tr>
    <tr><td class="paramname">tokens</td><td>Number of generated tokens for this call. </td></tr>
    <tr><td class="paramname">stride_bytes</td><td>Unused (kept for symmetry with CPU touch). </td></tr>
    <tr><td class="paramname">verify_touch</td><td>If nonzero, perform a small D2H copy. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, nonzero on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00697">697</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  700</span>                                                {</div>
<div class="line"><span class="lineno">  701</span>  <a class="code hl_define" href="main__infer_8c.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a>(stride_bytes);</div>
<div class="line"><span class="lineno">  702</span> </div>
<div class="line"><span class="lineno">  703</span>  <a class="code hl_struct" href="structcudart__api.html">cudart_api_t</a> *api = <a class="code hl_function" href="main__infer_8c.html#aca4f099fbc130845b4af6c57ca21b3ef">cudart_get_api</a>();</div>
<div class="line"><span class="lineno">  704</span>  <span class="keywordflow">if</span> (!api) <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  705</span>  <span class="keywordflow">if</span> (bytes_per_token == 0 || tokens == 0) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  706</span> </div>
<div class="line"><span class="lineno">  707</span>  <span class="keywordtype">void</span> *d = NULL;</div>
<div class="line"><span class="lineno">  708</span>  <a class="code hl_typedef" href="main__infer_8c.html#a7056b1ed3833957f6045353293d33a10">cudart_err_t</a> e = api-&gt;<a class="code hl_variable" href="structcudart__api.html#a90ebdb0591a336ef47414cd285d15371">cudaMalloc</a>(&amp;d, bytes_per_token);</div>
<div class="line"><span class="lineno">  709</span>  <span class="keywordflow">if</span> (e != 0 || !d) <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  710</span> </div>
<div class="line"><span class="lineno">  711</span>  <span class="keywordflow">for</span> (uint64_t t = 0; t &lt; tokens; ++t) {</div>
<div class="line"><span class="lineno">  712</span>    <span class="keywordtype">int</span> pattern = (int)(t &amp; 0xFFu);</div>
<div class="line"><span class="lineno">  713</span>    e = api-&gt;<a class="code hl_variable" href="structcudart__api.html#a7e9b278453c583049fcbb790bfa32c5d">cudaMemset</a>(d, pattern, bytes_per_token);</div>
<div class="line"><span class="lineno">  714</span>    <span class="keywordflow">if</span> (e != 0) {</div>
<div class="line"><span class="lineno">  715</span>      (void)api-&gt;<a class="code hl_variable" href="structcudart__api.html#a2c3660d016022d753aa36e57b5ed469c">cudaFree</a>(d);</div>
<div class="line"><span class="lineno">  716</span>      <span class="keywordflow">return</span> 2;</div>
<div class="line"><span class="lineno">  717</span>    }</div>
<div class="line"><span class="lineno">  718</span>  }</div>
<div class="line"><span class="lineno">  719</span> </div>
<div class="line"><span class="lineno">  720</span>  e = api-&gt;<a class="code hl_variable" href="structcudart__api.html#a8885e8aa343a956388d6fc359994b5b6">cudaDeviceSynchronize</a>();</div>
<div class="line"><span class="lineno">  721</span>  <span class="keywordflow">if</span> (e != 0) {</div>
<div class="line"><span class="lineno">  722</span>    (void)api-&gt;<a class="code hl_variable" href="structcudart__api.html#a2c3660d016022d753aa36e57b5ed469c">cudaFree</a>(d);</div>
<div class="line"><span class="lineno">  723</span>    <span class="keywordflow">return</span> 3;</div>
<div class="line"><span class="lineno">  724</span>  }</div>
<div class="line"><span class="lineno">  725</span> </div>
<div class="line"><span class="lineno">  726</span>  <span class="keywordflow">if</span> (verify_touch) {</div>
<div class="line"><span class="lineno">  727</span>    uint64_t tmp = 0;</div>
<div class="line"><span class="lineno">  728</span>    <span class="keywordtype">size_t</span> n = <a class="code hl_function" href="main__infer_8c.html#a42d8c2f3c8817b30177d0a7e39742b03">min_size</a>(<span class="keyword">sizeof</span>(tmp), bytes_per_token);</div>
<div class="line"><span class="lineno">  729</span>    e = api-&gt;<a class="code hl_variable" href="structcudart__api.html#a6e790e818a18bd526582a098649f2f92">cudaMemcpy</a>(&amp;tmp, d, n, <a class="code hl_enumvalue" href="main__infer_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a866c5293b3ba22bb820c78bfae10f9ed">CUDA_MEMCPY_DEVICE_TO_HOST</a>);</div>
<div class="line"><span class="lineno">  730</span>    <span class="keywordflow">if</span> (e != 0) {</div>
<div class="line"><span class="lineno">  731</span>      (void)api-&gt;<a class="code hl_variable" href="structcudart__api.html#a2c3660d016022d753aa36e57b5ed469c">cudaFree</a>(d);</div>
<div class="line"><span class="lineno">  732</span>      <span class="keywordflow">return</span> 4;</div>
<div class="line"><span class="lineno">  733</span>    }</div>
<div class="line"><span class="lineno">  734</span>    e = api-&gt;<a class="code hl_variable" href="structcudart__api.html#a8885e8aa343a956388d6fc359994b5b6">cudaDeviceSynchronize</a>();</div>
<div class="line"><span class="lineno">  735</span>    <span class="keywordflow">if</span> (e != 0) {</div>
<div class="line"><span class="lineno">  736</span>      (void)api-&gt;<a class="code hl_variable" href="structcudart__api.html#a2c3660d016022d753aa36e57b5ed469c">cudaFree</a>(d);</div>
<div class="line"><span class="lineno">  737</span>      <span class="keywordflow">return</span> 5;</div>
<div class="line"><span class="lineno">  738</span>    }</div>
<div class="line"><span class="lineno">  739</span>    (void)tmp;</div>
<div class="line"><span class="lineno">  740</span>  }</div>
<div class="line"><span class="lineno">  741</span> </div>
<div class="line"><span class="lineno">  742</span>  (void)api-&gt;<a class="code hl_variable" href="structcudart__api.html#a2c3660d016022d753aa36e57b5ed469c">cudaFree</a>(d);</div>
<div class="line"><span class="lineno">  743</span>  (void)api-&gt;<a class="code hl_variable" href="structcudart__api.html#a8885e8aa343a956388d6fc359994b5b6">cudaDeviceSynchronize</a>();</div>
<div class="line"><span class="lineno">  744</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  745</span>}</div>
<div class="ttc" id="amain__infer_8c_html_a42d8c2f3c8817b30177d0a7e39742b03"><div class="ttname"><a href="main__infer_8c.html#a42d8c2f3c8817b30177d0a7e39742b03">min_size</a></div><div class="ttdeci">static size_t min_size(size_t a, size_t b)</div><div class="ttdoc">Return the smaller of two size_t values.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00117">main_infer.c:117</a></div></div>
<div class="ttc" id="amain__infer_8c_html_a7056b1ed3833957f6045353293d33a10"><div class="ttname"><a href="main__infer_8c.html#a7056b1ed3833957f6045353293d33a10">cudart_err_t</a></div><div class="ttdeci">int cudart_err_t</div><div class="ttdoc">CUDA runtime error code type (opaque int for dynamic loading).</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00618">main_infer.c:618</a></div></div>
<div class="ttc" id="amain__infer_8c_html_a86d500a34c624c2cae56bc25a31b12f3"><div class="ttname"><a href="main__infer_8c.html#a86d500a34c624c2cae56bc25a31b12f3">UNUSED</a></div><div class="ttdeci">#define UNUSED(x)</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00085">main_infer.c:85</a></div></div>
<div class="ttc" id="amain__infer_8c_html_aca4f099fbc130845b4af6c57ca21b3ef"><div class="ttname"><a href="main__infer_8c.html#aca4f099fbc130845b4af6c57ca21b3ef">cudart_get_api</a></div><div class="ttdeci">static cudart_api_t * cudart_get_api(void)</div><div class="ttdoc">Load cudart symbols via dlopen/dlsym (lazy singleton).</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00655">main_infer.c:655</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="main__infer_8c_source.html#l00634">CUDA_MEMCPY_DEVICE_TO_HOST</a>, <a class="el" href="main__infer_8c_source.html#l00648">cudart_api::cudaDeviceSynchronize</a>, <a class="el" href="main__infer_8c_source.html#l00644">cudart_api::cudaFree</a>, <a class="el" href="main__infer_8c_source.html#l00645">cudart_api::cudaMalloc</a>, <a class="el" href="main__infer_8c_source.html#l00646">cudart_api::cudaMemcpy</a>, <a class="el" href="main__infer_8c_source.html#l00647">cudart_api::cudaMemset</a>, <a class="el" href="main__infer_8c_source.html#l00655">cudart_get_api()</a>, <a class="el" href="main__infer_8c_source.html#l00117">min_size()</a>, and <a class="el" href="main__infer_8c_source.html#l00085">UNUSED</a>.</p>

<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l02362">main()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a44a0de9d17f6eff8a4764537268ab5d1_cgraph.svg" width="327" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a44a0de9d17f6eff8a4764537268ab5d1_icgraph.svg" width="263" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a4e30eb4737647a78c4dbebb5b008a5bd" name="a4e30eb4737647a78c4dbebb5b008a5bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4e30eb4737647a78c4dbebb5b008a5bd">&#9670;&#160;</a></span>decode_tokens_best_effort()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int decode_tokens_best_effort </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>tok_path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int *&#160;</td>
          <td class="paramname"><em>ids</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>out_text</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Decode token IDs into UTF-8 text (best-effort). </p>
<p>This uses the project tokenizer implementation. If decoding fails or the tokenizer cannot be opened (including vocab mismatch scenarios), a placeholder string "&lt;id&gt;&lt;id&gt;..." is emitted so output remains valid and debuggable.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tok_path</td><td>Path to tokenizer file (tokenizer.json or tokenizer.tiktoken). </td></tr>
    <tr><td class="paramname">ids</td><td>Token IDs (engine output). </td></tr>
    <tr><td class="paramname">n</td><td>Number of IDs. </td></tr>
    <tr><td class="paramname">out_text</td><td>Output allocated string (caller frees). NULL on failure. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, nonzero on failure.</dd></dl>
<p>decode_tokens_best_effort.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tok_path</td><td>See implementation for details. </td></tr>
    <tr><td class="paramname">ids</td><td>See implementation for details. </td></tr>
    <tr><td class="paramname">n</td><td>See implementation for details. </td></tr>
    <tr><td class="paramname">out_text</td><td>See implementation for details.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>See implementation for details. </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00866">866</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  866</span>                                                                                                      {</div>
<div class="line"><span class="lineno">  867</span>  <span class="keywordflow">if</span> (!out_text) <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  868</span>  *out_text = NULL;</div>
<div class="line"><span class="lineno">  869</span> </div>
<div class="line"><span class="lineno">  870</span>  <span class="keywordflow">if</span> (!tok_path || !*tok_path) <span class="keywordflow">return</span> 2;</div>
<div class="line"><span class="lineno">  871</span> </div>
<div class="line"><span class="lineno">  872</span>  <span class="keywordflow">if</span> (!ids || n == 0) {</div>
<div class="line"><span class="lineno">  873</span>    <span class="keywordtype">char</span> *z = (<span class="keywordtype">char</span> *)malloc(1);</div>
<div class="line"><span class="lineno">  874</span>    <span class="keywordflow">if</span> (!z) <span class="keywordflow">return</span> 3;</div>
<div class="line"><span class="lineno">  875</span>    z[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  876</span>    *out_text = z;</div>
<div class="line"><span class="lineno">  877</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  878</span>  }</div>
<div class="line"><span class="lineno">  879</span> </div>
<div class="line"><span class="lineno">  880</span>  uint32_t *u32 = (uint32_t *)malloc(<span class="keyword">sizeof</span>(uint32_t) * n);</div>
<div class="line"><span class="lineno">  881</span>  <span class="keywordflow">if</span> (!u32) <span class="keywordflow">return</span> 4;</div>
<div class="line"><span class="lineno">  882</span> </div>
<div class="line"><span class="lineno">  883</span>  <span class="keywordtype">size_t</span> k = 0;</div>
<div class="line"><span class="lineno">  884</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; n; ++i) {</div>
<div class="line"><span class="lineno">  885</span>    <span class="keywordtype">int</span> v = ids[i];</div>
<div class="line"><span class="lineno">  886</span>    <span class="keywordflow">if</span> (v &lt; 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  887</span>    u32[k++] = (uint32_t)v;</div>
<div class="line"><span class="lineno">  888</span>  }</div>
<div class="line"><span class="lineno">  889</span> </div>
<div class="line"><span class="lineno">  890</span>  <span class="keywordflow">if</span> (k == 0) {</div>
<div class="line"><span class="lineno">  891</span>    free(u32);</div>
<div class="line"><span class="lineno">  892</span>    <span class="keywordtype">char</span> *z = (<span class="keywordtype">char</span> *)malloc(1);</div>
<div class="line"><span class="lineno">  893</span>    <span class="keywordflow">if</span> (!z) <span class="keywordflow">return</span> 5;</div>
<div class="line"><span class="lineno">  894</span>    z[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  895</span>    *out_text = z;</div>
<div class="line"><span class="lineno">  896</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  897</span>  }</div>
<div class="line"><span class="lineno">  898</span> </div>
<div class="line"><span class="lineno">  899</span>  <a class="code hl_struct" href="structie__tok__gptoss__s.html">ie_tok_gptoss_t</a> *tok = NULL;</div>
<div class="line"><span class="lineno">  900</span>  <span class="keywordtype">int</span> ts = <a class="code hl_function" href="ie__tokenizer__gptoss_8h.html#ae5c55dc1502414c60d1a99fa9fbdf1bc">ie_tok_gptoss_open</a>(tok_path, &amp;tok);</div>
<div class="line"><span class="lineno">  901</span>  <span class="keywordflow">if</span> (ts == <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a6e804d975236c9745c44c1db1baed259">IE_TOK_GPTOSS_OK</a> &amp;&amp; tok) {</div>
<div class="line"><span class="lineno">  902</span>    <span class="keywordtype">size_t</span> need = 0;</div>
<div class="line"><span class="lineno">  903</span>    ts = <a class="code hl_function" href="ie__tokenizer__gptoss_8h.html#ae372932b3912864351defd6ce553ed88">ie_tok_gptoss_decode</a>(tok, u32, (uint32_t)<a class="code hl_function" href="main__infer_8c.html#a42d8c2f3c8817b30177d0a7e39742b03">min_size</a>(k, (<span class="keywordtype">size_t</span>)0xFFFFFFFFu), NULL, &amp;need);</div>
<div class="line"><span class="lineno">  904</span>    <span class="keywordflow">if</span> (ts == <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a6e804d975236c9745c44c1db1baed259">IE_TOK_GPTOSS_OK</a> &amp;&amp; need &gt; 0) {</div>
<div class="line"><span class="lineno">  905</span>      <span class="keywordtype">char</span> *buf = (<span class="keywordtype">char</span> *)malloc(need);</div>
<div class="line"><span class="lineno">  906</span>      <span class="keywordflow">if</span> (!buf) {</div>
<div class="line"><span class="lineno">  907</span>        (void)<a class="code hl_function" href="ie__tokenizer__gptoss_8h.html#ad4b875bec514bb9c1de945944e1596de">ie_tok_gptoss_close</a>(tok);</div>
<div class="line"><span class="lineno">  908</span>        free(u32);</div>
<div class="line"><span class="lineno">  909</span>        <span class="keywordflow">return</span> 6;</div>
<div class="line"><span class="lineno">  910</span>      }</div>
<div class="line"><span class="lineno">  911</span>      <span class="keywordtype">size_t</span> outn = need;</div>
<div class="line"><span class="lineno">  912</span>      ts = <a class="code hl_function" href="ie__tokenizer__gptoss_8h.html#ae372932b3912864351defd6ce553ed88">ie_tok_gptoss_decode</a>(tok, u32, (uint32_t)<a class="code hl_function" href="main__infer_8c.html#a42d8c2f3c8817b30177d0a7e39742b03">min_size</a>(k, (<span class="keywordtype">size_t</span>)0xFFFFFFFFu), buf, &amp;outn);</div>
<div class="line"><span class="lineno">  913</span>      <span class="keywordflow">if</span> (ts == <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a6e804d975236c9745c44c1db1baed259">IE_TOK_GPTOSS_OK</a>) {</div>
<div class="line"><span class="lineno">  914</span>        *out_text = buf;</div>
<div class="line"><span class="lineno">  915</span>        (void)<a class="code hl_function" href="ie__tokenizer__gptoss_8h.html#ad4b875bec514bb9c1de945944e1596de">ie_tok_gptoss_close</a>(tok);</div>
<div class="line"><span class="lineno">  916</span>        free(u32);</div>
<div class="line"><span class="lineno">  917</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  918</span>      }</div>
<div class="line"><span class="lineno">  919</span>      free(buf);</div>
<div class="line"><span class="lineno">  920</span>    }</div>
<div class="line"><span class="lineno">  921</span>    (void)<a class="code hl_function" href="ie__tokenizer__gptoss_8h.html#ad4b875bec514bb9c1de945944e1596de">ie_tok_gptoss_close</a>(tok);</div>
<div class="line"><span class="lineno">  922</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  923</span>    fprintf(stderr,</div>
<div class="line"><span class="lineno">  924</span>            <span class="stringliteral">&quot;warn: tokenizer_open failed for &#39;%s&#39; (status=%d)%s\n&quot;</span>,</div>
<div class="line"><span class="lineno">  925</span>            tok_path,</div>
<div class="line"><span class="lineno">  926</span>            (<span class="keywordtype">int</span>)ts,</div>
<div class="line"><span class="lineno">  927</span>            <a class="code hl_function" href="main__infer_8c.html#a82ba5822565056bddf97d8b9d425d9b9">ends_with</a>(tok_path, <span class="stringliteral">&quot;.tiktoken&quot;</span>) ? <span class="stringliteral">&quot; (tiktoken decode may be unimplemented)&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno">  928</span>  }</div>
<div class="line"><span class="lineno">  929</span> </div>
<div class="line"><span class="lineno">  930</span>  <span class="comment">/* Fallback: emit placeholders so the output stays valid and debuggable. */</span></div>
<div class="line"><span class="lineno">  931</span>  {</div>
<div class="line"><span class="lineno">  932</span>    <span class="keywordtype">size_t</span> cap = 256;</div>
<div class="line"><span class="lineno">  933</span>    <span class="keywordtype">size_t</span> len = 0;</div>
<div class="line"><span class="lineno">  934</span>    <span class="keywordtype">char</span> *buf = (<span class="keywordtype">char</span> *)malloc(cap);</div>
<div class="line"><span class="lineno">  935</span>    <span class="keywordflow">if</span> (!buf) {</div>
<div class="line"><span class="lineno">  936</span>      free(u32);</div>
<div class="line"><span class="lineno">  937</span>      <span class="keywordflow">return</span> 7;</div>
<div class="line"><span class="lineno">  938</span>    }</div>
<div class="line"><span class="lineno">  939</span>    buf[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  940</span> </div>
<div class="line"><span class="lineno">  941</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; k; ++i) {</div>
<div class="line"><span class="lineno">  942</span>      <span class="keywordtype">char</span> tmp[64];</div>
<div class="line"><span class="lineno">  943</span>      (void)snprintf(tmp, <span class="keyword">sizeof</span>(tmp), <span class="stringliteral">&quot;&lt;%u&gt;&quot;</span>, (unsigned)u32[i]);</div>
<div class="line"><span class="lineno">  944</span>      <span class="keywordtype">size_t</span> add = strlen(tmp);</div>
<div class="line"><span class="lineno">  945</span> </div>
<div class="line"><span class="lineno">  946</span>      <span class="keywordflow">if</span> (len + add + 1 &gt; cap) {</div>
<div class="line"><span class="lineno">  947</span>        <span class="keywordtype">size_t</span> ncap = cap;</div>
<div class="line"><span class="lineno">  948</span>        <span class="keywordflow">while</span> (len + add + 1 &gt; ncap) ncap *= 2;</div>
<div class="line"><span class="lineno">  949</span>        <span class="keywordtype">char</span> *nb = (<span class="keywordtype">char</span> *)realloc(buf, ncap);</div>
<div class="line"><span class="lineno">  950</span>        <span class="keywordflow">if</span> (!nb) { free(buf); free(u32); <span class="keywordflow">return</span> 8; }</div>
<div class="line"><span class="lineno">  951</span>        buf = nb;</div>
<div class="line"><span class="lineno">  952</span>        cap = ncap;</div>
<div class="line"><span class="lineno">  953</span>      }</div>
<div class="line"><span class="lineno">  954</span> </div>
<div class="line"><span class="lineno">  955</span>      memcpy(buf + len, tmp, add);</div>
<div class="line"><span class="lineno">  956</span>      len += add;</div>
<div class="line"><span class="lineno">  957</span>      buf[len] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  958</span>    }</div>
<div class="line"><span class="lineno">  959</span> </div>
<div class="line"><span class="lineno">  960</span>    *out_text = buf;</div>
<div class="line"><span class="lineno">  961</span>  }</div>
<div class="line"><span class="lineno">  962</span> </div>
<div class="line"><span class="lineno">  963</span>  free(u32);</div>
<div class="line"><span class="lineno">  964</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  965</span>}</div>
<div class="ttc" id="aie__tokenizer__gptoss_8h_html_a1305696bd5b44e9ad4e2b624ce1b59f2a6e804d975236c9745c44c1db1baed259"><div class="ttname"><a href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a6e804d975236c9745c44c1db1baed259">IE_TOK_GPTOSS_OK</a></div><div class="ttdeci">@ IE_TOK_GPTOSS_OK</div><div class="ttdef"><b>Definition</b> <a href="ie__tokenizer__gptoss_8h_source.html#l00038">ie_tokenizer_gptoss.h:38</a></div></div>
<div class="ttc" id="aie__tokenizer__gptoss_8h_html_ad4b875bec514bb9c1de945944e1596de"><div class="ttname"><a href="ie__tokenizer__gptoss_8h.html#ad4b875bec514bb9c1de945944e1596de">ie_tok_gptoss_close</a></div><div class="ttdeci">void ie_tok_gptoss_close(ie_tok_gptoss_t *tok)</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l01795">tokenizer_gptoss.c:1795</a></div></div>
<div class="ttc" id="aie__tokenizer__gptoss_8h_html_ae372932b3912864351defd6ce553ed88"><div class="ttname"><a href="ie__tokenizer__gptoss_8h.html#ae372932b3912864351defd6ce553ed88">ie_tok_gptoss_decode</a></div><div class="ttdeci">int ie_tok_gptoss_decode(const ie_tok_gptoss_t *tok, const uint32_t *ids, uint32_t count, char *out, size_t *inout_bytes)</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l01818">tokenizer_gptoss.c:1818</a></div></div>
<div class="ttc" id="aie__tokenizer__gptoss_8h_html_ae5c55dc1502414c60d1a99fa9fbdf1bc"><div class="ttname"><a href="ie__tokenizer__gptoss_8h.html#ae5c55dc1502414c60d1a99fa9fbdf1bc">ie_tok_gptoss_open</a></div><div class="ttdeci">int ie_tok_gptoss_open(const char *tokenizer_path, ie_tok_gptoss_t **out_tok)</div><div class="ttdoc">Open a tokenizer from:</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l01761">tokenizer_gptoss.c:1761</a></div></div>
<div class="ttc" id="amain__infer_8c_html_a82ba5822565056bddf97d8b9d425d9b9"><div class="ttname"><a href="main__infer_8c.html#a82ba5822565056bddf97d8b9d425d9b9">ends_with</a></div><div class="ttdeci">static int ends_with(const char *s, const char *suf)</div><div class="ttdoc">Check if a string ends with a given suffix (case-sensitive).</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00472">main_infer.c:472</a></div></div>
<div class="ttc" id="astructie__tok__gptoss__s_html"><div class="ttname"><a href="structie__tok__gptoss__s.html">ie_tok_gptoss_s</a></div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l00794">tokenizer_gptoss.c:794</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="main__infer_8c_source.html#l00472">ends_with()</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l01795">ie_tok_gptoss_close()</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l01818">ie_tok_gptoss_decode()</a>, <a class="el" href="ie__tokenizer__gptoss_8h_source.html#l00038">IE_TOK_GPTOSS_OK</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l01761">ie_tok_gptoss_open()</a>, and <a class="el" href="main__infer_8c_source.html#l00117">min_size()</a>.</p>

<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l02362">main()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a4e30eb4737647a78c4dbebb5b008a5bd_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a4e30eb4737647a78c4dbebb5b008a5bd_icgraph.svg" width="268" height="51"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ae26c03bc6150b42f62a01df020935733" name="ae26c03bc6150b42f62a01df020935733"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae26c03bc6150b42f62a01df020935733">&#9670;&#160;</a></span>device_is_cpu()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int device_is_cpu </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>dev</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check whether device string selects CPU. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dev</td><td>Device label. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 if CPU, 0 otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l02352">2352</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2352</span>{ <span class="keywordflow">return</span> <a class="code hl_function" href="main__infer_8c.html#a72ab94aafe7740f1343d317daa89ca15">ascii_ieq</a>(dev, <span class="stringliteral">&quot;cpu&quot;</span>) ? 1 : 0; }</div>
<div class="ttc" id="amain__infer_8c_html_a72ab94aafe7740f1343d317daa89ca15"><div class="ttname"><a href="main__infer_8c.html#a72ab94aafe7740f1343d317daa89ca15">ascii_ieq</a></div><div class="ttdeci">static int ascii_ieq(const char *a, const char *b)</div><div class="ttdoc">Case-insensitive ASCII equality.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00166">main_infer.c:166</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="main__infer_8c_source.html#l00166">ascii_ieq()</a>.</p>

<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l02362">main()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_ae26c03bc6150b42f62a01df020935733_cgraph.svg" width="251" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_ae26c03bc6150b42f62a01df020935733_icgraph.svg" width="227" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a43b384fdf1f1e4cc7304e6164461af44" name="a43b384fdf1f1e4cc7304e6164461af44"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43b384fdf1f1e4cc7304e6164461af44">&#9670;&#160;</a></span>device_is_cuda()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int device_is_cuda </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>dev</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check whether device string selects CUDA. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dev</td><td>Device label. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 if CUDA, 0 otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l02345">2345</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2345</span>{ <span class="keywordflow">return</span> <a class="code hl_function" href="main__infer_8c.html#a72ab94aafe7740f1343d317daa89ca15">ascii_ieq</a>(dev, <span class="stringliteral">&quot;cuda&quot;</span>) ? 1 : 0; }</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="main__infer_8c_source.html#l00166">ascii_ieq()</a>.</p>

<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l02362">main()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a43b384fdf1f1e4cc7304e6164461af44_cgraph.svg" width="259" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a43b384fdf1f1e4cc7304e6164461af44_icgraph.svg" width="235" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a2392f4f2060045de53b484a90f85f15f" name="a2392f4f2060045de53b484a90f85f15f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2392f4f2060045de53b484a90f85f15f">&#9670;&#160;</a></span>dir_accessible()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int dir_accessible </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>p</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Determine whether a directory exists and is accessible (R_OK|X_OK). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p</td><td>Directory path. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 when accessible directory, 0 otherwise.</dd></dl>
<p>dir_accessible.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p</td><td>See implementation for details.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>See implementation for details. </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00245">245</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  245</span>                                         {</div>
<div class="line"><span class="lineno">  246</span>  <span class="keywordflow">if</span> (!p || !*p) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  247</span>  <span class="keyword">struct </span>stat st;</div>
<div class="line"><span class="lineno">  248</span>  <span class="keywordflow">if</span> (stat(p, &amp;st) != 0) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  249</span>  <span class="keywordflow">if</span> (!S_ISDIR(st.st_mode)) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  250</span>  <span class="keywordflow">return</span> (access(p, R_OK | X_OK) == 0);</div>
<div class="line"><span class="lineno">  251</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l02362">main()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a2392f4f2060045de53b484a90f85f15f_icgraph.svg" width="228" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a82ba5822565056bddf97d8b9d425d9b9" name="a82ba5822565056bddf97d8b9d425d9b9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a82ba5822565056bddf97d8b9d425d9b9">&#9670;&#160;</a></span>ends_with()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int ends_with </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>suf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check if a string ends with a given suffix (case-sensitive). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>String (may be NULL). </td></tr>
    <tr><td class="paramname">suf</td><td>Suffix (may be NULL). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 when s ends with suf, 0 otherwise.</dd></dl>
<p>ends_with.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>See implementation for details. </td></tr>
    <tr><td class="paramname">suf</td><td>See implementation for details.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>See implementation for details. </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00472">472</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  472</span>                                                     {</div>
<div class="line"><span class="lineno">  473</span>  <span class="keywordflow">if</span> (!s || !suf) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  474</span>  <span class="keyword">const</span> <span class="keywordtype">size_t</span> ns = strlen(s);</div>
<div class="line"><span class="lineno">  475</span>  <span class="keyword">const</span> <span class="keywordtype">size_t</span> nf = strlen(suf);</div>
<div class="line"><span class="lineno">  476</span>  <span class="keywordflow">if</span> (nf &gt; ns) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  477</span>  <span class="keywordflow">return</span> (memcmp(s + (ns - nf), suf, nf) == 0) ? 1 : 0;</div>
<div class="line"><span class="lineno">  478</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l00866">decode_tokens_best_effort()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a82ba5822565056bddf97d8b9d425d9b9_icgraph.svg" width="404" height="51"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a9675b1f5b8b73e24233f92cb11e31f6a" name="a9675b1f5b8b73e24233f92cb11e31f6a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9675b1f5b8b73e24233f92cb11e31f6a">&#9670;&#160;</a></span>env_long()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static long env_long </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>defv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Read a long integer from an environment variable with a default. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>Environment variable name. </td></tr>
    <tr><td class="paramname">defv</td><td>Default value when unset or invalid. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Parsed value or defv.</dd></dl>
<p>env_long.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>See implementation for details. </td></tr>
    <tr><td class="paramname">defv</td><td>See implementation for details.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>See implementation for details. </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00133">133</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  133</span>                                                  {</div>
<div class="line"><span class="lineno">  134</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *s = getenv(name);</div>
<div class="line"><span class="lineno">  135</span>  <span class="keywordflow">if</span> (!s || !*s) <span class="keywordflow">return</span> defv;</div>
<div class="line"><span class="lineno">  136</span>  <span class="keywordtype">char</span> *end = NULL;</div>
<div class="line"><span class="lineno">  137</span>  <span class="keywordtype">long</span> v = strtol(s, &amp;end, 10);</div>
<div class="line"><span class="lineno">  138</span>  <span class="keywordflow">return</span> (end &amp;&amp; *end == <span class="charliteral">&#39;\0&#39;</span>) ? v : defv;</div>
<div class="line"><span class="lineno">  139</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l02362">main()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a9675b1f5b8b73e24233f92cb11e31f6a_icgraph.svg" width="195" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a1da65df4642943745d356d6de2983f02" name="a1da65df4642943745d356d6de2983f02"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1da65df4642943745d356d6de2983f02">&#9670;&#160;</a></span>env_str()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static const char * env_str </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>defv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Read a string from an environment variable with a default. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>Environment variable name. </td></tr>
    <tr><td class="paramname">defv</td><td>Default string when unset or empty. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Environment value or defv. </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00147">147</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  147</span>                                                               {</div>
<div class="line"><span class="lineno">  148</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *s = getenv(name);</div>
<div class="line"><span class="lineno">  149</span>  <span class="keywordflow">return</span> (s &amp;&amp; *s) ? s : defv;</div>
<div class="line"><span class="lineno">  150</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l02362">main()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a1da65df4642943745d356d6de2983f02_icgraph.svg" width="184" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a3a307125ca4048deb177277c8e72bbfe" name="a3a307125ca4048deb177277c8e72bbfe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3a307125ca4048deb177277c8e72bbfe">&#9670;&#160;</a></span>expected_tokens_compare()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int expected_tokens_compare </td>
          <td>(</td>
          <td class="paramtype">const int *&#160;</td>
          <td class="paramname"><em>expected</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>n_expected</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int *&#160;</td>
          <td class="paramname"><em>actual</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>n_actual</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>mismatch_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>expected_at</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>actual_at</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Compare actual tokens against expected tokens for one prompt. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">expected</td><td>Expected token IDs. </td></tr>
    <tr><td class="paramname">n_expected</td><td>Number of expected tokens. </td></tr>
    <tr><td class="paramname">actual</td><td>Actual token IDs. </td></tr>
    <tr><td class="paramname">n_actual</td><td>Number of actual tokens. </td></tr>
    <tr><td class="paramname">mismatch_index</td><td>Output: first mismatch index (valid when return is nonzero). </td></tr>
    <tr><td class="paramname">expected_at</td><td>Output: expected token at mismatch (valid when return is nonzero). </td></tr>
    <tr><td class="paramname">actual_at</td><td>Output: actual token at mismatch (valid when return is nonzero). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 when equal (length and contents), nonzero otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l01832">1832</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1838</span>                                                   {</div>
<div class="line"><span class="lineno"> 1839</span>  <span class="keywordflow">if</span> (!expected || !actual) <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 1840</span>  <span class="keyword">const</span> <span class="keywordtype">size_t</span> n = (n_expected &lt; n_actual) ? n_expected : n_actual;</div>
<div class="line"><span class="lineno"> 1841</span> </div>
<div class="line"><span class="lineno"> 1842</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; n; ++i) {</div>
<div class="line"><span class="lineno"> 1843</span>    <span class="keywordflow">if</span> (expected[i] != actual[i]) {</div>
<div class="line"><span class="lineno"> 1844</span>      <span class="keywordflow">if</span> (mismatch_index) *mismatch_index = i;</div>
<div class="line"><span class="lineno"> 1845</span>      <span class="keywordflow">if</span> (expected_at) *expected_at = expected[i];</div>
<div class="line"><span class="lineno"> 1846</span>      <span class="keywordflow">if</span> (actual_at) *actual_at = actual[i];</div>
<div class="line"><span class="lineno"> 1847</span>      <span class="keywordflow">return</span> 2;</div>
<div class="line"><span class="lineno"> 1848</span>    }</div>
<div class="line"><span class="lineno"> 1849</span>  }</div>
<div class="line"><span class="lineno"> 1850</span> </div>
<div class="line"><span class="lineno"> 1851</span>  <span class="keywordflow">if</span> (n_expected != n_actual) {</div>
<div class="line"><span class="lineno"> 1852</span>    <span class="keywordflow">if</span> (mismatch_index) *mismatch_index = n;</div>
<div class="line"><span class="lineno"> 1853</span>    <span class="keywordflow">if</span> (expected_at) *expected_at = (n &lt; n_expected) ? expected[n] : 0;</div>
<div class="line"><span class="lineno"> 1854</span>    <span class="keywordflow">if</span> (actual_at) *actual_at = (n &lt; n_actual) ? actual[n] : 0;</div>
<div class="line"><span class="lineno"> 1855</span>    <span class="keywordflow">return</span> 3;</div>
<div class="line"><span class="lineno"> 1856</span>  }</div>
<div class="line"><span class="lineno"> 1857</span> </div>
<div class="line"><span class="lineno"> 1858</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1859</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l02362">main()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a3a307125ca4048deb177277c8e72bbfe_icgraph.svg" width="310" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a0b4d248d44b83ac2a6b5f47b47fe15df" name="a0b4d248d44b83ac2a6b5f47b47fe15df"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0b4d248d44b83ac2a6b5f47b47fe15df">&#9670;&#160;</a></span>expected_tokens_find()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static const <a class="el" href="main__infer_8c.html#ae3d72519a21dd8c22c60d86104a0c151">expected_tokens_entry_t</a> * expected_tokens_find </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="main__infer_8c.html#ac519a155900b9eda4cab9d3a9a74dd62">expected_tokens_table_t</a> *&#160;</td>
          <td class="paramname"><em>t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>prompt_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Find an expected entry by prompt ID. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">t</td><td>Table (may be NULL). </td></tr>
    <tr><td class="paramname">prompt_id</td><td>Prompt ID. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Pointer to entry or NULL when not found. </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l02006">2006</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2007</span>                                                                               {</div>
<div class="line"><span class="lineno"> 2008</span>  <span class="keywordflow">if</span> (!t || !t-&gt;<a class="code hl_variable" href="structexpected__tokens__table.html#a276e1939826f5ce628faaef8db9e126c">entries</a> || t-&gt;<a class="code hl_variable" href="structexpected__tokens__table.html#a4a94ac05263628a477831280444a57a4">count</a> == 0) <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno"> 2009</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; t-&gt;<a class="code hl_variable" href="structexpected__tokens__table.html#a4a94ac05263628a477831280444a57a4">count</a>; ++i) {</div>
<div class="line"><span class="lineno"> 2010</span>    <span class="keywordflow">if</span> (t-&gt;<a class="code hl_variable" href="structexpected__tokens__table.html#a276e1939826f5ce628faaef8db9e126c">entries</a>[i].<a class="code hl_variable" href="structexpected__tokens__entry.html#a916080ab2649c9f4d225ed57d4ee32f5">prompt_id</a> == prompt_id) <span class="keywordflow">return</span> &amp;t-&gt;<a class="code hl_variable" href="structexpected__tokens__table.html#a276e1939826f5ce628faaef8db9e126c">entries</a>[i];</div>
<div class="line"><span class="lineno"> 2011</span>  }</div>
<div class="line"><span class="lineno"> 2012</span>  <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno"> 2013</span>}</div>
<div class="ttc" id="astructexpected__tokens__entry_html_a916080ab2649c9f4d225ed57d4ee32f5"><div class="ttname"><a href="structexpected__tokens__entry.html#a916080ab2649c9f4d225ed57d4ee32f5">expected_tokens_entry::prompt_id</a></div><div class="ttdeci">uint64_t prompt_id</div><div class="ttdoc">Prompt ID (FNV-1a).</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01741">main_infer.c:1741</a></div></div>
<div class="ttc" id="astructexpected__tokens__table_html_a276e1939826f5ce628faaef8db9e126c"><div class="ttname"><a href="structexpected__tokens__table.html#a276e1939826f5ce628faaef8db9e126c">expected_tokens_table::entries</a></div><div class="ttdeci">expected_tokens_entry_t * entries</div><div class="ttdoc">Owned array of entries.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01750">main_infer.c:1750</a></div></div>
<div class="ttc" id="astructexpected__tokens__table_html_a4a94ac05263628a477831280444a57a4"><div class="ttname"><a href="structexpected__tokens__table.html#a4a94ac05263628a477831280444a57a4">expected_tokens_table::count</a></div><div class="ttdeci">size_t count</div><div class="ttdoc">Number of entries.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01751">main_infer.c:1751</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="main__infer_8c_source.html#l01751">expected_tokens_table::count</a>, <a class="el" href="main__infer_8c_source.html#l01750">expected_tokens_table::entries</a>, and <a class="el" href="main__infer_8c_source.html#l01741">expected_tokens_entry::prompt_id</a>.</p>

<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l02362">main()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a0b4d248d44b83ac2a6b5f47b47fe15df_icgraph.svg" width="276" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a470ca5b37dd720b5de391932c452af36" name="a470ca5b37dd720b5de391932c452af36"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a470ca5b37dd720b5de391932c452af36">&#9670;&#160;</a></span>expected_tokens_table_free()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void expected_tokens_table_free </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="main__infer_8c.html#ac519a155900b9eda4cab9d3a9a74dd62">expected_tokens_table_t</a> *&#160;</td>
          <td class="paramname"><em>t</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Free an expected-tokens table. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">t</td><td>Table.</td></tr>
  </table>
  </dd>
</dl>
<p>expected_tokens_table_free.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">t</td><td>See implementation for details. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l01780">1780</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1780</span>                                                                   {</div>
<div class="line"><span class="lineno"> 1781</span>  <span class="keywordflow">if</span> (!t) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1782</span>  <span class="keywordflow">if</span> (t-&gt;<a class="code hl_variable" href="structexpected__tokens__table.html#a276e1939826f5ce628faaef8db9e126c">entries</a>) {</div>
<div class="line"><span class="lineno"> 1783</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; t-&gt;<a class="code hl_variable" href="structexpected__tokens__table.html#a4a94ac05263628a477831280444a57a4">count</a>; ++i) free(t-&gt;<a class="code hl_variable" href="structexpected__tokens__table.html#a276e1939826f5ce628faaef8db9e126c">entries</a>[i].<a class="code hl_variable" href="structexpected__tokens__entry.html#a959f62b26acb1af16f22d85b55b0df78">tokens</a>);</div>
<div class="line"><span class="lineno"> 1784</span>    free(t-&gt;<a class="code hl_variable" href="structexpected__tokens__table.html#a276e1939826f5ce628faaef8db9e126c">entries</a>);</div>
<div class="line"><span class="lineno"> 1785</span>  }</div>
<div class="line"><span class="lineno"> 1786</span>  t-&gt;<a class="code hl_variable" href="structexpected__tokens__table.html#a276e1939826f5ce628faaef8db9e126c">entries</a> = NULL;</div>
<div class="line"><span class="lineno"> 1787</span>  t-&gt;<a class="code hl_variable" href="structexpected__tokens__table.html#a4a94ac05263628a477831280444a57a4">count</a> = 0;</div>
<div class="line"><span class="lineno"> 1788</span>  t-&gt;<a class="code hl_variable" href="structexpected__tokens__table.html#a5193e78a49adc7c59b61f0350048e886">cap</a> = 0;</div>
<div class="line"><span class="lineno"> 1789</span>}</div>
<div class="ttc" id="astructexpected__tokens__entry_html_a959f62b26acb1af16f22d85b55b0df78"><div class="ttname"><a href="structexpected__tokens__entry.html#a959f62b26acb1af16f22d85b55b0df78">expected_tokens_entry::tokens</a></div><div class="ttdeci">int * tokens</div><div class="ttdoc">Owned token array.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01742">main_infer.c:1742</a></div></div>
<div class="ttc" id="astructexpected__tokens__table_html_a5193e78a49adc7c59b61f0350048e886"><div class="ttname"><a href="structexpected__tokens__table.html#a5193e78a49adc7c59b61f0350048e886">expected_tokens_table::cap</a></div><div class="ttdeci">size_t cap</div><div class="ttdoc">Capacity of entries.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01752">main_infer.c:1752</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="main__infer_8c_source.html#l01752">expected_tokens_table::cap</a>, <a class="el" href="main__infer_8c_source.html#l01751">expected_tokens_table::count</a>, <a class="el" href="main__infer_8c_source.html#l01750">expected_tokens_table::entries</a>, and <a class="el" href="main__infer_8c_source.html#l01742">expected_tokens_entry::tokens</a>.</p>

<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l01944">expected_tokens_table_load()</a>, and <a class="el" href="main__infer_8c_source.html#l02362">main()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a470ca5b37dd720b5de391932c452af36_icgraph.svg" width="574" height="62"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a7170af3ba79ee074b29ac13736ec97bf" name="a7170af3ba79ee074b29ac13736ec97bf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7170af3ba79ee074b29ac13736ec97bf">&#9670;&#160;</a></span>expected_tokens_table_init()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void expected_tokens_table_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="main__infer_8c.html#ac519a155900b9eda4cab9d3a9a74dd62">expected_tokens_table_t</a> *&#160;</td>
          <td class="paramname"><em>t</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Initialize an expected-tokens table. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">t</td><td>Table.</td></tr>
  </table>
  </dd>
</dl>
<p>expected_tokens_table_init.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">t</td><td>See implementation for details. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l01764">1764</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1764</span>                                                                   {</div>
<div class="line"><span class="lineno"> 1765</span>  <span class="keywordflow">if</span> (!t) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1766</span>  t-&gt;<a class="code hl_variable" href="structexpected__tokens__table.html#a276e1939826f5ce628faaef8db9e126c">entries</a> = NULL;</div>
<div class="line"><span class="lineno"> 1767</span>  t-&gt;<a class="code hl_variable" href="structexpected__tokens__table.html#a4a94ac05263628a477831280444a57a4">count</a> = 0;</div>
<div class="line"><span class="lineno"> 1768</span>  t-&gt;<a class="code hl_variable" href="structexpected__tokens__table.html#a5193e78a49adc7c59b61f0350048e886">cap</a> = 0;</div>
<div class="line"><span class="lineno"> 1769</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="main__infer_8c_source.html#l01752">expected_tokens_table::cap</a>, <a class="el" href="main__infer_8c_source.html#l01751">expected_tokens_table::count</a>, and <a class="el" href="main__infer_8c_source.html#l01750">expected_tokens_table::entries</a>.</p>

<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l01944">expected_tokens_table_load()</a>, and <a class="el" href="main__infer_8c_source.html#l02362">main()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a7170af3ba79ee074b29ac13736ec97bf_icgraph.svg" width="568" height="62"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a84acee847ca644179eff86e6406bf230" name="a84acee847ca644179eff86e6406bf230"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a84acee847ca644179eff86e6406bf230">&#9670;&#160;</a></span>expected_tokens_table_load()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int expected_tokens_table_load </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="main__infer_8c.html#ac519a155900b9eda4cab9d3a9a74dd62">expected_tokens_table_t</a> *&#160;</td>
          <td class="paramname"><em>out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Load expected tokens from a text file. </p>
<p>File format (one entry per line):</p><ul>
<li>Leading/trailing whitespace is allowed.</li>
<li>Empty lines and lines beginning with '#' are ignored.</li>
<li>Each entry is: &lt;prompt_id&gt; &lt;whitespace&gt; &lt;token0,token1,token2,...&gt;</li>
</ul>
<p>prompt_id can be decimal or 0x-prefixed hex. The prompt_id is the FNV-1a hash of the prompt bytes, as returned by <a class="el" href="main__infer_8c.html#ad7f42b712b3e86af5d9f8c9942bc8875">prompt_id_fnv1a64</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">path</td><td>Expected tokens file path. </td></tr>
    <tr><td class="paramname">out</td><td>Output table (initialized by this function). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, nonzero on failure.</dd></dl>
<p>expected_tokens_table_load.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">path</td><td>See implementation for details. </td></tr>
    <tr><td class="paramname">out</td><td>See implementation for details.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>See implementation for details. </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l01944">1944</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1944</span>                                                                                      {</div>
<div class="line"><span class="lineno"> 1945</span>  <span class="keywordflow">if</span> (!path || !*path || !out) <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 1946</span> </div>
<div class="line"><span class="lineno"> 1947</span>  <a class="code hl_function" href="main__infer_8c.html#a7170af3ba79ee074b29ac13736ec97bf">expected_tokens_table_init</a>(out);</div>
<div class="line"><span class="lineno"> 1948</span> </div>
<div class="line"><span class="lineno"> 1949</span>  FILE *f = fopen(path, <span class="stringliteral">&quot;r&quot;</span>);</div>
<div class="line"><span class="lineno"> 1950</span>  <span class="keywordflow">if</span> (!f) {</div>
<div class="line"><span class="lineno"> 1951</span>    fprintf(stderr, <span class="stringliteral">&quot;warn: cannot open expected tokens file &#39;%s&#39;: %s\n&quot;</span>, path, strerror(errno));</div>
<div class="line"><span class="lineno"> 1952</span>    <span class="keywordflow">return</span> 2;</div>
<div class="line"><span class="lineno"> 1953</span>  }</div>
<div class="line"><span class="lineno"> 1954</span> </div>
<div class="line"><span class="lineno"> 1955</span>  <span class="keywordtype">char</span> line[65536];</div>
<div class="line"><span class="lineno"> 1956</span>  <span class="keywordtype">int</span> rc = 0;</div>
<div class="line"><span class="lineno"> 1957</span> </div>
<div class="line"><span class="lineno"> 1958</span>  <span class="keywordflow">while</span> (fgets(line, (<span class="keywordtype">int</span>)<span class="keyword">sizeof</span>(line), f)) {</div>
<div class="line"><span class="lineno"> 1959</span>    <span class="keywordtype">char</span> *p = line;</div>
<div class="line"><span class="lineno"> 1960</span>    <span class="keywordflow">while</span> (*p == <span class="charliteral">&#39; &#39;</span> || *p == <span class="charliteral">&#39;\t&#39;</span>) ++p;</div>
<div class="line"><span class="lineno"> 1961</span>    <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;\0&#39;</span> || *p == <span class="charliteral">&#39;\r&#39;</span> || *p == <span class="charliteral">&#39;\n&#39;</span> || *p == <span class="charliteral">&#39;#&#39;</span>) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1962</span> </div>
<div class="line"><span class="lineno"> 1963</span>    <span class="comment">/* Split at first whitespace. */</span></div>
<div class="line"><span class="lineno"> 1964</span>    <span class="keywordtype">char</span> *q = p;</div>
<div class="line"><span class="lineno"> 1965</span>    <span class="keywordflow">while</span> (*q &amp;&amp; *q != <span class="charliteral">&#39; &#39;</span> &amp;&amp; *q != <span class="charliteral">&#39;\t&#39;</span> &amp;&amp; *q != <span class="charliteral">&#39;\r&#39;</span> &amp;&amp; *q != <span class="charliteral">&#39;\n&#39;</span>) ++q;</div>
<div class="line"><span class="lineno"> 1966</span>    <span class="keywordflow">if</span> (*q == <span class="charliteral">&#39;\0&#39;</span>) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1967</span>    *q++ = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 1968</span> </div>
<div class="line"><span class="lineno"> 1969</span>    uint64_t pid = 0;</div>
<div class="line"><span class="lineno"> 1970</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#a2749355bb9d419963e15e9a58395f63e">parse_u64_auto</a>(p, &amp;pid) != 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1971</span> </div>
<div class="line"><span class="lineno"> 1972</span>    <span class="keywordflow">while</span> (*q == <span class="charliteral">&#39; &#39;</span> || *q == <span class="charliteral">&#39;\t&#39;</span>) ++q;</div>
<div class="line"><span class="lineno"> 1973</span>    <span class="keywordflow">if</span> (*q == <span class="charliteral">&#39;\0&#39;</span> || *q == <span class="charliteral">&#39;\r&#39;</span> || *q == <span class="charliteral">&#39;\n&#39;</span>) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1974</span> </div>
<div class="line"><span class="lineno"> 1975</span>    <span class="comment">/* Trim CR/LF. */</span></div>
<div class="line"><span class="lineno"> 1976</span>    <span class="keywordtype">size_t</span> n = strlen(q);</div>
<div class="line"><span class="lineno"> 1977</span>    <span class="keywordflow">while</span> (n &amp;&amp; (q[n - 1] == <span class="charliteral">&#39;\n&#39;</span> || q[n - 1] == <span class="charliteral">&#39;\r&#39;</span>)) q[--n] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 1978</span>    <span class="keywordflow">if</span> (n == 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1979</span> </div>
<div class="line"><span class="lineno"> 1980</span>    <span class="keywordtype">int</span> *tok = NULL;</div>
<div class="line"><span class="lineno"> 1981</span>    <span class="keywordtype">size_t</span> ntok = 0;</div>
<div class="line"><span class="lineno"> 1982</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#adaa53124eb0654f14346cf02af06b891">parse_token_list_inplace</a>(q, &amp;tok, &amp;ntok) != 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1983</span> </div>
<div class="line"><span class="lineno"> 1984</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#adc35a14cb1b2caeca261416dfa41edee">expected_tokens_table_push</a>(out, pid, tok, ntok) != 0) {</div>
<div class="line"><span class="lineno"> 1985</span>      free(tok);</div>
<div class="line"><span class="lineno"> 1986</span>      rc = 3;</div>
<div class="line"><span class="lineno"> 1987</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1988</span>    }</div>
<div class="line"><span class="lineno"> 1989</span>  }</div>
<div class="line"><span class="lineno"> 1990</span> </div>
<div class="line"><span class="lineno"> 1991</span>  (void)fclose(f);</div>
<div class="line"><span class="lineno"> 1992</span> </div>
<div class="line"><span class="lineno"> 1993</span>  <span class="keywordflow">if</span> (rc != 0) {</div>
<div class="line"><span class="lineno"> 1994</span>    <a class="code hl_function" href="main__infer_8c.html#a470ca5b37dd720b5de391932c452af36">expected_tokens_table_free</a>(out);</div>
<div class="line"><span class="lineno"> 1995</span>    <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno"> 1996</span>  }</div>
<div class="line"><span class="lineno"> 1997</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1998</span>}</div>
<div class="ttc" id="amain__infer_8c_html_a2749355bb9d419963e15e9a58395f63e"><div class="ttname"><a href="main__infer_8c.html#a2749355bb9d419963e15e9a58395f63e">parse_u64_auto</a></div><div class="ttdeci">static int parse_u64_auto(const char *s, uint64_t *out)</div><div class="ttdoc">Parse an unsigned 64-bit integer in decimal or 0x-prefixed hex.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01719">main_infer.c:1719</a></div></div>
<div class="ttc" id="amain__infer_8c_html_a470ca5b37dd720b5de391932c452af36"><div class="ttname"><a href="main__infer_8c.html#a470ca5b37dd720b5de391932c452af36">expected_tokens_table_free</a></div><div class="ttdeci">static void expected_tokens_table_free(expected_tokens_table_t *t)</div><div class="ttdoc">Free an expected-tokens table.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01780">main_infer.c:1780</a></div></div>
<div class="ttc" id="amain__infer_8c_html_a7170af3ba79ee074b29ac13736ec97bf"><div class="ttname"><a href="main__infer_8c.html#a7170af3ba79ee074b29ac13736ec97bf">expected_tokens_table_init</a></div><div class="ttdeci">static void expected_tokens_table_init(expected_tokens_table_t *t)</div><div class="ttdoc">Initialize an expected-tokens table.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01764">main_infer.c:1764</a></div></div>
<div class="ttc" id="amain__infer_8c_html_adaa53124eb0654f14346cf02af06b891"><div class="ttname"><a href="main__infer_8c.html#adaa53124eb0654f14346cf02af06b891">parse_token_list_inplace</a></div><div class="ttdeci">static int parse_token_list_inplace(char *s, int **out_tokens, size_t *out_n)</div><div class="ttdoc">Parse a comma-separated list of integers.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01877">main_infer.c:1877</a></div></div>
<div class="ttc" id="amain__infer_8c_html_adc35a14cb1b2caeca261416dfa41edee"><div class="ttname"><a href="main__infer_8c.html#adc35a14cb1b2caeca261416dfa41edee">expected_tokens_table_push</a></div><div class="ttdeci">static int expected_tokens_table_push(expected_tokens_table_t *t, uint64_t prompt_id, int *tokens, size_t n_tokens)</div><div class="ttdoc">Append an entry to the expected-tokens table.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01799">main_infer.c:1799</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="main__infer_8c_source.html#l01780">expected_tokens_table_free()</a>, <a class="el" href="main__infer_8c_source.html#l01764">expected_tokens_table_init()</a>, <a class="el" href="main__infer_8c_source.html#l01799">expected_tokens_table_push()</a>, <a class="el" href="main__infer_8c_source.html#l01877">parse_token_list_inplace()</a>, and <a class="el" href="main__infer_8c_source.html#l01719">parse_u64_auto()</a>.</p>

<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l02362">main()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a84acee847ca644179eff86e6406bf230_cgraph.svg" width="476" height="234"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a84acee847ca644179eff86e6406bf230_icgraph.svg" width="320" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="adc35a14cb1b2caeca261416dfa41edee" name="adc35a14cb1b2caeca261416dfa41edee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adc35a14cb1b2caeca261416dfa41edee">&#9670;&#160;</a></span>expected_tokens_table_push()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int expected_tokens_table_push </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="main__infer_8c.html#ac519a155900b9eda4cab9d3a9a74dd62">expected_tokens_table_t</a> *&#160;</td>
          <td class="paramname"><em>t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>prompt_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>tokens</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>n_tokens</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Append an entry to the expected-tokens table. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">t</td><td>Table. </td></tr>
    <tr><td class="paramname">prompt_id</td><td>Prompt ID. </td></tr>
    <tr><td class="paramname">tokens</td><td>Owned token array (moved). </td></tr>
    <tr><td class="paramname">n_tokens</td><td>Number of tokens. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, nonzero on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l01799">1799</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1802</span>                                                       {</div>
<div class="line"><span class="lineno"> 1803</span>  <span class="keywordflow">if</span> (!t || !tokens || n_tokens == 0) <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 1804</span> </div>
<div class="line"><span class="lineno"> 1805</span>  <span class="keywordflow">if</span> (t-&gt;<a class="code hl_variable" href="structexpected__tokens__table.html#a4a94ac05263628a477831280444a57a4">count</a> == t-&gt;<a class="code hl_variable" href="structexpected__tokens__table.html#a5193e78a49adc7c59b61f0350048e886">cap</a>) {</div>
<div class="line"><span class="lineno"> 1806</span>    <span class="keywordtype">size_t</span> ncap = (t-&gt;<a class="code hl_variable" href="structexpected__tokens__table.html#a5193e78a49adc7c59b61f0350048e886">cap</a> == 0) ? 16 : (t-&gt;cap * 2);</div>
<div class="line"><span class="lineno"> 1807</span>    <a class="code hl_struct" href="structexpected__tokens__entry.html">expected_tokens_entry_t</a> *ne = (<a class="code hl_struct" href="structexpected__tokens__entry.html">expected_tokens_entry_t</a> *)realloc(t-&gt;<a class="code hl_variable" href="structexpected__tokens__table.html#a276e1939826f5ce628faaef8db9e126c">entries</a>, ncap * <span class="keyword">sizeof</span>(*ne));</div>
<div class="line"><span class="lineno"> 1808</span>    <span class="keywordflow">if</span> (!ne) <span class="keywordflow">return</span> 2;</div>
<div class="line"><span class="lineno"> 1809</span>    t-&gt;<a class="code hl_variable" href="structexpected__tokens__table.html#a276e1939826f5ce628faaef8db9e126c">entries</a> = ne;</div>
<div class="line"><span class="lineno"> 1810</span>    t-&gt;<a class="code hl_variable" href="structexpected__tokens__table.html#a5193e78a49adc7c59b61f0350048e886">cap</a> = ncap;</div>
<div class="line"><span class="lineno"> 1811</span>  }</div>
<div class="line"><span class="lineno"> 1812</span> </div>
<div class="line"><span class="lineno"> 1813</span>  t-&gt;<a class="code hl_variable" href="structexpected__tokens__table.html#a276e1939826f5ce628faaef8db9e126c">entries</a>[t-&gt;<a class="code hl_variable" href="structexpected__tokens__table.html#a4a94ac05263628a477831280444a57a4">count</a>].<a class="code hl_variable" href="structexpected__tokens__entry.html#a916080ab2649c9f4d225ed57d4ee32f5">prompt_id</a> = prompt_id;</div>
<div class="line"><span class="lineno"> 1814</span>  t-&gt;<a class="code hl_variable" href="structexpected__tokens__table.html#a276e1939826f5ce628faaef8db9e126c">entries</a>[t-&gt;<a class="code hl_variable" href="structexpected__tokens__table.html#a4a94ac05263628a477831280444a57a4">count</a>].<a class="code hl_variable" href="structexpected__tokens__entry.html#a959f62b26acb1af16f22d85b55b0df78">tokens</a> = tokens;</div>
<div class="line"><span class="lineno"> 1815</span>  t-&gt;<a class="code hl_variable" href="structexpected__tokens__table.html#a276e1939826f5ce628faaef8db9e126c">entries</a>[t-&gt;<a class="code hl_variable" href="structexpected__tokens__table.html#a4a94ac05263628a477831280444a57a4">count</a>].<a class="code hl_variable" href="structexpected__tokens__entry.html#adbef90e357d95fb8c8658ef20993593f">n_tokens</a> = n_tokens;</div>
<div class="line"><span class="lineno"> 1816</span>  t-&gt;<a class="code hl_variable" href="structexpected__tokens__table.html#a4a94ac05263628a477831280444a57a4">count</a>++;</div>
<div class="line"><span class="lineno"> 1817</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1818</span>}</div>
<div class="ttc" id="astructexpected__tokens__entry_html"><div class="ttname"><a href="structexpected__tokens__entry.html">expected_tokens_entry</a></div><div class="ttdoc">An entry in the expected-tokens table.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01740">main_infer.c:1740</a></div></div>
<div class="ttc" id="astructexpected__tokens__entry_html_adbef90e357d95fb8c8658ef20993593f"><div class="ttname"><a href="structexpected__tokens__entry.html#adbef90e357d95fb8c8658ef20993593f">expected_tokens_entry::n_tokens</a></div><div class="ttdeci">size_t n_tokens</div><div class="ttdoc">Number of tokens in tokens.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01743">main_infer.c:1743</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="main__infer_8c_source.html#l01752">expected_tokens_table::cap</a>, <a class="el" href="main__infer_8c_source.html#l01751">expected_tokens_table::count</a>, <a class="el" href="main__infer_8c_source.html#l01750">expected_tokens_table::entries</a>, <a class="el" href="main__infer_8c_source.html#l01743">expected_tokens_entry::n_tokens</a>, <a class="el" href="main__infer_8c_source.html#l01741">expected_tokens_entry::prompt_id</a>, and <a class="el" href="main__infer_8c_source.html#l01742">expected_tokens_entry::tokens</a>.</p>

<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l01944">expected_tokens_table_load()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_adc35a14cb1b2caeca261416dfa41edee_icgraph.svg" width="579" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a39103ce72021a890c3e333b949068a1c" name="a39103ce72021a890c3e333b949068a1c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a39103ce72021a890c3e333b949068a1c">&#9670;&#160;</a></span>heap_strdup()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static char * heap_strdup </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>s</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Heap-duplicate a string (portable replacement for strdup). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>Input string (may be NULL). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Newly allocated copy, or NULL. </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00449">449</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  449</span>                                        {</div>
<div class="line"><span class="lineno">  450</span>  <span class="keywordflow">if</span> (!s) <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  451</span>  <span class="keyword">const</span> <span class="keywordtype">size_t</span> n = strlen(s) + 1;</div>
<div class="line"><span class="lineno">  452</span>  <span class="keywordtype">char</span> *p = (<span class="keywordtype">char</span> *)malloc(n);</div>
<div class="line"><span class="lineno">  453</span>  <span class="keywordflow">if</span> (!p) <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  454</span>  memcpy(p, s, n);</div>
<div class="line"><span class="lineno">  455</span>  <span class="keywordflow">return</span> p;</div>
<div class="line"><span class="lineno">  456</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l02362">main()</a>, and <a class="el" href="main__infer_8c_source.html#l01606">prompt_list_push_copy()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a39103ce72021a890c3e333b949068a1c_icgraph.svg" width="643" height="112"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a937426768611822fbe840722069c7043" name="a937426768611822fbe840722069c7043"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a937426768611822fbe840722069c7043">&#9670;&#160;</a></span>is_int4_precision()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int is_int4_precision </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>p</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Determine if precision string requests int4 family. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p</td><td>Precision label. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 if "int4*" else 0.</dd></dl>
<p>is_int4_precision.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p</td><td>See implementation for details.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>See implementation for details. </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00359">359</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  359</span>                                            {</div>
<div class="line"><span class="lineno">  360</span>  <span class="keywordflow">if</span> (!p || !*p) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  361</span>  <span class="keywordflow">return</span> <a class="code hl_function" href="main__infer_8c.html#a55469391e7680b876a48cdc0d3d24632">starts_with</a>(p, <span class="stringliteral">&quot;int4&quot;</span>) ? 1 : 0;</div>
<div class="line"><span class="lineno">  362</span>}</div>
<div class="ttc" id="amain__infer_8c_html_a55469391e7680b876a48cdc0d3d24632"><div class="ttname"><a href="main__infer_8c.html#a55469391e7680b876a48cdc0d3d24632">starts_with</a></div><div class="ttdeci">static int starts_with(const char *s, const char *prefix)</div><div class="ttdoc">Check whether a string begins with a given prefix (case-sensitive).</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00192">main_infer.c:192</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="main__infer_8c_source.html#l00192">starts_with()</a>.</p>

<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l00378">resolve_model_paths()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a937426768611822fbe840722069c7043_cgraph.svg" width="284" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a937426768611822fbe840722069c7043_icgraph.svg" width="454" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="adca9b33a342b8635e28ba51aecb365f6" name="adca9b33a342b8635e28ba51aecb365f6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adca9b33a342b8635e28ba51aecb365f6">&#9670;&#160;</a></span>join_path()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void join_path </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>outsz</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>leaf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Join directory and filename into a single path. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">out</td><td>Output buffer. </td></tr>
    <tr><td class="paramname">outsz</td><td>Output capacity. </td></tr>
    <tr><td class="paramname">dir</td><td>Directory component (may be NULL/empty). </td></tr>
    <tr><td class="paramname">leaf</td><td>Leaf component (must be non-NULL).</td></tr>
  </table>
  </dd>
</dl>
<p>join_path.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">out</td><td>See implementation for details. </td></tr>
    <tr><td class="paramname">outsz</td><td>See implementation for details. </td></tr>
    <tr><td class="paramname">dir</td><td>See implementation for details. </td></tr>
    <tr><td class="paramname">leaf</td><td>See implementation for details. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00297">297</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  297</span>                                                                                  {</div>
<div class="line"><span class="lineno">  298</span>  <span class="keywordflow">if</span> (!out || outsz == 0) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  299</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  300</span>  <span class="keywordflow">if</span> (!leaf) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  301</span> </div>
<div class="line"><span class="lineno">  302</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#a35a9aadd511e6b3688d01a67a12c7651">path_is_abs</a>(leaf)) {</div>
<div class="line"><span class="lineno">  303</span>    <a class="code hl_function" href="main__infer_8c.html#a210133797f21fcee710ec892841dce42">safe_strcpy</a>(out, outsz, leaf);</div>
<div class="line"><span class="lineno">  304</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  305</span>  }</div>
<div class="line"><span class="lineno">  306</span>  <span class="keywordflow">if</span> (!dir || !*dir) {</div>
<div class="line"><span class="lineno">  307</span>    <a class="code hl_function" href="main__infer_8c.html#a210133797f21fcee710ec892841dce42">safe_strcpy</a>(out, outsz, leaf);</div>
<div class="line"><span class="lineno">  308</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  309</span>  }</div>
<div class="line"><span class="lineno">  310</span> </div>
<div class="line"><span class="lineno">  311</span>  <span class="keyword">const</span> <span class="keywordtype">size_t</span> n = strlen(dir);</div>
<div class="line"><span class="lineno">  312</span>  <span class="keywordflow">if</span> (n &gt; 0 &amp;&amp; dir[n - 1] == <span class="charliteral">&#39;/&#39;</span>) (void)snprintf(out, outsz, <span class="stringliteral">&quot;%s%s&quot;</span>, dir, leaf);</div>
<div class="line"><span class="lineno">  313</span>  <span class="keywordflow">else</span> (<span class="keywordtype">void</span>)snprintf(out, outsz, <span class="stringliteral">&quot;%s/%s&quot;</span>, dir, leaf);</div>
<div class="line"><span class="lineno">  314</span>}</div>
<div class="ttc" id="amain__infer_8c_html_a35a9aadd511e6b3688d01a67a12c7651"><div class="ttname"><a href="main__infer_8c.html#a35a9aadd511e6b3688d01a67a12c7651">path_is_abs</a></div><div class="ttdeci">static int path_is_abs(const char *p)</div><div class="ttdoc">Check if a path is absolute (POSIX).</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00258">main_infer.c:258</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="main__infer_8c_source.html#l00258">path_is_abs()</a>, and <a class="el" href="main__infer_8c_source.html#l00273">safe_strcpy()</a>.</p>

<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l00378">resolve_model_paths()</a>, and <a class="el" href="main__infer_8c_source.html#l00810">resolve_tokenizer_path()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_adca9b33a342b8635e28ba51aecb365f6_cgraph.svg" width="240" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_adca9b33a342b8635e28ba51aecb365f6_icgraph.svg" width="418" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a7427a4a1579fb747a4ce22a4a1d4a80a" name="a7427a4a1579fb747a4ce22a4a1d4a80a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7427a4a1579fb747a4ce22a4a1d4a80a">&#9670;&#160;</a></span>json_print_escaped_string()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void json_print_escaped_string </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>s</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>JSON-escape and print a string value. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>Input UTF-8 string (may be NULL).</td></tr>
  </table>
  </dd>
</dl>
<p>json_print_escaped_string.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>See implementation for details. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00761">761</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  761</span>                                                     {</div>
<div class="line"><span class="lineno">  762</span>  fputc(<span class="charliteral">&#39;&quot;&#39;</span>, stdout);</div>
<div class="line"><span class="lineno">  763</span>  <span class="keywordflow">if</span> (!s) {</div>
<div class="line"><span class="lineno">  764</span>    fputc(<span class="charliteral">&#39;&quot;&#39;</span>, stdout);</div>
<div class="line"><span class="lineno">  765</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  766</span>  }</div>
<div class="line"><span class="lineno">  767</span> </div>
<div class="line"><span class="lineno">  768</span>  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *p = (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)s;</div>
<div class="line"><span class="lineno">  769</span>  <span class="keywordflow">while</span> (*p) {</div>
<div class="line"><span class="lineno">  770</span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> c = *p++;</div>
<div class="line"><span class="lineno">  771</span>    <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;\\&#39;</span>) fputs(<span class="stringliteral">&quot;\\\\&quot;</span>, stdout);</div>
<div class="line"><span class="lineno">  772</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;&quot;&#39;</span>) fputs(<span class="stringliteral">&quot;\\\&quot;&quot;</span>, stdout);</div>
<div class="line"><span class="lineno">  773</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;\n&#39;</span>) fputs(<span class="stringliteral">&quot;\\n&quot;</span>, stdout);</div>
<div class="line"><span class="lineno">  774</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;\r&#39;</span>) fputs(<span class="stringliteral">&quot;\\r&quot;</span>, stdout);</div>
<div class="line"><span class="lineno">  775</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;\t&#39;</span>) fputs(<span class="stringliteral">&quot;\\t&quot;</span>, stdout);</div>
<div class="line"><span class="lineno">  776</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c &lt; 0x20u) {</div>
<div class="line"><span class="lineno">  777</span>      fprintf(stdout, <span class="stringliteral">&quot;\\u%04x&quot;</span>, (<span class="keywordtype">unsigned</span>)c);</div>
<div class="line"><span class="lineno">  778</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  779</span>      fputc((<span class="keywordtype">int</span>)c, stdout);</div>
<div class="line"><span class="lineno">  780</span>    }</div>
<div class="line"><span class="lineno">  781</span>  }</div>
<div class="line"><span class="lineno">  782</span>  fputc(<span class="charliteral">&#39;&quot;&#39;</span>, stdout);</div>
<div class="line"><span class="lineno">  783</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l02171">print_json_result()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a7427a4a1579fb747a4ce22a4a1d4a80a_icgraph.svg" width="439" height="51"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a9205188606b8d4265d29fa8911259cac" name="a9205188606b8d4265d29fa8911259cac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9205188606b8d4265d29fa8911259cac">&#9670;&#160;</a></span>json_print_int_array()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void json_print_int_array </td>
          <td>(</td>
          <td class="paramtype">const int *&#160;</td>
          <td class="paramname"><em>ids</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Print a JSON array of integers. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ids</td><td>Token IDs (may be NULL). </td></tr>
    <tr><td class="paramname">n</td><td>Token count.</td></tr>
  </table>
  </dd>
</dl>
<p>json_print_int_array.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ids</td><td>See implementation for details. </td></tr>
    <tr><td class="paramname">n</td><td>See implementation for details. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l02131">2131</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2131</span>                                                           {</div>
<div class="line"><span class="lineno"> 2132</span>  fputc(<span class="charliteral">&#39;[&#39;</span>, stdout);</div>
<div class="line"><span class="lineno"> 2133</span>  <span class="keywordflow">if</span> (ids &amp;&amp; n) {</div>
<div class="line"><span class="lineno"> 2134</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; n; ++i) {</div>
<div class="line"><span class="lineno"> 2135</span>      fprintf(stdout, <span class="stringliteral">&quot;%d%s&quot;</span>, ids[i], (i + 1 &lt; n) ? <span class="stringliteral">&quot;,&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno"> 2136</span>    }</div>
<div class="line"><span class="lineno"> 2137</span>  }</div>
<div class="line"><span class="lineno"> 2138</span>  fputc(<span class="charliteral">&#39;]&#39;</span>, stdout);</div>
<div class="line"><span class="lineno"> 2139</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l02171">print_json_result()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a9205188606b8d4265d29fa8911259cac_icgraph.svg" width="443" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a3c04138a5bfe5d72780bb7e82a18e627" name="a3c04138a5bfe5d72780bb7e82a18e627"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c04138a5bfe5d72780bb7e82a18e627">&#9670;&#160;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>argv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>main. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">argc</td><td>See implementation for details. </td></tr>
    <tr><td class="paramname">argv</td><td>See implementation for details.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>See implementation for details. </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l02362">2362</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2362</span>                                {</div>
<div class="line"><span class="lineno"> 2363</span>  <a class="code hl_struct" href="structcli__extras.html">cli_extras_t</a> opt;</div>
<div class="line"><span class="lineno"> 2364</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#a456ba954f3884bcf5f72fc3e779de284">parse_flags</a>(argc, argv, &amp;opt) != 0) <span class="keywordflow">return</span> 2;</div>
<div class="line"><span class="lineno"> 2365</span> </div>
<div class="line"><span class="lineno"> 2366</span>  <span class="comment">/* Apply deterministic/debug knobs early (before engine creation). */</span></div>
<div class="line"><span class="lineno"> 2367</span>  <a class="code hl_function" href="main__infer_8c.html#ac50de02cf90e21f66e0681932f39334f">apply_cli_debug_env</a>(&amp;opt);</div>
<div class="line"><span class="lineno"> 2368</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *trace_path_env = getenv(<span class="stringliteral">&quot;IE_TRACE_IDS_JSONL&quot;</span>);</div>
<div class="line"><span class="lineno"> 2369</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> trace_ids_enabled = (trace_path_env &amp;&amp; *trace_path_env) ? 1 : 0;</div>
<div class="line"><span class="lineno"> 2370</span> </div>
<div class="line"><span class="lineno"> 2371</span>  <span class="comment">/* Allow env override for print-text without breaking harness defaults. */</span></div>
<div class="line"><span class="lineno"> 2372</span>  <span class="keywordflow">if</span> (!opt.<a class="code hl_variable" href="structcli__extras.html#a553c6e455b22c4ff3cd6f00beb166eb7">print_text</a>) opt.<a class="code hl_variable" href="structcli__extras.html#a553c6e455b22c4ff3cd6f00beb166eb7">print_text</a> = (int)<a class="code hl_function" href="main__infer_8c.html#a9675b1f5b8b73e24233f92cb11e31f6a">env_long</a>(<span class="stringliteral">&quot;IE_PRINT_TEXT&quot;</span>, 0);</div>
<div class="line"><span class="lineno"> 2373</span> </div>
<div class="line"><span class="lineno"> 2374</span>  <span class="keywordflow">if</span> (!opt.<a class="code hl_variable" href="structcli__extras.html#a50cd2ee771a9eee3fd448d2a1c0b5645">device</a> || !*opt.<a class="code hl_variable" href="structcli__extras.html#a50cd2ee771a9eee3fd448d2a1c0b5645">device</a> || <a class="code hl_function" href="main__infer_8c.html#a72ab94aafe7740f1343d317daa89ca15">ascii_ieq</a>(opt.<a class="code hl_variable" href="structcli__extras.html#a50cd2ee771a9eee3fd448d2a1c0b5645">device</a>, <span class="stringliteral">&quot;auto&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 2375</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *d = getenv(<span class="stringliteral">&quot;DEVICE&quot;</span>);</div>
<div class="line"><span class="lineno"> 2376</span>    <span class="keywordflow">if</span> (!d || !*d) d = getenv(<span class="stringliteral">&quot;IE_DEVICE&quot;</span>);</div>
<div class="line"><span class="lineno"> 2377</span>    <span class="keywordflow">if</span> (d &amp;&amp; *d) opt.<a class="code hl_variable" href="structcli__extras.html#a50cd2ee771a9eee3fd448d2a1c0b5645">device</a> = d;</div>
<div class="line"><span class="lineno"> 2378</span>  }</div>
<div class="line"><span class="lineno"> 2379</span> </div>
<div class="line"><span class="lineno"> 2380</span>  <span class="keywordflow">if</span> (!opt.<a class="code hl_variable" href="structcli__extras.html#a49d7c958a59c223a1f66d6aedc796e68">precision_from_flag</a>) {</div>
<div class="line"><span class="lineno"> 2381</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *envp = <a class="code hl_function" href="main__infer_8c.html#a1da65df4642943745d356d6de2983f02">env_str</a>(<span class="stringliteral">&quot;IE_PRECISION&quot;</span>, <a class="code hl_function" href="main__infer_8c.html#a1da65df4642943745d356d6de2983f02">env_str</a>(<span class="stringliteral">&quot;PRECISION&quot;</span>, IE_PREC_FP32));</div>
<div class="line"><span class="lineno"> 2382</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#a72ab94aafe7740f1343d317daa89ca15">ascii_ieq</a>(envp, IE_PREC_INT4W)) opt.<a class="code hl_variable" href="structcli__extras.html#a061a8ed1f6671ad018d99db180df06c2">precision_label</a> = IE_PREC_INT4W;</div>
<div class="line"><span class="lineno"> 2383</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#a72ab94aafe7740f1343d317daa89ca15">ascii_ieq</a>(envp, IE_PREC_INT4)) opt.<a class="code hl_variable" href="structcli__extras.html#a061a8ed1f6671ad018d99db180df06c2">precision_label</a> = IE_PREC_INT4;</div>
<div class="line"><span class="lineno"> 2384</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#a72ab94aafe7740f1343d317daa89ca15">ascii_ieq</a>(envp, IE_PREC_INT8W)) opt.<a class="code hl_variable" href="structcli__extras.html#a061a8ed1f6671ad018d99db180df06c2">precision_label</a> = IE_PREC_INT8W;</div>
<div class="line"><span class="lineno"> 2385</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#a72ab94aafe7740f1343d317daa89ca15">ascii_ieq</a>(envp, IE_PREC_BF16)) opt.<a class="code hl_variable" href="structcli__extras.html#a061a8ed1f6671ad018d99db180df06c2">precision_label</a> = IE_PREC_BF16;</div>
<div class="line"><span class="lineno"> 2386</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#a72ab94aafe7740f1343d317daa89ca15">ascii_ieq</a>(envp, IE_PREC_FP16)) opt.<a class="code hl_variable" href="structcli__extras.html#a061a8ed1f6671ad018d99db180df06c2">precision_label</a> = IE_PREC_FP16;</div>
<div class="line"><span class="lineno"> 2387</span>    <span class="keywordflow">else</span> opt.<a class="code hl_variable" href="structcli__extras.html#a061a8ed1f6671ad018d99db180df06c2">precision_label</a> = IE_PREC_FP32;</div>
<div class="line"><span class="lineno"> 2388</span>  }</div>
<div class="line"><span class="lineno"> 2389</span> </div>
<div class="line"><span class="lineno"> 2390</span>  <span class="keywordflow">if</span> (!opt.<a class="code hl_variable" href="structcli__extras.html#aeac7b5044a46ca251e3414887e1e712e">sparsity_from_flag</a>) {</div>
<div class="line"><span class="lineno"> 2391</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *envs = <a class="code hl_function" href="main__infer_8c.html#a1da65df4642943745d356d6de2983f02">env_str</a>(<span class="stringliteral">&quot;IE_SPARSITY&quot;</span>, <a class="code hl_function" href="main__infer_8c.html#a1da65df4642943745d356d6de2983f02">env_str</a>(<span class="stringliteral">&quot;SPARSITY&quot;</span>, <span class="stringliteral">&quot;none&quot;</span>));</div>
<div class="line"><span class="lineno"> 2392</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#a72ab94aafe7740f1343d317daa89ca15">ascii_ieq</a>(envs, <span class="stringliteral">&quot;block&quot;</span>) || <a class="code hl_function" href="main__infer_8c.html#a72ab94aafe7740f1343d317daa89ca15">ascii_ieq</a>(envs, <span class="stringliteral">&quot;blocksparse&quot;</span>)) opt.<a class="code hl_variable" href="structcli__extras.html#af5f02b3c69e6a0e4882a5427db0ab994">sparsity</a> = <span class="stringliteral">&quot;block&quot;</span>;</div>
<div class="line"><span class="lineno"> 2393</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#a72ab94aafe7740f1343d317daa89ca15">ascii_ieq</a>(envs, <span class="stringliteral">&quot;auto&quot;</span>)) opt.<a class="code hl_variable" href="structcli__extras.html#af5f02b3c69e6a0e4882a5427db0ab994">sparsity</a> = <span class="stringliteral">&quot;auto&quot;</span>;</div>
<div class="line"><span class="lineno"> 2394</span>    <span class="keywordflow">else</span> opt.<a class="code hl_variable" href="structcli__extras.html#af5f02b3c69e6a0e4882a5427db0ab994">sparsity</a> = <span class="stringliteral">&quot;none&quot;</span>;</div>
<div class="line"><span class="lineno"> 2395</span>  }</div>
<div class="line"><span class="lineno"> 2396</span> </div>
<div class="line"><span class="lineno"> 2397</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *model_dir_eff = opt.<a class="code hl_variable" href="structcli__extras.html#aa52e671b92aa5a9099153b609a0c5792">model_dir</a>;</div>
<div class="line"><span class="lineno"> 2398</span>  <span class="keywordflow">if</span> (!model_dir_eff || !*model_dir_eff) model_dir_eff = getenv(<span class="stringliteral">&quot;MODEL_DIR&quot;</span>);</div>
<div class="line"><span class="lineno"> 2399</span>  <span class="keywordflow">if</span> (!model_dir_eff || !*model_dir_eff) model_dir_eff = getenv(<span class="stringliteral">&quot;IE_MODEL_DIR&quot;</span>);</div>
<div class="line"><span class="lineno"> 2400</span> </div>
<div class="line"><span class="lineno"> 2401</span>  <span class="keywordflow">if</span> (!model_dir_eff || !*model_dir_eff) {</div>
<div class="line"><span class="lineno"> 2402</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#a0cbea455e9868581360f43c63db6554c">path_exists</a>(<span class="stringliteral">&quot;models/gpt-oss-20b/model.ie.json&quot;</span>) ||</div>
<div class="line"><span class="lineno"> 2403</span>        <a class="code hl_function" href="main__infer_8c.html#a0cbea455e9868581360f43c63db6554c">path_exists</a>(<span class="stringliteral">&quot;models/gpt-oss-20b/model.ie.bin&quot;</span>) ||</div>
<div class="line"><span class="lineno"> 2404</span>        <a class="code hl_function" href="main__infer_8c.html#a0cbea455e9868581360f43c63db6554c">path_exists</a>(<span class="stringliteral">&quot;models/gpt-oss-20b/model.ie.compat.json&quot;</span>) ||</div>
<div class="line"><span class="lineno"> 2405</span>        <a class="code hl_function" href="main__infer_8c.html#a0cbea455e9868581360f43c63db6554c">path_exists</a>(<span class="stringliteral">&quot;models/gpt-oss-20b/model.q4.bin&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 2406</span>      model_dir_eff = <span class="stringliteral">&quot;models/gpt-oss-20b&quot;</span>;</div>
<div class="line"><span class="lineno"> 2407</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 2408</span>      model_dir_eff = <span class="stringliteral">&quot;.&quot;</span>;</div>
<div class="line"><span class="lineno"> 2409</span>    }</div>
<div class="line"><span class="lineno"> 2410</span>  }</div>
<div class="line"><span class="lineno"> 2411</span> </div>
<div class="line"><span class="lineno"> 2412</span>  <span class="keywordflow">if</span> (opt.<a class="code hl_variable" href="structcli__extras.html#aa52e671b92aa5a9099153b609a0c5792">model_dir</a> &amp;&amp; *opt.<a class="code hl_variable" href="structcli__extras.html#aa52e671b92aa5a9099153b609a0c5792">model_dir</a>) {</div>
<div class="line"><span class="lineno"> 2413</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="main__infer_8c.html#a2392f4f2060045de53b484a90f85f15f">dir_accessible</a>(opt.<a class="code hl_variable" href="structcli__extras.html#aa52e671b92aa5a9099153b609a0c5792">model_dir</a>)) {</div>
<div class="line"><span class="lineno"> 2414</span>      fprintf(stderr, <span class="stringliteral">&quot;error: --model-dir &#39;%s&#39; is not accessible: %s\n&quot;</span>, opt.<a class="code hl_variable" href="structcli__extras.html#aa52e671b92aa5a9099153b609a0c5792">model_dir</a>, strerror(errno));</div>
<div class="line"><span class="lineno"> 2415</span>      <a class="code hl_function" href="main__infer_8c.html#a84b40472513bc66398c6d3049891f553">print_json_result</a>(0, NULL, 0.0, 0.0, 0.0, 0, 0, 0, NULL, NULL, opt.<a class="code hl_variable" href="structcli__extras.html#a3b9c2202e0ba68aa4b3112779697a28e">expected_tokens_file</a>, NULL, 1, NULL);</div>
<div class="line"><span class="lineno"> 2416</span>      <span class="keywordflow">return</span> 3;</div>
<div class="line"><span class="lineno"> 2417</span>    }</div>
<div class="line"><span class="lineno"> 2418</span>  }</div>
<div class="line"><span class="lineno"> 2419</span> </div>
<div class="line"><span class="lineno"> 2420</span>  <span class="keywordtype">char</span> json_path[<a class="code hl_define" href="main__infer_8c.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>];</div>
<div class="line"><span class="lineno"> 2421</span>  <span class="keywordtype">char</span> bin_path[<a class="code hl_define" href="main__infer_8c.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>];</div>
<div class="line"><span class="lineno"> 2422</span>  <a class="code hl_function" href="main__infer_8c.html#ad6b894571e18a35f21d8451e008fae37">resolve_model_paths</a>(model_dir_eff,</div>
<div class="line"><span class="lineno"> 2423</span>                      opt.<a class="code hl_variable" href="structcli__extras.html#a96d26a6a2f436fb0b232d383f321c3e6">model_json</a>,</div>
<div class="line"><span class="lineno"> 2424</span>                      opt.<a class="code hl_variable" href="structcli__extras.html#ae2401ceced12a603aabefd22f57584bd">model_bin</a>,</div>
<div class="line"><span class="lineno"> 2425</span>                      opt.<a class="code hl_variable" href="structcli__extras.html#a061a8ed1f6671ad018d99db180df06c2">precision_label</a>,</div>
<div class="line"><span class="lineno"> 2426</span>                      json_path, <span class="keyword">sizeof</span>(json_path),</div>
<div class="line"><span class="lineno"> 2427</span>                      bin_path, <span class="keyword">sizeof</span>(bin_path));</div>
<div class="line"><span class="lineno"> 2428</span> </div>
<div class="line"><span class="lineno"> 2429</span>  <span class="comment">/* When a prompts file is provided and no explicit prompt is set, default to aggregate mode. */</span></div>
<div class="line"><span class="lineno"> 2430</span>  <span class="keywordflow">if</span> (opt.<a class="code hl_variable" href="structcli__extras.html#a992ba8185b17f227f60e2e570441b63f">prompts_file</a> &amp;&amp; *opt.<a class="code hl_variable" href="structcli__extras.html#a992ba8185b17f227f60e2e570441b63f">prompts_file</a> &amp;&amp; !opt.<a class="code hl_variable" href="structcli__extras.html#aa45c7376781454d767d2202800c27a3e">prompt</a>) opt.<a class="code hl_variable" href="structcli__extras.html#a4e233e0c7d76b4fb4338d7460a552707">aggregate</a> = 1;</div>
<div class="line"><span class="lineno"> 2431</span> </div>
<div class="line"><span class="lineno"> 2432</span>  <span class="keywordflow">if</span> (!opt.<a class="code hl_variable" href="structcli__extras.html#aa45c7376781454d767d2202800c27a3e">prompt</a> &amp;&amp; !opt.<a class="code hl_variable" href="structcli__extras.html#a992ba8185b17f227f60e2e570441b63f">prompts_file</a>) {</div>
<div class="line"><span class="lineno"> 2433</span>    <a class="code hl_function" href="main__infer_8c.html#a84b40472513bc66398c6d3049891f553">print_json_result</a>(0, NULL, 0.0, 0.0, 0.0, 0, 0, 0, NULL, NULL, opt.<a class="code hl_variable" href="structcli__extras.html#a3b9c2202e0ba68aa4b3112779697a28e">expected_tokens_file</a>, NULL, 1, NULL);</div>
<div class="line"><span class="lineno"> 2434</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 2435</span>  }</div>
<div class="line"><span class="lineno"> 2436</span> </div>
<div class="line"><span class="lineno"> 2437</span>  <span class="comment">/* Resolve tokenizer path once (CLI + engine should use the same choice). */</span></div>
<div class="line"><span class="lineno"> 2438</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *tok_env = <a class="code hl_function" href="main__infer_8c.html#a1da65df4642943745d356d6de2983f02">env_str</a>(<span class="stringliteral">&quot;IE_TOKENIZER&quot;</span>, <a class="code hl_function" href="main__infer_8c.html#a1da65df4642943745d356d6de2983f02">env_str</a>(<span class="stringliteral">&quot;TOKENIZER&quot;</span>, <span class="stringliteral">&quot;&quot;</span>));</div>
<div class="line"><span class="lineno"> 2439</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *tok_opt = (opt.<a class="code hl_variable" href="structcli__extras.html#af46939020f3ada099f4c932676dec6b7">tokenizer_path</a> &amp;&amp; *opt.<a class="code hl_variable" href="structcli__extras.html#af46939020f3ada099f4c932676dec6b7">tokenizer_path</a>) ? opt.<a class="code hl_variable" href="structcli__extras.html#af46939020f3ada099f4c932676dec6b7">tokenizer_path</a></div>
<div class="line"><span class="lineno"> 2440</span>                                                                    : ((tok_env &amp;&amp; *tok_env) ? tok_env : NULL);</div>
<div class="line"><span class="lineno"> 2441</span> </div>
<div class="line"><span class="lineno"> 2442</span>  <span class="keywordtype">char</span> tok_path_buf[<a class="code hl_define" href="main__infer_8c.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>];</div>
<div class="line"><span class="lineno"> 2443</span>  tok_path_buf[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 2444</span>  <a class="code hl_function" href="main__infer_8c.html#a0271a21f39c53534b7a1a3cc7eb94596">resolve_tokenizer_path</a>(model_dir_eff, tok_opt, tok_path_buf, <span class="keyword">sizeof</span>(tok_path_buf));</div>
<div class="line"><span class="lineno"> 2445</span> </div>
<div class="line"><span class="lineno"> 2446</span>  <span class="keywordtype">char</span> *tokenizer_path_heap = NULL;</div>
<div class="line"><span class="lineno"> 2447</span>  <span class="keywordflow">if</span> (tok_path_buf[0]) tokenizer_path_heap = <a class="code hl_function" href="main__infer_8c.html#a39103ce72021a890c3e333b949068a1c">heap_strdup</a>(tok_path_buf);</div>
<div class="line"><span class="lineno"> 2448</span> </div>
<div class="line"><span class="lineno"> 2449</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> require_model = (int)<a class="code hl_function" href="main__infer_8c.html#a9675b1f5b8b73e24233f92cb11e31f6a">env_long</a>(<span class="stringliteral">&quot;IE_REQUIRE_MODEL&quot;</span>, 0);</div>
<div class="line"><span class="lineno"> 2450</span> </div>
<div class="line"><span class="lineno"> 2451</span>  <a class="code hl_struct" href="structie__weights__s.html">ie_weights_t</a> w;</div>
<div class="line"><span class="lineno"> 2452</span>  memset(&amp;w, 0, <span class="keyword">sizeof</span>(w));</div>
<div class="line"><span class="lineno"> 2453</span>  <span class="keywordtype">int</span> wrc = <a class="code hl_function" href="ie__io_8h.html#a522dac028ee37aae1307ffdb6d65ec1d">ie_weights_open</a>(json_path, bin_path, &amp;w);</div>
<div class="line"><span class="lineno"> 2454</span>  <span class="keywordflow">if</span> (wrc != <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>) {</div>
<div class="line"><span class="lineno"> 2455</span>    <span class="keywordflow">if</span> (require_model) {</div>
<div class="line"><span class="lineno"> 2456</span>      fprintf(stderr,</div>
<div class="line"><span class="lineno"> 2457</span>              <span class="stringliteral">&quot;error: failed to open model (%s, %s), status=%d, errno=%d (%s)\n&quot;</span>,</div>
<div class="line"><span class="lineno"> 2458</span>              json_path, bin_path, wrc, errno, strerror(errno));</div>
<div class="line"><span class="lineno"> 2459</span>      <a class="code hl_function" href="main__infer_8c.html#a84b40472513bc66398c6d3049891f553">print_json_result</a>(0, NULL, 0.0, 0.0, 0.0, 0, 0, 0, NULL, tokenizer_path_heap, opt.<a class="code hl_variable" href="structcli__extras.html#a3b9c2202e0ba68aa4b3112779697a28e">expected_tokens_file</a>, NULL, 1, NULL);</div>
<div class="line"><span class="lineno"> 2460</span>      free(tokenizer_path_heap);</div>
<div class="line"><span class="lineno"> 2461</span>      <span class="keywordflow">return</span> 3;</div>
<div class="line"><span class="lineno"> 2462</span>    }</div>
<div class="line"><span class="lineno"> 2463</span>    fprintf(stderr, <span class="stringliteral">&quot;warn: model metadata not found; stub JSON output\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 2464</span>    <a class="code hl_function" href="main__infer_8c.html#a84b40472513bc66398c6d3049891f553">print_json_result</a>(0, NULL, 0.0, 0.0, 0.0, 0, 0, 0, NULL, tokenizer_path_heap, opt.<a class="code hl_variable" href="structcli__extras.html#a3b9c2202e0ba68aa4b3112779697a28e">expected_tokens_file</a>, NULL, 1, NULL);</div>
<div class="line"><span class="lineno"> 2465</span>    free(tokenizer_path_heap);</div>
<div class="line"><span class="lineno"> 2466</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 2467</span>  }</div>
<div class="line"><span class="lineno"> 2468</span> </div>
<div class="line"><span class="lineno"> 2469</span>  <a class="code hl_struct" href="structie__engine__params.html">ie_engine_params_t</a> params;</div>
<div class="line"><span class="lineno"> 2470</span>  memset(&amp;params, 0, <span class="keyword">sizeof</span>(params));</div>
<div class="line"><span class="lineno"> 2471</span>  params.<a class="code hl_variable" href="structie__engine__params.html#a92b02bad12cb4e8173728311c00960b7">precision</a> = opt.<a class="code hl_variable" href="structcli__extras.html#a061a8ed1f6671ad018d99db180df06c2">precision_label</a>;</div>
<div class="line"><span class="lineno"> 2472</span>  params.<a class="code hl_variable" href="structie__engine__params.html#a66599574f8a4b8ed7cd7132fc1c0e051">affinity</a> = opt.<a class="code hl_variable" href="structcli__extras.html#a313d0562dfb63a6350db5c84128fc074">affinity</a>;</div>
<div class="line"><span class="lineno"> 2473</span>  params.<a class="code hl_variable" href="structie__engine__params.html#a992270ba61612b2acb319aed5cbfca13">pretranspose</a> = (opt.<a class="code hl_variable" href="structcli__extras.html#a648dda8436ede182650f29f0460fa6a3">pretx</a> == <a class="code hl_enumvalue" href="main__infer_8c.html#ae715f0cc745f58eebd4be50b187dd41da382ceb68dddaaf8b27ac21f144305e74">CLI_PRETX_NONE</a> ? <span class="stringliteral">&quot;none&quot;</span> :</div>
<div class="line"><span class="lineno"> 2474</span>                         (opt.<a class="code hl_variable" href="structcli__extras.html#a648dda8436ede182650f29f0460fa6a3">pretx</a> == <a class="code hl_enumvalue" href="main__infer_8c.html#ae715f0cc745f58eebd4be50b187dd41da9d22d4f265254a65af9fc3a7d648fe5d">CLI_PRETX_WOH</a> ? <span class="stringliteral">&quot;woh&quot;</span> :</div>
<div class="line"><span class="lineno"> 2475</span>                          (opt.<a class="code hl_variable" href="structcli__extras.html#a648dda8436ede182650f29f0460fa6a3">pretx</a> == <a class="code hl_enumvalue" href="main__infer_8c.html#ae715f0cc745f58eebd4be50b187dd41da1a251ee24fdcadcaf9c888e0a96140e7">CLI_PRETX_WXH</a> ? <span class="stringliteral">&quot;wxh&quot;</span> : <span class="stringliteral">&quot;all&quot;</span>)));</div>
<div class="line"><span class="lineno"> 2476</span>  params.<a class="code hl_variable" href="structie__engine__params.html#a34f965300425f8c1115b2408a4adc04a">prefetch</a> = opt.<a class="code hl_variable" href="structcli__extras.html#a01be4e3c92d754527967d04b729e4ee6">prefetch</a>;</div>
<div class="line"><span class="lineno"> 2477</span>  params.<a class="code hl_variable" href="structie__engine__params.html#a0c0b5f7588c98d30e0d2535790f6f24c">threads</a> = opt.<a class="code hl_variable" href="structcli__extras.html#a4e8cdca32127b81f8fcb41047a320844">threads</a>;</div>
<div class="line"><span class="lineno"> 2478</span>  params.<a class="code hl_variable" href="structie__engine__params.html#a1dff4c9644aa8bf7e389f84426c529e1">sparsity</a> = opt.<a class="code hl_variable" href="structcli__extras.html#af5f02b3c69e6a0e4882a5427db0ab994">sparsity</a>;</div>
<div class="line"><span class="lineno"> 2479</span> </div>
<div class="line"><span class="lineno"> 2480</span>  <span class="comment">/* Unified tokenizer choice: engine should follow the same resolution as the CLI. */</span></div>
<div class="line"><span class="lineno"> 2481</span>  params.<a class="code hl_variable" href="structie__engine__params.html#a16a831d93768c1a6d392163596de8277">tokenizer_path</a> = tokenizer_path_heap;</div>
<div class="line"><span class="lineno"> 2482</span> </div>
<div class="line"><span class="lineno"> 2483</span>  <a class="code hl_struct" href="structie__engine.html">ie_engine_t</a> *engine = NULL;</div>
<div class="line"><span class="lineno"> 2484</span>  <a class="code hl_typedef" href="ie__api_8h.html#a14516a42606ffcc6fafaf4eba282c808">ie_status_t</a> st = <a class="code hl_function" href="ie__api_8h.html#a84bd87043352946e9d53b0f8a5c4abe0">ie_engine_create</a>(&amp;params, opt.<a class="code hl_variable" href="structcli__extras.html#a50cd2ee771a9eee3fd448d2a1c0b5645">device</a>, model_dir_eff, &amp;engine);</div>
<div class="line"><span class="lineno"> 2485</span>  <span class="keywordflow">if</span> (st != <a class="code hl_enumvalue" href="ie__api_8h.html#aad1f6716972d7c4560daae2edb134d6aad0e6665e4f13d22e40740ef4ab91d56e">IE_OK</a> || !engine) {</div>
<div class="line"><span class="lineno"> 2486</span>    fprintf(stderr, <span class="stringliteral">&quot;error: ie_engine_create failed (status=%d)\n&quot;</span>, (<span class="keywordtype">int</span>)st);</div>
<div class="line"><span class="lineno"> 2487</span>    <a class="code hl_function" href="ie__io_8h.html#a06c2b7e35d1f82a11e4605e23a1976f5">ie_weights_close</a>(&amp;w);</div>
<div class="line"><span class="lineno"> 2488</span>    <a class="code hl_function" href="main__infer_8c.html#a84b40472513bc66398c6d3049891f553">print_json_result</a>(0, NULL, 0.0, 0.0, 0.0, 0, 0, 0, NULL, tokenizer_path_heap, opt.<a class="code hl_variable" href="structcli__extras.html#a3b9c2202e0ba68aa4b3112779697a28e">expected_tokens_file</a>, NULL, 1, NULL);</div>
<div class="line"><span class="lineno"> 2489</span>    free(tokenizer_path_heap);</div>
<div class="line"><span class="lineno"> 2490</span>    <span class="keywordflow">return</span> 5;</div>
<div class="line"><span class="lineno"> 2491</span>  }</div>
<div class="line"><span class="lineno"> 2492</span> </div>
<div class="line"><span class="lineno"> 2493</span>  <span class="keywordflow">if</span> (opt.<a class="code hl_variable" href="structcli__extras.html#a628bf363ee35fe852bbb6510455647bd">warmup_tokens</a> &gt; 0) {</div>
<div class="line"><span class="lineno"> 2494</span>    <span class="keywordflow">if</span> (trace_ids_enabled) {</div>
<div class="line"><span class="lineno"> 2495</span>      (void)unsetenv(<span class="stringliteral">&quot;IE_TRACE_PROMPT_INDEX&quot;</span>);</div>
<div class="line"><span class="lineno"> 2496</span>    }</div>
<div class="line"><span class="lineno"> 2497</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *wprompt = <span class="stringliteral">&quot;warmup&quot;</span>;</div>
<div class="line"><span class="lineno"> 2498</span>    <span class="keywordtype">int</span> wtoks[128];</div>
<div class="line"><span class="lineno"> 2499</span>    <span class="keywordtype">size_t</span> wcount = 0;</div>
<div class="line"><span class="lineno"> 2500</span>    <span class="keywordtype">size_t</span> wmax = (opt.<a class="code hl_variable" href="structcli__extras.html#a628bf363ee35fe852bbb6510455647bd">warmup_tokens</a> &lt;= (int)(<span class="keyword">sizeof</span>(wtoks) / <span class="keyword">sizeof</span>(wtoks[0])))</div>
<div class="line"><span class="lineno"> 2501</span>                      ? (<span class="keywordtype">size_t</span>)opt.<a class="code hl_variable" href="structcli__extras.html#a628bf363ee35fe852bbb6510455647bd">warmup_tokens</a></div>
<div class="line"><span class="lineno"> 2502</span>                      : (<span class="keyword">sizeof</span>(wtoks) / <span class="keyword">sizeof</span>(wtoks[0]));</div>
<div class="line"><span class="lineno"> 2503</span>    (void)<a class="code hl_function" href="ie__api_8h.html#ad32cf2cd209832e4cd577a5a1e31970f">ie_engine_generate</a>(engine, wprompt, wmax, wtoks, &amp;wcount);</div>
<div class="line"><span class="lineno"> 2504</span>  }</div>
<div class="line"><span class="lineno"> 2505</span> </div>
<div class="line"><span class="lineno"> 2506</span>  <span class="keyword">const</span> <span class="keywordtype">size_t</span> cap = (opt.<a class="code hl_variable" href="structcli__extras.html#a5eb0317aa09b90f400b657245b41e92c">max_new</a> &gt; 0 ? opt.<a class="code hl_variable" href="structcli__extras.html#a5eb0317aa09b90f400b657245b41e92c">max_new</a> : 0);</div>
<div class="line"><span class="lineno"> 2507</span>  <span class="keyword">const</span> <span class="keywordtype">size_t</span> cap_alloc = (cap &gt; 0 ? cap : 1);</div>
<div class="line"><span class="lineno"> 2508</span>  <span class="keywordtype">int</span> *tokens = (<span class="keywordtype">int</span> *)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * cap_alloc);</div>
<div class="line"><span class="lineno"> 2509</span>  <span class="keywordflow">if</span> (!tokens) {</div>
<div class="line"><span class="lineno"> 2510</span>    fprintf(stderr, <span class="stringliteral">&quot;error: OOM allocating token buffer\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 2511</span>    <a class="code hl_function" href="ie__api_8h.html#a5a9a30f05ef6183f6a75811c616b3a0a">ie_engine_destroy</a>(engine);</div>
<div class="line"><span class="lineno"> 2512</span>    <a class="code hl_function" href="ie__io_8h.html#a06c2b7e35d1f82a11e4605e23a1976f5">ie_weights_close</a>(&amp;w);</div>
<div class="line"><span class="lineno"> 2513</span>    <a class="code hl_function" href="main__infer_8c.html#a84b40472513bc66398c6d3049891f553">print_json_result</a>(0, NULL, 0.0, 0.0, 0.0, 0, 0, 0, NULL, tokenizer_path_heap, opt.<a class="code hl_variable" href="structcli__extras.html#a3b9c2202e0ba68aa4b3112779697a28e">expected_tokens_file</a>, NULL, 1, NULL);</div>
<div class="line"><span class="lineno"> 2514</span>    free(tokenizer_path_heap);</div>
<div class="line"><span class="lineno"> 2515</span>    <span class="keywordflow">return</span> 6;</div>
<div class="line"><span class="lineno"> 2516</span>  }</div>
<div class="line"><span class="lineno"> 2517</span> </div>
<div class="line"><span class="lineno"> 2518</span>  <span class="keyword">const</span> <span class="keywordtype">size_t</span> bytes_per_token = (size_t)<a class="code hl_function" href="main__infer_8c.html#a9675b1f5b8b73e24233f92cb11e31f6a">env_long</a>(<span class="stringliteral">&quot;IE_BYTES_PER_TOKEN&quot;</span>, 0);</div>
<div class="line"><span class="lineno"> 2519</span>  <span class="keyword">const</span> <span class="keywordtype">size_t</span> stride_bytes = (size_t)<a class="code hl_function" href="main__infer_8c.html#a9675b1f5b8b73e24233f92cb11e31f6a">env_long</a>(<span class="stringliteral">&quot;IE_STRIDE_BYTES&quot;</span>, 256);</div>
<div class="line"><span class="lineno"> 2520</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> verify_touch = (int)<a class="code hl_function" href="main__infer_8c.html#a9675b1f5b8b73e24233f92cb11e31f6a">env_long</a>(<span class="stringliteral">&quot;IE_VERIFY_TOUCH&quot;</span>, 0);</div>
<div class="line"><span class="lineno"> 2521</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> want_cuda = <a class="code hl_function" href="main__infer_8c.html#a43b384fdf1f1e4cc7304e6164461af44">device_is_cuda</a>(opt.<a class="code hl_variable" href="structcli__extras.html#a50cd2ee771a9eee3fd448d2a1c0b5645">device</a>) ? 1 : 0;</div>
<div class="line"><span class="lineno"> 2522</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> want_cpu = <a class="code hl_function" href="main__infer_8c.html#ae26c03bc6150b42f62a01df020935733">device_is_cpu</a>(opt.<a class="code hl_variable" href="structcli__extras.html#a50cd2ee771a9eee3fd448d2a1c0b5645">device</a>) ? 1 : 0;</div>
<div class="line"><span class="lineno"> 2523</span> </div>
<div class="line"><span class="lineno"> 2524</span>  <span class="comment">/* Preload prompts so file I/O is outside the timed window. */</span></div>
<div class="line"><span class="lineno"> 2525</span>  <a class="code hl_struct" href="structprompt__list.html">prompt_list_t</a> prompts;</div>
<div class="line"><span class="lineno"> 2526</span>  <a class="code hl_function" href="main__infer_8c.html#a9891db61dca3c60715c6b2f7aad7f5a1">prompt_list_init</a>(&amp;prompts);</div>
<div class="line"><span class="lineno"> 2527</span> </div>
<div class="line"><span class="lineno"> 2528</span>  <span class="keywordflow">if</span> (opt.<a class="code hl_variable" href="structcli__extras.html#a992ba8185b17f227f60e2e570441b63f">prompts_file</a> &amp;&amp; *opt.<a class="code hl_variable" href="structcli__extras.html#a992ba8185b17f227f60e2e570441b63f">prompts_file</a> &amp;&amp; opt.<a class="code hl_variable" href="structcli__extras.html#a4e233e0c7d76b4fb4338d7460a552707">aggregate</a>) {</div>
<div class="line"><span class="lineno"> 2529</span>    (void)<a class="code hl_function" href="main__infer_8c.html#a3d826199fc8a9ddb8a49f324c2ff1dc5">prompt_list_read_file</a>(opt.<a class="code hl_variable" href="structcli__extras.html#a992ba8185b17f227f60e2e570441b63f">prompts_file</a>, &amp;prompts);</div>
<div class="line"><span class="lineno"> 2530</span>  }</div>
<div class="line"><span class="lineno"> 2531</span> </div>
<div class="line"><span class="lineno"> 2532</span>  <span class="keywordflow">if</span> (prompts.<a class="code hl_variable" href="structprompt__list.html#ab60c60299e5806652f4c2c7a94aca5c3">count</a> == 0 &amp;&amp; opt.<a class="code hl_variable" href="structcli__extras.html#aa45c7376781454d767d2202800c27a3e">prompt</a>) {</div>
<div class="line"><span class="lineno"> 2533</span>    (void)<a class="code hl_function" href="main__infer_8c.html#a9be857b0051297813c2cb218accbb5c8">prompt_list_push_copy</a>(&amp;prompts, opt.<a class="code hl_variable" href="structcli__extras.html#aa45c7376781454d767d2202800c27a3e">prompt</a>);</div>
<div class="line"><span class="lineno"> 2534</span>  }</div>
<div class="line"><span class="lineno"> 2535</span> </div>
<div class="line"><span class="lineno"> 2536</span>  <span class="keywordflow">if</span> (prompts.<a class="code hl_variable" href="structprompt__list.html#ab60c60299e5806652f4c2c7a94aca5c3">count</a> == 0 &amp;&amp; opt.<a class="code hl_variable" href="structcli__extras.html#a992ba8185b17f227f60e2e570441b63f">prompts_file</a> &amp;&amp; *opt.<a class="code hl_variable" href="structcli__extras.html#a992ba8185b17f227f60e2e570441b63f">prompts_file</a> &amp;&amp; !opt.<a class="code hl_variable" href="structcli__extras.html#a4e233e0c7d76b4fb4338d7460a552707">aggregate</a>) {</div>
<div class="line"><span class="lineno"> 2537</span>    <span class="comment">/* Legacy compatibility: if the user explicitly disabled aggregate, run first line only. */</span></div>
<div class="line"><span class="lineno"> 2538</span>    <span class="keywordtype">char</span> first[8192];</div>
<div class="line"><span class="lineno"> 2539</span>    <span class="keywordtype">int</span> r = <a class="code hl_function" href="main__infer_8c.html#a609fc6d778b714530dadf2ef012acf5c">read_first_nonempty_line</a>(opt.<a class="code hl_variable" href="structcli__extras.html#a992ba8185b17f227f60e2e570441b63f">prompts_file</a>, first, <span class="keyword">sizeof</span>(first));</div>
<div class="line"><span class="lineno"> 2540</span>    <span class="keywordflow">if</span> (r == 1) (void)<a class="code hl_function" href="main__infer_8c.html#a9be857b0051297813c2cb218accbb5c8">prompt_list_push_copy</a>(&amp;prompts, first);</div>
<div class="line"><span class="lineno"> 2541</span>  }</div>
<div class="line"><span class="lineno"> 2542</span> </div>
<div class="line"><span class="lineno"> 2543</span>  <span class="keywordflow">if</span> (prompts.<a class="code hl_variable" href="structprompt__list.html#ab60c60299e5806652f4c2c7a94aca5c3">count</a> == 0) {</div>
<div class="line"><span class="lineno"> 2544</span>    <span class="comment">/* Keep behavior predictable even with empty/unreadable prompt files. */</span></div>
<div class="line"><span class="lineno"> 2545</span>    (void)<a class="code hl_function" href="main__infer_8c.html#a9be857b0051297813c2cb218accbb5c8">prompt_list_push_copy</a>(&amp;prompts, <span class="stringliteral">&quot;bench&quot;</span>);</div>
<div class="line"><span class="lineno"> 2546</span>  }</div>
<div class="line"><span class="lineno"> 2547</span> </div>
<div class="line"><span class="lineno"> 2548</span>  <span class="comment">/* Load expected tokens table (optional). */</span></div>
<div class="line"><span class="lineno"> 2549</span>  <a class="code hl_struct" href="structexpected__tokens__table.html">expected_tokens_table_t</a> expected;</div>
<div class="line"><span class="lineno"> 2550</span>  <a class="code hl_function" href="main__infer_8c.html#a7170af3ba79ee074b29ac13736ec97bf">expected_tokens_table_init</a>(&amp;expected);</div>
<div class="line"><span class="lineno"> 2551</span>  <span class="keywordtype">int</span> expected_loaded = 0;</div>
<div class="line"><span class="lineno"> 2552</span>  <span class="keywordflow">if</span> (opt.<a class="code hl_variable" href="structcli__extras.html#a3b9c2202e0ba68aa4b3112779697a28e">expected_tokens_file</a> &amp;&amp; *opt.<a class="code hl_variable" href="structcli__extras.html#a3b9c2202e0ba68aa4b3112779697a28e">expected_tokens_file</a>) {</div>
<div class="line"><span class="lineno"> 2553</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#a84acee847ca644179eff86e6406bf230">expected_tokens_table_load</a>(opt.<a class="code hl_variable" href="structcli__extras.html#a3b9c2202e0ba68aa4b3112779697a28e">expected_tokens_file</a>, &amp;expected) == 0) expected_loaded = 1;</div>
<div class="line"><span class="lineno"> 2554</span>    <span class="keywordflow">else</span> fprintf(stderr, <span class="stringliteral">&quot;warn: expected tokens file could not be loaded (continuing)\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 2555</span>  }</div>
<div class="line"><span class="lineno"> 2556</span> </div>
<div class="line"><span class="lineno"> 2557</span>  <a class="code hl_struct" href="structmodel__mmap__touch.html">model_mmap_touch_t</a> mt;</div>
<div class="line"><span class="lineno"> 2558</span>  <span class="keywordtype">int</span> mt_ok = 0;</div>
<div class="line"><span class="lineno"> 2559</span>  <span class="keywordflow">if</span> (want_cpu &amp;&amp; verify_touch &amp;&amp; bytes_per_token &gt; 0) {</div>
<div class="line"><span class="lineno"> 2560</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#ac67780918b483167f77ec879306c781c">model_touch_open</a>(&amp;mt, bin_path) == 0) mt_ok = 1;</div>
<div class="line"><span class="lineno"> 2561</span>    <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 2562</span>      fprintf(stderr, <span class="stringliteral">&quot;warn: strict CPU model mmap failed (will proceed without file-backed touch)\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 2563</span>      mt_ok = 0;</div>
<div class="line"><span class="lineno"> 2564</span>    }</div>
<div class="line"><span class="lineno"> 2565</span>  }</div>
<div class="line"><span class="lineno"> 2566</span> </div>
<div class="line"><span class="lineno"> 2567</span>  <span class="comment">/* Preload cudart (dlopen/dlsym) outside the timed window to avoid setup overhead. */</span></div>
<div class="line"><span class="lineno"> 2568</span>  <span class="keywordflow">if</span> (want_cuda &amp;&amp; verify_touch &amp;&amp; bytes_per_token &gt; 0) (void)<a class="code hl_function" href="main__infer_8c.html#aca4f099fbc130845b4af6c57ca21b3ef">cudart_get_api</a>();</div>
<div class="line"><span class="lineno"> 2569</span> </div>
<div class="line"><span class="lineno"> 2570</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> rounds = (opt.<a class="code hl_variable" href="structcli__extras.html#a8c1b8fdbf9dc75a774e8b451608c961b">rounds</a> &gt; 0 ? opt.<a class="code hl_variable" href="structcli__extras.html#a8c1b8fdbf9dc75a774e8b451608c961b">rounds</a> : 1);</div>
<div class="line"><span class="lineno"> 2571</span>  <span class="keyword">const</span> <span class="keywordtype">size_t</span> n_prompts = prompts.<a class="code hl_variable" href="structprompt__list.html#ab60c60299e5806652f4c2c7a94aca5c3">count</a>;</div>
<div class="line"><span class="lineno"> 2572</span> </div>
<div class="line"><span class="lineno"> 2573</span>  <a class="code hl_struct" href="structprompt__round__record.html">prompt_round_record_t</a> *recs = (<a class="code hl_struct" href="structprompt__round__record.html">prompt_round_record_t</a> *)calloc((<span class="keywordtype">size_t</span>)rounds * n_prompts, <span class="keyword">sizeof</span>(*recs));</div>
<div class="line"><span class="lineno"> 2574</span>  <span class="keywordflow">if</span> (!recs) {</div>
<div class="line"><span class="lineno"> 2575</span>    fprintf(stderr, <span class="stringliteral">&quot;error: OOM allocating report records\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 2576</span>    <span class="keywordflow">if</span> (mt_ok) <a class="code hl_function" href="main__infer_8c.html#a6d67a99243e339c4acabd9ed9b84002c">model_touch_close</a>(&amp;mt);</div>
<div class="line"><span class="lineno"> 2577</span>    <a class="code hl_function" href="main__infer_8c.html#a470ca5b37dd720b5de391932c452af36">expected_tokens_table_free</a>(&amp;expected);</div>
<div class="line"><span class="lineno"> 2578</span>    <a class="code hl_function" href="main__infer_8c.html#ab06a46b9f23d08de776ec7d3258b6588">prompt_list_free</a>(&amp;prompts);</div>
<div class="line"><span class="lineno"> 2579</span>    free(tokens);</div>
<div class="line"><span class="lineno"> 2580</span>    <a class="code hl_function" href="ie__api_8h.html#a5a9a30f05ef6183f6a75811c616b3a0a">ie_engine_destroy</a>(engine);</div>
<div class="line"><span class="lineno"> 2581</span>    <a class="code hl_function" href="ie__io_8h.html#a06c2b7e35d1f82a11e4605e23a1976f5">ie_weights_close</a>(&amp;w);</div>
<div class="line"><span class="lineno"> 2582</span>    <a class="code hl_function" href="main__infer_8c.html#a84b40472513bc66398c6d3049891f553">print_json_result</a>(0, NULL, 0.0, 0.0, 0.0, 0, 0, <a class="code hl_function" href="main__infer_8c.html#a0d90177eef91d08c3d9a38fb00df3e62">rss_peak_mib</a>(), NULL, tokenizer_path_heap, opt.<a class="code hl_variable" href="structcli__extras.html#a3b9c2202e0ba68aa4b3112779697a28e">expected_tokens_file</a>, NULL, rounds, NULL);</div>
<div class="line"><span class="lineno"> 2583</span>    free(tokenizer_path_heap);</div>
<div class="line"><span class="lineno"> 2584</span>    <span class="keywordflow">return</span> 7;</div>
<div class="line"><span class="lineno"> 2585</span>  }</div>
<div class="line"><span class="lineno"> 2586</span> </div>
<div class="line"><span class="lineno"> 2587</span>  (void)<a class="code hl_function" href="ie__kv__instrumentation_8h.html#a0a8ac6ff4fa3502470774c6cb9e6f488">ie_kv_begin_round</a>();</div>
<div class="line"><span class="lineno"> 2588</span>  uint64_t total_tokens_this_round = 0;</div>
<div class="line"><span class="lineno"> 2589</span> </div>
<div class="line"><span class="lineno"> 2590</span>  <span class="keywordtype">size_t</span> tokens_generated_total = 0;</div>
<div class="line"><span class="lineno"> 2591</span>  <span class="keywordtype">double</span> prefill_s_total = 0.0;</div>
<div class="line"><span class="lineno"> 2592</span>  <span class="keywordtype">double</span> decode_s_total = 0.0;</div>
<div class="line"><span class="lineno"> 2593</span> </div>
<div class="line"><span class="lineno"> 2594</span>  <span class="comment">/* Timed window begins here: steady-state generation + strict-touch work only. */</span></div>
<div class="line"><span class="lineno"> 2595</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> t0 = <a class="code hl_function" href="main__infer_8c.html#a4fdbfffdaa0f22a01822f6a62bb7e95e">now_sec</a>();</div>
<div class="line"><span class="lineno"> 2596</span> </div>
<div class="line"><span class="lineno"> 2597</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> rr = 0; rr &lt; rounds; ++rr) {</div>
<div class="line"><span class="lineno"> 2598</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> pi = 0; pi &lt; n_prompts; ++pi) {</div>
<div class="line"><span class="lineno"> 2599</span>      <span class="keyword">const</span> <span class="keywordtype">char</span> *p = prompts.<a class="code hl_variable" href="structprompt__list.html#ad4b457e3153a399812c91acb3d2f399f">items</a>[pi];</div>
<div class="line"><span class="lineno"> 2600</span>      <span class="keywordtype">size_t</span> n_here = 0;</div>
<div class="line"><span class="lineno"> 2601</span> </div>
<div class="line"><span class="lineno"> 2602</span>      <span class="keywordflow">if</span> (trace_ids_enabled) {</div>
<div class="line"><span class="lineno"> 2603</span>        <span class="keywordtype">char</span> buf[32];</div>
<div class="line"><span class="lineno"> 2604</span>        (void)snprintf(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%zu&quot;</span>, pi);</div>
<div class="line"><span class="lineno"> 2605</span>        (void)setenv(<span class="stringliteral">&quot;IE_TRACE_PROMPT_INDEX&quot;</span>, buf, 1);</div>
<div class="line"><span class="lineno"> 2606</span>      }</div>
<div class="line"><span class="lineno"> 2607</span> </div>
<div class="line"><span class="lineno"> 2608</span>      <a class="code hl_struct" href="structie__generate__stats.html">ie_generate_stats_t</a> gs;</div>
<div class="line"><span class="lineno"> 2609</span>      memset(&amp;gs, 0, <span class="keyword">sizeof</span>(gs));</div>
<div class="line"><span class="lineno"> 2610</span> </div>
<div class="line"><span class="lineno"> 2611</span>      <span class="keyword">const</span> <span class="keywordtype">double</span> pt0 = <a class="code hl_function" href="main__infer_8c.html#a4fdbfffdaa0f22a01822f6a62bb7e95e">now_sec</a>();</div>
<div class="line"><span class="lineno"> 2612</span> </div>
<div class="line"><span class="lineno"> 2613</span>      st = <a class="code hl_function" href="ie__api_8h.html#a950ac9a0efe5a4fe068a288e57099c4a">ie_engine_generate_ex</a>(engine, p, cap, tokens, &amp;n_here, &amp;gs);</div>
<div class="line"><span class="lineno"> 2614</span>      <span class="keywordflow">if</span> (st != <a class="code hl_enumvalue" href="ie__api_8h.html#aad1f6716972d7c4560daae2edb134d6aad0e6665e4f13d22e40740ef4ab91d56e">IE_OK</a>) {</div>
<div class="line"><span class="lineno"> 2615</span>        fprintf(stderr, <span class="stringliteral">&quot;error: ie_engine_generate_ex (status=%d)\n&quot;</span>, (<span class="keywordtype">int</span>)st);</div>
<div class="line"><span class="lineno"> 2616</span>        <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 2617</span>      }</div>
<div class="line"><span class="lineno"> 2618</span> </div>
<div class="line"><span class="lineno"> 2619</span>      <span class="keywordflow">if</span> (want_cuda &amp;&amp; verify_touch &amp;&amp; bytes_per_token &amp;&amp; n_here &gt; 0) {</div>
<div class="line"><span class="lineno"> 2620</span>        <span class="keywordtype">int</span> rc = <a class="code hl_function" href="main__infer_8c.html#a44a0de9d17f6eff8a4764537268ab5d1">cudart_touch_bytes</a>(bytes_per_token, (uint64_t)n_here, stride_bytes, verify_touch);</div>
<div class="line"><span class="lineno"> 2621</span>        <span class="keywordflow">if</span> (rc != 0) fprintf(stderr, <span class="stringliteral">&quot;error: CUDA strict touch failed (rc=%d)\n&quot;</span>, rc);</div>
<div class="line"><span class="lineno"> 2622</span>      }</div>
<div class="line"><span class="lineno"> 2623</span> </div>
<div class="line"><span class="lineno"> 2624</span>      <span class="keywordflow">if</span> (want_cpu &amp;&amp; verify_touch &amp;&amp; bytes_per_token &amp;&amp; n_here &gt; 0 &amp;&amp; mt_ok) {</div>
<div class="line"><span class="lineno"> 2625</span>        (void)<a class="code hl_function" href="main__infer_8c.html#af5ac8d51b8d24639015faa2a2e699ba2">model_touch_bytes</a>(&amp;mt, bytes_per_token * n_here, stride_bytes, verify_touch);</div>
<div class="line"><span class="lineno"> 2626</span>      }</div>
<div class="line"><span class="lineno"> 2627</span> </div>
<div class="line"><span class="lineno"> 2628</span>      <span class="keyword">const</span> <span class="keywordtype">double</span> pt1 = <a class="code hl_function" href="main__infer_8c.html#a4fdbfffdaa0f22a01822f6a62bb7e95e">now_sec</a>();</div>
<div class="line"><span class="lineno"> 2629</span> </div>
<div class="line"><span class="lineno"> 2630</span>      tokens_generated_total += n_here;</div>
<div class="line"><span class="lineno"> 2631</span>      total_tokens_this_round += (uint64_t)n_here;</div>
<div class="line"><span class="lineno"> 2632</span> </div>
<div class="line"><span class="lineno"> 2633</span>      prefill_s_total += gs.<a class="code hl_variable" href="structie__generate__stats.html#a25833e4ea02ba3a80027c68ef1b7df4e">prefill_time_s</a>;</div>
<div class="line"><span class="lineno"> 2634</span>      decode_s_total += gs.<a class="code hl_variable" href="structie__generate__stats.html#a1b1460ddd99269f59229371ead131768">decode_time_s</a>;</div>
<div class="line"><span class="lineno"> 2635</span> </div>
<div class="line"><span class="lineno"> 2636</span>      <span class="keyword">const</span> <span class="keywordtype">size_t</span> ridx = (size_t)rr * n_prompts + pi;</div>
<div class="line"><span class="lineno"> 2637</span>      <a class="code hl_struct" href="structprompt__round__record.html">prompt_round_record_t</a> *r = &amp;recs[ridx];</div>
<div class="line"><span class="lineno"> 2638</span>      memset(r, 0, <span class="keyword">sizeof</span>(*r));</div>
<div class="line"><span class="lineno"> 2639</span> </div>
<div class="line"><span class="lineno"> 2640</span>      r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#a691ac5964e952c5059b957f07a8542f5">prompt_index</a> = pi;</div>
<div class="line"><span class="lineno"> 2641</span>      r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#aad02ec5870f35fcf8d7608104ed06304">round_index</a> = rr;</div>
<div class="line"><span class="lineno"> 2642</span>      r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#a9b7acfc693dc6c61df0c048c77d59c6f">prompt_id</a> = <a class="code hl_function" href="main__infer_8c.html#ad7f42b712b3e86af5d9f8c9942bc8875">prompt_id_fnv1a64</a>(p);</div>
<div class="line"><span class="lineno"> 2643</span>      r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#a8cc938142194c5202bb275da807b0dbf">tokens_generated</a> = n_here;</div>
<div class="line"><span class="lineno"> 2644</span>      r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#a8da08c83a326c2b7ab39fd7cfadb762b">window_time_s</a> = (pt1 - pt0);</div>
<div class="line"><span class="lineno"> 2645</span>      r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#a4ab0f6440e03c15551287b69ed070d94">prefill_time_s</a> = gs.<a class="code hl_variable" href="structie__generate__stats.html#a25833e4ea02ba3a80027c68ef1b7df4e">prefill_time_s</a>;</div>
<div class="line"><span class="lineno"> 2646</span>      r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#aa08726c5eddf5bb4680d15b63b494dc8">decode_time_s</a> = gs.<a class="code hl_variable" href="structie__generate__stats.html#a1b1460ddd99269f59229371ead131768">decode_time_s</a>;</div>
<div class="line"><span class="lineno"> 2647</span> </div>
<div class="line"><span class="lineno"> 2648</span>      <span class="keywordflow">if</span> (opt.<a class="code hl_variable" href="structcli__extras.html#a69d2dd2e3fe09f5ff877aec31e16de34">report_tokens</a>) {</div>
<div class="line"><span class="lineno"> 2649</span>        <span class="keyword">const</span> <span class="keywordtype">size_t</span> max_keep = opt.<a class="code hl_variable" href="structcli__extras.html#a9a0cdb8214e4f1b8cd375e78dc81f064">report_tokens_max</a>;</div>
<div class="line"><span class="lineno"> 2650</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#a23f6c5852d73ecbdb1dead2be803bcf0">report_token_buf_copy</a>(tokens, n_here, max_keep, &amp;r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#a51223e3133e92ee93d77d6752e57d1bf">tokens</a>) != 0) {</div>
<div class="line"><span class="lineno"> 2651</span>          fprintf(stderr, <span class="stringliteral">&quot;warn: OOM while copying tokens for report (continuing)\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 2652</span>        }</div>
<div class="line"><span class="lineno"> 2653</span>      }</div>
<div class="line"><span class="lineno"> 2654</span> </div>
<div class="line"><span class="lineno"> 2655</span>      <span class="keywordflow">if</span> (expected_loaded) {</div>
<div class="line"><span class="lineno"> 2656</span>        <span class="keyword">const</span> <a class="code hl_struct" href="structexpected__tokens__entry.html">expected_tokens_entry_t</a> *e = <a class="code hl_function" href="main__infer_8c.html#a0b4d248d44b83ac2a6b5f47b47fe15df">expected_tokens_find</a>(&amp;expected, r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#a9b7acfc693dc6c61df0c048c77d59c6f">prompt_id</a>);</div>
<div class="line"><span class="lineno"> 2657</span>        <span class="keywordflow">if</span> (e) {</div>
<div class="line"><span class="lineno"> 2658</span>          r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#ad67c0f4a359b27e788a90c0477211293">expected_present</a> = 1;</div>
<div class="line"><span class="lineno"> 2659</span> </div>
<div class="line"><span class="lineno"> 2660</span>          <span class="keywordtype">size_t</span> mi = 0;</div>
<div class="line"><span class="lineno"> 2661</span>          <span class="keywordtype">int</span> ea = 0, aa = 0;</div>
<div class="line"><span class="lineno"> 2662</span>          <span class="keywordtype">int</span> cmp = <a class="code hl_function" href="main__infer_8c.html#a3a307125ca4048deb177277c8e72bbfe">expected_tokens_compare</a>(e-&gt;<a class="code hl_variable" href="structexpected__tokens__entry.html#a959f62b26acb1af16f22d85b55b0df78">tokens</a>, e-&gt;<a class="code hl_variable" href="structexpected__tokens__entry.html#adbef90e357d95fb8c8658ef20993593f">n_tokens</a>, tokens, n_here, &amp;mi, &amp;ea, &amp;aa);</div>
<div class="line"><span class="lineno"> 2663</span>          r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#adbf79594fd763d49b2eb13dcbd027c90">expected_ok</a> = (cmp == 0) ? 1 : 0;</div>
<div class="line"><span class="lineno"> 2664</span>          r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#a639a8578fdf0ba299afe4f0783c47567">mismatch_index</a> = mi;</div>
<div class="line"><span class="lineno"> 2665</span>          r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#ae372c2117122aeea632490a6ea1526b1">expected_at</a> = ea;</div>
<div class="line"><span class="lineno"> 2666</span>          r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#a24eceb958921c2ab6ecf6fe0cdc5da49">actual_at</a> = aa;</div>
<div class="line"><span class="lineno"> 2667</span>        }</div>
<div class="line"><span class="lineno"> 2668</span>      }</div>
<div class="line"><span class="lineno"> 2669</span>    }</div>
<div class="line"><span class="lineno"> 2670</span>  }</div>
<div class="line"><span class="lineno"> 2671</span> </div>
<div class="line"><span class="lineno"> 2672</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> t1 = <a class="code hl_function" href="main__infer_8c.html#a4fdbfffdaa0f22a01822f6a62bb7e95e">now_sec</a>();</div>
<div class="line"><span class="lineno"> 2673</span>  <span class="comment">/* Timed window ends here. */</span></div>
<div class="line"><span class="lineno"> 2674</span> </div>
<div class="line"><span class="lineno"> 2675</span>  uint64_t kv_hits_round = 0, kv_miss_round = 0;</div>
<div class="line"><span class="lineno"> 2676</span>  <a class="code hl_function" href="ie__kv__instrumentation_8h.html#a2c9789a487a67ebc8e6054aa0b991e4e">ie_kv_finish_round</a>(total_tokens_this_round, &amp;kv_hits_round, &amp;kv_miss_round);</div>
<div class="line"><span class="lineno"> 2677</span> </div>
<div class="line"><span class="lineno"> 2678</span>  <span class="keyword">const</span> uint32_t rss_mib = <a class="code hl_function" href="main__infer_8c.html#a0d90177eef91d08c3d9a38fb00df3e62">rss_peak_mib</a>();</div>
<div class="line"><span class="lineno"> 2679</span> </div>
<div class="line"><span class="lineno"> 2680</span>  <span class="comment">/* Legacy single-prompt token array and text for existing tooling. */</span></div>
<div class="line"><span class="lineno"> 2681</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> legacy_single_prompt = (opt.<a class="code hl_variable" href="structcli__extras.html#a992ba8185b17f227f60e2e570441b63f">prompts_file</a> == NULL &amp;&amp; n_prompts == 1 &amp;&amp; rounds == 1);</div>
<div class="line"><span class="lineno"> 2682</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> *tokens_to_print = legacy_single_prompt ? tokens : NULL;</div>
<div class="line"><span class="lineno"> 2683</span> </div>
<div class="line"><span class="lineno"> 2684</span>  <span class="keywordtype">char</span> *decoded_legacy = NULL;</div>
<div class="line"><span class="lineno"> 2685</span>  <span class="keywordflow">if</span> (opt.<a class="code hl_variable" href="structcli__extras.html#a553c6e455b22c4ff3cd6f00beb166eb7">print_text</a> &amp;&amp; legacy_single_prompt &amp;&amp; tokens_generated_total &gt; 0) {</div>
<div class="line"><span class="lineno"> 2686</span>    <span class="keywordflow">if</span> (tokenizer_path_heap &amp;&amp; *tokenizer_path_heap) {</div>
<div class="line"><span class="lineno"> 2687</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#a4e30eb4737647a78c4dbebb5b008a5bd">decode_tokens_best_effort</a>(tokenizer_path_heap, tokens, tokens_generated_total, &amp;decoded_legacy) != 0) {</div>
<div class="line"><span class="lineno"> 2688</span>        decoded_legacy = NULL;</div>
<div class="line"><span class="lineno"> 2689</span>      }</div>
<div class="line"><span class="lineno"> 2690</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 2691</span>      fprintf(stderr, <span class="stringliteral">&quot;warn: tokenizer file not found under model dir &#39;%s&#39;\n&quot;</span>, model_dir_eff);</div>
<div class="line"><span class="lineno"> 2692</span>    }</div>
<div class="line"><span class="lineno"> 2693</span>  }</div>
<div class="line"><span class="lineno"> 2694</span> </div>
<div class="line"><span class="lineno"> 2695</span>  <span class="comment">/* Optional per-record decode (outside the timed window). */</span></div>
<div class="line"><span class="lineno"> 2696</span>  <span class="keywordflow">if</span> (opt.<a class="code hl_variable" href="structcli__extras.html#a553c6e455b22c4ff3cd6f00beb166eb7">print_text</a> &amp;&amp; tokenizer_path_heap &amp;&amp; *tokenizer_path_heap) {</div>
<div class="line"><span class="lineno"> 2697</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> rr = 0; rr &lt; rounds; ++rr) {</div>
<div class="line"><span class="lineno"> 2698</span>      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> pi = 0; pi &lt; n_prompts; ++pi) {</div>
<div class="line"><span class="lineno"> 2699</span>        <a class="code hl_struct" href="structprompt__round__record.html">prompt_round_record_t</a> *r = &amp;recs[(size_t)rr * n_prompts + pi];</div>
<div class="line"><span class="lineno"> 2700</span>        <span class="keywordflow">if</span> (r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#a51223e3133e92ee93d77d6752e57d1bf">tokens</a>.<a class="code hl_variable" href="structreport__token__buf.html#a91b6556df06c25b311255a4a16f785dd">ids</a> &amp;&amp; r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#a51223e3133e92ee93d77d6752e57d1bf">tokens</a>.<a class="code hl_variable" href="structreport__token__buf.html#a89ffa03443f19bf77470f85a92baa245">n</a> &gt; 0) {</div>
<div class="line"><span class="lineno"> 2701</span>          <span class="keywordtype">char</span> *txt = NULL;</div>
<div class="line"><span class="lineno"> 2702</span>          <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#a4e30eb4737647a78c4dbebb5b008a5bd">decode_tokens_best_effort</a>(tokenizer_path_heap, r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#a51223e3133e92ee93d77d6752e57d1bf">tokens</a>.<a class="code hl_variable" href="structreport__token__buf.html#a91b6556df06c25b311255a4a16f785dd">ids</a>, r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#a51223e3133e92ee93d77d6752e57d1bf">tokens</a>.<a class="code hl_variable" href="structreport__token__buf.html#a89ffa03443f19bf77470f85a92baa245">n</a>, &amp;txt) == 0) {</div>
<div class="line"><span class="lineno"> 2703</span>            r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#a0c260950e8b81d2992debca2f4b49d00">decoded_text</a> = txt;</div>
<div class="line"><span class="lineno"> 2704</span>          }</div>
<div class="line"><span class="lineno"> 2705</span>        }</div>
<div class="line"><span class="lineno"> 2706</span>      }</div>
<div class="line"><span class="lineno"> 2707</span>    }</div>
<div class="line"><span class="lineno"> 2708</span>  }</div>
<div class="line"><span class="lineno"> 2709</span> </div>
<div class="line"><span class="lineno"> 2710</span>  <a class="code hl_function" href="main__infer_8c.html#a84b40472513bc66398c6d3049891f553">print_json_result</a>(tokens_generated_total,</div>
<div class="line"><span class="lineno"> 2711</span>                    tokens_to_print,</div>
<div class="line"><span class="lineno"> 2712</span>                    (t1 - t0),</div>
<div class="line"><span class="lineno"> 2713</span>                    prefill_s_total,</div>
<div class="line"><span class="lineno"> 2714</span>                    decode_s_total,</div>
<div class="line"><span class="lineno"> 2715</span>                    kv_hits_round,</div>
<div class="line"><span class="lineno"> 2716</span>                    kv_miss_round,</div>
<div class="line"><span class="lineno"> 2717</span>                    rss_mib,</div>
<div class="line"><span class="lineno"> 2718</span>                    decoded_legacy,</div>
<div class="line"><span class="lineno"> 2719</span>                    (opt.<a class="code hl_variable" href="structcli__extras.html#a553c6e455b22c4ff3cd6f00beb166eb7">print_text</a> ? tokenizer_path_heap : NULL),</div>
<div class="line"><span class="lineno"> 2720</span>                    opt.expected_tokens_file,</div>
<div class="line"><span class="lineno"> 2721</span>                    &amp;prompts,</div>
<div class="line"><span class="lineno"> 2722</span>                    rounds,</div>
<div class="line"><span class="lineno"> 2723</span>                    recs);</div>
<div class="line"><span class="lineno"> 2724</span> </div>
<div class="line"><span class="lineno"> 2725</span>  free(decoded_legacy);</div>
<div class="line"><span class="lineno"> 2726</span> </div>
<div class="line"><span class="lineno"> 2727</span>  <span class="keywordflow">if</span> (mt_ok) <a class="code hl_function" href="main__infer_8c.html#a6d67a99243e339c4acabd9ed9b84002c">model_touch_close</a>(&amp;mt);</div>
<div class="line"><span class="lineno"> 2728</span> </div>
<div class="line"><span class="lineno"> 2729</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; (size_t)rounds * n_prompts; ++i) <a class="code hl_function" href="main__infer_8c.html#aa8860ddc49714b553fe669c784885cff">prompt_round_record_free</a>(&amp;recs[i]);</div>
<div class="line"><span class="lineno"> 2730</span>  free(recs);</div>
<div class="line"><span class="lineno"> 2731</span> </div>
<div class="line"><span class="lineno"> 2732</span>  <a class="code hl_function" href="main__infer_8c.html#a470ca5b37dd720b5de391932c452af36">expected_tokens_table_free</a>(&amp;expected);</div>
<div class="line"><span class="lineno"> 2733</span>  <a class="code hl_function" href="main__infer_8c.html#ab06a46b9f23d08de776ec7d3258b6588">prompt_list_free</a>(&amp;prompts);</div>
<div class="line"><span class="lineno"> 2734</span> </div>
<div class="line"><span class="lineno"> 2735</span>  free(tokens);</div>
<div class="line"><span class="lineno"> 2736</span>  <a class="code hl_function" href="ie__api_8h.html#a5a9a30f05ef6183f6a75811c616b3a0a">ie_engine_destroy</a>(engine);</div>
<div class="line"><span class="lineno"> 2737</span>  <a class="code hl_function" href="ie__io_8h.html#a06c2b7e35d1f82a11e4605e23a1976f5">ie_weights_close</a>(&amp;w);</div>
<div class="line"><span class="lineno"> 2738</span>  free(tokenizer_path_heap);</div>
<div class="line"><span class="lineno"> 2739</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 2740</span>}</div>
<div class="ttc" id="aie__api_8h_html_a14516a42606ffcc6fafaf4eba282c808"><div class="ttname"><a href="ie__api_8h.html#a14516a42606ffcc6fafaf4eba282c808">ie_status_t</a></div><div class="ttdeci">enum ie_status ie_status_t</div><div class="ttdoc">Status codes returned by the public API.</div></div>
<div class="ttc" id="aie__api_8h_html_a5a9a30f05ef6183f6a75811c616b3a0a"><div class="ttname"><a href="ie__api_8h.html#a5a9a30f05ef6183f6a75811c616b3a0a">ie_engine_destroy</a></div><div class="ttdeci">void ie_engine_destroy(ie_engine_t *e)</div><div class="ttdoc">Destroy an engine instance.</div><div class="ttdef"><b>Definition</b> <a href="ie__api_8c_source.html#l00788">ie_api.c:788</a></div></div>
<div class="ttc" id="aie__api_8h_html_a84bd87043352946e9d53b0f8a5c4abe0"><div class="ttname"><a href="ie__api_8h.html#a84bd87043352946e9d53b0f8a5c4abe0">ie_engine_create</a></div><div class="ttdeci">ie_status_t ie_engine_create(const ie_engine_params_t *p, const char *device, const char *model_dir, ie_engine_t **out)</div><div class="ttdoc">Create an engine instance.</div><div class="ttdef"><b>Definition</b> <a href="ie__api_8c_source.html#l00535">ie_api.c:535</a></div></div>
<div class="ttc" id="aie__api_8h_html_a950ac9a0efe5a4fe068a288e57099c4a"><div class="ttname"><a href="ie__api_8h.html#a950ac9a0efe5a4fe068a288e57099c4a">ie_engine_generate_ex</a></div><div class="ttdeci">ie_status_t ie_engine_generate_ex(const ie_engine_t *e, const char *prompt, size_t max_new, int *out_tokens, size_t *out_n_tokens, ie_generate_stats_t *out_stats)</div><div class="ttdoc">Generate tokens and optionally return timing statistics.</div><div class="ttdef"><b>Definition</b> <a href="ie__api_8c_source.html#l00826">ie_api.c:826</a></div></div>
<div class="ttc" id="aie__api_8h_html_aad1f6716972d7c4560daae2edb134d6aad0e6665e4f13d22e40740ef4ab91d56e"><div class="ttname"><a href="ie__api_8h.html#aad1f6716972d7c4560daae2edb134d6aad0e6665e4f13d22e40740ef4ab91d56e">IE_OK</a></div><div class="ttdeci">@ IE_OK</div><div class="ttdoc">Success.</div><div class="ttdef"><b>Definition</b> <a href="ie__api_8h_source.html#l00034">ie_api.h:34</a></div></div>
<div class="ttc" id="aie__api_8h_html_ad32cf2cd209832e4cd577a5a1e31970f"><div class="ttname"><a href="ie__api_8h.html#ad32cf2cd209832e4cd577a5a1e31970f">ie_engine_generate</a></div><div class="ttdeci">ie_status_t ie_engine_generate(const ie_engine_t *e, const char *prompt, size_t max_new, int *out_tokens, size_t *out_n_tokens)</div><div class="ttdoc">Generate up to max_new tokens for the given prompt.</div><div class="ttdef"><b>Definition</b> <a href="ie__api_8c_source.html#l00818">ie_api.c:818</a></div></div>
<div class="ttc" id="aie__io_8h_html_a06c2b7e35d1f82a11e4605e23a1976f5"><div class="ttname"><a href="ie__io_8h.html#a06c2b7e35d1f82a11e4605e23a1976f5">ie_weights_close</a></div><div class="ttdeci">void ie_weights_close(ie_weights_t *w)</div><div class="ttdoc">Close an opened weights descriptor.</div><div class="ttdef"><b>Definition</b> <a href="weights_8c_source.html#l01356">weights.c:1356</a></div></div>
<div class="ttc" id="aie__io_8h_html_a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d"><div class="ttname"><a href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a></div><div class="ttdeci">@ IE_IO_OK</div><div class="ttdoc">Success.</div><div class="ttdef"><b>Definition</b> <a href="ie__io_8h_source.html#l00064">ie_io.h:64</a></div></div>
<div class="ttc" id="aie__io_8h_html_a522dac028ee37aae1307ffdb6d65ec1d"><div class="ttname"><a href="ie__io_8h.html#a522dac028ee37aae1307ffdb6d65ec1d">ie_weights_open</a></div><div class="ttdeci">int ie_weights_open(const char *json_path, const char *bin_path, ie_weights_t *out)</div><div class="ttdoc">Open and parse an IEBIN v1 model description.</div><div class="ttdef"><b>Definition</b> <a href="weights_8c_source.html#l00988">weights.c:988</a></div></div>
<div class="ttc" id="aie__kv__instrumentation_8h_html_a0a8ac6ff4fa3502470774c6cb9e6f488"><div class="ttname"><a href="ie__kv__instrumentation_8h.html#a0a8ac6ff4fa3502470774c6cb9e6f488">ie_kv_begin_round</a></div><div class="ttdeci">int ie_kv_begin_round(void)</div><div class="ttdoc">Begin (or reset) KV instrumentation for the current round.</div><div class="ttdef"><b>Definition</b> <a href="ie__kv__instrumentation_8c_source.html#l00031">ie_kv_instrumentation.c:31</a></div></div>
<div class="ttc" id="aie__kv__instrumentation_8h_html_a2c9789a487a67ebc8e6054aa0b991e4e"><div class="ttname"><a href="ie__kv__instrumentation_8h.html#a2c9789a487a67ebc8e6054aa0b991e4e">ie_kv_finish_round</a></div><div class="ttdeci">void ie_kv_finish_round(uint64_t total_tokens, uint64_t *out_hits, uint64_t *out_misses)</div><div class="ttdoc">Finish a round and return the accumulated counters.</div><div class="ttdef"><b>Definition</b> <a href="ie__kv__instrumentation_8c_source.html#l00048">ie_kv_instrumentation.c:48</a></div></div>
<div class="ttc" id="amain__infer_8c_html_a0271a21f39c53534b7a1a3cc7eb94596"><div class="ttname"><a href="main__infer_8c.html#a0271a21f39c53534b7a1a3cc7eb94596">resolve_tokenizer_path</a></div><div class="ttdeci">static void resolve_tokenizer_path(const char *model_dir, const char *tokenizer_opt, char *out, size_t outsz)</div><div class="ttdoc">Resolve a tokenizer path under a model directory.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00810">main_infer.c:810</a></div></div>
<div class="ttc" id="amain__infer_8c_html_a0b4d248d44b83ac2a6b5f47b47fe15df"><div class="ttname"><a href="main__infer_8c.html#a0b4d248d44b83ac2a6b5f47b47fe15df">expected_tokens_find</a></div><div class="ttdeci">static const expected_tokens_entry_t * expected_tokens_find(const expected_tokens_table_t *t, uint64_t prompt_id)</div><div class="ttdoc">Find an expected entry by prompt ID.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l02006">main_infer.c:2006</a></div></div>
<div class="ttc" id="amain__infer_8c_html_a0cbea455e9868581360f43c63db6554c"><div class="ttname"><a href="main__infer_8c.html#a0cbea455e9868581360f43c63db6554c">path_exists</a></div><div class="ttdeci">static int path_exists(const char *p)</div><div class="ttdoc">Determine whether a filesystem path exists (stat succeeds).</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00227">main_infer.c:227</a></div></div>
<div class="ttc" id="amain__infer_8c_html_a0d90177eef91d08c3d9a38fb00df3e62"><div class="ttname"><a href="main__infer_8c.html#a0d90177eef91d08c3d9a38fb00df3e62">rss_peak_mib</a></div><div class="ttdeci">static uint32_t rss_peak_mib(void)</div><div class="ttdoc">Read ru_maxrss and convert to MiB (Linux: ru_maxrss is KiB).</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00437">main_infer.c:437</a></div></div>
<div class="ttc" id="amain__infer_8c_html_a1da65df4642943745d356d6de2983f02"><div class="ttname"><a href="main__infer_8c.html#a1da65df4642943745d356d6de2983f02">env_str</a></div><div class="ttdeci">static const char * env_str(const char *name, const char *defv)</div><div class="ttdoc">Read a string from an environment variable with a default.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00147">main_infer.c:147</a></div></div>
<div class="ttc" id="amain__infer_8c_html_a2392f4f2060045de53b484a90f85f15f"><div class="ttname"><a href="main__infer_8c.html#a2392f4f2060045de53b484a90f85f15f">dir_accessible</a></div><div class="ttdeci">static int dir_accessible(const char *p)</div><div class="ttdoc">Determine whether a directory exists and is accessible (R_OK|X_OK).</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00245">main_infer.c:245</a></div></div>
<div class="ttc" id="amain__infer_8c_html_a23f6c5852d73ecbdb1dead2be803bcf0"><div class="ttname"><a href="main__infer_8c.html#a23f6c5852d73ecbdb1dead2be803bcf0">report_token_buf_copy</a></div><div class="ttdeci">static int report_token_buf_copy(const int *ids, size_t n, size_t max_keep, report_token_buf_t *out)</div><div class="ttdoc">Copy tokens into a report token buffer (truncating if requested).</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l02062">main_infer.c:2062</a></div></div>
<div class="ttc" id="amain__infer_8c_html_a39103ce72021a890c3e333b949068a1c"><div class="ttname"><a href="main__infer_8c.html#a39103ce72021a890c3e333b949068a1c">heap_strdup</a></div><div class="ttdeci">static char * heap_strdup(const char *s)</div><div class="ttdoc">Heap-duplicate a string (portable replacement for strdup).</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00449">main_infer.c:449</a></div></div>
<div class="ttc" id="amain__infer_8c_html_a3a307125ca4048deb177277c8e72bbfe"><div class="ttname"><a href="main__infer_8c.html#a3a307125ca4048deb177277c8e72bbfe">expected_tokens_compare</a></div><div class="ttdeci">static int expected_tokens_compare(const int *expected, size_t n_expected, const int *actual, size_t n_actual, size_t *mismatch_index, int *expected_at, int *actual_at)</div><div class="ttdoc">Compare actual tokens against expected tokens for one prompt.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01832">main_infer.c:1832</a></div></div>
<div class="ttc" id="amain__infer_8c_html_a3d826199fc8a9ddb8a49f324c2ff1dc5"><div class="ttname"><a href="main__infer_8c.html#a3d826199fc8a9ddb8a49f324c2ff1dc5">prompt_list_read_file</a></div><div class="ttdeci">static int prompt_list_read_file(const char *path, prompt_list_t *out)</div><div class="ttdoc">Read all non-empty lines from a prompts file into memory.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01641">main_infer.c:1641</a></div></div>
<div class="ttc" id="amain__infer_8c_html_a43b384fdf1f1e4cc7304e6164461af44"><div class="ttname"><a href="main__infer_8c.html#a43b384fdf1f1e4cc7304e6164461af44">device_is_cuda</a></div><div class="ttdeci">static int device_is_cuda(const char *dev)</div><div class="ttdoc">Check whether device string selects CUDA.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l02345">main_infer.c:2345</a></div></div>
<div class="ttc" id="amain__infer_8c_html_a44a0de9d17f6eff8a4764537268ab5d1"><div class="ttname"><a href="main__infer_8c.html#a44a0de9d17f6eff8a4764537268ab5d1">cudart_touch_bytes</a></div><div class="ttdeci">static int cudart_touch_bytes(size_t bytes_per_token, uint64_t tokens, size_t stride_bytes, int verify_touch)</div><div class="ttdoc">Strict CUDA touch: cudaMalloc + repeated cudaMemset + optional D2H copy.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00697">main_infer.c:697</a></div></div>
<div class="ttc" id="amain__infer_8c_html_a456ba954f3884bcf5f72fc3e779de284"><div class="ttname"><a href="main__infer_8c.html#a456ba954f3884bcf5f72fc3e779de284">parse_flags</a></div><div class="ttdeci">static int parse_flags(int argc, char **argv, cli_extras_t *out)</div><div class="ttdoc">Parse CLI flags into cli_extras_t.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01308">main_infer.c:1308</a></div></div>
<div class="ttc" id="amain__infer_8c_html_a4e30eb4737647a78c4dbebb5b008a5bd"><div class="ttname"><a href="main__infer_8c.html#a4e30eb4737647a78c4dbebb5b008a5bd">decode_tokens_best_effort</a></div><div class="ttdeci">static int decode_tokens_best_effort(const char *tok_path, const int *ids, size_t n, char **out_text)</div><div class="ttdoc">Decode token IDs into UTF-8 text (best-effort).</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00866">main_infer.c:866</a></div></div>
<div class="ttc" id="amain__infer_8c_html_a4fdbfffdaa0f22a01822f6a62bb7e95e"><div class="ttname"><a href="main__infer_8c.html#a4fdbfffdaa0f22a01822f6a62bb7e95e">now_sec</a></div><div class="ttdeci">static double now_sec(void)</div><div class="ttdoc">Return monotonic time in seconds.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00209">main_infer.c:209</a></div></div>
<div class="ttc" id="amain__infer_8c_html_a609fc6d778b714530dadf2ef012acf5c"><div class="ttname"><a href="main__infer_8c.html#a609fc6d778b714530dadf2ef012acf5c">read_first_nonempty_line</a></div><div class="ttdeci">static int read_first_nonempty_line(const char *path, char *buf, size_t bufsz)</div><div class="ttdoc">Read the first non-empty line from a text file.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01527">main_infer.c:1527</a></div></div>
<div class="ttc" id="amain__infer_8c_html_a6d67a99243e339c4acabd9ed9b84002c"><div class="ttname"><a href="main__infer_8c.html#a6d67a99243e339c4acabd9ed9b84002c">model_touch_close</a></div><div class="ttdeci">static void model_touch_close(model_mmap_touch_t *ctx)</div><div class="ttdoc">Close and unmap a model touch context.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00551">main_infer.c:551</a></div></div>
<div class="ttc" id="amain__infer_8c_html_a84acee847ca644179eff86e6406bf230"><div class="ttname"><a href="main__infer_8c.html#a84acee847ca644179eff86e6406bf230">expected_tokens_table_load</a></div><div class="ttdeci">static int expected_tokens_table_load(const char *path, expected_tokens_table_t *out)</div><div class="ttdoc">Load expected tokens from a text file.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01944">main_infer.c:1944</a></div></div>
<div class="ttc" id="amain__infer_8c_html_a84b40472513bc66398c6d3049891f553"><div class="ttname"><a href="main__infer_8c.html#a84b40472513bc66398c6d3049891f553">print_json_result</a></div><div class="ttdeci">static void print_json_result(size_t n_tok, const int *tokens, double wall_s_in, double prefill_s_in, double decode_s_in, uint64_t kv_hits, uint64_t kv_misses, uint32_t rss_peak_mb, const char *text_decoded, const char *tokenizer_path_used, const char *expected_file, const prompt_list_t *prompts, int rounds, const prompt_round_record_t *recs)</div><div class="ttdoc">Print the single JSON result object to stdout.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l02171">main_infer.c:2171</a></div></div>
<div class="ttc" id="amain__infer_8c_html_a9675b1f5b8b73e24233f92cb11e31f6a"><div class="ttname"><a href="main__infer_8c.html#a9675b1f5b8b73e24233f92cb11e31f6a">env_long</a></div><div class="ttdeci">static long env_long(const char *name, long defv)</div><div class="ttdoc">Read a long integer from an environment variable with a default.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00133">main_infer.c:133</a></div></div>
<div class="ttc" id="amain__infer_8c_html_a9891db61dca3c60715c6b2f7aad7f5a1"><div class="ttname"><a href="main__infer_8c.html#a9891db61dca3c60715c6b2f7aad7f5a1">prompt_list_init</a></div><div class="ttdeci">static void prompt_list_init(prompt_list_t *pl)</div><div class="ttdoc">Initialize an empty prompt list.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01565">main_infer.c:1565</a></div></div>
<div class="ttc" id="amain__infer_8c_html_a9be857b0051297813c2cb218accbb5c8"><div class="ttname"><a href="main__infer_8c.html#a9be857b0051297813c2cb218accbb5c8">prompt_list_push_copy</a></div><div class="ttdeci">static int prompt_list_push_copy(prompt_list_t *pl, const char *s)</div><div class="ttdoc">Push a prompt string copy into the list.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01606">main_infer.c:1606</a></div></div>
<div class="ttc" id="amain__infer_8c_html_aa8860ddc49714b553fe669c784885cff"><div class="ttname"><a href="main__infer_8c.html#aa8860ddc49714b553fe669c784885cff">prompt_round_record_free</a></div><div class="ttdeci">static void prompt_round_record_free(prompt_round_record_t *r)</div><div class="ttdoc">Free a prompt-round record.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l02113">main_infer.c:2113</a></div></div>
<div class="ttc" id="amain__infer_8c_html_ab06a46b9f23d08de776ec7d3258b6588"><div class="ttname"><a href="main__infer_8c.html#ab06a46b9f23d08de776ec7d3258b6588">prompt_list_free</a></div><div class="ttdeci">static void prompt_list_free(prompt_list_t *pl)</div><div class="ttdoc">Free a prompt list and all owned strings.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01581">main_infer.c:1581</a></div></div>
<div class="ttc" id="amain__infer_8c_html_ac50de02cf90e21f66e0681932f39334f"><div class="ttname"><a href="main__infer_8c.html#ac50de02cf90e21f66e0681932f39334f">apply_cli_debug_env</a></div><div class="ttdeci">static void apply_cli_debug_env(const cli_extras_t *opt)</div><div class="ttdoc">Apply CLI deterministic/debug knobs by setting environment variables.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01231">main_infer.c:1231</a></div></div>
<div class="ttc" id="amain__infer_8c_html_ac67780918b483167f77ec879306c781c"><div class="ttname"><a href="main__infer_8c.html#ac67780918b483167f77ec879306c781c">model_touch_open</a></div><div class="ttdeci">static int model_touch_open(model_mmap_touch_t *ctx, const char *path)</div><div class="ttdoc">Initialize a file-backed read-only mmap for the given path.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00508">main_infer.c:508</a></div></div>
<div class="ttc" id="amain__infer_8c_html_ad6b894571e18a35f21d8451e008fae37"><div class="ttname"><a href="main__infer_8c.html#ad6b894571e18a35f21d8451e008fae37">resolve_model_paths</a></div><div class="ttdeci">static void resolve_model_paths(const char *model_dir, const char *model_json_opt, const char *model_bin_opt, const char *precision, char *out_json, size_t out_json_sz, char *out_bin, size_t out_bin_sz)</div><div class="ttdoc">Resolve model JSON/BIN paths based on model_dir and precision defaults.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00378">main_infer.c:378</a></div></div>
<div class="ttc" id="amain__infer_8c_html_ad7f42b712b3e86af5d9f8c9942bc8875"><div class="ttname"><a href="main__infer_8c.html#ad7f42b712b3e86af5d9f8c9942bc8875">prompt_id_fnv1a64</a></div><div class="ttdeci">static uint64_t prompt_id_fnv1a64(const char *s)</div><div class="ttdoc">Compute a stable 64-bit prompt ID (FNV-1a over bytes).</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01690">main_infer.c:1690</a></div></div>
<div class="ttc" id="amain__infer_8c_html_ae26c03bc6150b42f62a01df020935733"><div class="ttname"><a href="main__infer_8c.html#ae26c03bc6150b42f62a01df020935733">device_is_cpu</a></div><div class="ttdeci">static int device_is_cpu(const char *dev)</div><div class="ttdoc">Check whether device string selects CPU.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l02352">main_infer.c:2352</a></div></div>
<div class="ttc" id="amain__infer_8c_html_af5ac8d51b8d24639015faa2a2e699ba2"><div class="ttname"><a href="main__infer_8c.html#af5ac8d51b8d24639015faa2a2e699ba2">model_touch_bytes</a></div><div class="ttdeci">static int model_touch_bytes(model_mmap_touch_t *ctx, size_t bytes_to_touch, size_t stride_bytes, int verify_touch)</div><div class="ttdoc">Deterministically read bytes from the mapped model to force page faults.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00573">main_infer.c:573</a></div></div>
<div class="ttc" id="astructcli__extras_html"><div class="ttname"><a href="structcli__extras.html">cli_extras</a></div><div class="ttdoc">Parsed CLI options and derived configuration.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00984">main_infer.c:984</a></div></div>
<div class="ttc" id="astructexpected__tokens__table_html"><div class="ttname"><a href="structexpected__tokens__table.html">expected_tokens_table</a></div><div class="ttdoc">A table of expected tokens, loaded from a text file.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01749">main_infer.c:1749</a></div></div>
<div class="ttc" id="astructie__engine__params_html"><div class="ttname"><a href="structie__engine__params.html">ie_engine_params</a></div><div class="ttdoc">Engine creation parameters.</div><div class="ttdef"><b>Definition</b> <a href="ie__api_8h_source.html#l00054">ie_api.h:54</a></div></div>
<div class="ttc" id="astructie__engine__params_html_a0c0b5f7588c98d30e0d2535790f6f24c"><div class="ttname"><a href="structie__engine__params.html#a0c0b5f7588c98d30e0d2535790f6f24c">ie_engine_params::threads</a></div><div class="ttdeci">int threads</div><div class="ttdoc">Thread count (0 means &quot;auto&quot;).</div><div class="ttdef"><b>Definition</b> <a href="ie__api_8h_source.html#l00071">ie_api.h:71</a></div></div>
<div class="ttc" id="astructie__engine__params_html_a16a831d93768c1a6d392163596de8277"><div class="ttname"><a href="structie__engine__params.html#a16a831d93768c1a6d392163596de8277">ie_engine_params::tokenizer_path</a></div><div class="ttdeci">const char * tokenizer_path</div><div class="ttdoc">Optional tokenizer file override.</div><div class="ttdef"><b>Definition</b> <a href="ie__api_8h_source.html#l00079">ie_api.h:79</a></div></div>
<div class="ttc" id="astructie__engine__params_html_a1dff4c9644aa8bf7e389f84426c529e1"><div class="ttname"><a href="structie__engine__params.html#a1dff4c9644aa8bf7e389f84426c529e1">ie_engine_params::sparsity</a></div><div class="ttdeci">const char * sparsity</div><div class="ttdoc">Sparsity policy (e.g., &quot;none&quot;, &quot;block&quot;, &quot;auto&quot;).</div><div class="ttdef"><b>Definition</b> <a href="ie__api_8h_source.html#l00059">ie_api.h:59</a></div></div>
<div class="ttc" id="astructie__engine__params_html_a34f965300425f8c1115b2408a4adc04a"><div class="ttname"><a href="structie__engine__params.html#a34f965300425f8c1115b2408a4adc04a">ie_engine_params::prefetch</a></div><div class="ttdeci">const char * prefetch</div><div class="ttdoc">Prefetch policy (e.g., &quot;auto&quot;, &quot;on&quot;, &quot;off&quot;, or a numeric string).</div><div class="ttdef"><b>Definition</b> <a href="ie__api_8h_source.html#l00068">ie_api.h:68</a></div></div>
<div class="ttc" id="astructie__engine__params_html_a66599574f8a4b8ed7cd7132fc1c0e051"><div class="ttname"><a href="structie__engine__params.html#a66599574f8a4b8ed7cd7132fc1c0e051">ie_engine_params::affinity</a></div><div class="ttdeci">const char * affinity</div><div class="ttdoc">CPU affinity policy (e.g., &quot;auto&quot;, &quot;compact&quot;, &quot;scatter&quot;).</div><div class="ttdef"><b>Definition</b> <a href="ie__api_8h_source.html#l00062">ie_api.h:62</a></div></div>
<div class="ttc" id="astructie__engine__params_html_a92b02bad12cb4e8173728311c00960b7"><div class="ttname"><a href="structie__engine__params.html#a92b02bad12cb4e8173728311c00960b7">ie_engine_params::precision</a></div><div class="ttdeci">const char * precision</div><div class="ttdoc">Precision label (e.g., &quot;fp32&quot;, &quot;bf16&quot;, &quot;int4w&quot;).</div><div class="ttdef"><b>Definition</b> <a href="ie__api_8h_source.html#l00056">ie_api.h:56</a></div></div>
<div class="ttc" id="astructie__engine__params_html_a992270ba61612b2acb319aed5cbfca13"><div class="ttname"><a href="structie__engine__params.html#a992270ba61612b2acb319aed5cbfca13">ie_engine_params::pretranspose</a></div><div class="ttdeci">const char * pretranspose</div><div class="ttdoc">Pretranspose mode (e.g., &quot;none&quot;, &quot;woh&quot;, &quot;wxh&quot;, &quot;all&quot;).</div><div class="ttdef"><b>Definition</b> <a href="ie__api_8h_source.html#l00065">ie_api.h:65</a></div></div>
<div class="ttc" id="astructie__engine_html"><div class="ttname"><a href="structie__engine.html">ie_engine</a></div><div class="ttdef"><b>Definition</b> <a href="ie__api_8c_source.html#l00092">ie_api.c:92</a></div></div>
<div class="ttc" id="astructie__generate__stats_html"><div class="ttname"><a href="structie__generate__stats.html">ie_generate_stats</a></div><div class="ttdoc">Optional generation timing statistics.</div><div class="ttdef"><b>Definition</b> <a href="ie__api_8h_source.html#l00115">ie_api.h:115</a></div></div>
<div class="ttc" id="astructie__generate__stats_html_a1b1460ddd99269f59229371ead131768"><div class="ttname"><a href="structie__generate__stats.html#a1b1460ddd99269f59229371ead131768">ie_generate_stats::decode_time_s</a></div><div class="ttdeci">double decode_time_s</div><div class="ttdoc">Time spent in the decode loop (sampling + infer_step).</div><div class="ttdef"><b>Definition</b> <a href="ie__api_8h_source.html#l00123">ie_api.h:123</a></div></div>
<div class="ttc" id="astructie__generate__stats_html_a25833e4ea02ba3a80027c68ef1b7df4e"><div class="ttname"><a href="structie__generate__stats.html#a25833e4ea02ba3a80027c68ef1b7df4e">ie_generate_stats::prefill_time_s</a></div><div class="ttdeci">double prefill_time_s</div><div class="ttdoc">Time spent inside the prefill call.</div><div class="ttdef"><b>Definition</b> <a href="ie__api_8h_source.html#l00120">ie_api.h:120</a></div></div>
<div class="ttc" id="astructie__weights__s_html"><div class="ttname"><a href="structie__weights__s.html">ie_weights_s</a></div><div class="ttdoc">Descriptor for an opened IEBIN v1 model.</div><div class="ttdef"><b>Definition</b> <a href="ie__io_8h_source.html#l00094">ie_io.h:94</a></div></div>
<div class="ttc" id="astructmodel__mmap__touch_html"><div class="ttname"><a href="structmodel__mmap__touch.html">model_mmap_touch</a></div><div class="ttdoc">A file-backed mmap context for deterministic &quot;touch&quot; work.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00487">main_infer.c:487</a></div></div>
<div class="ttc" id="astructprompt__list_html"><div class="ttname"><a href="structprompt__list.html">prompt_list</a></div><div class="ttdoc">Prompt list (preloaded) to avoid file I/O in the timed window.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01550">main_infer.c:1550</a></div></div>
<div class="ttc" id="astructprompt__list_html_ab60c60299e5806652f4c2c7a94aca5c3"><div class="ttname"><a href="structprompt__list.html#ab60c60299e5806652f4c2c7a94aca5c3">prompt_list::count</a></div><div class="ttdeci">size_t count</div><div class="ttdoc">Number of prompts.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01552">main_infer.c:1552</a></div></div>
<div class="ttc" id="astructprompt__list_html_ad4b457e3153a399812c91acb3d2f399f"><div class="ttname"><a href="structprompt__list.html#ad4b457e3153a399812c91acb3d2f399f">prompt_list::items</a></div><div class="ttdeci">char ** items</div><div class="ttdoc">Owned prompt strings (UTF-8).</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01551">main_infer.c:1551</a></div></div>
<div class="ttc" id="astructprompt__round__record_html"><div class="ttname"><a href="structprompt__round__record.html">prompt_round_record</a></div><div class="ttdoc">Per-prompt per-round record, suitable for JSON reporting.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l02082">main_infer.c:2082</a></div></div>
<div class="ttc" id="astructprompt__round__record_html_a0c260950e8b81d2992debca2f4b49d00"><div class="ttname"><a href="structprompt__round__record.html#a0c260950e8b81d2992debca2f4b49d00">prompt_round_record::decoded_text</a></div><div class="ttdeci">char * decoded_text</div><div class="ttdoc">Optional decoded UTF-8 text (owned).</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l02101">main_infer.c:2101</a></div></div>
<div class="ttc" id="astructprompt__round__record_html_a24eceb958921c2ab6ecf6fe0cdc5da49"><div class="ttname"><a href="structprompt__round__record.html#a24eceb958921c2ab6ecf6fe0cdc5da49">prompt_round_record::actual_at</a></div><div class="ttdeci">int actual_at</div><div class="ttdoc">Actual token at mismatch.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l02099">main_infer.c:2099</a></div></div>
<div class="ttc" id="astructprompt__round__record_html_a4ab0f6440e03c15551287b69ed070d94"><div class="ttname"><a href="structprompt__round__record.html#a4ab0f6440e03c15551287b69ed070d94">prompt_round_record::prefill_time_s</a></div><div class="ttdeci">double prefill_time_s</div><div class="ttdoc">Engine-reported prefill time.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l02092">main_infer.c:2092</a></div></div>
<div class="ttc" id="astructprompt__round__record_html_a51223e3133e92ee93d77d6752e57d1bf"><div class="ttname"><a href="structprompt__round__record.html#a51223e3133e92ee93d77d6752e57d1bf">prompt_round_record::tokens</a></div><div class="ttdeci">report_token_buf_t tokens</div><div class="ttdoc">Copy of generated token IDs (optional).</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l02089">main_infer.c:2089</a></div></div>
<div class="ttc" id="astructprompt__round__record_html_a639a8578fdf0ba299afe4f0783c47567"><div class="ttname"><a href="structprompt__round__record.html#a639a8578fdf0ba299afe4f0783c47567">prompt_round_record::mismatch_index</a></div><div class="ttdeci">size_t mismatch_index</div><div class="ttdoc">First mismatch index (only meaningful when !expected_ok).</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l02097">main_infer.c:2097</a></div></div>
<div class="ttc" id="astructprompt__round__record_html_a691ac5964e952c5059b957f07a8542f5"><div class="ttname"><a href="structprompt__round__record.html#a691ac5964e952c5059b957f07a8542f5">prompt_round_record::prompt_index</a></div><div class="ttdeci">size_t prompt_index</div><div class="ttdoc">Index into the prompts list.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l02083">main_infer.c:2083</a></div></div>
<div class="ttc" id="astructprompt__round__record_html_a8cc938142194c5202bb275da807b0dbf"><div class="ttname"><a href="structprompt__round__record.html#a8cc938142194c5202bb275da807b0dbf">prompt_round_record::tokens_generated</a></div><div class="ttdeci">size_t tokens_generated</div><div class="ttdoc">Tokens generated for this prompt in this round.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l02088">main_infer.c:2088</a></div></div>
<div class="ttc" id="astructprompt__round__record_html_a8da08c83a326c2b7ab39fd7cfadb762b"><div class="ttname"><a href="structprompt__round__record.html#a8da08c83a326c2b7ab39fd7cfadb762b">prompt_round_record::window_time_s</a></div><div class="ttdeci">double window_time_s</div><div class="ttdoc">Time measured around generate + strict touch for this prompt.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l02091">main_infer.c:2091</a></div></div>
<div class="ttc" id="astructprompt__round__record_html_a9b7acfc693dc6c61df0c048c77d59c6f"><div class="ttname"><a href="structprompt__round__record.html#a9b7acfc693dc6c61df0c048c77d59c6f">prompt_round_record::prompt_id</a></div><div class="ttdeci">uint64_t prompt_id</div><div class="ttdoc">Prompt stable ID (FNV-1a).</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l02086">main_infer.c:2086</a></div></div>
<div class="ttc" id="astructprompt__round__record_html_aa08726c5eddf5bb4680d15b63b494dc8"><div class="ttname"><a href="structprompt__round__record.html#aa08726c5eddf5bb4680d15b63b494dc8">prompt_round_record::decode_time_s</a></div><div class="ttdeci">double decode_time_s</div><div class="ttdoc">Engine-reported decode time.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l02093">main_infer.c:2093</a></div></div>
<div class="ttc" id="astructprompt__round__record_html_aad02ec5870f35fcf8d7608104ed06304"><div class="ttname"><a href="structprompt__round__record.html#aad02ec5870f35fcf8d7608104ed06304">prompt_round_record::round_index</a></div><div class="ttdeci">int round_index</div><div class="ttdoc">Round index [0..rounds-1].</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l02084">main_infer.c:2084</a></div></div>
<div class="ttc" id="astructprompt__round__record_html_ad67c0f4a359b27e788a90c0477211293"><div class="ttname"><a href="structprompt__round__record.html#ad67c0f4a359b27e788a90c0477211293">prompt_round_record::expected_present</a></div><div class="ttdeci">int expected_present</div><div class="ttdoc">1 if expected tokens were found for this prompt.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l02095">main_infer.c:2095</a></div></div>
<div class="ttc" id="astructprompt__round__record_html_adbf79594fd763d49b2eb13dcbd027c90"><div class="ttname"><a href="structprompt__round__record.html#adbf79594fd763d49b2eb13dcbd027c90">prompt_round_record::expected_ok</a></div><div class="ttdeci">int expected_ok</div><div class="ttdoc">1 if actual tokens matched expected tokens.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l02096">main_infer.c:2096</a></div></div>
<div class="ttc" id="astructprompt__round__record_html_ae372c2117122aeea632490a6ea1526b1"><div class="ttname"><a href="structprompt__round__record.html#ae372c2117122aeea632490a6ea1526b1">prompt_round_record::expected_at</a></div><div class="ttdeci">int expected_at</div><div class="ttdoc">Expected token at mismatch.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l02098">main_infer.c:2098</a></div></div>
<div class="ttc" id="astructreport__token__buf_html_a89ffa03443f19bf77470f85a92baa245"><div class="ttname"><a href="structreport__token__buf.html#a89ffa03443f19bf77470f85a92baa245">report_token_buf::n</a></div><div class="ttdeci">size_t n</div><div class="ttdoc">Number of valid tokens.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l02024">main_infer.c:2024</a></div></div>
<div class="ttc" id="astructreport__token__buf_html_a91b6556df06c25b311255a4a16f785dd"><div class="ttname"><a href="structreport__token__buf.html#a91b6556df06c25b311255a4a16f785dd">report_token_buf::ids</a></div><div class="ttdeci">int * ids</div><div class="ttdoc">Owned token IDs (int).</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l02023">main_infer.c:2023</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="main__infer_8c_source.html#l02099">prompt_round_record::actual_at</a>, <a class="el" href="ie__api_8h_source.html#l00062">ie_engine_params::affinity</a>, <a class="el" href="main__infer_8c_source.html#l00988">cli_extras::affinity</a>, <a class="el" href="main__infer_8c_source.html#l00996">cli_extras::aggregate</a>, <a class="el" href="main__infer_8c_source.html#l01231">apply_cli_debug_env()</a>, <a class="el" href="main__infer_8c_source.html#l00166">ascii_ieq()</a>, <a class="el" href="main__infer_8c_source.html#l00975">CLI_PRETX_NONE</a>, <a class="el" href="main__infer_8c_source.html#l00976">CLI_PRETX_WOH</a>, <a class="el" href="main__infer_8c_source.html#l00977">CLI_PRETX_WXH</a>, <a class="el" href="main__infer_8c_source.html#l01552">prompt_list::count</a>, <a class="el" href="main__infer_8c_source.html#l00655">cudart_get_api()</a>, <a class="el" href="main__infer_8c_source.html#l00697">cudart_touch_bytes()</a>, <a class="el" href="ie__api_8h_source.html#l00123">ie_generate_stats::decode_time_s</a>, <a class="el" href="main__infer_8c_source.html#l02093">prompt_round_record::decode_time_s</a>, <a class="el" href="main__infer_8c_source.html#l00866">decode_tokens_best_effort()</a>, <a class="el" href="main__infer_8c_source.html#l02101">prompt_round_record::decoded_text</a>, <a class="el" href="main__infer_8c_source.html#l00990">cli_extras::device</a>, <a class="el" href="main__infer_8c_source.html#l02352">device_is_cpu()</a>, <a class="el" href="main__infer_8c_source.html#l02345">device_is_cuda()</a>, <a class="el" href="main__infer_8c_source.html#l00245">dir_accessible()</a>, <a class="el" href="main__infer_8c_source.html#l00133">env_long()</a>, <a class="el" href="main__infer_8c_source.html#l00147">env_str()</a>, <a class="el" href="main__infer_8c_source.html#l02098">prompt_round_record::expected_at</a>, <a class="el" href="main__infer_8c_source.html#l02096">prompt_round_record::expected_ok</a>, <a class="el" href="main__infer_8c_source.html#l02095">prompt_round_record::expected_present</a>, <a class="el" href="main__infer_8c_source.html#l01832">expected_tokens_compare()</a>, <a class="el" href="main__infer_8c_source.html#l01000">cli_extras::expected_tokens_file</a>, <a class="el" href="main__infer_8c_source.html#l02006">expected_tokens_find()</a>, <a class="el" href="main__infer_8c_source.html#l01780">expected_tokens_table_free()</a>, <a class="el" href="main__infer_8c_source.html#l01764">expected_tokens_table_init()</a>, <a class="el" href="main__infer_8c_source.html#l01944">expected_tokens_table_load()</a>, <a class="el" href="main__infer_8c_source.html#l00449">heap_strdup()</a>, <a class="el" href="main__infer_8c_source.html#l02023">report_token_buf::ids</a>, <a class="el" href="ie__api_8c_source.html#l00535">ie_engine_create()</a>, <a class="el" href="ie__api_8c_source.html#l00788">ie_engine_destroy()</a>, <a class="el" href="ie__api_8c_source.html#l00818">ie_engine_generate()</a>, <a class="el" href="ie__api_8c_source.html#l00826">ie_engine_generate_ex()</a>, <a class="el" href="ie__io_8h_source.html#l00064">IE_IO_OK</a>, <a class="el" href="ie__kv__instrumentation_8c_source.html#l00031">ie_kv_begin_round()</a>, <a class="el" href="ie__kv__instrumentation_8c_source.html#l00048">ie_kv_finish_round()</a>, <a class="el" href="ie__api_8h_source.html#l00034">IE_OK</a>, <a class="el" href="weights_8c_source.html#l01356">ie_weights_close()</a>, <a class="el" href="weights_8c_source.html#l00988">ie_weights_open()</a>, <a class="el" href="main__infer_8c_source.html#l01551">prompt_list::items</a>, <a class="el" href="main__infer_8c_source.html#l00986">cli_extras::max_new</a>, <a class="el" href="main__infer_8c_source.html#l02097">prompt_round_record::mismatch_index</a>, <a class="el" href="main__infer_8c_source.html#l01006">cli_extras::model_bin</a>, <a class="el" href="main__infer_8c_source.html#l01004">cli_extras::model_dir</a>, <a class="el" href="main__infer_8c_source.html#l01005">cli_extras::model_json</a>, <a class="el" href="main__infer_8c_source.html#l00573">model_touch_bytes()</a>, <a class="el" href="main__infer_8c_source.html#l00551">model_touch_close()</a>, <a class="el" href="main__infer_8c_source.html#l00508">model_touch_open()</a>, <a class="el" href="main__infer_8c_source.html#l02024">report_token_buf::n</a>, <a class="el" href="main__infer_8c_source.html#l01743">expected_tokens_entry::n_tokens</a>, <a class="el" href="main__infer_8c_source.html#l00209">now_sec()</a>, <a class="el" href="main__infer_8c_source.html#l01308">parse_flags()</a>, <a class="el" href="main__infer_8c_source.html#l00227">path_exists()</a>, <a class="el" href="main__infer_8c_source.html#l00081">PATH_MAX</a>, <a class="el" href="ie__api_8h_source.html#l00056">ie_engine_params::precision</a>, <a class="el" href="main__infer_8c_source.html#l01009">cli_extras::precision_from_flag</a>, <a class="el" href="main__infer_8c_source.html#l01008">cli_extras::precision_label</a>, <a class="el" href="ie__api_8h_source.html#l00068">ie_engine_params::prefetch</a>, <a class="el" href="main__infer_8c_source.html#l00994">cli_extras::prefetch</a>, <a class="el" href="ie__api_8h_source.html#l00120">ie_generate_stats::prefill_time_s</a>, <a class="el" href="main__infer_8c_source.html#l02092">prompt_round_record::prefill_time_s</a>, <a class="el" href="ie__api_8h_source.html#l00065">ie_engine_params::pretranspose</a>, <a class="el" href="main__infer_8c_source.html#l00989">cli_extras::pretx</a>, <a class="el" href="main__infer_8c_source.html#l02171">print_json_result()</a>, <a class="el" href="main__infer_8c_source.html#l01015">cli_extras::print_text</a>, <a class="el" href="main__infer_8c_source.html#l00985">cli_extras::prompt</a>, <a class="el" href="main__infer_8c_source.html#l02086">prompt_round_record::prompt_id</a>, <a class="el" href="main__infer_8c_source.html#l01690">prompt_id_fnv1a64()</a>, <a class="el" href="main__infer_8c_source.html#l02083">prompt_round_record::prompt_index</a>, <a class="el" href="main__infer_8c_source.html#l01581">prompt_list_free()</a>, <a class="el" href="main__infer_8c_source.html#l01565">prompt_list_init()</a>, <a class="el" href="main__infer_8c_source.html#l01606">prompt_list_push_copy()</a>, <a class="el" href="main__infer_8c_source.html#l01641">prompt_list_read_file()</a>, <a class="el" href="main__infer_8c_source.html#l02113">prompt_round_record_free()</a>, <a class="el" href="main__infer_8c_source.html#l00992">cli_extras::prompts_file</a>, <a class="el" href="main__infer_8c_source.html#l01527">read_first_nonempty_line()</a>, <a class="el" href="main__infer_8c_source.html#l02062">report_token_buf_copy()</a>, <a class="el" href="main__infer_8c_source.html#l01001">cli_extras::report_tokens</a>, <a class="el" href="main__infer_8c_source.html#l01002">cli_extras::report_tokens_max</a>, <a class="el" href="main__infer_8c_source.html#l00378">resolve_model_paths()</a>, <a class="el" href="main__infer_8c_source.html#l00810">resolve_tokenizer_path()</a>, <a class="el" href="main__infer_8c_source.html#l02084">prompt_round_record::round_index</a>, <a class="el" href="main__infer_8c_source.html#l00997">cli_extras::rounds</a>, <a class="el" href="main__infer_8c_source.html#l00437">rss_peak_mib()</a>, <a class="el" href="ie__api_8h_source.html#l00059">ie_engine_params::sparsity</a>, <a class="el" href="main__infer_8c_source.html#l01011">cli_extras::sparsity</a>, <a class="el" href="main__infer_8c_source.html#l01012">cli_extras::sparsity_from_flag</a>, <a class="el" href="ie__api_8h_source.html#l00071">ie_engine_params::threads</a>, <a class="el" href="main__infer_8c_source.html#l00987">cli_extras::threads</a>, <a class="el" href="ie__api_8h_source.html#l00079">ie_engine_params::tokenizer_path</a>, <a class="el" href="main__infer_8c_source.html#l01016">cli_extras::tokenizer_path</a>, <a class="el" href="main__infer_8c_source.html#l01742">expected_tokens_entry::tokens</a>, <a class="el" href="main__infer_8c_source.html#l02089">prompt_round_record::tokens</a>, <a class="el" href="main__infer_8c_source.html#l02088">prompt_round_record::tokens_generated</a>, <a class="el" href="main__infer_8c_source.html#l00995">cli_extras::warmup_tokens</a>, and <a class="el" href="main__infer_8c_source.html#l02091">prompt_round_record::window_time_s</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a3c04138a5bfe5d72780bb7e82a18e627_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a42d8c2f3c8817b30177d0a7e39742b03" name="a42d8c2f3c8817b30177d0a7e39742b03"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a42d8c2f3c8817b30177d0a7e39742b03">&#9670;&#160;</a></span>min_size()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static size_t min_size </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return the smaller of two size_t values. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">a</td><td>First value. </td></tr>
    <tr><td class="paramname">b</td><td>Second value. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>min(a,b). </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00117">117</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  117</span>{ <span class="keywordflow">return</span> (a &lt; b) ? a : b; }</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l00697">cudart_touch_bytes()</a>, and <a class="el" href="main__infer_8c_source.html#l00866">decode_tokens_best_effort()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a42d8c2f3c8817b30177d0a7e39742b03_icgraph.svg" width="396" height="102"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="af5ac8d51b8d24639015faa2a2e699ba2" name="af5ac8d51b8d24639015faa2a2e699ba2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af5ac8d51b8d24639015faa2a2e699ba2">&#9670;&#160;</a></span>model_touch_bytes()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int model_touch_bytes </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="main__infer_8c.html#a54f0d9b3968af3eb368f8847cd420950">model_mmap_touch_t</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>bytes_to_touch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>stride_bytes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>verify_touch</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Deterministically read bytes from the mapped model to force page faults. </p>
<p>This reads file-backed pages so that RSS/majflt reflect real paging behavior. The reads are strided and continue from ctx-&gt;cursor, wrapping around.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ctx</td><td>Open model touch context. </td></tr>
    <tr><td class="paramname">bytes_to_touch</td><td>Total bytes to cover (capped to ctx-&gt;size). </td></tr>
    <tr><td class="paramname">stride_bytes</td><td>Read stride (minimum 1). </td></tr>
    <tr><td class="paramname">verify_touch</td><td>If nonzero, perform a small anti-optimization check. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, nonzero on error. </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00573">573</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  576</span>                                               {</div>
<div class="line"><span class="lineno">  577</span>  <span class="keywordflow">if</span> (!ctx || !ctx-&gt;<a class="code hl_variable" href="structmodel__mmap__touch.html#a54141a2f335b552fc983228129bdd606">base</a> || ctx-&gt;<a class="code hl_variable" href="structmodel__mmap__touch.html#aabdfb060ddd6fa73f42db548196ffe6e">size</a> == 0) <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  578</span>  <span class="keywordflow">if</span> (bytes_to_touch == 0) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  579</span>  <span class="keywordflow">if</span> (stride_bytes == 0) stride_bytes = 1;</div>
<div class="line"><span class="lineno">  580</span> </div>
<div class="line"><span class="lineno">  581</span>  <span class="keyword">const</span> <span class="keywordtype">size_t</span> size = ctx-&gt;<a class="code hl_variable" href="structmodel__mmap__touch.html#aabdfb060ddd6fa73f42db548196ffe6e">size</a>;</div>
<div class="line"><span class="lineno">  582</span>  <span class="keywordtype">size_t</span> n = bytes_to_touch;</div>
<div class="line"><span class="lineno">  583</span>  <span class="keywordflow">if</span> (n &gt; size) n = size;</div>
<div class="line"><span class="lineno">  584</span> </div>
<div class="line"><span class="lineno">  585</span>  <span class="keyword">volatile</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *p = (<span class="keyword">volatile</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)ctx-&gt;<a class="code hl_variable" href="structmodel__mmap__touch.html#a54141a2f335b552fc983228129bdd606">base</a>;</div>
<div class="line"><span class="lineno">  586</span>  <span class="keyword">volatile</span> uint64_t acc = 0;</div>
<div class="line"><span class="lineno">  587</span> </div>
<div class="line"><span class="lineno">  588</span>  <span class="keywordtype">size_t</span> start = ctx-&gt;<a class="code hl_variable" href="structmodel__mmap__touch.html#a99a97f91127ac01736ee6aad39f22b35">cursor</a> % size;</div>
<div class="line"><span class="lineno">  589</span> </div>
<div class="line"><span class="lineno">  590</span>  <span class="keywordflow">if</span> (start + n &lt;= size) {</div>
<div class="line"><span class="lineno">  591</span>    <span class="keywordtype">size_t</span> end = start + n;</div>
<div class="line"><span class="lineno">  592</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> off = start; off &lt; end; off += stride_bytes) acc ^= (uint64_t)p[off];</div>
<div class="line"><span class="lineno">  593</span>    ctx-&gt;<a class="code hl_variable" href="structmodel__mmap__touch.html#a99a97f91127ac01736ee6aad39f22b35">cursor</a> = end % size;</div>
<div class="line"><span class="lineno">  594</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  595</span>    <span class="keywordtype">size_t</span> first = size - start;</div>
<div class="line"><span class="lineno">  596</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> off = start; off &lt; size; off += stride_bytes) acc ^= (uint64_t)p[off];</div>
<div class="line"><span class="lineno">  597</span> </div>
<div class="line"><span class="lineno">  598</span>    <span class="keywordtype">size_t</span> rem = n - first;</div>
<div class="line"><span class="lineno">  599</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> off = 0; off &lt; rem; off += stride_bytes) acc ^= (uint64_t)p[off];</div>
<div class="line"><span class="lineno">  600</span>    ctx-&gt;<a class="code hl_variable" href="structmodel__mmap__touch.html#a99a97f91127ac01736ee6aad39f22b35">cursor</a> = rem % size;</div>
<div class="line"><span class="lineno">  601</span>  }</div>
<div class="line"><span class="lineno">  602</span> </div>
<div class="line"><span class="lineno">  603</span>  <span class="keywordflow">if</span> (verify_touch) {</div>
<div class="line"><span class="lineno">  604</span>    <span class="keywordflow">if</span> (acc == 0x9e3779b97f4a7c15ULL) {</div>
<div class="line"><span class="lineno">  605</span>      fprintf(stderr, <span class="stringliteral">&quot;touch verify: improbable accumulator value (ignore)\n&quot;</span>);</div>
<div class="line"><span class="lineno">  606</span>    }</div>
<div class="line"><span class="lineno">  607</span>  }</div>
<div class="line"><span class="lineno">  608</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  609</span>}</div>
<div class="ttc" id="astructmodel__mmap__touch_html_a54141a2f335b552fc983228129bdd606"><div class="ttname"><a href="structmodel__mmap__touch.html#a54141a2f335b552fc983228129bdd606">model_mmap_touch::base</a></div><div class="ttdeci">void * base</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00489">main_infer.c:489</a></div></div>
<div class="ttc" id="astructmodel__mmap__touch_html_a99a97f91127ac01736ee6aad39f22b35"><div class="ttname"><a href="structmodel__mmap__touch.html#a99a97f91127ac01736ee6aad39f22b35">model_mmap_touch::cursor</a></div><div class="ttdeci">size_t cursor</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00491">main_infer.c:491</a></div></div>
<div class="ttc" id="astructmodel__mmap__touch_html_aabdfb060ddd6fa73f42db548196ffe6e"><div class="ttname"><a href="structmodel__mmap__touch.html#aabdfb060ddd6fa73f42db548196ffe6e">model_mmap_touch::size</a></div><div class="ttdeci">size_t size</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00490">main_infer.c:490</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="main__infer_8c_source.html#l00489">model_mmap_touch::base</a>, <a class="el" href="main__infer_8c_source.html#l00491">model_mmap_touch::cursor</a>, and <a class="el" href="main__infer_8c_source.html#l00490">model_mmap_touch::size</a>.</p>

<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l02362">main()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_af5ac8d51b8d24639015faa2a2e699ba2_icgraph.svg" width="263" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a6d67a99243e339c4acabd9ed9b84002c" name="a6d67a99243e339c4acabd9ed9b84002c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6d67a99243e339c4acabd9ed9b84002c">&#9670;&#160;</a></span>model_touch_close()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void model_touch_close </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="main__infer_8c.html#a54f0d9b3968af3eb368f8847cd420950">model_mmap_touch_t</a> *&#160;</td>
          <td class="paramname"><em>ctx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Close and unmap a model touch context. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ctx</td><td>Context to close (safe to call repeatedly).</td></tr>
  </table>
  </dd>
</dl>
<p>model_touch_close.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ctx</td><td>See implementation for details. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00551">551</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  551</span>                                                       {</div>
<div class="line"><span class="lineno">  552</span>  <span class="keywordflow">if</span> (!ctx) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  553</span>  <span class="keywordflow">if</span> (ctx-&gt;<a class="code hl_variable" href="structmodel__mmap__touch.html#a54141a2f335b552fc983228129bdd606">base</a> &amp;&amp; ctx-&gt;<a class="code hl_variable" href="structmodel__mmap__touch.html#a54141a2f335b552fc983228129bdd606">base</a> != MAP_FAILED &amp;&amp; ctx-&gt;<a class="code hl_variable" href="structmodel__mmap__touch.html#aabdfb060ddd6fa73f42db548196ffe6e">size</a>) (void)munmap(ctx-&gt;<a class="code hl_variable" href="structmodel__mmap__touch.html#a54141a2f335b552fc983228129bdd606">base</a>, ctx-&gt;<a class="code hl_variable" href="structmodel__mmap__touch.html#aabdfb060ddd6fa73f42db548196ffe6e">size</a>);</div>
<div class="line"><span class="lineno">  554</span>  ctx-&gt;<a class="code hl_variable" href="structmodel__mmap__touch.html#a54141a2f335b552fc983228129bdd606">base</a> = NULL;</div>
<div class="line"><span class="lineno">  555</span>  ctx-&gt;<a class="code hl_variable" href="structmodel__mmap__touch.html#aabdfb060ddd6fa73f42db548196ffe6e">size</a> = 0;</div>
<div class="line"><span class="lineno">  556</span>  <span class="keywordflow">if</span> (ctx-&gt;<a class="code hl_variable" href="structmodel__mmap__touch.html#aa4b9a2f532f12c85f152012e47a34ff7">fd</a> &gt;= 0) (void)close(ctx-&gt;<a class="code hl_variable" href="structmodel__mmap__touch.html#aa4b9a2f532f12c85f152012e47a34ff7">fd</a>);</div>
<div class="line"><span class="lineno">  557</span>  ctx-&gt;<a class="code hl_variable" href="structmodel__mmap__touch.html#aa4b9a2f532f12c85f152012e47a34ff7">fd</a> = -1;</div>
<div class="line"><span class="lineno">  558</span>  ctx-&gt;<a class="code hl_variable" href="structmodel__mmap__touch.html#a99a97f91127ac01736ee6aad39f22b35">cursor</a> = 0;</div>
<div class="line"><span class="lineno">  559</span>}</div>
<div class="ttc" id="astructmodel__mmap__touch_html_aa4b9a2f532f12c85f152012e47a34ff7"><div class="ttname"><a href="structmodel__mmap__touch.html#aa4b9a2f532f12c85f152012e47a34ff7">model_mmap_touch::fd</a></div><div class="ttdeci">int fd</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00488">main_infer.c:488</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="main__infer_8c_source.html#l00489">model_mmap_touch::base</a>, <a class="el" href="main__infer_8c_source.html#l00491">model_mmap_touch::cursor</a>, <a class="el" href="main__infer_8c_source.html#l00488">model_mmap_touch::fd</a>, and <a class="el" href="main__infer_8c_source.html#l00490">model_mmap_touch::size</a>.</p>

<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l02362">main()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a6d67a99243e339c4acabd9ed9b84002c_icgraph.svg" width="260" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ac67780918b483167f77ec879306c781c" name="ac67780918b483167f77ec879306c781c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac67780918b483167f77ec879306c781c">&#9670;&#160;</a></span>model_touch_open()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int model_touch_open </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="main__infer_8c.html#a54f0d9b3968af3eb368f8847cd420950">model_mmap_touch_t</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Initialize a file-backed read-only mmap for the given path. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ctx</td><td>Context to initialize. </td></tr>
    <tr><td class="paramname">path</td><td>File path to map. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, nonzero on failure.</dd></dl>
<p>model_touch_open.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ctx</td><td>See implementation for details. </td></tr>
    <tr><td class="paramname">path</td><td>See implementation for details.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>See implementation for details. </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00508">508</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  508</span>                                                                       {</div>
<div class="line"><span class="lineno">  509</span>  <span class="keywordflow">if</span> (!ctx) <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  510</span>  memset(ctx, 0, <span class="keyword">sizeof</span>(*ctx));</div>
<div class="line"><span class="lineno">  511</span>  ctx-&gt;<a class="code hl_variable" href="structmodel__mmap__touch.html#aa4b9a2f532f12c85f152012e47a34ff7">fd</a> = -1;</div>
<div class="line"><span class="lineno">  512</span> </div>
<div class="line"><span class="lineno">  513</span>  <span class="keywordflow">if</span> (!path || !*path) <span class="keywordflow">return</span> 2;</div>
<div class="line"><span class="lineno">  514</span> </div>
<div class="line"><span class="lineno">  515</span>  <span class="keywordtype">int</span> fd = open(path, O_RDONLY);</div>
<div class="line"><span class="lineno">  516</span>  <span class="keywordflow">if</span> (fd &lt; 0) <span class="keywordflow">return</span> 3;</div>
<div class="line"><span class="lineno">  517</span> </div>
<div class="line"><span class="lineno">  518</span>  <span class="keyword">struct </span>stat st;</div>
<div class="line"><span class="lineno">  519</span>  <span class="keywordflow">if</span> (fstat(fd, &amp;st) != 0) {</div>
<div class="line"><span class="lineno">  520</span>    (void)close(fd);</div>
<div class="line"><span class="lineno">  521</span>    <span class="keywordflow">return</span> 4;</div>
<div class="line"><span class="lineno">  522</span>  }</div>
<div class="line"><span class="lineno">  523</span>  <span class="keywordflow">if</span> (st.st_size &lt;= 0) {</div>
<div class="line"><span class="lineno">  524</span>    (void)close(fd);</div>
<div class="line"><span class="lineno">  525</span>    <span class="keywordflow">return</span> 5;</div>
<div class="line"><span class="lineno">  526</span>  }</div>
<div class="line"><span class="lineno">  527</span> </div>
<div class="line"><span class="lineno">  528</span>  <span class="keywordtype">size_t</span> sz = (size_t)st.st_size;</div>
<div class="line"><span class="lineno">  529</span>  <span class="keywordtype">void</span> *base = mmap(NULL, sz, PROT_READ, MAP_PRIVATE, fd, 0);</div>
<div class="line"><span class="lineno">  530</span>  <span class="keywordflow">if</span> (base == MAP_FAILED) {</div>
<div class="line"><span class="lineno">  531</span>    (void)close(fd);</div>
<div class="line"><span class="lineno">  532</span>    <span class="keywordflow">return</span> 6;</div>
<div class="line"><span class="lineno">  533</span>  }</div>
<div class="line"><span class="lineno">  534</span> </div>
<div class="line"><span class="lineno">  535</span>  ctx-&gt;<a class="code hl_variable" href="structmodel__mmap__touch.html#aa4b9a2f532f12c85f152012e47a34ff7">fd</a> = fd;</div>
<div class="line"><span class="lineno">  536</span>  ctx-&gt;<a class="code hl_variable" href="structmodel__mmap__touch.html#a54141a2f335b552fc983228129bdd606">base</a> = base;</div>
<div class="line"><span class="lineno">  537</span>  ctx-&gt;<a class="code hl_variable" href="structmodel__mmap__touch.html#aabdfb060ddd6fa73f42db548196ffe6e">size</a> = sz;</div>
<div class="line"><span class="lineno">  538</span>  ctx-&gt;<a class="code hl_variable" href="structmodel__mmap__touch.html#a99a97f91127ac01736ee6aad39f22b35">cursor</a> = 0;</div>
<div class="line"><span class="lineno">  539</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  540</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="main__infer_8c_source.html#l00489">model_mmap_touch::base</a>, <a class="el" href="main__infer_8c_source.html#l00491">model_mmap_touch::cursor</a>, <a class="el" href="main__infer_8c_source.html#l00488">model_mmap_touch::fd</a>, and <a class="el" href="main__infer_8c_source.html#l00490">model_mmap_touch::size</a>.</p>

<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l02362">main()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_ac67780918b483167f77ec879306c781c_icgraph.svg" width="259" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a4fdbfffdaa0f22a01822f6a62bb7e95e" name="a4fdbfffdaa0f22a01822f6a62bb7e95e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4fdbfffdaa0f22a01822f6a62bb7e95e">&#9670;&#160;</a></span>now_sec()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static double now_sec </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return monotonic time in seconds. </p>
<dl class="section return"><dt>Returns</dt><dd>Seconds since an unspecified epoch (monotonic).</dd></dl>
<p>now_sec.</p>
<dl class="section return"><dt>Returns</dt><dd>See implementation for details. </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00209">209</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  209</span>                            {</div>
<div class="line"><span class="lineno">  210</span>  <span class="keyword">struct </span>timespec ts;</div>
<div class="line"><span class="lineno">  211</span>  (void)clock_gettime(CLOCK_MONOTONIC, &amp;ts);</div>
<div class="line"><span class="lineno">  212</span>  <span class="keywordflow">return</span> (<span class="keywordtype">double</span>)ts.tv_sec + (double)ts.tv_nsec * 1e-9;</div>
<div class="line"><span class="lineno">  213</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l02362">main()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a4fdbfffdaa0f22a01822f6a62bb7e95e_icgraph.svg" width="192" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a456ba954f3884bcf5f72fc3e779de284" name="a456ba954f3884bcf5f72fc3e779de284"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a456ba954f3884bcf5f72fc3e779de284">&#9670;&#160;</a></span>parse_flags()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int parse_flags </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>argv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="main__infer_8c.html#a9973434ae2443cc726369b714df7b2cb">cli_extras_t</a> *&#160;</td>
          <td class="paramname"><em>out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Parse CLI flags into cli_extras_t. </p>
<p>Parsing is intentionally strict: invalid flags or values return nonzero to keep harness behavior deterministic.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">argc</td><td>argc. </td></tr>
    <tr><td class="paramname">argv</td><td>argv. </td></tr>
    <tr><td class="paramname">out</td><td>Output options. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, nonzero on help/error.</dd></dl>
<p>parse_flags.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">argc</td><td>See implementation for details. </td></tr>
    <tr><td class="paramname">argv</td><td>See implementation for details. </td></tr>
    <tr><td class="paramname">out</td><td>See implementation for details.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>See implementation for details. </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l01308">1308</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1308</span>                                                                 {</div>
<div class="line"><span class="lineno"> 1309</span>  <a class="code hl_function" href="main__infer_8c.html#a25c42477bc56f4eb2d2a5c53e4510d70">cli_extras_defaults</a>(out);</div>
<div class="line"><span class="lineno"> 1310</span> </div>
<div class="line"><span class="lineno"> 1311</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt; argc; ++i) {</div>
<div class="line"><span class="lineno"> 1312</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *a = argv[i];</div>
<div class="line"><span class="lineno"> 1313</span> </div>
<div class="line"><span class="lineno"> 1314</span>    <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;--help&quot;</span>) || !strcmp(a, <span class="stringliteral">&quot;-h&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1315</span>      <a class="code hl_function" href="main__infer_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a>();</div>
<div class="line"><span class="lineno"> 1316</span>      <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 1317</span> </div>
<div class="line"><span class="lineno"> 1318</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;--prompt&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1319</span>      <span class="keywordflow">if</span> (++i &gt;= argc) { <a class="code hl_function" href="main__infer_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a>(); <span class="keywordflow">return</span> -1; }</div>
<div class="line"><span class="lineno"> 1320</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;prompt = argv[i];</div>
<div class="line"><span class="lineno"> 1321</span> </div>
<div class="line"><span class="lineno"> 1322</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;--max-new&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1323</span>      <span class="keywordflow">if</span> (++i &gt;= argc) { <a class="code hl_function" href="main__infer_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a>(); <span class="keywordflow">return</span> -1; }</div>
<div class="line"><span class="lineno"> 1324</span>      <span class="keywordtype">long</span> v = <a class="code hl_function" href="main__infer_8c.html#a42cabe54dce1190125a12e4c0360ce22">safe_atoi</a>(argv[i]);</div>
<div class="line"><span class="lineno"> 1325</span>      <span class="keywordflow">if</span> (v &lt; 0) { fprintf(stderr, <span class="stringliteral">&quot;error: --max-new &gt;= 0\n&quot;</span>); <span class="keywordflow">return</span> -1; }</div>
<div class="line"><span class="lineno"> 1326</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;max_new = (size_t)v;</div>
<div class="line"><span class="lineno"> 1327</span> </div>
<div class="line"><span class="lineno"> 1328</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;--threads&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1329</span>      <span class="keywordflow">if</span> (++i &gt;= argc) { <a class="code hl_function" href="main__infer_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a>(); <span class="keywordflow">return</span> -1; }</div>
<div class="line"><span class="lineno"> 1330</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;threads = (int)<a class="code hl_function" href="main__infer_8c.html#a42cabe54dce1190125a12e4c0360ce22">safe_atoi</a>(argv[i]);</div>
<div class="line"><span class="lineno"> 1331</span> </div>
<div class="line"><span class="lineno"> 1332</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;--precision&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1333</span>      <span class="keywordflow">if</span> (++i &gt;= argc) { <a class="code hl_function" href="main__infer_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a>(); <span class="keywordflow">return</span> -1; }</div>
<div class="line"><span class="lineno"> 1334</span>      <span class="keyword">const</span> <span class="keywordtype">char</span> *m = argv[i];</div>
<div class="line"><span class="lineno"> 1335</span> </div>
<div class="line"><span class="lineno"> 1336</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#a72ab94aafe7740f1343d317daa89ca15">ascii_ieq</a>(m, IE_PREC_FP32)) { <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;precision_label = IE_PREC_FP32; <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;precision_from_flag = 1; }</div>
<div class="line"><span class="lineno"> 1337</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#a72ab94aafe7740f1343d317daa89ca15">ascii_ieq</a>(m, IE_PREC_BF16)) { <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;precision_label = IE_PREC_BF16; <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;precision_from_flag = 1; }</div>
<div class="line"><span class="lineno"> 1338</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#a72ab94aafe7740f1343d317daa89ca15">ascii_ieq</a>(m, IE_PREC_FP16)) { <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;precision_label = IE_PREC_FP16; <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;precision_from_flag = 1; }</div>
<div class="line"><span class="lineno"> 1339</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#a72ab94aafe7740f1343d317daa89ca15">ascii_ieq</a>(m, IE_PREC_INT8W)) { <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;precision_label = IE_PREC_INT8W; <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;precision_from_flag = 1; }</div>
<div class="line"><span class="lineno"> 1340</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#a72ab94aafe7740f1343d317daa89ca15">ascii_ieq</a>(m, IE_PREC_INT4W)) { <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;precision_label = IE_PREC_INT4W; <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;precision_from_flag = 1; }</div>
<div class="line"><span class="lineno"> 1341</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#a72ab94aafe7740f1343d317daa89ca15">ascii_ieq</a>(m, IE_PREC_INT4)) { <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;precision_label = IE_PREC_INT4; <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;precision_from_flag = 1; }</div>
<div class="line"><span class="lineno"> 1342</span>      <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1343</span>        fprintf(stderr, <span class="stringliteral">&quot;error: unknown precision &#39;%s&#39;\n&quot;</span>, m);</div>
<div class="line"><span class="lineno"> 1344</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 1345</span>      }</div>
<div class="line"><span class="lineno"> 1346</span> </div>
<div class="line"><span class="lineno"> 1347</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;--sparsity&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1348</span>      <span class="keywordflow">if</span> (++i &gt;= argc) { <a class="code hl_function" href="main__infer_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a>(); <span class="keywordflow">return</span> -1; }</div>
<div class="line"><span class="lineno"> 1349</span>      <span class="keyword">const</span> <span class="keywordtype">char</span> *m = argv[i];</div>
<div class="line"><span class="lineno"> 1350</span> </div>
<div class="line"><span class="lineno"> 1351</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#a72ab94aafe7740f1343d317daa89ca15">ascii_ieq</a>(m, <span class="stringliteral">&quot;none&quot;</span>) || <a class="code hl_function" href="main__infer_8c.html#a72ab94aafe7740f1343d317daa89ca15">ascii_ieq</a>(m, <span class="stringliteral">&quot;dense&quot;</span>)) <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;sparsity = <span class="stringliteral">&quot;none&quot;</span>;</div>
<div class="line"><span class="lineno"> 1352</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#a72ab94aafe7740f1343d317daa89ca15">ascii_ieq</a>(m, <span class="stringliteral">&quot;block&quot;</span>) || <a class="code hl_function" href="main__infer_8c.html#a72ab94aafe7740f1343d317daa89ca15">ascii_ieq</a>(m, <span class="stringliteral">&quot;blocksparse&quot;</span>)) <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;sparsity = <span class="stringliteral">&quot;block&quot;</span>;</div>
<div class="line"><span class="lineno"> 1353</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#a72ab94aafe7740f1343d317daa89ca15">ascii_ieq</a>(m, <span class="stringliteral">&quot;auto&quot;</span>)) <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;sparsity = <span class="stringliteral">&quot;auto&quot;</span>;</div>
<div class="line"><span class="lineno"> 1354</span>      <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1355</span>        fprintf(stderr, <span class="stringliteral">&quot;error: unknown sparsity &#39;%s&#39; (expected none|block|auto)\n&quot;</span>, m);</div>
<div class="line"><span class="lineno"> 1356</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 1357</span>      }</div>
<div class="line"><span class="lineno"> 1358</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;sparsity_from_flag = 1;</div>
<div class="line"><span class="lineno"> 1359</span> </div>
<div class="line"><span class="lineno"> 1360</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;--affinity&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1361</span>      <span class="keywordflow">if</span> (++i &gt;= argc) { <a class="code hl_function" href="main__infer_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a>(); <span class="keywordflow">return</span> -1; }</div>
<div class="line"><span class="lineno"> 1362</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;affinity = argv[i];</div>
<div class="line"><span class="lineno"> 1363</span> </div>
<div class="line"><span class="lineno"> 1364</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;--pretranspose&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1365</span>      <span class="keywordflow">if</span> (++i &gt;= argc) { <a class="code hl_function" href="main__infer_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a>(); <span class="keywordflow">return</span> -1; }</div>
<div class="line"><span class="lineno"> 1366</span>      <span class="keyword">const</span> <span class="keywordtype">char</span> *p = argv[i];</div>
<div class="line"><span class="lineno"> 1367</span> </div>
<div class="line"><span class="lineno"> 1368</span>      <span class="keywordflow">if</span> (!strcmp(p, <span class="stringliteral">&quot;none&quot;</span>)) <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;pretx = <a class="code hl_enumvalue" href="main__infer_8c.html#ae715f0cc745f58eebd4be50b187dd41da382ceb68dddaaf8b27ac21f144305e74">CLI_PRETX_NONE</a>;</div>
<div class="line"><span class="lineno"> 1369</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(p, <span class="stringliteral">&quot;woh&quot;</span>)) <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;pretx = <a class="code hl_enumvalue" href="main__infer_8c.html#ae715f0cc745f58eebd4be50b187dd41da9d22d4f265254a65af9fc3a7d648fe5d">CLI_PRETX_WOH</a>;</div>
<div class="line"><span class="lineno"> 1370</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(p, <span class="stringliteral">&quot;wxh&quot;</span>)) <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;pretx = <a class="code hl_enumvalue" href="main__infer_8c.html#ae715f0cc745f58eebd4be50b187dd41da1a251ee24fdcadcaf9c888e0a96140e7">CLI_PRETX_WXH</a>;</div>
<div class="line"><span class="lineno"> 1371</span>      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(p, <span class="stringliteral">&quot;all&quot;</span>)) <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;pretx = <a class="code hl_enumvalue" href="main__infer_8c.html#ae715f0cc745f58eebd4be50b187dd41da4fad867319e4f9197a9c373762a3ad54">CLI_PRETX_ALL</a>;</div>
<div class="line"><span class="lineno"> 1372</span>      <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1373</span>        fprintf(stderr, <span class="stringliteral">&quot;error: unknown pretranspose &#39;%s&#39;\n&quot;</span>, p);</div>
<div class="line"><span class="lineno"> 1374</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 1375</span>      }</div>
<div class="line"><span class="lineno"> 1376</span> </div>
<div class="line"><span class="lineno"> 1377</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;--device&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1378</span>      <span class="keywordflow">if</span> (++i &gt;= argc) { <a class="code hl_function" href="main__infer_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a>(); <span class="keywordflow">return</span> -1; }</div>
<div class="line"><span class="lineno"> 1379</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;device = argv[i];</div>
<div class="line"><span class="lineno"> 1380</span> </div>
<div class="line"><span class="lineno"> 1381</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;--model-dir&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1382</span>      <span class="keywordflow">if</span> (++i &gt;= argc) { <a class="code hl_function" href="main__infer_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a>(); <span class="keywordflow">return</span> -1; }</div>
<div class="line"><span class="lineno"> 1383</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;model_dir = argv[i];</div>
<div class="line"><span class="lineno"> 1384</span> </div>
<div class="line"><span class="lineno"> 1385</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;--model-json&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1386</span>      <span class="keywordflow">if</span> (++i &gt;= argc) { <a class="code hl_function" href="main__infer_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a>(); <span class="keywordflow">return</span> -1; }</div>
<div class="line"><span class="lineno"> 1387</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;model_json = argv[i];</div>
<div class="line"><span class="lineno"> 1388</span> </div>
<div class="line"><span class="lineno"> 1389</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;--model-bin&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1390</span>      <span class="keywordflow">if</span> (++i &gt;= argc) { <a class="code hl_function" href="main__infer_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a>(); <span class="keywordflow">return</span> -1; }</div>
<div class="line"><span class="lineno"> 1391</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;model_bin = argv[i];</div>
<div class="line"><span class="lineno"> 1392</span> </div>
<div class="line"><span class="lineno"> 1393</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;--prompts-file&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1394</span>      <span class="keywordflow">if</span> (++i &gt;= argc) { <a class="code hl_function" href="main__infer_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a>(); <span class="keywordflow">return</span> -1; }</div>
<div class="line"><span class="lineno"> 1395</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;prompts_file = argv[i];</div>
<div class="line"><span class="lineno"> 1396</span> </div>
<div class="line"><span class="lineno"> 1397</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;--batch&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1398</span>      <span class="keywordflow">if</span> (++i &gt;= argc) { <a class="code hl_function" href="main__infer_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a>(); <span class="keywordflow">return</span> -1; }</div>
<div class="line"><span class="lineno"> 1399</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;batch = (int)<a class="code hl_function" href="main__infer_8c.html#a42cabe54dce1190125a12e4c0360ce22">safe_atoi</a>(argv[i]);</div>
<div class="line"><span class="lineno"> 1400</span> </div>
<div class="line"><span class="lineno"> 1401</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;--prefetch&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1402</span>      <span class="keywordflow">if</span> (++i &gt;= argc) { <a class="code hl_function" href="main__infer_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a>(); <span class="keywordflow">return</span> -1; }</div>
<div class="line"><span class="lineno"> 1403</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;prefetch = argv[i];</div>
<div class="line"><span class="lineno"> 1404</span> </div>
<div class="line"><span class="lineno"> 1405</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;--warmup&quot;</span>) || !strcmp(a, <span class="stringliteral">&quot;--warmup-tokens&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1406</span>      <span class="keywordflow">if</span> (++i &gt;= argc) { <a class="code hl_function" href="main__infer_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a>(); <span class="keywordflow">return</span> -1; }</div>
<div class="line"><span class="lineno"> 1407</span>      <span class="keywordtype">long</span> v = <a class="code hl_function" href="main__infer_8c.html#a42cabe54dce1190125a12e4c0360ce22">safe_atoi</a>(argv[i]);</div>
<div class="line"><span class="lineno"> 1408</span>      <span class="keywordflow">if</span> (v &lt; 0) v = 0;</div>
<div class="line"><span class="lineno"> 1409</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;warmup_tokens = (int)v;</div>
<div class="line"><span class="lineno"> 1410</span> </div>
<div class="line"><span class="lineno"> 1411</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;--rounds&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1412</span>      <span class="keywordflow">if</span> (++i &gt;= argc) { <a class="code hl_function" href="main__infer_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a>(); <span class="keywordflow">return</span> -1; }</div>
<div class="line"><span class="lineno"> 1413</span>      <span class="keywordtype">long</span> v = <a class="code hl_function" href="main__infer_8c.html#a42cabe54dce1190125a12e4c0360ce22">safe_atoi</a>(argv[i]);</div>
<div class="line"><span class="lineno"> 1414</span>      <span class="keywordflow">if</span> (v &lt; 1) v = 1;</div>
<div class="line"><span class="lineno"> 1415</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;rounds = (int)v;</div>
<div class="line"><span class="lineno"> 1416</span> </div>
<div class="line"><span class="lineno"> 1417</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;--aggregate&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1418</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;aggregate = 1;</div>
<div class="line"><span class="lineno"> 1419</span> </div>
<div class="line"><span class="lineno"> 1420</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;--expected-tokens&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1421</span>      <span class="keywordflow">if</span> (++i &gt;= argc) { <a class="code hl_function" href="main__infer_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a>(); <span class="keywordflow">return</span> -1; }</div>
<div class="line"><span class="lineno"> 1422</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;expected_tokens_file = argv[i];</div>
<div class="line"><span class="lineno"> 1423</span> </div>
<div class="line"><span class="lineno"> 1424</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;--no-report-tokens&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1425</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;report_tokens = 0;</div>
<div class="line"><span class="lineno"> 1426</span> </div>
<div class="line"><span class="lineno"> 1427</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;--report-tokens-max&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1428</span>      <span class="keywordflow">if</span> (++i &gt;= argc) { <a class="code hl_function" href="main__infer_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a>(); <span class="keywordflow">return</span> -1; }</div>
<div class="line"><span class="lineno"> 1429</span>      <span class="keywordtype">long</span> v = <a class="code hl_function" href="main__infer_8c.html#a42cabe54dce1190125a12e4c0360ce22">safe_atoi</a>(argv[i]);</div>
<div class="line"><span class="lineno"> 1430</span>      <span class="keywordflow">if</span> (v &lt; 0) v = 0;</div>
<div class="line"><span class="lineno"> 1431</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;report_tokens_max = (size_t)v;</div>
<div class="line"><span class="lineno"> 1432</span> </div>
<div class="line"><span class="lineno"> 1433</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;--print-text&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1434</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;print_text = 1;</div>
<div class="line"><span class="lineno"> 1435</span> </div>
<div class="line"><span class="lineno"> 1436</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;--tokenizer&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1437</span>      <span class="keywordflow">if</span> (++i &gt;= argc) { <a class="code hl_function" href="main__infer_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a>(); <span class="keywordflow">return</span> -1; }</div>
<div class="line"><span class="lineno"> 1438</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;tokenizer_path = argv[i];</div>
<div class="line"><span class="lineno"> 1439</span> </div>
<div class="line"><span class="lineno"> 1440</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;--trace-ids&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1441</span>      <span class="keywordflow">if</span> (++i &gt;= argc) { <a class="code hl_function" href="main__infer_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a>(); <span class="keywordflow">return</span> -1; }</div>
<div class="line"><span class="lineno"> 1442</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;trace_ids_path = argv[i];</div>
<div class="line"><span class="lineno"> 1443</span> </div>
<div class="line"><span class="lineno"> 1444</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;--log-tokens&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1445</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;log_tokens = 1;</div>
<div class="line"><span class="lineno"> 1446</span> </div>
<div class="line"><span class="lineno"> 1447</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;--log-every&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1448</span>      <span class="keywordflow">if</span> (++i &gt;= argc) { <a class="code hl_function" href="main__infer_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a>(); <span class="keywordflow">return</span> -1; }</div>
<div class="line"><span class="lineno"> 1449</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;log_every = (int)<a class="code hl_function" href="main__infer_8c.html#a42cabe54dce1190125a12e4c0360ce22">safe_atoi</a>(argv[i]);</div>
<div class="line"><span class="lineno"> 1450</span> </div>
<div class="line"><span class="lineno"> 1451</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;--debug-decode&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1452</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;debug_decode = 1;</div>
<div class="line"><span class="lineno"> 1453</span> </div>
<div class="line"><span class="lineno"> 1454</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;--debug-decode-every&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1455</span>      <span class="keywordflow">if</span> (++i &gt;= argc) { <a class="code hl_function" href="main__infer_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a>(); <span class="keywordflow">return</span> -1; }</div>
<div class="line"><span class="lineno"> 1456</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;debug_decode_every = (int)<a class="code hl_function" href="main__infer_8c.html#a42cabe54dce1190125a12e4c0360ce22">safe_atoi</a>(argv[i]);</div>
<div class="line"><span class="lineno"> 1457</span> </div>
<div class="line"><span class="lineno"> 1458</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;--debug-topk&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1459</span>      <span class="keywordflow">if</span> (++i &gt;= argc) { <a class="code hl_function" href="main__infer_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a>(); <span class="keywordflow">return</span> -1; }</div>
<div class="line"><span class="lineno"> 1460</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;debug_topk = (int)<a class="code hl_function" href="main__infer_8c.html#a42cabe54dce1190125a12e4c0360ce22">safe_atoi</a>(argv[i]);</div>
<div class="line"><span class="lineno"> 1461</span> </div>
<div class="line"><span class="lineno"> 1462</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;--debug-topk-every&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1463</span>      <span class="keywordflow">if</span> (++i &gt;= argc) { <a class="code hl_function" href="main__infer_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a>(); <span class="keywordflow">return</span> -1; }</div>
<div class="line"><span class="lineno"> 1464</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;debug_topk_every = (int)<a class="code hl_function" href="main__infer_8c.html#a42cabe54dce1190125a12e4c0360ce22">safe_atoi</a>(argv[i]);</div>
<div class="line"><span class="lineno"> 1465</span> </div>
<div class="line"><span class="lineno"> 1466</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;--seed&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1467</span>      <span class="keywordflow">if</span> (++i &gt;= argc) { <a class="code hl_function" href="main__infer_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a>(); <span class="keywordflow">return</span> -1; }</div>
<div class="line"><span class="lineno"> 1468</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;seed = <a class="code hl_function" href="main__infer_8c.html#a50f7fd00c4c5f36d1ee065443d688251">safe_atoull</a>(argv[i]);</div>
<div class="line"><span class="lineno"> 1469</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;seed_set = 1;</div>
<div class="line"><span class="lineno"> 1470</span> </div>
<div class="line"><span class="lineno"> 1471</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;--greedy&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1472</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;greedy = 1;</div>
<div class="line"><span class="lineno"> 1473</span> </div>
<div class="line"><span class="lineno"> 1474</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;--temperature&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1475</span>      <span class="keywordflow">if</span> (++i &gt;= argc) { <a class="code hl_function" href="main__infer_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a>(); <span class="keywordflow">return</span> -1; }</div>
<div class="line"><span class="lineno"> 1476</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;temperature = <a class="code hl_function" href="main__infer_8c.html#a040e339c57d801547a44a21545914526">safe_atof</a>(argv[i]);</div>
<div class="line"><span class="lineno"> 1477</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;temperature_set = 1;</div>
<div class="line"><span class="lineno"> 1478</span> </div>
<div class="line"><span class="lineno"> 1479</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;--top-p&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1480</span>      <span class="keywordflow">if</span> (++i &gt;= argc) { <a class="code hl_function" href="main__infer_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a>(); <span class="keywordflow">return</span> -1; }</div>
<div class="line"><span class="lineno"> 1481</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;top_p = <a class="code hl_function" href="main__infer_8c.html#a040e339c57d801547a44a21545914526">safe_atof</a>(argv[i]);</div>
<div class="line"><span class="lineno"> 1482</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;top_p_set = 1;</div>
<div class="line"><span class="lineno"> 1483</span> </div>
<div class="line"><span class="lineno"> 1484</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!strcmp(a, <span class="stringliteral">&quot;--top-k&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1485</span>      <span class="keywordflow">if</span> (++i &gt;= argc) { <a class="code hl_function" href="main__infer_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a>(); <span class="keywordflow">return</span> -1; }</div>
<div class="line"><span class="lineno"> 1486</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;top_k = (int)<a class="code hl_function" href="main__infer_8c.html#a42cabe54dce1190125a12e4c0360ce22">safe_atoi</a>(argv[i]);</div>
<div class="line"><span class="lineno"> 1487</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;top_k_set = 1;</div>
<div class="line"><span class="lineno"> 1488</span> </div>
<div class="line"><span class="lineno"> 1489</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (a[0] == <span class="charliteral">&#39;-&#39;</span>) {</div>
<div class="line"><span class="lineno"> 1490</span>      fprintf(stderr, <span class="stringliteral">&quot;error: unknown flag &#39;%s&#39;\n&quot;</span>, a);</div>
<div class="line"><span class="lineno"> 1491</span>      <a class="code hl_function" href="main__infer_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a>();</div>
<div class="line"><span class="lineno"> 1492</span>      <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 1493</span> </div>
<div class="line"><span class="lineno"> 1494</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1495</span>      <span class="keywordflow">if</span> (!<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;prompt) <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;prompt = a;</div>
<div class="line"><span class="lineno"> 1496</span>    }</div>
<div class="line"><span class="lineno"> 1497</span>  }</div>
<div class="line"><span class="lineno"> 1498</span> </div>
<div class="line"><span class="lineno"> 1499</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1500</span>}</div>
<div class="ttc" id="amain__infer_8c_html_a040e339c57d801547a44a21545914526"><div class="ttname"><a href="main__infer_8c.html#a040e339c57d801547a44a21545914526">safe_atof</a></div><div class="ttdeci">static double safe_atof(const char *s)</div><div class="ttdoc">Parse a double safely (fatal on invalid input).</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01204">main_infer.c:1204</a></div></div>
<div class="ttc" id="amain__infer_8c_html_a25c42477bc56f4eb2d2a5c53e4510d70"><div class="ttname"><a href="main__infer_8c.html#a25c42477bc56f4eb2d2a5c53e4510d70">cli_extras_defaults</a></div><div class="ttdeci">static void cli_extras_defaults(cli_extras_t *e)</div><div class="ttdoc">Initialize CLI defaults.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01082">main_infer.c:1082</a></div></div>
<div class="ttc" id="amain__infer_8c_html_a42cabe54dce1190125a12e4c0360ce22"><div class="ttname"><a href="main__infer_8c.html#a42cabe54dce1190125a12e4c0360ce22">safe_atoi</a></div><div class="ttdeci">static long safe_atoi(const char *s)</div><div class="ttdoc">Parse a decimal integer safely (fatal on invalid input).</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01152">main_infer.c:1152</a></div></div>
<div class="ttc" id="amain__infer_8c_html_a50f7fd00c4c5f36d1ee065443d688251"><div class="ttname"><a href="main__infer_8c.html#a50f7fd00c4c5f36d1ee065443d688251">safe_atoull</a></div><div class="ttdeci">static uint64_t safe_atoull(const char *s)</div><div class="ttdoc">Parse an unsigned 64-bit integer safely (fatal on invalid input).</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01178">main_infer.c:1178</a></div></div>
<div class="ttc" id="amain__infer_8c_html_ad96d407a911fbb914fa8e4cfbf2faf0f"><div class="ttname"><a href="main__infer_8c.html#ad96d407a911fbb914fa8e4cfbf2faf0f">usage</a></div><div class="ttdeci">static void usage(void)</div><div class="ttdoc">Print CLI usage to stderr.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01050">main_infer.c:1050</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="main__infer_8c_source.html#l00166">ascii_ieq()</a>, <a class="el" href="main__infer_8c_source.html#l01082">cli_extras_defaults()</a>, <a class="el" href="main__infer_8c_source.html#l00978">CLI_PRETX_ALL</a>, <a class="el" href="main__infer_8c_source.html#l00975">CLI_PRETX_NONE</a>, <a class="el" href="main__infer_8c_source.html#l00976">CLI_PRETX_WOH</a>, <a class="el" href="main__infer_8c_source.html#l00977">CLI_PRETX_WXH</a>, <a class="el" href="main__infer_8c_source.html#l01204">safe_atof()</a>, <a class="el" href="main__infer_8c_source.html#l01152">safe_atoi()</a>, <a class="el" href="main__infer_8c_source.html#l01178">safe_atoull()</a>, and <a class="el" href="main__infer_8c_source.html#l01050">usage()</a>.</p>

<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l02362">main()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a456ba954f3884bcf5f72fc3e779de284_cgraph.svg" width="300" height="283"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a456ba954f3884bcf5f72fc3e779de284_icgraph.svg" width="210" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="adaa53124eb0654f14346cf02af06b891" name="adaa53124eb0654f14346cf02af06b891"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adaa53124eb0654f14346cf02af06b891">&#9670;&#160;</a></span>parse_token_list_inplace()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int parse_token_list_inplace </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int **&#160;</td>
          <td class="paramname"><em>out_tokens</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>out_n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Parse a comma-separated list of integers. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>Input string (modified by this function). </td></tr>
    <tr><td class="paramname">out_tokens</td><td>Output allocated token array (owned by caller on success). </td></tr>
    <tr><td class="paramname">out_n</td><td>Output token count. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, nonzero on failure.</dd></dl>
<p>parse_token_list_inplace.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>See implementation for details. </td></tr>
    <tr><td class="paramname">out_tokens</td><td>See implementation for details. </td></tr>
    <tr><td class="paramname">out_n</td><td>See implementation for details.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>See implementation for details. </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l01877">1877</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1877</span>                                                                              {</div>
<div class="line"><span class="lineno"> 1878</span>  <span class="keywordflow">if</span> (!s || !out_tokens || !out_n) <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 1879</span>  *out_tokens = NULL;</div>
<div class="line"><span class="lineno"> 1880</span>  *out_n = 0;</div>
<div class="line"><span class="lineno"> 1881</span> </div>
<div class="line"><span class="lineno"> 1882</span>  <span class="keywordtype">size_t</span> cap = 64;</div>
<div class="line"><span class="lineno"> 1883</span>  <span class="keywordtype">size_t</span> n = 0;</div>
<div class="line"><span class="lineno"> 1884</span>  <span class="keywordtype">int</span> *tok = (<span class="keywordtype">int</span> *)malloc(cap * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line"><span class="lineno"> 1885</span>  <span class="keywordflow">if</span> (!tok) <span class="keywordflow">return</span> 2;</div>
<div class="line"><span class="lineno"> 1886</span> </div>
<div class="line"><span class="lineno"> 1887</span>  <span class="keywordtype">char</span> *p = s;</div>
<div class="line"><span class="lineno"> 1888</span>  <span class="keywordflow">while</span> (*p) {</div>
<div class="line"><span class="lineno"> 1889</span>    <span class="keywordflow">while</span> (*p == <span class="charliteral">&#39; &#39;</span> || *p == <span class="charliteral">&#39;\t&#39;</span>) ++p;</div>
<div class="line"><span class="lineno"> 1890</span>    <span class="keywordflow">if</span> (!*p) <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1891</span> </div>
<div class="line"><span class="lineno"> 1892</span>    <span class="keywordtype">char</span> *end = NULL;</div>
<div class="line"><span class="lineno"> 1893</span>    <span class="keywordtype">long</span> v = strtol(p, &amp;end, 10);</div>
<div class="line"><span class="lineno"> 1894</span>    <span class="keywordflow">if</span> (end == p) { free(tok); <span class="keywordflow">return</span> 3; }</div>
<div class="line"><span class="lineno"> 1895</span> </div>
<div class="line"><span class="lineno"> 1896</span>    <span class="keywordflow">if</span> (n == cap) {</div>
<div class="line"><span class="lineno"> 1897</span>      <span class="keywordtype">size_t</span> ncap = cap * 2;</div>
<div class="line"><span class="lineno"> 1898</span>      <span class="keywordtype">int</span> *nt = (<span class="keywordtype">int</span> *)realloc(tok, ncap * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line"><span class="lineno"> 1899</span>      <span class="keywordflow">if</span> (!nt) { free(tok); <span class="keywordflow">return</span> 4; }</div>
<div class="line"><span class="lineno"> 1900</span>      tok = nt;</div>
<div class="line"><span class="lineno"> 1901</span>      cap = ncap;</div>
<div class="line"><span class="lineno"> 1902</span>    }</div>
<div class="line"><span class="lineno"> 1903</span>    tok[n++] = (int)v;</div>
<div class="line"><span class="lineno"> 1904</span> </div>
<div class="line"><span class="lineno"> 1905</span>    p = end;</div>
<div class="line"><span class="lineno"> 1906</span>    <span class="keywordflow">while</span> (*p == <span class="charliteral">&#39; &#39;</span> || *p == <span class="charliteral">&#39;\t&#39;</span>) ++p;</div>
<div class="line"><span class="lineno"> 1907</span>    <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;,&#39;</span>) { ++p; <span class="keywordflow">continue</span>; }</div>
<div class="line"><span class="lineno"> 1908</span>    <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;\0&#39;</span> || *p == <span class="charliteral">&#39;\r&#39;</span> || *p == <span class="charliteral">&#39;\n&#39;</span>) <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1909</span> </div>
<div class="line"><span class="lineno"> 1910</span>    <span class="comment">/* Unexpected separator. */</span></div>
<div class="line"><span class="lineno"> 1911</span>    free(tok);</div>
<div class="line"><span class="lineno"> 1912</span>    <span class="keywordflow">return</span> 5;</div>
<div class="line"><span class="lineno"> 1913</span>  }</div>
<div class="line"><span class="lineno"> 1914</span> </div>
<div class="line"><span class="lineno"> 1915</span>  <span class="keywordflow">if</span> (n == 0) { free(tok); <span class="keywordflow">return</span> 6; }</div>
<div class="line"><span class="lineno"> 1916</span>  *out_tokens = tok;</div>
<div class="line"><span class="lineno"> 1917</span>  *out_n = n;</div>
<div class="line"><span class="lineno"> 1918</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1919</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l01944">expected_tokens_table_load()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_adaa53124eb0654f14346cf02af06b891_icgraph.svg" width="551" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a2749355bb9d419963e15e9a58395f63e" name="a2749355bb9d419963e15e9a58395f63e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2749355bb9d419963e15e9a58395f63e">&#9670;&#160;</a></span>parse_u64_auto()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int parse_u64_auto </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t *&#160;</td>
          <td class="paramname"><em>out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Parse an unsigned 64-bit integer in decimal or 0x-prefixed hex. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>Input string. </td></tr>
    <tr><td class="paramname">out</td><td>Parsed value. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, nonzero on failure.</dd></dl>
<p>parse_u64_auto.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>See implementation for details. </td></tr>
    <tr><td class="paramname">out</td><td>See implementation for details.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>See implementation for details. </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l01719">1719</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1719</span>                                                        {</div>
<div class="line"><span class="lineno"> 1720</span>  <span class="keywordflow">if</span> (!s || !*s || !out) <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 1721</span> </div>
<div class="line"><span class="lineno"> 1722</span>  <span class="keywordtype">int</span> base = 10;</div>
<div class="line"><span class="lineno"> 1723</span>  <span class="keywordflow">if</span> (s[0] == <span class="charliteral">&#39;0&#39;</span> &amp;&amp; (s[1] == <span class="charliteral">&#39;x&#39;</span> || s[1] == <span class="charliteral">&#39;X&#39;</span>)) base = 16;</div>
<div class="line"><span class="lineno"> 1724</span> </div>
<div class="line"><span class="lineno"> 1725</span>  <span class="keywordtype">char</span> *end = NULL;</div>
<div class="line"><span class="lineno"> 1726</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> v = strtoull(s, &amp;end, base);</div>
<div class="line"><span class="lineno"> 1727</span>  <span class="keywordflow">if</span> (end == s) <span class="keywordflow">return</span> 2;</div>
<div class="line"><span class="lineno"> 1728</span>  <span class="keywordflow">while</span> (end &amp;&amp; (*end == <span class="charliteral">&#39; &#39;</span> || *end == <span class="charliteral">&#39;\t&#39;</span> || *end == <span class="charliteral">&#39;\r&#39;</span> || *end == <span class="charliteral">&#39;\n&#39;</span>)) ++end;</div>
<div class="line"><span class="lineno"> 1729</span>  <span class="keywordflow">if</span> (end &amp;&amp; *end) <span class="keywordflow">return</span> 3;</div>
<div class="line"><span class="lineno"> 1730</span> </div>
<div class="line"><span class="lineno"> 1731</span>  *<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a> = (uint64_t)v;</div>
<div class="line"><span class="lineno"> 1732</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1733</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l01944">expected_tokens_table_load()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a2749355bb9d419963e15e9a58395f63e_icgraph.svg" width="494" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a0cbea455e9868581360f43c63db6554c" name="a0cbea455e9868581360f43c63db6554c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0cbea455e9868581360f43c63db6554c">&#9670;&#160;</a></span>path_exists()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int path_exists </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>p</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Determine whether a filesystem path exists (stat succeeds). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p</td><td>Path to test. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 when exists, 0 otherwise.</dd></dl>
<p>path_exists.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p</td><td>See implementation for details.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>See implementation for details. </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00227">227</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  227</span>                                      {</div>
<div class="line"><span class="lineno">  228</span>  <span class="keywordflow">if</span> (!p || !*p) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  229</span>  <span class="keyword">struct </span>stat st;</div>
<div class="line"><span class="lineno">  230</span>  <span class="keywordflow">return</span> (stat(p, &amp;st) == 0);</div>
<div class="line"><span class="lineno">  231</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l02362">main()</a>, <a class="el" href="main__infer_8c_source.html#l00378">resolve_model_paths()</a>, and <a class="el" href="main__infer_8c_source.html#l00810">resolve_tokenizer_path()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a0cbea455e9868581360f43c63db6554c_icgraph.svg" width="432" height="107"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a35a9aadd511e6b3688d01a67a12c7651" name="a35a9aadd511e6b3688d01a67a12c7651"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a35a9aadd511e6b3688d01a67a12c7651">&#9670;&#160;</a></span>path_is_abs()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int path_is_abs </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>p</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check if a path is absolute (POSIX). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p</td><td>Path. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 when absolute, 0 otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00258">258</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  258</span>{ <span class="keywordflow">return</span> (p &amp;&amp; p[0] == <span class="charliteral">&#39;/&#39;</span>); }</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l00297">join_path()</a>, <a class="el" href="main__infer_8c_source.html#l00378">resolve_model_paths()</a>, and <a class="el" href="main__infer_8c_source.html#l00810">resolve_tokenizer_path()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a35a9aadd511e6b3688d01a67a12c7651_icgraph.svg" width="564" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a84b40472513bc66398c6d3049891f553" name="a84b40472513bc66398c6d3049891f553"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a84b40472513bc66398c6d3049891f553">&#9670;&#160;</a></span>print_json_result()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void print_json_result </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>n_tok</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int *&#160;</td>
          <td class="paramname"><em>tokens</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>wall_s_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>prefill_s_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>decode_s_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>kv_hits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>kv_misses</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>rss_peak_mb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>text_decoded</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>tokenizer_path_used</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>expected_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="main__infer_8c.html#aa2c236bcd5a489e1a409ffd5f4c532f7">prompt_list_t</a> *&#160;</td>
          <td class="paramname"><em>prompts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>rounds</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="main__infer_8c.html#af8802263c4d59c173623fe774ce0abb0">prompt_round_record_t</a> *&#160;</td>
          <td class="paramname"><em>recs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Print the single JSON result object to stdout. </p>
<p>This function prints exactly one JSON object, suitable for strict harness parsing. It preserves all previously emitted fields and appends per-prompt/per-round data under the <code>"prompts"</code> key.</p>
<p>TPS policy:</p><ul>
<li>tps_true is decode-only TPS: tokens_generated / decode_time_s (setup/prefill excluded).</li>
<li>tps_window is tokens_generated / wall_time_s (entire timed window, includes strict-touch).</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">n_tok</td><td>Number of generated tokens (sum over all prompts and rounds). </td></tr>
    <tr><td class="paramname">tokens</td><td>Optional top-level token buffer (legacy single-prompt behavior). </td></tr>
    <tr><td class="paramname">wall_s_in</td><td>Timed window seconds (strict window). </td></tr>
    <tr><td class="paramname">prefill_s_in</td><td>Summed prefill seconds (engine-reported). </td></tr>
    <tr><td class="paramname">decode_s_in</td><td>Summed decode seconds (engine-reported). </td></tr>
    <tr><td class="paramname">kv_hits</td><td>KV cache hits. </td></tr>
    <tr><td class="paramname">kv_misses</td><td>KV cache misses. </td></tr>
    <tr><td class="paramname">rss_peak_mb</td><td>RSS peak in MiB. </td></tr>
    <tr><td class="paramname">text_decoded</td><td>Optional decoded text (UTF-8) for legacy single prompt. </td></tr>
    <tr><td class="paramname">tokenizer_path_used</td><td>Optional resolved tokenizer path used by CLI. </td></tr>
    <tr><td class="paramname">expected_file</td><td>Optional expected tokens file path (for reporting only). </td></tr>
    <tr><td class="paramname">prompts</td><td>Prompt list (preloaded). </td></tr>
    <tr><td class="paramname">rounds</td><td>Number of rounds. </td></tr>
    <tr><td class="paramname">recs</td><td>Per-prompt/per-round records (length must be prompts-&gt;count * rounds). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l02171">2171</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2184</span>                                                                 {</div>
<div class="line"><span class="lineno"> 2185</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> wall_s = (wall_s_in &gt; 0.0) ? wall_s_in : 0.0;</div>
<div class="line"><span class="lineno"> 2186</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> prefill_s = (prefill_s_in &gt; 0.0) ? prefill_s_in : 0.0;</div>
<div class="line"><span class="lineno"> 2187</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> decode_s = (decode_s_in &gt; 0.0) ? decode_s_in : 0.0;</div>
<div class="line"><span class="lineno"> 2188</span> </div>
<div class="line"><span class="lineno"> 2189</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> tps_true = (decode_s &gt; 0.0) ? ((<span class="keywordtype">double</span>)n_tok / decode_s) : 0.0;</div>
<div class="line"><span class="lineno"> 2190</span>  <span class="keyword">const</span> <span class="keywordtype">double</span> tps_window = (wall_s &gt; 0.0) ? ((<span class="keywordtype">double</span>)n_tok / wall_s) : 0.0;</div>
<div class="line"><span class="lineno"> 2191</span> </div>
<div class="line"><span class="lineno"> 2192</span>  <span class="keywordtype">double</span> p50 = 0.0, p95 = 0.0;</div>
<div class="line"><span class="lineno"> 2193</span>  <span class="keywordflow">if</span> (n_tok &gt; 0 &amp;&amp; decode_s &gt; 0.0) {</div>
<div class="line"><span class="lineno"> 2194</span>    <span class="keywordtype">double</span> per_tok_ms = (decode_s * 1000.0) / (<span class="keywordtype">double</span>)n_tok;</div>
<div class="line"><span class="lineno"> 2195</span>    <span class="keywordflow">if</span> (per_tok_ms &lt; 0.001) per_tok_ms = 0.001;</div>
<div class="line"><span class="lineno"> 2196</span>    p50 = per_tok_ms;</div>
<div class="line"><span class="lineno"> 2197</span>    p95 = per_tok_ms * 2.0;</div>
<div class="line"><span class="lineno"> 2198</span>  }</div>
<div class="line"><span class="lineno"> 2199</span> </div>
<div class="line"><span class="lineno"> 2200</span>  fprintf(stdout, <span class="stringliteral">&quot;{\&quot;tokens_generated\&quot;:%zu,&quot;</span>, n_tok);</div>
<div class="line"><span class="lineno"> 2201</span> </div>
<div class="line"><span class="lineno"> 2202</span>  fputs(<span class="stringliteral">&quot;\&quot;tokens\&quot;:&quot;</span>, stdout);</div>
<div class="line"><span class="lineno"> 2203</span>  <span class="keywordflow">if</span> (tokens &amp;&amp; n_tok &gt; 0) <a class="code hl_function" href="main__infer_8c.html#a9205188606b8d4265d29fa8911259cac">json_print_int_array</a>(tokens, n_tok);</div>
<div class="line"><span class="lineno"> 2204</span>  <span class="keywordflow">else</span> <a class="code hl_function" href="main__infer_8c.html#a9205188606b8d4265d29fa8911259cac">json_print_int_array</a>(NULL, 0);</div>
<div class="line"><span class="lineno"> 2205</span>  fputs(<span class="stringliteral">&quot;,&quot;</span>, stdout);</div>
<div class="line"><span class="lineno"> 2206</span> </div>
<div class="line"><span class="lineno"> 2207</span>  <span class="keywordflow">if</span> (tokenizer_path_used &amp;&amp; *tokenizer_path_used) {</div>
<div class="line"><span class="lineno"> 2208</span>    fputs(<span class="stringliteral">&quot;\&quot;tokenizer_path\&quot;:&quot;</span>, stdout);</div>
<div class="line"><span class="lineno"> 2209</span>    <a class="code hl_function" href="main__infer_8c.html#a7427a4a1579fb747a4ce22a4a1d4a80a">json_print_escaped_string</a>(tokenizer_path_used);</div>
<div class="line"><span class="lineno"> 2210</span>    fputs(<span class="stringliteral">&quot;,&quot;</span>, stdout);</div>
<div class="line"><span class="lineno"> 2211</span>  }</div>
<div class="line"><span class="lineno"> 2212</span> </div>
<div class="line"><span class="lineno"> 2213</span>  <span class="keywordflow">if</span> (expected_file &amp;&amp; *expected_file) {</div>
<div class="line"><span class="lineno"> 2214</span>    fputs(<span class="stringliteral">&quot;\&quot;expected_tokens_file\&quot;:&quot;</span>, stdout);</div>
<div class="line"><span class="lineno"> 2215</span>    <a class="code hl_function" href="main__infer_8c.html#a7427a4a1579fb747a4ce22a4a1d4a80a">json_print_escaped_string</a>(expected_file);</div>
<div class="line"><span class="lineno"> 2216</span>    fputs(<span class="stringliteral">&quot;,&quot;</span>, stdout);</div>
<div class="line"><span class="lineno"> 2217</span>  }</div>
<div class="line"><span class="lineno"> 2218</span> </div>
<div class="line"><span class="lineno"> 2219</span>  <span class="keywordflow">if</span> (text_decoded) {</div>
<div class="line"><span class="lineno"> 2220</span>    fputs(<span class="stringliteral">&quot;\&quot;text\&quot;:&quot;</span>, stdout);</div>
<div class="line"><span class="lineno"> 2221</span>    <a class="code hl_function" href="main__infer_8c.html#a7427a4a1579fb747a4ce22a4a1d4a80a">json_print_escaped_string</a>(text_decoded);</div>
<div class="line"><span class="lineno"> 2222</span>    fputs(<span class="stringliteral">&quot;,&quot;</span>, stdout);</div>
<div class="line"><span class="lineno"> 2223</span>  }</div>
<div class="line"><span class="lineno"> 2224</span> </div>
<div class="line"><span class="lineno"> 2225</span>  fprintf(stdout,</div>
<div class="line"><span class="lineno"> 2226</span>          <span class="stringliteral">&quot;\&quot;wall_time_s\&quot;:%.6f,&quot;</span></div>
<div class="line"><span class="lineno"> 2227</span>          <span class="stringliteral">&quot;\&quot;prefill_time_s\&quot;:%.6f,&quot;</span></div>
<div class="line"><span class="lineno"> 2228</span>          <span class="stringliteral">&quot;\&quot;decode_time_s\&quot;:%.6f,&quot;</span></div>
<div class="line"><span class="lineno"> 2229</span>          <span class="stringliteral">&quot;\&quot;tps_true\&quot;:%.6f,&quot;</span></div>
<div class="line"><span class="lineno"> 2230</span>          <span class="stringliteral">&quot;\&quot;tps_window\&quot;:%.6f,&quot;</span></div>
<div class="line"><span class="lineno"> 2231</span>          <span class="stringliteral">&quot;\&quot;latency_p50_ms\&quot;:%.3f,&quot;</span></div>
<div class="line"><span class="lineno"> 2232</span>          <span class="stringliteral">&quot;\&quot;latency_p95_ms\&quot;:%.3f,&quot;</span></div>
<div class="line"><span class="lineno"> 2233</span>          <span class="stringliteral">&quot;\&quot;rss_peak_mb\&quot;:%u,&quot;</span></div>
<div class="line"><span class="lineno"> 2234</span>          <span class="stringliteral">&quot;\&quot;kv_hits\&quot;:%&quot;</span> PRIu64 <span class="stringliteral">&quot;,&quot;</span></div>
<div class="line"><span class="lineno"> 2235</span>          <span class="stringliteral">&quot;\&quot;kv_misses\&quot;:%&quot;</span> PRIu64 <span class="stringliteral">&quot;,&quot;</span>,</div>
<div class="line"><span class="lineno"> 2236</span>          wall_s,</div>
<div class="line"><span class="lineno"> 2237</span>          prefill_s,</div>
<div class="line"><span class="lineno"> 2238</span>          decode_s,</div>
<div class="line"><span class="lineno"> 2239</span>          tps_true,</div>
<div class="line"><span class="lineno"> 2240</span>          tps_window,</div>
<div class="line"><span class="lineno"> 2241</span>          p50,</div>
<div class="line"><span class="lineno"> 2242</span>          p95,</div>
<div class="line"><span class="lineno"> 2243</span>          (<span class="keywordtype">unsigned</span>)rss_peak_mb,</div>
<div class="line"><span class="lineno"> 2244</span>          kv_hits,</div>
<div class="line"><span class="lineno"> 2245</span>          kv_misses);</div>
<div class="line"><span class="lineno"> 2246</span> </div>
<div class="line"><span class="lineno"> 2247</span>  <span class="comment">/* Per-prompt details: always present (possibly empty). */</span></div>
<div class="line"><span class="lineno"> 2248</span>  <span class="keyword">const</span> <span class="keywordtype">size_t</span> n_prompts = (prompts ? prompts-&gt;<a class="code hl_variable" href="structprompt__list.html#ab60c60299e5806652f4c2c7a94aca5c3">count</a> : 0);</div>
<div class="line"><span class="lineno"> 2249</span>  fprintf(stdout, <span class="stringliteral">&quot;\&quot;prompts_count\&quot;:%zu,&quot;</span>, n_prompts);</div>
<div class="line"><span class="lineno"> 2250</span>  fprintf(stdout, <span class="stringliteral">&quot;\&quot;rounds\&quot;:%d,&quot;</span>, (rounds &gt; 0 ? rounds : 1));</div>
<div class="line"><span class="lineno"> 2251</span> </div>
<div class="line"><span class="lineno"> 2252</span>  fputs(<span class="stringliteral">&quot;\&quot;prompts\&quot;:[&quot;</span>, stdout);</div>
<div class="line"><span class="lineno"> 2253</span>  <span class="keywordflow">if</span> (prompts &amp;&amp; recs &amp;&amp; n_prompts &gt; 0) {</div>
<div class="line"><span class="lineno"> 2254</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> pi = 0; pi &lt; n_prompts; ++pi) {</div>
<div class="line"><span class="lineno"> 2255</span>      <span class="comment">/* Aggregate totals for this prompt. */</span></div>
<div class="line"><span class="lineno"> 2256</span>      <span class="keywordtype">size_t</span> tok_sum = 0;</div>
<div class="line"><span class="lineno"> 2257</span>      <span class="keywordtype">double</span> win_sum = 0.0, pre_sum = 0.0, dec_sum = 0.0;</div>
<div class="line"><span class="lineno"> 2258</span>      <span class="keywordtype">int</span> exp_present = 0;</div>
<div class="line"><span class="lineno"> 2259</span>      <span class="keywordtype">int</span> exp_all_ok = 1;</div>
<div class="line"><span class="lineno"> 2260</span> </div>
<div class="line"><span class="lineno"> 2261</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> rr = 0; rr &lt; (rounds &gt; 0 ? rounds : 1); ++rr) {</div>
<div class="line"><span class="lineno"> 2262</span>        <span class="keyword">const</span> <a class="code hl_struct" href="structprompt__round__record.html">prompt_round_record_t</a> *r = &amp;recs[(size_t)rr * n_prompts + pi];</div>
<div class="line"><span class="lineno"> 2263</span>        tok_sum += r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#a8cc938142194c5202bb275da807b0dbf">tokens_generated</a>;</div>
<div class="line"><span class="lineno"> 2264</span>        win_sum += r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#a8da08c83a326c2b7ab39fd7cfadb762b">window_time_s</a>;</div>
<div class="line"><span class="lineno"> 2265</span>        pre_sum += r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#a4ab0f6440e03c15551287b69ed070d94">prefill_time_s</a>;</div>
<div class="line"><span class="lineno"> 2266</span>        dec_sum += r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#aa08726c5eddf5bb4680d15b63b494dc8">decode_time_s</a>;</div>
<div class="line"><span class="lineno"> 2267</span> </div>
<div class="line"><span class="lineno"> 2268</span>        <span class="keywordflow">if</span> (r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#ad67c0f4a359b27e788a90c0477211293">expected_present</a>) exp_present = 1;</div>
<div class="line"><span class="lineno"> 2269</span>        <span class="keywordflow">if</span> (r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#ad67c0f4a359b27e788a90c0477211293">expected_present</a> &amp;&amp; !r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#adbf79594fd763d49b2eb13dcbd027c90">expected_ok</a>) exp_all_ok = 0;</div>
<div class="line"><span class="lineno"> 2270</span>      }</div>
<div class="line"><span class="lineno"> 2271</span> </div>
<div class="line"><span class="lineno"> 2272</span>      <span class="keyword">const</span> <span class="keywordtype">double</span> ptps_true = (dec_sum &gt; 0.0) ? ((<span class="keywordtype">double</span>)tok_sum / dec_sum) : 0.0;</div>
<div class="line"><span class="lineno"> 2273</span>      <span class="keyword">const</span> <span class="keywordtype">double</span> ptps_win = (win_sum &gt; 0.0) ? ((<span class="keywordtype">double</span>)tok_sum / win_sum) : 0.0;</div>
<div class="line"><span class="lineno"> 2274</span> </div>
<div class="line"><span class="lineno"> 2275</span>      fputs(<span class="stringliteral">&quot;{&quot;</span>, stdout);</div>
<div class="line"><span class="lineno"> 2276</span> </div>
<div class="line"><span class="lineno"> 2277</span>      fprintf(stdout, <span class="stringliteral">&quot;\&quot;prompt_index\&quot;:%zu,&quot;</span>, pi);</div>
<div class="line"><span class="lineno"> 2278</span>      fputs(<span class="stringliteral">&quot;\&quot;prompt\&quot;:&quot;</span>, stdout);</div>
<div class="line"><span class="lineno"> 2279</span>      <a class="code hl_function" href="main__infer_8c.html#a7427a4a1579fb747a4ce22a4a1d4a80a">json_print_escaped_string</a>(prompts-&gt;<a class="code hl_variable" href="structprompt__list.html#ad4b457e3153a399812c91acb3d2f399f">items</a>[pi]);</div>
<div class="line"><span class="lineno"> 2280</span>      fputs(<span class="stringliteral">&quot;,&quot;</span>, stdout);</div>
<div class="line"><span class="lineno"> 2281</span> </div>
<div class="line"><span class="lineno"> 2282</span>      fprintf(stdout, <span class="stringliteral">&quot;\&quot;prompt_id\&quot;:\&quot;0x%016&quot;</span> PRIx64 <span class="stringliteral">&quot;\&quot;,&quot;</span>, (uint64_t)<a class="code hl_function" href="main__infer_8c.html#ad7f42b712b3e86af5d9f8c9942bc8875">prompt_id_fnv1a64</a>(prompts-&gt;<a class="code hl_variable" href="structprompt__list.html#ad4b457e3153a399812c91acb3d2f399f">items</a>[pi]));</div>
<div class="line"><span class="lineno"> 2283</span> </div>
<div class="line"><span class="lineno"> 2284</span>      fprintf(stdout, <span class="stringliteral">&quot;\&quot;tokens_generated\&quot;:%zu,&quot;</span>, tok_sum);</div>
<div class="line"><span class="lineno"> 2285</span>      fprintf(stdout, <span class="stringliteral">&quot;\&quot;window_time_s\&quot;:%.6f,&quot;</span>, win_sum);</div>
<div class="line"><span class="lineno"> 2286</span>      fprintf(stdout, <span class="stringliteral">&quot;\&quot;prefill_time_s\&quot;:%.6f,&quot;</span>, pre_sum);</div>
<div class="line"><span class="lineno"> 2287</span>      fprintf(stdout, <span class="stringliteral">&quot;\&quot;decode_time_s\&quot;:%.6f,&quot;</span>, dec_sum);</div>
<div class="line"><span class="lineno"> 2288</span>      fprintf(stdout, <span class="stringliteral">&quot;\&quot;tps_true\&quot;:%.6f,&quot;</span>, ptps_true);</div>
<div class="line"><span class="lineno"> 2289</span>      fprintf(stdout, <span class="stringliteral">&quot;\&quot;tps_window\&quot;:%.6f,&quot;</span>, ptps_win);</div>
<div class="line"><span class="lineno"> 2290</span> </div>
<div class="line"><span class="lineno"> 2291</span>      fprintf(stdout, <span class="stringliteral">&quot;\&quot;expected_present\&quot;:%s,&quot;</span>, exp_present ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span>);</div>
<div class="line"><span class="lineno"> 2292</span>      fprintf(stdout, <span class="stringliteral">&quot;\&quot;expected_all_ok\&quot;:%s,&quot;</span>, (exp_present &amp;&amp; exp_all_ok) ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span>);</div>
<div class="line"><span class="lineno"> 2293</span> </div>
<div class="line"><span class="lineno"> 2294</span>      fputs(<span class="stringliteral">&quot;\&quot;rounds\&quot;:[&quot;</span>, stdout);</div>
<div class="line"><span class="lineno"> 2295</span>      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> rr = 0; rr &lt; (rounds &gt; 0 ? rounds : 1); ++rr) {</div>
<div class="line"><span class="lineno"> 2296</span>        <span class="keyword">const</span> <a class="code hl_struct" href="structprompt__round__record.html">prompt_round_record_t</a> *r = &amp;recs[(size_t)rr * n_prompts + pi];</div>
<div class="line"><span class="lineno"> 2297</span> </div>
<div class="line"><span class="lineno"> 2298</span>        fputs(<span class="stringliteral">&quot;{&quot;</span>, stdout);</div>
<div class="line"><span class="lineno"> 2299</span>        fprintf(stdout, <span class="stringliteral">&quot;\&quot;round\&quot;:%d,&quot;</span>, rr);</div>
<div class="line"><span class="lineno"> 2300</span>        fprintf(stdout, <span class="stringliteral">&quot;\&quot;tokens_generated\&quot;:%zu,&quot;</span>, r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#a8cc938142194c5202bb275da807b0dbf">tokens_generated</a>);</div>
<div class="line"><span class="lineno"> 2301</span>        fprintf(stdout, <span class="stringliteral">&quot;\&quot;window_time_s\&quot;:%.6f,&quot;</span>, r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#a8da08c83a326c2b7ab39fd7cfadb762b">window_time_s</a>);</div>
<div class="line"><span class="lineno"> 2302</span>        fprintf(stdout, <span class="stringliteral">&quot;\&quot;prefill_time_s\&quot;:%.6f,&quot;</span>, r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#a4ab0f6440e03c15551287b69ed070d94">prefill_time_s</a>);</div>
<div class="line"><span class="lineno"> 2303</span>        fprintf(stdout, <span class="stringliteral">&quot;\&quot;decode_time_s\&quot;:%.6f,&quot;</span>, r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#aa08726c5eddf5bb4680d15b63b494dc8">decode_time_s</a>);</div>
<div class="line"><span class="lineno"> 2304</span> </div>
<div class="line"><span class="lineno"> 2305</span>        fprintf(stdout, <span class="stringliteral">&quot;\&quot;expected_present\&quot;:%s,&quot;</span>, r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#ad67c0f4a359b27e788a90c0477211293">expected_present</a> ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span>);</div>
<div class="line"><span class="lineno"> 2306</span>        fprintf(stdout, <span class="stringliteral">&quot;\&quot;expected_ok\&quot;:%s,&quot;</span>, (r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#ad67c0f4a359b27e788a90c0477211293">expected_present</a> &amp;&amp; r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#adbf79594fd763d49b2eb13dcbd027c90">expected_ok</a>) ? <span class="stringliteral">&quot;true&quot;</span> : <span class="stringliteral">&quot;false&quot;</span>);</div>
<div class="line"><span class="lineno"> 2307</span> </div>
<div class="line"><span class="lineno"> 2308</span>        <span class="keywordflow">if</span> (r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#ad67c0f4a359b27e788a90c0477211293">expected_present</a> &amp;&amp; !r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#adbf79594fd763d49b2eb13dcbd027c90">expected_ok</a>) {</div>
<div class="line"><span class="lineno"> 2309</span>          fprintf(stdout, <span class="stringliteral">&quot;\&quot;mismatch_index\&quot;:%zu,&quot;</span>, r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#a639a8578fdf0ba299afe4f0783c47567">mismatch_index</a>);</div>
<div class="line"><span class="lineno"> 2310</span>          fprintf(stdout, <span class="stringliteral">&quot;\&quot;expected_at\&quot;:%d,&quot;</span>, r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#ae372c2117122aeea632490a6ea1526b1">expected_at</a>);</div>
<div class="line"><span class="lineno"> 2311</span>          fprintf(stdout, <span class="stringliteral">&quot;\&quot;actual_at\&quot;:%d,&quot;</span>, r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#a24eceb958921c2ab6ecf6fe0cdc5da49">actual_at</a>);</div>
<div class="line"><span class="lineno"> 2312</span>        }</div>
<div class="line"><span class="lineno"> 2313</span> </div>
<div class="line"><span class="lineno"> 2314</span>        fputs(<span class="stringliteral">&quot;\&quot;tokens\&quot;:&quot;</span>, stdout);</div>
<div class="line"><span class="lineno"> 2315</span>        <a class="code hl_function" href="main__infer_8c.html#a9205188606b8d4265d29fa8911259cac">json_print_int_array</a>(r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#a51223e3133e92ee93d77d6752e57d1bf">tokens</a>.<a class="code hl_variable" href="structreport__token__buf.html#a91b6556df06c25b311255a4a16f785dd">ids</a>, r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#a51223e3133e92ee93d77d6752e57d1bf">tokens</a>.<a class="code hl_variable" href="structreport__token__buf.html#a89ffa03443f19bf77470f85a92baa245">n</a>);</div>
<div class="line"><span class="lineno"> 2316</span>        fputs(<span class="stringliteral">&quot;,&quot;</span>, stdout);</div>
<div class="line"><span class="lineno"> 2317</span> </div>
<div class="line"><span class="lineno"> 2318</span>        <span class="keywordflow">if</span> (r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#a0c260950e8b81d2992debca2f4b49d00">decoded_text</a>) {</div>
<div class="line"><span class="lineno"> 2319</span>          fputs(<span class="stringliteral">&quot;\&quot;text\&quot;:&quot;</span>, stdout);</div>
<div class="line"><span class="lineno"> 2320</span>          <a class="code hl_function" href="main__infer_8c.html#a7427a4a1579fb747a4ce22a4a1d4a80a">json_print_escaped_string</a>(r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#a0c260950e8b81d2992debca2f4b49d00">decoded_text</a>);</div>
<div class="line"><span class="lineno"> 2321</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 2322</span>          fputs(<span class="stringliteral">&quot;\&quot;text\&quot;:null&quot;</span>, stdout);</div>
<div class="line"><span class="lineno"> 2323</span>        }</div>
<div class="line"><span class="lineno"> 2324</span> </div>
<div class="line"><span class="lineno"> 2325</span>        fputs(<span class="stringliteral">&quot;}&quot;</span>, stdout);</div>
<div class="line"><span class="lineno"> 2326</span>        <span class="keywordflow">if</span> (rr + 1 &lt; (rounds &gt; 0 ? rounds : 1)) fputs(<span class="stringliteral">&quot;,&quot;</span>, stdout);</div>
<div class="line"><span class="lineno"> 2327</span>      }</div>
<div class="line"><span class="lineno"> 2328</span>      fputs(<span class="stringliteral">&quot;]}&quot;</span>, stdout);</div>
<div class="line"><span class="lineno"> 2329</span> </div>
<div class="line"><span class="lineno"> 2330</span>      <span class="keywordflow">if</span> (pi + 1 &lt; n_prompts) fputs(<span class="stringliteral">&quot;,&quot;</span>, stdout);</div>
<div class="line"><span class="lineno"> 2331</span>    }</div>
<div class="line"><span class="lineno"> 2332</span>  }</div>
<div class="line"><span class="lineno"> 2333</span>  fputs(<span class="stringliteral">&quot;]}\n&quot;</span>, stdout);</div>
<div class="line"><span class="lineno"> 2334</span>}</div>
<div class="ttc" id="amain__infer_8c_html_a7427a4a1579fb747a4ce22a4a1d4a80a"><div class="ttname"><a href="main__infer_8c.html#a7427a4a1579fb747a4ce22a4a1d4a80a">json_print_escaped_string</a></div><div class="ttdeci">static void json_print_escaped_string(const char *s)</div><div class="ttdoc">JSON-escape and print a string value.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00761">main_infer.c:761</a></div></div>
<div class="ttc" id="amain__infer_8c_html_a9205188606b8d4265d29fa8911259cac"><div class="ttname"><a href="main__infer_8c.html#a9205188606b8d4265d29fa8911259cac">json_print_int_array</a></div><div class="ttdeci">static void json_print_int_array(const int *ids, size_t n)</div><div class="ttdoc">Print a JSON array of integers.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l02131">main_infer.c:2131</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="main__infer_8c_source.html#l02099">prompt_round_record::actual_at</a>, <a class="el" href="main__infer_8c_source.html#l01552">prompt_list::count</a>, <a class="el" href="main__infer_8c_source.html#l02093">prompt_round_record::decode_time_s</a>, <a class="el" href="main__infer_8c_source.html#l02101">prompt_round_record::decoded_text</a>, <a class="el" href="main__infer_8c_source.html#l02098">prompt_round_record::expected_at</a>, <a class="el" href="main__infer_8c_source.html#l02096">prompt_round_record::expected_ok</a>, <a class="el" href="main__infer_8c_source.html#l02095">prompt_round_record::expected_present</a>, <a class="el" href="main__infer_8c_source.html#l02023">report_token_buf::ids</a>, <a class="el" href="main__infer_8c_source.html#l01551">prompt_list::items</a>, <a class="el" href="main__infer_8c_source.html#l00761">json_print_escaped_string()</a>, <a class="el" href="main__infer_8c_source.html#l02131">json_print_int_array()</a>, <a class="el" href="main__infer_8c_source.html#l02097">prompt_round_record::mismatch_index</a>, <a class="el" href="main__infer_8c_source.html#l02024">report_token_buf::n</a>, <a class="el" href="main__infer_8c_source.html#l02092">prompt_round_record::prefill_time_s</a>, <a class="el" href="main__infer_8c_source.html#l01690">prompt_id_fnv1a64()</a>, <a class="el" href="main__infer_8c_source.html#l02089">prompt_round_record::tokens</a>, <a class="el" href="main__infer_8c_source.html#l02088">prompt_round_record::tokens_generated</a>, and <a class="el" href="main__infer_8c_source.html#l02091">prompt_round_record::window_time_s</a>.</p>

<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l02362">main()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a84b40472513bc66398c6d3049891f553_cgraph.svg" width="340" height="151"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a84b40472513bc66398c6d3049891f553_icgraph.svg" width="244" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ad7f42b712b3e86af5d9f8c9942bc8875" name="ad7f42b712b3e86af5d9f8c9942bc8875"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad7f42b712b3e86af5d9f8c9942bc8875">&#9670;&#160;</a></span>prompt_id_fnv1a64()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint64_t prompt_id_fnv1a64 </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>s</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Compute a stable 64-bit prompt ID (FNV-1a over bytes). </p>
<p>This avoids storing or parsing raw prompt strings in the golden file and keeps the comparison logic simple and deterministic.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>Prompt string (UTF-8). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>64-bit FNV-1a hash of the prompt bytes.</dd></dl>
<p>prompt_id_fnv1a64.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>See implementation for details.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>See implementation for details. </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l01690">1690</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1690</span>                                                 {</div>
<div class="line"><span class="lineno"> 1691</span>  <span class="keyword">const</span> uint64_t FNV_OFF = 1469598103934665603ULL;</div>
<div class="line"><span class="lineno"> 1692</span>  <span class="keyword">const</span> uint64_t FNV_PRIME = 1099511628211ULL;</div>
<div class="line"><span class="lineno"> 1693</span> </div>
<div class="line"><span class="lineno"> 1694</span>  uint64_t h = FNV_OFF;</div>
<div class="line"><span class="lineno"> 1695</span>  <span class="keywordflow">if</span> (!s) <span class="keywordflow">return</span> h;</div>
<div class="line"><span class="lineno"> 1696</span> </div>
<div class="line"><span class="lineno"> 1697</span>  <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *p = (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)s;</div>
<div class="line"><span class="lineno"> 1698</span>  <span class="keywordflow">while</span> (*p) {</div>
<div class="line"><span class="lineno"> 1699</span>    h ^= (uint64_t)(*p++);</div>
<div class="line"><span class="lineno"> 1700</span>    h *= FNV_PRIME;</div>
<div class="line"><span class="lineno"> 1701</span>  }</div>
<div class="line"><span class="lineno"> 1702</span>  <span class="keywordflow">return</span> h;</div>
<div class="line"><span class="lineno"> 1703</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l02362">main()</a>, and <a class="el" href="main__infer_8c_source.html#l02171">print_json_result()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_ad7f42b712b3e86af5d9f8c9942bc8875_icgraph.svg" width="440" height="62"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ab06a46b9f23d08de776ec7d3258b6588" name="ab06a46b9f23d08de776ec7d3258b6588"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab06a46b9f23d08de776ec7d3258b6588">&#9670;&#160;</a></span>prompt_list_free()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void prompt_list_free </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="main__infer_8c.html#aa2c236bcd5a489e1a409ffd5f4c532f7">prompt_list_t</a> *&#160;</td>
          <td class="paramname"><em>pl</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Free a prompt list and all owned strings. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pl</td><td>Prompt list to free.</td></tr>
  </table>
  </dd>
</dl>
<p>prompt_list_free.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pl</td><td>See implementation for details. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l01581">1581</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1581</span>                                                {</div>
<div class="line"><span class="lineno"> 1582</span>  <span class="keywordflow">if</span> (!pl) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1583</span>  <span class="keywordflow">if</span> (pl-&gt;<a class="code hl_variable" href="structprompt__list.html#ad4b457e3153a399812c91acb3d2f399f">items</a>) {</div>
<div class="line"><span class="lineno"> 1584</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; pl-&gt;<a class="code hl_variable" href="structprompt__list.html#ab60c60299e5806652f4c2c7a94aca5c3">count</a>; ++i) free(pl-&gt;<a class="code hl_variable" href="structprompt__list.html#ad4b457e3153a399812c91acb3d2f399f">items</a>[i]);</div>
<div class="line"><span class="lineno"> 1585</span>    free(pl-&gt;<a class="code hl_variable" href="structprompt__list.html#ad4b457e3153a399812c91acb3d2f399f">items</a>);</div>
<div class="line"><span class="lineno"> 1586</span>  }</div>
<div class="line"><span class="lineno"> 1587</span>  pl-&gt;<a class="code hl_variable" href="structprompt__list.html#ad4b457e3153a399812c91acb3d2f399f">items</a> = NULL;</div>
<div class="line"><span class="lineno"> 1588</span>  pl-&gt;<a class="code hl_variable" href="structprompt__list.html#ab60c60299e5806652f4c2c7a94aca5c3">count</a> = 0;</div>
<div class="line"><span class="lineno"> 1589</span>  pl-&gt;<a class="code hl_variable" href="structprompt__list.html#a1b38f2bff67306ab0d56dfa5017c2302">cap</a> = 0;</div>
<div class="line"><span class="lineno"> 1590</span>}</div>
<div class="ttc" id="astructprompt__list_html_a1b38f2bff67306ab0d56dfa5017c2302"><div class="ttname"><a href="structprompt__list.html#a1b38f2bff67306ab0d56dfa5017c2302">prompt_list::cap</a></div><div class="ttdeci">size_t cap</div><div class="ttdoc">Capacity of items.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l01553">main_infer.c:1553</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="main__infer_8c_source.html#l01553">prompt_list::cap</a>, <a class="el" href="main__infer_8c_source.html#l01552">prompt_list::count</a>, and <a class="el" href="main__infer_8c_source.html#l01551">prompt_list::items</a>.</p>

<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l02362">main()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_ab06a46b9f23d08de776ec7d3258b6588_icgraph.svg" width="243" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a9891db61dca3c60715c6b2f7aad7f5a1" name="a9891db61dca3c60715c6b2f7aad7f5a1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9891db61dca3c60715c6b2f7aad7f5a1">&#9670;&#160;</a></span>prompt_list_init()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void prompt_list_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="main__infer_8c.html#aa2c236bcd5a489e1a409ffd5f4c532f7">prompt_list_t</a> *&#160;</td>
          <td class="paramname"><em>pl</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Initialize an empty prompt list. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pl</td><td>Prompt list to initialize.</td></tr>
  </table>
  </dd>
</dl>
<p>prompt_list_init.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pl</td><td>See implementation for details. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l01565">1565</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1565</span>                                                {</div>
<div class="line"><span class="lineno"> 1566</span>  <span class="keywordflow">if</span> (!pl) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1567</span>  pl-&gt;<a class="code hl_variable" href="structprompt__list.html#ad4b457e3153a399812c91acb3d2f399f">items</a> = NULL;</div>
<div class="line"><span class="lineno"> 1568</span>  pl-&gt;<a class="code hl_variable" href="structprompt__list.html#ab60c60299e5806652f4c2c7a94aca5c3">count</a> = 0;</div>
<div class="line"><span class="lineno"> 1569</span>  pl-&gt;<a class="code hl_variable" href="structprompt__list.html#a1b38f2bff67306ab0d56dfa5017c2302">cap</a> = 0;</div>
<div class="line"><span class="lineno"> 1570</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="main__infer_8c_source.html#l01553">prompt_list::cap</a>, <a class="el" href="main__infer_8c_source.html#l01552">prompt_list::count</a>, and <a class="el" href="main__infer_8c_source.html#l01551">prompt_list::items</a>.</p>

<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l02362">main()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a9891db61dca3c60715c6b2f7aad7f5a1_icgraph.svg" width="238" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a9be857b0051297813c2cb218accbb5c8" name="a9be857b0051297813c2cb218accbb5c8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9be857b0051297813c2cb218accbb5c8">&#9670;&#160;</a></span>prompt_list_push_copy()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int prompt_list_push_copy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="main__infer_8c.html#aa2c236bcd5a489e1a409ffd5f4c532f7">prompt_list_t</a> *&#160;</td>
          <td class="paramname"><em>pl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>s</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Push a prompt string copy into the list. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pl</td><td>Prompt list. </td></tr>
    <tr><td class="paramname">s</td><td>Prompt string (must be non-NULL). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, nonzero on OOM.</dd></dl>
<p>prompt_list_push_copy.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pl</td><td>See implementation for details. </td></tr>
    <tr><td class="paramname">s</td><td>See implementation for details.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>See implementation for details. </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l01606">1606</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1606</span>                                                                   {</div>
<div class="line"><span class="lineno"> 1607</span>  <span class="keywordflow">if</span> (!pl || !s) <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 1608</span> </div>
<div class="line"><span class="lineno"> 1609</span>  <span class="keywordflow">if</span> (pl-&gt;<a class="code hl_variable" href="structprompt__list.html#ab60c60299e5806652f4c2c7a94aca5c3">count</a> == pl-&gt;<a class="code hl_variable" href="structprompt__list.html#a1b38f2bff67306ab0d56dfa5017c2302">cap</a>) {</div>
<div class="line"><span class="lineno"> 1610</span>    <span class="keywordtype">size_t</span> ncap = (pl-&gt;<a class="code hl_variable" href="structprompt__list.html#a1b38f2bff67306ab0d56dfa5017c2302">cap</a> == 0) ? 16 : (pl-&gt;cap * 2);</div>
<div class="line"><span class="lineno"> 1611</span>    <span class="keywordtype">char</span> **nitems = (<span class="keywordtype">char</span> **)realloc(pl-&gt;<a class="code hl_variable" href="structprompt__list.html#ad4b457e3153a399812c91acb3d2f399f">items</a>, ncap * <span class="keyword">sizeof</span>(<span class="keywordtype">char</span> *));</div>
<div class="line"><span class="lineno"> 1612</span>    <span class="keywordflow">if</span> (!nitems) <span class="keywordflow">return</span> 2;</div>
<div class="line"><span class="lineno"> 1613</span>    pl-&gt;<a class="code hl_variable" href="structprompt__list.html#ad4b457e3153a399812c91acb3d2f399f">items</a> = nitems;</div>
<div class="line"><span class="lineno"> 1614</span>    pl-&gt;<a class="code hl_variable" href="structprompt__list.html#a1b38f2bff67306ab0d56dfa5017c2302">cap</a> = ncap;</div>
<div class="line"><span class="lineno"> 1615</span>  }</div>
<div class="line"><span class="lineno"> 1616</span> </div>
<div class="line"><span class="lineno"> 1617</span>  <span class="keywordtype">char</span> *cp = <a class="code hl_function" href="main__infer_8c.html#a39103ce72021a890c3e333b949068a1c">heap_strdup</a>(s);</div>
<div class="line"><span class="lineno"> 1618</span>  <span class="keywordflow">if</span> (!cp) <span class="keywordflow">return</span> 3;</div>
<div class="line"><span class="lineno"> 1619</span> </div>
<div class="line"><span class="lineno"> 1620</span>  pl-&gt;<a class="code hl_variable" href="structprompt__list.html#ad4b457e3153a399812c91acb3d2f399f">items</a>[pl-&gt;<a class="code hl_variable" href="structprompt__list.html#ab60c60299e5806652f4c2c7a94aca5c3">count</a>++] = cp;</div>
<div class="line"><span class="lineno"> 1621</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1622</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="main__infer_8c_source.html#l01553">prompt_list::cap</a>, <a class="el" href="main__infer_8c_source.html#l01552">prompt_list::count</a>, <a class="el" href="main__infer_8c_source.html#l00449">heap_strdup()</a>, and <a class="el" href="main__infer_8c_source.html#l01551">prompt_list::items</a>.</p>

<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l02362">main()</a>, and <a class="el" href="main__infer_8c_source.html#l01641">prompt_list_read_file()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a9be857b0051297813c2cb218accbb5c8_cgraph.svg" width="334" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a9be857b0051297813c2cb218accbb5c8_icgraph.svg" width="492" height="62"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a3d826199fc8a9ddb8a49f324c2ff1dc5" name="a3d826199fc8a9ddb8a49f324c2ff1dc5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3d826199fc8a9ddb8a49f324c2ff1dc5">&#9670;&#160;</a></span>prompt_list_read_file()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int prompt_list_read_file </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="main__infer_8c.html#aa2c236bcd5a489e1a409ffd5f4c532f7">prompt_list_t</a> *&#160;</td>
          <td class="paramname"><em>out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Read all non-empty lines from a prompts file into memory. </p>
<p>Lines are trimmed of trailing CR/LF. Empty lines are skipped.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">path</td><td>Prompts file path. </td></tr>
    <tr><td class="paramname">out</td><td>Prompt list to fill (must be initialized). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, nonzero on failure.</dd></dl>
<p>prompt_list_read_file.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">path</td><td>See implementation for details. </td></tr>
    <tr><td class="paramname">out</td><td>See implementation for details.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>See implementation for details. </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l01641">1641</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1641</span>                                                                       {</div>
<div class="line"><span class="lineno"> 1642</span>  <span class="keywordflow">if</span> (!path || !*path || !out) <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 1643</span> </div>
<div class="line"><span class="lineno"> 1644</span>  FILE *f = fopen(path, <span class="stringliteral">&quot;r&quot;</span>);</div>
<div class="line"><span class="lineno"> 1645</span>  <span class="keywordflow">if</span> (!f) {</div>
<div class="line"><span class="lineno"> 1646</span>    fprintf(stderr, <span class="stringliteral">&quot;warn: cannot open prompts file &#39;%s&#39;: %s\n&quot;</span>, path, strerror(errno));</div>
<div class="line"><span class="lineno"> 1647</span>    <span class="keywordflow">return</span> 2;</div>
<div class="line"><span class="lineno"> 1648</span>  }</div>
<div class="line"><span class="lineno"> 1649</span> </div>
<div class="line"><span class="lineno"> 1650</span>  <span class="keywordtype">char</span> line[8192];</div>
<div class="line"><span class="lineno"> 1651</span>  <span class="keywordtype">int</span> rc = 0;</div>
<div class="line"><span class="lineno"> 1652</span> </div>
<div class="line"><span class="lineno"> 1653</span>  <span class="keywordflow">while</span> (fgets(line, (<span class="keywordtype">int</span>)<span class="keyword">sizeof</span>(line), f)) {</div>
<div class="line"><span class="lineno"> 1654</span>    <span class="keywordtype">size_t</span> n = strlen(line);</div>
<div class="line"><span class="lineno"> 1655</span>    <span class="keywordflow">while</span> (n &amp;&amp; (line[n - 1] == <span class="charliteral">&#39;\n&#39;</span> || line[n - 1] == <span class="charliteral">&#39;\r&#39;</span>)) line[--n] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 1656</span>    <span class="keywordflow">if</span> (n == 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1657</span> </div>
<div class="line"><span class="lineno"> 1658</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#a9be857b0051297813c2cb218accbb5c8">prompt_list_push_copy</a>(out, line) != 0) {</div>
<div class="line"><span class="lineno"> 1659</span>      rc = 3;</div>
<div class="line"><span class="lineno"> 1660</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1661</span>    }</div>
<div class="line"><span class="lineno"> 1662</span>  }</div>
<div class="line"><span class="lineno"> 1663</span> </div>
<div class="line"><span class="lineno"> 1664</span>  (void)fclose(f);</div>
<div class="line"><span class="lineno"> 1665</span> </div>
<div class="line"><span class="lineno"> 1666</span>  <span class="comment">/* Empty file is not an error; caller can decide how to handle it. */</span></div>
<div class="line"><span class="lineno"> 1667</span>  <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno"> 1668</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="main__infer_8c_source.html#l01606">prompt_list_push_copy()</a>.</p>

<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l02362">main()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a3d826199fc8a9ddb8a49f324c2ff1dc5_cgraph.svg" width="540" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a3d826199fc8a9ddb8a49f324c2ff1dc5_icgraph.svg" width="272" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="aa8860ddc49714b553fe669c784885cff" name="aa8860ddc49714b553fe669c784885cff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa8860ddc49714b553fe669c784885cff">&#9670;&#160;</a></span>prompt_round_record_free()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void prompt_round_record_free </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="main__infer_8c.html#af8802263c4d59c173623fe774ce0abb0">prompt_round_record_t</a> *&#160;</td>
          <td class="paramname"><em>r</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Free a prompt-round record. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">r</td><td>Record.</td></tr>
  </table>
  </dd>
</dl>
<p>prompt_round_record_free.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">r</td><td>See implementation for details. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l02113">2113</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2113</span>                                                               {</div>
<div class="line"><span class="lineno"> 2114</span>  <span class="keywordflow">if</span> (!r) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 2115</span>  <a class="code hl_function" href="main__infer_8c.html#af91bda098d580c2cf56b5beda68bd2d5">report_token_buf_free</a>(&amp;r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#a51223e3133e92ee93d77d6752e57d1bf">tokens</a>);</div>
<div class="line"><span class="lineno"> 2116</span>  free(r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#a0c260950e8b81d2992debca2f4b49d00">decoded_text</a>);</div>
<div class="line"><span class="lineno"> 2117</span>  r-&gt;<a class="code hl_variable" href="structprompt__round__record.html#a0c260950e8b81d2992debca2f4b49d00">decoded_text</a> = NULL;</div>
<div class="line"><span class="lineno"> 2118</span>}</div>
<div class="ttc" id="amain__infer_8c_html_af91bda098d580c2cf56b5beda68bd2d5"><div class="ttname"><a href="main__infer_8c.html#af91bda098d580c2cf56b5beda68bd2d5">report_token_buf_free</a></div><div class="ttdeci">static void report_token_buf_free(report_token_buf_t *b)</div><div class="ttdoc">Free a report token buffer.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l02036">main_infer.c:2036</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="main__infer_8c_source.html#l02101">prompt_round_record::decoded_text</a>, <a class="el" href="main__infer_8c_source.html#l02036">report_token_buf_free()</a>, and <a class="el" href="main__infer_8c_source.html#l02089">prompt_round_record::tokens</a>.</p>

<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l02362">main()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_aa8860ddc49714b553fe669c784885cff_cgraph.svg" width="419" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_aa8860ddc49714b553fe669c784885cff_icgraph.svg" width="308" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a609fc6d778b714530dadf2ef012acf5c" name="a609fc6d778b714530dadf2ef012acf5c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a609fc6d778b714530dadf2ef012acf5c">&#9670;&#160;</a></span>read_first_nonempty_line()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int read_first_nonempty_line </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>bufsz</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Read the first non-empty line from a text file. </p>
<p>This helper is preserved for compatibility and for quick, human-friendly runs. The benchmark harness should use <code>--prompts-file</code> (and will automatically enable <code>--aggregate</code> when no explicit <code>--prompt</code> is provided).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">path</td><td>File path. </td></tr>
    <tr><td class="paramname">buf</td><td>Output buffer. </td></tr>
    <tr><td class="paramname">bufsz</td><td>Output capacity. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 if a line was read, 0 if none, -1 on error.</dd></dl>
<p>read_first_nonempty_line.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">path</td><td>See implementation for details. </td></tr>
    <tr><td class="paramname">buf</td><td>See implementation for details. </td></tr>
    <tr><td class="paramname">bufsz</td><td>See implementation for details.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>See implementation for details. </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l01527">1527</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1527</span>                                                                               {</div>
<div class="line"><span class="lineno"> 1528</span>  FILE *f = fopen(path, <span class="stringliteral">&quot;r&quot;</span>);</div>
<div class="line"><span class="lineno"> 1529</span>  <span class="keywordflow">if</span> (!f) {</div>
<div class="line"><span class="lineno"> 1530</span>    fprintf(stderr, <span class="stringliteral">&quot;warn: cannot open prompts file &#39;%s&#39;: %s\n&quot;</span>, path, strerror(errno));</div>
<div class="line"><span class="lineno"> 1531</span>    <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno"> 1532</span>  }</div>
<div class="line"><span class="lineno"> 1533</span> </div>
<div class="line"><span class="lineno"> 1534</span>  <span class="keywordtype">int</span> ok = 0;</div>
<div class="line"><span class="lineno"> 1535</span>  <span class="keywordflow">while</span> (fgets(buf, (<span class="keywordtype">int</span>)bufsz, f)) {</div>
<div class="line"><span class="lineno"> 1536</span>    <span class="keywordtype">size_t</span> n = strlen(buf);</div>
<div class="line"><span class="lineno"> 1537</span>    <span class="keywordflow">while</span> (n &amp;&amp; (buf[n - 1] == <span class="charliteral">&#39;\n&#39;</span> || buf[n - 1] == <span class="charliteral">&#39;\r&#39;</span>)) buf[--n] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 1538</span>    <span class="keywordflow">if</span> (n == 0) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1539</span>    ok = 1;</div>
<div class="line"><span class="lineno"> 1540</span>    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1541</span>  }</div>
<div class="line"><span class="lineno"> 1542</span> </div>
<div class="line"><span class="lineno"> 1543</span>  (void)fclose(f);</div>
<div class="line"><span class="lineno"> 1544</span>  <span class="keywordflow">return</span> ok ? 1 : 0;</div>
<div class="line"><span class="lineno"> 1545</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l02362">main()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a609fc6d778b714530dadf2ef012acf5c_icgraph.svg" width="300" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a23f6c5852d73ecbdb1dead2be803bcf0" name="a23f6c5852d73ecbdb1dead2be803bcf0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a23f6c5852d73ecbdb1dead2be803bcf0">&#9670;&#160;</a></span>report_token_buf_copy()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int report_token_buf_copy </td>
          <td>(</td>
          <td class="paramtype">const int *&#160;</td>
          <td class="paramname"><em>ids</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>max_keep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="main__infer_8c.html#aeaf1944cb54f4e8f7a914be88b362163">report_token_buf_t</a> *&#160;</td>
          <td class="paramname"><em>out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Copy tokens into a report token buffer (truncating if requested). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ids</td><td>Input token IDs. </td></tr>
    <tr><td class="paramname">n</td><td>Input token count. </td></tr>
    <tr><td class="paramname">max_keep</td><td>Maximum tokens to keep (0 keeps all). </td></tr>
    <tr><td class="paramname">out</td><td>Output buffer (owned). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, nonzero on OOM.</dd></dl>
<p>report_token_buf_copy.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ids</td><td>See implementation for details. </td></tr>
    <tr><td class="paramname">n</td><td>See implementation for details. </td></tr>
    <tr><td class="paramname">max_keep</td><td>See implementation for details. </td></tr>
    <tr><td class="paramname">out</td><td>See implementation for details.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>See implementation for details. </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l02062">2062</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2062</span>                                                                                                     {</div>
<div class="line"><span class="lineno"> 2063</span>  <span class="keywordflow">if</span> (!out) <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno"> 2064</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;ids = NULL;</div>
<div class="line"><span class="lineno"> 2065</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;n = 0;</div>
<div class="line"><span class="lineno"> 2066</span>  <span class="keywordflow">if</span> (!ids || n == 0) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 2067</span> </div>
<div class="line"><span class="lineno"> 2068</span>  <span class="keywordtype">size_t</span> keep = n;</div>
<div class="line"><span class="lineno"> 2069</span>  <span class="keywordflow">if</span> (max_keep &gt; 0 &amp;&amp; keep &gt; max_keep) keep = max_keep;</div>
<div class="line"><span class="lineno"> 2070</span> </div>
<div class="line"><span class="lineno"> 2071</span>  <span class="keywordtype">int</span> *cp = (<span class="keywordtype">int</span> *)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * keep);</div>
<div class="line"><span class="lineno"> 2072</span>  <span class="keywordflow">if</span> (!cp) <span class="keywordflow">return</span> 2;</div>
<div class="line"><span class="lineno"> 2073</span>  memcpy(cp, ids, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * keep);</div>
<div class="line"><span class="lineno"> 2074</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;ids = cp;</div>
<div class="line"><span class="lineno"> 2075</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;n = keep;</div>
<div class="line"><span class="lineno"> 2076</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 2077</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l02362">main()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a23f6c5852d73ecbdb1dead2be803bcf0_icgraph.svg" width="284" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="af91bda098d580c2cf56b5beda68bd2d5" name="af91bda098d580c2cf56b5beda68bd2d5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af91bda098d580c2cf56b5beda68bd2d5">&#9670;&#160;</a></span>report_token_buf_free()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void report_token_buf_free </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="main__infer_8c.html#aeaf1944cb54f4e8f7a914be88b362163">report_token_buf_t</a> *&#160;</td>
          <td class="paramname"><em>b</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Free a report token buffer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">b</td><td>Buffer.</td></tr>
  </table>
  </dd>
</dl>
<p>report_token_buf_free.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">b</td><td>See implementation for details. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l02036">2036</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 2036</span>                                                         {</div>
<div class="line"><span class="lineno"> 2037</span>  <span class="keywordflow">if</span> (!b) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 2038</span>  free(b-&gt;<a class="code hl_variable" href="structreport__token__buf.html#a91b6556df06c25b311255a4a16f785dd">ids</a>);</div>
<div class="line"><span class="lineno"> 2039</span>  b-&gt;<a class="code hl_variable" href="structreport__token__buf.html#a91b6556df06c25b311255a4a16f785dd">ids</a> = NULL;</div>
<div class="line"><span class="lineno"> 2040</span>  b-&gt;<a class="code hl_variable" href="structreport__token__buf.html#a89ffa03443f19bf77470f85a92baa245">n</a> = 0;</div>
<div class="line"><span class="lineno"> 2041</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="main__infer_8c_source.html#l02023">report_token_buf::ids</a>, and <a class="el" href="main__infer_8c_source.html#l02024">report_token_buf::n</a>.</p>

<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l02113">prompt_round_record_free()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_af91bda098d580c2cf56b5beda68bd2d5_icgraph.svg" width="522" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ad6b894571e18a35f21d8451e008fae37" name="ad6b894571e18a35f21d8451e008fae37"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad6b894571e18a35f21d8451e008fae37">&#9670;&#160;</a></span>resolve_model_paths()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void resolve_model_paths </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>model_dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>model_json_opt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>model_bin_opt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>precision</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>out_json</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>out_json_sz</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>out_bin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>out_bin_sz</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Resolve model JSON/BIN paths based on model_dir and precision defaults. </p>
<p>For int4, prefer model.ie.compat.json when present and model.q4.bin when present.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">model_dir</td><td>Model directory (may be NULL/empty). </td></tr>
    <tr><td class="paramname">model_json_opt</td><td>Optional override for JSON (relative to model_dir unless absolute). </td></tr>
    <tr><td class="paramname">model_bin_opt</td><td>Optional override for BIN (relative to model_dir unless absolute). </td></tr>
    <tr><td class="paramname">precision</td><td>Precision label (used for int4 defaults). </td></tr>
    <tr><td class="paramname">out_json</td><td>Output JSON path. </td></tr>
    <tr><td class="paramname">out_json_sz</td><td>Output JSON capacity. </td></tr>
    <tr><td class="paramname">out_bin</td><td>Output BIN path. </td></tr>
    <tr><td class="paramname">out_bin_sz</td><td>Output BIN capacity. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00378">378</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  383</span>                                                                 {</div>
<div class="line"><span class="lineno">  384</span>  <span class="keywordtype">char</span> dir_canon[<a class="code hl_define" href="main__infer_8c.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>];</div>
<div class="line"><span class="lineno">  385</span>  dir_canon[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  386</span>  (void)<a class="code hl_function" href="main__infer_8c.html#a680d5eb9763f52ea89ce1764e01121dc">canon_dir</a>(dir_canon, <span class="keyword">sizeof</span>(dir_canon), model_dir);</div>
<div class="line"><span class="lineno">  387</span> </div>
<div class="line"><span class="lineno">  388</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *base_dir = (dir_canon[0] ? dir_canon : model_dir);</div>
<div class="line"><span class="lineno">  389</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> want_int4 = <a class="code hl_function" href="main__infer_8c.html#a937426768611822fbe840722069c7043">is_int4_precision</a>(precision);</div>
<div class="line"><span class="lineno">  390</span> </div>
<div class="line"><span class="lineno">  391</span>  <span class="keywordflow">if</span> (model_json_opt &amp;&amp; *model_json_opt) {</div>
<div class="line"><span class="lineno">  392</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#a35a9aadd511e6b3688d01a67a12c7651">path_is_abs</a>(model_json_opt) || !base_dir || !*base_dir) <a class="code hl_function" href="main__infer_8c.html#a210133797f21fcee710ec892841dce42">safe_strcpy</a>(out_json, out_json_sz, model_json_opt);</div>
<div class="line"><span class="lineno">  393</span>    <span class="keywordflow">else</span> <a class="code hl_function" href="main__infer_8c.html#adca9b33a342b8635e28ba51aecb365f6">join_path</a>(out_json, out_json_sz, base_dir, model_json_opt);</div>
<div class="line"><span class="lineno">  394</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  395</span>    <span class="keywordflow">if</span> (base_dir &amp;&amp; *base_dir) {</div>
<div class="line"><span class="lineno">  396</span>      <span class="keywordflow">if</span> (want_int4) {</div>
<div class="line"><span class="lineno">  397</span>        <span class="keywordtype">char</span> cand[<a class="code hl_define" href="main__infer_8c.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>];</div>
<div class="line"><span class="lineno">  398</span>        <a class="code hl_function" href="main__infer_8c.html#adca9b33a342b8635e28ba51aecb365f6">join_path</a>(cand, <span class="keyword">sizeof</span>(cand), base_dir, <span class="stringliteral">&quot;model.ie.compat.json&quot;</span>);</div>
<div class="line"><span class="lineno">  399</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#a0cbea455e9868581360f43c63db6554c">path_exists</a>(cand)) <a class="code hl_function" href="main__infer_8c.html#a210133797f21fcee710ec892841dce42">safe_strcpy</a>(out_json, out_json_sz, cand);</div>
<div class="line"><span class="lineno">  400</span>        <span class="keywordflow">else</span> <a class="code hl_function" href="main__infer_8c.html#adca9b33a342b8635e28ba51aecb365f6">join_path</a>(out_json, out_json_sz, base_dir, <span class="stringliteral">&quot;model.ie.json&quot;</span>);</div>
<div class="line"><span class="lineno">  401</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  402</span>        <a class="code hl_function" href="main__infer_8c.html#adca9b33a342b8635e28ba51aecb365f6">join_path</a>(out_json, out_json_sz, base_dir, <span class="stringliteral">&quot;model.ie.json&quot;</span>);</div>
<div class="line"><span class="lineno">  403</span>      }</div>
<div class="line"><span class="lineno">  404</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  405</span>      <a class="code hl_function" href="main__infer_8c.html#a210133797f21fcee710ec892841dce42">safe_strcpy</a>(out_json, out_json_sz, <span class="stringliteral">&quot;./model.ie.json&quot;</span>);</div>
<div class="line"><span class="lineno">  406</span>    }</div>
<div class="line"><span class="lineno">  407</span>  }</div>
<div class="line"><span class="lineno">  408</span> </div>
<div class="line"><span class="lineno">  409</span>  <span class="keywordflow">if</span> (model_bin_opt &amp;&amp; *model_bin_opt) {</div>
<div class="line"><span class="lineno">  410</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#a35a9aadd511e6b3688d01a67a12c7651">path_is_abs</a>(model_bin_opt) || !base_dir || !*base_dir) <a class="code hl_function" href="main__infer_8c.html#a210133797f21fcee710ec892841dce42">safe_strcpy</a>(out_bin, out_bin_sz, model_bin_opt);</div>
<div class="line"><span class="lineno">  411</span>    <span class="keywordflow">else</span> <a class="code hl_function" href="main__infer_8c.html#adca9b33a342b8635e28ba51aecb365f6">join_path</a>(out_bin, out_bin_sz, base_dir, model_bin_opt);</div>
<div class="line"><span class="lineno">  412</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  413</span>    <span class="keywordflow">if</span> (base_dir &amp;&amp; *base_dir) {</div>
<div class="line"><span class="lineno">  414</span>      <span class="keywordflow">if</span> (want_int4) {</div>
<div class="line"><span class="lineno">  415</span>        <span class="keywordtype">char</span> cand[<a class="code hl_define" href="main__infer_8c.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>];</div>
<div class="line"><span class="lineno">  416</span>        <a class="code hl_function" href="main__infer_8c.html#adca9b33a342b8635e28ba51aecb365f6">join_path</a>(cand, <span class="keyword">sizeof</span>(cand), base_dir, <span class="stringliteral">&quot;model.q4.bin&quot;</span>);</div>
<div class="line"><span class="lineno">  417</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#a0cbea455e9868581360f43c63db6554c">path_exists</a>(cand)) <a class="code hl_function" href="main__infer_8c.html#a210133797f21fcee710ec892841dce42">safe_strcpy</a>(out_bin, out_bin_sz, cand);</div>
<div class="line"><span class="lineno">  418</span>        <span class="keywordflow">else</span> <a class="code hl_function" href="main__infer_8c.html#adca9b33a342b8635e28ba51aecb365f6">join_path</a>(out_bin, out_bin_sz, base_dir, <span class="stringliteral">&quot;model.ie.bin&quot;</span>);</div>
<div class="line"><span class="lineno">  419</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  420</span>        <a class="code hl_function" href="main__infer_8c.html#adca9b33a342b8635e28ba51aecb365f6">join_path</a>(out_bin, out_bin_sz, base_dir, <span class="stringliteral">&quot;model.ie.bin&quot;</span>);</div>
<div class="line"><span class="lineno">  421</span>      }</div>
<div class="line"><span class="lineno">  422</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  423</span>      <a class="code hl_function" href="main__infer_8c.html#a210133797f21fcee710ec892841dce42">safe_strcpy</a>(out_bin, out_bin_sz, <span class="stringliteral">&quot;./model.ie.bin&quot;</span>);</div>
<div class="line"><span class="lineno">  424</span>    }</div>
<div class="line"><span class="lineno">  425</span>  }</div>
<div class="line"><span class="lineno">  426</span>}</div>
<div class="ttc" id="amain__infer_8c_html_a680d5eb9763f52ea89ce1764e01121dc"><div class="ttname"><a href="main__infer_8c.html#a680d5eb9763f52ea89ce1764e01121dc">canon_dir</a></div><div class="ttdeci">static int canon_dir(char *out, size_t outsz, const char *dir)</div><div class="ttdoc">Canonicalize a directory path with realpath when possible.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00332">main_infer.c:332</a></div></div>
<div class="ttc" id="amain__infer_8c_html_a937426768611822fbe840722069c7043"><div class="ttname"><a href="main__infer_8c.html#a937426768611822fbe840722069c7043">is_int4_precision</a></div><div class="ttdeci">static int is_int4_precision(const char *p)</div><div class="ttdoc">Determine if precision string requests int4 family.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00359">main_infer.c:359</a></div></div>
<div class="ttc" id="amain__infer_8c_html_adca9b33a342b8635e28ba51aecb365f6"><div class="ttname"><a href="main__infer_8c.html#adca9b33a342b8635e28ba51aecb365f6">join_path</a></div><div class="ttdeci">static void join_path(char *out, size_t outsz, const char *dir, const char *leaf)</div><div class="ttdoc">Join directory and filename into a single path.</div><div class="ttdef"><b>Definition</b> <a href="main__infer_8c_source.html#l00297">main_infer.c:297</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="main__infer_8c_source.html#l00332">canon_dir()</a>, <a class="el" href="main__infer_8c_source.html#l00359">is_int4_precision()</a>, <a class="el" href="main__infer_8c_source.html#l00297">join_path()</a>, <a class="el" href="main__infer_8c_source.html#l00227">path_exists()</a>, <a class="el" href="main__infer_8c_source.html#l00258">path_is_abs()</a>, <a class="el" href="main__infer_8c_source.html#l00081">PATH_MAX</a>, and <a class="el" href="main__infer_8c_source.html#l00273">safe_strcpy()</a>.</p>

<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l02362">main()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_ad6b894571e18a35f21d8451e008fae37_cgraph.svg" width="498" height="288"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_ad6b894571e18a35f21d8451e008fae37_icgraph.svg" width="275" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a0271a21f39c53534b7a1a3cc7eb94596" name="a0271a21f39c53534b7a1a3cc7eb94596"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0271a21f39c53534b7a1a3cc7eb94596">&#9670;&#160;</a></span>resolve_tokenizer_path()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void resolve_tokenizer_path </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>model_dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>tokenizer_opt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>outsz</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Resolve a tokenizer path under a model directory. </p>
<p>Search order: 1) explicit override (tokenizer_opt) 2) &lt;model_dir&gt;/hf/original/tokenizer.tiktoken 3) &lt;model_dir&gt;/tokenizer.tiktoken 4) &lt;model_dir&gt;/original/tokenizer.tiktoken 5) &lt;model_dir&gt;/hf/original/tokenizer.json 6) &lt;model_dir&gt;/tokenizer.json 7) &lt;model_dir&gt;/original/tokenizer.json</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">model_dir</td><td>Model directory. </td></tr>
    <tr><td class="paramname">tokenizer_opt</td><td>Optional explicit tokenizer path. </td></tr>
    <tr><td class="paramname">out</td><td>Output path. </td></tr>
    <tr><td class="paramname">outsz</td><td>Output capacity.</td></tr>
  </table>
  </dd>
</dl>
<p>resolve_tokenizer_path.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">model_dir</td><td>See implementation for details. </td></tr>
    <tr><td class="paramname">tokenizer_opt</td><td>See implementation for details. </td></tr>
    <tr><td class="paramname">out</td><td>See implementation for details. </td></tr>
    <tr><td class="paramname">outsz</td><td>See implementation for details. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00810">810</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  810</span>                                                                                                              {</div>
<div class="line"><span class="lineno">  811</span>  <span class="keywordflow">if</span> (!out || outsz == 0) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  812</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  813</span> </div>
<div class="line"><span class="lineno">  814</span>  <span class="keywordflow">if</span> (tokenizer_opt &amp;&amp; *tokenizer_opt) {</div>
<div class="line"><span class="lineno">  815</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#a35a9aadd511e6b3688d01a67a12c7651">path_is_abs</a>(tokenizer_opt) || !model_dir || !*model_dir) <a class="code hl_function" href="main__infer_8c.html#a210133797f21fcee710ec892841dce42">safe_strcpy</a>(out, outsz, tokenizer_opt);</div>
<div class="line"><span class="lineno">  816</span>    <span class="keywordflow">else</span> <a class="code hl_function" href="main__infer_8c.html#adca9b33a342b8635e28ba51aecb365f6">join_path</a>(out, outsz, model_dir, tokenizer_opt);</div>
<div class="line"><span class="lineno">  817</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  818</span>  }</div>
<div class="line"><span class="lineno">  819</span> </div>
<div class="line"><span class="lineno">  820</span>  <span class="keywordflow">if</span> (!model_dir || !*model_dir) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  821</span> </div>
<div class="line"><span class="lineno">  822</span>  <span class="keywordtype">char</span> cand[<a class="code hl_define" href="main__infer_8c.html#ae688d728e1acdfe5988c7db45d6f0166">PATH_MAX</a>];</div>
<div class="line"><span class="lineno">  823</span> </div>
<div class="line"><span class="lineno">  824</span>  <a class="code hl_function" href="main__infer_8c.html#adca9b33a342b8635e28ba51aecb365f6">join_path</a>(cand, <span class="keyword">sizeof</span>(cand), model_dir, <span class="stringliteral">&quot;hf/original/tokenizer.tiktoken&quot;</span>);</div>
<div class="line"><span class="lineno">  825</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#a0cbea455e9868581360f43c63db6554c">path_exists</a>(cand)) { <a class="code hl_function" href="main__infer_8c.html#a210133797f21fcee710ec892841dce42">safe_strcpy</a>(out, outsz, cand); <span class="keywordflow">return</span>; }</div>
<div class="line"><span class="lineno">  826</span> </div>
<div class="line"><span class="lineno">  827</span>  <a class="code hl_function" href="main__infer_8c.html#adca9b33a342b8635e28ba51aecb365f6">join_path</a>(cand, <span class="keyword">sizeof</span>(cand), model_dir, <span class="stringliteral">&quot;tokenizer.tiktoken&quot;</span>);</div>
<div class="line"><span class="lineno">  828</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#a0cbea455e9868581360f43c63db6554c">path_exists</a>(cand)) { <a class="code hl_function" href="main__infer_8c.html#a210133797f21fcee710ec892841dce42">safe_strcpy</a>(out, outsz, cand); <span class="keywordflow">return</span>; }</div>
<div class="line"><span class="lineno">  829</span> </div>
<div class="line"><span class="lineno">  830</span>  <a class="code hl_function" href="main__infer_8c.html#adca9b33a342b8635e28ba51aecb365f6">join_path</a>(cand, <span class="keyword">sizeof</span>(cand), model_dir, <span class="stringliteral">&quot;original/tokenizer.tiktoken&quot;</span>);</div>
<div class="line"><span class="lineno">  831</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#a0cbea455e9868581360f43c63db6554c">path_exists</a>(cand)) { <a class="code hl_function" href="main__infer_8c.html#a210133797f21fcee710ec892841dce42">safe_strcpy</a>(out, outsz, cand); <span class="keywordflow">return</span>; }</div>
<div class="line"><span class="lineno">  832</span> </div>
<div class="line"><span class="lineno">  833</span>  <a class="code hl_function" href="main__infer_8c.html#adca9b33a342b8635e28ba51aecb365f6">join_path</a>(cand, <span class="keyword">sizeof</span>(cand), model_dir, <span class="stringliteral">&quot;hf/original/tokenizer.json&quot;</span>);</div>
<div class="line"><span class="lineno">  834</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#a0cbea455e9868581360f43c63db6554c">path_exists</a>(cand)) { <a class="code hl_function" href="main__infer_8c.html#a210133797f21fcee710ec892841dce42">safe_strcpy</a>(out, outsz, cand); <span class="keywordflow">return</span>; }</div>
<div class="line"><span class="lineno">  835</span> </div>
<div class="line"><span class="lineno">  836</span>  <a class="code hl_function" href="main__infer_8c.html#adca9b33a342b8635e28ba51aecb365f6">join_path</a>(cand, <span class="keyword">sizeof</span>(cand), model_dir, <span class="stringliteral">&quot;tokenizer.json&quot;</span>);</div>
<div class="line"><span class="lineno">  837</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#a0cbea455e9868581360f43c63db6554c">path_exists</a>(cand)) { <a class="code hl_function" href="main__infer_8c.html#a210133797f21fcee710ec892841dce42">safe_strcpy</a>(out, outsz, cand); <span class="keywordflow">return</span>; }</div>
<div class="line"><span class="lineno">  838</span> </div>
<div class="line"><span class="lineno">  839</span>  <a class="code hl_function" href="main__infer_8c.html#adca9b33a342b8635e28ba51aecb365f6">join_path</a>(cand, <span class="keyword">sizeof</span>(cand), model_dir, <span class="stringliteral">&quot;original/tokenizer.json&quot;</span>);</div>
<div class="line"><span class="lineno">  840</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="main__infer_8c.html#a0cbea455e9868581360f43c63db6554c">path_exists</a>(cand)) { <a class="code hl_function" href="main__infer_8c.html#a210133797f21fcee710ec892841dce42">safe_strcpy</a>(out, outsz, cand); <span class="keywordflow">return</span>; }</div>
<div class="line"><span class="lineno">  841</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="main__infer_8c_source.html#l00297">join_path()</a>, <a class="el" href="main__infer_8c_source.html#l00227">path_exists()</a>, <a class="el" href="main__infer_8c_source.html#l00258">path_is_abs()</a>, <a class="el" href="main__infer_8c_source.html#l00081">PATH_MAX</a>, and <a class="el" href="main__infer_8c_source.html#l00273">safe_strcpy()</a>.</p>

<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l02362">main()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a0271a21f39c53534b7a1a3cc7eb94596_cgraph.svg" width="476" height="162"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a0271a21f39c53534b7a1a3cc7eb94596_icgraph.svg" width="287" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a0d90177eef91d08c3d9a38fb00df3e62" name="a0d90177eef91d08c3d9a38fb00df3e62"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0d90177eef91d08c3d9a38fb00df3e62">&#9670;&#160;</a></span>rss_peak_mib()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint32_t rss_peak_mib </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Read ru_maxrss and convert to MiB (Linux: ru_maxrss is KiB). </p>
<dl class="section return"><dt>Returns</dt><dd>RSS peak in MiB (rounded down), or 0 on failure.</dd></dl>
<p>rss_peak_mib.</p>
<dl class="section return"><dt>Returns</dt><dd>See implementation for details. </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00437">437</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  437</span>                                   {</div>
<div class="line"><span class="lineno">  438</span>  <span class="keyword">struct </span>rusage ru;</div>
<div class="line"><span class="lineno">  439</span>  <span class="keywordflow">if</span> (getrusage(RUSAGE_SELF, &amp;ru) != 0) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  440</span>  <span class="keywordflow">if</span> (ru.ru_maxrss &lt;= 0) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  441</span>  <span class="keywordflow">return</span> (uint32_t)((uint64_t)ru.ru_maxrss / 1024ULL);</div>
<div class="line"><span class="lineno">  442</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l02362">main()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a0d90177eef91d08c3d9a38fb00df3e62_icgraph.svg" width="226" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a040e339c57d801547a44a21545914526" name="a040e339c57d801547a44a21545914526"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a040e339c57d801547a44a21545914526">&#9670;&#160;</a></span>safe_atof()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static double safe_atof </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>s</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Parse a double safely (fatal on invalid input). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>Input string. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Parsed value.</dd></dl>
<p>safe_atof.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>See implementation for details.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>See implementation for details. </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l01204">1204</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1204</span>                                       {</div>
<div class="line"><span class="lineno"> 1205</span>  <span class="keywordflow">if</span> (!s || !*s) {</div>
<div class="line"><span class="lineno"> 1206</span>    fprintf(stderr, <span class="stringliteral">&quot;error: empty float\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1207</span>    exit(2);</div>
<div class="line"><span class="lineno"> 1208</span>  }</div>
<div class="line"><span class="lineno"> 1209</span>  <span class="keywordtype">char</span> *end = NULL;</div>
<div class="line"><span class="lineno"> 1210</span>  <span class="keywordtype">double</span> v = strtod(s, &amp;end);</div>
<div class="line"><span class="lineno"> 1211</span>  <span class="keywordflow">if</span> (end == s || *end) {</div>
<div class="line"><span class="lineno"> 1212</span>    fprintf(stderr, <span class="stringliteral">&quot;error: invalid float: &#39;%s&#39;\n&quot;</span>, s);</div>
<div class="line"><span class="lineno"> 1213</span>    exit(2);</div>
<div class="line"><span class="lineno"> 1214</span>  }</div>
<div class="line"><span class="lineno"> 1215</span>  <span class="keywordflow">return</span> v;</div>
<div class="line"><span class="lineno"> 1216</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l01308">parse_flags()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a040e339c57d801547a44a21545914526_icgraph.svg" width="340" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a42cabe54dce1190125a12e4c0360ce22" name="a42cabe54dce1190125a12e4c0360ce22"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a42cabe54dce1190125a12e4c0360ce22">&#9670;&#160;</a></span>safe_atoi()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static long safe_atoi </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>s</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Parse a decimal integer safely (fatal on invalid input). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>Input string. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Parsed value.</dd></dl>
<p>safe_atoi.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>See implementation for details.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>See implementation for details. </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l01152">1152</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1152</span>                                     {</div>
<div class="line"><span class="lineno"> 1153</span>  <span class="keywordflow">if</span> (!s || !*s) {</div>
<div class="line"><span class="lineno"> 1154</span>    fprintf(stderr, <span class="stringliteral">&quot;error: empty integer\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1155</span>    exit(2);</div>
<div class="line"><span class="lineno"> 1156</span>  }</div>
<div class="line"><span class="lineno"> 1157</span>  <span class="keywordtype">char</span> *end = NULL;</div>
<div class="line"><span class="lineno"> 1158</span>  <span class="keywordtype">long</span> v = strtol(s, &amp;end, 10);</div>
<div class="line"><span class="lineno"> 1159</span>  <span class="keywordflow">if</span> (end == s || *end) {</div>
<div class="line"><span class="lineno"> 1160</span>    fprintf(stderr, <span class="stringliteral">&quot;error: invalid integer: &#39;%s&#39;\n&quot;</span>, s);</div>
<div class="line"><span class="lineno"> 1161</span>    exit(2);</div>
<div class="line"><span class="lineno"> 1162</span>  }</div>
<div class="line"><span class="lineno"> 1163</span>  <span class="keywordflow">return</span> v;</div>
<div class="line"><span class="lineno"> 1164</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l01308">parse_flags()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a42cabe54dce1190125a12e4c0360ce22_icgraph.svg" width="340" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a50f7fd00c4c5f36d1ee065443d688251" name="a50f7fd00c4c5f36d1ee065443d688251"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a50f7fd00c4c5f36d1ee065443d688251">&#9670;&#160;</a></span>safe_atoull()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint64_t safe_atoull </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>s</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Parse an unsigned 64-bit integer safely (fatal on invalid input). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>Input string. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Parsed value.</dd></dl>
<p>safe_atoull.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>See implementation for details.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>See implementation for details. </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l01178">1178</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1178</span>                                           {</div>
<div class="line"><span class="lineno"> 1179</span>  <span class="keywordflow">if</span> (!s || !*s) {</div>
<div class="line"><span class="lineno"> 1180</span>    fprintf(stderr, <span class="stringliteral">&quot;error: empty integer\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1181</span>    exit(2);</div>
<div class="line"><span class="lineno"> 1182</span>  }</div>
<div class="line"><span class="lineno"> 1183</span>  <span class="keywordtype">char</span> *end = NULL;</div>
<div class="line"><span class="lineno"> 1184</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> v = strtoull(s, &amp;end, 10);</div>
<div class="line"><span class="lineno"> 1185</span>  <span class="keywordflow">if</span> (end == s || *end) {</div>
<div class="line"><span class="lineno"> 1186</span>    fprintf(stderr, <span class="stringliteral">&quot;error: invalid integer: &#39;%s&#39;\n&quot;</span>, s);</div>
<div class="line"><span class="lineno"> 1187</span>    exit(2);</div>
<div class="line"><span class="lineno"> 1188</span>  }</div>
<div class="line"><span class="lineno"> 1189</span>  <span class="keywordflow">return</span> (uint64_t)v;</div>
<div class="line"><span class="lineno"> 1190</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l01308">parse_flags()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a50f7fd00c4c5f36d1ee065443d688251_icgraph.svg" width="352" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a210133797f21fcee710ec892841dce42" name="a210133797f21fcee710ec892841dce42"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a210133797f21fcee710ec892841dce42">&#9670;&#160;</a></span>safe_strcpy()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void safe_strcpy </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>dstsz</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>src</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Safe string copy using snprintf. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dst</td><td>Destination buffer. </td></tr>
    <tr><td class="paramname">dstsz</td><td>Destination capacity. </td></tr>
    <tr><td class="paramname">src</td><td>Source string (may be NULL).</td></tr>
  </table>
  </dd>
</dl>
<p>safe_strcpy.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dst</td><td>See implementation for details. </td></tr>
    <tr><td class="paramname">dstsz</td><td>See implementation for details. </td></tr>
    <tr><td class="paramname">src</td><td>See implementation for details. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00273">273</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  273</span>                                                                  {</div>
<div class="line"><span class="lineno">  274</span>  <span class="keywordflow">if</span> (!dst || dstsz == 0) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  275</span>  <span class="keywordflow">if</span> (!src) {</div>
<div class="line"><span class="lineno">  276</span>    <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a415d14a7ade776b6bb2e544f0be25e6b">dst</a>[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  277</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  278</span>  }</div>
<div class="line"><span class="lineno">  279</span>  (void)snprintf(dst, dstsz, <span class="stringliteral">&quot;%s&quot;</span>, src);</div>
<div class="line"><span class="lineno">  280</span>}</div>
<div class="ttc" id="anamespaceconvert__dtypes__to__numeric_html_a415d14a7ade776b6bb2e544f0be25e6b"><div class="ttname"><a href="namespaceconvert__dtypes__to__numeric.html#a415d14a7ade776b6bb2e544f0be25e6b">convert_dtypes_to_numeric.dst</a></div><div class="ttdeci">dst</div><div class="ttdef"><b>Definition</b> <a href="convert__dtypes__to__numeric_8py_source.html#l00027">convert_dtypes_to_numeric.py:27</a></div></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l00332">canon_dir()</a>, <a class="el" href="main__infer_8c_source.html#l00297">join_path()</a>, <a class="el" href="main__infer_8c_source.html#l00378">resolve_model_paths()</a>, and <a class="el" href="main__infer_8c_source.html#l00810">resolve_tokenizer_path()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a210133797f21fcee710ec892841dce42_icgraph.svg" width="566" height="158"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a55469391e7680b876a48cdc0d3d24632" name="a55469391e7680b876a48cdc0d3d24632"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a55469391e7680b876a48cdc0d3d24632">&#9670;&#160;</a></span>starts_with()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int starts_with </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>prefix</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check whether a string begins with a given prefix (case-sensitive). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>Input string. </td></tr>
    <tr><td class="paramname">prefix</td><td>Prefix string. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 when s starts with prefix, 0 otherwise.</dd></dl>
<p>starts_with.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>See implementation for details. </td></tr>
    <tr><td class="paramname">prefix</td><td>See implementation for details.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>See implementation for details. </dd></dl>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l00192">192</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  192</span>                                                          {</div>
<div class="line"><span class="lineno">  193</span>  <span class="keywordflow">if</span> (!s || !prefix) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  194</span>  <span class="keywordflow">while</span> (*prefix) {</div>
<div class="line"><span class="lineno">  195</span>    <span class="keywordflow">if</span> (*s++ != *prefix++) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  196</span>  }</div>
<div class="line"><span class="lineno">  197</span>  <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  198</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l00359">is_int4_precision()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_a55469391e7680b876a48cdc0d3d24632_icgraph.svg" width="596" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ad96d407a911fbb914fa8e4cfbf2faf0f" name="ad96d407a911fbb914fa8e4cfbf2faf0f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad96d407a911fbb914fa8e4cfbf2faf0f">&#9670;&#160;</a></span>usage()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void usage </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Print CLI usage to stderr. </p>
<p>usage. </p>

<p class="definition">Definition at line <a class="el" href="main__infer_8c_source.html#l01050">1050</a> of file <a class="el" href="main__infer_8c_source.html">main_infer.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1050</span>                        {</div>
<div class="line"><span class="lineno"> 1051</span>  fprintf(stderr,</div>
<div class="line"><span class="lineno"> 1052</span>          <span class="stringliteral">&quot;Usage: inference-engine [--prompt TEXT] [--max-new N]\n&quot;</span></div>
<div class="line"><span class="lineno"> 1053</span>          <span class="stringliteral">&quot;                        [--threads N]\n&quot;</span></div>
<div class="line"><span class="lineno"> 1054</span>          <span class="stringliteral">&quot;                        [--precision fp32|bf16|fp16|int8w|int4|int4w]\n&quot;</span></div>
<div class="line"><span class="lineno"> 1055</span>          <span class="stringliteral">&quot;                        [--sparsity none|block|auto]\n&quot;</span></div>
<div class="line"><span class="lineno"> 1056</span>          <span class="stringliteral">&quot;                        [--affinity auto|compact|scatter]\n&quot;</span></div>
<div class="line"><span class="lineno"> 1057</span>          <span class="stringliteral">&quot;                        [--pretranspose none|woh|wxh|all]\n&quot;</span></div>
<div class="line"><span class="lineno"> 1058</span>          <span class="stringliteral">&quot;                        [--device auto|cpu|cuda|ze]\n&quot;</span></div>
<div class="line"><span class="lineno"> 1059</span>          <span class="stringliteral">&quot;                        [--model-dir PATH]\n&quot;</span></div>
<div class="line"><span class="lineno"> 1060</span>          <span class="stringliteral">&quot;                        [--model-json PATH] [--model-bin PATH]\n&quot;</span></div>
<div class="line"><span class="lineno"> 1061</span>          <span class="stringliteral">&quot;                        [--prompts-file PATH] [--batch N]\n&quot;</span></div>
<div class="line"><span class="lineno"> 1062</span>          <span class="stringliteral">&quot;                        [--prefetch on|off|auto|N] [--warmup N]\n&quot;</span></div>
<div class="line"><span class="lineno"> 1063</span>          <span class="stringliteral">&quot;                        [--rounds N] [--aggregate]\n&quot;</span></div>
<div class="line"><span class="lineno"> 1064</span>          <span class="stringliteral">&quot;                        [--print-text] [--tokenizer PATH]\n&quot;</span></div>
<div class="line"><span class="lineno"> 1065</span>          <span class="stringliteral">&quot;                        [--trace-ids PATH]\n&quot;</span></div>
<div class="line"><span class="lineno"> 1066</span>          <span class="stringliteral">&quot;                        [--seed N] [--greedy]\n&quot;</span></div>
<div class="line"><span class="lineno"> 1067</span>          <span class="stringliteral">&quot;                        [--temperature F] [--top-p F] [--top-k N]\n&quot;</span></div>
<div class="line"><span class="lineno"> 1068</span>          <span class="stringliteral">&quot;                        [--log-tokens] [--log-every N]\n&quot;</span></div>
<div class="line"><span class="lineno"> 1069</span>          <span class="stringliteral">&quot;                        [--debug-decode] [--debug-decode-every N]\n&quot;</span></div>
<div class="line"><span class="lineno"> 1070</span>          <span class="stringliteral">&quot;                        [--debug-topk K] [--debug-topk-every N]\n&quot;</span>);</div>
<div class="line"><span class="lineno"> 1071</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="main__chat_8c_source.html#l00185">main()</a>, and <a class="el" href="main__infer_8c_source.html#l01308">parse_flags()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="main__infer_8c_ad96d407a911fbb914fa8e4cfbf2faf0f_icgraph.svg" width="319" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_996f45160da62e1a3d7f6046fad68f51.html">engine</a></li><li class="navelem"><a class="el" href="dir_3d9126aa00c041bc0b8f859d1965a0f4.html">src</a></li><li class="navelem"><a class="el" href="main__infer_8c.html">main_infer.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
