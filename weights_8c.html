<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Inference Engine (Clocher): engine/src/io/weights.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Inference Engine (Clocher)<span id="projectnumber">&#160;0.2</span>
   </div>
   <div id="projectbrief">C11 CPU/GPU inference baseline with strict metrics &amp; harness</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('weights_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">weights.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>IEBIN v1 loader with relaxed JSON scanning and detailed diagnostics.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="ie__io_8h_source.html">ie_io.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="util__logging_8h_source.html">util_logging.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="weights__dedup_8h_source.html">weights_dedup.h</a>&quot;</code><br />
<code>#include &lt;ctype.h&gt;</code><br />
<code>#include &lt;errno.h&gt;</code><br />
<code>#include &lt;fcntl.h&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;strings.h&gt;</code><br />
<code>#include &lt;sys/stat.h&gt;</code><br />
<code>#include &lt;sys/types.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for weights.c:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="weights_8c__incl.svg" width="100%" height="492"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
</div>
<p><a href="weights_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a3024ccd4a9af5109d24e6c57565d74a1" id="r_a3024ccd4a9af5109d24e6c57565d74a1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="weights_8c.html#a3024ccd4a9af5109d24e6c57565d74a1">_POSIX_C_SOURCE</a>&#160;&#160;&#160;200809L</td></tr>
<tr class="separator:a3024ccd4a9af5109d24e6c57565d74a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a09848cf2dc0076d1bdd76ec962abeeae" id="r_a09848cf2dc0076d1bdd76ec962abeeae"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="weights_8c.html#a09848cf2dc0076d1bdd76ec962abeeae">IE_WEIGHTS_HAS_DEDUP_FIELDS</a>&#160;&#160;&#160;1</td></tr>
<tr class="separator:a09848cf2dc0076d1bdd76ec962abeeae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acd6293e04b2d41cf4d6080403b25b1bb" id="r_acd6293e04b2d41cf4d6080403b25b1bb"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="weights_8c.html#acd6293e04b2d41cf4d6080403b25b1bb">IE_WEIGHTS_ENABLE_INT4_DIAGNOSTICS</a>&#160;&#160;&#160;0</td></tr>
<tr class="separator:acd6293e04b2d41cf4d6080403b25b1bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a752563692fdfae65274bd2bf13be1661" id="r_a752563692fdfae65274bd2bf13be1661"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="weights_8c.html#a752563692fdfae65274bd2bf13be1661">WLOGI</a>(...)</td></tr>
<tr class="memdesc:a752563692fdfae65274bd2bf13be1661"><td class="mdescLeft">&#160;</td><td class="mdescRight">Emit an info log if info logging is enabled.  <br /></td></tr>
<tr class="separator:a752563692fdfae65274bd2bf13be1661"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2243a7a621a65f66170ede427763ee2d" id="r_a2243a7a621a65f66170ede427763ee2d"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="weights_8c.html#a2243a7a621a65f66170ede427763ee2d">WLOGD</a>(...)</td></tr>
<tr class="memdesc:a2243a7a621a65f66170ede427763ee2d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Emit a debug log if debug logging is enabled.  <br /></td></tr>
<tr class="separator:a2243a7a621a65f66170ede427763ee2d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a92c7e58c96077a0c401dbfd6c4196f1a" id="r_a92c7e58c96077a0c401dbfd6c4196f1a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="weights_8c.html#a92c7e58c96077a0c401dbfd6c4196f1a">WLOGW</a>(...)</td></tr>
<tr class="memdesc:a92c7e58c96077a0c401dbfd6c4196f1a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Emit a warning log if info logging is enabled.  <br /></td></tr>
<tr class="separator:a92c7e58c96077a0c401dbfd6c4196f1a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af8239319fc44fa28e836591e9ac89c02" id="r_af8239319fc44fa28e836591e9ac89c02"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="weights_8c.html#af8239319fc44fa28e836591e9ac89c02">WLOGE</a>(...)</td></tr>
<tr class="memdesc:af8239319fc44fa28e836591e9ac89c02"><td class="mdescLeft">&#160;</td><td class="mdescRight">Emit an error log if error logging is enabled.  <br /></td></tr>
<tr class="separator:af8239319fc44fa28e836591e9ac89c02"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a42060a9aacf63543286684615cfc36fe" id="r_a42060a9aacf63543286684615cfc36fe"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="weights_8c.html#a42060a9aacf63543286684615cfc36fe">ie_weights_log_level</a> (void)</td></tr>
<tr class="memdesc:a42060a9aacf63543286684615cfc36fe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read IE_LOG_LEVEL once and cache it for the process lifetime.  <br /></td></tr>
<tr class="separator:a42060a9aacf63543286684615cfc36fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a684245f67e867bda9a255505a8e5f68b" id="r_a684245f67e867bda9a255505a8e5f68b"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="weights_8c.html#a684245f67e867bda9a255505a8e5f68b">ie_weights_log_enabled</a> (int level)</td></tr>
<tr class="memdesc:a684245f67e867bda9a255505a8e5f68b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return non-zero if the requested logging level is enabled.  <br /></td></tr>
<tr class="separator:a684245f67e867bda9a255505a8e5f68b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a88ec341995312abc5fbbd4084389523e" id="r_a88ec341995312abc5fbbd4084389523e"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="weights_8c.html#a88ec341995312abc5fbbd4084389523e">wlog_errno_</a> (const char *what, const char *path)</td></tr>
<tr class="memdesc:a88ec341995312abc5fbbd4084389523e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Log an errno-based failure with contextual path information.  <br /></td></tr>
<tr class="separator:a88ec341995312abc5fbbd4084389523e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae19e0ad12742fe7fdff22f60436aadc7" id="r_ae19e0ad12742fe7fdff22f60436aadc7"><td class="memItemLeft" align="right" valign="top">static const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="weights_8c.html#ae19e0ad12742fe7fdff22f60436aadc7">skip_ws</a> (const char *p)</td></tr>
<tr class="memdesc:ae19e0ad12742fe7fdff22f60436aadc7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Skip ASCII whitespace characters in a string.  <br /></td></tr>
<tr class="separator:ae19e0ad12742fe7fdff22f60436aadc7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae3307b59271742c37862abf0b9698d23" id="r_ae3307b59271742c37862abf0b9698d23"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="weights_8c.html#ae3307b59271742c37862abf0b9698d23">cpyz</a> (char *dst, size_t dstsz, const char *src)</td></tr>
<tr class="memdesc:ae3307b59271742c37862abf0b9698d23"><td class="mdescLeft">&#160;</td><td class="mdescRight">Copy a C-string into a bounded buffer and always NUL-terminate.  <br /></td></tr>
<tr class="separator:ae3307b59271742c37862abf0b9698d23"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7415d89bc8bd657819e06ac0fc53da95" id="r_a7415d89bc8bd657819e06ac0fc53da95"><td class="memItemLeft" align="right" valign="top">static const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="weights_8c.html#a7415d89bc8bd657819e06ac0fc53da95">last_slash</a> (const char *p)</td></tr>
<tr class="memdesc:a7415d89bc8bd657819e06ac0fc53da95"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return a pointer to the last '/' in a path, or NULL if none.  <br /></td></tr>
<tr class="separator:a7415d89bc8bd657819e06ac0fc53da95"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7bb1dd9958b072fc5d1a80373cc074ff" id="r_a7bb1dd9958b072fc5d1a80373cc074ff"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="weights_8c.html#a7bb1dd9958b072fc5d1a80373cc074ff">join_path</a> (char *out, size_t outsz, const char *dir, const char *file)</td></tr>
<tr class="memdesc:a7bb1dd9958b072fc5d1a80373cc074ff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Join directory and filename into an output buffer (NUL-terminated).  <br /></td></tr>
<tr class="separator:a7bb1dd9958b072fc5d1a80373cc074ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7d467c1ab0baceed9b0fdad7b5a8accf" id="r_a7d467c1ab0baceed9b0fdad7b5a8accf"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="weights_8c.html#a7d467c1ab0baceed9b0fdad7b5a8accf">read_all_text</a> (const char *path, char **buf, size_t *len_out)</td></tr>
<tr class="memdesc:a7d467c1ab0baceed9b0fdad7b5a8accf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read an entire file into a newly allocated NUL-terminated buffer.  <br /></td></tr>
<tr class="separator:a7d467c1ab0baceed9b0fdad7b5a8accf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5c6ba72035c0c5110c91879350c8647f" id="r_a5c6ba72035c0c5110c91879350c8647f"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="weights_8c.html#a5c6ba72035c0c5110c91879350c8647f">scan_json_key_int</a> (const char *json, const char *key, int *out_val)</td></tr>
<tr class="memdesc:a5c6ba72035c0c5110c91879350c8647f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Scan a relaxed JSON blob for an integer value at a given key.  <br /></td></tr>
<tr class="separator:a5c6ba72035c0c5110c91879350c8647f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a173309f164a3d6851b64ca6a5ad733c9" id="r_a173309f164a3d6851b64ca6a5ad733c9"><td class="memItemLeft" align="right" valign="top">static size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="weights_8c.html#a173309f164a3d6851b64ca6a5ad733c9">json_unescape_into</a> (char *dst, size_t dstsz, const char *src, size_t srclen)</td></tr>
<tr class="memdesc:a173309f164a3d6851b64ca6a5ad733c9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unescape a JSON string into a destination buffer (best-effort).  <br /></td></tr>
<tr class="separator:a173309f164a3d6851b64ca6a5ad733c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c438658d11f74ba4af8273c7e390311" id="r_a3c438658d11f74ba4af8273c7e390311"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="weights_8c.html#a3c438658d11f74ba4af8273c7e390311">scan_json_key_string</a> (const char *json, const char *key, char *dst, size_t dstsz)</td></tr>
<tr class="memdesc:a3c438658d11f74ba4af8273c7e390311"><td class="mdescLeft">&#160;</td><td class="mdescRight">Scan a relaxed JSON blob for a string value at a given key.  <br /></td></tr>
<tr class="separator:a3c438658d11f74ba4af8273c7e390311"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a853d256b28c7e6c404c035fc1a16a454" id="r_a853d256b28c7e6c404c035fc1a16a454"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="weights_8c.html#a853d256b28c7e6c404c035fc1a16a454">scan_json_object_range</a> (const char *json, const char *key, const char **out_begin, const char **out_end)</td></tr>
<tr class="memdesc:a853d256b28c7e6c404c035fc1a16a454"><td class="mdescLeft">&#160;</td><td class="mdescRight">Locate the interior byte range of an object value "{ ... }" for a key.  <br /></td></tr>
<tr class="separator:a853d256b28c7e6c404c035fc1a16a454"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a110cc679cd45b43c11f22ba749bd0ea3" id="r_a110cc679cd45b43c11f22ba749bd0ea3"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="weights_8c.html#a110cc679cd45b43c11f22ba749bd0ea3">scan_json_key_string_in_range</a> (const char *begin, const char *end, const char *key, char *dst, size_t dstsz)</td></tr>
<tr class="memdesc:a110cc679cd45b43c11f22ba749bd0ea3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Scan for a string key within a bounded [begin,end] range.  <br /></td></tr>
<tr class="separator:a110cc679cd45b43c11f22ba749bd0ea3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c6343a4152588f4f490f3263842c7f6" id="r_a3c6343a4152588f4f490f3263842c7f6"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="weights_8c.html#a3c6343a4152588f4f490f3263842c7f6">scan_json_best_effort_bin</a> (const char *json, char *dst, size_t dstsz)</td></tr>
<tr class="memdesc:a3c6343a4152588f4f490f3263842c7f6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Try multiple schema variants to locate the weights binary path.  <br /></td></tr>
<tr class="separator:a3c6343a4152588f4f490f3263842c7f6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aabb19f4a5e5385962c6db57f611bb785" id="r_aabb19f4a5e5385962c6db57f611bb785"><td class="memItemLeft" align="right" valign="top">static ssize_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="weights_8c.html#aabb19f4a5e5385962c6db57f611bb785">ie_pread</a> (int fd, void *buf, size_t count, off_t offset)</td></tr>
<tr class="memdesc:aabb19f4a5e5385962c6db57f611bb785"><td class="mdescLeft">&#160;</td><td class="mdescRight">Portable pread wrapper with fallback.  <br /></td></tr>
<tr class="separator:aabb19f4a5e5385962c6db57f611bb785"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a72ab94aafe7740f1343d317daa89ca15" id="r_a72ab94aafe7740f1343d317daa89ca15"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="weights_8c.html#a72ab94aafe7740f1343d317daa89ca15">ascii_ieq</a> (const char *a, const char *b)</td></tr>
<tr class="memdesc:a72ab94aafe7740f1343d317daa89ca15"><td class="mdescLeft">&#160;</td><td class="mdescRight">ASCII-only case-insensitive equality.  <br /></td></tr>
<tr class="separator:a72ab94aafe7740f1343d317daa89ca15"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a93c92a71a0cf18f3eea8623ea9524d54" id="r_a93c92a71a0cf18f3eea8623ea9524d54"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="weights_8c.html#a93c92a71a0cf18f3eea8623ea9524d54">env_flag_get</a> (const char *name, int default_value)</td></tr>
<tr class="memdesc:a93c92a71a0cf18f3eea8623ea9524d54"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parse environment flag-like strings into a boolean.  <br /></td></tr>
<tr class="separator:a93c92a71a0cf18f3eea8623ea9524d54"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8adb51cd6c239a9589d4d66cd0cf989e" id="r_a8adb51cd6c239a9589d4d66cd0cf989e"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="weights_8c.html#a8adb51cd6c239a9589d4d66cd0cf989e">file_exists_readable</a> (const char *path)</td></tr>
<tr class="memdesc:a8adb51cd6c239a9589d4d66cd0cf989e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if a path exists and is readable.  <br /></td></tr>
<tr class="separator:a8adb51cd6c239a9589d4d66cd0cf989e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a58a74ad7b283929166fa3d00c2c59b60" id="r_a58a74ad7b283929166fa3d00c2c59b60"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="weights_8c.html#a58a74ad7b283929166fa3d00c2c59b60">write_all_bytes_</a> (const char *path, const void *data, size_t len)</td></tr>
<tr class="memdesc:a58a74ad7b283929166fa3d00c2c59b60"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a best-effort model.dedup.json manifest for runtime dedup.  <br /></td></tr>
<tr class="separator:a58a74ad7b283929166fa3d00c2c59b60"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a807c24ebcc098467a915557609f9a10e" id="r_a807c24ebcc098467a915557609f9a10e"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="weights_8c.html#a807c24ebcc098467a915557609f9a10e">find_dedup_manifest_source_</a> (const char *dir, char *out_rel, size_t out_rel_n, char *out_abs, size_t out_abs_n)</td></tr>
<tr class="separator:a807c24ebcc098467a915557609f9a10e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5b123cfce35efe0ac7475c10419f9373" id="r_a5b123cfce35efe0ac7475c10419f9373"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="weights_8c.html#a5b123cfce35efe0ac7475c10419f9373">ensure_dedup_manifest_link</a> (const char *dir)</td></tr>
<tr class="separator:a5b123cfce35efe0ac7475c10419f9373"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae3235e5160399c1e4465d1abf866571d" id="r_ae3235e5160399c1e4465d1abf866571d"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="weights_8c.html#ae3235e5160399c1e4465d1abf866571d">touch_file_small</a> (const char *path)</td></tr>
<tr class="memdesc:ae3235e5160399c1e4465d1abf866571d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Touch a file by doing small reads near start/end.  <br /></td></tr>
<tr class="separator:ae3235e5160399c1e4465d1abf866571d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a522dac028ee37aae1307ffdb6d65ec1d" id="r_a522dac028ee37aae1307ffdb6d65ec1d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="weights_8c.html#a522dac028ee37aae1307ffdb6d65ec1d">ie_weights_open</a> (const char *json_path, const char *bin_path, <a class="el" href="ie__io_8h.html#af68ad3cdc2eb244fe4feed94372d7806">ie_weights_t</a> *out)</td></tr>
<tr class="memdesc:a522dac028ee37aae1307ffdb6d65ec1d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Open and parse an IEBIN v1 model description.  <br /></td></tr>
<tr class="separator:a522dac028ee37aae1307ffdb6d65ec1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a095d7f59c4cba2b530bac039bca8b7a9" id="r_a095d7f59c4cba2b530bac039bca8b7a9"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="weights_8c.html#a095d7f59c4cba2b530bac039bca8b7a9">ie_weights_touch</a> (const <a class="el" href="ie__io_8h.html#af68ad3cdc2eb244fe4feed94372d7806">ie_weights_t</a> *w)</td></tr>
<tr class="memdesc:a095d7f59c4cba2b530bac039bca8b7a9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Touch the weights binary to verify readability and warm OS caches.  <br /></td></tr>
<tr class="separator:a095d7f59c4cba2b530bac039bca8b7a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a06c2b7e35d1f82a11e4605e23a1976f5" id="r_a06c2b7e35d1f82a11e4605e23a1976f5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="weights_8c.html#a06c2b7e35d1f82a11e4605e23a1976f5">ie_weights_close</a> (<a class="el" href="ie__io_8h.html#af68ad3cdc2eb244fe4feed94372d7806">ie_weights_t</a> *w)</td></tr>
<tr class="memdesc:a06c2b7e35d1f82a11e4605e23a1976f5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Close an opened weights descriptor and release optional dedup handles.  <br /></td></tr>
<tr class="separator:a06c2b7e35d1f82a11e4605e23a1976f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>IEBIN v1 loader with relaxed JSON scanning and detailed diagnostics. </p>
<p>This module implements a minimal dependency, plain-C loader for the IEBIN v1 artifact pair:</p>
<ul>
<li>model.ie.json (metadata and tensor descriptors)</li>
<li>model.ie.bin (raw tensor bytes, typically mmap'd by higher layers)</li>
</ul>
<p>The loader is intentionally tolerant to extra fields and formatting changes in the JSON file. It does not use a third-party JSON parser. Instead, it performs targeted scans for a small set of required keys.</p>
<h2><a class="anchor" id="autotoc_md80"></a>
Logging</h2>
<p>All logs in this module go to stderr via util_logging and will not interfere with stdout JSON outputs from benchmarks or CLI tools.</p>
<p>Logging verbosity is controlled via environment variable IE_LOG_LEVEL:</p><ul>
<li>0: silent</li>
<li>1: errors only</li>
<li>2: errors + warnings + info (default)</li>
<li>3: errors + warnings + info + debug</li>
</ul>
<p>The log messages are designed to make failures actionable by printing:</p><ul>
<li>Which file path was attempted (json/bin/dedup artifacts)</li>
<li>Which schema keys were found or missing</li>
<li>File sizes and short-read conditions</li>
<li>Dedup enable/strict flags and decision outcomes </li>
</ul>

<p class="definition">Definition in file <a class="el" href="weights_8c_source.html">weights.c</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a3024ccd4a9af5109d24e6c57565d74a1" name="a3024ccd4a9af5109d24e6c57565d74a1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3024ccd4a9af5109d24e6c57565d74a1">&#9670;&#160;</a></span>_POSIX_C_SOURCE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _POSIX_C_SOURCE&#160;&#160;&#160;200809L</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="weights_8c_source.html#l00038">38</a> of file <a class="el" href="weights_8c_source.html">weights.c</a>.</p>

</div>
</div>
<a id="acd6293e04b2d41cf4d6080403b25b1bb" name="acd6293e04b2d41cf4d6080403b25b1bb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acd6293e04b2d41cf4d6080403b25b1bb">&#9670;&#160;</a></span>IE_WEIGHTS_ENABLE_INT4_DIAGNOSTICS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IE_WEIGHTS_ENABLE_INT4_DIAGNOSTICS&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="weights_8c_source.html#l00073">73</a> of file <a class="el" href="weights_8c_source.html">weights.c</a>.</p>

</div>
</div>
<a id="a09848cf2dc0076d1bdd76ec962abeeae" name="a09848cf2dc0076d1bdd76ec962abeeae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a09848cf2dc0076d1bdd76ec962abeeae">&#9670;&#160;</a></span>IE_WEIGHTS_HAS_DEDUP_FIELDS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IE_WEIGHTS_HAS_DEDUP_FIELDS&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="weights_8c_source.html#l00059">59</a> of file <a class="el" href="weights_8c_source.html">weights.c</a>.</p>

</div>
</div>
<a id="a2243a7a621a65f66170ede427763ee2d" name="a2243a7a621a65f66170ede427763ee2d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2243a7a621a65f66170ede427763ee2d">&#9670;&#160;</a></span>WLOGD</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define WLOGD</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">  <span class="keywordflow">do</span> {                             \</div>
<div class="line">    if (<a class="code hl_function" href="weights_8c.html#a684245f67e867bda9a255505a8e5f68b">ie_weights_log_enabled</a>(3)) \</div>
<div class="line">      ie_log_info(__VA_ARGS__);    \</div>
<div class="line">  } <span class="keywordflow">while</span> (0)</div>
<div class="ttc" id="aweights_8c_html_a684245f67e867bda9a255505a8e5f68b"><div class="ttname"><a href="weights_8c.html#a684245f67e867bda9a255505a8e5f68b">ie_weights_log_enabled</a></div><div class="ttdeci">static int ie_weights_log_enabled(int level)</div><div class="ttdoc">Return non-zero if the requested logging level is enabled.</div><div class="ttdef"><b>Definition</b> <a href="weights_8c_source.html#l00137">weights.c:137</a></div></div>
</div><!-- fragment -->
<p>Emit a debug log if debug logging is enabled. </p>

<p class="definition">Definition at line <a class="el" href="weights_8c_source.html#l00149">149</a> of file <a class="el" href="weights_8c_source.html">weights.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  150</span>     {                             \</div>
<div class="line"><span class="lineno">  151</span>    if (<a class="code hl_function" href="weights_8c.html#a684245f67e867bda9a255505a8e5f68b">ie_weights_log_enabled</a>(3)) \</div>
<div class="line"><span class="lineno">  152</span>      ie_log_info(__VA_ARGS__);    \</div>
<div class="line"><span class="lineno">  153</span>  } <span class="keywordflow">while</span> (0)</div>
</div><!-- fragment -->
</div>
</div>
<a id="af8239319fc44fa28e836591e9ac89c02" name="af8239319fc44fa28e836591e9ac89c02"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af8239319fc44fa28e836591e9ac89c02">&#9670;&#160;</a></span>WLOGE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define WLOGE</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">  <span class="keywordflow">do</span> {                             \</div>
<div class="line">    if (<a class="code hl_function" href="weights_8c.html#a684245f67e867bda9a255505a8e5f68b">ie_weights_log_enabled</a>(1)) \</div>
<div class="line">      ie_log_error(__VA_ARGS__);   \</div>
<div class="line">  } <span class="keywordflow">while</span> (0)</div>
</div><!-- fragment -->
<p>Emit an error log if error logging is enabled. </p>

<p class="definition">Definition at line <a class="el" href="weights_8c_source.html#l00163">163</a> of file <a class="el" href="weights_8c_source.html">weights.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  164</span>     {                             \</div>
<div class="line"><span class="lineno">  165</span>    if (<a class="code hl_function" href="weights_8c.html#a684245f67e867bda9a255505a8e5f68b">ie_weights_log_enabled</a>(1)) \</div>
<div class="line"><span class="lineno">  166</span>      ie_log_error(__VA_ARGS__);   \</div>
<div class="line"><span class="lineno">  167</span>  } <span class="keywordflow">while</span> (0)</div>
</div><!-- fragment -->
</div>
</div>
<a id="a752563692fdfae65274bd2bf13be1661" name="a752563692fdfae65274bd2bf13be1661"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a752563692fdfae65274bd2bf13be1661">&#9670;&#160;</a></span>WLOGI</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define WLOGI</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">  <span class="keywordflow">do</span> {                             \</div>
<div class="line">    if (<a class="code hl_function" href="weights_8c.html#a684245f67e867bda9a255505a8e5f68b">ie_weights_log_enabled</a>(2)) \</div>
<div class="line">      ie_log_info(__VA_ARGS__);    \</div>
<div class="line">  } <span class="keywordflow">while</span> (0)</div>
</div><!-- fragment -->
<p>Emit an info log if info logging is enabled. </p>

<p class="definition">Definition at line <a class="el" href="weights_8c_source.html#l00142">142</a> of file <a class="el" href="weights_8c_source.html">weights.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  143</span>     {                             \</div>
<div class="line"><span class="lineno">  144</span>    if (<a class="code hl_function" href="weights_8c.html#a684245f67e867bda9a255505a8e5f68b">ie_weights_log_enabled</a>(2)) \</div>
<div class="line"><span class="lineno">  145</span>      ie_log_info(__VA_ARGS__);    \</div>
<div class="line"><span class="lineno">  146</span>  } <span class="keywordflow">while</span> (0)</div>
</div><!-- fragment -->
</div>
</div>
<a id="a92c7e58c96077a0c401dbfd6c4196f1a" name="a92c7e58c96077a0c401dbfd6c4196f1a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a92c7e58c96077a0c401dbfd6c4196f1a">&#9670;&#160;</a></span>WLOGW</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define WLOGW</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">  <span class="keywordflow">do</span> {                             \</div>
<div class="line">    if (<a class="code hl_function" href="weights_8c.html#a684245f67e867bda9a255505a8e5f68b">ie_weights_log_enabled</a>(2)) \</div>
<div class="line">      ie_log_warn(__VA_ARGS__);    \</div>
<div class="line">  } <span class="keywordflow">while</span> (0)</div>
</div><!-- fragment -->
<p>Emit a warning log if info logging is enabled. </p>

<p class="definition">Definition at line <a class="el" href="weights_8c_source.html#l00156">156</a> of file <a class="el" href="weights_8c_source.html">weights.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  157</span>     {                             \</div>
<div class="line"><span class="lineno">  158</span>    if (<a class="code hl_function" href="weights_8c.html#a684245f67e867bda9a255505a8e5f68b">ie_weights_log_enabled</a>(2)) \</div>
<div class="line"><span class="lineno">  159</span>      ie_log_warn(__VA_ARGS__);    \</div>
<div class="line"><span class="lineno">  160</span>  } <span class="keywordflow">while</span> (0)</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a72ab94aafe7740f1343d317daa89ca15" name="a72ab94aafe7740f1343d317daa89ca15"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a72ab94aafe7740f1343d317daa89ca15">&#9670;&#160;</a></span>ascii_ieq()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int ascii_ieq </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>ASCII-only case-insensitive equality. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">a</td><td>NUL-terminated string. </td></tr>
    <tr><td class="paramname">b</td><td>NUL-terminated string. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 if equal (ASCII case-insensitive), else 0. </dd></dl>

<p class="definition">Definition at line <a class="el" href="weights_8c_source.html#l00736">736</a> of file <a class="el" href="weights_8c_source.html">weights.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  736</span>                                                   {</div>
<div class="line"><span class="lineno">  737</span>  <span class="keywordflow">if</span> (!a || !b) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  738</span>  <span class="keywordflow">while</span> (*a &amp;&amp; *b) {</div>
<div class="line"><span class="lineno">  739</span>    <span class="keywordflow">if</span> ((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)tolower((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)*a) != (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)tolower((<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)*b)) {</div>
<div class="line"><span class="lineno">  740</span>      <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  741</span>    }</div>
<div class="line"><span class="lineno">  742</span>    ++a;</div>
<div class="line"><span class="lineno">  743</span>    ++b;</div>
<div class="line"><span class="lineno">  744</span>  }</div>
<div class="line"><span class="lineno">  745</span>  <span class="keywordflow">return</span> *a == <span class="charliteral">&#39;\0&#39;</span> &amp;&amp; *b == <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  746</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="weights_8c_source.html#l00759">env_flag_get()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="weights_8c_a72ab94aafe7740f1343d317daa89ca15_icgraph.svg" width="100%" height="438"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="ae3307b59271742c37862abf0b9698d23" name="ae3307b59271742c37862abf0b9698d23"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae3307b59271742c37862abf0b9698d23">&#9670;&#160;</a></span>cpyz()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void cpyz </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>dstsz</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>src</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Copy a C-string into a bounded buffer and always NUL-terminate. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dst</td><td>Destination buffer (may be NULL). </td></tr>
    <tr><td class="paramname">dstsz</td><td>Capacity in bytes. </td></tr>
    <tr><td class="paramname">src</td><td>Source string (may be NULL). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="weights_8c_source.html#l00207">207</a> of file <a class="el" href="weights_8c_source.html">weights.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  207</span>                                                           {</div>
<div class="line"><span class="lineno">  208</span>  <span class="keywordflow">if</span> (!dst || dstsz == 0) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  209</span>  <span class="keywordflow">if</span> (!src) {</div>
<div class="line"><span class="lineno">  210</span>    <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a415d14a7ade776b6bb2e544f0be25e6b">dst</a>[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  211</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  212</span>  }</div>
<div class="line"><span class="lineno">  213</span>  <span class="keywordtype">size_t</span> n = strlen(src);</div>
<div class="line"><span class="lineno">  214</span>  <span class="keywordflow">if</span> (n &gt;= dstsz) n = dstsz - 1;</div>
<div class="line"><span class="lineno">  215</span>  memcpy(dst, src, n);</div>
<div class="line"><span class="lineno">  216</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a415d14a7ade776b6bb2e544f0be25e6b">dst</a>[n] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  217</span>}</div>
<div class="ttc" id="anamespaceconvert__dtypes__to__numeric_html_a415d14a7ade776b6bb2e544f0be25e6b"><div class="ttname"><a href="namespaceconvert__dtypes__to__numeric.html#a415d14a7ade776b6bb2e544f0be25e6b">convert_dtypes_to_numeric.dst</a></div><div class="ttdeci">dst</div><div class="ttdef"><b>Definition</b> <a href="convert__dtypes__to__numeric_8py_source.html#l00027">convert_dtypes_to_numeric.py:27</a></div></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="weights_8c_source.html#l00812">find_dedup_manifest_source_()</a>, <a class="el" href="weights_8c_source.html#l00988">ie_weights_open()</a>, <a class="el" href="weights_8c_source.html#l01183">ie_weights_touch()</a>, and <a class="el" href="weights_8c_source.html#l00247">join_path()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="weights_8c_ae3307b59271742c37862abf0b9698d23_icgraph.svg" width="100%" height="502"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a5b123cfce35efe0ac7475c10419f9373" name="a5b123cfce35efe0ac7475c10419f9373"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5b123cfce35efe0ac7475c10419f9373">&#9670;&#160;</a></span>ensure_dedup_manifest_link()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int ensure_dedup_manifest_link </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>dir</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="weights_8c_source.html#l00867">867</a> of file <a class="el" href="weights_8c_source.html">weights.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  867</span>                                                       {</div>
<div class="line"><span class="lineno">  868</span>  <span class="keywordflow">if</span> (!dir || !*dir) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  869</span> </div>
<div class="line"><span class="lineno">  870</span>  <span class="keywordtype">char</span> linkpath[512];</div>
<div class="line"><span class="lineno">  871</span>  linkpath[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  872</span>  <a class="code hl_function" href="weights_8c.html#a7bb1dd9958b072fc5d1a80373cc074ff">join_path</a>(linkpath, <span class="keyword">sizeof</span>(linkpath), dir, <span class="stringliteral">&quot;model.dedup.json&quot;</span>);</div>
<div class="line"><span class="lineno">  873</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="weights_8c.html#a8adb51cd6c239a9589d4d66cd0cf989e">file_exists_readable</a>(linkpath)) {</div>
<div class="line"><span class="lineno">  874</span>    <a class="code hl_define" href="weights_8c.html#a2243a7a621a65f66170ede427763ee2d">WLOGD</a>(<span class="stringliteral">&quot;ensure_dedup_manifest_link: already exists path=&#39;%s&#39;&quot;</span>, linkpath);</div>
<div class="line"><span class="lineno">  875</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  876</span>  }</div>
<div class="line"><span class="lineno">  877</span> </div>
<div class="line"><span class="lineno">  878</span>  <span class="keywordtype">char</span> src_rel[512];</div>
<div class="line"><span class="lineno">  879</span>  <span class="keywordtype">char</span> src_abs[512];</div>
<div class="line"><span class="lineno">  880</span>  src_rel[0] = src_abs[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  881</span> </div>
<div class="line"><span class="lineno">  882</span>  <span class="keywordflow">if</span> (!<a class="code hl_function" href="weights_8c.html#a807c24ebcc098467a915557609f9a10e">find_dedup_manifest_source_</a>(dir, src_rel, <span class="keyword">sizeof</span>(src_rel), src_abs, <span class="keyword">sizeof</span>(src_abs))) {</div>
<div class="line"><span class="lineno">  883</span>    <a class="code hl_define" href="weights_8c.html#a2243a7a621a65f66170ede427763ee2d">WLOGD</a>(<span class="stringliteral">&quot;ensure_dedup_manifest_link: no manifest candidates found in dir=&#39;%s&#39;&quot;</span>, dir);</div>
<div class="line"><span class="lineno">  884</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  885</span>  }</div>
<div class="line"><span class="lineno">  886</span> </div>
<div class="line"><span class="lineno">  887</span>  <a class="code hl_define" href="weights_8c.html#a752563692fdfae65274bd2bf13be1661">WLOGI</a>(<span class="stringliteral">&quot;ensure_dedup_manifest_link: creating model.dedup.json from source rel=&#39;%s&#39; abs=&#39;%s&#39;&quot;</span>, src_rel,</div>
<div class="line"><span class="lineno">  888</span>        src_abs);</div>
<div class="line"><span class="lineno">  889</span> </div>
<div class="line"><span class="lineno">  890</span>  <span class="keywordtype">int</span> linked = 0;</div>
<div class="line"><span class="lineno">  891</span>  errno = 0;</div>
<div class="line"><span class="lineno">  892</span>  <span class="keywordflow">if</span> (symlink(src_rel, linkpath) == 0 || errno == EEXIST) {</div>
<div class="line"><span class="lineno">  893</span>    linked = 1;</div>
<div class="line"><span class="lineno">  894</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  895</span>    <a class="code hl_function" href="weights_8c.html#a88ec341995312abc5fbbd4084389523e">wlog_errno_</a>(<span class="stringliteral">&quot;symlink&quot;</span>, linkpath);</div>
<div class="line"><span class="lineno">  896</span>  }</div>
<div class="line"><span class="lineno">  897</span> </div>
<div class="line"><span class="lineno">  898</span>  <span class="keywordflow">if</span> (!<a class="code hl_function" href="weights_8c.html#a8adb51cd6c239a9589d4d66cd0cf989e">file_exists_readable</a>(linkpath)) {</div>
<div class="line"><span class="lineno">  899</span>    <span class="comment">/* Fall back to a direct copy (some environments disallow symlink). */</span></div>
<div class="line"><span class="lineno">  900</span>    <span class="keywordtype">char</span> *buf = NULL;</div>
<div class="line"><span class="lineno">  901</span>    <span class="keywordtype">size_t</span> len = 0;</div>
<div class="line"><span class="lineno">  902</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="weights_8c.html#a7d467c1ab0baceed9b0fdad7b5a8accf">read_all_text</a>(src_abs, &amp;buf, &amp;len) == 0 &amp;&amp; buf &amp;&amp; len &gt; 0) {</div>
<div class="line"><span class="lineno">  903</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="weights_8c.html#a58a74ad7b283929166fa3d00c2c59b60">write_all_bytes_</a>(linkpath, buf, len)) {</div>
<div class="line"><span class="lineno">  904</span>        linked = 1;</div>
<div class="line"><span class="lineno">  905</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  906</span>        <a class="code hl_define" href="weights_8c.html#a92c7e58c96077a0c401dbfd6c4196f1a">WLOGW</a>(<span class="stringliteral">&quot;ensure_dedup_manifest_link: copy failed dst=&#39;%s&#39;&quot;</span>, linkpath);</div>
<div class="line"><span class="lineno">  907</span>      }</div>
<div class="line"><span class="lineno">  908</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  909</span>      <a class="code hl_define" href="weights_8c.html#a92c7e58c96077a0c401dbfd6c4196f1a">WLOGW</a>(<span class="stringliteral">&quot;ensure_dedup_manifest_link: failed to read source &#39;%s&#39;&quot;</span>, src_abs);</div>
<div class="line"><span class="lineno">  910</span>    }</div>
<div class="line"><span class="lineno">  911</span>    free(buf);</div>
<div class="line"><span class="lineno">  912</span>  }</div>
<div class="line"><span class="lineno">  913</span> </div>
<div class="line"><span class="lineno">  914</span>  <span class="keywordflow">if</span> (!<a class="code hl_function" href="weights_8c.html#a8adb51cd6c239a9589d4d66cd0cf989e">file_exists_readable</a>(linkpath)) {</div>
<div class="line"><span class="lineno">  915</span>    <a class="code hl_define" href="weights_8c.html#a92c7e58c96077a0c401dbfd6c4196f1a">WLOGW</a>(<span class="stringliteral">&quot;ensure_dedup_manifest_link: model.dedup.json still not readable path=&#39;%s&#39;&quot;</span>, linkpath);</div>
<div class="line"><span class="lineno">  916</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  917</span>  }</div>
<div class="line"><span class="lineno">  918</span> </div>
<div class="line"><span class="lineno">  919</span>  <a class="code hl_define" href="weights_8c.html#a2243a7a621a65f66170ede427763ee2d">WLOGD</a>(<span class="stringliteral">&quot;ensure_dedup_manifest_link: ok path=&#39;%s&#39; (via %s)&quot;</span>, linkpath, linked ? <span class="stringliteral">&quot;link/copy&quot;</span> : <span class="stringliteral">&quot;unknown&quot;</span>);</div>
<div class="line"><span class="lineno">  920</span>  <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  921</span>}</div>
<div class="ttc" id="aweights_8c_html_a2243a7a621a65f66170ede427763ee2d"><div class="ttname"><a href="weights_8c.html#a2243a7a621a65f66170ede427763ee2d">WLOGD</a></div><div class="ttdeci">#define WLOGD(...)</div><div class="ttdoc">Emit a debug log if debug logging is enabled.</div><div class="ttdef"><b>Definition</b> <a href="weights_8c_source.html#l00149">weights.c:149</a></div></div>
<div class="ttc" id="aweights_8c_html_a58a74ad7b283929166fa3d00c2c59b60"><div class="ttname"><a href="weights_8c.html#a58a74ad7b283929166fa3d00c2c59b60">write_all_bytes_</a></div><div class="ttdeci">static int write_all_bytes_(const char *path, const void *data, size_t len)</div><div class="ttdoc">Create a best-effort model.dedup.json manifest for runtime dedup.</div><div class="ttdef"><b>Definition</b> <a href="weights_8c_source.html#l00798">weights.c:798</a></div></div>
<div class="ttc" id="aweights_8c_html_a752563692fdfae65274bd2bf13be1661"><div class="ttname"><a href="weights_8c.html#a752563692fdfae65274bd2bf13be1661">WLOGI</a></div><div class="ttdeci">#define WLOGI(...)</div><div class="ttdoc">Emit an info log if info logging is enabled.</div><div class="ttdef"><b>Definition</b> <a href="weights_8c_source.html#l00142">weights.c:142</a></div></div>
<div class="ttc" id="aweights_8c_html_a7bb1dd9958b072fc5d1a80373cc074ff"><div class="ttname"><a href="weights_8c.html#a7bb1dd9958b072fc5d1a80373cc074ff">join_path</a></div><div class="ttdeci">static void join_path(char *out, size_t outsz, const char *dir, const char *file)</div><div class="ttdoc">Join directory and filename into an output buffer (NUL-terminated).</div><div class="ttdef"><b>Definition</b> <a href="weights_8c_source.html#l00247">weights.c:247</a></div></div>
<div class="ttc" id="aweights_8c_html_a7d467c1ab0baceed9b0fdad7b5a8accf"><div class="ttname"><a href="weights_8c.html#a7d467c1ab0baceed9b0fdad7b5a8accf">read_all_text</a></div><div class="ttdeci">static int read_all_text(const char *path, char **buf, size_t *len_out)</div><div class="ttdoc">Read an entire file into a newly allocated NUL-terminated buffer.</div><div class="ttdef"><b>Definition</b> <a href="weights_8c_source.html#l00297">weights.c:297</a></div></div>
<div class="ttc" id="aweights_8c_html_a807c24ebcc098467a915557609f9a10e"><div class="ttname"><a href="weights_8c.html#a807c24ebcc098467a915557609f9a10e">find_dedup_manifest_source_</a></div><div class="ttdeci">static int find_dedup_manifest_source_(const char *dir, char *out_rel, size_t out_rel_n, char *out_abs, size_t out_abs_n)</div><div class="ttdef"><b>Definition</b> <a href="weights_8c_source.html#l00812">weights.c:812</a></div></div>
<div class="ttc" id="aweights_8c_html_a88ec341995312abc5fbbd4084389523e"><div class="ttname"><a href="weights_8c.html#a88ec341995312abc5fbbd4084389523e">wlog_errno_</a></div><div class="ttdeci">static void wlog_errno_(const char *what, const char *path)</div><div class="ttdoc">Log an errno-based failure with contextual path information.</div><div class="ttdef"><b>Definition</b> <a href="weights_8c_source.html#l00175">weights.c:175</a></div></div>
<div class="ttc" id="aweights_8c_html_a8adb51cd6c239a9589d4d66cd0cf989e"><div class="ttname"><a href="weights_8c.html#a8adb51cd6c239a9589d4d66cd0cf989e">file_exists_readable</a></div><div class="ttdeci">static int file_exists_readable(const char *path)</div><div class="ttdoc">Check if a path exists and is readable.</div><div class="ttdef"><b>Definition</b> <a href="weights_8c_source.html#l00775">weights.c:775</a></div></div>
<div class="ttc" id="aweights_8c_html_a92c7e58c96077a0c401dbfd6c4196f1a"><div class="ttname"><a href="weights_8c.html#a92c7e58c96077a0c401dbfd6c4196f1a">WLOGW</a></div><div class="ttdeci">#define WLOGW(...)</div><div class="ttdoc">Emit a warning log if info logging is enabled.</div><div class="ttdef"><b>Definition</b> <a href="weights_8c_source.html#l00156">weights.c:156</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="weights_8c_source.html#l00775">file_exists_readable()</a>, <a class="el" href="weights_8c_source.html#l00812">find_dedup_manifest_source_()</a>, <a class="el" href="weights_8c_source.html#l00247">join_path()</a>, <a class="el" href="weights_8c_source.html#l00297">read_all_text()</a>, <a class="el" href="weights_8c_source.html#l00175">wlog_errno_()</a>, <a class="el" href="weights_8c_source.html#l00149">WLOGD</a>, <a class="el" href="weights_8c_source.html#l00142">WLOGI</a>, <a class="el" href="weights_8c_source.html#l00156">WLOGW</a>, and <a class="el" href="weights_8c_source.html#l00798">write_all_bytes_()</a>.</p>

<p class="reference">Referenced by <a class="el" href="weights_8c_source.html#l00988">ie_weights_open()</a>, and <a class="el" href="weights_8c_source.html#l01183">ie_weights_touch()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="weights_8c_a5b123cfce35efe0ac7475c10419f9373_cgraph.svg" width="100%" height="524"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="weights_8c_a5b123cfce35efe0ac7475c10419f9373_icgraph.svg" width="100%" height="438"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a93c92a71a0cf18f3eea8623ea9524d54" name="a93c92a71a0cf18f3eea8623ea9524d54"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a93c92a71a0cf18f3eea8623ea9524d54">&#9670;&#160;</a></span>env_flag_get()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int env_flag_get </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>default_value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Parse environment flag-like strings into a boolean. </p>
<p>Accepts: 0/1, false/true, no/yes, off/on (ASCII case-insensitive). Unknown values default to enabled (1).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>Environment variable name. </td></tr>
    <tr><td class="paramname">default_value</td><td>Default value if not set/empty. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 or 1. </dd></dl>

<p class="definition">Definition at line <a class="el" href="weights_8c_source.html#l00759">759</a> of file <a class="el" href="weights_8c_source.html">weights.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  759</span>                                                             {</div>
<div class="line"><span class="lineno">  760</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *v = getenv(name);</div>
<div class="line"><span class="lineno">  761</span>  <span class="keywordflow">if</span> (!v || !*v) <span class="keywordflow">return</span> default_value;</div>
<div class="line"><span class="lineno">  762</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="weights_8c.html#a72ab94aafe7740f1343d317daa89ca15">ascii_ieq</a>(v, <span class="stringliteral">&quot;0&quot;</span>) || <a class="code hl_function" href="weights_8c.html#a72ab94aafe7740f1343d317daa89ca15">ascii_ieq</a>(v, <span class="stringliteral">&quot;false&quot;</span>) || <a class="code hl_function" href="weights_8c.html#a72ab94aafe7740f1343d317daa89ca15">ascii_ieq</a>(v, <span class="stringliteral">&quot;no&quot;</span>) || <a class="code hl_function" href="weights_8c.html#a72ab94aafe7740f1343d317daa89ca15">ascii_ieq</a>(v, <span class="stringliteral">&quot;off&quot;</span>))</div>
<div class="line"><span class="lineno">  763</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  764</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="weights_8c.html#a72ab94aafe7740f1343d317daa89ca15">ascii_ieq</a>(v, <span class="stringliteral">&quot;1&quot;</span>) || <a class="code hl_function" href="weights_8c.html#a72ab94aafe7740f1343d317daa89ca15">ascii_ieq</a>(v, <span class="stringliteral">&quot;true&quot;</span>) || <a class="code hl_function" href="weights_8c.html#a72ab94aafe7740f1343d317daa89ca15">ascii_ieq</a>(v, <span class="stringliteral">&quot;yes&quot;</span>) || <a class="code hl_function" href="weights_8c.html#a72ab94aafe7740f1343d317daa89ca15">ascii_ieq</a>(v, <span class="stringliteral">&quot;on&quot;</span>))</div>
<div class="line"><span class="lineno">  765</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  766</span>  <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  767</span>}</div>
<div class="ttc" id="aweights_8c_html_a72ab94aafe7740f1343d317daa89ca15"><div class="ttname"><a href="weights_8c.html#a72ab94aafe7740f1343d317daa89ca15">ascii_ieq</a></div><div class="ttdeci">static int ascii_ieq(const char *a, const char *b)</div><div class="ttdoc">ASCII-only case-insensitive equality.</div><div class="ttdef"><b>Definition</b> <a href="weights_8c_source.html#l00736">weights.c:736</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="weights_8c_source.html#l00736">ascii_ieq()</a>.</p>

<p class="reference">Referenced by <a class="el" href="weights_8c_source.html#l00988">ie_weights_open()</a>, and <a class="el" href="weights_8c_source.html#l01183">ie_weights_touch()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="weights_8c_a93c92a71a0cf18f3eea8623ea9524d54_cgraph.svg" width="243" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="weights_8c_a93c92a71a0cf18f3eea8623ea9524d54_icgraph.svg" width="583" height="184"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a8adb51cd6c239a9589d4d66cd0cf989e" name="a8adb51cd6c239a9589d4d66cd0cf989e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8adb51cd6c239a9589d4d66cd0cf989e">&#9670;&#160;</a></span>file_exists_readable()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int file_exists_readable </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check if a path exists and is readable. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">path</td><td>NUL-terminated path. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 if readable, else 0. </dd></dl>

<p class="definition">Definition at line <a class="el" href="weights_8c_source.html#l00775">775</a> of file <a class="el" href="weights_8c_source.html">weights.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  775</span>                                                  {</div>
<div class="line"><span class="lineno">  776</span>  <span class="keywordflow">if</span> (!path || !*path) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  777</span>  <span class="keywordflow">return</span> access(path, R_OK) == 0;</div>
<div class="line"><span class="lineno">  778</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="weights_8c_source.html#l00867">ensure_dedup_manifest_link()</a>, <a class="el" href="weights_8c_source.html#l00812">find_dedup_manifest_source_()</a>, <a class="el" href="weights_8c_source.html#l00988">ie_weights_open()</a>, and <a class="el" href="weights_8c_source.html#l01183">ie_weights_touch()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="weights_8c_a8adb51cd6c239a9589d4d66cd0cf989e_icgraph.svg" width="100%" height="440"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a807c24ebcc098467a915557609f9a10e" name="a807c24ebcc098467a915557609f9a10e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a807c24ebcc098467a915557609f9a10e">&#9670;&#160;</a></span>find_dedup_manifest_source_()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int find_dedup_manifest_source_ </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>out_rel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>out_rel_n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>out_abs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>out_abs_n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="weights_8c_source.html#l00812">812</a> of file <a class="el" href="weights_8c_source.html">weights.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  816</span>                                                        {</div>
<div class="line"><span class="lineno">  817</span>  <span class="keywordflow">if</span> (!dir || !*dir || !out_rel || !out_abs || out_rel_n == 0 || out_abs_n == 0) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  818</span>  out_rel[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  819</span>  out_abs[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  820</span> </div>
<div class="line"><span class="lineno">  821</span>  <span class="comment">/* 1) Explicit override: IE_DEDUP_MANIFEST may be absolute or relative. */</span></div>
<div class="line"><span class="lineno">  822</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *env = getenv(<span class="stringliteral">&quot;IE_DEDUP_MANIFEST&quot;</span>);</div>
<div class="line"><span class="lineno">  823</span>  <span class="keywordflow">if</span> (env &amp;&amp; *env) {</div>
<div class="line"><span class="lineno">  824</span>    <span class="keywordflow">if</span> (env[0] == <span class="charliteral">&#39;/&#39;</span>) {</div>
<div class="line"><span class="lineno">  825</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="weights_8c.html#a8adb51cd6c239a9589d4d66cd0cf989e">file_exists_readable</a>(env)) {</div>
<div class="line"><span class="lineno">  826</span>        <a class="code hl_function" href="weights_8c.html#ae3307b59271742c37862abf0b9698d23">cpyz</a>(out_rel, out_rel_n, env);</div>
<div class="line"><span class="lineno">  827</span>        <a class="code hl_function" href="weights_8c.html#ae3307b59271742c37862abf0b9698d23">cpyz</a>(out_abs, out_abs_n, env);</div>
<div class="line"><span class="lineno">  828</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  829</span>      }</div>
<div class="line"><span class="lineno">  830</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  831</span>      <span class="keywordtype">char</span> cand[512];</div>
<div class="line"><span class="lineno">  832</span>      cand[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  833</span>      <a class="code hl_function" href="weights_8c.html#a7bb1dd9958b072fc5d1a80373cc074ff">join_path</a>(cand, <span class="keyword">sizeof</span>(cand), dir, env);</div>
<div class="line"><span class="lineno">  834</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="weights_8c.html#a8adb51cd6c239a9589d4d66cd0cf989e">file_exists_readable</a>(cand)) {</div>
<div class="line"><span class="lineno">  835</span>        <a class="code hl_function" href="weights_8c.html#ae3307b59271742c37862abf0b9698d23">cpyz</a>(out_rel, out_rel_n, env);</div>
<div class="line"><span class="lineno">  836</span>        <a class="code hl_function" href="weights_8c.html#ae3307b59271742c37862abf0b9698d23">cpyz</a>(out_abs, out_abs_n, cand);</div>
<div class="line"><span class="lineno">  837</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  838</span>      }</div>
<div class="line"><span class="lineno">  839</span>    }</div>
<div class="line"><span class="lineno">  840</span>  }</div>
<div class="line"><span class="lineno">  841</span> </div>
<div class="line"><span class="lineno">  842</span>  <span class="comment">/* 2) Common alternative names produced by different toolchains. */</span></div>
<div class="line"><span class="lineno">  843</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *cands[] = {</div>
<div class="line"><span class="lineno">  844</span>      <span class="stringliteral">&quot;dedup_manifest.json&quot;</span>,</div>
<div class="line"><span class="lineno">  845</span>      <span class="stringliteral">&quot;manifest.dedup.json&quot;</span>,</div>
<div class="line"><span class="lineno">  846</span>      <span class="stringliteral">&quot;manifest_dedup.json&quot;</span>,</div>
<div class="line"><span class="lineno">  847</span>      <span class="stringliteral">&quot;model.dedup.manifest.json&quot;</span>,</div>
<div class="line"><span class="lineno">  848</span>      <span class="stringliteral">&quot;dedup/model.dedup.json&quot;</span>,</div>
<div class="line"><span class="lineno">  849</span>      <span class="stringliteral">&quot;dedup/manifest.json&quot;</span>,</div>
<div class="line"><span class="lineno">  850</span>      <span class="stringliteral">&quot;dedup/manifest.dedup.json&quot;</span>,</div>
<div class="line"><span class="lineno">  851</span>  };</div>
<div class="line"><span class="lineno">  852</span> </div>
<div class="line"><span class="lineno">  853</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; (<span class="keyword">sizeof</span>(cands) / <span class="keyword">sizeof</span>(cands[0])); ++i) {</div>
<div class="line"><span class="lineno">  854</span>    <span class="keywordtype">char</span> abs[512];</div>
<div class="line"><span class="lineno">  855</span>    abs[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  856</span>    <a class="code hl_function" href="weights_8c.html#a7bb1dd9958b072fc5d1a80373cc074ff">join_path</a>(abs, <span class="keyword">sizeof</span>(abs), dir, cands[i]);</div>
<div class="line"><span class="lineno">  857</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="weights_8c.html#a8adb51cd6c239a9589d4d66cd0cf989e">file_exists_readable</a>(abs)) {</div>
<div class="line"><span class="lineno">  858</span>      <a class="code hl_function" href="weights_8c.html#ae3307b59271742c37862abf0b9698d23">cpyz</a>(out_rel, out_rel_n, cands[i]);</div>
<div class="line"><span class="lineno">  859</span>      <a class="code hl_function" href="weights_8c.html#ae3307b59271742c37862abf0b9698d23">cpyz</a>(out_abs, out_abs_n, abs);</div>
<div class="line"><span class="lineno">  860</span>      <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  861</span>    }</div>
<div class="line"><span class="lineno">  862</span>  }</div>
<div class="line"><span class="lineno">  863</span> </div>
<div class="line"><span class="lineno">  864</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  865</span>}</div>
<div class="ttc" id="aweights_8c_html_ae3307b59271742c37862abf0b9698d23"><div class="ttname"><a href="weights_8c.html#ae3307b59271742c37862abf0b9698d23">cpyz</a></div><div class="ttdeci">static void cpyz(char *dst, size_t dstsz, const char *src)</div><div class="ttdoc">Copy a C-string into a bounded buffer and always NUL-terminate.</div><div class="ttdef"><b>Definition</b> <a href="weights_8c_source.html#l00207">weights.c:207</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="weights_8c_source.html#l00207">cpyz()</a>, <a class="el" href="weights_8c_source.html#l00775">file_exists_readable()</a>, and <a class="el" href="weights_8c_source.html#l00247">join_path()</a>.</p>

<p class="reference">Referenced by <a class="el" href="weights_8c_source.html#l00867">ensure_dedup_manifest_link()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="weights_8c_a807c24ebcc098467a915557609f9a10e_cgraph.svg" width="470" height="106"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="weights_8c_a807c24ebcc098467a915557609f9a10e_icgraph.svg" width="100%" height="438"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="aabb19f4a5e5385962c6db57f611bb785" name="aabb19f4a5e5385962c6db57f611bb785"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aabb19f4a5e5385962c6db57f611bb785">&#9670;&#160;</a></span>ie_pread()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static ssize_t ie_pread </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">off_t&#160;</td>
          <td class="paramname"><em>offset</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Portable pread wrapper with fallback. </p>
<p>When pread(2) is unavailable, falls back to lseek+read and restores the file offset. This is slower but sufficient for small diagnostic reads.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fd</td><td>Open file descriptor. </td></tr>
    <tr><td class="paramname">buf</td><td>Destination buffer. </td></tr>
    <tr><td class="paramname">count</td><td>Number of bytes to read. </td></tr>
    <tr><td class="paramname">offset</td><td>Offset from start. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Bytes read, or -1 on error. </dd></dl>

<p class="definition">Definition at line <a class="el" href="weights_8c_source.html#l00716">716</a> of file <a class="el" href="weights_8c_source.html">weights.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  716</span>                                                                       {</div>
<div class="line"><span class="lineno">  717</span><span class="preprocessor">#if defined(_XOPEN_SOURCE) || defined(_POSIX_C_SOURCE)</span></div>
<div class="line"><span class="lineno">  718</span>  <span class="keywordflow">return</span> pread(fd, buf, count, offset);</div>
<div class="line"><span class="lineno">  719</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  720</span>  off_t cur = lseek(fd, 0, SEEK_CUR);</div>
<div class="line"><span class="lineno">  721</span>  <span class="keywordflow">if</span> (cur == (off_t)-1) <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  722</span>  <span class="keywordflow">if</span> (lseek(fd, offset, SEEK_SET) == (off_t)-1) <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  723</span>  ssize_t r = read(fd, buf, count);</div>
<div class="line"><span class="lineno">  724</span>  (void)lseek(fd, cur, SEEK_SET);</div>
<div class="line"><span class="lineno">  725</span>  <span class="keywordflow">return</span> r;</div>
<div class="line"><span class="lineno">  726</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  727</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="weights_8c_source.html#l01183">ie_weights_touch()</a>, and <a class="el" href="weights_8c_source.html#l00933">touch_file_small()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="weights_8c_aabb19f4a5e5385962c6db57f611bb785_icgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a06c2b7e35d1f82a11e4605e23a1976f5" name="a06c2b7e35d1f82a11e4605e23a1976f5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a06c2b7e35d1f82a11e4605e23a1976f5">&#9670;&#160;</a></span>ie_weights_close()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ie_weights_close </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ie__io_8h.html#af68ad3cdc2eb244fe4feed94372d7806">ie_weights_t</a> *&#160;</td>
          <td class="paramname"><em>w</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Close an opened weights descriptor and release optional dedup handles. </p>
<p>Close an opened weights descriptor.</p>
<p>This function is idempotent and safe to call on partially initialized structures. It does not unlink or delete any files; it only releases in-memory handles.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">w</td><td>Weights descriptor (may be NULL). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="weights_8c_source.html#l01356">1356</a> of file <a class="el" href="weights_8c_source.html">weights.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1356</span>                                       {</div>
<div class="line"><span class="lineno"> 1357</span>  <span class="keywordflow">if</span> (!w) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1358</span> </div>
<div class="line"><span class="lineno"> 1359</span>  <a class="code hl_define" href="weights_8c.html#a2243a7a621a65f66170ede427763ee2d">WLOGD</a>(<span class="stringliteral">&quot;ie_weights_close: begin loaded=%d is_dedup=%d&quot;</span>, w-&gt;<a class="code hl_variable" href="structie__weights__s.html#a0e365369fa9f9920eda71bd9be50c5bb">loaded</a>, w-&gt;<a class="code hl_variable" href="structie__weights__s.html#ab1e17ac4f44125571f2c63e603d967da">is_dedup</a>);</div>
<div class="line"><span class="lineno"> 1360</span> </div>
<div class="line"><span class="lineno"> 1361</span><span class="preprocessor">#if (IE_WEIGHTS_HAS_DEDUP_FIELDS == 1)</span></div>
<div class="line"><span class="lineno"> 1362</span>  <span class="keywordflow">if</span> (w-&gt;<a class="code hl_variable" href="structie__weights__s.html#ab1e17ac4f44125571f2c63e603d967da">is_dedup</a> &amp;&amp; w-&gt;<a class="code hl_variable" href="structie__weights__s.html#a6cffa1c1904346d68932cc9542b8ff32">dedup_handle</a>) {</div>
<div class="line"><span class="lineno"> 1363</span>    <a class="code hl_struct" href="structie__weights__dedup.html">ie_weights_dedup_t</a> *dh = (<a class="code hl_struct" href="structie__weights__dedup.html">ie_weights_dedup_t</a> *)w-&gt;<a class="code hl_variable" href="structie__weights__s.html#a6cffa1c1904346d68932cc9542b8ff32">dedup_handle</a>;</div>
<div class="line"><span class="lineno"> 1364</span>    <a class="code hl_function" href="weights__dedup_8h.html#a3ad33a6fe3c7a81072c092d1ee510fce">ie_weights_dedup_close</a>(&amp;dh);</div>
<div class="line"><span class="lineno"> 1365</span>    w-&gt;<a class="code hl_variable" href="structie__weights__s.html#a6cffa1c1904346d68932cc9542b8ff32">dedup_handle</a> = NULL;</div>
<div class="line"><span class="lineno"> 1366</span>    w-&gt;<a class="code hl_variable" href="structie__weights__s.html#ab1e17ac4f44125571f2c63e603d967da">is_dedup</a> = 0;</div>
<div class="line"><span class="lineno"> 1367</span>    <a class="code hl_define" href="weights_8c.html#a2243a7a621a65f66170ede427763ee2d">WLOGD</a>(<span class="stringliteral">&quot;ie_weights_close: dedup handle released&quot;</span>);</div>
<div class="line"><span class="lineno"> 1368</span>  }</div>
<div class="line"><span class="lineno"> 1369</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1370</span>}</div>
<div class="ttc" id="astructie__weights__dedup_html"><div class="ttname"><a href="structie__weights__dedup.html">ie_weights_dedup</a></div><div class="ttdef"><b>Definition</b> <a href="weights__dedup_8c_source.html#l00747">weights_dedup.c:747</a></div></div>
<div class="ttc" id="astructie__weights__s_html_a0e365369fa9f9920eda71bd9be50c5bb"><div class="ttname"><a href="structie__weights__s.html#a0e365369fa9f9920eda71bd9be50c5bb">ie_weights_s::loaded</a></div><div class="ttdeci">int loaded</div><div class="ttdoc">Non-zero if open succeeded.</div><div class="ttdef"><b>Definition</b> <a href="ie__io_8h_source.html#l00102">ie_io.h:102</a></div></div>
<div class="ttc" id="astructie__weights__s_html_a6cffa1c1904346d68932cc9542b8ff32"><div class="ttname"><a href="structie__weights__s.html#a6cffa1c1904346d68932cc9542b8ff32">ie_weights_s::dedup_handle</a></div><div class="ttdeci">void * dedup_handle</div><div class="ttdoc">Opaque dedup handle (owned by this struct).</div><div class="ttdef"><b>Definition</b> <a href="ie__io_8h_source.html#l00105">ie_io.h:105</a></div></div>
<div class="ttc" id="astructie__weights__s_html_ab1e17ac4f44125571f2c63e603d967da"><div class="ttname"><a href="structie__weights__s.html#ab1e17ac4f44125571f2c63e603d967da">ie_weights_s::is_dedup</a></div><div class="ttdeci">int is_dedup</div><div class="ttdoc">Non-zero if dedup artifacts were opened.</div><div class="ttdef"><b>Definition</b> <a href="ie__io_8h_source.html#l00104">ie_io.h:104</a></div></div>
<div class="ttc" id="aweights__dedup_8h_html_a3ad33a6fe3c7a81072c092d1ee510fce"><div class="ttname"><a href="weights__dedup_8h.html#a3ad33a6fe3c7a81072c092d1ee510fce">ie_weights_dedup_close</a></div><div class="ttdeci">void ie_weights_dedup_close(ie_weights_dedup_t **h)</div><div class="ttdoc">Close the loader and free all associated memory.</div><div class="ttdef"><b>Definition</b> <a href="weights__dedup_8c_source.html#l01236">weights_dedup.c:1236</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ie__io_8h_source.html#l00105">ie_weights_s::dedup_handle</a>, <a class="el" href="weights__dedup_8c_source.html#l01236">ie_weights_dedup_close()</a>, <a class="el" href="ie__io_8h_source.html#l00104">ie_weights_s::is_dedup</a>, <a class="el" href="ie__io_8h_source.html#l00102">ie_weights_s::loaded</a>, and <a class="el" href="weights_8c_source.html#l00149">WLOGD</a>.</p>

<p class="reference">Referenced by <a class="el" href="ie__api_8c_source.html#l00535">ie_engine_create()</a>, <a class="el" href="ie__api_8c_source.html#l00788">ie_engine_destroy()</a>, <a class="el" href="main__infer_8c_source.html#l02362">main()</a>, <a class="el" href="test__weights_8c_source.html#l00143">main()</a>, and <a class="el" href="test__dedup__loader_8c_source.html#l00065">open_and_touch()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="weights_8c_a06c2b7e35d1f82a11e4605e23a1976f5_cgraph.svg" width="582" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="weights_8c_a06c2b7e35d1f82a11e4605e23a1976f5_icgraph.svg" width="436" height="208"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a684245f67e867bda9a255505a8e5f68b" name="a684245f67e867bda9a255505a8e5f68b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a684245f67e867bda9a255505a8e5f68b">&#9670;&#160;</a></span>ie_weights_log_enabled()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int ie_weights_log_enabled </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>level</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return non-zero if the requested logging level is enabled. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">level</td><td>1=error, 2=info, 3=debug. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 if enabled, else 0. </dd></dl>

<p class="definition">Definition at line <a class="el" href="weights_8c_source.html#l00137">137</a> of file <a class="el" href="weights_8c_source.html">weights.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  137</span>                                             {</div>
<div class="line"><span class="lineno">  138</span>  <span class="keywordflow">return</span> <a class="code hl_function" href="weights_8c.html#a42060a9aacf63543286684615cfc36fe">ie_weights_log_level</a>() &gt;= level;</div>
<div class="line"><span class="lineno">  139</span>}</div>
<div class="ttc" id="aweights_8c_html_a42060a9aacf63543286684615cfc36fe"><div class="ttname"><a href="weights_8c.html#a42060a9aacf63543286684615cfc36fe">ie_weights_log_level</a></div><div class="ttdeci">static int ie_weights_log_level(void)</div><div class="ttdoc">Read IE_LOG_LEVEL once and cache it for the process lifetime.</div><div class="ttdef"><b>Definition</b> <a href="weights_8c_source.html#l00099">weights.c:99</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="weights_8c_source.html#l00099">ie_weights_log_level()</a>.</p>

<p class="reference">Referenced by <a class="el" href="weights_8c_source.html#l00175">wlog_errno_()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="weights_8c_a684245f67e867bda9a255505a8e5f68b_cgraph.svg" width="396" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="weights_8c_a684245f67e867bda9a255505a8e5f68b_icgraph.svg" width="100%" height="511"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a42060a9aacf63543286684615cfc36fe" name="a42060a9aacf63543286684615cfc36fe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a42060a9aacf63543286684615cfc36fe">&#9670;&#160;</a></span>ie_weights_log_level()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int ie_weights_log_level </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Read IE_LOG_LEVEL once and cache it for the process lifetime. </p>
<p>This module uses a local log level cache to avoid repeated getenv calls. The log level defaults to 2 (info) to aid diagnostics during development.</p>
<dl class="section return"><dt>Returns</dt><dd>Cached log level in range [0,3]. </dd></dl>

<p class="definition">Definition at line <a class="el" href="weights_8c_source.html#l00099">99</a> of file <a class="el" href="weights_8c_source.html">weights.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   99</span>                                      {</div>
<div class="line"><span class="lineno">  100</span>  <span class="keyword">static</span> <span class="keywordtype">int</span> init = 0;</div>
<div class="line"><span class="lineno">  101</span>  <span class="keyword">static</span> <span class="keywordtype">int</span> lvl = 2; <span class="comment">/* Default: info. */</span></div>
<div class="line"><span class="lineno">  102</span> </div>
<div class="line"><span class="lineno">  103</span>  <span class="keywordflow">if</span> (init) <span class="keywordflow">return</span> lvl;</div>
<div class="line"><span class="lineno">  104</span>  init = 1;</div>
<div class="line"><span class="lineno">  105</span> </div>
<div class="line"><span class="lineno">  106</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *v = getenv(<span class="stringliteral">&quot;IE_LOG_LEVEL&quot;</span>);</div>
<div class="line"><span class="lineno">  107</span>  <span class="keywordflow">if</span> (!v || !*v) <span class="keywordflow">return</span> lvl;</div>
<div class="line"><span class="lineno">  108</span> </div>
<div class="line"><span class="lineno">  109</span>  <span class="keywordtype">char</span> *end = NULL;</div>
<div class="line"><span class="lineno">  110</span>  <span class="keywordtype">long</span> x = strtol(v, &amp;end, 10);</div>
<div class="line"><span class="lineno">  111</span>  <span class="keywordflow">if</span> (end &amp;&amp; end != v) {</div>
<div class="line"><span class="lineno">  112</span>    <span class="keywordflow">if</span> (x &lt; 0) x = 0;</div>
<div class="line"><span class="lineno">  113</span>    <span class="keywordflow">if</span> (x &gt; 3) x = 3;</div>
<div class="line"><span class="lineno">  114</span>    lvl = (int)x;</div>
<div class="line"><span class="lineno">  115</span>    <span class="keywordflow">return</span> lvl;</div>
<div class="line"><span class="lineno">  116</span>  }</div>
<div class="line"><span class="lineno">  117</span> </div>
<div class="line"><span class="lineno">  118</span>  <span class="comment">/* Best-effort string forms. */</span></div>
<div class="line"><span class="lineno">  119</span>  <span class="keywordflow">if</span> (strcasecmp(v, <span class="stringliteral">&quot;silent&quot;</span>) == 0 || strcasecmp(v, <span class="stringliteral">&quot;quiet&quot;</span>) == 0) {</div>
<div class="line"><span class="lineno">  120</span>    lvl = 0;</div>
<div class="line"><span class="lineno">  121</span>  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcasecmp(v, <span class="stringliteral">&quot;error&quot;</span>) == 0 || strcasecmp(v, <span class="stringliteral">&quot;errors&quot;</span>) == 0) {</div>
<div class="line"><span class="lineno">  122</span>    lvl = 1;</div>
<div class="line"><span class="lineno">  123</span>  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcasecmp(v, <span class="stringliteral">&quot;info&quot;</span>) == 0) {</div>
<div class="line"><span class="lineno">  124</span>    lvl = 2;</div>
<div class="line"><span class="lineno">  125</span>  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcasecmp(v, <span class="stringliteral">&quot;debug&quot;</span>) == 0) {</div>
<div class="line"><span class="lineno">  126</span>    lvl = 3;</div>
<div class="line"><span class="lineno">  127</span>  }</div>
<div class="line"><span class="lineno">  128</span>  <span class="keywordflow">return</span> lvl;</div>
<div class="line"><span class="lineno">  129</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="weights_8c_source.html#l00137">ie_weights_log_enabled()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="weights_8c_a42060a9aacf63543286684615cfc36fe_icgraph.svg" width="100%" height="511"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a522dac028ee37aae1307ffdb6d65ec1d" name="a522dac028ee37aae1307ffdb6d65ec1d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a522dac028ee37aae1307ffdb6d65ec1d">&#9670;&#160;</a></span>ie_weights_open()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ie_weights_open </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>json_path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>bin_path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ie__io_8h.html#af68ad3cdc2eb244fe4feed94372d7806">ie_weights_t</a> *&#160;</td>
          <td class="paramname"><em>out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Open and parse an IEBIN v1 model description. </p>
<p>This function:</p><ul>
<li>reads model.ie.json,</li>
<li>parses minimal metadata (version, dtype),</li>
<li>resolves the path to model.ie.bin using overrides and schema variants,</li>
<li>validates the weights binary size via stat(2),</li>
<li>optionally opens dedup artifacts when enabled.</li>
</ul>
<p>In all error cases, the output structure is left in a safe-to-close state.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">json_path</td><td>Path to model.ie.json. </td></tr>
    <tr><td class="paramname">bin_path</td><td>Optional override for the binary path (may be NULL). </td></tr>
    <tr><td class="paramname">out</td><td>Output weights descriptor. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>IE_IO_OK on success; negative ie_io_status_t on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="weights_8c_source.html#l00988">988</a> of file <a class="el" href="weights_8c_source.html">weights.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  988</span>                                                                                    {</div>
<div class="line"><span class="lineno">  989</span>  <span class="keywordflow">if</span> (!out) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239">IE_IO_ERR_ARGS</a>;</div>
<div class="line"><span class="lineno">  990</span>  memset(out, 0, <span class="keyword">sizeof</span>(*out));</div>
<div class="line"><span class="lineno">  991</span> </div>
<div class="line"><span class="lineno">  992</span>  <span class="keywordflow">if</span> (!json_path || !*json_path) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239">IE_IO_ERR_ARGS</a>;</div>
<div class="line"><span class="lineno">  993</span>  <a class="code hl_function" href="weights_8c.html#ae3307b59271742c37862abf0b9698d23">cpyz</a>(<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;json_path, <span class="keyword">sizeof</span>(<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;json_path), json_path);</div>
<div class="line"><span class="lineno">  994</span> </div>
<div class="line"><span class="lineno">  995</span>  <a class="code hl_define" href="weights_8c.html#a752563692fdfae65274bd2bf13be1661">WLOGI</a>(<span class="stringliteral">&quot;ie_weights_open: begin json_path=&#39;%s&#39; bin_override=&#39;%s&#39;&quot;</span>, json_path,</div>
<div class="line"><span class="lineno">  996</span>        (bin_path &amp;&amp; *bin_path) ? bin_path : <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"><span class="lineno">  997</span> </div>
<div class="line"><span class="lineno">  998</span>  <span class="keywordtype">char</span> *jbuf = NULL;</div>
<div class="line"><span class="lineno">  999</span>  <span class="keywordtype">size_t</span> jlen = 0;</div>
<div class="line"><span class="lineno"> 1000</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="weights_8c.html#a7d467c1ab0baceed9b0fdad7b5a8accf">read_all_text</a>(json_path, &amp;jbuf, &amp;jlen) != 0 || !jbuf || jlen == 0) {</div>
<div class="line"><span class="lineno"> 1001</span>    <a class="code hl_define" href="weights_8c.html#af8239319fc44fa28e836591e9ac89c02">WLOGE</a>(<span class="stringliteral">&quot;ie_weights_open: failed to read json (path=&#39;%s&#39;)&quot;</span>, json_path);</div>
<div class="line"><span class="lineno"> 1002</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9">IE_IO_ERR_JSON</a>;</div>
<div class="line"><span class="lineno"> 1003</span>  }</div>
<div class="line"><span class="lineno"> 1004</span>  <a class="code hl_define" href="weights_8c.html#a2243a7a621a65f66170ede427763ee2d">WLOGD</a>(<span class="stringliteral">&quot;ie_weights_open: loaded json bytes=%zu&quot;</span>, jlen);</div>
<div class="line"><span class="lineno"> 1005</span> </div>
<div class="line"><span class="lineno"> 1006</span>  <span class="keywordtype">int</span> ver = 0;</div>
<div class="line"><span class="lineno"> 1007</span>  <span class="keywordtype">int</span> found_ver = <a class="code hl_function" href="weights_8c.html#a5c6ba72035c0c5110c91879350c8647f">scan_json_key_int</a>(jbuf, <span class="stringliteral">&quot;version&quot;</span>, &amp;ver);</div>
<div class="line"><span class="lineno"> 1008</span>  <span class="keywordflow">if</span> (ver &lt;= 0) ver = 1;</div>
<div class="line"><span class="lineno"> 1009</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;version = ver;</div>
<div class="line"><span class="lineno"> 1010</span> </div>
<div class="line"><span class="lineno"> 1011</span>  <span class="keywordtype">char</span> dtype[16];</div>
<div class="line"><span class="lineno"> 1012</span>  dtype[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 1013</span>  (void)<a class="code hl_function" href="weights_8c.html#a3c438658d11f74ba4af8273c7e390311">scan_json_key_string</a>(jbuf, <span class="stringliteral">&quot;dtype&quot;</span>, dtype, <span class="keyword">sizeof</span>(dtype));</div>
<div class="line"><span class="lineno"> 1014</span>  <span class="keywordflow">if</span> (dtype[0] == <span class="charliteral">&#39;\0&#39;</span>) <a class="code hl_function" href="weights_8c.html#ae3307b59271742c37862abf0b9698d23">cpyz</a>(dtype, <span class="keyword">sizeof</span>(dtype), <span class="stringliteral">&quot;float32&quot;</span>);</div>
<div class="line"><span class="lineno"> 1015</span>  <a class="code hl_function" href="weights_8c.html#ae3307b59271742c37862abf0b9698d23">cpyz</a>(<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;dtype, <span class="keyword">sizeof</span>(<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;dtype), dtype);</div>
<div class="line"><span class="lineno"> 1016</span> </div>
<div class="line"><span class="lineno"> 1017</span>  <a class="code hl_define" href="weights_8c.html#a752563692fdfae65274bd2bf13be1661">WLOGI</a>(<span class="stringliteral">&quot;ie_weights_open: parsed version=%d (found=%d) dtype=&#39;%s&#39;&quot;</span>, <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;version, found_ver,</div>
<div class="line"><span class="lineno"> 1018</span>        <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;dtype);</div>
<div class="line"><span class="lineno"> 1019</span> </div>
<div class="line"><span class="lineno"> 1020</span>  <span class="keywordtype">char</span> resolved_bin[512];</div>
<div class="line"><span class="lineno"> 1021</span>  resolved_bin[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 1022</span> </div>
<div class="line"><span class="lineno"> 1023</span>  <span class="comment">/* Priority order:</span></div>
<div class="line"><span class="lineno"> 1024</span><span class="comment">   *  1) explicit bin_path parameter</span></div>
<div class="line"><span class="lineno"> 1025</span><span class="comment">   *  2) IE_WEIGHTS_BIN env override</span></div>
<div class="line"><span class="lineno"> 1026</span><span class="comment">   *  3) JSON keys (bin / weights_bin / nested weights{bin} / iebin{bin})</span></div>
<div class="line"><span class="lineno"> 1027</span><span class="comment">   *  4) fallback: sibling &#39;model.ie.bin&#39; next to json_path</span></div>
<div class="line"><span class="lineno"> 1028</span><span class="comment">   */</span></div>
<div class="line"><span class="lineno"> 1029</span>  <span class="keywordflow">if</span> (bin_path &amp;&amp; *bin_path) {</div>
<div class="line"><span class="lineno"> 1030</span>    <a class="code hl_function" href="weights_8c.html#ae3307b59271742c37862abf0b9698d23">cpyz</a>(resolved_bin, <span class="keyword">sizeof</span>(resolved_bin), bin_path);</div>
<div class="line"><span class="lineno"> 1031</span>    <a class="code hl_define" href="weights_8c.html#a752563692fdfae65274bd2bf13be1661">WLOGI</a>(<span class="stringliteral">&quot;ie_weights_open: using bin override (arg) path=&#39;%s&#39;&quot;</span>, resolved_bin);</div>
<div class="line"><span class="lineno"> 1032</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1033</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *env_bin = getenv(<span class="stringliteral">&quot;IE_WEIGHTS_BIN&quot;</span>);</div>
<div class="line"><span class="lineno"> 1034</span>    <span class="keywordflow">if</span> (env_bin &amp;&amp; *env_bin) {</div>
<div class="line"><span class="lineno"> 1035</span>      <a class="code hl_function" href="weights_8c.html#ae3307b59271742c37862abf0b9698d23">cpyz</a>(resolved_bin, <span class="keyword">sizeof</span>(resolved_bin), env_bin);</div>
<div class="line"><span class="lineno"> 1036</span>      <a class="code hl_define" href="weights_8c.html#a752563692fdfae65274bd2bf13be1661">WLOGI</a>(<span class="stringliteral">&quot;ie_weights_open: using bin override (env IE_WEIGHTS_BIN) path=&#39;%s&#39;&quot;</span>, resolved_bin);</div>
<div class="line"><span class="lineno"> 1037</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1038</span>      <span class="keywordtype">char</span> bin_key[256];</div>
<div class="line"><span class="lineno"> 1039</span>      bin_key[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 1040</span> </div>
<div class="line"><span class="lineno"> 1041</span>      <span class="keyword">const</span> <span class="keywordtype">int</span> found_bin_key = <a class="code hl_function" href="weights_8c.html#a3c6343a4152588f4f490f3263842c7f6">scan_json_best_effort_bin</a>(jbuf, bin_key, <span class="keyword">sizeof</span>(bin_key));</div>
<div class="line"><span class="lineno"> 1042</span>      <span class="keywordflow">if</span> (found_bin_key == 1 &amp;&amp; bin_key[0] != <span class="charliteral">&#39;\0&#39;</span>) {</div>
<div class="line"><span class="lineno"> 1043</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *slash = <a class="code hl_function" href="weights_8c.html#a7415d89bc8bd657819e06ac0fc53da95">last_slash</a>(json_path);</div>
<div class="line"><span class="lineno"> 1044</span>        <span class="keywordflow">if</span> (slash) {</div>
<div class="line"><span class="lineno"> 1045</span>          <span class="keywordtype">char</span> dir[512];</div>
<div class="line"><span class="lineno"> 1046</span>          <span class="keywordtype">size_t</span> dn = (size_t)(slash - json_path);</div>
<div class="line"><span class="lineno"> 1047</span>          <span class="keywordflow">if</span> (dn &gt;= <span class="keyword">sizeof</span>(dir)) dn = <span class="keyword">sizeof</span>(dir) - 1;</div>
<div class="line"><span class="lineno"> 1048</span>          memcpy(dir, json_path, dn);</div>
<div class="line"><span class="lineno"> 1049</span>          dir[dn] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 1050</span>          <a class="code hl_function" href="weights_8c.html#a7bb1dd9958b072fc5d1a80373cc074ff">join_path</a>(resolved_bin, <span class="keyword">sizeof</span>(resolved_bin), dir, bin_key);</div>
<div class="line"><span class="lineno"> 1051</span>          <a class="code hl_define" href="weights_8c.html#a752563692fdfae65274bd2bf13be1661">WLOGI</a>(<span class="stringliteral">&quot;ie_weights_open: resolved bin from json key=&#39;%s&#39; dir=&#39;%s&#39; =&gt; &#39;%s&#39;&quot;</span>, bin_key, dir,</div>
<div class="line"><span class="lineno"> 1052</span>                resolved_bin);</div>
<div class="line"><span class="lineno"> 1053</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1054</span>          <a class="code hl_function" href="weights_8c.html#ae3307b59271742c37862abf0b9698d23">cpyz</a>(resolved_bin, <span class="keyword">sizeof</span>(resolved_bin), bin_key);</div>
<div class="line"><span class="lineno"> 1055</span>          <a class="code hl_define" href="weights_8c.html#a752563692fdfae65274bd2bf13be1661">WLOGI</a>(<span class="stringliteral">&quot;ie_weights_open: resolved bin from json key=&#39;%s&#39; =&gt; &#39;%s&#39;&quot;</span>, bin_key, resolved_bin);</div>
<div class="line"><span class="lineno"> 1056</span>        }</div>
<div class="line"><span class="lineno"> 1057</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1058</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *slash = <a class="code hl_function" href="weights_8c.html#a7415d89bc8bd657819e06ac0fc53da95">last_slash</a>(json_path);</div>
<div class="line"><span class="lineno"> 1059</span>        <span class="keywordtype">char</span> dir[512];</div>
<div class="line"><span class="lineno"> 1060</span>        dir[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 1061</span>        <span class="keywordflow">if</span> (slash) {</div>
<div class="line"><span class="lineno"> 1062</span>          <span class="keywordtype">size_t</span> dn = (size_t)(slash - json_path);</div>
<div class="line"><span class="lineno"> 1063</span>          <span class="keywordflow">if</span> (dn &gt;= <span class="keyword">sizeof</span>(dir)) dn = <span class="keyword">sizeof</span>(dir) - 1;</div>
<div class="line"><span class="lineno"> 1064</span>          memcpy(dir, json_path, dn);</div>
<div class="line"><span class="lineno"> 1065</span>          dir[dn] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 1066</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1067</span>          <a class="code hl_function" href="weights_8c.html#ae3307b59271742c37862abf0b9698d23">cpyz</a>(dir, <span class="keyword">sizeof</span>(dir), <span class="stringliteral">&quot;.&quot;</span>);</div>
<div class="line"><span class="lineno"> 1068</span>        }</div>
<div class="line"><span class="lineno"> 1069</span> </div>
<div class="line"><span class="lineno"> 1070</span>        <span class="keywordtype">char</span> fallback[512];</div>
<div class="line"><span class="lineno"> 1071</span>        fallback[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 1072</span>        <a class="code hl_function" href="weights_8c.html#a7bb1dd9958b072fc5d1a80373cc074ff">join_path</a>(fallback, <span class="keyword">sizeof</span>(fallback), dir, <span class="stringliteral">&quot;model.ie.bin&quot;</span>);</div>
<div class="line"><span class="lineno"> 1073</span> </div>
<div class="line"><span class="lineno"> 1074</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="weights_8c.html#a8adb51cd6c239a9589d4d66cd0cf989e">file_exists_readable</a>(fallback)) {</div>
<div class="line"><span class="lineno"> 1075</span>          <a class="code hl_function" href="weights_8c.html#ae3307b59271742c37862abf0b9698d23">cpyz</a>(resolved_bin, <span class="keyword">sizeof</span>(resolved_bin), fallback);</div>
<div class="line"><span class="lineno"> 1076</span>          <a class="code hl_define" href="weights_8c.html#a92c7e58c96077a0c401dbfd6c4196f1a">WLOGW</a>(</div>
<div class="line"><span class="lineno"> 1077</span>              <span class="stringliteral">&quot;ie_weights_open: JSON did not specify weights bin path; defaulting to sibling &quot;</span></div>
<div class="line"><span class="lineno"> 1078</span>              <span class="stringliteral">&quot;model.ie.bin path=&#39;%s&#39;&quot;</span>,</div>
<div class="line"><span class="lineno"> 1079</span>              resolved_bin);</div>
<div class="line"><span class="lineno"> 1080</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1081</span>          <a class="code hl_define" href="weights_8c.html#af8239319fc44fa28e836591e9ac89c02">WLOGE</a>(<span class="stringliteral">&quot;ie_weights_open: missing weights bin path in JSON (no known key matched)&quot;</span>);</div>
<div class="line"><span class="lineno"> 1082</span>          <a class="code hl_define" href="weights_8c.html#af8239319fc44fa28e836591e9ac89c02">WLOGE</a>(<span class="stringliteral">&quot;ie_weights_open: also missing fallback sibling path=&#39;%s&#39;&quot;</span>, fallback);</div>
<div class="line"><span class="lineno"> 1083</span>          free(jbuf);</div>
<div class="line"><span class="lineno"> 1084</span>          <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a66046f2226981286e47bb2f33ab56862">IE_IO_ERR_BIN_UNSPEC</a>;</div>
<div class="line"><span class="lineno"> 1085</span>        }</div>
<div class="line"><span class="lineno"> 1086</span>      }</div>
<div class="line"><span class="lineno"> 1087</span>    }</div>
<div class="line"><span class="lineno"> 1088</span>  }</div>
<div class="line"><span class="lineno"> 1089</span> </div>
<div class="line"><span class="lineno"> 1090</span>  <a class="code hl_function" href="weights_8c.html#ae3307b59271742c37862abf0b9698d23">cpyz</a>(<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;weights_path, <span class="keyword">sizeof</span>(<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;weights_path), resolved_bin);</div>
<div class="line"><span class="lineno"> 1091</span> </div>
<div class="line"><span class="lineno"> 1092</span>  <span class="keyword">struct </span>stat st;</div>
<div class="line"><span class="lineno"> 1093</span>  <span class="keywordflow">if</span> (stat(<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;weights_path, &amp;st) != 0 || st.st_size &lt; 0) {</div>
<div class="line"><span class="lineno"> 1094</span>    <a class="code hl_function" href="weights_8c.html#a88ec341995312abc5fbbd4084389523e">wlog_errno_</a>(<span class="stringliteral">&quot;stat&quot;</span>, <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;weights_path);</div>
<div class="line"><span class="lineno"> 1095</span>    <a class="code hl_define" href="weights_8c.html#af8239319fc44fa28e836591e9ac89c02">WLOGE</a>(<span class="stringliteral">&quot;ie_weights_open: weights binary not accessible path=&#39;%s&#39;&quot;</span>, <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;weights_path);</div>
<div class="line"><span class="lineno"> 1096</span>    free(jbuf);</div>
<div class="line"><span class="lineno"> 1097</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a82517853bf5084320fad8c88f67d29bb">IE_IO_ERR_STAT</a>;</div>
<div class="line"><span class="lineno"> 1098</span>  }</div>
<div class="line"><span class="lineno"> 1099</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;bin_size_bytes = (size_t)st.st_size;</div>
<div class="line"><span class="lineno"> 1100</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;loaded = 1;</div>
<div class="line"><span class="lineno"> 1101</span> </div>
<div class="line"><span class="lineno"> 1102</span>  <a class="code hl_define" href="weights_8c.html#a752563692fdfae65274bd2bf13be1661">WLOGI</a>(<span class="stringliteral">&quot;ie_weights_open: weights binary ok path=&#39;%s&#39; size_bytes=%zu&quot;</span>, <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;weights_path,</div>
<div class="line"><span class="lineno"> 1103</span>        <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;bin_size_bytes);</div>
<div class="line"><span class="lineno"> 1104</span> </div>
<div class="line"><span class="lineno"> 1105</span><span class="preprocessor">#if (IE_WEIGHTS_HAS_DEDUP_FIELDS == 1)</span></div>
<div class="line"><span class="lineno"> 1106</span>  {</div>
<div class="line"><span class="lineno"> 1107</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> dedup_enabled = <a class="code hl_function" href="weights_8c.html#a93c92a71a0cf18f3eea8623ea9524d54">env_flag_get</a>(<span class="stringliteral">&quot;IE_DEDUP&quot;</span>, 0);</div>
<div class="line"><span class="lineno"> 1108</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> dedup_strict = <a class="code hl_function" href="weights_8c.html#a93c92a71a0cf18f3eea8623ea9524d54">env_flag_get</a>(<span class="stringliteral">&quot;IE_DEDUP_STRICT&quot;</span>, 0);</div>
<div class="line"><span class="lineno"> 1109</span> </div>
<div class="line"><span class="lineno"> 1110</span>    <a class="code hl_define" href="weights_8c.html#a2243a7a621a65f66170ede427763ee2d">WLOGD</a>(<span class="stringliteral">&quot;ie_weights_open: dedup flags IE_DEDUP=%d IE_DEDUP_STRICT=%d&quot;</span>, dedup_enabled,</div>
<div class="line"><span class="lineno"> 1111</span>          dedup_strict);</div>
<div class="line"><span class="lineno"> 1112</span> </div>
<div class="line"><span class="lineno"> 1113</span>    <span class="keywordflow">if</span> (dedup_enabled) {</div>
<div class="line"><span class="lineno"> 1114</span>      <span class="keyword">const</span> <span class="keywordtype">char</span> *slash = <a class="code hl_function" href="weights_8c.html#a7415d89bc8bd657819e06ac0fc53da95">last_slash</a>(json_path);</div>
<div class="line"><span class="lineno"> 1115</span>      <span class="keywordtype">char</span> dir[512];</div>
<div class="line"><span class="lineno"> 1116</span>      dir[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 1117</span>      <span class="keywordflow">if</span> (slash) {</div>
<div class="line"><span class="lineno"> 1118</span>        <span class="keywordtype">size_t</span> dn = (size_t)(slash - json_path);</div>
<div class="line"><span class="lineno"> 1119</span>        <span class="keywordflow">if</span> (dn &gt;= <span class="keyword">sizeof</span>(dir)) dn = <span class="keyword">sizeof</span>(dir) - 1;</div>
<div class="line"><span class="lineno"> 1120</span>        memcpy(dir, json_path, dn);</div>
<div class="line"><span class="lineno"> 1121</span>        dir[dn] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 1122</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1123</span>        <a class="code hl_function" href="weights_8c.html#ae3307b59271742c37862abf0b9698d23">cpyz</a>(dir, <span class="keyword">sizeof</span>(dir), <span class="stringliteral">&quot;.&quot;</span>);</div>
<div class="line"><span class="lineno"> 1124</span>      }</div>
<div class="line"><span class="lineno"> 1125</span> </div>
<div class="line"><span class="lineno"> 1126</span>      <span class="keywordtype">char</span> dedup_json[512];</div>
<div class="line"><span class="lineno"> 1127</span>      dedup_json[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 1128</span>      <a class="code hl_function" href="weights_8c.html#a7bb1dd9958b072fc5d1a80373cc074ff">join_path</a>(dedup_json, <span class="keyword">sizeof</span>(dedup_json), dir, <span class="stringliteral">&quot;model.dedup.json&quot;</span>);</div>
<div class="line"><span class="lineno"> 1129</span> </div>
<div class="line"><span class="lineno"> 1130</span>      <span class="keywordflow">if</span> (!<a class="code hl_function" href="weights_8c.html#a8adb51cd6c239a9589d4d66cd0cf989e">file_exists_readable</a>(dedup_json)) {</div>
<div class="line"><span class="lineno"> 1131</span>        <a class="code hl_define" href="weights_8c.html#a752563692fdfae65274bd2bf13be1661">WLOGI</a>(<span class="stringliteral">&quot;ie_weights_open: dedup enabled but model.dedup.json missing; attempting link&quot;</span>);</div>
<div class="line"><span class="lineno"> 1132</span>        (void)<a class="code hl_function" href="weights_8c.html#a5b123cfce35efe0ac7475c10419f9373">ensure_dedup_manifest_link</a>(dir);</div>
<div class="line"><span class="lineno"> 1133</span>      }</div>
<div class="line"><span class="lineno"> 1134</span> </div>
<div class="line"><span class="lineno"> 1135</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="weights_8c.html#a8adb51cd6c239a9589d4d66cd0cf989e">file_exists_readable</a>(dedup_json)) {</div>
<div class="line"><span class="lineno"> 1136</span>        <a class="code hl_struct" href="structie__weights__dedup__opts__t.html">ie_weights_dedup_opts_t</a> opts;</div>
<div class="line"><span class="lineno"> 1137</span>        memset(&amp;opts, 0, <span class="keyword">sizeof</span>(opts));</div>
<div class="line"><span class="lineno"> 1138</span>        opts.<a class="code hl_variable" href="structie__weights__dedup__opts__t.html#a86ae82fb8029f319a275251de5918035">prefault_policy</a> = 0;</div>
<div class="line"><span class="lineno"> 1139</span> </div>
<div class="line"><span class="lineno"> 1140</span>        <a class="code hl_struct" href="structie__weights__dedup.html">ie_weights_dedup_t</a> *dh = NULL;</div>
<div class="line"><span class="lineno"> 1141</span>        <a class="code hl_enumeration" href="weights__dedup_8h.html#a58857f75f23e827eb7a07572c0b93f2f">ie_wdedup_status_t</a> <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a415d14a7ade776b6bb2e544f0be25e6b">dst</a> = <a class="code hl_function" href="weights__dedup_8h.html#aa625b41ce2a24826f8cb464661ace8ec">ie_weights_dedup_open</a>(&amp;dh, dir, &amp;opts);</div>
<div class="line"><span class="lineno"> 1142</span>        <span class="keywordflow">if</span> (dst == <a class="code hl_enumvalue" href="weights__dedup_8h.html#a58857f75f23e827eb7a07572c0b93f2fa0baf1bf45e91e9558e44038d27d20e2f">IE_WDEDUP_OK</a> &amp;&amp; dh) {</div>
<div class="line"><span class="lineno"> 1143</span>          <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;is_dedup = 1;</div>
<div class="line"><span class="lineno"> 1144</span>          <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;dedup_handle = (<span class="keywordtype">void</span> *)dh;</div>
<div class="line"><span class="lineno"> 1145</span>          <a class="code hl_define" href="weights_8c.html#a752563692fdfae65274bd2bf13be1661">WLOGI</a>(<span class="stringliteral">&quot;ie_weights_open: dedup artifacts opened (dir=&#39;%s&#39;)&quot;</span>, dir);</div>
<div class="line"><span class="lineno"> 1146</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1147</span>          <a class="code hl_define" href="weights_8c.html#a92c7e58c96077a0c401dbfd6c4196f1a">WLOGW</a>(<span class="stringliteral">&quot;ie_weights_open: dedup open failed (status=%d dir=&#39;%s&#39;)&quot;</span>, (<span class="keywordtype">int</span>)dst, dir);</div>
<div class="line"><span class="lineno"> 1148</span>          <span class="keywordflow">if</span> (dedup_strict) {</div>
<div class="line"><span class="lineno"> 1149</span>            <a class="code hl_define" href="weights_8c.html#af8239319fc44fa28e836591e9ac89c02">WLOGE</a>(<span class="stringliteral">&quot;ie_weights_open: dedup strict mode: failing open&quot;</span>);</div>
<div class="line"><span class="lineno"> 1150</span>            free(jbuf);</div>
<div class="line"><span class="lineno"> 1151</span>            <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9">IE_IO_ERR_JSON</a>;</div>
<div class="line"><span class="lineno"> 1152</span>          }</div>
<div class="line"><span class="lineno"> 1153</span>          <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;is_dedup = 0;</div>
<div class="line"><span class="lineno"> 1154</span>          <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;dedup_handle = NULL;</div>
<div class="line"><span class="lineno"> 1155</span>        }</div>
<div class="line"><span class="lineno"> 1156</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1157</span>        <a class="code hl_define" href="weights_8c.html#a92c7e58c96077a0c401dbfd6c4196f1a">WLOGW</a>(<span class="stringliteral">&quot;ie_weights_open: dedup enabled but model.dedup.json still missing (dir=&#39;%s&#39;)&quot;</span>, dir);</div>
<div class="line"><span class="lineno"> 1158</span>        <span class="keywordflow">if</span> (dedup_strict) {</div>
<div class="line"><span class="lineno"> 1159</span>          <a class="code hl_define" href="weights_8c.html#af8239319fc44fa28e836591e9ac89c02">WLOGE</a>(<span class="stringliteral">&quot;ie_weights_open: dedup strict mode: failing open&quot;</span>);</div>
<div class="line"><span class="lineno"> 1160</span>          free(jbuf);</div>
<div class="line"><span class="lineno"> 1161</span>          <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9">IE_IO_ERR_JSON</a>;</div>
<div class="line"><span class="lineno"> 1162</span>        }</div>
<div class="line"><span class="lineno"> 1163</span>      }</div>
<div class="line"><span class="lineno"> 1164</span>    }</div>
<div class="line"><span class="lineno"> 1165</span>  }</div>
<div class="line"><span class="lineno"> 1166</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1167</span> </div>
<div class="line"><span class="lineno"> 1168</span>  free(jbuf);</div>
<div class="line"><span class="lineno"> 1169</span>  <a class="code hl_define" href="weights_8c.html#a752563692fdfae65274bd2bf13be1661">WLOGI</a>(<span class="stringliteral">&quot;ie_weights_open: success&quot;</span>);</div>
<div class="line"><span class="lineno"> 1170</span>  <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>;</div>
<div class="line"><span class="lineno"> 1171</span>}</div>
<div class="ttc" id="aie__io_8h_html_a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239"><div class="ttname"><a href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239">IE_IO_ERR_ARGS</a></div><div class="ttdeci">@ IE_IO_ERR_ARGS</div><div class="ttdoc">Invalid arguments.</div><div class="ttdef"><b>Definition</b> <a href="ie__io_8h_source.html#l00065">ie_io.h:65</a></div></div>
<div class="ttc" id="aie__io_8h_html_a4c501870bd45dbe373416745a03de987a66046f2226981286e47bb2f33ab56862"><div class="ttname"><a href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a66046f2226981286e47bb2f33ab56862">IE_IO_ERR_BIN_UNSPEC</a></div><div class="ttdeci">@ IE_IO_ERR_BIN_UNSPEC</div><div class="ttdoc">Binary path unspecified and not inferable.</div><div class="ttdef"><b>Definition</b> <a href="ie__io_8h_source.html#l00067">ie_io.h:67</a></div></div>
<div class="ttc" id="aie__io_8h_html_a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d"><div class="ttname"><a href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a></div><div class="ttdeci">@ IE_IO_OK</div><div class="ttdoc">Success.</div><div class="ttdef"><b>Definition</b> <a href="ie__io_8h_source.html#l00064">ie_io.h:64</a></div></div>
<div class="ttc" id="aie__io_8h_html_a4c501870bd45dbe373416745a03de987a82517853bf5084320fad8c88f67d29bb"><div class="ttname"><a href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a82517853bf5084320fad8c88f67d29bb">IE_IO_ERR_STAT</a></div><div class="ttdeci">@ IE_IO_ERR_STAT</div><div class="ttdoc">stat(2) failure or invalid file metadata.</div><div class="ttdef"><b>Definition</b> <a href="ie__io_8h_source.html#l00068">ie_io.h:68</a></div></div>
<div class="ttc" id="aie__io_8h_html_a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9"><div class="ttname"><a href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9">IE_IO_ERR_JSON</a></div><div class="ttdeci">@ IE_IO_ERR_JSON</div><div class="ttdoc">JSON parse failure or missing required fields.</div><div class="ttdef"><b>Definition</b> <a href="ie__io_8h_source.html#l00066">ie_io.h:66</a></div></div>
<div class="ttc" id="anamespaceconvert__dtypes__to__numeric_html_a0332296ea5bde95f8e72005df06144a8"><div class="ttname"><a href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">convert_dtypes_to_numeric.out</a></div><div class="ttdeci">dict out</div><div class="ttdef"><b>Definition</b> <a href="convert__dtypes__to__numeric_8py_source.html#l00029">convert_dtypes_to_numeric.py:29</a></div></div>
<div class="ttc" id="astructie__weights__dedup__opts__t_html"><div class="ttname"><a href="structie__weights__dedup__opts__t.html">ie_weights_dedup_opts_t</a></div><div class="ttdoc">Loader options.</div><div class="ttdef"><b>Definition</b> <a href="weights__dedup_8h_source.html#l00091">weights_dedup.h:91</a></div></div>
<div class="ttc" id="astructie__weights__dedup__opts__t_html_a86ae82fb8029f319a275251de5918035"><div class="ttname"><a href="structie__weights__dedup__opts__t.html#a86ae82fb8029f319a275251de5918035">ie_weights_dedup_opts_t::prefault_policy</a></div><div class="ttdeci">int prefault_policy</div><div class="ttdoc">Prefault policy for mmapped blobs: 0 = none, 1 = sequential, 2 = will-need.</div><div class="ttdef"><b>Definition</b> <a href="weights__dedup_8h_source.html#l00098">weights_dedup.h:98</a></div></div>
<div class="ttc" id="aweights_8c_html_a3c438658d11f74ba4af8273c7e390311"><div class="ttname"><a href="weights_8c.html#a3c438658d11f74ba4af8273c7e390311">scan_json_key_string</a></div><div class="ttdeci">static int scan_json_key_string(const char *json, const char *key, char *dst, size_t dstsz)</div><div class="ttdoc">Scan a relaxed JSON blob for a string value at a given key.</div><div class="ttdef"><b>Definition</b> <a href="weights_8c_source.html#l00467">weights.c:467</a></div></div>
<div class="ttc" id="aweights_8c_html_a3c6343a4152588f4f490f3263842c7f6"><div class="ttname"><a href="weights_8c.html#a3c6343a4152588f4f490f3263842c7f6">scan_json_best_effort_bin</a></div><div class="ttdeci">static int scan_json_best_effort_bin(const char *json, char *dst, size_t dstsz)</div><div class="ttdoc">Try multiple schema variants to locate the weights binary path.</div><div class="ttdef"><b>Definition</b> <a href="weights_8c_source.html#l00643">weights.c:643</a></div></div>
<div class="ttc" id="aweights_8c_html_a5b123cfce35efe0ac7475c10419f9373"><div class="ttname"><a href="weights_8c.html#a5b123cfce35efe0ac7475c10419f9373">ensure_dedup_manifest_link</a></div><div class="ttdeci">static int ensure_dedup_manifest_link(const char *dir)</div><div class="ttdef"><b>Definition</b> <a href="weights_8c_source.html#l00867">weights.c:867</a></div></div>
<div class="ttc" id="aweights_8c_html_a5c6ba72035c0c5110c91879350c8647f"><div class="ttname"><a href="weights_8c.html#a5c6ba72035c0c5110c91879350c8647f">scan_json_key_int</a></div><div class="ttdeci">static int scan_json_key_int(const char *json, const char *key, int *out_val)</div><div class="ttdoc">Scan a relaxed JSON blob for an integer value at a given key.</div><div class="ttdef"><b>Definition</b> <a href="weights_8c_source.html#l00374">weights.c:374</a></div></div>
<div class="ttc" id="aweights_8c_html_a7415d89bc8bd657819e06ac0fc53da95"><div class="ttname"><a href="weights_8c.html#a7415d89bc8bd657819e06ac0fc53da95">last_slash</a></div><div class="ttdeci">static const char * last_slash(const char *p)</div><div class="ttdoc">Return a pointer to the last '/' in a path, or NULL if none.</div><div class="ttdef"><b>Definition</b> <a href="weights_8c_source.html#l00225">weights.c:225</a></div></div>
<div class="ttc" id="aweights_8c_html_a93c92a71a0cf18f3eea8623ea9524d54"><div class="ttname"><a href="weights_8c.html#a93c92a71a0cf18f3eea8623ea9524d54">env_flag_get</a></div><div class="ttdeci">static int env_flag_get(const char *name, int default_value)</div><div class="ttdoc">Parse environment flag-like strings into a boolean.</div><div class="ttdef"><b>Definition</b> <a href="weights_8c_source.html#l00759">weights.c:759</a></div></div>
<div class="ttc" id="aweights_8c_html_af8239319fc44fa28e836591e9ac89c02"><div class="ttname"><a href="weights_8c.html#af8239319fc44fa28e836591e9ac89c02">WLOGE</a></div><div class="ttdeci">#define WLOGE(...)</div><div class="ttdoc">Emit an error log if error logging is enabled.</div><div class="ttdef"><b>Definition</b> <a href="weights_8c_source.html#l00163">weights.c:163</a></div></div>
<div class="ttc" id="aweights__dedup_8h_html_a58857f75f23e827eb7a07572c0b93f2f"><div class="ttname"><a href="weights__dedup_8h.html#a58857f75f23e827eb7a07572c0b93f2f">ie_wdedup_status_t</a></div><div class="ttdeci">ie_wdedup_status_t</div><div class="ttdoc">Error/status codes for the dedup loader.</div><div class="ttdef"><b>Definition</b> <a href="weights__dedup_8h_source.html#l00034">weights_dedup.h:34</a></div></div>
<div class="ttc" id="aweights__dedup_8h_html_a58857f75f23e827eb7a07572c0b93f2fa0baf1bf45e91e9558e44038d27d20e2f"><div class="ttname"><a href="weights__dedup_8h.html#a58857f75f23e827eb7a07572c0b93f2fa0baf1bf45e91e9558e44038d27d20e2f">IE_WDEDUP_OK</a></div><div class="ttdeci">@ IE_WDEDUP_OK</div><div class="ttdef"><b>Definition</b> <a href="weights__dedup_8h_source.html#l00035">weights_dedup.h:35</a></div></div>
<div class="ttc" id="aweights__dedup_8h_html_aa625b41ce2a24826f8cb464661ace8ec"><div class="ttname"><a href="weights__dedup_8h.html#aa625b41ce2a24826f8cb464661ace8ec">ie_weights_dedup_open</a></div><div class="ttdeci">ie_wdedup_status_t ie_weights_dedup_open(ie_weights_dedup_t **out, const char *model_dir, const ie_weights_dedup_opts_t *opts)</div><div class="ttdoc">Open the dedup weights loader from a model directory.</div><div class="ttdef"><b>Definition</b> <a href="weights__dedup_8c_source.html#l01055">weights_dedup.c:1055</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="weights_8c_source.html#l00207">cpyz()</a>, <a class="el" href="weights_8c_source.html#l00867">ensure_dedup_manifest_link()</a>, <a class="el" href="weights_8c_source.html#l00759">env_flag_get()</a>, <a class="el" href="weights_8c_source.html#l00775">file_exists_readable()</a>, <a class="el" href="ie__io_8h_source.html#l00065">IE_IO_ERR_ARGS</a>, <a class="el" href="ie__io_8h_source.html#l00067">IE_IO_ERR_BIN_UNSPEC</a>, <a class="el" href="ie__io_8h_source.html#l00066">IE_IO_ERR_JSON</a>, <a class="el" href="ie__io_8h_source.html#l00068">IE_IO_ERR_STAT</a>, <a class="el" href="ie__io_8h_source.html#l00064">IE_IO_OK</a>, <a class="el" href="weights__dedup_8h_source.html#l00035">IE_WDEDUP_OK</a>, <a class="el" href="weights__dedup_8c_source.html#l01055">ie_weights_dedup_open()</a>, <a class="el" href="weights_8c_source.html#l00247">join_path()</a>, <a class="el" href="weights_8c_source.html#l00225">last_slash()</a>, <a class="el" href="weights__dedup_8h_source.html#l00098">ie_weights_dedup_opts_t::prefault_policy</a>, <a class="el" href="weights_8c_source.html#l00297">read_all_text()</a>, <a class="el" href="weights_8c_source.html#l00643">scan_json_best_effort_bin()</a>, <a class="el" href="weights_8c_source.html#l00374">scan_json_key_int()</a>, <a class="el" href="weights_8c_source.html#l00467">scan_json_key_string()</a>, <a class="el" href="weights_8c_source.html#l00175">wlog_errno_()</a>, <a class="el" href="weights_8c_source.html#l00149">WLOGD</a>, <a class="el" href="weights_8c_source.html#l00163">WLOGE</a>, <a class="el" href="weights_8c_source.html#l00142">WLOGI</a>, and <a class="el" href="weights_8c_source.html#l00156">WLOGW</a>.</p>

<p class="reference">Referenced by <a class="el" href="ie__api_8c_source.html#l00535">ie_engine_create()</a>, <a class="el" href="main__infer_8c_source.html#l02362">main()</a>, <a class="el" href="test__weights_8c_source.html#l00143">main()</a>, and <a class="el" href="test__dedup__loader_8c_source.html#l00065">open_and_touch()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="weights_8c_a522dac028ee37aae1307ffdb6d65ec1d_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="weights_8c_a522dac028ee37aae1307ffdb6d65ec1d_icgraph.svg" width="426" height="184"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a095d7f59c4cba2b530bac039bca8b7a9" name="a095d7f59c4cba2b530bac039bca8b7a9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a095d7f59c4cba2b530bac039bca8b7a9">&#9670;&#160;</a></span>ie_weights_touch()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ie_weights_touch </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="ie__io_8h.html#af68ad3cdc2eb244fe4feed94372d7806">ie_weights_t</a> *&#160;</td>
          <td class="paramname"><em>w</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Touch the weights binary to verify readability and warm OS caches. </p>
<p>This performs small reads near the start and end of the binary. When dedup is enabled, also checks auxiliary dedup files.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">w</td><td>Opened weights descriptor. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>IE_IO_OK on success; negative ie_io_status_t on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="weights_8c_source.html#l01183">1183</a> of file <a class="el" href="weights_8c_source.html">weights.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1183</span>                                            {</div>
<div class="line"><span class="lineno"> 1184</span>  <span class="keywordflow">if</span> (!w || !w-&gt;<a class="code hl_variable" href="structie__weights__s.html#ab6a61099d0af4a47854d02dc4fef5b8f">weights_path</a>[0]) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239">IE_IO_ERR_ARGS</a>;</div>
<div class="line"><span class="lineno"> 1185</span> </div>
<div class="line"><span class="lineno"> 1186</span>  <a class="code hl_define" href="weights_8c.html#a752563692fdfae65274bd2bf13be1661">WLOGI</a>(<span class="stringliteral">&quot;ie_weights_touch: begin path=&#39;%s&#39; size_bytes=%zu&quot;</span>, w-&gt;<a class="code hl_variable" href="structie__weights__s.html#ab6a61099d0af4a47854d02dc4fef5b8f">weights_path</a>, w-&gt;<a class="code hl_variable" href="structie__weights__s.html#a19f9137cca00113908b495a70769805e">bin_size_bytes</a>);</div>
<div class="line"><span class="lineno"> 1187</span> </div>
<div class="line"><span class="lineno"> 1188</span>  <span class="keywordtype">int</span> fd = open(w-&gt;<a class="code hl_variable" href="structie__weights__s.html#ab6a61099d0af4a47854d02dc4fef5b8f">weights_path</a>, O_RDONLY);</div>
<div class="line"><span class="lineno"> 1189</span>  <span class="keywordflow">if</span> (fd &lt; 0) {</div>
<div class="line"><span class="lineno"> 1190</span>    <a class="code hl_function" href="weights_8c.html#a88ec341995312abc5fbbd4084389523e">wlog_errno_</a>(<span class="stringliteral">&quot;open&quot;</span>, w-&gt;<a class="code hl_variable" href="structie__weights__s.html#ab6a61099d0af4a47854d02dc4fef5b8f">weights_path</a>);</div>
<div class="line"><span class="lineno"> 1191</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aba0321da4352c7a61ea1bda842bb64d0">IE_IO_ERR_OPEN</a>;</div>
<div class="line"><span class="lineno"> 1192</span>  }</div>
<div class="line"><span class="lineno"> 1193</span> </div>
<div class="line"><span class="lineno"> 1194</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> buf[4096];</div>
<div class="line"><span class="lineno"> 1195</span>  ssize_t r1 = <a class="code hl_function" href="weights_8c.html#aabb19f4a5e5385962c6db57f611bb785">ie_pread</a>(fd, buf, <span class="keyword">sizeof</span>(buf), 0);</div>
<div class="line"><span class="lineno"> 1196</span>  ssize_t r2 = 0;</div>
<div class="line"><span class="lineno"> 1197</span>  <span class="keywordflow">if</span> (w-&gt;<a class="code hl_variable" href="structie__weights__s.html#a19f9137cca00113908b495a70769805e">bin_size_bytes</a> &gt; <span class="keyword">sizeof</span>(buf)) {</div>
<div class="line"><span class="lineno"> 1198</span>    off_t off = (off_t)(w-&gt;<a class="code hl_variable" href="structie__weights__s.html#a19f9137cca00113908b495a70769805e">bin_size_bytes</a> - <span class="keyword">sizeof</span>(buf));</div>
<div class="line"><span class="lineno"> 1199</span>    r2 = <a class="code hl_function" href="weights_8c.html#aabb19f4a5e5385962c6db57f611bb785">ie_pread</a>(fd, buf, <span class="keyword">sizeof</span>(buf), off);</div>
<div class="line"><span class="lineno"> 1200</span>  }</div>
<div class="line"><span class="lineno"> 1201</span>  close(fd);</div>
<div class="line"><span class="lineno"> 1202</span> </div>
<div class="line"><span class="lineno"> 1203</span>  <span class="keywordflow">if</span> (r1 &lt; 0 || r2 &lt; 0) {</div>
<div class="line"><span class="lineno"> 1204</span>    <a class="code hl_define" href="weights_8c.html#af8239319fc44fa28e836591e9ac89c02">WLOGE</a>(<span class="stringliteral">&quot;ie_weights_touch: read failed (r1=%zd r2=%zd) path=&#39;%s&#39;&quot;</span>, r1, r2, w-&gt;<a class="code hl_variable" href="structie__weights__s.html#ab6a61099d0af4a47854d02dc4fef5b8f">weights_path</a>);</div>
<div class="line"><span class="lineno"> 1205</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aa12fce48fd3eee2bd8a75dc61db150a7">IE_IO_ERR_READ</a>;</div>
<div class="line"><span class="lineno"> 1206</span>  }</div>
<div class="line"><span class="lineno"> 1207</span> </div>
<div class="line"><span class="lineno"> 1208</span>  <a class="code hl_define" href="weights_8c.html#a2243a7a621a65f66170ede427763ee2d">WLOGD</a>(<span class="stringliteral">&quot;ie_weights_touch: ok primary binary reads (r1=%zd r2=%zd)&quot;</span>, r1, r2);</div>
<div class="line"><span class="lineno"> 1209</span> </div>
<div class="line"><span class="lineno"> 1210</span><span class="preprocessor">#if (IE_WEIGHTS_HAS_DEDUP_FIELDS == 1)</span></div>
<div class="line"><span class="lineno"> 1211</span>  {</div>
<div class="line"><span class="lineno"> 1212</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> dedup_enabled = <a class="code hl_function" href="weights_8c.html#a93c92a71a0cf18f3eea8623ea9524d54">env_flag_get</a>(<span class="stringliteral">&quot;IE_DEDUP&quot;</span>, 0);</div>
<div class="line"><span class="lineno"> 1213</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> dedup_strict = <a class="code hl_function" href="weights_8c.html#a93c92a71a0cf18f3eea8623ea9524d54">env_flag_get</a>(<span class="stringliteral">&quot;IE_DEDUP_STRICT&quot;</span>, 0);</div>
<div class="line"><span class="lineno"> 1214</span> </div>
<div class="line"><span class="lineno"> 1215</span>    <a class="code hl_define" href="weights_8c.html#a2243a7a621a65f66170ede427763ee2d">WLOGD</a>(<span class="stringliteral">&quot;ie_weights_touch: dedup flags IE_DEDUP=%d IE_DEDUP_STRICT=%d&quot;</span>, dedup_enabled,</div>
<div class="line"><span class="lineno"> 1216</span>          dedup_strict);</div>
<div class="line"><span class="lineno"> 1217</span> </div>
<div class="line"><span class="lineno"> 1218</span>    <span class="keywordflow">if</span> (dedup_enabled) {</div>
<div class="line"><span class="lineno"> 1219</span>      <span class="keyword">const</span> <span class="keywordtype">char</span> *base = (w-&gt;<a class="code hl_variable" href="structie__weights__s.html#a6d4bef9e704edd817ee473eb2685cdd4">json_path</a>[0] ? w-&gt;<a class="code hl_variable" href="structie__weights__s.html#a6d4bef9e704edd817ee473eb2685cdd4">json_path</a> : w-&gt;<a class="code hl_variable" href="structie__weights__s.html#ab6a61099d0af4a47854d02dc4fef5b8f">weights_path</a>);</div>
<div class="line"><span class="lineno"> 1220</span>      <span class="keyword">const</span> <span class="keywordtype">char</span> *slash = <a class="code hl_function" href="weights_8c.html#a7415d89bc8bd657819e06ac0fc53da95">last_slash</a>(base);</div>
<div class="line"><span class="lineno"> 1221</span> </div>
<div class="line"><span class="lineno"> 1222</span>      <span class="keywordtype">char</span> dir[512];</div>
<div class="line"><span class="lineno"> 1223</span>      dir[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 1224</span>      <span class="keywordflow">if</span> (slash) {</div>
<div class="line"><span class="lineno"> 1225</span>        <span class="keywordtype">size_t</span> dn = (size_t)(slash - base);</div>
<div class="line"><span class="lineno"> 1226</span>        <span class="keywordflow">if</span> (dn &gt;= <span class="keyword">sizeof</span>(dir)) dn = <span class="keyword">sizeof</span>(dir) - 1;</div>
<div class="line"><span class="lineno"> 1227</span>        memcpy(dir, base, dn);</div>
<div class="line"><span class="lineno"> 1228</span>        dir[dn] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 1229</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1230</span>        <a class="code hl_function" href="weights_8c.html#ae3307b59271742c37862abf0b9698d23">cpyz</a>(dir, <span class="keyword">sizeof</span>(dir), <span class="stringliteral">&quot;.&quot;</span>);</div>
<div class="line"><span class="lineno"> 1231</span>      }</div>
<div class="line"><span class="lineno"> 1232</span> </div>
<div class="line"><span class="lineno"> 1233</span>      <span class="comment">/*</span></div>
<div class="line"><span class="lineno"> 1234</span><span class="comment">       * Touch dedup artifacts.</span></div>
<div class="line"><span class="lineno"> 1235</span><span class="comment">       *</span></div>
<div class="line"><span class="lineno"> 1236</span><span class="comment">       * Instead of hardcoding filenames, prefer reading relpaths from</span></div>
<div class="line"><span class="lineno"> 1237</span><span class="comment">       * model.dedup.json (it contains a files[] table).</span></div>
<div class="line"><span class="lineno"> 1238</span><span class="comment">       */</span></div>
<div class="line"><span class="lineno"> 1239</span>      <span class="keywordtype">char</span> dedup_manifest[512];</div>
<div class="line"><span class="lineno"> 1240</span>      dedup_manifest[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 1241</span>      <a class="code hl_function" href="weights_8c.html#a7bb1dd9958b072fc5d1a80373cc074ff">join_path</a>(dedup_manifest, <span class="keyword">sizeof</span>(dedup_manifest), dir, <span class="stringliteral">&quot;model.dedup.json&quot;</span>);</div>
<div class="line"><span class="lineno"> 1242</span> </div>
<div class="line"><span class="lineno"> 1243</span>      <span class="keywordflow">if</span> (!<a class="code hl_function" href="weights_8c.html#a8adb51cd6c239a9589d4d66cd0cf989e">file_exists_readable</a>(dedup_manifest)) {</div>
<div class="line"><span class="lineno"> 1244</span>        <a class="code hl_define" href="weights_8c.html#a752563692fdfae65274bd2bf13be1661">WLOGI</a>(<span class="stringliteral">&quot;ie_weights_touch: dedup enabled but model.dedup.json missing; attempting link&quot;</span>);</div>
<div class="line"><span class="lineno"> 1245</span>        (void)<a class="code hl_function" href="weights_8c.html#a5b123cfce35efe0ac7475c10419f9373">ensure_dedup_manifest_link</a>(dir);</div>
<div class="line"><span class="lineno"> 1246</span>      }</div>
<div class="line"><span class="lineno"> 1247</span> </div>
<div class="line"><span class="lineno"> 1248</span>      <span class="keywordtype">int</span> ok_manifest = <a class="code hl_function" href="weights_8c.html#ae3235e5160399c1e4465d1abf866571d">touch_file_small</a>(dedup_manifest);</div>
<div class="line"><span class="lineno"> 1249</span>      <span class="keywordtype">int</span> ok_all = ok_manifest;</div>
<div class="line"><span class="lineno"> 1250</span> </div>
<div class="line"><span class="lineno"> 1251</span>      <span class="keywordtype">char</span> *mjson = NULL;</div>
<div class="line"><span class="lineno"> 1252</span>      <span class="keywordtype">size_t</span> mlen = 0;</div>
<div class="line"><span class="lineno"> 1253</span>      <span class="keywordflow">if</span> (ok_manifest &amp;&amp; <a class="code hl_function" href="weights_8c.html#a7d467c1ab0baceed9b0fdad7b5a8accf">read_all_text</a>(dedup_manifest, &amp;mjson, &amp;mlen) == 0 &amp;&amp; mjson &amp;&amp; mlen &gt; 0) {</div>
<div class="line"><span class="lineno"> 1254</span>        <span class="comment">/* Scan for \&quot;relpath\&quot; entries and touch each referenced file. */</span></div>
<div class="line"><span class="lineno"> 1255</span>        <span class="keywordtype">size_t</span> touched = 0;</div>
<div class="line"><span class="lineno"> 1256</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *p = mjson;</div>
<div class="line"><span class="lineno"> 1257</span>        <span class="keywordflow">while</span> ((p = strstr(p, <span class="stringliteral">&quot;\&quot;relpath\&quot;&quot;</span>)) != NULL) {</div>
<div class="line"><span class="lineno"> 1258</span>          p += strlen(<span class="stringliteral">&quot;\&quot;relpath\&quot;&quot;</span>);</div>
<div class="line"><span class="lineno"> 1259</span>          <span class="keywordflow">while</span> (*p &amp;&amp; (*p == <span class="charliteral">&#39; &#39;</span> || *p == <span class="charliteral">&#39;\t&#39;</span> || *p == <span class="charliteral">&#39;\r&#39;</span> || *p == <span class="charliteral">&#39;\n&#39;</span>)) ++p;</div>
<div class="line"><span class="lineno"> 1260</span>          <span class="keywordflow">if</span> (*p != <span class="charliteral">&#39;:&#39;</span>) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1261</span>          ++p;</div>
<div class="line"><span class="lineno"> 1262</span>          <span class="keywordflow">while</span> (*p &amp;&amp; (*p == <span class="charliteral">&#39; &#39;</span> || *p == <span class="charliteral">&#39;\t&#39;</span> || *p == <span class="charliteral">&#39;\r&#39;</span> || *p == <span class="charliteral">&#39;\n&#39;</span>)) ++p;</div>
<div class="line"><span class="lineno"> 1263</span>          <span class="keywordflow">if</span> (*p != <span class="charliteral">&#39;&quot;&#39;</span>) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1264</span>          ++p;</div>
<div class="line"><span class="lineno"> 1265</span> </div>
<div class="line"><span class="lineno"> 1266</span>          <span class="keywordtype">char</span> rel[512];</div>
<div class="line"><span class="lineno"> 1267</span>          <span class="keywordtype">size_t</span> rn = 0;</div>
<div class="line"><span class="lineno"> 1268</span>          <span class="keywordtype">int</span> esc = 0;</div>
<div class="line"><span class="lineno"> 1269</span>          <span class="keywordflow">for</span> (; *p &amp;&amp; rn + 1 &lt; <span class="keyword">sizeof</span>(rel); ++p) {</div>
<div class="line"><span class="lineno"> 1270</span>            <span class="keywordtype">char</span> ch = *p;</div>
<div class="line"><span class="lineno"> 1271</span>            <span class="keywordflow">if</span> (esc) {</div>
<div class="line"><span class="lineno"> 1272</span>              <span class="comment">/* Minimal unescape (we only expect simple paths). */</span></div>
<div class="line"><span class="lineno"> 1273</span>              <span class="keywordflow">if</span> (ch == <span class="charliteral">&#39;&quot;&#39;</span> || ch == <span class="charliteral">&#39;\\&#39;</span> || ch == <span class="charliteral">&#39;/&#39;</span>) {</div>
<div class="line"><span class="lineno"> 1274</span>                rel[rn++] = ch;</div>
<div class="line"><span class="lineno"> 1275</span>              } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ch == <span class="charliteral">&#39;n&#39;</span>) {</div>
<div class="line"><span class="lineno"> 1276</span>                rel[rn++] = <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><span class="lineno"> 1277</span>              } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ch == <span class="charliteral">&#39;r&#39;</span>) {</div>
<div class="line"><span class="lineno"> 1278</span>                rel[rn++] = <span class="charliteral">&#39;\r&#39;</span>;</div>
<div class="line"><span class="lineno"> 1279</span>              } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ch == <span class="charliteral">&#39;t&#39;</span>) {</div>
<div class="line"><span class="lineno"> 1280</span>                rel[rn++] = <span class="charliteral">&#39;\t&#39;</span>;</div>
<div class="line"><span class="lineno"> 1281</span>              } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1282</span>                rel[rn++] = ch;</div>
<div class="line"><span class="lineno"> 1283</span>              }</div>
<div class="line"><span class="lineno"> 1284</span>              esc = 0;</div>
<div class="line"><span class="lineno"> 1285</span>              <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1286</span>            }</div>
<div class="line"><span class="lineno"> 1287</span>            <span class="keywordflow">if</span> (ch == <span class="charliteral">&#39;\\&#39;</span>) {</div>
<div class="line"><span class="lineno"> 1288</span>              esc = 1;</div>
<div class="line"><span class="lineno"> 1289</span>              <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno"> 1290</span>            }</div>
<div class="line"><span class="lineno"> 1291</span>            <span class="keywordflow">if</span> (ch == <span class="charliteral">&#39;&quot;&#39;</span>) {</div>
<div class="line"><span class="lineno"> 1292</span>              <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno"> 1293</span>            }</div>
<div class="line"><span class="lineno"> 1294</span>            rel[rn++] = ch;</div>
<div class="line"><span class="lineno"> 1295</span>          }</div>
<div class="line"><span class="lineno"> 1296</span>          rel[rn] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 1297</span> </div>
<div class="line"><span class="lineno"> 1298</span>          <span class="keywordflow">if</span> (rel[0] != <span class="charliteral">&#39;\0&#39;</span>) {</div>
<div class="line"><span class="lineno"> 1299</span>            <span class="keywordtype">char</span> abs[512];</div>
<div class="line"><span class="lineno"> 1300</span>            abs[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 1301</span>            <a class="code hl_function" href="weights_8c.html#a7bb1dd9958b072fc5d1a80373cc074ff">join_path</a>(abs, <span class="keyword">sizeof</span>(abs), dir, rel);</div>
<div class="line"><span class="lineno"> 1302</span>            <span class="keywordtype">int</span> ok = <a class="code hl_function" href="weights_8c.html#ae3235e5160399c1e4465d1abf866571d">touch_file_small</a>(abs);</div>
<div class="line"><span class="lineno"> 1303</span>            ok_all = ok_all &amp;&amp; ok;</div>
<div class="line"><span class="lineno"> 1304</span>            ++touched;</div>
<div class="line"><span class="lineno"> 1305</span>          }</div>
<div class="line"><span class="lineno"> 1306</span> </div>
<div class="line"><span class="lineno"> 1307</span>          <span class="keywordflow">if</span> (*p == <span class="charliteral">&#39;&quot;&#39;</span>) ++p;</div>
<div class="line"><span class="lineno"> 1308</span>          <span class="keywordflow">if</span> (touched &gt; 128) <span class="keywordflow">break</span>; <span class="comment">/* sanity bound */</span></div>
<div class="line"><span class="lineno"> 1309</span>        }</div>
<div class="line"><span class="lineno"> 1310</span> </div>
<div class="line"><span class="lineno"> 1311</span>        <a class="code hl_define" href="weights_8c.html#a752563692fdfae65274bd2bf13be1661">WLOGI</a>(<span class="stringliteral">&quot;ie_weights_touch: dedup touch results manifest=%d ok_all=%d&quot;</span>, ok_manifest, ok_all);</div>
<div class="line"><span class="lineno"> 1312</span> </div>
<div class="line"><span class="lineno"> 1313</span>        <span class="keywordflow">if</span> (touched == 0) {</div>
<div class="line"><span class="lineno"> 1314</span>          <span class="comment">/* Fallback to canonical filenames used by the reference pipeline. */</span></div>
<div class="line"><span class="lineno"> 1315</span>          <span class="keywordtype">char</span> p_def[512], p_exc[512], p_msk[512];</div>
<div class="line"><span class="lineno"> 1316</span>          p_def[0] = p_exc[0] = p_msk[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 1317</span>          <a class="code hl_function" href="weights_8c.html#a7bb1dd9958b072fc5d1a80373cc074ff">join_path</a>(p_def, <span class="keyword">sizeof</span>(p_def), dir, <span class="stringliteral">&quot;model.defaults.bin&quot;</span>);</div>
<div class="line"><span class="lineno"> 1318</span>          <a class="code hl_function" href="weights_8c.html#a7bb1dd9958b072fc5d1a80373cc074ff">join_path</a>(p_exc, <span class="keyword">sizeof</span>(p_exc), dir, <span class="stringliteral">&quot;model.exceptions.bin&quot;</span>);</div>
<div class="line"><span class="lineno"> 1319</span>          <a class="code hl_function" href="weights_8c.html#a7bb1dd9958b072fc5d1a80373cc074ff">join_path</a>(p_msk, <span class="keyword">sizeof</span>(p_msk), dir, <span class="stringliteral">&quot;model.masks.bin&quot;</span>);</div>
<div class="line"><span class="lineno"> 1320</span>          <span class="keywordtype">int</span> ok_def = <a class="code hl_function" href="weights_8c.html#ae3235e5160399c1e4465d1abf866571d">touch_file_small</a>(p_def);</div>
<div class="line"><span class="lineno"> 1321</span>          <span class="keywordtype">int</span> ok_exc = <a class="code hl_function" href="weights_8c.html#ae3235e5160399c1e4465d1abf866571d">touch_file_small</a>(p_exc);</div>
<div class="line"><span class="lineno"> 1322</span>          <span class="keywordtype">int</span> ok_msk = <a class="code hl_function" href="weights_8c.html#ae3235e5160399c1e4465d1abf866571d">touch_file_small</a>(p_msk);</div>
<div class="line"><span class="lineno"> 1323</span>          ok_all = ok_all &amp;&amp; ok_def &amp;&amp; ok_exc &amp;&amp; ok_msk;</div>
<div class="line"><span class="lineno"> 1324</span>          <a class="code hl_define" href="weights_8c.html#a752563692fdfae65274bd2bf13be1661">WLOGI</a>(<span class="stringliteral">&quot;ie_weights_touch: dedup fallback touch defaults=%d exceptions=%d masks=%d&quot;</span>, ok_def, ok_exc,</div>
<div class="line"><span class="lineno"> 1325</span>                ok_msk);</div>
<div class="line"><span class="lineno"> 1326</span>        }</div>
<div class="line"><span class="lineno"> 1327</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1328</span>        <a class="code hl_define" href="weights_8c.html#a92c7e58c96077a0c401dbfd6c4196f1a">WLOGW</a>(<span class="stringliteral">&quot;ie_weights_touch: could not read dedup manifest &#39;%s&#39;&quot;</span>, dedup_manifest);</div>
<div class="line"><span class="lineno"> 1329</span>        ok_all = 0;</div>
<div class="line"><span class="lineno"> 1330</span>      }</div>
<div class="line"><span class="lineno"> 1331</span> </div>
<div class="line"><span class="lineno"> 1332</span>      free(mjson);</div>
<div class="line"><span class="lineno"> 1333</span> </div>
<div class="line"><span class="lineno"> 1334</span>      <span class="keywordflow">if</span> (dedup_strict &amp;&amp; !ok_all) {</div>
<div class="line"><span class="lineno"> 1335</span>        <a class="code hl_define" href="weights_8c.html#af8239319fc44fa28e836591e9ac89c02">WLOGE</a>(<span class="stringliteral">&quot;ie_weights_touch: dedup strict mode: missing or unreadable artifact(s)&quot;</span>);</div>
<div class="line"><span class="lineno"> 1336</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9">IE_IO_ERR_JSON</a>;</div>
<div class="line"><span class="lineno"> 1337</span>      }</div>
<div class="line"><span class="lineno"> 1338</span>    }</div>
<div class="line"><span class="lineno"> 1339</span>  }</div>
<div class="line"><span class="lineno"> 1340</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno"> 1341</span> </div>
<div class="line"><span class="lineno"> 1342</span>  <a class="code hl_define" href="weights_8c.html#a752563692fdfae65274bd2bf13be1661">WLOGI</a>(<span class="stringliteral">&quot;ie_weights_touch: success&quot;</span>);</div>
<div class="line"><span class="lineno"> 1343</span>  <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>;</div>
<div class="line"><span class="lineno"> 1344</span>}</div>
<div class="ttc" id="aie__io_8h_html_a4c501870bd45dbe373416745a03de987aa12fce48fd3eee2bd8a75dc61db150a7"><div class="ttname"><a href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aa12fce48fd3eee2bd8a75dc61db150a7">IE_IO_ERR_READ</a></div><div class="ttdeci">@ IE_IO_ERR_READ</div><div class="ttdoc">read(2) failure or short read.</div><div class="ttdef"><b>Definition</b> <a href="ie__io_8h_source.html#l00070">ie_io.h:70</a></div></div>
<div class="ttc" id="aie__io_8h_html_a4c501870bd45dbe373416745a03de987aba0321da4352c7a61ea1bda842bb64d0"><div class="ttname"><a href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aba0321da4352c7a61ea1bda842bb64d0">IE_IO_ERR_OPEN</a></div><div class="ttdeci">@ IE_IO_ERR_OPEN</div><div class="ttdoc">open(2) failure.</div><div class="ttdef"><b>Definition</b> <a href="ie__io_8h_source.html#l00069">ie_io.h:69</a></div></div>
<div class="ttc" id="astructie__weights__s_html_a19f9137cca00113908b495a70769805e"><div class="ttname"><a href="structie__weights__s.html#a19f9137cca00113908b495a70769805e">ie_weights_s::bin_size_bytes</a></div><div class="ttdeci">size_t bin_size_bytes</div><div class="ttdoc">Size of the weights binary in bytes.</div><div class="ttdef"><b>Definition</b> <a href="ie__io_8h_source.html#l00101">ie_io.h:101</a></div></div>
<div class="ttc" id="astructie__weights__s_html_a6d4bef9e704edd817ee473eb2685cdd4"><div class="ttname"><a href="structie__weights__s.html#a6d4bef9e704edd817ee473eb2685cdd4">ie_weights_s::json_path</a></div><div class="ttdeci">char json_path[512]</div><div class="ttdoc">Canonical path to model.ie.json.</div><div class="ttdef"><b>Definition</b> <a href="ie__io_8h_source.html#l00098">ie_io.h:98</a></div></div>
<div class="ttc" id="astructie__weights__s_html_ab6a61099d0af4a47854d02dc4fef5b8f"><div class="ttname"><a href="structie__weights__s.html#ab6a61099d0af4a47854d02dc4fef5b8f">ie_weights_s::weights_path</a></div><div class="ttdeci">char weights_path[512]</div><div class="ttdoc">Resolved path to model.ie.bin.</div><div class="ttdef"><b>Definition</b> <a href="ie__io_8h_source.html#l00099">ie_io.h:99</a></div></div>
<div class="ttc" id="aweights_8c_html_aabb19f4a5e5385962c6db57f611bb785"><div class="ttname"><a href="weights_8c.html#aabb19f4a5e5385962c6db57f611bb785">ie_pread</a></div><div class="ttdeci">static ssize_t ie_pread(int fd, void *buf, size_t count, off_t offset)</div><div class="ttdoc">Portable pread wrapper with fallback.</div><div class="ttdef"><b>Definition</b> <a href="weights_8c_source.html#l00716">weights.c:716</a></div></div>
<div class="ttc" id="aweights_8c_html_ae3235e5160399c1e4465d1abf866571d"><div class="ttname"><a href="weights_8c.html#ae3235e5160399c1e4465d1abf866571d">touch_file_small</a></div><div class="ttdeci">static int touch_file_small(const char *path)</div><div class="ttdoc">Touch a file by doing small reads near start/end.</div><div class="ttdef"><b>Definition</b> <a href="weights_8c_source.html#l00933">weights.c:933</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ie__io_8h_source.html#l00101">ie_weights_s::bin_size_bytes</a>, <a class="el" href="weights_8c_source.html#l00207">cpyz()</a>, <a class="el" href="weights_8c_source.html#l00867">ensure_dedup_manifest_link()</a>, <a class="el" href="weights_8c_source.html#l00759">env_flag_get()</a>, <a class="el" href="weights_8c_source.html#l00775">file_exists_readable()</a>, <a class="el" href="ie__io_8h_source.html#l00065">IE_IO_ERR_ARGS</a>, <a class="el" href="ie__io_8h_source.html#l00066">IE_IO_ERR_JSON</a>, <a class="el" href="ie__io_8h_source.html#l00069">IE_IO_ERR_OPEN</a>, <a class="el" href="ie__io_8h_source.html#l00070">IE_IO_ERR_READ</a>, <a class="el" href="ie__io_8h_source.html#l00064">IE_IO_OK</a>, <a class="el" href="weights_8c_source.html#l00716">ie_pread()</a>, <a class="el" href="weights_8c_source.html#l00247">join_path()</a>, <a class="el" href="ie__io_8h_source.html#l00098">ie_weights_s::json_path</a>, <a class="el" href="weights_8c_source.html#l00225">last_slash()</a>, <a class="el" href="weights_8c_source.html#l00297">read_all_text()</a>, <a class="el" href="weights_8c_source.html#l00933">touch_file_small()</a>, <a class="el" href="ie__io_8h_source.html#l00099">ie_weights_s::weights_path</a>, <a class="el" href="weights_8c_source.html#l00175">wlog_errno_()</a>, <a class="el" href="weights_8c_source.html#l00149">WLOGD</a>, <a class="el" href="weights_8c_source.html#l00163">WLOGE</a>, <a class="el" href="weights_8c_source.html#l00142">WLOGI</a>, and <a class="el" href="weights_8c_source.html#l00156">WLOGW</a>.</p>

<p class="reference">Referenced by <a class="el" href="test__dedup__loader_8c_source.html#l00065">open_and_touch()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="weights_8c_a095d7f59c4cba2b530bac039bca8b7a9_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="weights_8c_a095d7f59c4cba2b530bac039bca8b7a9_icgraph.svg" width="424" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a7bb1dd9958b072fc5d1a80373cc074ff" name="a7bb1dd9958b072fc5d1a80373cc074ff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7bb1dd9958b072fc5d1a80373cc074ff">&#9670;&#160;</a></span>join_path()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void join_path </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>outsz</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>file</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Join directory and filename into an output buffer (NUL-terminated). </p>
<p>This function performs a bounded concatenation:</p><ul>
<li>If <code>dir</code> ends with '/', it is not duplicated.</li>
<li>If <code>dir</code> is empty, <code>file</code> is copied verbatim.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">out</td><td>Output buffer. </td></tr>
    <tr><td class="paramname">outsz</td><td>Output capacity. </td></tr>
    <tr><td class="paramname">dir</td><td>Directory path (may be NULL/empty). </td></tr>
    <tr><td class="paramname">file</td><td>Filename (must be non-empty). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="weights_8c_source.html#l00247">247</a> of file <a class="el" href="weights_8c_source.html">weights.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  247</span>                                                                                  {</div>
<div class="line"><span class="lineno">  248</span>  <span class="keywordflow">if</span> (!out || outsz == 0) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  249</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  250</span>  <span class="keywordflow">if</span> (!file || !*file) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  251</span> </div>
<div class="line"><span class="lineno">  252</span>  <span class="keywordflow">if</span> (!dir || !*dir) {</div>
<div class="line"><span class="lineno">  253</span>    <a class="code hl_function" href="weights_8c.html#ae3307b59271742c37862abf0b9698d23">cpyz</a>(out, outsz, file);</div>
<div class="line"><span class="lineno">  254</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  255</span>  }</div>
<div class="line"><span class="lineno">  256</span> </div>
<div class="line"><span class="lineno">  257</span>  <span class="keyword">const</span> <span class="keywordtype">size_t</span> ld = strlen(dir);</div>
<div class="line"><span class="lineno">  258</span>  <span class="keyword">const</span> <span class="keywordtype">size_t</span> lf = strlen(file);</div>
<div class="line"><span class="lineno">  259</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> need_slash = (ld &gt; 0 &amp;&amp; dir[ld - 1] != <span class="charliteral">&#39;/&#39;</span>);</div>
<div class="line"><span class="lineno">  260</span> </div>
<div class="line"><span class="lineno">  261</span>  <span class="keywordtype">size_t</span> pos = 0;</div>
<div class="line"><span class="lineno">  262</span> </div>
<div class="line"><span class="lineno">  263</span>  <span class="keywordtype">size_t</span> copyd = ld;</div>
<div class="line"><span class="lineno">  264</span>  <span class="keywordflow">if</span> (copyd &gt;= outsz) copyd = outsz - 1;</div>
<div class="line"><span class="lineno">  265</span>  <span class="keywordflow">if</span> (copyd &gt; 0) {</div>
<div class="line"><span class="lineno">  266</span>    memcpy(out + pos, dir, copyd);</div>
<div class="line"><span class="lineno">  267</span>    pos += copyd;</div>
<div class="line"><span class="lineno">  268</span>  }</div>
<div class="line"><span class="lineno">  269</span> </div>
<div class="line"><span class="lineno">  270</span>  <span class="keywordflow">if</span> (pos &lt; outsz - 1 &amp;&amp; need_slash) <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>[pos++] = <span class="charliteral">&#39;/&#39;</span>;</div>
<div class="line"><span class="lineno">  271</span> </div>
<div class="line"><span class="lineno">  272</span>  <span class="keywordflow">if</span> (pos &lt; outsz - 1) {</div>
<div class="line"><span class="lineno">  273</span>    <span class="keywordtype">size_t</span> room = (outsz - 1) - pos;</div>
<div class="line"><span class="lineno">  274</span>    <span class="keywordtype">size_t</span> copyf = (lf &gt; room) ? room : lf;</div>
<div class="line"><span class="lineno">  275</span>    <span class="keywordflow">if</span> (copyf &gt; 0) {</div>
<div class="line"><span class="lineno">  276</span>      memcpy(out + pos, file, copyf);</div>
<div class="line"><span class="lineno">  277</span>      pos += copyf;</div>
<div class="line"><span class="lineno">  278</span>    }</div>
<div class="line"><span class="lineno">  279</span>  }</div>
<div class="line"><span class="lineno">  280</span> </div>
<div class="line"><span class="lineno">  281</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>[pos] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  282</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="weights_8c_source.html#l00207">cpyz()</a>.</p>

<p class="reference">Referenced by <a class="el" href="weights_8c_source.html#l00867">ensure_dedup_manifest_link()</a>, <a class="el" href="weights_8c_source.html#l00812">find_dedup_manifest_source_()</a>, <a class="el" href="weights_8c_source.html#l00988">ie_weights_open()</a>, and <a class="el" href="weights_8c_source.html#l01183">ie_weights_touch()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="weights_8c_a7bb1dd9958b072fc5d1a80373cc074ff_cgraph.svg" width="194" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="weights_8c_a7bb1dd9958b072fc5d1a80373cc074ff_icgraph.svg" width="100%" height="440"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a173309f164a3d6851b64ca6a5ad733c9" name="a173309f164a3d6851b64ca6a5ad733c9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a173309f164a3d6851b64ca6a5ad733c9">&#9670;&#160;</a></span>json_unescape_into()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static size_t json_unescape_into </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>dstsz</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>srclen</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Unescape a JSON string into a destination buffer (best-effort). </p>
<p>Supported escapes:</p><ul>
<li>" \ \/</li>
<li><br  />
 \r \t</li>
</ul>
<p>Unknown escapes are handled by dropping the backslash and copying the escaped character verbatim.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dst</td><td>Destination buffer. </td></tr>
    <tr><td class="paramname">dstsz</td><td>Destination capacity. </td></tr>
    <tr><td class="paramname">src</td><td>Source buffer (not NUL-terminated; length provided). </td></tr>
    <tr><td class="paramname">srclen</td><td>Source length in bytes. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Number of bytes written (excluding NUL terminator). </dd></dl>

<p class="definition">Definition at line <a class="el" href="weights_8c_source.html#l00415">415</a> of file <a class="el" href="weights_8c_source.html">weights.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  415</span>                                                                                          {</div>
<div class="line"><span class="lineno">  416</span>  <span class="keywordflow">if</span> (!dst || dstsz == 0) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  417</span>  <span class="keywordtype">size_t</span> di = 0;</div>
<div class="line"><span class="lineno">  418</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> si = 0; si &lt; srclen &amp;&amp; di + 1 &lt; dstsz; ++si) {</div>
<div class="line"><span class="lineno">  419</span>    <span class="keywordtype">char</span> ch = <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a6e1f8f63edf468d486e77c62d293460f">src</a>[si];</div>
<div class="line"><span class="lineno">  420</span>    <span class="keywordflow">if</span> (ch == <span class="charliteral">&#39;\\&#39;</span> &amp;&amp; si + 1 &lt; srclen) {</div>
<div class="line"><span class="lineno">  421</span>      <span class="keywordtype">char</span> n = <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a6e1f8f63edf468d486e77c62d293460f">src</a>[si + 1];</div>
<div class="line"><span class="lineno">  422</span>      <span class="keywordflow">if</span> (n == <span class="charliteral">&#39;&quot;&#39;</span> || n == <span class="charliteral">&#39;\\&#39;</span> || n == <span class="charliteral">&#39;/&#39;</span>) {</div>
<div class="line"><span class="lineno">  423</span>        <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a415d14a7ade776b6bb2e544f0be25e6b">dst</a>[di++] = n;</div>
<div class="line"><span class="lineno">  424</span>        ++si;</div>
<div class="line"><span class="lineno">  425</span>        <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  426</span>      }</div>
<div class="line"><span class="lineno">  427</span>      <span class="keywordflow">if</span> (n == <span class="charliteral">&#39;n&#39;</span>) {</div>
<div class="line"><span class="lineno">  428</span>        <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a415d14a7ade776b6bb2e544f0be25e6b">dst</a>[di++] = <span class="charliteral">&#39;\n&#39;</span>;</div>
<div class="line"><span class="lineno">  429</span>        ++si;</div>
<div class="line"><span class="lineno">  430</span>        <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  431</span>      }</div>
<div class="line"><span class="lineno">  432</span>      <span class="keywordflow">if</span> (n == <span class="charliteral">&#39;r&#39;</span>) {</div>
<div class="line"><span class="lineno">  433</span>        <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a415d14a7ade776b6bb2e544f0be25e6b">dst</a>[di++] = <span class="charliteral">&#39;\r&#39;</span>;</div>
<div class="line"><span class="lineno">  434</span>        ++si;</div>
<div class="line"><span class="lineno">  435</span>        <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  436</span>      }</div>
<div class="line"><span class="lineno">  437</span>      <span class="keywordflow">if</span> (n == <span class="charliteral">&#39;t&#39;</span>) {</div>
<div class="line"><span class="lineno">  438</span>        <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a415d14a7ade776b6bb2e544f0be25e6b">dst</a>[di++] = <span class="charliteral">&#39;\t&#39;</span>;</div>
<div class="line"><span class="lineno">  439</span>        ++si;</div>
<div class="line"><span class="lineno">  440</span>        <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  441</span>      }</div>
<div class="line"><span class="lineno">  442</span>      <span class="comment">/* Unknown escape: drop backslash, keep char. */</span></div>
<div class="line"><span class="lineno">  443</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a415d14a7ade776b6bb2e544f0be25e6b">dst</a>[di++] = n;</div>
<div class="line"><span class="lineno">  444</span>      ++si;</div>
<div class="line"><span class="lineno">  445</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  446</span>    }</div>
<div class="line"><span class="lineno">  447</span>    <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a415d14a7ade776b6bb2e544f0be25e6b">dst</a>[di++] = ch;</div>
<div class="line"><span class="lineno">  448</span>  }</div>
<div class="line"><span class="lineno">  449</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a415d14a7ade776b6bb2e544f0be25e6b">dst</a>[di] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  450</span>  <span class="keywordflow">return</span> di;</div>
<div class="line"><span class="lineno">  451</span>}</div>
<div class="ttc" id="anamespaceconvert__dtypes__to__numeric_html_a6e1f8f63edf468d486e77c62d293460f"><div class="ttname"><a href="namespaceconvert__dtypes__to__numeric.html#a6e1f8f63edf468d486e77c62d293460f">convert_dtypes_to_numeric.src</a></div><div class="ttdeci">src</div><div class="ttdef"><b>Definition</b> <a href="convert__dtypes__to__numeric_8py_source.html#l00026">convert_dtypes_to_numeric.py:26</a></div></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="weights_8c_source.html#l00467">scan_json_key_string()</a>, and <a class="el" href="weights_8c_source.html#l00580">scan_json_key_string_in_range()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="weights_8c_a173309f164a3d6851b64ca6a5ad733c9_icgraph.svg" width="100%" height="438"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a7415d89bc8bd657819e06ac0fc53da95" name="a7415d89bc8bd657819e06ac0fc53da95"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7415d89bc8bd657819e06ac0fc53da95">&#9670;&#160;</a></span>last_slash()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static const char * last_slash </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>p</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Return a pointer to the last '/' in a path, or NULL if none. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p</td><td>NUL-terminated path. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Pointer to last '/', or NULL. </dd></dl>

<p class="definition">Definition at line <a class="el" href="weights_8c_source.html#l00225">225</a> of file <a class="el" href="weights_8c_source.html">weights.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  225</span>                                             {</div>
<div class="line"><span class="lineno">  226</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *s = NULL;</div>
<div class="line"><span class="lineno">  227</span>  <span class="keywordflow">if</span> (!p) <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  228</span>  <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">char</span> *q = p; *q; ++q) {</div>
<div class="line"><span class="lineno">  229</span>    <span class="keywordflow">if</span> (*q == <span class="charliteral">&#39;/&#39;</span>) s = q;</div>
<div class="line"><span class="lineno">  230</span>  }</div>
<div class="line"><span class="lineno">  231</span>  <span class="keywordflow">return</span> s;</div>
<div class="line"><span class="lineno">  232</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="weights_8c_source.html#l00988">ie_weights_open()</a>, and <a class="el" href="weights_8c_source.html#l01183">ie_weights_touch()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="weights_8c_a7415d89bc8bd657819e06ac0fc53da95_icgraph.svg" width="564" height="184"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a7d467c1ab0baceed9b0fdad7b5a8accf" name="a7d467c1ab0baceed9b0fdad7b5a8accf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7d467c1ab0baceed9b0fdad7b5a8accf">&#9670;&#160;</a></span>read_all_text()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int read_all_text </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>len_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Read an entire file into a newly allocated NUL-terminated buffer. </p>
<ul>
<li>Reads in binary mode.</li>
<li>Strips a UTF-8 BOM if present.</li>
<li>Always NUL-terminates the returned buffer.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">path</td><td>File path. </td></tr>
    <tr><td class="paramname">buf</td><td>Output pointer to malloc'd buffer (caller frees). </td></tr>
    <tr><td class="paramname">len_out</td><td>Optional output length (bytes, excluding NUL). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, negative on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="weights_8c_source.html#l00297">297</a> of file <a class="el" href="weights_8c_source.html">weights.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  297</span>                                                                        {</div>
<div class="line"><span class="lineno">  298</span>  <span class="keywordflow">if</span> (!path || !buf) <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  299</span>  *buf = NULL;</div>
<div class="line"><span class="lineno">  300</span>  <span class="keywordflow">if</span> (len_out) *len_out = 0;</div>
<div class="line"><span class="lineno">  301</span> </div>
<div class="line"><span class="lineno">  302</span>  <a class="code hl_define" href="weights_8c.html#a2243a7a621a65f66170ede427763ee2d">WLOGD</a>(<span class="stringliteral">&quot;read_all_text: path=&#39;%s&#39;&quot;</span>, path);</div>
<div class="line"><span class="lineno">  303</span> </div>
<div class="line"><span class="lineno">  304</span>  FILE *f = fopen(path, <span class="stringliteral">&quot;rb&quot;</span>);</div>
<div class="line"><span class="lineno">  305</span>  <span class="keywordflow">if</span> (!f) {</div>
<div class="line"><span class="lineno">  306</span>    <a class="code hl_function" href="weights_8c.html#a88ec341995312abc5fbbd4084389523e">wlog_errno_</a>(<span class="stringliteral">&quot;fopen&quot;</span>, path);</div>
<div class="line"><span class="lineno">  307</span>    <span class="keywordflow">return</span> -2;</div>
<div class="line"><span class="lineno">  308</span>  }</div>
<div class="line"><span class="lineno">  309</span> </div>
<div class="line"><span class="lineno">  310</span>  <span class="keywordflow">if</span> (fseek(f, 0, SEEK_END) != 0) {</div>
<div class="line"><span class="lineno">  311</span>    <a class="code hl_function" href="weights_8c.html#a88ec341995312abc5fbbd4084389523e">wlog_errno_</a>(<span class="stringliteral">&quot;fseek&quot;</span>, path);</div>
<div class="line"><span class="lineno">  312</span>    fclose(f);</div>
<div class="line"><span class="lineno">  313</span>    <span class="keywordflow">return</span> -3;</div>
<div class="line"><span class="lineno">  314</span>  }</div>
<div class="line"><span class="lineno">  315</span>  <span class="keywordtype">long</span> n = ftell(f);</div>
<div class="line"><span class="lineno">  316</span>  <span class="keywordflow">if</span> (n &lt; 0) {</div>
<div class="line"><span class="lineno">  317</span>    <a class="code hl_function" href="weights_8c.html#a88ec341995312abc5fbbd4084389523e">wlog_errno_</a>(<span class="stringliteral">&quot;ftell&quot;</span>, path);</div>
<div class="line"><span class="lineno">  318</span>    fclose(f);</div>
<div class="line"><span class="lineno">  319</span>    <span class="keywordflow">return</span> -3;</div>
<div class="line"><span class="lineno">  320</span>  }</div>
<div class="line"><span class="lineno">  321</span>  <span class="keywordflow">if</span> (fseek(f, 0, SEEK_SET) != 0) {</div>
<div class="line"><span class="lineno">  322</span>    <a class="code hl_function" href="weights_8c.html#a88ec341995312abc5fbbd4084389523e">wlog_errno_</a>(<span class="stringliteral">&quot;fseek&quot;</span>, path);</div>
<div class="line"><span class="lineno">  323</span>    fclose(f);</div>
<div class="line"><span class="lineno">  324</span>    <span class="keywordflow">return</span> -3;</div>
<div class="line"><span class="lineno">  325</span>  }</div>
<div class="line"><span class="lineno">  326</span> </div>
<div class="line"><span class="lineno">  327</span>  <span class="keywordtype">size_t</span> size = (size_t)n;</div>
<div class="line"><span class="lineno">  328</span>  <span class="keywordtype">char</span> *mem = (<span class="keywordtype">char</span> *)malloc(size + 1);</div>
<div class="line"><span class="lineno">  329</span>  <span class="keywordflow">if</span> (!mem) {</div>
<div class="line"><span class="lineno">  330</span>    <a class="code hl_define" href="weights_8c.html#af8239319fc44fa28e836591e9ac89c02">WLOGE</a>(<span class="stringliteral">&quot;read_all_text: malloc failed (bytes=%zu) path=&#39;%s&#39;&quot;</span>, size + 1, path);</div>
<div class="line"><span class="lineno">  331</span>    fclose(f);</div>
<div class="line"><span class="lineno">  332</span>    <span class="keywordflow">return</span> -4;</div>
<div class="line"><span class="lineno">  333</span>  }</div>
<div class="line"><span class="lineno">  334</span> </div>
<div class="line"><span class="lineno">  335</span>  <span class="keywordtype">size_t</span> rd = fread(mem, 1, size, f);</div>
<div class="line"><span class="lineno">  336</span>  fclose(f);</div>
<div class="line"><span class="lineno">  337</span>  <span class="keywordflow">if</span> (rd != size) {</div>
<div class="line"><span class="lineno">  338</span>    <a class="code hl_define" href="weights_8c.html#af8239319fc44fa28e836591e9ac89c02">WLOGE</a>(<span class="stringliteral">&quot;read_all_text: short read (got=%zu want=%zu) path=&#39;%s&#39;&quot;</span>, rd, size, path);</div>
<div class="line"><span class="lineno">  339</span>    free(mem);</div>
<div class="line"><span class="lineno">  340</span>    <span class="keywordflow">return</span> -5;</div>
<div class="line"><span class="lineno">  341</span>  }</div>
<div class="line"><span class="lineno">  342</span> </div>
<div class="line"><span class="lineno">  343</span>  <span class="keywordflow">if</span> (size &gt;= 3 &amp;&amp; (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)mem[0] == 0xEF &amp;&amp; (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)mem[1] == 0xBB &amp;&amp;</div>
<div class="line"><span class="lineno">  344</span>      (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)mem[2] == 0xBF) {</div>
<div class="line"><span class="lineno">  345</span>    <a class="code hl_define" href="weights_8c.html#a2243a7a621a65f66170ede427763ee2d">WLOGD</a>(<span class="stringliteral">&quot;read_all_text: stripping UTF-8 BOM path=&#39;%s&#39;&quot;</span>, path);</div>
<div class="line"><span class="lineno">  346</span>    size -= 3;</div>
<div class="line"><span class="lineno">  347</span>    memmove(mem, mem + 3, size);</div>
<div class="line"><span class="lineno">  348</span>  }</div>
<div class="line"><span class="lineno">  349</span> </div>
<div class="line"><span class="lineno">  350</span>  mem[size] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  351</span>  *buf = mem;</div>
<div class="line"><span class="lineno">  352</span>  <span class="keywordflow">if</span> (len_out) *len_out = size;</div>
<div class="line"><span class="lineno">  353</span> </div>
<div class="line"><span class="lineno">  354</span>  <a class="code hl_define" href="weights_8c.html#a2243a7a621a65f66170ede427763ee2d">WLOGD</a>(<span class="stringliteral">&quot;read_all_text: ok (bytes=%zu) path=&#39;%s&#39;&quot;</span>, size, path);</div>
<div class="line"><span class="lineno">  355</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  356</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="weights_8c_source.html#l00175">wlog_errno_()</a>, <a class="el" href="weights_8c_source.html#l00149">WLOGD</a>, and <a class="el" href="weights_8c_source.html#l00163">WLOGE</a>.</p>

<p class="reference">Referenced by <a class="el" href="weights_8c_source.html#l00867">ensure_dedup_manifest_link()</a>, <a class="el" href="weights_8c_source.html#l00988">ie_weights_open()</a>, and <a class="el" href="weights_8c_source.html#l01183">ie_weights_touch()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="weights_8c_a7d467c1ab0baceed9b0fdad7b5a8accf_cgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="weights_8c_a7d467c1ab0baceed9b0fdad7b5a8accf_icgraph.svg" width="100%" height="438"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a3c6343a4152588f4f490f3263842c7f6" name="a3c6343a4152588f4f490f3263842c7f6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c6343a4152588f4f490f3263842c7f6">&#9670;&#160;</a></span>scan_json_best_effort_bin()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int scan_json_best_effort_bin </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>json</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>dstsz</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Try multiple schema variants to locate the weights binary path. </p>
<p>The loader tolerates different JSON shapes by checking:</p><ul>
<li>"bin"</li>
<li>"weights_bin"</li>
<li>"weightsBin"</li>
<li>"weights_path"</li>
<li>"weightsPath"</li>
<li>"weights": { "bin": ... }</li>
<li>"iebin": { "bin": ... }</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">json</td><td>NUL-terminated JSON-ish text. </td></tr>
    <tr><td class="paramname">dst</td><td>Output buffer for the path value. </td></tr>
    <tr><td class="paramname">dstsz</td><td>Output capacity. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 if found, 0 if not found, negative on invalid args. </dd></dl>

<p class="definition">Definition at line <a class="el" href="weights_8c_source.html#l00643">643</a> of file <a class="el" href="weights_8c_source.html">weights.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  643</span>                                                                                {</div>
<div class="line"><span class="lineno">  644</span>  <span class="keywordflow">if</span> (!json || !dst || dstsz == 0) <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  645</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a415d14a7ade776b6bb2e544f0be25e6b">dst</a>[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  646</span> </div>
<div class="line"><span class="lineno">  647</span>  <span class="comment">/* Common direct keys. */</span></div>
<div class="line"><span class="lineno">  648</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="weights_8c.html#a3c438658d11f74ba4af8273c7e390311">scan_json_key_string</a>(json, <span class="stringliteral">&quot;bin&quot;</span>, dst, dstsz) == 1 &amp;&amp; dst[0]) {</div>
<div class="line"><span class="lineno">  649</span>    <a class="code hl_define" href="weights_8c.html#a2243a7a621a65f66170ede427763ee2d">WLOGD</a>(<span class="stringliteral">&quot;scan_json_best_effort_bin: found key=&#39;bin&#39; value=&#39;%s&#39;&quot;</span>, dst);</div>
<div class="line"><span class="lineno">  650</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  651</span>  }</div>
<div class="line"><span class="lineno">  652</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="weights_8c.html#a3c438658d11f74ba4af8273c7e390311">scan_json_key_string</a>(json, <span class="stringliteral">&quot;weights_bin&quot;</span>, dst, dstsz) == 1 &amp;&amp; dst[0]) {</div>
<div class="line"><span class="lineno">  653</span>    <a class="code hl_define" href="weights_8c.html#a2243a7a621a65f66170ede427763ee2d">WLOGD</a>(<span class="stringliteral">&quot;scan_json_best_effort_bin: found key=&#39;weights_bin&#39; value=&#39;%s&#39;&quot;</span>, dst);</div>
<div class="line"><span class="lineno">  654</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  655</span>  }</div>
<div class="line"><span class="lineno">  656</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="weights_8c.html#a3c438658d11f74ba4af8273c7e390311">scan_json_key_string</a>(json, <span class="stringliteral">&quot;weightsBin&quot;</span>, dst, dstsz) == 1 &amp;&amp; dst[0]) {</div>
<div class="line"><span class="lineno">  657</span>    <a class="code hl_define" href="weights_8c.html#a2243a7a621a65f66170ede427763ee2d">WLOGD</a>(<span class="stringliteral">&quot;scan_json_best_effort_bin: found key=&#39;weightsBin&#39; value=&#39;%s&#39;&quot;</span>, dst);</div>
<div class="line"><span class="lineno">  658</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  659</span>  }</div>
<div class="line"><span class="lineno">  660</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="weights_8c.html#a3c438658d11f74ba4af8273c7e390311">scan_json_key_string</a>(json, <span class="stringliteral">&quot;weights_path&quot;</span>, dst, dstsz) == 1 &amp;&amp; dst[0]) {</div>
<div class="line"><span class="lineno">  661</span>    <a class="code hl_define" href="weights_8c.html#a2243a7a621a65f66170ede427763ee2d">WLOGD</a>(<span class="stringliteral">&quot;scan_json_best_effort_bin: found key=&#39;weights_path&#39; value=&#39;%s&#39;&quot;</span>, dst);</div>
<div class="line"><span class="lineno">  662</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  663</span>  }</div>
<div class="line"><span class="lineno">  664</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="weights_8c.html#a3c438658d11f74ba4af8273c7e390311">scan_json_key_string</a>(json, <span class="stringliteral">&quot;weightsPath&quot;</span>, dst, dstsz) == 1 &amp;&amp; dst[0]) {</div>
<div class="line"><span class="lineno">  665</span>    <a class="code hl_define" href="weights_8c.html#a2243a7a621a65f66170ede427763ee2d">WLOGD</a>(<span class="stringliteral">&quot;scan_json_best_effort_bin: found key=&#39;weightsPath&#39; value=&#39;%s&#39;&quot;</span>, dst);</div>
<div class="line"><span class="lineno">  666</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  667</span>  }</div>
<div class="line"><span class="lineno">  668</span> </div>
<div class="line"><span class="lineno">  669</span>  <span class="comment">/* Nested objects. */</span></div>
<div class="line"><span class="lineno">  670</span>  {</div>
<div class="line"><span class="lineno">  671</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *b = NULL;</div>
<div class="line"><span class="lineno">  672</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *e = NULL;</div>
<div class="line"><span class="lineno">  673</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="weights_8c.html#a853d256b28c7e6c404c035fc1a16a454">scan_json_object_range</a>(json, <span class="stringliteral">&quot;weights&quot;</span>, &amp;b, &amp;e) == 1 &amp;&amp; b &amp;&amp; e &amp;&amp; b &lt;= e) {</div>
<div class="line"><span class="lineno">  674</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="weights_8c.html#a110cc679cd45b43c11f22ba749bd0ea3">scan_json_key_string_in_range</a>(b, e, <span class="stringliteral">&quot;bin&quot;</span>, dst, dstsz) == 1 &amp;&amp; dst[0]) {</div>
<div class="line"><span class="lineno">  675</span>        <a class="code hl_define" href="weights_8c.html#a2243a7a621a65f66170ede427763ee2d">WLOGD</a>(<span class="stringliteral">&quot;scan_json_best_effort_bin: found key=&#39;weights.bin&#39; value=&#39;%s&#39;&quot;</span>, dst);</div>
<div class="line"><span class="lineno">  676</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  677</span>      }</div>
<div class="line"><span class="lineno">  678</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="weights_8c.html#a110cc679cd45b43c11f22ba749bd0ea3">scan_json_key_string_in_range</a>(b, e, <span class="stringliteral">&quot;weights_bin&quot;</span>, dst, dstsz) == 1 &amp;&amp; dst[0]) {</div>
<div class="line"><span class="lineno">  679</span>        <a class="code hl_define" href="weights_8c.html#a2243a7a621a65f66170ede427763ee2d">WLOGD</a>(<span class="stringliteral">&quot;scan_json_best_effort_bin: found key=&#39;weights.weights_bin&#39; value=&#39;%s&#39;&quot;</span>, dst);</div>
<div class="line"><span class="lineno">  680</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  681</span>      }</div>
<div class="line"><span class="lineno">  682</span>    }</div>
<div class="line"><span class="lineno">  683</span>  }</div>
<div class="line"><span class="lineno">  684</span>  {</div>
<div class="line"><span class="lineno">  685</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *b = NULL;</div>
<div class="line"><span class="lineno">  686</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *e = NULL;</div>
<div class="line"><span class="lineno">  687</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="weights_8c.html#a853d256b28c7e6c404c035fc1a16a454">scan_json_object_range</a>(json, <span class="stringliteral">&quot;iebin&quot;</span>, &amp;b, &amp;e) == 1 &amp;&amp; b &amp;&amp; e &amp;&amp; b &lt;= e) {</div>
<div class="line"><span class="lineno">  688</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="weights_8c.html#a110cc679cd45b43c11f22ba749bd0ea3">scan_json_key_string_in_range</a>(b, e, <span class="stringliteral">&quot;bin&quot;</span>, dst, dstsz) == 1 &amp;&amp; dst[0]) {</div>
<div class="line"><span class="lineno">  689</span>        <a class="code hl_define" href="weights_8c.html#a2243a7a621a65f66170ede427763ee2d">WLOGD</a>(<span class="stringliteral">&quot;scan_json_best_effort_bin: found key=&#39;iebin.bin&#39; value=&#39;%s&#39;&quot;</span>, dst);</div>
<div class="line"><span class="lineno">  690</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  691</span>      }</div>
<div class="line"><span class="lineno">  692</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="weights_8c.html#a110cc679cd45b43c11f22ba749bd0ea3">scan_json_key_string_in_range</a>(b, e, <span class="stringliteral">&quot;weights_bin&quot;</span>, dst, dstsz) == 1 &amp;&amp; dst[0]) {</div>
<div class="line"><span class="lineno">  693</span>        <a class="code hl_define" href="weights_8c.html#a2243a7a621a65f66170ede427763ee2d">WLOGD</a>(<span class="stringliteral">&quot;scan_json_best_effort_bin: found key=&#39;iebin.weights_bin&#39; value=&#39;%s&#39;&quot;</span>, dst);</div>
<div class="line"><span class="lineno">  694</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  695</span>      }</div>
<div class="line"><span class="lineno">  696</span>    }</div>
<div class="line"><span class="lineno">  697</span>  }</div>
<div class="line"><span class="lineno">  698</span> </div>
<div class="line"><span class="lineno">  699</span>  <a class="code hl_define" href="weights_8c.html#a92c7e58c96077a0c401dbfd6c4196f1a">WLOGW</a>(<span class="stringliteral">&quot;scan_json_best_effort_bin: no recognized bin key found&quot;</span>);</div>
<div class="line"><span class="lineno">  700</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  701</span>}</div>
<div class="ttc" id="aweights_8c_html_a110cc679cd45b43c11f22ba749bd0ea3"><div class="ttname"><a href="weights_8c.html#a110cc679cd45b43c11f22ba749bd0ea3">scan_json_key_string_in_range</a></div><div class="ttdeci">static int scan_json_key_string_in_range(const char *begin, const char *end, const char *key, char *dst, size_t dstsz)</div><div class="ttdoc">Scan for a string key within a bounded [begin,end] range.</div><div class="ttdef"><b>Definition</b> <a href="weights_8c_source.html#l00580">weights.c:580</a></div></div>
<div class="ttc" id="aweights_8c_html_a853d256b28c7e6c404c035fc1a16a454"><div class="ttname"><a href="weights_8c.html#a853d256b28c7e6c404c035fc1a16a454">scan_json_object_range</a></div><div class="ttdeci">static int scan_json_object_range(const char *json, const char *key, const char **out_begin, const char **out_end)</div><div class="ttdoc">Locate the interior byte range of an object value &quot;{ ... }&quot; for a key.</div><div class="ttdef"><b>Definition</b> <a href="weights_8c_source.html#l00512">weights.c:512</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="weights_8c_source.html#l00467">scan_json_key_string()</a>, <a class="el" href="weights_8c_source.html#l00580">scan_json_key_string_in_range()</a>, <a class="el" href="weights_8c_source.html#l00512">scan_json_object_range()</a>, <a class="el" href="weights_8c_source.html#l00149">WLOGD</a>, and <a class="el" href="weights_8c_source.html#l00156">WLOGW</a>.</p>

<p class="reference">Referenced by <a class="el" href="weights_8c_source.html#l00988">ie_weights_open()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="weights_8c_a3c6343a4152588f4f490f3263842c7f6_cgraph.svg" width="626" height="151"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="weights_8c_a3c6343a4152588f4f490f3263842c7f6_icgraph.svg" width="664" height="184"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a5c6ba72035c0c5110c91879350c8647f" name="a5c6ba72035c0c5110c91879350c8647f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5c6ba72035c0c5110c91879350c8647f">&#9670;&#160;</a></span>scan_json_key_int()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int scan_json_key_int </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>json</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>out_val</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Scan a relaxed JSON blob for an integer value at a given key. </p>
<p>This is a best-effort scan that:</p><ul>
<li>searches for <code>"key"</code> occurrences,</li>
<li>expects a ':' after the key,</li>
<li>parses a base-10 integer with strtol().</li>
</ul>
<p>It does not validate full JSON structure.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">json</td><td>NUL-terminated text. </td></tr>
    <tr><td class="paramname">key</td><td>Key name without quotes (e.g., "version"). </td></tr>
    <tr><td class="paramname">out_val</td><td>Output integer. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 if found, 0 if not found, negative on invalid args. </dd></dl>

<p class="definition">Definition at line <a class="el" href="weights_8c_source.html#l00374">374</a> of file <a class="el" href="weights_8c_source.html">weights.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  374</span>                                                                              {</div>
<div class="line"><span class="lineno">  375</span>  <span class="keywordflow">if</span> (!json || !key || !out_val) <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  376</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *p = json;</div>
<div class="line"><span class="lineno">  377</span>  <span class="keyword">const</span> <span class="keywordtype">size_t</span> klen = strlen(key);</div>
<div class="line"><span class="lineno">  378</span>  <span class="keywordflow">while</span> ((p = strstr(p, <span class="stringliteral">&quot;\&quot;&quot;</span>))) {</div>
<div class="line"><span class="lineno">  379</span>    ++p;</div>
<div class="line"><span class="lineno">  380</span>    <span class="keywordflow">if</span> (strncmp(p, key, klen) == 0 &amp;&amp; p[klen] == <span class="charliteral">&#39;&quot;&#39;</span>) {</div>
<div class="line"><span class="lineno">  381</span>      <span class="keyword">const</span> <span class="keywordtype">char</span> *c = p + klen + 1;</div>
<div class="line"><span class="lineno">  382</span>      c = <a class="code hl_function" href="weights_8c.html#ae19e0ad12742fe7fdff22f60436aadc7">skip_ws</a>(c);</div>
<div class="line"><span class="lineno">  383</span>      <span class="keywordflow">if</span> (!c || *c != <span class="charliteral">&#39;:&#39;</span>) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  384</span>      ++c;</div>
<div class="line"><span class="lineno">  385</span>      c = <a class="code hl_function" href="weights_8c.html#ae19e0ad12742fe7fdff22f60436aadc7">skip_ws</a>(c);</div>
<div class="line"><span class="lineno">  386</span>      <span class="keywordflow">if</span> (!c) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  387</span>      <span class="keywordtype">char</span> *end = NULL;</div>
<div class="line"><span class="lineno">  388</span>      <span class="keywordtype">long</span> v = strtol(c, &amp;end, 10);</div>
<div class="line"><span class="lineno">  389</span>      <span class="keywordflow">if</span> (end &amp;&amp; end != c) {</div>
<div class="line"><span class="lineno">  390</span>        *out_val = (int)v;</div>
<div class="line"><span class="lineno">  391</span>        <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  392</span>      }</div>
<div class="line"><span class="lineno">  393</span>    }</div>
<div class="line"><span class="lineno">  394</span>  }</div>
<div class="line"><span class="lineno">  395</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  396</span>}</div>
<div class="ttc" id="aweights_8c_html_ae19e0ad12742fe7fdff22f60436aadc7"><div class="ttname"><a href="weights_8c.html#ae19e0ad12742fe7fdff22f60436aadc7">skip_ws</a></div><div class="ttdeci">static const char * skip_ws(const char *p)</div><div class="ttdoc">Skip ASCII whitespace characters in a string.</div><div class="ttdef"><b>Definition</b> <a href="weights_8c_source.html#l00194">weights.c:194</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="weights_8c_source.html#l00194">skip_ws()</a>.</p>

<p class="reference">Referenced by <a class="el" href="weights_8c_source.html#l00988">ie_weights_open()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="weights_8c_a5c6ba72035c0c5110c91879350c8647f_cgraph.svg" width="274" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="weights_8c_a5c6ba72035c0c5110c91879350c8647f_icgraph.svg" width="614" height="184"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a3c438658d11f74ba4af8273c7e390311" name="a3c438658d11f74ba4af8273c7e390311"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c438658d11f74ba4af8273c7e390311">&#9670;&#160;</a></span>scan_json_key_string()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int scan_json_key_string </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>json</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>dstsz</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Scan a relaxed JSON blob for a string value at a given key. </p>
<p>Finds <code>"key": "value"</code> and copies a minimally unescaped <code>value</code> into <code>dst</code>. This scan does not validate full JSON structure; it is tolerant to extra whitespace and unrelated fields.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">json</td><td>NUL-terminated JSON-ish text. </td></tr>
    <tr><td class="paramname">key</td><td>Key name without quotes. </td></tr>
    <tr><td class="paramname">dst</td><td>Output buffer. </td></tr>
    <tr><td class="paramname">dstsz</td><td>Output capacity. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 if found, 0 if not found, negative on invalid args. </dd></dl>

<p class="definition">Definition at line <a class="el" href="weights_8c_source.html#l00467">467</a> of file <a class="el" href="weights_8c_source.html">weights.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  467</span>                                                                                            {</div>
<div class="line"><span class="lineno">  468</span>  <span class="keywordflow">if</span> (!json || !key || !dst || dstsz == 0) <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  469</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a415d14a7ade776b6bb2e544f0be25e6b">dst</a>[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  470</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *p = json;</div>
<div class="line"><span class="lineno">  471</span>  <span class="keyword">const</span> <span class="keywordtype">size_t</span> klen = strlen(key);</div>
<div class="line"><span class="lineno">  472</span>  <span class="keywordflow">while</span> ((p = strstr(p, <span class="stringliteral">&quot;\&quot;&quot;</span>))) {</div>
<div class="line"><span class="lineno">  473</span>    ++p;</div>
<div class="line"><span class="lineno">  474</span>    <span class="keywordflow">if</span> (strncmp(p, key, klen) == 0 &amp;&amp; p[klen] == <span class="charliteral">&#39;&quot;&#39;</span>) {</div>
<div class="line"><span class="lineno">  475</span>      <span class="keyword">const</span> <span class="keywordtype">char</span> *c = p + klen + 1;</div>
<div class="line"><span class="lineno">  476</span>      c = <a class="code hl_function" href="weights_8c.html#ae19e0ad12742fe7fdff22f60436aadc7">skip_ws</a>(c);</div>
<div class="line"><span class="lineno">  477</span>      <span class="keywordflow">if</span> (!c || *c != <span class="charliteral">&#39;:&#39;</span>) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  478</span>      ++c;</div>
<div class="line"><span class="lineno">  479</span>      c = <a class="code hl_function" href="weights_8c.html#ae19e0ad12742fe7fdff22f60436aadc7">skip_ws</a>(c);</div>
<div class="line"><span class="lineno">  480</span>      <span class="keywordflow">if</span> (!c || *c != <span class="charliteral">&#39;&quot;&#39;</span>) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  481</span>      ++c;</div>
<div class="line"><span class="lineno">  482</span> </div>
<div class="line"><span class="lineno">  483</span>      <span class="keyword">const</span> <span class="keywordtype">char</span> *start = c;</div>
<div class="line"><span class="lineno">  484</span>      <span class="keywordflow">while</span> (*c) {</div>
<div class="line"><span class="lineno">  485</span>        <span class="keywordflow">if</span> (*c == <span class="charliteral">&#39;&quot;&#39;</span> &amp;&amp; (c == start || c[-1] != <span class="charliteral">&#39;\\&#39;</span>)) <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  486</span>        ++c;</div>
<div class="line"><span class="lineno">  487</span>      }</div>
<div class="line"><span class="lineno">  488</span>      <span class="keywordflow">if</span> (*c != <span class="charliteral">&#39;&quot;&#39;</span>) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  489</span> </div>
<div class="line"><span class="lineno">  490</span>      <span class="keywordtype">size_t</span> raw_len = (size_t)(c - start);</div>
<div class="line"><span class="lineno">  491</span>      (void)<a class="code hl_function" href="weights_8c.html#a173309f164a3d6851b64ca6a5ad733c9">json_unescape_into</a>(dst, dstsz, start, raw_len);</div>
<div class="line"><span class="lineno">  492</span>      <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  493</span>    }</div>
<div class="line"><span class="lineno">  494</span>  }</div>
<div class="line"><span class="lineno">  495</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  496</span>}</div>
<div class="ttc" id="aweights_8c_html_a173309f164a3d6851b64ca6a5ad733c9"><div class="ttname"><a href="weights_8c.html#a173309f164a3d6851b64ca6a5ad733c9">json_unescape_into</a></div><div class="ttdeci">static size_t json_unescape_into(char *dst, size_t dstsz, const char *src, size_t srclen)</div><div class="ttdoc">Unescape a JSON string into a destination buffer (best-effort).</div><div class="ttdef"><b>Definition</b> <a href="weights_8c_source.html#l00415">weights.c:415</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="weights_8c_source.html#l00415">json_unescape_into()</a>, and <a class="el" href="weights_8c_source.html#l00194">skip_ws()</a>.</p>

<p class="reference">Referenced by <a class="el" href="weights_8c_source.html#l00988">ie_weights_open()</a>, and <a class="el" href="weights_8c_source.html#l00643">scan_json_best_effort_bin()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="weights_8c_a3c438658d11f74ba4af8273c7e390311_cgraph.svg" width="370" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="weights_8c_a3c438658d11f74ba4af8273c7e390311_icgraph.svg" width="100%" height="438"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a110cc679cd45b43c11f22ba749bd0ea3" name="a110cc679cd45b43c11f22ba749bd0ea3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a110cc679cd45b43c11f22ba749bd0ea3">&#9670;&#160;</a></span>scan_json_key_string_in_range()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int scan_json_key_string_in_range </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>begin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>dstsz</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Scan for a string key within a bounded [begin,end] range. </p>
<p>This is used for nested objects discovered by <a class="el" href="weights_8c.html#a853d256b28c7e6c404c035fc1a16a454" title="Locate the interior byte range of an object value &quot;{ ... }&quot; for a key.">scan_json_object_range()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">begin</td><td>Range begin. </td></tr>
    <tr><td class="paramname">end</td><td>Range end (inclusive, points to closing brace or last valid byte). </td></tr>
    <tr><td class="paramname">key</td><td>Key name. </td></tr>
    <tr><td class="paramname">dst</td><td>Output buffer. </td></tr>
    <tr><td class="paramname">dstsz</td><td>Output capacity. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 if found, 0 if not found, negative on invalid args. </dd></dl>

<p class="definition">Definition at line <a class="el" href="weights_8c_source.html#l00580">580</a> of file <a class="el" href="weights_8c_source.html">weights.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  581</span>                                                                  {</div>
<div class="line"><span class="lineno">  582</span>  <span class="keywordflow">if</span> (!begin || !end || !key || !dst || dstsz == 0) <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  583</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a415d14a7ade776b6bb2e544f0be25e6b">dst</a>[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  584</span>  <span class="keywordflow">if</span> (end &lt; begin) <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  585</span> </div>
<div class="line"><span class="lineno">  586</span>  <span class="keyword">const</span> <span class="keywordtype">size_t</span> klen = strlen(key);</div>
<div class="line"><span class="lineno">  587</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *p = begin;</div>
<div class="line"><span class="lineno">  588</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *limit = end + 1;</div>
<div class="line"><span class="lineno">  589</span> </div>
<div class="line"><span class="lineno">  590</span>  <span class="keywordflow">while</span> (p &lt; limit) {</div>
<div class="line"><span class="lineno">  591</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *q = memchr(p, <span class="charliteral">&#39;&quot;&#39;</span>, (<span class="keywordtype">size_t</span>)(limit - p));</div>
<div class="line"><span class="lineno">  592</span>    <span class="keywordflow">if</span> (!q) <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  593</span>    ++q;</div>
<div class="line"><span class="lineno">  594</span>    <span class="keywordflow">if</span> ((<span class="keywordtype">size_t</span>)(limit - q) &gt;= klen &amp;&amp; memcmp(q, key, klen) == 0 &amp;&amp; q[klen] == <span class="charliteral">&#39;&quot;&#39;</span>) {</div>
<div class="line"><span class="lineno">  595</span>      <span class="keyword">const</span> <span class="keywordtype">char</span> *c = q + klen + 1;</div>
<div class="line"><span class="lineno">  596</span>      c = <a class="code hl_function" href="weights_8c.html#ae19e0ad12742fe7fdff22f60436aadc7">skip_ws</a>(c);</div>
<div class="line"><span class="lineno">  597</span>      <span class="keywordflow">if</span> (!c || c &gt;= limit || *c != <span class="charliteral">&#39;:&#39;</span>) {</div>
<div class="line"><span class="lineno">  598</span>        p = q + 1;</div>
<div class="line"><span class="lineno">  599</span>        <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  600</span>      }</div>
<div class="line"><span class="lineno">  601</span>      ++c;</div>
<div class="line"><span class="lineno">  602</span>      c = <a class="code hl_function" href="weights_8c.html#ae19e0ad12742fe7fdff22f60436aadc7">skip_ws</a>(c);</div>
<div class="line"><span class="lineno">  603</span>      <span class="keywordflow">if</span> (!c || c &gt;= limit || *c != <span class="charliteral">&#39;&quot;&#39;</span>) {</div>
<div class="line"><span class="lineno">  604</span>        p = q + 1;</div>
<div class="line"><span class="lineno">  605</span>        <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  606</span>      }</div>
<div class="line"><span class="lineno">  607</span>      ++c;</div>
<div class="line"><span class="lineno">  608</span> </div>
<div class="line"><span class="lineno">  609</span>      <span class="keyword">const</span> <span class="keywordtype">char</span> *start = c;</div>
<div class="line"><span class="lineno">  610</span>      <span class="keywordflow">while</span> (c &lt; limit) {</div>
<div class="line"><span class="lineno">  611</span>        <span class="keywordflow">if</span> (*c == <span class="charliteral">&#39;&quot;&#39;</span> &amp;&amp; (c == start || c[-1] != <span class="charliteral">&#39;\\&#39;</span>)) <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  612</span>        ++c;</div>
<div class="line"><span class="lineno">  613</span>      }</div>
<div class="line"><span class="lineno">  614</span>      <span class="keywordflow">if</span> (c &gt;= limit || *c != <span class="charliteral">&#39;&quot;&#39;</span>) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  615</span> </div>
<div class="line"><span class="lineno">  616</span>      <span class="keywordtype">size_t</span> raw_len = (size_t)(c - start);</div>
<div class="line"><span class="lineno">  617</span>      (void)<a class="code hl_function" href="weights_8c.html#a173309f164a3d6851b64ca6a5ad733c9">json_unescape_into</a>(dst, dstsz, start, raw_len);</div>
<div class="line"><span class="lineno">  618</span>      <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  619</span>    }</div>
<div class="line"><span class="lineno">  620</span>    p = q + 1;</div>
<div class="line"><span class="lineno">  621</span>  }</div>
<div class="line"><span class="lineno">  622</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  623</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="weights_8c_source.html#l00415">json_unescape_into()</a>, and <a class="el" href="weights_8c_source.html#l00194">skip_ws()</a>.</p>

<p class="reference">Referenced by <a class="el" href="weights_8c_source.html#l00643">scan_json_best_effort_bin()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="weights_8c_a110cc679cd45b43c11f22ba749bd0ea3_cgraph.svg" width="370" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="weights_8c_a110cc679cd45b43c11f22ba749bd0ea3_icgraph.svg" width="100%" height="438"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a853d256b28c7e6c404c035fc1a16a454" name="a853d256b28c7e6c404c035fc1a16a454"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a853d256b28c7e6c404c035fc1a16a454">&#9670;&#160;</a></span>scan_json_object_range()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int scan_json_object_range </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>json</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char **&#160;</td>
          <td class="paramname"><em>out_begin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char **&#160;</td>
          <td class="paramname"><em>out_end</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Locate the interior byte range of an object value "{ ... }" for a key. </p>
<p>This helper attempts to locate <code>"key": { ... }</code> and returns a range that covers the interior of the braces. Strings are respected when tracking brace depth to avoid premature termination.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">json</td><td>JSON-ish text. </td></tr>
    <tr><td class="paramname">key</td><td>Object key to find. </td></tr>
    <tr><td class="paramname">out_begin</td><td>Output begin pointer (inside the braces). </td></tr>
    <tr><td class="paramname">out_end</td><td>Output end pointer (points to closing brace). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 if found, 0 if not found/malformed, negative on invalid args. </dd></dl>

<p class="definition">Definition at line <a class="el" href="weights_8c_source.html#l00512">512</a> of file <a class="el" href="weights_8c_source.html">weights.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  513</span>                                                        {</div>
<div class="line"><span class="lineno">  514</span>  <span class="keywordflow">if</span> (!json || !key || !out_begin || !out_end) <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  515</span>  *out_begin = *out_end = NULL;</div>
<div class="line"><span class="lineno">  516</span> </div>
<div class="line"><span class="lineno">  517</span>  <span class="keyword">const</span> <span class="keywordtype">size_t</span> klen = strlen(key);</div>
<div class="line"><span class="lineno">  518</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *p = json;</div>
<div class="line"><span class="lineno">  519</span>  <span class="keywordflow">while</span> ((p = strstr(p, <span class="stringliteral">&quot;\&quot;&quot;</span>))) {</div>
<div class="line"><span class="lineno">  520</span>    ++p;</div>
<div class="line"><span class="lineno">  521</span>    <span class="keywordflow">if</span> (strncmp(p, key, klen) == 0 &amp;&amp; p[klen] == <span class="charliteral">&#39;&quot;&#39;</span>) {</div>
<div class="line"><span class="lineno">  522</span>      <span class="keyword">const</span> <span class="keywordtype">char</span> *c = p + klen + 1;</div>
<div class="line"><span class="lineno">  523</span>      c = <a class="code hl_function" href="weights_8c.html#ae19e0ad12742fe7fdff22f60436aadc7">skip_ws</a>(c);</div>
<div class="line"><span class="lineno">  524</span>      <span class="keywordflow">if</span> (!c || *c != <span class="charliteral">&#39;:&#39;</span>) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  525</span>      ++c;</div>
<div class="line"><span class="lineno">  526</span>      c = <a class="code hl_function" href="weights_8c.html#ae19e0ad12742fe7fdff22f60436aadc7">skip_ws</a>(c);</div>
<div class="line"><span class="lineno">  527</span>      <span class="keywordflow">if</span> (!c || *c != <span class="charliteral">&#39;{&#39;</span>) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  528</span> </div>
<div class="line"><span class="lineno">  529</span>      <span class="keywordtype">int</span> depth = 0;</div>
<div class="line"><span class="lineno">  530</span>      <span class="keyword">const</span> <span class="keywordtype">char</span> *start = c + 1;</div>
<div class="line"><span class="lineno">  531</span>      <span class="keyword">const</span> <span class="keywordtype">char</span> *q = c;</div>
<div class="line"><span class="lineno">  532</span>      <span class="keywordtype">int</span> in_str = 0;</div>
<div class="line"><span class="lineno">  533</span>      <span class="keywordflow">while</span> (*q) {</div>
<div class="line"><span class="lineno">  534</span>        <span class="keywordtype">char</span> ch = *q;</div>
<div class="line"><span class="lineno">  535</span>        <span class="keywordflow">if</span> (in_str) {</div>
<div class="line"><span class="lineno">  536</span>          <span class="keywordflow">if</span> (ch == <span class="charliteral">&#39;\\&#39;</span> &amp;&amp; q[1]) {</div>
<div class="line"><span class="lineno">  537</span>            q += 2;</div>
<div class="line"><span class="lineno">  538</span>            <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  539</span>          }</div>
<div class="line"><span class="lineno">  540</span>          <span class="keywordflow">if</span> (ch == <span class="charliteral">&#39;&quot;&#39;</span>) in_str = 0;</div>
<div class="line"><span class="lineno">  541</span>          ++q;</div>
<div class="line"><span class="lineno">  542</span>          <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  543</span>        }</div>
<div class="line"><span class="lineno">  544</span> </div>
<div class="line"><span class="lineno">  545</span>        <span class="keywordflow">if</span> (ch == <span class="charliteral">&#39;&quot;&#39;</span>) {</div>
<div class="line"><span class="lineno">  546</span>          in_str = 1;</div>
<div class="line"><span class="lineno">  547</span>          ++q;</div>
<div class="line"><span class="lineno">  548</span>          <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  549</span>        }</div>
<div class="line"><span class="lineno">  550</span>        <span class="keywordflow">if</span> (ch == <span class="charliteral">&#39;{&#39;</span>) ++depth;</div>
<div class="line"><span class="lineno">  551</span>        <span class="keywordflow">if</span> (ch == <span class="charliteral">&#39;}&#39;</span>) {</div>
<div class="line"><span class="lineno">  552</span>          --depth;</div>
<div class="line"><span class="lineno">  553</span>          <span class="keywordflow">if</span> (depth == 0) {</div>
<div class="line"><span class="lineno">  554</span>            *out_begin = start;</div>
<div class="line"><span class="lineno">  555</span>            *out_end = q;</div>
<div class="line"><span class="lineno">  556</span>            <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  557</span>          }</div>
<div class="line"><span class="lineno">  558</span>        }</div>
<div class="line"><span class="lineno">  559</span>        ++q;</div>
<div class="line"><span class="lineno">  560</span>      }</div>
<div class="line"><span class="lineno">  561</span>      <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  562</span>    }</div>
<div class="line"><span class="lineno">  563</span>  }</div>
<div class="line"><span class="lineno">  564</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  565</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="weights_8c_source.html#l00194">skip_ws()</a>.</p>

<p class="reference">Referenced by <a class="el" href="weights_8c_source.html#l00643">scan_json_best_effort_bin()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="weights_8c_a853d256b28c7e6c404c035fc1a16a454_cgraph.svg" width="311" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="weights_8c_a853d256b28c7e6c404c035fc1a16a454_icgraph.svg" width="100%" height="438"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="ae19e0ad12742fe7fdff22f60436aadc7" name="ae19e0ad12742fe7fdff22f60436aadc7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae19e0ad12742fe7fdff22f60436aadc7">&#9670;&#160;</a></span>skip_ws()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static const char * skip_ws </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>p</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Skip ASCII whitespace characters in a string. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p</td><td>Input pointer (may be NULL). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Pointer advanced past whitespace, or NULL if <code>p</code> is NULL. </dd></dl>

<p class="definition">Definition at line <a class="el" href="weights_8c_source.html#l00194">194</a> of file <a class="el" href="weights_8c_source.html">weights.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  194</span>                                          {</div>
<div class="line"><span class="lineno">  195</span>  <span class="keywordflow">if</span> (!p) <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  196</span>  <span class="keywordflow">while</span> (*p == <span class="charliteral">&#39; &#39;</span> || *p == <span class="charliteral">&#39;\t&#39;</span> || *p == <span class="charliteral">&#39;\r&#39;</span> || *p == <span class="charliteral">&#39;\n&#39;</span>) ++p;</div>
<div class="line"><span class="lineno">  197</span>  <span class="keywordflow">return</span> p;</div>
<div class="line"><span class="lineno">  198</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="weights_8c_source.html#l00374">scan_json_key_int()</a>, <a class="el" href="weights_8c_source.html#l00467">scan_json_key_string()</a>, <a class="el" href="weights_8c_source.html#l00580">scan_json_key_string_in_range()</a>, and <a class="el" href="weights_8c_source.html#l00512">scan_json_object_range()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="weights_8c_ae19e0ad12742fe7fdff22f60436aadc7_icgraph.svg" width="100%" height="469"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="ae3235e5160399c1e4465d1abf866571d" name="ae3235e5160399c1e4465d1abf866571d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae3235e5160399c1e4465d1abf866571d">&#9670;&#160;</a></span>touch_file_small()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int touch_file_small </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Touch a file by doing small reads near start/end. </p>
<p>This is intended as a fast readability check and optional OS cache warming. It is deliberately minimal and does not attempt to validate file contents.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">path</td><td>Path to file. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 if read succeeded, 0 otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="weights_8c_source.html#l00933">933</a> of file <a class="el" href="weights_8c_source.html">weights.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  933</span>                                              {</div>
<div class="line"><span class="lineno">  934</span>  <span class="keywordflow">if</span> (!path || !*path) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  935</span>  <span class="keywordtype">int</span> fd = open(path, O_RDONLY);</div>
<div class="line"><span class="lineno">  936</span>  <span class="keywordflow">if</span> (fd &lt; 0) {</div>
<div class="line"><span class="lineno">  937</span>    <a class="code hl_function" href="weights_8c.html#a88ec341995312abc5fbbd4084389523e">wlog_errno_</a>(<span class="stringliteral">&quot;open&quot;</span>, path);</div>
<div class="line"><span class="lineno">  938</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  939</span>  }</div>
<div class="line"><span class="lineno">  940</span> </div>
<div class="line"><span class="lineno">  941</span>  <span class="keyword">struct </span>stat st;</div>
<div class="line"><span class="lineno">  942</span>  <span class="keywordflow">if</span> (fstat(fd, &amp;st) != 0 || st.st_size &lt; 0) {</div>
<div class="line"><span class="lineno">  943</span>    <a class="code hl_function" href="weights_8c.html#a88ec341995312abc5fbbd4084389523e">wlog_errno_</a>(<span class="stringliteral">&quot;fstat&quot;</span>, path);</div>
<div class="line"><span class="lineno">  944</span>    close(fd);</div>
<div class="line"><span class="lineno">  945</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  946</span>  }</div>
<div class="line"><span class="lineno">  947</span> </div>
<div class="line"><span class="lineno">  948</span>  <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> buf[4096];</div>
<div class="line"><span class="lineno">  949</span>  ssize_t r1 = <a class="code hl_function" href="weights_8c.html#aabb19f4a5e5385962c6db57f611bb785">ie_pread</a>(fd, buf, <span class="keyword">sizeof</span>(buf), 0);</div>
<div class="line"><span class="lineno">  950</span>  ssize_t r2 = 0;</div>
<div class="line"><span class="lineno">  951</span>  <span class="keywordflow">if</span> ((<span class="keywordtype">size_t</span>)st.st_size &gt; <span class="keyword">sizeof</span>(buf)) {</div>
<div class="line"><span class="lineno">  952</span>    off_t off = (off_t)((<span class="keywordtype">size_t</span>)st.st_size - <span class="keyword">sizeof</span>(buf));</div>
<div class="line"><span class="lineno">  953</span>    r2 = <a class="code hl_function" href="weights_8c.html#aabb19f4a5e5385962c6db57f611bb785">ie_pread</a>(fd, buf, <span class="keyword">sizeof</span>(buf), off);</div>
<div class="line"><span class="lineno">  954</span>  }</div>
<div class="line"><span class="lineno">  955</span>  close(fd);</div>
<div class="line"><span class="lineno">  956</span> </div>
<div class="line"><span class="lineno">  957</span>  <span class="keywordflow">if</span> (r1 &lt; 0 || r2 &lt; 0) {</div>
<div class="line"><span class="lineno">  958</span>    <a class="code hl_define" href="weights_8c.html#a92c7e58c96077a0c401dbfd6c4196f1a">WLOGW</a>(<span class="stringliteral">&quot;touch_file_small: read failed path=&#39;%s&#39; size=%zu&quot;</span>, path, (<span class="keywordtype">size_t</span>)st.st_size);</div>
<div class="line"><span class="lineno">  959</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  960</span>  }</div>
<div class="line"><span class="lineno">  961</span> </div>
<div class="line"><span class="lineno">  962</span>  <a class="code hl_define" href="weights_8c.html#a2243a7a621a65f66170ede427763ee2d">WLOGD</a>(<span class="stringliteral">&quot;touch_file_small: ok path=&#39;%s&#39; size=%zu&quot;</span>, path, (<span class="keywordtype">size_t</span>)st.st_size);</div>
<div class="line"><span class="lineno">  963</span>  <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  964</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="weights_8c_source.html#l00716">ie_pread()</a>, <a class="el" href="weights_8c_source.html#l00175">wlog_errno_()</a>, <a class="el" href="weights_8c_source.html#l00149">WLOGD</a>, and <a class="el" href="weights_8c_source.html#l00156">WLOGW</a>.</p>

<p class="reference">Referenced by <a class="el" href="weights_8c_source.html#l01183">ie_weights_touch()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="weights_8c_ae3235e5160399c1e4465d1abf866571d_cgraph.svg" width="100%" height="364"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="weights_8c_ae3235e5160399c1e4465d1abf866571d_icgraph.svg" width="600" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a88ec341995312abc5fbbd4084389523e" name="a88ec341995312abc5fbbd4084389523e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a88ec341995312abc5fbbd4084389523e">&#9670;&#160;</a></span>wlog_errno_()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void wlog_errno_ </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>what</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Log an errno-based failure with contextual path information. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">what</td><td>Short operation label (e.g., "fopen", "stat"). </td></tr>
    <tr><td class="paramname">path</td><td>Associated file path (may be NULL). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="weights_8c_source.html#l00175">175</a> of file <a class="el" href="weights_8c_source.html">weights.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  175</span>                                                            {</div>
<div class="line"><span class="lineno">  176</span>  <span class="keywordflow">if</span> (!<a class="code hl_function" href="weights_8c.html#a684245f67e867bda9a255505a8e5f68b">ie_weights_log_enabled</a>(1)) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  177</span>  <span class="keywordflow">if</span> (path &amp;&amp; *path) {</div>
<div class="line"><span class="lineno">  178</span>    <a class="code hl_define" href="weights_8c.html#af8239319fc44fa28e836591e9ac89c02">WLOGE</a>(<span class="stringliteral">&quot;%s failed: path=&#39;%s&#39; errno=%d (%s)&quot;</span>, what, path, errno, strerror(errno));</div>
<div class="line"><span class="lineno">  179</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  180</span>    <a class="code hl_define" href="weights_8c.html#af8239319fc44fa28e836591e9ac89c02">WLOGE</a>(<span class="stringliteral">&quot;%s failed: errno=%d (%s)&quot;</span>, what, errno, strerror(errno));</div>
<div class="line"><span class="lineno">  181</span>  }</div>
<div class="line"><span class="lineno">  182</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="weights_8c_source.html#l00137">ie_weights_log_enabled()</a>, and <a class="el" href="weights_8c_source.html#l00163">WLOGE</a>.</p>

<p class="reference">Referenced by <a class="el" href="weights_8c_source.html#l00867">ensure_dedup_manifest_link()</a>, <a class="el" href="weights_8c_source.html#l00988">ie_weights_open()</a>, <a class="el" href="weights_8c_source.html#l01183">ie_weights_touch()</a>, <a class="el" href="weights_8c_source.html#l00297">read_all_text()</a>, <a class="el" href="weights_8c_source.html#l00933">touch_file_small()</a>, and <a class="el" href="weights_8c_source.html#l00798">write_all_bytes_()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="weights_8c_a88ec341995312abc5fbbd4084389523e_cgraph.svg" width="546" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="weights_8c_a88ec341995312abc5fbbd4084389523e_icgraph.svg" width="100%" height="511"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a58a74ad7b283929166fa3d00c2c59b60" name="a58a74ad7b283929166fa3d00c2c59b60"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a58a74ad7b283929166fa3d00c2c59b60">&#9670;&#160;</a></span>write_all_bytes_()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int write_all_bytes_ </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Create a best-effort model.dedup.json manifest for runtime dedup. </p>
<p>The runtime dedup loader expects a file named "model.dedup.json" in the model directory. Some pipelines emit the same JSON under different names.</p>
<p>This helper attempts to:</p><ul>
<li>locate an existing manifest under a set of common alternative filenames (or a user-provided IE_DEDUP_MANIFEST override), then</li>
<li>create "model.dedup.json" as a symlink pointing at that file, and</li>
<li>fall back to copying the file if symlinks are unavailable.</li>
</ul>
<p>Failures are not fatal unless the caller is operating under strict mode.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dir</td><td>Directory containing the artifacts. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 if model.dedup.json ends up readable, else 0. </dd></dl>

<p class="definition">Definition at line <a class="el" href="weights_8c_source.html#l00798">798</a> of file <a class="el" href="weights_8c_source.html">weights.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  798</span>                                                                            {</div>
<div class="line"><span class="lineno">  799</span>  <span class="keywordflow">if</span> (!path || !*path || (!data &amp;&amp; len != 0)) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  800</span>  FILE *f = fopen(path, <span class="stringliteral">&quot;wb&quot;</span>);</div>
<div class="line"><span class="lineno">  801</span>  <span class="keywordflow">if</span> (!f) {</div>
<div class="line"><span class="lineno">  802</span>    <a class="code hl_function" href="weights_8c.html#a88ec341995312abc5fbbd4084389523e">wlog_errno_</a>(<span class="stringliteral">&quot;fopen&quot;</span>, path);</div>
<div class="line"><span class="lineno">  803</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  804</span>  }</div>
<div class="line"><span class="lineno">  805</span>  <span class="keywordtype">size_t</span> w = fwrite(data, 1, len, f);</div>
<div class="line"><span class="lineno">  806</span>  <span class="keywordflow">if</span> (fclose(f) != 0) {</div>
<div class="line"><span class="lineno">  807</span>    <a class="code hl_function" href="weights_8c.html#a88ec341995312abc5fbbd4084389523e">wlog_errno_</a>(<span class="stringliteral">&quot;fclose&quot;</span>, path);</div>
<div class="line"><span class="lineno">  808</span>  }</div>
<div class="line"><span class="lineno">  809</span>  <span class="keywordflow">return</span> (w == len) ? 1 : 0;</div>
<div class="line"><span class="lineno">  810</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="weights_8c_source.html#l00175">wlog_errno_()</a>.</p>

<p class="reference">Referenced by <a class="el" href="weights_8c_source.html#l00867">ensure_dedup_manifest_link()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="weights_8c_a58a74ad7b283929166fa3d00c2c59b60_cgraph.svg" width="100%" height="300"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="weights_8c_a58a74ad7b283929166fa3d00c2c59b60_icgraph.svg" width="100%" height="438"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_996f45160da62e1a3d7f6046fad68f51.html">engine</a></li><li class="navelem"><a class="el" href="dir_3d9126aa00c041bc0b8f859d1965a0f4.html">src</a></li><li class="navelem"><a class="el" href="dir_ca1f0cd6417c875f36bda237f81fbbd7.html">io</a></li><li class="navelem"><a class="el" href="weights_8c.html">weights.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
