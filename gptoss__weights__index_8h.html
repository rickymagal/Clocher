<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Inference Engine (Clocher): engine/include/gptoss_weights_index.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Inference Engine (Clocher)<span id="projectnumber">&#160;0.2</span>
   </div>
   <div id="projectbrief">C11 CPU/GPU inference baseline with strict metrics &amp; harness</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('gptoss__weights__index_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">gptoss_weights_index.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>GPT-OSS weight indexing and name-resolution over tensor_map.json and (optional) dedup views.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stddef.h&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
<code>#include &quot;<a class="el" href="ie__infer_8h_source.html">ie_infer.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="ie__io_8h_source.html">ie_io.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="tensor__map_8h_source.html">tensor_map.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="weights__dedup_8h_source.html">weights_dedup.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for gptoss_weights_index.h:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8h__incl.svg" width="100%" height="558"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8h__dep__incl.svg" width="192" height="139"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div>
<p><a href="gptoss__weights__index_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structgptoss__tensor__t.html">gptoss_tensor_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A resolved tensor handle.  <a href="structgptoss__tensor__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structgptoss__layer__weights__t.html">gptoss_layer_weights_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Per-layer weight handles for a GPT-OSS transformer block.  <a href="structgptoss__layer__weights__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structgptoss__model__weights__t.html">gptoss_model_weights_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Resolved weight handles for the full model.  <a href="structgptoss__model__weights__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a3024ccd4a9af5109d24e6c57565d74a1" id="r_a3024ccd4a9af5109d24e6c57565d74a1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8h.html#a3024ccd4a9af5109d24e6c57565d74a1">_POSIX_C_SOURCE</a>&#160;&#160;&#160;200809L</td></tr>
<tr class="separator:a3024ccd4a9af5109d24e6c57565d74a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="typedef-members" name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a289e6aa876014b24e4c0a0ba4b41dd63" id="r_a289e6aa876014b24e4c0a0ba4b41dd63"><td class="memItemLeft" align="right" valign="top">typedef enum <a class="el" href="gptoss__weights__index_8h.html#a5ba3978bcdac9a88ae300e42940692bd">gptoss_arch_kind_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8h.html#a289e6aa876014b24e4c0a0ba4b41dd63">gptoss_arch_kind_t</a></td></tr>
<tr class="separator:a289e6aa876014b24e4c0a0ba4b41dd63"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a966be24b11045de92b12361323a01f05" id="r_a966be24b11045de92b12361323a01f05"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structgptoss__tensor__t.html">gptoss_tensor_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8h.html#a966be24b11045de92b12361323a01f05">gptoss_tensor_t</a></td></tr>
<tr class="separator:a966be24b11045de92b12361323a01f05"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc8976f9939a31aa2944e534b4a73270" id="r_afc8976f9939a31aa2944e534b4a73270"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structgptoss__layer__weights__t.html">gptoss_layer_weights_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8h.html#afc8976f9939a31aa2944e534b4a73270">gptoss_layer_weights_t</a></td></tr>
<tr class="separator:afc8976f9939a31aa2944e534b4a73270"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa9dd761b1fb127f79be2ccfe98a4187d" id="r_aa9dd761b1fb127f79be2ccfe98a4187d"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structgptoss__model__weights__t.html">gptoss_model_weights_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8h.html#aa9dd761b1fb127f79be2ccfe98a4187d">gptoss_model_weights_t</a></td></tr>
<tr class="separator:aa9dd761b1fb127f79be2ccfe98a4187d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c735e5caa2875d3817c92123ba75198" id="r_a4c735e5caa2875d3817c92123ba75198"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structgptoss__weights__index__t.html">gptoss_weights_index_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8h.html#a4c735e5caa2875d3817c92123ba75198">gptoss_weights_index_t</a></td></tr>
<tr class="separator:a4c735e5caa2875d3817c92123ba75198"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="enum-members" name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a5ba3978bcdac9a88ae300e42940692bd" id="r_a5ba3978bcdac9a88ae300e42940692bd"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8h.html#a5ba3978bcdac9a88ae300e42940692bd">gptoss_arch_kind_t</a> { <a class="el" href="gptoss__weights__index_8h.html#a5ba3978bcdac9a88ae300e42940692bdae8e64fc15398950e8e54c4dbc859dcba">GPTOSS_ARCH_UNKNOWN</a> = 0
, <a class="el" href="gptoss__weights__index_8h.html#a5ba3978bcdac9a88ae300e42940692bdade1572936286502eb2604bbf70812e26">GPTOSS_ARCH_LLAMA</a> = 1
, <a class="el" href="gptoss__weights__index_8h.html#a5ba3978bcdac9a88ae300e42940692bdaca48309b567bec1419ac072f6057c724">GPTOSS_ARCH_GPTNEOX</a> = 2
 }</td></tr>
<tr class="memdesc:a5ba3978bcdac9a88ae300e42940692bd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Logical weight naming scheme detected in tensor_map.json.  <a href="gptoss__weights__index_8h.html#a5ba3978bcdac9a88ae300e42940692bd">More...</a><br /></td></tr>
<tr class="separator:a5ba3978bcdac9a88ae300e42940692bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab0abbe94d2373ea44d51f2325c7cc46c" id="r_ab0abbe94d2373ea44d51f2325c7cc46c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8h.html#ab0abbe94d2373ea44d51f2325c7cc46c">gptoss_weights_index_open</a> (<a class="el" href="structgptoss__weights__index__t.html">gptoss_weights_index_t</a> *out, const char *model_dir, const <a class="el" href="ie__io_8h.html#af68ad3cdc2eb244fe4feed94372d7806">ie_weights_t</a> *weights)</td></tr>
<tr class="memdesc:ab0abbe94d2373ea44d51f2325c7cc46c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Open a weights index for a given model directory and weights descriptor.  <br /></td></tr>
<tr class="separator:ab0abbe94d2373ea44d51f2325c7cc46c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a943d5a8178000a52f6148bdbccda2252" id="r_a943d5a8178000a52f6148bdbccda2252"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8h.html#a943d5a8178000a52f6148bdbccda2252">gptoss_weights_index_close</a> (<a class="el" href="structgptoss__weights__index__t.html">gptoss_weights_index_t</a> *idx)</td></tr>
<tr class="memdesc:a943d5a8178000a52f6148bdbccda2252"><td class="mdescLeft">&#160;</td><td class="mdescRight">Close an index and free all owned resources.  <br /></td></tr>
<tr class="separator:a943d5a8178000a52f6148bdbccda2252"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a121bde9c9fb693a485dd9bc9459a124f" id="r_a121bde9c9fb693a485dd9bc9459a124f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8h.html#a121bde9c9fb693a485dd9bc9459a124f">gptoss_weights_index_build_model</a> (const <a class="el" href="structgptoss__weights__index__t.html">gptoss_weights_index_t</a> *idx, const <a class="el" href="ie__infer_8h.html#a03b52084d74cc0c81a96a02ae842fcc7">ie_gptoss_hparams_t</a> *hp, <a class="el" href="structgptoss__model__weights__t.html">gptoss_model_weights_t</a> *out)</td></tr>
<tr class="memdesc:a121bde9c9fb693a485dd9bc9459a124f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Resolve and validate all tensors required by the GPT-OSS forward pass.  <br /></td></tr>
<tr class="separator:a121bde9c9fb693a485dd9bc9459a124f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d2ef0237f98560c09bff44c015e3b81" id="r_a8d2ef0237f98560c09bff44c015e3b81"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8h.html#a8d2ef0237f98560c09bff44c015e3b81">gptoss_model_weights_free</a> (<a class="el" href="structgptoss__model__weights__t.html">gptoss_model_weights_t</a> *mw)</td></tr>
<tr class="memdesc:a8d2ef0237f98560c09bff44c015e3b81"><td class="mdescLeft">&#160;</td><td class="mdescRight">Free the per-layer array allocated by <a class="el" href="gptoss__weights__index_8h.html#a121bde9c9fb693a485dd9bc9459a124f" title="Resolve and validate all tensors required by the GPT-OSS forward pass.">gptoss_weights_index_build_model</a>.  <br /></td></tr>
<tr class="separator:a8d2ef0237f98560c09bff44c015e3b81"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af45e8235976c0b4aa7cd57357c74e449" id="r_af45e8235976c0b4aa7cd57357c74e449"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8h.html#af45e8235976c0b4aa7cd57357c74e449">gptoss_tensor_is_valid</a> (const <a class="el" href="structgptoss__tensor__t.html">gptoss_tensor_t</a> *t)</td></tr>
<tr class="memdesc:af45e8235976c0b4aa7cd57357c74e449"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check whether a tensor handle is populated.  <br /></td></tr>
<tr class="separator:af45e8235976c0b4aa7cd57357c74e449"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95ad38a811c68d493a4103e19875720f" id="r_a95ad38a811c68d493a4103e19875720f"><td class="memItemLeft" align="right" valign="top">const uint8_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8h.html#a95ad38a811c68d493a4103e19875720f">gptoss_tensor_bytes</a> (const <a class="el" href="structgptoss__tensor__t.html">gptoss_tensor_t</a> *t)</td></tr>
<tr class="memdesc:a95ad38a811c68d493a4103e19875720f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return a direct pointer to tensor bytes if available.  <br /></td></tr>
<tr class="separator:a95ad38a811c68d493a4103e19875720f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad72abbe402df6e08a0fc9fa8bf0f7d64" id="r_ad72abbe402df6e08a0fc9fa8bf0f7d64"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8h.html#ad72abbe402df6e08a0fc9fa8bf0f7d64">gptoss_tensor_materialize</a> (const <a class="el" href="structgptoss__tensor__t.html">gptoss_tensor_t</a> *t, void *dst, size_t dst_nbytes)</td></tr>
<tr class="memdesc:ad72abbe402df6e08a0fc9fa8bf0f7d64"><td class="mdescLeft">&#160;</td><td class="mdescRight">Materialize tensor bytes into a caller-provided buffer.  <br /></td></tr>
<tr class="separator:ad72abbe402df6e08a0fc9fa8bf0f7d64"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>GPT-OSS weight indexing and name-resolution over tensor_map.json and (optional) dedup views. </p>
<p>Real inference requires fast access to model tensors (embedding, per-layer projection matrices, norms, and the LM head). In this repository, tensor payloads are described by <code>tensor_map.json</code> (logical name â†’ offset/shape/dtype) and stored in <code>model.ie.bin</code>. When IE_DEDUP is enabled, tensors may be stored losslessly in auxiliary blobs and materialized through the dedup loader.</p>
<p>This module provides:</p><ul>
<li>A loader for <code>tensor_map.json</code>.</li>
<li>A stable, explicit mapping of logical model components to resolved tensor names.</li>
<li>A small "tensor handle" abstraction that supports:<ul>
<li>direct pointers into <code>model.ie.bin</code> (non-dedup),</li>
<li>dedup views (direct or reconstructable),</li>
<li>best-effort shape/dtype validation.</li>
</ul>
</li>
</ul>
<p>The forward pass implementation should:</p><ul>
<li>call <a class="el" href="gptoss__weights__index_8h.html#ab0abbe94d2373ea44d51f2325c7cc46c" title="Open a weights index for a given model directory and weights descriptor.">gptoss_weights_index_open</a> once per model,</li>
<li>call <a class="el" href="gptoss__weights__index_8h.html#a121bde9c9fb693a485dd9bc9459a124f" title="Resolve and validate all tensors required by the GPT-OSS forward pass.">gptoss_weights_index_build_model</a> once to resolve all needed tensors,</li>
<li>then reuse the returned <a class="el" href="structgptoss__model__weights__t.html" title="Resolved weight handles for the full model.">gptoss_model_weights_t</a> throughout inference. </li>
</ul>

<p class="definition">Definition in file <a class="el" href="gptoss__weights__index_8h_source.html">gptoss_weights_index.h</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a3024ccd4a9af5109d24e6c57565d74a1" name="a3024ccd4a9af5109d24e6c57565d74a1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3024ccd4a9af5109d24e6c57565d74a1">&#9670;&#160;</a></span>_POSIX_C_SOURCE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _POSIX_C_SOURCE&#160;&#160;&#160;200809L</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="gptoss__weights__index_8h_source.html#l00034">34</a> of file <a class="el" href="gptoss__weights__index_8h_source.html">gptoss_weights_index.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="a289e6aa876014b24e4c0a0ba4b41dd63" name="a289e6aa876014b24e4c0a0ba4b41dd63"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a289e6aa876014b24e4c0a0ba4b41dd63">&#9670;&#160;</a></span>gptoss_arch_kind_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef enum <a class="el" href="gptoss__weights__index_8h.html#a5ba3978bcdac9a88ae300e42940692bd">gptoss_arch_kind_t</a> <a class="el" href="gptoss__weights__index_8h.html#a5ba3978bcdac9a88ae300e42940692bd">gptoss_arch_kind_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="afc8976f9939a31aa2944e534b4a73270" name="afc8976f9939a31aa2944e534b4a73270"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afc8976f9939a31aa2944e534b4a73270">&#9670;&#160;</a></span>gptoss_layer_weights_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structgptoss__layer__weights__t.html">gptoss_layer_weights_t</a> <a class="el" href="structgptoss__layer__weights__t.html">gptoss_layer_weights_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aa9dd761b1fb127f79be2ccfe98a4187d" name="aa9dd761b1fb127f79be2ccfe98a4187d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa9dd761b1fb127f79be2ccfe98a4187d">&#9670;&#160;</a></span>gptoss_model_weights_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structgptoss__model__weights__t.html">gptoss_model_weights_t</a> <a class="el" href="structgptoss__model__weights__t.html">gptoss_model_weights_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a966be24b11045de92b12361323a01f05" name="a966be24b11045de92b12361323a01f05"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a966be24b11045de92b12361323a01f05">&#9670;&#160;</a></span>gptoss_tensor_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structgptoss__tensor__t.html">gptoss_tensor_t</a> <a class="el" href="structgptoss__tensor__t.html">gptoss_tensor_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a4c735e5caa2875d3817c92123ba75198" name="a4c735e5caa2875d3817c92123ba75198"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4c735e5caa2875d3817c92123ba75198">&#9670;&#160;</a></span>gptoss_weights_index_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structgptoss__weights__index__t.html">gptoss_weights_index_t</a> <a class="el" href="structgptoss__weights__index__t.html">gptoss_weights_index_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="gptoss__weights__index_8h_source.html#l00176">176</a> of file <a class="el" href="gptoss__weights__index_8h_source.html">gptoss_weights_index.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="a5ba3978bcdac9a88ae300e42940692bd" name="a5ba3978bcdac9a88ae300e42940692bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5ba3978bcdac9a88ae300e42940692bd">&#9670;&#160;</a></span>gptoss_arch_kind_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="gptoss__weights__index_8h.html#a5ba3978bcdac9a88ae300e42940692bd">gptoss_arch_kind_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Logical weight naming scheme detected in tensor_map.json. </p>
<p>GPT-OSS snapshots can be exported with different naming conventions. This module probes for common layouts and records the detected convention so the forward pass can choose the correct projection wiring (fused QKV vs. separate, SwiGLU vs. GeLU MLP, etc.). </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a5ba3978bcdac9a88ae300e42940692bdae8e64fc15398950e8e54c4dbc859dcba" name="a5ba3978bcdac9a88ae300e42940692bdae8e64fc15398950e8e54c4dbc859dcba"></a>GPTOSS_ARCH_UNKNOWN&#160;</td><td class="fielddoc"><p>Unrecognized naming scheme. </p>
</td></tr>
<tr><td class="fieldname"><a id="a5ba3978bcdac9a88ae300e42940692bdade1572936286502eb2604bbf70812e26" name="a5ba3978bcdac9a88ae300e42940692bdade1572936286502eb2604bbf70812e26"></a>GPTOSS_ARCH_LLAMA&#160;</td><td class="fielddoc"><p>LLaMA-style: model.layers.N. </p>
<ul>
<li></li>
</ul>
</td></tr>
<tr><td class="fieldname"><a id="a5ba3978bcdac9a88ae300e42940692bdaca48309b567bec1419ac072f6057c724" name="a5ba3978bcdac9a88ae300e42940692bdaca48309b567bec1419ac072f6057c724"></a>GPTOSS_ARCH_GPTNEOX&#160;</td><td class="fielddoc"><p>GPT-NeoX-style: gpt_neox.layers.N. </p>
<ul>
<li></li>
</ul>
</td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="gptoss__weights__index_8h_source.html#l00063">63</a> of file <a class="el" href="gptoss__weights__index_8h_source.html">gptoss_weights_index.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   63</span>                                {</div>
<div class="line"><span class="lineno">   64</span>  <a class="code hl_enumvalue" href="gptoss__weights__index_8h.html#a5ba3978bcdac9a88ae300e42940692bdae8e64fc15398950e8e54c4dbc859dcba">GPTOSS_ARCH_UNKNOWN</a> = 0, </div>
<div class="line"><span class="lineno">   65</span>  <a class="code hl_enumvalue" href="gptoss__weights__index_8h.html#a5ba3978bcdac9a88ae300e42940692bdade1572936286502eb2604bbf70812e26">GPTOSS_ARCH_LLAMA</a>   = 1, </div>
<div class="line"><span class="lineno">   66</span>  <a class="code hl_enumvalue" href="gptoss__weights__index_8h.html#a5ba3978bcdac9a88ae300e42940692bdaca48309b567bec1419ac072f6057c724">GPTOSS_ARCH_GPTNEOX</a> = 2  </div>
<div class="line"><span class="lineno">   67</span>} <a class="code hl_enumeration" href="gptoss__weights__index_8h.html#a5ba3978bcdac9a88ae300e42940692bd">gptoss_arch_kind_t</a>;</div>
<div class="ttc" id="agptoss__weights__index_8h_html_a5ba3978bcdac9a88ae300e42940692bd"><div class="ttname"><a href="gptoss__weights__index_8h.html#a5ba3978bcdac9a88ae300e42940692bd">gptoss_arch_kind_t</a></div><div class="ttdeci">gptoss_arch_kind_t</div><div class="ttdoc">Logical weight naming scheme detected in tensor_map.json.</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8h_source.html#l00063">gptoss_weights_index.h:63</a></div></div>
<div class="ttc" id="agptoss__weights__index_8h_html_a5ba3978bcdac9a88ae300e42940692bdaca48309b567bec1419ac072f6057c724"><div class="ttname"><a href="gptoss__weights__index_8h.html#a5ba3978bcdac9a88ae300e42940692bdaca48309b567bec1419ac072f6057c724">GPTOSS_ARCH_GPTNEOX</a></div><div class="ttdeci">@ GPTOSS_ARCH_GPTNEOX</div><div class="ttdoc">GPT-NeoX-style: gpt_neox.layers.N.</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8h_source.html#l00067">gptoss_weights_index.h:66</a></div></div>
<div class="ttc" id="agptoss__weights__index_8h_html_a5ba3978bcdac9a88ae300e42940692bdade1572936286502eb2604bbf70812e26"><div class="ttname"><a href="gptoss__weights__index_8h.html#a5ba3978bcdac9a88ae300e42940692bdade1572936286502eb2604bbf70812e26">GPTOSS_ARCH_LLAMA</a></div><div class="ttdeci">@ GPTOSS_ARCH_LLAMA</div><div class="ttdoc">LLaMA-style: model.layers.N.</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8h_source.html#l00065">gptoss_weights_index.h:65</a></div></div>
<div class="ttc" id="agptoss__weights__index_8h_html_a5ba3978bcdac9a88ae300e42940692bdae8e64fc15398950e8e54c4dbc859dcba"><div class="ttname"><a href="gptoss__weights__index_8h.html#a5ba3978bcdac9a88ae300e42940692bdae8e64fc15398950e8e54c4dbc859dcba">GPTOSS_ARCH_UNKNOWN</a></div><div class="ttdeci">@ GPTOSS_ARCH_UNKNOWN</div><div class="ttdoc">Unrecognized naming scheme.</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8h_source.html#l00064">gptoss_weights_index.h:64</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a8d2ef0237f98560c09bff44c015e3b81" name="a8d2ef0237f98560c09bff44c015e3b81"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8d2ef0237f98560c09bff44c015e3b81">&#9670;&#160;</a></span>gptoss_model_weights_free()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void gptoss_model_weights_free </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structgptoss__model__weights__t.html">gptoss_model_weights_t</a> *&#160;</td>
          <td class="paramname"><em>mw</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Free the per-layer array allocated by <a class="el" href="gptoss__weights__index_8h.html#a121bde9c9fb693a485dd9bc9459a124f" title="Resolve and validate all tensors required by the GPT-OSS forward pass.">gptoss_weights_index_build_model</a>. </p>
<p>This does not close the underlying <a class="el" href="structgptoss__weights__index__t.html" title="Loaded tensor_map + mapped weights binary + optional dedup loader handle.">gptoss_weights_index_t</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mw</td><td>Model weights. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="gptoss__weights__index_8c_source.html#l00954">954</a> of file <a class="el" href="gptoss__weights__index_8c_source.html">gptoss_weights_index.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  954</span>                                                           {</div>
<div class="line"><span class="lineno">  955</span>  <span class="keywordflow">if</span> (!mw) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  956</span>  free(mw-&gt;<a class="code hl_variable" href="structgptoss__model__weights__t.html#a92dc55178f42d7a22a5a6db56e2d1b58">layers</a>);</div>
<div class="line"><span class="lineno">  957</span>  memset(mw, 0, <span class="keyword">sizeof</span>(*mw));</div>
<div class="line"><span class="lineno">  958</span>}</div>
<div class="ttc" id="astructgptoss__model__weights__t_html_a92dc55178f42d7a22a5a6db56e2d1b58"><div class="ttname"><a href="structgptoss__model__weights__t.html#a92dc55178f42d7a22a5a6db56e2d1b58">gptoss_model_weights_t::layers</a></div><div class="ttdeci">gptoss_layer_weights_t * layers</div><div class="ttdoc">Layer array (length = hp-&gt;n_layers).</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8h_source.html#l00156">gptoss_weights_index.h:156</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="gptoss__weights__index_8h_source.html#l00156">gptoss_model_weights_t::layers</a>.</p>

<p class="reference">Referenced by <a class="el" href="gptoss__weights__index_8c_source.html#l00860">gptoss_weights_index_build_model()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8h_a8d2ef0237f98560c09bff44c015e3b81_icgraph.svg" width="430" height="51"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a95ad38a811c68d493a4103e19875720f" name="a95ad38a811c68d493a4103e19875720f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a95ad38a811c68d493a4103e19875720f">&#9670;&#160;</a></span>gptoss_tensor_bytes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const uint8_t * gptoss_tensor_bytes </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structgptoss__tensor__t.html">gptoss_tensor_t</a> *&#160;</td>
          <td class="paramname"><em>t</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return a direct pointer to tensor bytes if available. </p>
<p>For IE_WVIEW_DEDUP tensors, this returns NULL; callers must use <a class="el" href="gptoss__weights__index_8h.html#ad72abbe402df6e08a0fc9fa8bf0f7d64" title="Materialize tensor bytes into a caller-provided buffer.">gptoss_tensor_materialize</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">t</td><td>Tensor handle. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Pointer to bytes, or NULL if materialization is required. </dd></dl>

<p class="definition">Definition at line <a class="el" href="gptoss__weights__index_8c_source.html#l00394">394</a> of file <a class="el" href="gptoss__weights__index_8c_source.html">gptoss_weights_index.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  394</span>                                                             {</div>
<div class="line"><span class="lineno">  395</span>  <span class="keywordflow">if</span> (!t) <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  396</span>  <span class="keywordflow">return</span> t-&gt;<a class="code hl_variable" href="structgptoss__tensor__t.html#ad0c9cdc4c1e57f961c191910d058aa35">direct</a>;</div>
<div class="line"><span class="lineno">  397</span>}</div>
<div class="ttc" id="astructgptoss__tensor__t_html_ad0c9cdc4c1e57f961c191910d058aa35"><div class="ttname"><a href="structgptoss__tensor__t.html#ad0c9cdc4c1e57f961c191910d058aa35">gptoss_tensor_t::direct</a></div><div class="ttdeci">const uint8_t * direct</div><div class="ttdoc">Direct pointer to bytes when available:</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8h_source.html#l00096">gptoss_weights_index.h:96</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="gptoss__weights__index_8h_source.html#l00096">gptoss_tensor_t::direct</a>.</p>

</div>
</div>
<a id="af45e8235976c0b4aa7cd57357c74e449" name="af45e8235976c0b4aa7cd57357c74e449"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af45e8235976c0b4aa7cd57357c74e449">&#9670;&#160;</a></span>gptoss_tensor_is_valid()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int gptoss_tensor_is_valid </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structgptoss__tensor__t.html">gptoss_tensor_t</a> *&#160;</td>
          <td class="paramname"><em>t</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check whether a tensor handle is populated. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">t</td><td>Tensor handle. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Non-zero if populated, 0 otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="gptoss__weights__index_8c_source.html#l00390">390</a> of file <a class="el" href="gptoss__weights__index_8c_source.html">gptoss_weights_index.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  390</span>                                                     {</div>
<div class="line"><span class="lineno">  391</span>  <span class="keywordflow">return</span> (t &amp;&amp; t-&gt;<a class="code hl_variable" href="structgptoss__tensor__t.html#afdce873cb214bb06c6603c4ab84771ea">desc</a> != NULL);</div>
<div class="line"><span class="lineno">  392</span>}</div>
<div class="ttc" id="astructgptoss__tensor__t_html_afdce873cb214bb06c6603c4ab84771ea"><div class="ttname"><a href="structgptoss__tensor__t.html#afdce873cb214bb06c6603c4ab84771ea">gptoss_tensor_t::desc</a></div><div class="ttdeci">const tensor_desc_t * desc</div><div class="ttdoc">Tensor descriptor from tensor_map.json (shape/dtype/size/offset).</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8h_source.html#l00082">gptoss_weights_index.h:82</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="gptoss__weights__index_8h_source.html#l00082">gptoss_tensor_t::desc</a>.</p>

</div>
</div>
<a id="ad72abbe402df6e08a0fc9fa8bf0f7d64" name="ad72abbe402df6e08a0fc9fa8bf0f7d64"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad72abbe402df6e08a0fc9fa8bf0f7d64">&#9670;&#160;</a></span>gptoss_tensor_materialize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t gptoss_tensor_materialize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structgptoss__tensor__t.html">gptoss_tensor_t</a> *&#160;</td>
          <td class="paramname"><em>t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>dst_nbytes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Materialize tensor bytes into a caller-provided buffer. </p>
<ul>
<li>For non-dedup tensors, this copies from the mapped <code>model.ie.bin</code>.</li>
<li>For IE_WVIEW_DIRECT, this copies from <code>view.data</code>.</li>
<li>For IE_WVIEW_DEDUP, this reconstructs bytes via <a class="el" href="weights__dedup_8h.html#a82069e1a7a2e1c0eaaebdd566ab44abe" title="Materialize a view into a contiguous destination buffer.">ie_weights_dedup_materialize</a>.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">t</td><td>Tensor handle. </td></tr>
    <tr><td class="paramname">dst</td><td>Destination buffer. </td></tr>
    <tr><td class="paramname">dst_nbytes</td><td>Capacity of destination buffer. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Number of bytes written (0 on failure). </dd></dl>

<p class="definition">Definition at line <a class="el" href="gptoss__weights__index_8c_source.html#l00399">399</a> of file <a class="el" href="gptoss__weights__index_8c_source.html">gptoss_weights_index.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  399</span>                                                                                         {</div>
<div class="line"><span class="lineno">  400</span>  <span class="keywordflow">if</span> (!t || !t-&gt;<a class="code hl_variable" href="structgptoss__tensor__t.html#afdce873cb214bb06c6603c4ab84771ea">desc</a> || !dst || dst_nbytes == 0) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  401</span>  <span class="keywordflow">if</span> (t-&gt;<a class="code hl_variable" href="structgptoss__tensor__t.html#ad0c9cdc4c1e57f961c191910d058aa35">direct</a>) {</div>
<div class="line"><span class="lineno">  402</span>    <span class="keywordtype">size_t</span> n = t-&gt;<a class="code hl_variable" href="structgptoss__tensor__t.html#a1c259985f27e4775ef5983ffffcaf0a0">nbytes</a>;</div>
<div class="line"><span class="lineno">  403</span>    <span class="keywordflow">if</span> (n &gt; dst_nbytes) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  404</span>    memcpy(dst, t-&gt;<a class="code hl_variable" href="structgptoss__tensor__t.html#ad0c9cdc4c1e57f961c191910d058aa35">direct</a>, n);</div>
<div class="line"><span class="lineno">  405</span>    <span class="keywordflow">return</span> n;</div>
<div class="line"><span class="lineno">  406</span>  }</div>
<div class="line"><span class="lineno">  407</span>  <span class="keywordflow">if</span> (t-&gt;<a class="code hl_variable" href="structgptoss__tensor__t.html#add37a18cbc25e8f1ba05c82e6a7a67cf">is_dedup</a>) {</div>
<div class="line"><span class="lineno">  408</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="weights__dedup_8h.html#a82069e1a7a2e1c0eaaebdd566ab44abe">ie_weights_dedup_materialize</a>(&amp;t-&gt;<a class="code hl_variable" href="structgptoss__tensor__t.html#a446f9086c133c923e46137346669d8ee">view</a>, dst, dst_nbytes);</div>
<div class="line"><span class="lineno">  409</span>  }</div>
<div class="line"><span class="lineno">  410</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  411</span>}</div>
<div class="ttc" id="astructgptoss__tensor__t_html_a1c259985f27e4775ef5983ffffcaf0a0"><div class="ttname"><a href="structgptoss__tensor__t.html#a1c259985f27e4775ef5983ffffcaf0a0">gptoss_tensor_t::nbytes</a></div><div class="ttdeci">size_t nbytes</div><div class="ttdoc">Byte size of the logical tensor payload.</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8h_source.html#l00099">gptoss_weights_index.h:99</a></div></div>
<div class="ttc" id="astructgptoss__tensor__t_html_a446f9086c133c923e46137346669d8ee"><div class="ttname"><a href="structgptoss__tensor__t.html#a446f9086c133c923e46137346669d8ee">gptoss_tensor_t::view</a></div><div class="ttdeci">ie_weight_view_t view</div><div class="ttdoc">Valid when is_dedup != 0.</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8h_source.html#l00088">gptoss_weights_index.h:88</a></div></div>
<div class="ttc" id="astructgptoss__tensor__t_html_add37a18cbc25e8f1ba05c82e6a7a67cf"><div class="ttname"><a href="structgptoss__tensor__t.html#add37a18cbc25e8f1ba05c82e6a7a67cf">gptoss_tensor_t::is_dedup</a></div><div class="ttdeci">int is_dedup</div><div class="ttdoc">Non-zero if this tensor must be accessed through the dedup loader.</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8h_source.html#l00085">gptoss_weights_index.h:85</a></div></div>
<div class="ttc" id="aweights__dedup_8h_html_a82069e1a7a2e1c0eaaebdd566ab44abe"><div class="ttname"><a href="weights__dedup_8h.html#a82069e1a7a2e1c0eaaebdd566ab44abe">ie_weights_dedup_materialize</a></div><div class="ttdeci">size_t ie_weights_dedup_materialize(const ie_weight_view_t *view, void *dst, size_t dst_nbytes)</div><div class="ttdoc">Materialize a view into a contiguous destination buffer.</div><div class="ttdef"><b>Definition</b> <a href="weights__dedup_8c_source.html#l01336">weights_dedup.c:1336</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="gptoss__weights__index_8h_source.html#l00082">gptoss_tensor_t::desc</a>, <a class="el" href="gptoss__weights__index_8h_source.html#l00096">gptoss_tensor_t::direct</a>, <a class="el" href="weights__dedup_8c_source.html#l01336">ie_weights_dedup_materialize()</a>, <a class="el" href="gptoss__weights__index_8h_source.html#l00085">gptoss_tensor_t::is_dedup</a>, <a class="el" href="gptoss__weights__index_8h_source.html#l00099">gptoss_tensor_t::nbytes</a>, and <a class="el" href="gptoss__weights__index_8h_source.html#l00088">gptoss_tensor_t::view</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8h_ad72abbe402df6e08a0fc9fa8bf0f7d64_cgraph.svg" width="663" height="135"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a121bde9c9fb693a485dd9bc9459a124f" name="a121bde9c9fb693a485dd9bc9459a124f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a121bde9c9fb693a485dd9bc9459a124f">&#9670;&#160;</a></span>gptoss_weights_index_build_model()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int gptoss_weights_index_build_model </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structgptoss__weights__index__t.html">gptoss_weights_index_t</a> *&#160;</td>
          <td class="paramname"><em>idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ie__infer_8h.html#a03b52084d74cc0c81a96a02ae842fcc7">ie_gptoss_hparams_t</a> *&#160;</td>
          <td class="paramname"><em>hp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structgptoss__model__weights__t.html">gptoss_model_weights_t</a> *&#160;</td>
          <td class="paramname"><em>out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Resolve and validate all tensors required by the GPT-OSS forward pass. </p>
<p>This performs name-resolution for a known set of tensors (embedding, norms, per-layer projections, and LM head). It allocates <code>out-&gt;layers</code> and fills every <a class="el" href="structgptoss__tensor__t.html" title="A resolved tensor handle.">gptoss_tensor_t</a> with a descriptor and a pointer/view.</p>
<p>Missing optional tensors (e.g., pos_embed, lm_head when tied) are left empty (desc == NULL). Missing required tensors produce an error.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">idx</td><td>Opened weights index. </td></tr>
    <tr><td class="paramname">hp</td><td>Hyperparameters (used for layer count). </td></tr>
    <tr><td class="paramname">out</td><td>Output model weights index (written on success). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>IE_IO_OK on success, negative <a class="el" href="ie__io_8h.html#aabad0c7dd1649d6261de555346eb68d5">ie_io_status_t</a> on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="gptoss__weights__index_8c_source.html#l00860">860</a> of file <a class="el" href="gptoss__weights__index_8c_source.html">gptoss_weights_index.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  862</span>                                                                 {</div>
<div class="line"><span class="lineno">  863</span>  <span class="keywordflow">if</span> (!idx || !hp || !out) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239">IE_IO_ERR_ARGS</a>;</div>
<div class="line"><span class="lineno">  864</span> </div>
<div class="line"><span class="lineno">  865</span>  memset(out, 0, <span class="keyword">sizeof</span>(*out));</div>
<div class="line"><span class="lineno">  866</span> </div>
<div class="line"><span class="lineno">  867</span>  <a class="code hl_enumeration" href="gptoss__weights__index_8h.html#a5ba3978bcdac9a88ae300e42940692bd">gptoss_arch_kind_t</a> arch;</div>
<div class="line"><span class="lineno">  868</span>  <span class="keywordtype">int</span> fused_qkv = 0;</div>
<div class="line"><span class="lineno">  869</span>  <span class="keywordtype">int</span> swiglu = 0;</div>
<div class="line"><span class="lineno">  870</span> </div>
<div class="line"><span class="lineno">  871</span>  {</div>
<div class="line"><span class="lineno">  872</span>    <span class="keywordtype">int</span> rc = <a class="code hl_function" href="gptoss__weights__index_8c.html#a1d0c65a6e45fb8bdf4ef6e703fbe20b5">widx_detect_arch</a>(idx, &amp;arch, &amp;fused_qkv, &amp;swiglu);</div>
<div class="line"><span class="lineno">  873</span>    <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>) <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  874</span>  }</div>
<div class="line"><span class="lineno">  875</span> </div>
<div class="line"><span class="lineno">  876</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;arch = arch;</div>
<div class="line"><span class="lineno">  877</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;attn_fused_qkv = fused_qkv;</div>
<div class="line"><span class="lineno">  878</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;mlp_swiglu = swiglu;</div>
<div class="line"><span class="lineno">  879</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;n_layers = hp-&gt;<a class="code hl_variable" href="structie__gptoss__hparams.html#a9f7592ff0ef97a90e4bf510d7323c1e2">n_layers</a>;</div>
<div class="line"><span class="lineno">  880</span> </div>
<div class="line"><span class="lineno">  881</span>  {</div>
<div class="line"><span class="lineno">  882</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *embed_names[] = {</div>
<div class="line"><span class="lineno">  883</span>      <span class="stringliteral">&quot;model.embed_tokens.weight&quot;</span>,</div>
<div class="line"><span class="lineno">  884</span>      <span class="stringliteral">&quot;tok_embeddings.weight&quot;</span>,</div>
<div class="line"><span class="lineno">  885</span>      <span class="stringliteral">&quot;model.tok_embeddings.weight&quot;</span>,</div>
<div class="line"><span class="lineno">  886</span>      <span class="stringliteral">&quot;transformer.wte.weight&quot;</span>,</div>
<div class="line"><span class="lineno">  887</span>      <span class="stringliteral">&quot;gpt_neox.embed_in.weight&quot;</span></div>
<div class="line"><span class="lineno">  888</span>    };</div>
<div class="line"><span class="lineno">  889</span>    <span class="keywordtype">int</span> rc = <a class="code hl_function" href="gptoss__weights__index_8c.html#a99c6f5457ca59a820436c4b8e8e9fb8b">widx_resolve_required</a>(idx, embed_names, <span class="keyword">sizeof</span>(embed_names)/<span class="keyword">sizeof</span>(embed_names[0]), &amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;tok_embed_w);</div>
<div class="line"><span class="lineno">  890</span>    <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>) <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  891</span>  }</div>
<div class="line"><span class="lineno">  892</span> </div>
<div class="line"><span class="lineno">  893</span>  {</div>
<div class="line"><span class="lineno">  894</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *pos_names[] = {</div>
<div class="line"><span class="lineno">  895</span>      <span class="stringliteral">&quot;model.embed_positions.weight&quot;</span>,</div>
<div class="line"><span class="lineno">  896</span>      <span class="stringliteral">&quot;transformer.wpe.weight&quot;</span>,</div>
<div class="line"><span class="lineno">  897</span>      <span class="stringliteral">&quot;gpt_neox.embed_positions.weight&quot;</span></div>
<div class="line"><span class="lineno">  898</span>    };</div>
<div class="line"><span class="lineno">  899</span>    <span class="keywordtype">int</span> rc = <a class="code hl_function" href="gptoss__weights__index_8c.html#ac8e226ed24bc76176a1fec86157bac99">widx_resolve_optional</a>(idx, pos_names, <span class="keyword">sizeof</span>(pos_names)/<span class="keyword">sizeof</span>(pos_names[0]), &amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;pos_embed_w);</div>
<div class="line"><span class="lineno">  900</span>    <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>) <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  901</span>  }</div>
<div class="line"><span class="lineno">  902</span> </div>
<div class="line"><span class="lineno">  903</span>  {</div>
<div class="line"><span class="lineno">  904</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *norm_names[] = {</div>
<div class="line"><span class="lineno">  905</span>      <span class="stringliteral">&quot;model.norm.weight&quot;</span>,</div>
<div class="line"><span class="lineno">  906</span>      <span class="stringliteral">&quot;transformer.norm.weight&quot;</span>,</div>
<div class="line"><span class="lineno">  907</span>      <span class="stringliteral">&quot;gpt_neox.final_layer_norm.weight&quot;</span>,</div>
<div class="line"><span class="lineno">  908</span>      <span class="stringliteral">&quot;final_layer_norm.weight&quot;</span></div>
<div class="line"><span class="lineno">  909</span>    };</div>
<div class="line"><span class="lineno">  910</span>    <span class="keywordtype">int</span> rc = <a class="code hl_function" href="gptoss__weights__index_8c.html#a99c6f5457ca59a820436c4b8e8e9fb8b">widx_resolve_required</a>(idx, norm_names, <span class="keyword">sizeof</span>(norm_names)/<span class="keyword">sizeof</span>(norm_names[0]), &amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;final_norm_w);</div>
<div class="line"><span class="lineno">  911</span>    <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>) <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  912</span>  }</div>
<div class="line"><span class="lineno">  913</span> </div>
<div class="line"><span class="lineno">  914</span>  {</div>
<div class="line"><span class="lineno">  915</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *lm_head_names[] = {</div>
<div class="line"><span class="lineno">  916</span>      <span class="stringliteral">&quot;lm_head.weight&quot;</span>,</div>
<div class="line"><span class="lineno">  917</span>      <span class="stringliteral">&quot;model.lm_head.weight&quot;</span>,</div>
<div class="line"><span class="lineno">  918</span>      <span class="stringliteral">&quot;transformer.lm_head.weight&quot;</span>,</div>
<div class="line"><span class="lineno">  919</span>      <span class="stringliteral">&quot;embed_out.weight&quot;</span>,</div>
<div class="line"><span class="lineno">  920</span>      <span class="stringliteral">&quot;gpt_neox.embed_out.weight&quot;</span></div>
<div class="line"><span class="lineno">  921</span>    };</div>
<div class="line"><span class="lineno">  922</span>    <span class="keywordtype">int</span> rc = <a class="code hl_function" href="gptoss__weights__index_8c.html#ac8e226ed24bc76176a1fec86157bac99">widx_resolve_optional</a>(idx, lm_head_names, <span class="keyword">sizeof</span>(lm_head_names)/<span class="keyword">sizeof</span>(lm_head_names[0]), &amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;lm_head_w);</div>
<div class="line"><span class="lineno">  923</span>    <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>) <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  924</span> </div>
<div class="line"><span class="lineno">  925</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;lm_head_w.desc) {</div>
<div class="line"><span class="lineno">  926</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;lm_head_w = <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;tok_embed_w;</div>
<div class="line"><span class="lineno">  927</span>    }</div>
<div class="line"><span class="lineno">  928</span>  }</div>
<div class="line"><span class="lineno">  929</span> </div>
<div class="line"><span class="lineno">  930</span>  <span class="keywordflow">if</span> (hp-&gt;<a class="code hl_variable" href="structie__gptoss__hparams.html#a9f7592ff0ef97a90e4bf510d7323c1e2">n_layers</a> == 0) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239">IE_IO_ERR_ARGS</a>;</div>
<div class="line"><span class="lineno">  931</span> </div>
<div class="line"><span class="lineno">  932</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;layers = (<a class="code hl_struct" href="structgptoss__layer__weights__t.html">gptoss_layer_weights_t</a>*)calloc((<span class="keywordtype">size_t</span>)hp-&gt;<a class="code hl_variable" href="structie__gptoss__hparams.html#a9f7592ff0ef97a90e4bf510d7323c1e2">n_layers</a>, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="structgptoss__layer__weights__t.html">gptoss_layer_weights_t</a>));</div>
<div class="line"><span class="lineno">  933</span>  <span class="keywordflow">if</span> (!<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;layers) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a4effb7bf4fea909987b433ca4cf26380">IE_IO_ERR_OOM</a>;</div>
<div class="line"><span class="lineno">  934</span> </div>
<div class="line"><span class="lineno">  935</span>  <span class="keywordflow">for</span> (uint32_t l = 0; l &lt; hp-&gt;<a class="code hl_variable" href="structie__gptoss__hparams.html#a9f7592ff0ef97a90e4bf510d7323c1e2">n_layers</a>; ++l) {</div>
<div class="line"><span class="lineno">  936</span>    <span class="keywordtype">int</span> rc;</div>
<div class="line"><span class="lineno">  937</span>    <span class="keywordflow">if</span> (arch == <a class="code hl_enumvalue" href="gptoss__weights__index_8h.html#a5ba3978bcdac9a88ae300e42940692bdade1572936286502eb2604bbf70812e26">GPTOSS_ARCH_LLAMA</a>) {</div>
<div class="line"><span class="lineno">  938</span>      rc = <a class="code hl_function" href="gptoss__weights__index_8c.html#a59ea306bea1c9226c31583a49f2e7ffd">widx_resolve_layer_llama</a>(idx, l, fused_qkv, swiglu, &amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;layers[l]);</div>
<div class="line"><span class="lineno">  939</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (arch == <a class="code hl_enumvalue" href="gptoss__weights__index_8h.html#a5ba3978bcdac9a88ae300e42940692bdaca48309b567bec1419ac072f6057c724">GPTOSS_ARCH_GPTNEOX</a>) {</div>
<div class="line"><span class="lineno">  940</span>      rc = <a class="code hl_function" href="gptoss__weights__index_8c.html#aaa150e690297afaababde6bd8bcb7ae7">widx_resolve_layer_neox</a>(idx, l, &amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;layers[l]);</div>
<div class="line"><span class="lineno">  941</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  942</span>      rc = <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9">IE_IO_ERR_JSON</a>;</div>
<div class="line"><span class="lineno">  943</span>    }</div>
<div class="line"><span class="lineno">  944</span> </div>
<div class="line"><span class="lineno">  945</span>    <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>) {</div>
<div class="line"><span class="lineno">  946</span>      <a class="code hl_function" href="gptoss__weights__index_8c.html#a8d2ef0237f98560c09bff44c015e3b81">gptoss_model_weights_free</a>(out);</div>
<div class="line"><span class="lineno">  947</span>      <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  948</span>    }</div>
<div class="line"><span class="lineno">  949</span>  }</div>
<div class="line"><span class="lineno">  950</span> </div>
<div class="line"><span class="lineno">  951</span>  <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>;</div>
<div class="line"><span class="lineno">  952</span>}</div>
<div class="ttc" id="agptoss__weights__index_8c_html_a1d0c65a6e45fb8bdf4ef6e703fbe20b5"><div class="ttname"><a href="gptoss__weights__index_8c.html#a1d0c65a6e45fb8bdf4ef6e703fbe20b5">widx_detect_arch</a></div><div class="ttdeci">static int widx_detect_arch(const gptoss_weights_index_t *idx, gptoss_arch_kind_t *out_arch, int *out_fused_qkv, int *out_swiglu)</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00513">gptoss_weights_index.c:513</a></div></div>
<div class="ttc" id="agptoss__weights__index_8c_html_a59ea306bea1c9226c31583a49f2e7ffd"><div class="ttname"><a href="gptoss__weights__index_8c.html#a59ea306bea1c9226c31583a49f2e7ffd">widx_resolve_layer_llama</a></div><div class="ttdeci">static int widx_resolve_layer_llama(const gptoss_weights_index_t *idx, uint32_t layer, int fused_qkv, int swiglu, gptoss_layer_weights_t *out)</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00575">gptoss_weights_index.c:575</a></div></div>
<div class="ttc" id="agptoss__weights__index_8c_html_a8d2ef0237f98560c09bff44c015e3b81"><div class="ttname"><a href="gptoss__weights__index_8c.html#a8d2ef0237f98560c09bff44c015e3b81">gptoss_model_weights_free</a></div><div class="ttdeci">void gptoss_model_weights_free(gptoss_model_weights_t *mw)</div><div class="ttdoc">Free the per-layer array allocated by gptoss_weights_index_build_model.</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00954">gptoss_weights_index.c:954</a></div></div>
<div class="ttc" id="agptoss__weights__index_8c_html_a99c6f5457ca59a820436c4b8e8e9fb8b"><div class="ttname"><a href="gptoss__weights__index_8c.html#a99c6f5457ca59a820436c4b8e8e9fb8b">widx_resolve_required</a></div><div class="ttdeci">static int widx_resolve_required(const gptoss_weights_index_t *idx, const char *const *names, size_t n, gptoss_tensor_t *out)</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00359">gptoss_weights_index.c:359</a></div></div>
<div class="ttc" id="agptoss__weights__index_8c_html_aaa150e690297afaababde6bd8bcb7ae7"><div class="ttname"><a href="gptoss__weights__index_8c.html#aaa150e690297afaababde6bd8bcb7ae7">widx_resolve_layer_neox</a></div><div class="ttdeci">static int widx_resolve_layer_neox(const gptoss_weights_index_t *idx, uint32_t layer, gptoss_layer_weights_t *out)</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00794">gptoss_weights_index.c:794</a></div></div>
<div class="ttc" id="agptoss__weights__index_8c_html_ac8e226ed24bc76176a1fec86157bac99"><div class="ttname"><a href="gptoss__weights__index_8c.html#ac8e226ed24bc76176a1fec86157bac99">widx_resolve_optional</a></div><div class="ttdeci">static int widx_resolve_optional(const gptoss_weights_index_t *idx, const char *const *names, size_t n, gptoss_tensor_t *out)</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00374">gptoss_weights_index.c:374</a></div></div>
<div class="ttc" id="aie__io_8h_html_a4c501870bd45dbe373416745a03de987a4effb7bf4fea909987b433ca4cf26380"><div class="ttname"><a href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a4effb7bf4fea909987b433ca4cf26380">IE_IO_ERR_OOM</a></div><div class="ttdeci">@ IE_IO_ERR_OOM</div><div class="ttdoc">Alias for older/newer code expecting OOM name.</div><div class="ttdef"><b>Definition</b> <a href="ie__io_8h_source.html#l00072">ie_io.h:72</a></div></div>
<div class="ttc" id="aie__io_8h_html_a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239"><div class="ttname"><a href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239">IE_IO_ERR_ARGS</a></div><div class="ttdeci">@ IE_IO_ERR_ARGS</div><div class="ttdoc">Invalid arguments.</div><div class="ttdef"><b>Definition</b> <a href="ie__io_8h_source.html#l00065">ie_io.h:65</a></div></div>
<div class="ttc" id="aie__io_8h_html_a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d"><div class="ttname"><a href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a></div><div class="ttdeci">@ IE_IO_OK</div><div class="ttdoc">Success.</div><div class="ttdef"><b>Definition</b> <a href="ie__io_8h_source.html#l00064">ie_io.h:64</a></div></div>
<div class="ttc" id="aie__io_8h_html_a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9"><div class="ttname"><a href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9">IE_IO_ERR_JSON</a></div><div class="ttdeci">@ IE_IO_ERR_JSON</div><div class="ttdoc">JSON parse failure or missing required fields.</div><div class="ttdef"><b>Definition</b> <a href="ie__io_8h_source.html#l00066">ie_io.h:66</a></div></div>
<div class="ttc" id="anamespaceconvert__dtypes__to__numeric_html_a0332296ea5bde95f8e72005df06144a8"><div class="ttname"><a href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">convert_dtypes_to_numeric.out</a></div><div class="ttdeci">dict out</div><div class="ttdef"><b>Definition</b> <a href="convert__dtypes__to__numeric_8py_source.html#l00029">convert_dtypes_to_numeric.py:29</a></div></div>
<div class="ttc" id="astructgptoss__layer__weights__t_html"><div class="ttname"><a href="structgptoss__layer__weights__t.html">gptoss_layer_weights_t</a></div><div class="ttdoc">Per-layer weight handles for a GPT-OSS transformer block.</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8h_source.html#l00106">gptoss_weights_index.h:106</a></div></div>
<div class="ttc" id="astructie__gptoss__hparams_html_a9f7592ff0ef97a90e4bf510d7323c1e2"><div class="ttname"><a href="structie__gptoss__hparams.html#a9f7592ff0ef97a90e4bf510d7323c1e2">ie_gptoss_hparams::n_layers</a></div><div class="ttdeci">uint32_t n_layers</div><div class="ttdoc">Number of transformer layers.</div><div class="ttdef"><b>Definition</b> <a href="ie__infer_8h_source.html#l00042">ie_infer.h:42</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="gptoss__weights__index_8h_source.html#l00066">GPTOSS_ARCH_GPTNEOX</a>, <a class="el" href="gptoss__weights__index_8h_source.html#l00065">GPTOSS_ARCH_LLAMA</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00954">gptoss_model_weights_free()</a>, <a class="el" href="ie__io_8h_source.html#l00065">IE_IO_ERR_ARGS</a>, <a class="el" href="ie__io_8h_source.html#l00066">IE_IO_ERR_JSON</a>, <a class="el" href="ie__io_8h_source.html#l00072">IE_IO_ERR_OOM</a>, <a class="el" href="ie__io_8h_source.html#l00064">IE_IO_OK</a>, <a class="el" href="ie__infer_8h_source.html#l00042">ie_gptoss_hparams::n_layers</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00513">widx_detect_arch()</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00575">widx_resolve_layer_llama()</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00794">widx_resolve_layer_neox()</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00374">widx_resolve_optional()</a>, and <a class="el" href="gptoss__weights__index_8c_source.html#l00359">widx_resolve_required()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8h_a121bde9c9fb693a485dd9bc9459a124f_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a943d5a8178000a52f6148bdbccda2252" name="a943d5a8178000a52f6148bdbccda2252"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a943d5a8178000a52f6148bdbccda2252">&#9670;&#160;</a></span>gptoss_weights_index_close()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void gptoss_weights_index_close </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structgptoss__weights__index__t.html">gptoss_weights_index_t</a> *&#160;</td>
          <td class="paramname"><em>idx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Close an index and free all owned resources. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">idx</td><td>Index handle (may be NULL). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="gptoss__weights__index_8c_source.html#l00492">492</a> of file <a class="el" href="gptoss__weights__index_8c_source.html">gptoss_weights_index.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  492</span>                                                             {</div>
<div class="line"><span class="lineno">  493</span>  <span class="keywordflow">if</span> (!idx) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  494</span> </div>
<div class="line"><span class="lineno">  495</span>  <span class="keywordflow">if</span> (idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a10551567a23a0b23cf07c258deaacaaa">dedup_owned</a>) {</div>
<div class="line"><span class="lineno">  496</span>    <a class="code hl_struct" href="structie__weights__dedup.html">ie_weights_dedup_t</a> *h = idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a10551567a23a0b23cf07c258deaacaaa">dedup_owned</a>;</div>
<div class="line"><span class="lineno">  497</span>    <a class="code hl_function" href="weights__dedup_8h.html#a3ad33a6fe3c7a81072c092d1ee510fce">ie_weights_dedup_close</a>(&amp;h);</div>
<div class="line"><span class="lineno">  498</span>    idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a10551567a23a0b23cf07c258deaacaaa">dedup_owned</a> = NULL;</div>
<div class="line"><span class="lineno">  499</span>    idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#af655091ccb0f124d27d604287d6313b5">dedup</a> = NULL;</div>
<div class="line"><span class="lineno">  500</span>  }</div>
<div class="line"><span class="lineno">  501</span> </div>
<div class="line"><span class="lineno">  502</span>  <a class="code hl_function" href="tensor__map_8h.html#a42d154b3f93b07c41b514e468a61c803">tensor_map_free</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>);</div>
<div class="line"><span class="lineno">  503</span>  <a class="code hl_function" href="gptoss__weights__index_8c.html#a38ec37dc422b167e975773834349ec96">widx_mapped_close</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#ac96503b84bb4f2ea6158113639b660f9">bin</a>);</div>
<div class="line"><span class="lineno">  504</span> </div>
<div class="line"><span class="lineno">  505</span>  memset(idx, 0, <span class="keyword">sizeof</span>(*idx));</div>
<div class="line"><span class="lineno">  506</span>  idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#ac96503b84bb4f2ea6158113639b660f9">bin</a>.<a class="code hl_variable" href="structgptoss__mapped__file__t.html#a535fd2744904c614c9bdddf441984ca4">fd</a> = -1;</div>
<div class="line"><span class="lineno">  507</span>}</div>
<div class="ttc" id="agptoss__weights__index_8c_html_a38ec37dc422b167e975773834349ec96"><div class="ttname"><a href="gptoss__weights__index_8c.html#a38ec37dc422b167e975773834349ec96">widx_mapped_close</a></div><div class="ttdeci">static void widx_mapped_close(gptoss_mapped_file_t *mf)</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00139">gptoss_weights_index.c:139</a></div></div>
<div class="ttc" id="astructgptoss__mapped__file__t_html_a535fd2744904c614c9bdddf441984ca4"><div class="ttname"><a href="structgptoss__mapped__file__t.html#a535fd2744904c614c9bdddf441984ca4">gptoss_mapped_file_t::fd</a></div><div class="ttdeci">int fd</div><div class="ttdoc">File descriptor (POSIX only).</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00059">gptoss_weights_index.c:59</a></div></div>
<div class="ttc" id="astructgptoss__weights__index__t_html_a10551567a23a0b23cf07c258deaacaaa"><div class="ttname"><a href="structgptoss__weights__index__t.html#a10551567a23a0b23cf07c258deaacaaa">gptoss_weights_index_t::dedup_owned</a></div><div class="ttdeci">ie_weights_dedup_t * dedup_owned</div><div class="ttdoc">If non-NULL, we own this handle and must close.</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00078">gptoss_weights_index.c:78</a></div></div>
<div class="ttc" id="astructgptoss__weights__index__t_html_a3b13756eb517ad4a8c378fcc8a76175b"><div class="ttname"><a href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">gptoss_weights_index_t::tmap</a></div><div class="ttdeci">tensor_map_t tmap</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00072">gptoss_weights_index.c:72</a></div></div>
<div class="ttc" id="astructgptoss__weights__index__t_html_ac96503b84bb4f2ea6158113639b660f9"><div class="ttname"><a href="structgptoss__weights__index__t.html#ac96503b84bb4f2ea6158113639b660f9">gptoss_weights_index_t::bin</a></div><div class="ttdeci">gptoss_mapped_file_t bin</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00074">gptoss_weights_index.c:74</a></div></div>
<div class="ttc" id="astructgptoss__weights__index__t_html_af655091ccb0f124d27d604287d6313b5"><div class="ttname"><a href="structgptoss__weights__index__t.html#af655091ccb0f124d27d604287d6313b5">gptoss_weights_index_t::dedup</a></div><div class="ttdeci">const ie_weights_dedup_t * dedup</div><div class="ttdoc">Borrowed or locally-owned (see dedup_owned).</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00077">gptoss_weights_index.c:77</a></div></div>
<div class="ttc" id="astructie__weights__dedup_html"><div class="ttname"><a href="structie__weights__dedup.html">ie_weights_dedup</a></div><div class="ttdef"><b>Definition</b> <a href="weights__dedup_8c_source.html#l00747">weights_dedup.c:747</a></div></div>
<div class="ttc" id="atensor__map_8h_html_a42d154b3f93b07c41b514e468a61c803"><div class="ttname"><a href="tensor__map_8h.html#a42d154b3f93b07c41b514e468a61c803">tensor_map_free</a></div><div class="ttdeci">void tensor_map_free(tensor_map_t *map)</div><div class="ttdoc">Free tensor map and all owned memory.</div><div class="ttdef"><b>Definition</b> <a href="tensor__map_8c_source.html#l00650">tensor_map.c:650</a></div></div>
<div class="ttc" id="aweights__dedup_8h_html_a3ad33a6fe3c7a81072c092d1ee510fce"><div class="ttname"><a href="weights__dedup_8h.html#a3ad33a6fe3c7a81072c092d1ee510fce">ie_weights_dedup_close</a></div><div class="ttdeci">void ie_weights_dedup_close(ie_weights_dedup_t **h)</div><div class="ttdoc">Close the loader and free all associated memory.</div><div class="ttdef"><b>Definition</b> <a href="weights__dedup_8c_source.html#l01236">weights_dedup.c:1236</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="gptoss__weights__index_8c_source.html#l00074">gptoss_weights_index_t::bin</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00077">gptoss_weights_index_t::dedup</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00078">gptoss_weights_index_t::dedup_owned</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00059">gptoss_mapped_file_t::fd</a>, <a class="el" href="weights__dedup_8c_source.html#l01236">ie_weights_dedup_close()</a>, <a class="el" href="tensor__map_8c_source.html#l00650">tensor_map_free()</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00072">gptoss_weights_index_t::tmap</a>, and <a class="el" href="gptoss__weights__index_8c_source.html#l00139">widx_mapped_close()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8h_a943d5a8178000a52f6148bdbccda2252_cgraph.svg" width="615" height="159"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ab0abbe94d2373ea44d51f2325c7cc46c" name="ab0abbe94d2373ea44d51f2325c7cc46c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab0abbe94d2373ea44d51f2325c7cc46c">&#9670;&#160;</a></span>gptoss_weights_index_open()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int gptoss_weights_index_open </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structgptoss__weights__index__t.html">gptoss_weights_index_t</a> *&#160;</td>
          <td class="paramname"><em>out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>model_dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ie__io_8h.html#af68ad3cdc2eb244fe4feed94372d7806">ie_weights_t</a> *&#160;</td>
          <td class="paramname"><em>weights</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Open a weights index for a given model directory and weights descriptor. </p>
<p>This loads <code>tensor_map.json</code> and maps <code>model.ie.bin</code>.</p>
<p>If <code>weights-&gt;is_dedup != 0</code> and <code>weights-&gt;dedup_handle != NULL</code>, this function will reuse that dedup loader (borrowed, not owned). If dedup is requested but no handle is present, it attempts to open a dedup loader from <code>model_dir</code>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">out</td><td>Output index (written on success). </td></tr>
    <tr><td class="paramname">model_dir</td><td>Model directory (used to locate tensor_map.json and dedup files). </td></tr>
    <tr><td class="paramname">weights</td><td>Weights descriptor opened by <a class="el" href="ie__io_8h.html#a522dac028ee37aae1307ffdb6d65ec1d" title="Open and parse an IEBIN v1 model description.">ie_weights_open</a>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>IE_IO_OK on success, negative <a class="el" href="ie__io_8h.html#aabad0c7dd1649d6261de555346eb68d5">ie_io_status_t</a> on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="gptoss__weights__index_8c_source.html#l00417">417</a> of file <a class="el" href="gptoss__weights__index_8c_source.html">gptoss_weights_index.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  419</span>                                                          {</div>
<div class="line"><span class="lineno">  420</span>  <span class="keywordflow">if</span> (!out || !model_dir || !weights) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239">IE_IO_ERR_ARGS</a>;</div>
<div class="line"><span class="lineno">  421</span> </div>
<div class="line"><span class="lineno">  422</span>  memset(out, 0, <span class="keyword">sizeof</span>(*out));</div>
<div class="line"><span class="lineno">  423</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;bin.fd = -1;</div>
<div class="line"><span class="lineno">  424</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;weights = weights;</div>
<div class="line"><span class="lineno">  425</span> </div>
<div class="line"><span class="lineno">  426</span>  {</div>
<div class="line"><span class="lineno">  427</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *tr = getenv(<span class="stringliteral">&quot;IE_TRACE_LOOKUPS&quot;</span>);</div>
<div class="line"><span class="lineno">  428</span>    <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;trace = (tr &amp;&amp; tr[0] &amp;&amp; strcmp(tr, <span class="stringliteral">&quot;0&quot;</span>) != 0);</div>
<div class="line"><span class="lineno">  429</span>  }</div>
<div class="line"><span class="lineno">  430</span> </div>
<div class="line"><span class="lineno">  431</span>  <span class="keywordflow">if</span> (strlen(model_dir) &gt;= <span class="keyword">sizeof</span>(<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;model_dir)) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239">IE_IO_ERR_ARGS</a>;</div>
<div class="line"><span class="lineno">  432</span>  memcpy(<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;model_dir, model_dir, strlen(model_dir) + 1u);</div>
<div class="line"><span class="lineno">  433</span> </div>
<div class="line"><span class="lineno">  434</span>  <span class="keywordtype">char</span> tmap_path[1024];</div>
<div class="line"><span class="lineno">  435</span>  memset(tmap_path, 0, <span class="keyword">sizeof</span>(tmap_path));</div>
<div class="line"><span class="lineno">  436</span> </div>
<div class="line"><span class="lineno">  437</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="gptoss__weights__index_8c.html#a4a56b6936dd1f3d8668251a331151a96">widx_path_join</a>(tmap_path, <span class="keyword">sizeof</span>(tmap_path), model_dir, <span class="stringliteral">&quot;tensor_map.json&quot;</span>) != 0) {</div>
<div class="line"><span class="lineno">  438</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239">IE_IO_ERR_ARGS</a>;</div>
<div class="line"><span class="lineno">  439</span>  }</div>
<div class="line"><span class="lineno">  440</span> </div>
<div class="line"><span class="lineno">  441</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="tensor__map_8h.html#ac4b913e2710929070b5b073b4b67b24c">tensor_map_load</a>(tmap_path, &amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;tmap) != 0) {</div>
<div class="line"><span class="lineno">  442</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="gptoss__weights__index_8c.html#a4a56b6936dd1f3d8668251a331151a96">widx_path_join</a>(tmap_path, <span class="keyword">sizeof</span>(tmap_path), model_dir, <span class="stringliteral">&quot;hf/original/tensor_map.json&quot;</span>) != 0) {</div>
<div class="line"><span class="lineno">  443</span>      <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9">IE_IO_ERR_JSON</a>;</div>
<div class="line"><span class="lineno">  444</span>    }</div>
<div class="line"><span class="lineno">  445</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="tensor__map_8h.html#ac4b913e2710929070b5b073b4b67b24c">tensor_map_load</a>(tmap_path, &amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;tmap) != 0) {</div>
<div class="line"><span class="lineno">  446</span>      <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9">IE_IO_ERR_JSON</a>;</div>
<div class="line"><span class="lineno">  447</span>    }</div>
<div class="line"><span class="lineno">  448</span>  }</div>
<div class="line"><span class="lineno">  449</span> </div>
<div class="line"><span class="lineno">  450</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="gptoss__weights__index_8c.html#add8363effbaa37fcdc8b72a4d9a858af">widx_trace_enabled</a>(out)) {</div>
<div class="line"><span class="lineno">  451</span>    <a class="code hl_function" href="gptoss__weights__index_8c.html#a724e4be15ba1676eb3369599e99eccc6">widx_tracef</a>(out, <span class="stringliteral">&quot;[widx] tensor_map loaded from &#39;%s&#39;\n&quot;</span>, tmap_path);</div>
<div class="line"><span class="lineno">  452</span>  }</div>
<div class="line"><span class="lineno">  453</span> </div>
<div class="line"><span class="lineno">  454</span>  <span class="keywordflow">if</span> (!weights-&gt;<a class="code hl_variable" href="structie__weights__s.html#ab6a61099d0af4a47854d02dc4fef5b8f">weights_path</a>[0]) {</div>
<div class="line"><span class="lineno">  455</span>    <a class="code hl_function" href="tensor__map_8h.html#a42d154b3f93b07c41b514e468a61c803">tensor_map_free</a>(&amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;tmap);</div>
<div class="line"><span class="lineno">  456</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a66046f2226981286e47bb2f33ab56862">IE_IO_ERR_BIN_UNSPEC</a>;</div>
<div class="line"><span class="lineno">  457</span>  }</div>
<div class="line"><span class="lineno">  458</span> </div>
<div class="line"><span class="lineno">  459</span>  {</div>
<div class="line"><span class="lineno">  460</span>    <span class="keywordtype">int</span> rc = <a class="code hl_function" href="gptoss__weights__index_8c.html#ae6ffa18bb461a4aff5f94b8b20f71c93">widx_mapped_open</a>(&amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;bin, weights-&gt;<a class="code hl_variable" href="structie__weights__s.html#ab6a61099d0af4a47854d02dc4fef5b8f">weights_path</a>);</div>
<div class="line"><span class="lineno">  461</span>    <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>) {</div>
<div class="line"><span class="lineno">  462</span>      <a class="code hl_function" href="tensor__map_8h.html#a42d154b3f93b07c41b514e468a61c803">tensor_map_free</a>(&amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;tmap);</div>
<div class="line"><span class="lineno">  463</span>      <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  464</span>    }</div>
<div class="line"><span class="lineno">  465</span>  }</div>
<div class="line"><span class="lineno">  466</span> </div>
<div class="line"><span class="lineno">  467</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;dedup = NULL;</div>
<div class="line"><span class="lineno">  468</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;dedup_owned = NULL;</div>
<div class="line"><span class="lineno">  469</span> </div>
<div class="line"><span class="lineno">  470</span>  <span class="keywordflow">if</span> (weights-&gt;<a class="code hl_variable" href="structie__weights__s.html#ab1e17ac4f44125571f2c63e603d967da">is_dedup</a>) {</div>
<div class="line"><span class="lineno">  471</span>    <span class="keywordflow">if</span> (weights-&gt;<a class="code hl_variable" href="structie__weights__s.html#a6cffa1c1904346d68932cc9542b8ff32">dedup_handle</a>) {</div>
<div class="line"><span class="lineno">  472</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;dedup = (<span class="keyword">const</span> <a class="code hl_struct" href="structie__weights__dedup.html">ie_weights_dedup_t</a>*)weights-&gt;<a class="code hl_variable" href="structie__weights__s.html#a6cffa1c1904346d68932cc9542b8ff32">dedup_handle</a>;</div>
<div class="line"><span class="lineno">  473</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  474</span>      <a class="code hl_struct" href="structie__weights__dedup.html">ie_weights_dedup_t</a> *h = NULL;</div>
<div class="line"><span class="lineno">  475</span>      <a class="code hl_struct" href="structie__weights__dedup__opts__t.html">ie_weights_dedup_opts_t</a> opts;</div>
<div class="line"><span class="lineno">  476</span>      memset(&amp;opts, 0, <span class="keyword">sizeof</span>(opts));</div>
<div class="line"><span class="lineno">  477</span>      opts.<a class="code hl_variable" href="structie__weights__dedup__opts__t.html#a86ae82fb8029f319a275251de5918035">prefault_policy</a> = 0;</div>
<div class="line"><span class="lineno">  478</span>      <a class="code hl_enumeration" href="weights__dedup_8h.html#a58857f75f23e827eb7a07572c0b93f2f">ie_wdedup_status_t</a> st = <a class="code hl_function" href="weights__dedup_8h.html#aa625b41ce2a24826f8cb464661ace8ec">ie_weights_dedup_open</a>(&amp;h, model_dir, &amp;opts);</div>
<div class="line"><span class="lineno">  479</span>      <span class="keywordflow">if</span> (st != <a class="code hl_enumvalue" href="weights__dedup_8h.html#a58857f75f23e827eb7a07572c0b93f2fa0baf1bf45e91e9558e44038d27d20e2f">IE_WDEDUP_OK</a>) {</div>
<div class="line"><span class="lineno">  480</span>        <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;dedup = NULL;</div>
<div class="line"><span class="lineno">  481</span>        <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;dedup_owned = NULL;</div>
<div class="line"><span class="lineno">  482</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  483</span>        <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;dedup = h;</div>
<div class="line"><span class="lineno">  484</span>        <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;dedup_owned = h;</div>
<div class="line"><span class="lineno">  485</span>      }</div>
<div class="line"><span class="lineno">  486</span>    }</div>
<div class="line"><span class="lineno">  487</span>  }</div>
<div class="line"><span class="lineno">  488</span> </div>
<div class="line"><span class="lineno">  489</span>  <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>;</div>
<div class="line"><span class="lineno">  490</span>}</div>
<div class="ttc" id="agptoss__weights__index_8c_html_a4a56b6936dd1f3d8668251a331151a96"><div class="ttname"><a href="gptoss__weights__index_8c.html#a4a56b6936dd1f3d8668251a331151a96">widx_path_join</a></div><div class="ttdeci">static int widx_path_join(char *dst, size_t dst_n, const char *model_dir, const char *leaf)</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00113">gptoss_weights_index.c:113</a></div></div>
<div class="ttc" id="agptoss__weights__index_8c_html_a724e4be15ba1676eb3369599e99eccc6"><div class="ttname"><a href="gptoss__weights__index_8c.html#a724e4be15ba1676eb3369599e99eccc6">widx_tracef</a></div><div class="ttdeci">static void widx_tracef(const gptoss_weights_index_t *idx, const char *fmt,...)</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00091">gptoss_weights_index.c:91</a></div></div>
<div class="ttc" id="agptoss__weights__index_8c_html_add8363effbaa37fcdc8b72a4d9a858af"><div class="ttname"><a href="gptoss__weights__index_8c.html#add8363effbaa37fcdc8b72a4d9a858af">widx_trace_enabled</a></div><div class="ttdeci">static int widx_trace_enabled(const gptoss_weights_index_t *idx)</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00087">gptoss_weights_index.c:87</a></div></div>
<div class="ttc" id="agptoss__weights__index_8c_html_ae6ffa18bb461a4aff5f94b8b20f71c93"><div class="ttname"><a href="gptoss__weights__index_8c.html#ae6ffa18bb461a4aff5f94b8b20f71c93">widx_mapped_open</a></div><div class="ttdeci">static int widx_mapped_open(gptoss_mapped_file_t *mf, const char *path)</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00201">gptoss_weights_index.c:201</a></div></div>
<div class="ttc" id="aie__io_8h_html_a4c501870bd45dbe373416745a03de987a66046f2226981286e47bb2f33ab56862"><div class="ttname"><a href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a66046f2226981286e47bb2f33ab56862">IE_IO_ERR_BIN_UNSPEC</a></div><div class="ttdeci">@ IE_IO_ERR_BIN_UNSPEC</div><div class="ttdoc">Binary path unspecified and not inferable.</div><div class="ttdef"><b>Definition</b> <a href="ie__io_8h_source.html#l00067">ie_io.h:67</a></div></div>
<div class="ttc" id="astructie__weights__dedup__opts__t_html"><div class="ttname"><a href="structie__weights__dedup__opts__t.html">ie_weights_dedup_opts_t</a></div><div class="ttdoc">Loader options.</div><div class="ttdef"><b>Definition</b> <a href="weights__dedup_8h_source.html#l00091">weights_dedup.h:91</a></div></div>
<div class="ttc" id="astructie__weights__dedup__opts__t_html_a86ae82fb8029f319a275251de5918035"><div class="ttname"><a href="structie__weights__dedup__opts__t.html#a86ae82fb8029f319a275251de5918035">ie_weights_dedup_opts_t::prefault_policy</a></div><div class="ttdeci">int prefault_policy</div><div class="ttdoc">Prefault policy for mmapped blobs: 0 = none, 1 = sequential, 2 = will-need.</div><div class="ttdef"><b>Definition</b> <a href="weights__dedup_8h_source.html#l00098">weights_dedup.h:98</a></div></div>
<div class="ttc" id="astructie__weights__s_html_a6cffa1c1904346d68932cc9542b8ff32"><div class="ttname"><a href="structie__weights__s.html#a6cffa1c1904346d68932cc9542b8ff32">ie_weights_s::dedup_handle</a></div><div class="ttdeci">void * dedup_handle</div><div class="ttdoc">Opaque dedup handle (owned by this struct).</div><div class="ttdef"><b>Definition</b> <a href="ie__io_8h_source.html#l00105">ie_io.h:105</a></div></div>
<div class="ttc" id="astructie__weights__s_html_ab1e17ac4f44125571f2c63e603d967da"><div class="ttname"><a href="structie__weights__s.html#ab1e17ac4f44125571f2c63e603d967da">ie_weights_s::is_dedup</a></div><div class="ttdeci">int is_dedup</div><div class="ttdoc">Non-zero if dedup artifacts were opened.</div><div class="ttdef"><b>Definition</b> <a href="ie__io_8h_source.html#l00104">ie_io.h:104</a></div></div>
<div class="ttc" id="astructie__weights__s_html_ab6a61099d0af4a47854d02dc4fef5b8f"><div class="ttname"><a href="structie__weights__s.html#ab6a61099d0af4a47854d02dc4fef5b8f">ie_weights_s::weights_path</a></div><div class="ttdeci">char weights_path[512]</div><div class="ttdoc">Resolved path to model.ie.bin.</div><div class="ttdef"><b>Definition</b> <a href="ie__io_8h_source.html#l00099">ie_io.h:99</a></div></div>
<div class="ttc" id="atensor__map_8h_html_ac4b913e2710929070b5b073b4b67b24c"><div class="ttname"><a href="tensor__map_8h.html#ac4b913e2710929070b5b073b4b67b24c">tensor_map_load</a></div><div class="ttdeci">int tensor_map_load(const char *path, tensor_map_t *out)</div><div class="ttdoc">Load tensor_map.json from disk.</div><div class="ttdef"><b>Definition</b> <a href="tensor__map_8c_source.html#l00484">tensor_map.c:484</a></div></div>
<div class="ttc" id="aweights__dedup_8h_html_a58857f75f23e827eb7a07572c0b93f2f"><div class="ttname"><a href="weights__dedup_8h.html#a58857f75f23e827eb7a07572c0b93f2f">ie_wdedup_status_t</a></div><div class="ttdeci">ie_wdedup_status_t</div><div class="ttdoc">Error/status codes for the dedup loader.</div><div class="ttdef"><b>Definition</b> <a href="weights__dedup_8h_source.html#l00034">weights_dedup.h:34</a></div></div>
<div class="ttc" id="aweights__dedup_8h_html_a58857f75f23e827eb7a07572c0b93f2fa0baf1bf45e91e9558e44038d27d20e2f"><div class="ttname"><a href="weights__dedup_8h.html#a58857f75f23e827eb7a07572c0b93f2fa0baf1bf45e91e9558e44038d27d20e2f">IE_WDEDUP_OK</a></div><div class="ttdeci">@ IE_WDEDUP_OK</div><div class="ttdef"><b>Definition</b> <a href="weights__dedup_8h_source.html#l00035">weights_dedup.h:35</a></div></div>
<div class="ttc" id="aweights__dedup_8h_html_aa625b41ce2a24826f8cb464661ace8ec"><div class="ttname"><a href="weights__dedup_8h.html#aa625b41ce2a24826f8cb464661ace8ec">ie_weights_dedup_open</a></div><div class="ttdeci">ie_wdedup_status_t ie_weights_dedup_open(ie_weights_dedup_t **out, const char *model_dir, const ie_weights_dedup_opts_t *opts)</div><div class="ttdoc">Open the dedup weights loader from a model directory.</div><div class="ttdef"><b>Definition</b> <a href="weights__dedup_8c_source.html#l01055">weights_dedup.c:1055</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ie__io_8h_source.html#l00105">ie_weights_s::dedup_handle</a>, <a class="el" href="ie__io_8h_source.html#l00065">IE_IO_ERR_ARGS</a>, <a class="el" href="ie__io_8h_source.html#l00067">IE_IO_ERR_BIN_UNSPEC</a>, <a class="el" href="ie__io_8h_source.html#l00066">IE_IO_ERR_JSON</a>, <a class="el" href="ie__io_8h_source.html#l00064">IE_IO_OK</a>, <a class="el" href="weights__dedup_8h_source.html#l00035">IE_WDEDUP_OK</a>, <a class="el" href="weights__dedup_8c_source.html#l01055">ie_weights_dedup_open()</a>, <a class="el" href="ie__io_8h_source.html#l00104">ie_weights_s::is_dedup</a>, <a class="el" href="weights__dedup_8h_source.html#l00098">ie_weights_dedup_opts_t::prefault_policy</a>, <a class="el" href="tensor__map_8c_source.html#l00650">tensor_map_free()</a>, <a class="el" href="tensor__map_8c_source.html#l00484">tensor_map_load()</a>, <a class="el" href="ie__io_8h_source.html#l00099">ie_weights_s::weights_path</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00201">widx_mapped_open()</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00113">widx_path_join()</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00087">widx_trace_enabled()</a>, and <a class="el" href="gptoss__weights__index_8c_source.html#l00091">widx_tracef()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8h_ab0abbe94d2373ea44d51f2325c7cc46c_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_996f45160da62e1a3d7f6046fad68f51.html">engine</a></li><li class="navelem"><a class="el" href="dir_bafa501d493553e442f19f5f8dd7b29c.html">include</a></li><li class="navelem"><a class="el" href="gptoss__weights__index_8h.html">gptoss_weights_index.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
