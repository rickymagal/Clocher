<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Inference Engine (Clocher): engine/src/ie_sampler.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Inference Engine (Clocher)<span id="projectnumber">&#160;0.2</span>
   </div>
   <div id="projectbrief">C11 CPU/GPU inference baseline with strict metrics &amp; harness</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('ie__sampler_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">ie_sampler.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Implementation of logits sampling utilities (greedy, temperature, top-k, top-p).  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="ie__sampler_8h_source.html">ie_sampler.h</a>&quot;</code><br />
<code>#include &lt;errno.h&gt;</code><br />
<code>#include &lt;float.h&gt;</code><br />
<code>#include &lt;inttypes.h&gt;</code><br />
<code>#include &lt;math.h&gt;</code><br />
<code>#include &lt;stddef.h&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for ie_sampler.c:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="ie__sampler_8c__incl.svg" width="100%" height="437"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
</div>
<p><a href="ie__sampler_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structie__prob__item.html">ie_prob_item</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Optional external decoder hook (weak).  <a href="structie__prob__item.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structie__sampler.html">ie_sampler</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="typedef-members" name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a9f3ba3956573370a92bbc52ce331761b" id="r_a9f3ba3956573370a92bbc52ce331761b"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structie__prob__item.html">ie_prob_item</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ie__sampler_8c.html#a9f3ba3956573370a92bbc52ce331761b">ie_prob_item_t</a></td></tr>
<tr class="memdesc:a9f3ba3956573370a92bbc52ce331761b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Optional external decoder hook (weak).  <br /></td></tr>
<tr class="separator:a9f3ba3956573370a92bbc52ce331761b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aa8d0c840dd47c694586a9311691a4bb8" id="r_aa8d0c840dd47c694586a9311691a4bb8"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ie__sampler_8c.html#aa8d0c840dd47c694586a9311691a4bb8">env_int_</a> (const char *name, int def, int minv, int maxv)</td></tr>
<tr class="separator:aa8d0c840dd47c694586a9311691a4bb8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a47cd2ba168244ca8b0c646059e180642" id="r_a47cd2ba168244ca8b0c646059e180642"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ie__sampler_8c.html#a47cd2ba168244ca8b0c646059e180642">debug_topk_k_</a> (void)</td></tr>
<tr class="separator:a47cd2ba168244ca8b0c646059e180642"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a013170d8fd2bdbfcde355a909669f7fe" id="r_a013170d8fd2bdbfcde355a909669f7fe"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ie__sampler_8c.html#a013170d8fd2bdbfcde355a909669f7fe">debug_topk_every_</a> (void)</td></tr>
<tr class="separator:a013170d8fd2bdbfcde355a909669f7fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ec0510e6ee8982bd86df6677d1b3234" id="r_a3ec0510e6ee8982bd86df6677d1b3234"><td class="memItemLeft" align="right" valign="top">static uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ie__sampler_8c.html#a3ec0510e6ee8982bd86df6677d1b3234">debug_topk_limit_</a> (void)</td></tr>
<tr class="separator:a3ec0510e6ee8982bd86df6677d1b3234"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae396ca396816809dfb9184ea32455662" id="r_ae396ca396816809dfb9184ea32455662"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ie__sampler_8c.html#ae396ca396816809dfb9184ea32455662">debug_topk_should_dump_</a> (uint64_t call_idx)</td></tr>
<tr class="separator:ae396ca396816809dfb9184ea32455662"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba2243bcbf50400fcce307c470dee85e" id="r_aba2243bcbf50400fcce307c470dee85e"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ie__sampler_8c.html#aba2243bcbf50400fcce307c470dee85e">decode_preview_</a> (uint32_t id, char *dst, size_t cap)</td></tr>
<tr class="separator:aba2243bcbf50400fcce307c470dee85e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a80512fa27903ef264dba3ae7443bcc0b" id="r_a80512fa27903ef264dba3ae7443bcc0b"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ie__sampler_8c.html#a80512fa27903ef264dba3ae7443bcc0b">debug_dump_topk_logits_</a> (const float *logits, const float *probs, size_t n, float temperature, int allow_nan, int k, uint64_t call_idx)</td></tr>
<tr class="separator:a80512fa27903ef264dba3ae7443bcc0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a70896b3079ea28cde50b95fe2b1d0c" id="r_a4a70896b3079ea28cde50b95fe2b1d0c"><td class="memItemLeft" align="right" valign="top">static uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ie__sampler_8c.html#a4a70896b3079ea28cde50b95fe2b1d0c">rng_next_u64</a> (uint64_t *state)</td></tr>
<tr class="memdesc:a4a70896b3079ea28cde50b95fe2b1d0c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Xorshift64* PRNG step.  <br /></td></tr>
<tr class="separator:a4a70896b3079ea28cde50b95fe2b1d0c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa74353c6e8d0bfd4561ddd0adc8c5190" id="r_aa74353c6e8d0bfd4561ddd0adc8c5190"><td class="memItemLeft" align="right" valign="top">static float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ie__sampler_8c.html#aa74353c6e8d0bfd4561ddd0adc8c5190">rng_next_f01</a> (uint64_t *state)</td></tr>
<tr class="memdesc:aa74353c6e8d0bfd4561ddd0adc8c5190"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert RNG output to uniform float in [0,1).  <br /></td></tr>
<tr class="separator:aa74353c6e8d0bfd4561ddd0adc8c5190"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f49437bd493fd9354f0a7a355722043" id="r_a0f49437bd493fd9354f0a7a355722043"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ie__sampler_8c.html#a0f49437bd493fd9354f0a7a355722043">prob_item_cmp_desc</a> (const void *a, const void *b)</td></tr>
<tr class="memdesc:a0f49437bd493fd9354f0a7a355722043"><td class="mdescLeft">&#160;</td><td class="mdescRight">Comparator for descending probability sort.  <br /></td></tr>
<tr class="separator:a0f49437bd493fd9354f0a7a355722043"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a09ebf6bf5245c55a63cb996796da3cf3" id="r_a09ebf6bf5245c55a63cb996796da3cf3"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ie__sampler_8c.html#a09ebf6bf5245c55a63cb996796da3cf3">argmax_logits</a> (const float *logits, size_t n, int allow_nan, uint32_t *out_id)</td></tr>
<tr class="memdesc:a09ebf6bf5245c55a63cb996796da3cf3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compute argmax of logits, treating NaN as -inf if allowed.  <br /></td></tr>
<tr class="separator:a09ebf6bf5245c55a63cb996796da3cf3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af5f864c248d511ca9d737ae30b857430" id="r_af5f864c248d511ca9d737ae30b857430"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ie__sampler_8c.html#af5f864c248d511ca9d737ae30b857430">softmax_probs</a> (const float *logits, size_t n, float temperature, int allow_nan, float *probs)</td></tr>
<tr class="memdesc:af5f864c248d511ca9d737ae30b857430"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compute softmax probabilities from logits with temperature scaling.  <br /></td></tr>
<tr class="separator:af5f864c248d511ca9d737ae30b857430"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae65ee73ae9813d46ce65e3b5e98d5f4c" id="r_ae65ee73ae9813d46ce65e3b5e98d5f4c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ie__sampler_8c.html#ae65ee73ae9813d46ce65e3b5e98d5f4c">ie_sampler_cfg_default</a> (<a class="el" href="ie__sampler_8h.html#a1facc6ea7b61846ca4090794c6930b8b">ie_sampler_cfg_t</a> *cfg)</td></tr>
<tr class="memdesc:ae65ee73ae9813d46ce65e3b5e98d5f4c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fill a configuration struct with sane defaults.  <br /></td></tr>
<tr class="separator:ae65ee73ae9813d46ce65e3b5e98d5f4c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a199d467fcf3d0dc4622c97356b0c6567" id="r_a199d467fcf3d0dc4622c97356b0c6567"><td class="memItemLeft" align="right" valign="top"><a class="el" href="ie__sampler_8h.html#a4f1437d0ac100e556fa81874d894e138">ie_sampler_status_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ie__sampler_8c.html#a199d467fcf3d0dc4622c97356b0c6567">ie_sampler_create</a> (<a class="el" href="ie__sampler_8h.html#a061b934445c6c6e955d48d6e36d9231a">ie_sampler_t</a> **out, size_t vocab_size, const <a class="el" href="ie__sampler_8h.html#a1facc6ea7b61846ca4090794c6930b8b">ie_sampler_cfg_t</a> *cfg, uint64_t seed)</td></tr>
<tr class="memdesc:a199d467fcf3d0dc4622c97356b0c6567"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a sampler for a fixed vocabulary size.  <br /></td></tr>
<tr class="separator:a199d467fcf3d0dc4622c97356b0c6567"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1a8638695582f8d4991da4f47781df70" id="r_a1a8638695582f8d4991da4f47781df70"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ie__sampler_8c.html#a1a8638695582f8d4991da4f47781df70">ie_sampler_destroy</a> (<a class="el" href="ie__sampler_8h.html#a061b934445c6c6e955d48d6e36d9231a">ie_sampler_t</a> **ps)</td></tr>
<tr class="memdesc:a1a8638695582f8d4991da4f47781df70"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destroy a sampler and release all resources.  <br /></td></tr>
<tr class="separator:a1a8638695582f8d4991da4f47781df70"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aadb041c9c359bfdb9b412688a6717fa1" id="r_aadb041c9c359bfdb9b412688a6717fa1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="ie__sampler_8h.html#a4f1437d0ac100e556fa81874d894e138">ie_sampler_status_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ie__sampler_8c.html#aadb041c9c359bfdb9b412688a6717fa1">ie_sampler_set_cfg</a> (<a class="el" href="ie__sampler_8h.html#a061b934445c6c6e955d48d6e36d9231a">ie_sampler_t</a> *s, const <a class="el" href="ie__sampler_8h.html#a1facc6ea7b61846ca4090794c6930b8b">ie_sampler_cfg_t</a> *cfg)</td></tr>
<tr class="memdesc:aadb041c9c359bfdb9b412688a6717fa1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update sampler configuration.  <br /></td></tr>
<tr class="separator:aadb041c9c359bfdb9b412688a6717fa1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1dcd20a140321046a809f7bd925d2f9e" id="r_a1dcd20a140321046a809f7bd925d2f9e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="ie__sampler_8h.html#a4f1437d0ac100e556fa81874d894e138">ie_sampler_status_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ie__sampler_8c.html#a1dcd20a140321046a809f7bd925d2f9e">ie_sampler_set_seed</a> (<a class="el" href="ie__sampler_8h.html#a061b934445c6c6e955d48d6e36d9231a">ie_sampler_t</a> *s, uint64_t seed)</td></tr>
<tr class="memdesc:a1dcd20a140321046a809f7bd925d2f9e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reset sampler RNG seed.  <br /></td></tr>
<tr class="separator:a1dcd20a140321046a809f7bd925d2f9e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a60cc4d87efcfb6b8aadd27e3f56e789d" id="r_a60cc4d87efcfb6b8aadd27e3f56e789d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="ie__sampler_8h.html#a4f1437d0ac100e556fa81874d894e138">ie_sampler_status_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ie__sampler_8c.html#a60cc4d87efcfb6b8aadd27e3f56e789d">ie_sampler_sample</a> (<a class="el" href="ie__sampler_8h.html#a061b934445c6c6e955d48d6e36d9231a">ie_sampler_t</a> *s, const float *logits, size_t logits_len, uint32_t *out_id, float *out_prob)</td></tr>
<tr class="memdesc:a60cc4d87efcfb6b8aadd27e3f56e789d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sample a token id from logits.  <br /></td></tr>
<tr class="separator:a60cc4d87efcfb6b8aadd27e3f56e789d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a02c1c1c1c824cc114bccca38e4bf47d6" id="r_a02c1c1c1c824cc114bccca38e4bf47d6"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ie__sampler_8c.html#a02c1c1c1c824cc114bccca38e4bf47d6">ie_sampler_status_str</a> (<a class="el" href="ie__sampler_8h.html#a4f1437d0ac100e556fa81874d894e138">ie_sampler_status_t</a> st)</td></tr>
<tr class="memdesc:a02c1c1c1c824cc114bccca38e4bf47d6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert status to string.  <br /></td></tr>
<tr class="separator:a02c1c1c1c824cc114bccca38e4bf47d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Implementation of logits sampling utilities (greedy, temperature, top-k, top-p). </p>
<p>Notes:</p><ul>
<li>This module performs softmax in float and may allocate O(vocab) scratch.</li>
<li>For large vocabularies, this is not optimal; once the model forward pass is wired, you may prefer partial selection without full softmax.</li>
<li>The goal here is correctness and debuggability to unblock coherent text generation.</li>
</ul>
<p>Debugging:</p><ul>
<li>IE_DEBUG_TOPK: If set to K&gt;0, dump the top-K logits (and decoded pieces if available).</li>
<li>IE_DEBUG_TOPK_EVERY: If set to N&gt;0, dump every N calls to ie_sampler_sample (default: 1).</li>
<li>IE_DEBUG_TOPK_LIMIT: If set to M&gt;0, stop dumping after M dumps (default: unlimited).</li>
</ul>
<p>Decoding:</p><ul>
<li>If the engine provides a token decoder as a weak symbol: int ie_debug_decode_token(uint32_t id, char *dst, size_t cap); then the dump will include a best-effort decoded preview string.</li>
<li>If not provided, the dump prints "&lt;no_decoder&gt;". </li>
</ul>

<p class="definition">Definition in file <a class="el" href="ie__sampler_8c_source.html">ie_sampler.c</a>.</p>
</div><h2 class="groupheader">Typedef Documentation</h2>
<a id="a9f3ba3956573370a92bbc52ce331761b" name="a9f3ba3956573370a92bbc52ce331761b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9f3ba3956573370a92bbc52ce331761b">&#9670;&#160;</a></span>ie_prob_item_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structie__prob__item.html">ie_prob_item</a> <a class="el" href="ie__sampler_8c.html#a9f3ba3956573370a92bbc52ce331761b">ie_prob_item_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Optional external decoder hook (weak). </p>
<p>If linked, it should write a NUL-terminated UTF-8 (or best-effort) token piece preview into dst. Return nonzero on success.</p>
<p>Work item used for sorting probabilities. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a09ebf6bf5245c55a63cb996796da3cf3" name="a09ebf6bf5245c55a63cb996796da3cf3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a09ebf6bf5245c55a63cb996796da3cf3">&#9670;&#160;</a></span>argmax_logits()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int argmax_logits </td>
          <td>(</td>
          <td class="paramtype">const float *&#160;</td>
          <td class="paramname"><em>logits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>allow_nan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>out_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Compute argmax of logits, treating NaN as -inf if allowed. </p>

<p class="definition">Definition at line <a class="el" href="ie__sampler_8c_source.html#l00267">267</a> of file <a class="el" href="ie__sampler_8c_source.html">ie_sampler.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  267</span>                                                                                         {</div>
<div class="line"><span class="lineno">  268</span>  <span class="keywordflow">if</span> (!logits || n == 0 || !out_id) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  269</span> </div>
<div class="line"><span class="lineno">  270</span>  <span class="keywordtype">float</span> best = -FLT_MAX;</div>
<div class="line"><span class="lineno">  271</span>  uint32_t best_id = 0;</div>
<div class="line"><span class="lineno">  272</span> </div>
<div class="line"><span class="lineno">  273</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; n; ++i) {</div>
<div class="line"><span class="lineno">  274</span>    <span class="keywordtype">float</span> v = logits[i];</div>
<div class="line"><span class="lineno">  275</span>    <span class="keywordflow">if</span> (isnan(v)) {</div>
<div class="line"><span class="lineno">  276</span>      <span class="keywordflow">if</span> (!allow_nan) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  277</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  278</span>    }</div>
<div class="line"><span class="lineno">  279</span>    <span class="keywordflow">if</span> (v &gt; best) {</div>
<div class="line"><span class="lineno">  280</span>      best = v;</div>
<div class="line"><span class="lineno">  281</span>      best_id = (uint32_t)i;</div>
<div class="line"><span class="lineno">  282</span>    }</div>
<div class="line"><span class="lineno">  283</span>  }</div>
<div class="line"><span class="lineno">  284</span> </div>
<div class="line"><span class="lineno">  285</span>  *out_id = best_id;</div>
<div class="line"><span class="lineno">  286</span>  <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  287</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="ie__sampler_8c_source.html#l00404">ie_sampler_sample()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="ie__sampler_8c_a09ebf6bf5245c55a63cb996796da3cf3_icgraph.svg" width="323" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a80512fa27903ef264dba3ae7443bcc0b" name="a80512fa27903ef264dba3ae7443bcc0b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a80512fa27903ef264dba3ae7443bcc0b">&#9670;&#160;</a></span>debug_dump_topk_logits_()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void debug_dump_topk_logits_ </td>
          <td>(</td>
          <td class="paramtype">const float *&#160;</td>
          <td class="paramname"><em>logits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const float *&#160;</td>
          <td class="paramname"><em>probs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>temperature</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>allow_nan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>k</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>call_idx</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ie__sampler_8c_source.html#l00156">156</a> of file <a class="el" href="ie__sampler_8c_source.html">ie_sampler.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  162</span>                                                      {</div>
<div class="line"><span class="lineno">  163</span>  <span class="keywordflow">if</span> (!logits || n == 0 || k &lt;= 0) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  164</span>  <span class="keywordflow">if</span> (k &gt; 64) k = 64;</div>
<div class="line"><span class="lineno">  165</span>  <span class="keywordflow">if</span> ((<span class="keywordtype">size_t</span>)k &gt; n) k = (int)n;</div>
<div class="line"><span class="lineno">  166</span> </div>
<div class="line"><span class="lineno">  167</span>  uint32_t top_id[64];</div>
<div class="line"><span class="lineno">  168</span>  <span class="keywordtype">float</span> top_l[64];</div>
<div class="line"><span class="lineno">  169</span> </div>
<div class="line"><span class="lineno">  170</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; k; ++i) {</div>
<div class="line"><span class="lineno">  171</span>    top_id[i] = 0;</div>
<div class="line"><span class="lineno">  172</span>    top_l[i] = -INFINITY;</div>
<div class="line"><span class="lineno">  173</span>  }</div>
<div class="line"><span class="lineno">  174</span> </div>
<div class="line"><span class="lineno">  175</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; n; ++i) {</div>
<div class="line"><span class="lineno">  176</span>    <span class="keywordtype">float</span> v = logits[i];</div>
<div class="line"><span class="lineno">  177</span>    <span class="keywordflow">if</span> (isnan(v)) {</div>
<div class="line"><span class="lineno">  178</span>      <span class="keywordflow">if</span> (!allow_nan) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  179</span>      v = -INFINITY;</div>
<div class="line"><span class="lineno">  180</span>    }</div>
<div class="line"><span class="lineno">  181</span>    <span class="keywordflow">if</span> (v &lt;= top_l[k - 1]) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  182</span> </div>
<div class="line"><span class="lineno">  183</span>    <span class="keywordtype">int</span> pos = k - 1;</div>
<div class="line"><span class="lineno">  184</span>    <span class="keywordflow">while</span> (pos &gt; 0 &amp;&amp; v &gt; top_l[pos - 1]) {</div>
<div class="line"><span class="lineno">  185</span>      top_l[pos] = top_l[pos - 1];</div>
<div class="line"><span class="lineno">  186</span>      top_id[pos] = top_id[pos - 1];</div>
<div class="line"><span class="lineno">  187</span>      --pos;</div>
<div class="line"><span class="lineno">  188</span>    }</div>
<div class="line"><span class="lineno">  189</span>    top_l[pos] = v;</div>
<div class="line"><span class="lineno">  190</span>    top_id[pos] = (uint32_t)i;</div>
<div class="line"><span class="lineno">  191</span>  }</div>
<div class="line"><span class="lineno">  192</span> </div>
<div class="line"><span class="lineno">  193</span>  fprintf(stderr,</div>
<div class="line"><span class="lineno">  194</span>          <span class="stringliteral">&quot;[sampler][topk_logits] call=%&quot;</span> PRIu64 <span class="stringliteral">&quot; k=%d temp=%.6g\n&quot;</span>,</div>
<div class="line"><span class="lineno">  195</span>          (uint64_t)call_idx,</div>
<div class="line"><span class="lineno">  196</span>          k,</div>
<div class="line"><span class="lineno">  197</span>          (<span class="keywordtype">double</span>)temperature);</div>
<div class="line"><span class="lineno">  198</span> </div>
<div class="line"><span class="lineno">  199</span>  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> r = 0; r &lt; k; ++r) {</div>
<div class="line"><span class="lineno">  200</span>    <span class="keyword">const</span> uint32_t <span class="keywordtype">id</span> = top_id[r];</div>
<div class="line"><span class="lineno">  201</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> logit_raw = top_l[r];</div>
<div class="line"><span class="lineno">  202</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> logit_scaled = (temperature &gt; 0.0f) ? (logit_raw / temperature) : logit_raw;</div>
<div class="line"><span class="lineno">  203</span>    <span class="keyword">const</span> <span class="keywordtype">float</span> p = (probs ? probs[id] : -1.0f);</div>
<div class="line"><span class="lineno">  204</span> </div>
<div class="line"><span class="lineno">  205</span>    <span class="keywordtype">char</span> piece[160];</div>
<div class="line"><span class="lineno">  206</span>    <a class="code hl_function" href="ie__sampler_8c.html#aba2243bcbf50400fcce307c470dee85e">decode_preview_</a>(<span class="keywordtype">id</span>, piece, <span class="keyword">sizeof</span>(piece));</div>
<div class="line"><span class="lineno">  207</span> </div>
<div class="line"><span class="lineno">  208</span>    fprintf(stderr,</div>
<div class="line"><span class="lineno">  209</span>            <span class="stringliteral">&quot;[sampler][topk_logits] rank=%d id=%&quot;</span> PRIu32 <span class="stringliteral">&quot; logit=%.9g scaled=%.9g prob=%.9g piece=\&quot;%s\&quot;\n&quot;</span>,</div>
<div class="line"><span class="lineno">  210</span>            r,</div>
<div class="line"><span class="lineno">  211</span>            <span class="keywordtype">id</span>,</div>
<div class="line"><span class="lineno">  212</span>            (<span class="keywordtype">double</span>)logit_raw,</div>
<div class="line"><span class="lineno">  213</span>            (<span class="keywordtype">double</span>)logit_scaled,</div>
<div class="line"><span class="lineno">  214</span>            (<span class="keywordtype">double</span>)p,</div>
<div class="line"><span class="lineno">  215</span>            piece);</div>
<div class="line"><span class="lineno">  216</span>  }</div>
<div class="line"><span class="lineno">  217</span>}</div>
<div class="ttc" id="aie__sampler_8c_html_aba2243bcbf50400fcce307c470dee85e"><div class="ttname"><a href="ie__sampler_8c.html#aba2243bcbf50400fcce307c470dee85e">decode_preview_</a></div><div class="ttdeci">static void decode_preview_(uint32_t id, char *dst, size_t cap)</div><div class="ttdef"><b>Definition</b> <a href="ie__sampler_8c_source.html#l00135">ie_sampler.c:135</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ie__sampler_8c_source.html#l00135">decode_preview_()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ie__sampler_8c_source.html#l00404">ie_sampler_sample()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="ie__sampler_8c_a80512fa27903ef264dba3ae7443bcc0b_cgraph.svg" width="386" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="ie__sampler_8c_a80512fa27903ef264dba3ae7443bcc0b_icgraph.svg" width="400" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a013170d8fd2bdbfcde355a909669f7fe" name="a013170d8fd2bdbfcde355a909669f7fe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a013170d8fd2bdbfcde355a909669f7fe">&#9670;&#160;</a></span>debug_topk_every_()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int debug_topk_every_ </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ie__sampler_8c_source.html#l00093">93</a> of file <a class="el" href="ie__sampler_8c_source.html">ie_sampler.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   93</span>                                   {</div>
<div class="line"><span class="lineno">   94</span>  <span class="keyword">static</span> <span class="keywordtype">int</span> inited = 0;</div>
<div class="line"><span class="lineno">   95</span>  <span class="keyword">static</span> <span class="keywordtype">int</span> every = 1;</div>
<div class="line"><span class="lineno">   96</span>  <span class="keywordflow">if</span> (!inited) {</div>
<div class="line"><span class="lineno">   97</span>    every = <a class="code hl_function" href="ie__sampler_8c.html#aa8d0c840dd47c694586a9311691a4bb8">env_int_</a>(<span class="stringliteral">&quot;IE_DEBUG_TOPK_EVERY&quot;</span>, 1, 1, 1000000000);</div>
<div class="line"><span class="lineno">   98</span>    inited = 1;</div>
<div class="line"><span class="lineno">   99</span>  }</div>
<div class="line"><span class="lineno">  100</span>  <span class="keywordflow">return</span> every;</div>
<div class="line"><span class="lineno">  101</span>}</div>
<div class="ttc" id="aie__sampler_8c_html_aa8d0c840dd47c694586a9311691a4bb8"><div class="ttname"><a href="ie__sampler_8c.html#aa8d0c840dd47c694586a9311691a4bb8">env_int_</a></div><div class="ttdeci">static int env_int_(const char *name, int def, int minv, int maxv)</div><div class="ttdef"><b>Definition</b> <a href="ie__sampler_8c_source.html#l00069">ie_sampler.c:69</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ie__sampler_8c_source.html#l00069">env_int_()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ie__sampler_8c_source.html#l00119">debug_topk_should_dump_()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="ie__sampler_8c_a013170d8fd2bdbfcde355a909669f7fe_cgraph.svg" width="286" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="ie__sampler_8c_a013170d8fd2bdbfcde355a909669f7fe_icgraph.svg" width="604" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a47cd2ba168244ca8b0c646059e180642" name="a47cd2ba168244ca8b0c646059e180642"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a47cd2ba168244ca8b0c646059e180642">&#9670;&#160;</a></span>debug_topk_k_()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int debug_topk_k_ </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ie__sampler_8c_source.html#l00083">83</a> of file <a class="el" href="ie__sampler_8c_source.html">ie_sampler.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   83</span>                               {</div>
<div class="line"><span class="lineno">   84</span>  <span class="keyword">static</span> <span class="keywordtype">int</span> inited = 0;</div>
<div class="line"><span class="lineno">   85</span>  <span class="keyword">static</span> <span class="keywordtype">int</span> k = 0;</div>
<div class="line"><span class="lineno">   86</span>  <span class="keywordflow">if</span> (!inited) {</div>
<div class="line"><span class="lineno">   87</span>    k = <a class="code hl_function" href="ie__sampler_8c.html#aa8d0c840dd47c694586a9311691a4bb8">env_int_</a>(<span class="stringliteral">&quot;IE_DEBUG_TOPK&quot;</span>, 0, 0, 128);</div>
<div class="line"><span class="lineno">   88</span>    inited = 1;</div>
<div class="line"><span class="lineno">   89</span>  }</div>
<div class="line"><span class="lineno">   90</span>  <span class="keywordflow">return</span> k;</div>
<div class="line"><span class="lineno">   91</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ie__sampler_8c_source.html#l00069">env_int_()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ie__sampler_8c_source.html#l00119">debug_topk_should_dump_()</a>, and <a class="el" href="ie__sampler_8c_source.html#l00404">ie_sampler_sample()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="ie__sampler_8c_a47cd2ba168244ca8b0c646059e180642_cgraph.svg" width="256" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="ie__sampler_8c_a47cd2ba168244ca8b0c646059e180642_icgraph.svg" width="575" height="62"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a3ec0510e6ee8982bd86df6677d1b3234" name="a3ec0510e6ee8982bd86df6677d1b3234"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3ec0510e6ee8982bd86df6677d1b3234">&#9670;&#160;</a></span>debug_topk_limit_()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint64_t debug_topk_limit_ </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ie__sampler_8c_source.html#l00103">103</a> of file <a class="el" href="ie__sampler_8c_source.html">ie_sampler.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  103</span>                                        {</div>
<div class="line"><span class="lineno">  104</span>  <span class="keyword">static</span> <span class="keywordtype">int</span> inited = 0;</div>
<div class="line"><span class="lineno">  105</span>  <span class="keyword">static</span> uint64_t lim = 0;</div>
<div class="line"><span class="lineno">  106</span>  <span class="keywordflow">if</span> (!inited) {</div>
<div class="line"><span class="lineno">  107</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *v = getenv(<span class="stringliteral">&quot;IE_DEBUG_TOPK_LIMIT&quot;</span>);</div>
<div class="line"><span class="lineno">  108</span>    <span class="keywordflow">if</span> (v &amp;&amp; *v) {</div>
<div class="line"><span class="lineno">  109</span>      errno = 0;</div>
<div class="line"><span class="lineno">  110</span>      <span class="keywordtype">char</span> *end = NULL;</div>
<div class="line"><span class="lineno">  111</span>      <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> x = strtoull(v, &amp;end, 10);</div>
<div class="line"><span class="lineno">  112</span>      <span class="keywordflow">if</span> (errno == 0 &amp;&amp; end &amp;&amp; end != v) lim = (uint64_t)x;</div>
<div class="line"><span class="lineno">  113</span>    }</div>
<div class="line"><span class="lineno">  114</span>    inited = 1;</div>
<div class="line"><span class="lineno">  115</span>  }</div>
<div class="line"><span class="lineno">  116</span>  <span class="keywordflow">return</span> lim;</div>
<div class="line"><span class="lineno">  117</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="ie__sampler_8c_source.html#l00119">debug_topk_should_dump_()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="ie__sampler_8c_a3ec0510e6ee8982bd86df6677d1b3234_icgraph.svg" width="598" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ae396ca396816809dfb9184ea32455662" name="ae396ca396816809dfb9184ea32455662"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae396ca396816809dfb9184ea32455662">&#9670;&#160;</a></span>debug_topk_should_dump_()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int debug_topk_should_dump_ </td>
          <td>(</td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>call_idx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ie__sampler_8c_source.html#l00119">119</a> of file <a class="el" href="ie__sampler_8c_source.html">ie_sampler.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  119</span>                                                      {</div>
<div class="line"><span class="lineno">  120</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> k = <a class="code hl_function" href="ie__sampler_8c.html#a47cd2ba168244ca8b0c646059e180642">debug_topk_k_</a>();</div>
<div class="line"><span class="lineno">  121</span>  <span class="keywordflow">if</span> (k &lt;= 0) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  122</span> </div>
<div class="line"><span class="lineno">  123</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> every = <a class="code hl_function" href="ie__sampler_8c.html#a013170d8fd2bdbfcde355a909669f7fe">debug_topk_every_</a>();</div>
<div class="line"><span class="lineno">  124</span>  <span class="keywordflow">if</span> (every &lt;= 0) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  125</span>  <span class="keywordflow">if</span> ((call_idx % (uint64_t)every) != 0) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  126</span> </div>
<div class="line"><span class="lineno">  127</span>  <span class="keyword">const</span> uint64_t lim = <a class="code hl_function" href="ie__sampler_8c.html#a3ec0510e6ee8982bd86df6677d1b3234">debug_topk_limit_</a>();</div>
<div class="line"><span class="lineno">  128</span>  <span class="keywordflow">if</span> (lim == 0) <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  129</span> </div>
<div class="line"><span class="lineno">  130</span>  <span class="comment">/* call_idx is 1-based; approximate dump-count as call_idx/every rounded up. */</span></div>
<div class="line"><span class="lineno">  131</span>  <span class="keyword">const</span> uint64_t dump_no = (call_idx + (uint64_t)every - 1) / (uint64_t)every;</div>
<div class="line"><span class="lineno">  132</span>  <span class="keywordflow">return</span> dump_no &lt;= lim;</div>
<div class="line"><span class="lineno">  133</span>}</div>
<div class="ttc" id="aie__sampler_8c_html_a013170d8fd2bdbfcde355a909669f7fe"><div class="ttname"><a href="ie__sampler_8c.html#a013170d8fd2bdbfcde355a909669f7fe">debug_topk_every_</a></div><div class="ttdeci">static int debug_topk_every_(void)</div><div class="ttdef"><b>Definition</b> <a href="ie__sampler_8c_source.html#l00093">ie_sampler.c:93</a></div></div>
<div class="ttc" id="aie__sampler_8c_html_a3ec0510e6ee8982bd86df6677d1b3234"><div class="ttname"><a href="ie__sampler_8c.html#a3ec0510e6ee8982bd86df6677d1b3234">debug_topk_limit_</a></div><div class="ttdeci">static uint64_t debug_topk_limit_(void)</div><div class="ttdef"><b>Definition</b> <a href="ie__sampler_8c_source.html#l00103">ie_sampler.c:103</a></div></div>
<div class="ttc" id="aie__sampler_8c_html_a47cd2ba168244ca8b0c646059e180642"><div class="ttname"><a href="ie__sampler_8c.html#a47cd2ba168244ca8b0c646059e180642">debug_topk_k_</a></div><div class="ttdeci">static int debug_topk_k_(void)</div><div class="ttdef"><b>Definition</b> <a href="ie__sampler_8c_source.html#l00083">ie_sampler.c:83</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ie__sampler_8c_source.html#l00093">debug_topk_every_()</a>, <a class="el" href="ie__sampler_8c_source.html#l00083">debug_topk_k_()</a>, and <a class="el" href="ie__sampler_8c_source.html#l00103">debug_topk_limit_()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ie__sampler_8c_source.html#l00404">ie_sampler_sample()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="ie__sampler_8c_ae396ca396816809dfb9184ea32455662_cgraph.svg" width="532" height="135"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="ie__sampler_8c_ae396ca396816809dfb9184ea32455662_icgraph.svg" width="407" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="aba2243bcbf50400fcce307c470dee85e" name="aba2243bcbf50400fcce307c470dee85e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aba2243bcbf50400fcce307c470dee85e">&#9670;&#160;</a></span>decode_preview_()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void decode_preview_ </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>cap</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ie__sampler_8c_source.html#l00135">135</a> of file <a class="el" href="ie__sampler_8c_source.html">ie_sampler.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  135</span>                                                                {</div>
<div class="line"><span class="lineno">  136</span>  <span class="keywordflow">if</span> (!dst || cap == 0) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  137</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a415d14a7ade776b6bb2e544f0be25e6b">dst</a>[0] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  138</span> </div>
<div class="line"><span class="lineno">  139</span><span class="preprocessor">#if defined(__GNUC__) || defined(__clang__)</span></div>
<div class="line"><span class="lineno">  140</span>  <span class="keywordflow">if</span> (ie_debug_decode_token) {</div>
<div class="line"><span class="lineno">  141</span>    <span class="keywordflow">if</span> (ie_debug_decode_token(<span class="keywordtype">id</span>, dst, cap)) {</div>
<div class="line"><span class="lineno">  142</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a415d14a7ade776b6bb2e544f0be25e6b">dst</a>[cap - 1] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  143</span>      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a415d14a7ade776b6bb2e544f0be25e6b">dst</a>[i]; ++i) {</div>
<div class="line"><span class="lineno">  144</span>        <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> c = (<span class="keywordtype">unsigned</span> char)dst[i];</div>
<div class="line"><span class="lineno">  145</span>        <span class="keywordflow">if</span> (c &lt; 0x20 || c == 0x7f) <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a415d14a7ade776b6bb2e544f0be25e6b">dst</a>[i] = <span class="charliteral">&#39; &#39;</span>;</div>
<div class="line"><span class="lineno">  146</span>      }</div>
<div class="line"><span class="lineno">  147</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  148</span>    }</div>
<div class="line"><span class="lineno">  149</span>  }</div>
<div class="line"><span class="lineno">  150</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  151</span> </div>
<div class="line"><span class="lineno">  152</span>  (void)snprintf(dst, cap, <span class="stringliteral">&quot;&lt;no_decoder&gt;&quot;</span>);</div>
<div class="line"><span class="lineno">  153</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a415d14a7ade776b6bb2e544f0be25e6b">dst</a>[cap - 1] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  154</span>}</div>
<div class="ttc" id="anamespaceconvert__dtypes__to__numeric_html_a415d14a7ade776b6bb2e544f0be25e6b"><div class="ttname"><a href="namespaceconvert__dtypes__to__numeric.html#a415d14a7ade776b6bb2e544f0be25e6b">convert_dtypes_to_numeric.dst</a></div><div class="ttdeci">dst</div><div class="ttdef"><b>Definition</b> <a href="convert__dtypes__to__numeric_8py_source.html#l00027">convert_dtypes_to_numeric.py:27</a></div></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="ie__sampler_8c_source.html#l00156">debug_dump_topk_logits_()</a>, and <a class="el" href="ie__sampler_8c_source.html#l00404">ie_sampler_sample()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="ie__sampler_8c_aba2243bcbf50400fcce307c470dee85e_icgraph.svg" width="583" height="62"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="aa8d0c840dd47c694586a9311691a4bb8" name="aa8d0c840dd47c694586a9311691a4bb8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa8d0c840dd47c694586a9311691a4bb8">&#9670;&#160;</a></span>env_int_()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int env_int_ </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>def</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>minv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>maxv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ie__sampler_8c_source.html#l00069">69</a> of file <a class="el" href="ie__sampler_8c_source.html">ie_sampler.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   69</span>                                                                   {</div>
<div class="line"><span class="lineno">   70</span>  <span class="keyword">const</span> <span class="keywordtype">char</span> *v = getenv(name);</div>
<div class="line"><span class="lineno">   71</span>  <span class="keywordflow">if</span> (!v || !*v) <span class="keywordflow">return</span> def;</div>
<div class="line"><span class="lineno">   72</span> </div>
<div class="line"><span class="lineno">   73</span>  errno = 0;</div>
<div class="line"><span class="lineno">   74</span>  <span class="keywordtype">char</span> *end = NULL;</div>
<div class="line"><span class="lineno">   75</span>  <span class="keywordtype">long</span> x = strtol(v, &amp;end, 10);</div>
<div class="line"><span class="lineno">   76</span>  <span class="keywordflow">if</span> (errno != 0 || !end || end == v) <span class="keywordflow">return</span> def;</div>
<div class="line"><span class="lineno">   77</span> </div>
<div class="line"><span class="lineno">   78</span>  <span class="keywordflow">if</span> (x &lt; (<span class="keywordtype">long</span>)minv) x = (long)minv;</div>
<div class="line"><span class="lineno">   79</span>  <span class="keywordflow">if</span> (x &gt; (<span class="keywordtype">long</span>)maxv) x = (<span class="keywordtype">long</span>)maxv;</div>
<div class="line"><span class="lineno">   80</span>  <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)x;</div>
<div class="line"><span class="lineno">   81</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="ie__sampler_8c_source.html#l00093">debug_topk_every_()</a>, and <a class="el" href="ie__sampler_8c_source.html#l00083">debug_topk_k_()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="ie__sampler_8c_aa8d0c840dd47c694586a9311691a4bb8_icgraph.svg" width="100%" height="364"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="ae65ee73ae9813d46ce65e3b5e98d5f4c" name="ae65ee73ae9813d46ce65e3b5e98d5f4c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae65ee73ae9813d46ce65e3b5e98d5f4c">&#9670;&#160;</a></span>ie_sampler_cfg_default()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ie_sampler_cfg_default </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ie__sampler_8h.html#a1facc6ea7b61846ca4090794c6930b8b">ie_sampler_cfg_t</a> *&#160;</td>
          <td class="paramname"><em>cfg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Fill a configuration struct with sane defaults. </p>
<p>Defaults:</p><ul>
<li>temperature = 1.0</li>
<li>top_p = 1.0 (disabled)</li>
<li>top_k = 0 (disabled)</li>
<li>allow_nan_logits = 0</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">cfg</td><td>Configuration to initialize. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="ie__sampler_8c_source.html#l00344">344</a> of file <a class="el" href="ie__sampler_8c_source.html">ie_sampler.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  344</span>                                                   {</div>
<div class="line"><span class="lineno">  345</span>  <span class="keywordflow">if</span> (!cfg) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  346</span>  cfg-&gt;<a class="code hl_variable" href="structie__sampler__cfg.html#ab8d30f20fd4954f558f161021f5893ec">temperature</a> = 1.0f;</div>
<div class="line"><span class="lineno">  347</span>  cfg-&gt;<a class="code hl_variable" href="structie__sampler__cfg.html#a415eb8cea1e2fa72e0beeb2ec45d85f3">top_p</a> = 1.0f;</div>
<div class="line"><span class="lineno">  348</span>  cfg-&gt;<a class="code hl_variable" href="structie__sampler__cfg.html#a8aa0087a9f086521d0c92dfe0083610c">top_k</a> = 0;</div>
<div class="line"><span class="lineno">  349</span>  cfg-&gt;<a class="code hl_variable" href="structie__sampler__cfg.html#aad6934a6b6ad25a5bdff683d7808b5f5">allow_nan_logits</a> = 0;</div>
<div class="line"><span class="lineno">  350</span>}</div>
<div class="ttc" id="astructie__sampler__cfg_html_a415eb8cea1e2fa72e0beeb2ec45d85f3"><div class="ttname"><a href="structie__sampler__cfg.html#a415eb8cea1e2fa72e0beeb2ec45d85f3">ie_sampler_cfg::top_p</a></div><div class="ttdeci">float top_p</div><div class="ttdoc">Nucleus sampling probability threshold (0,1].</div><div class="ttdef"><b>Definition</b> <a href="ie__sampler_8h_source.html#l00074">ie_sampler.h:74</a></div></div>
<div class="ttc" id="astructie__sampler__cfg_html_a8aa0087a9f086521d0c92dfe0083610c"><div class="ttname"><a href="structie__sampler__cfg.html#a8aa0087a9f086521d0c92dfe0083610c">ie_sampler_cfg::top_k</a></div><div class="ttdeci">uint32_t top_k</div><div class="ttdoc">Top-k sampling cutoff.</div><div class="ttdef"><b>Definition</b> <a href="ie__sampler_8h_source.html#l00076">ie_sampler.h:76</a></div></div>
<div class="ttc" id="astructie__sampler__cfg_html_aad6934a6b6ad25a5bdff683d7808b5f5"><div class="ttname"><a href="structie__sampler__cfg.html#aad6934a6b6ad25a5bdff683d7808b5f5">ie_sampler_cfg::allow_nan_logits</a></div><div class="ttdeci">int allow_nan_logits</div><div class="ttdoc">If nonzero, treat NaN logits as -inf and continue; if zero, return error.</div><div class="ttdef"><b>Definition</b> <a href="ie__sampler_8h_source.html#l00078">ie_sampler.h:78</a></div></div>
<div class="ttc" id="astructie__sampler__cfg_html_ab8d30f20fd4954f558f161021f5893ec"><div class="ttname"><a href="structie__sampler__cfg.html#ab8d30f20fd4954f558f161021f5893ec">ie_sampler_cfg::temperature</a></div><div class="ttdeci">float temperature</div><div class="ttdoc">Temperature scaling.</div><div class="ttdef"><b>Definition</b> <a href="ie__sampler_8h_source.html#l00072">ie_sampler.h:72</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ie__sampler_8h_source.html#l00078">ie_sampler_cfg::allow_nan_logits</a>, <a class="el" href="ie__sampler_8h_source.html#l00072">ie_sampler_cfg::temperature</a>, <a class="el" href="ie__sampler_8h_source.html#l00076">ie_sampler_cfg::top_k</a>, and <a class="el" href="ie__sampler_8h_source.html#l00074">ie_sampler_cfg::top_p</a>.</p>

<p class="reference">Referenced by <a class="el" href="ie__sampler_8c_source.html#l00352">ie_sampler_create()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="ie__sampler_8c_ae65ee73ae9813d46ce65e3b5e98d5f4c_icgraph.svg" width="376" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a199d467fcf3d0dc4622c97356b0c6567" name="a199d467fcf3d0dc4622c97356b0c6567"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a199d467fcf3d0dc4622c97356b0c6567">&#9670;&#160;</a></span>ie_sampler_create()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ie__sampler_8h.html#a4f1437d0ac100e556fa81874d894e138">ie_sampler_status_t</a> ie_sampler_create </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ie__sampler_8h.html#a061b934445c6c6e955d48d6e36d9231a">ie_sampler_t</a> **&#160;</td>
          <td class="paramname"><em>out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>vocab_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ie__sampler_8h.html#a1facc6ea7b61846ca4090794c6930b8b">ie_sampler_cfg_t</a> *&#160;</td>
          <td class="paramname"><em>cfg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>seed</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a sampler for a fixed vocabulary size. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">out</td><td>Receives newly allocated sampler on success. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">vocab_size</td><td>Vocabulary size (logits length). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cfg</td><td>Sampling configuration (may be NULL for defaults). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">seed</td><td>Initial RNG seed (deterministic). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>IE_SAMPLER_OK on success, negative on error. </dd></dl>

<p class="definition">Definition at line <a class="el" href="ie__sampler_8c_source.html#l00352">352</a> of file <a class="el" href="ie__sampler_8c_source.html">ie_sampler.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  355</span>                                                     {</div>
<div class="line"><span class="lineno">  356</span>  <span class="keywordflow">if</span> (!out || vocab_size == 0) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__sampler_8h.html#a8aaf8521f0528789db5a998a5bb76324a4ce6136876ea7d720f49c11b93fad6c6">IE_SAMPLER_EINVAL</a>;</div>
<div class="line"><span class="lineno">  357</span>  *<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a> = NULL;</div>
<div class="line"><span class="lineno">  358</span> </div>
<div class="line"><span class="lineno">  359</span>  <a class="code hl_struct" href="structie__sampler.html">ie_sampler_t</a> *s = (<a class="code hl_struct" href="structie__sampler.html">ie_sampler_t</a> *)calloc(1, <span class="keyword">sizeof</span>(*s));</div>
<div class="line"><span class="lineno">  360</span>  <span class="keywordflow">if</span> (!s) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__sampler_8h.html#a8aaf8521f0528789db5a998a5bb76324aec6f53192ea282aa48be9f44fa0c8e83">IE_SAMPLER_ENOMEM</a>;</div>
<div class="line"><span class="lineno">  361</span> </div>
<div class="line"><span class="lineno">  362</span>  s-&gt;<a class="code hl_variable" href="structie__sampler.html#a19a07c6a959ec067ed82af8f9fbb4d8c">vocab_size</a> = vocab_size;</div>
<div class="line"><span class="lineno">  363</span>  <a class="code hl_function" href="ie__sampler_8c.html#ae65ee73ae9813d46ce65e3b5e98d5f4c">ie_sampler_cfg_default</a>(&amp;s-&gt;<a class="code hl_variable" href="structie__sampler.html#a34e2e54b6c55daa94df18d2a4a066f08">cfg</a>);</div>
<div class="line"><span class="lineno">  364</span>  <span class="keywordflow">if</span> (cfg) s-&gt;<a class="code hl_variable" href="structie__sampler.html#a34e2e54b6c55daa94df18d2a4a066f08">cfg</a> = *cfg;</div>
<div class="line"><span class="lineno">  365</span> </div>
<div class="line"><span class="lineno">  366</span>  s-&gt;<a class="code hl_variable" href="structie__sampler.html#aa5b9670e4b377f91066dbc8323b90c4e">rng</a> = seed ? seed : 0x9e3779b97f4a7c15ULL;</div>
<div class="line"><span class="lineno">  367</span> </div>
<div class="line"><span class="lineno">  368</span>  s-&gt;<a class="code hl_variable" href="structie__sampler.html#aeaffb8812eb235c1315a3e60ca0fdb62">probs</a> = (<span class="keywordtype">float</span> *)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">float</span>) * vocab_size);</div>
<div class="line"><span class="lineno">  369</span>  s-&gt;<a class="code hl_variable" href="structie__sampler.html#a61f6c74ae9916cd4d064c658987cacd4">items</a> = (<a class="code hl_struct" href="structie__prob__item.html">ie_prob_item_t</a> *)malloc(<span class="keyword">sizeof</span>(<a class="code hl_struct" href="structie__prob__item.html">ie_prob_item_t</a>) * vocab_size);</div>
<div class="line"><span class="lineno">  370</span>  <span class="keywordflow">if</span> (!s-&gt;<a class="code hl_variable" href="structie__sampler.html#aeaffb8812eb235c1315a3e60ca0fdb62">probs</a> || !s-&gt;<a class="code hl_variable" href="structie__sampler.html#a61f6c74ae9916cd4d064c658987cacd4">items</a>) {</div>
<div class="line"><span class="lineno">  371</span>    free(s-&gt;<a class="code hl_variable" href="structie__sampler.html#aeaffb8812eb235c1315a3e60ca0fdb62">probs</a>);</div>
<div class="line"><span class="lineno">  372</span>    free(s-&gt;<a class="code hl_variable" href="structie__sampler.html#a61f6c74ae9916cd4d064c658987cacd4">items</a>);</div>
<div class="line"><span class="lineno">  373</span>    free(s);</div>
<div class="line"><span class="lineno">  374</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__sampler_8h.html#a8aaf8521f0528789db5a998a5bb76324aec6f53192ea282aa48be9f44fa0c8e83">IE_SAMPLER_ENOMEM</a>;</div>
<div class="line"><span class="lineno">  375</span>  }</div>
<div class="line"><span class="lineno">  376</span> </div>
<div class="line"><span class="lineno">  377</span>  *<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a> = s;</div>
<div class="line"><span class="lineno">  378</span>  <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__sampler_8h.html#a8aaf8521f0528789db5a998a5bb76324a5659a660ca8e7753c25db5c055db2286">IE_SAMPLER_OK</a>;</div>
<div class="line"><span class="lineno">  379</span>}</div>
<div class="ttc" id="aie__sampler_8c_html_ae65ee73ae9813d46ce65e3b5e98d5f4c"><div class="ttname"><a href="ie__sampler_8c.html#ae65ee73ae9813d46ce65e3b5e98d5f4c">ie_sampler_cfg_default</a></div><div class="ttdeci">void ie_sampler_cfg_default(ie_sampler_cfg_t *cfg)</div><div class="ttdoc">Fill a configuration struct with sane defaults.</div><div class="ttdef"><b>Definition</b> <a href="ie__sampler_8c_source.html#l00344">ie_sampler.c:344</a></div></div>
<div class="ttc" id="aie__sampler_8h_html_a8aaf8521f0528789db5a998a5bb76324a4ce6136876ea7d720f49c11b93fad6c6"><div class="ttname"><a href="ie__sampler_8h.html#a8aaf8521f0528789db5a998a5bb76324a4ce6136876ea7d720f49c11b93fad6c6">IE_SAMPLER_EINVAL</a></div><div class="ttdeci">@ IE_SAMPLER_EINVAL</div><div class="ttdoc">Invalid argument.</div><div class="ttdef"><b>Definition</b> <a href="ie__sampler_8h_source.html#l00048">ie_sampler.h:48</a></div></div>
<div class="ttc" id="aie__sampler_8h_html_a8aaf8521f0528789db5a998a5bb76324a5659a660ca8e7753c25db5c055db2286"><div class="ttname"><a href="ie__sampler_8h.html#a8aaf8521f0528789db5a998a5bb76324a5659a660ca8e7753c25db5c055db2286">IE_SAMPLER_OK</a></div><div class="ttdeci">@ IE_SAMPLER_OK</div><div class="ttdoc">Success.</div><div class="ttdef"><b>Definition</b> <a href="ie__sampler_8h_source.html#l00046">ie_sampler.h:46</a></div></div>
<div class="ttc" id="aie__sampler_8h_html_a8aaf8521f0528789db5a998a5bb76324aec6f53192ea282aa48be9f44fa0c8e83"><div class="ttname"><a href="ie__sampler_8h.html#a8aaf8521f0528789db5a998a5bb76324aec6f53192ea282aa48be9f44fa0c8e83">IE_SAMPLER_ENOMEM</a></div><div class="ttdeci">@ IE_SAMPLER_ENOMEM</div><div class="ttdoc">Allocation failure.</div><div class="ttdef"><b>Definition</b> <a href="ie__sampler_8h_source.html#l00050">ie_sampler.h:50</a></div></div>
<div class="ttc" id="anamespaceconvert__dtypes__to__numeric_html_a0332296ea5bde95f8e72005df06144a8"><div class="ttname"><a href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">convert_dtypes_to_numeric.out</a></div><div class="ttdeci">dict out</div><div class="ttdef"><b>Definition</b> <a href="convert__dtypes__to__numeric_8py_source.html#l00029">convert_dtypes_to_numeric.py:29</a></div></div>
<div class="ttc" id="astructie__prob__item_html"><div class="ttname"><a href="structie__prob__item.html">ie_prob_item</a></div><div class="ttdoc">Optional external decoder hook (weak).</div><div class="ttdef"><b>Definition</b> <a href="ie__sampler_8c_source.html#l00051">ie_sampler.c:51</a></div></div>
<div class="ttc" id="astructie__sampler_html"><div class="ttname"><a href="structie__sampler.html">ie_sampler</a></div><div class="ttdef"><b>Definition</b> <a href="ie__sampler_8c_source.html#l00056">ie_sampler.c:56</a></div></div>
<div class="ttc" id="astructie__sampler_html_a19a07c6a959ec067ed82af8f9fbb4d8c"><div class="ttname"><a href="structie__sampler.html#a19a07c6a959ec067ed82af8f9fbb4d8c">ie_sampler::vocab_size</a></div><div class="ttdeci">size_t vocab_size</div><div class="ttdef"><b>Definition</b> <a href="ie__sampler_8c_source.html#l00057">ie_sampler.c:57</a></div></div>
<div class="ttc" id="astructie__sampler_html_a34e2e54b6c55daa94df18d2a4a066f08"><div class="ttname"><a href="structie__sampler.html#a34e2e54b6c55daa94df18d2a4a066f08">ie_sampler::cfg</a></div><div class="ttdeci">ie_sampler_cfg_t cfg</div><div class="ttdef"><b>Definition</b> <a href="ie__sampler_8c_source.html#l00058">ie_sampler.c:58</a></div></div>
<div class="ttc" id="astructie__sampler_html_a61f6c74ae9916cd4d064c658987cacd4"><div class="ttname"><a href="structie__sampler.html#a61f6c74ae9916cd4d064c658987cacd4">ie_sampler::items</a></div><div class="ttdeci">ie_prob_item_t * items</div><div class="ttdef"><b>Definition</b> <a href="ie__sampler_8c_source.html#l00062">ie_sampler.c:62</a></div></div>
<div class="ttc" id="astructie__sampler_html_aa5b9670e4b377f91066dbc8323b90c4e"><div class="ttname"><a href="structie__sampler.html#aa5b9670e4b377f91066dbc8323b90c4e">ie_sampler::rng</a></div><div class="ttdeci">uint64_t rng</div><div class="ttdef"><b>Definition</b> <a href="ie__sampler_8c_source.html#l00059">ie_sampler.c:59</a></div></div>
<div class="ttc" id="astructie__sampler_html_aeaffb8812eb235c1315a3e60ca0fdb62"><div class="ttname"><a href="structie__sampler.html#aeaffb8812eb235c1315a3e60ca0fdb62">ie_sampler::probs</a></div><div class="ttdeci">float * probs</div><div class="ttdef"><b>Definition</b> <a href="ie__sampler_8c_source.html#l00061">ie_sampler.c:61</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ie__sampler_8c_source.html#l00058">ie_sampler::cfg</a>, <a class="el" href="ie__sampler_8c_source.html#l00344">ie_sampler_cfg_default()</a>, <a class="el" href="ie__sampler_8h_source.html#l00048">IE_SAMPLER_EINVAL</a>, <a class="el" href="ie__sampler_8h_source.html#l00050">IE_SAMPLER_ENOMEM</a>, <a class="el" href="ie__sampler_8h_source.html#l00046">IE_SAMPLER_OK</a>, <a class="el" href="ie__sampler_8c_source.html#l00062">ie_sampler::items</a>, <a class="el" href="ie__sampler_8c_source.html#l00061">ie_sampler::probs</a>, <a class="el" href="ie__sampler_8c_source.html#l00059">ie_sampler::rng</a>, and <a class="el" href="ie__sampler_8c_source.html#l00057">ie_sampler::vocab_size</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="ie__sampler_8c_a199d467fcf3d0dc4622c97356b0c6567_cgraph.svg" width="376" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a1a8638695582f8d4991da4f47781df70" name="a1a8638695582f8d4991da4f47781df70"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1a8638695582f8d4991da4f47781df70">&#9670;&#160;</a></span>ie_sampler_destroy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ie_sampler_destroy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ie__sampler_8h.html#a061b934445c6c6e955d48d6e36d9231a">ie_sampler_t</a> **&#160;</td>
          <td class="paramname"><em>ps</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Destroy a sampler and release all resources. </p>
<p>Safe to call with NULL or *ps == NULL.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ps</td><td>Address of sampler handle; set to NULL on return. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="ie__sampler_8c_source.html#l00381">381</a> of file <a class="el" href="ie__sampler_8c_source.html">ie_sampler.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  381</span>                                           {</div>
<div class="line"><span class="lineno">  382</span>  <span class="keywordflow">if</span> (!ps || !*ps) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  383</span>  <a class="code hl_struct" href="structie__sampler.html">ie_sampler_t</a> *s = *ps;</div>
<div class="line"><span class="lineno">  384</span> </div>
<div class="line"><span class="lineno">  385</span>  free(s-&gt;<a class="code hl_variable" href="structie__sampler.html#aeaffb8812eb235c1315a3e60ca0fdb62">probs</a>);</div>
<div class="line"><span class="lineno">  386</span>  free(s-&gt;<a class="code hl_variable" href="structie__sampler.html#a61f6c74ae9916cd4d064c658987cacd4">items</a>);</div>
<div class="line"><span class="lineno">  387</span>  free(s);</div>
<div class="line"><span class="lineno">  388</span> </div>
<div class="line"><span class="lineno">  389</span>  *ps = NULL;</div>
<div class="line"><span class="lineno">  390</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ie__sampler_8c_source.html#l00062">ie_sampler::items</a>, and <a class="el" href="ie__sampler_8c_source.html#l00061">ie_sampler::probs</a>.</p>

</div>
</div>
<a id="a60cc4d87efcfb6b8aadd27e3f56e789d" name="a60cc4d87efcfb6b8aadd27e3f56e789d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a60cc4d87efcfb6b8aadd27e3f56e789d">&#9670;&#160;</a></span>ie_sampler_sample()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ie__sampler_8h.html#a4f1437d0ac100e556fa81874d894e138">ie_sampler_status_t</a> ie_sampler_sample </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ie__sampler_8h.html#a061b934445c6c6e955d48d6e36d9231a">ie_sampler_t</a> *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const float *&#160;</td>
          <td class="paramname"><em>logits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>logits_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>out_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>out_prob</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sample a token id from logits. </p>
<p>If sampling degenerates to greedy (temperature &lt;= 0, or all mass collapses), this returns argmax.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">s</td><td>Sampler handle. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">logits</td><td>Pointer to logits array (length = logits_len). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">logits_len</td><td>Length of logits array (should equal vocab_size). </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">out_id</td><td>Receives sampled token id. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">out_prob</td><td>Optional. Receives probability of selected token under the filtered distribution. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>IE_SAMPLER_OK on success, negative on error. </dd></dl>

<p class="definition">Definition at line <a class="el" href="ie__sampler_8c_source.html#l00404">404</a> of file <a class="el" href="ie__sampler_8c_source.html">ie_sampler.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  408</span>                                                       {</div>
<div class="line"><span class="lineno">  409</span>  <span class="keywordflow">if</span> (!s || !logits || !out_id) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__sampler_8h.html#a8aaf8521f0528789db5a998a5bb76324a4ce6136876ea7d720f49c11b93fad6c6">IE_SAMPLER_EINVAL</a>;</div>
<div class="line"><span class="lineno">  410</span>  <span class="keywordflow">if</span> (logits_len != s-&gt;<a class="code hl_variable" href="structie__sampler.html#a19a07c6a959ec067ed82af8f9fbb4d8c">vocab_size</a>) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__sampler_8h.html#a8aaf8521f0528789db5a998a5bb76324a4ce6136876ea7d720f49c11b93fad6c6">IE_SAMPLER_EINVAL</a>;</div>
<div class="line"><span class="lineno">  411</span> </div>
<div class="line"><span class="lineno">  412</span>  <span class="keyword">static</span> uint64_t g_call_idx = 0;</div>
<div class="line"><span class="lineno">  413</span>  g_call_idx++;</div>
<div class="line"><span class="lineno">  414</span> </div>
<div class="line"><span class="lineno">  415</span>  <span class="keyword">const</span> <span class="keywordtype">float</span> temperature = s-&gt;<a class="code hl_variable" href="structie__sampler.html#a34e2e54b6c55daa94df18d2a4a066f08">cfg</a>.<a class="code hl_variable" href="structie__sampler__cfg.html#ab8d30f20fd4954f558f161021f5893ec">temperature</a>;</div>
<div class="line"><span class="lineno">  416</span>  <span class="keyword">const</span> uint32_t top_k = s-&gt;<a class="code hl_variable" href="structie__sampler.html#a34e2e54b6c55daa94df18d2a4a066f08">cfg</a>.<a class="code hl_variable" href="structie__sampler__cfg.html#a8aa0087a9f086521d0c92dfe0083610c">top_k</a>;</div>
<div class="line"><span class="lineno">  417</span>  <span class="keyword">const</span> <span class="keywordtype">float</span> top_p = s-&gt;<a class="code hl_variable" href="structie__sampler.html#a34e2e54b6c55daa94df18d2a4a066f08">cfg</a>.<a class="code hl_variable" href="structie__sampler__cfg.html#a415eb8cea1e2fa72e0beeb2ec45d85f3">top_p</a>;</div>
<div class="line"><span class="lineno">  418</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> allow_nan = s-&gt;<a class="code hl_variable" href="structie__sampler.html#a34e2e54b6c55daa94df18d2a4a066f08">cfg</a>.<a class="code hl_variable" href="structie__sampler__cfg.html#aad6934a6b6ad25a5bdff683d7808b5f5">allow_nan_logits</a>;</div>
<div class="line"><span class="lineno">  419</span> </div>
<div class="line"><span class="lineno">  420</span>  <span class="keywordflow">if</span> (!(temperature &gt; 0.0f)) {</div>
<div class="line"><span class="lineno">  421</span>    uint32_t <span class="keywordtype">id</span> = 0;</div>
<div class="line"><span class="lineno">  422</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="ie__sampler_8c.html#a09ebf6bf5245c55a63cb996796da3cf3">argmax_logits</a>(logits, logits_len, allow_nan, &amp;<span class="keywordtype">id</span>)) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__sampler_8h.html#a8aaf8521f0528789db5a998a5bb76324a4ce6136876ea7d720f49c11b93fad6c6">IE_SAMPLER_EINVAL</a>;</div>
<div class="line"><span class="lineno">  423</span>    *out_id = id;</div>
<div class="line"><span class="lineno">  424</span>    <span class="keywordflow">if</span> (out_prob) *out_prob = 1.0f;</div>
<div class="line"><span class="lineno">  425</span> </div>
<div class="line"><span class="lineno">  426</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="ie__sampler_8c.html#ae396ca396816809dfb9184ea32455662">debug_topk_should_dump_</a>(g_call_idx)) {</div>
<div class="line"><span class="lineno">  427</span>      <span class="keyword">const</span> <span class="keywordtype">int</span> k = <a class="code hl_function" href="ie__sampler_8c.html#a47cd2ba168244ca8b0c646059e180642">debug_topk_k_</a>();</div>
<div class="line"><span class="lineno">  428</span>      <a class="code hl_function" href="ie__sampler_8c.html#a80512fa27903ef264dba3ae7443bcc0b">debug_dump_topk_logits_</a>(logits, NULL, logits_len, temperature, allow_nan, k, g_call_idx);</div>
<div class="line"><span class="lineno">  429</span>      fprintf(stderr, <span class="stringliteral">&quot;[sampler][chosen] call=%&quot;</span> PRIu64 <span class="stringliteral">&quot; id=%&quot;</span> PRIu32 <span class="stringliteral">&quot; prob=1\n&quot;</span>,</div>
<div class="line"><span class="lineno">  430</span>              (uint64_t)g_call_idx, <span class="keywordtype">id</span>);</div>
<div class="line"><span class="lineno">  431</span>    }</div>
<div class="line"><span class="lineno">  432</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__sampler_8h.html#a8aaf8521f0528789db5a998a5bb76324a5659a660ca8e7753c25db5c055db2286">IE_SAMPLER_OK</a>;</div>
<div class="line"><span class="lineno">  433</span>  }</div>
<div class="line"><span class="lineno">  434</span> </div>
<div class="line"><span class="lineno">  435</span>  <span class="keywordflow">if</span> (!<a class="code hl_function" href="ie__sampler_8c.html#af5f864c248d511ca9d737ae30b857430">softmax_probs</a>(logits, logits_len, temperature, allow_nan, s-&gt;<a class="code hl_variable" href="structie__sampler.html#aeaffb8812eb235c1315a3e60ca0fdb62">probs</a>)) {</div>
<div class="line"><span class="lineno">  436</span>    uint32_t <span class="keywordtype">id</span> = 0;</div>
<div class="line"><span class="lineno">  437</span>    <span class="keywordflow">if</span> (!<a class="code hl_function" href="ie__sampler_8c.html#a09ebf6bf5245c55a63cb996796da3cf3">argmax_logits</a>(logits, logits_len, allow_nan, &amp;<span class="keywordtype">id</span>)) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__sampler_8h.html#a8aaf8521f0528789db5a998a5bb76324a4ce6136876ea7d720f49c11b93fad6c6">IE_SAMPLER_EINVAL</a>;</div>
<div class="line"><span class="lineno">  438</span>    *out_id = id;</div>
<div class="line"><span class="lineno">  439</span>    <span class="keywordflow">if</span> (out_prob) *out_prob = 1.0f;</div>
<div class="line"><span class="lineno">  440</span> </div>
<div class="line"><span class="lineno">  441</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="ie__sampler_8c.html#ae396ca396816809dfb9184ea32455662">debug_topk_should_dump_</a>(g_call_idx)) {</div>
<div class="line"><span class="lineno">  442</span>      <span class="keyword">const</span> <span class="keywordtype">int</span> k = <a class="code hl_function" href="ie__sampler_8c.html#a47cd2ba168244ca8b0c646059e180642">debug_topk_k_</a>();</div>
<div class="line"><span class="lineno">  443</span>      <a class="code hl_function" href="ie__sampler_8c.html#a80512fa27903ef264dba3ae7443bcc0b">debug_dump_topk_logits_</a>(logits, NULL, logits_len, temperature, allow_nan, k, g_call_idx);</div>
<div class="line"><span class="lineno">  444</span>      fprintf(stderr, <span class="stringliteral">&quot;[sampler][chosen] call=%&quot;</span> PRIu64 <span class="stringliteral">&quot; id=%&quot;</span> PRIu32 <span class="stringliteral">&quot; prob=1 (softmax_failed)\n&quot;</span>,</div>
<div class="line"><span class="lineno">  445</span>              (uint64_t)g_call_idx, <span class="keywordtype">id</span>);</div>
<div class="line"><span class="lineno">  446</span>    }</div>
<div class="line"><span class="lineno">  447</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__sampler_8h.html#a8aaf8521f0528789db5a998a5bb76324a5659a660ca8e7753c25db5c055db2286">IE_SAMPLER_OK</a>;</div>
<div class="line"><span class="lineno">  448</span>  }</div>
<div class="line"><span class="lineno">  449</span> </div>
<div class="line"><span class="lineno">  450</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="ie__sampler_8c.html#ae396ca396816809dfb9184ea32455662">debug_topk_should_dump_</a>(g_call_idx)) {</div>
<div class="line"><span class="lineno">  451</span>    <span class="keyword">const</span> <span class="keywordtype">int</span> k = <a class="code hl_function" href="ie__sampler_8c.html#a47cd2ba168244ca8b0c646059e180642">debug_topk_k_</a>();</div>
<div class="line"><span class="lineno">  452</span>    <a class="code hl_function" href="ie__sampler_8c.html#a80512fa27903ef264dba3ae7443bcc0b">debug_dump_topk_logits_</a>(logits, s-&gt;<a class="code hl_variable" href="structie__sampler.html#aeaffb8812eb235c1315a3e60ca0fdb62">probs</a>, logits_len, temperature, allow_nan, k, g_call_idx);</div>
<div class="line"><span class="lineno">  453</span>  }</div>
<div class="line"><span class="lineno">  454</span> </div>
<div class="line"><span class="lineno">  455</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; logits_len; ++i) {</div>
<div class="line"><span class="lineno">  456</span>    s-&gt;<a class="code hl_variable" href="structie__sampler.html#a61f6c74ae9916cd4d064c658987cacd4">items</a>[i].<a class="code hl_variable" href="structie__prob__item.html#a0cda146346269c60459f2513ae05a888">id</a> = (uint32_t)i;</div>
<div class="line"><span class="lineno">  457</span>    s-&gt;<a class="code hl_variable" href="structie__sampler.html#a61f6c74ae9916cd4d064c658987cacd4">items</a>[i].<a class="code hl_variable" href="structie__prob__item.html#aaeb0be155a0feb423234a1b2e81d8065">p</a> = s-&gt;<a class="code hl_variable" href="structie__sampler.html#aeaffb8812eb235c1315a3e60ca0fdb62">probs</a>[i];</div>
<div class="line"><span class="lineno">  458</span>  }</div>
<div class="line"><span class="lineno">  459</span> </div>
<div class="line"><span class="lineno">  460</span>  qsort(s-&gt;<a class="code hl_variable" href="structie__sampler.html#a61f6c74ae9916cd4d064c658987cacd4">items</a>, logits_len, <span class="keyword">sizeof</span>(s-&gt;<a class="code hl_variable" href="structie__sampler.html#a61f6c74ae9916cd4d064c658987cacd4">items</a>[0]), <a class="code hl_function" href="ie__sampler_8c.html#a0f49437bd493fd9354f0a7a355722043">prob_item_cmp_desc</a>);</div>
<div class="line"><span class="lineno">  461</span> </div>
<div class="line"><span class="lineno">  462</span>  <span class="keywordtype">size_t</span> kept = logits_len;</div>
<div class="line"><span class="lineno">  463</span> </div>
<div class="line"><span class="lineno">  464</span>  <span class="keywordflow">if</span> (top_k != 0 &amp;&amp; top_k &lt; kept) kept = (size_t)top_k;</div>
<div class="line"><span class="lineno">  465</span> </div>
<div class="line"><span class="lineno">  466</span>  <span class="keywordflow">if</span> (top_p &lt; 1.0f) {</div>
<div class="line"><span class="lineno">  467</span>    <span class="keywordtype">float</span> cum = 0.0f;</div>
<div class="line"><span class="lineno">  468</span>    <span class="keywordtype">size_t</span> k = 0;</div>
<div class="line"><span class="lineno">  469</span>    <span class="keywordflow">while</span> (k &lt; kept) {</div>
<div class="line"><span class="lineno">  470</span>      cum += s-&gt;<a class="code hl_variable" href="structie__sampler.html#a61f6c74ae9916cd4d064c658987cacd4">items</a>[k].<a class="code hl_variable" href="structie__prob__item.html#aaeb0be155a0feb423234a1b2e81d8065">p</a>;</div>
<div class="line"><span class="lineno">  471</span>      ++k;</div>
<div class="line"><span class="lineno">  472</span>      <span class="keywordflow">if</span> (cum &gt;= top_p) <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  473</span>    }</div>
<div class="line"><span class="lineno">  474</span>    <span class="keywordflow">if</span> (k == 0) k = 1;</div>
<div class="line"><span class="lineno">  475</span>    kept = k;</div>
<div class="line"><span class="lineno">  476</span>  }</div>
<div class="line"><span class="lineno">  477</span> </div>
<div class="line"><span class="lineno">  478</span>  <span class="keywordtype">float</span> sum = 0.0f;</div>
<div class="line"><span class="lineno">  479</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; kept; ++i) sum += s-&gt;<a class="code hl_variable" href="structie__sampler.html#a61f6c74ae9916cd4d064c658987cacd4">items</a>[i].<a class="code hl_variable" href="structie__prob__item.html#aaeb0be155a0feb423234a1b2e81d8065">p</a>;</div>
<div class="line"><span class="lineno">  480</span> </div>
<div class="line"><span class="lineno">  481</span>  <span class="keywordflow">if</span> (!(sum &gt; 0.0f) || isnan(sum) || isinf(sum)) {</div>
<div class="line"><span class="lineno">  482</span>    uint32_t <span class="keywordtype">id</span> = s-&gt;<a class="code hl_variable" href="structie__sampler.html#a61f6c74ae9916cd4d064c658987cacd4">items</a>[0].<a class="code hl_variable" href="structie__prob__item.html#a0cda146346269c60459f2513ae05a888">id</a>;</div>
<div class="line"><span class="lineno">  483</span>    *out_id = id;</div>
<div class="line"><span class="lineno">  484</span>    <span class="keywordflow">if</span> (out_prob) *out_prob = 1.0f;</div>
<div class="line"><span class="lineno">  485</span> </div>
<div class="line"><span class="lineno">  486</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="ie__sampler_8c.html#ae396ca396816809dfb9184ea32455662">debug_topk_should_dump_</a>(g_call_idx)) {</div>
<div class="line"><span class="lineno">  487</span>      fprintf(stderr, <span class="stringliteral">&quot;[sampler][chosen] call=%&quot;</span> PRIu64 <span class="stringliteral">&quot; id=%&quot;</span> PRIu32 <span class="stringliteral">&quot; prob=1 (degenerate_sum)\n&quot;</span>,</div>
<div class="line"><span class="lineno">  488</span>              (uint64_t)g_call_idx, <span class="keywordtype">id</span>);</div>
<div class="line"><span class="lineno">  489</span>    }</div>
<div class="line"><span class="lineno">  490</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__sampler_8h.html#a8aaf8521f0528789db5a998a5bb76324a5659a660ca8e7753c25db5c055db2286">IE_SAMPLER_OK</a>;</div>
<div class="line"><span class="lineno">  491</span>  }</div>
<div class="line"><span class="lineno">  492</span> </div>
<div class="line"><span class="lineno">  493</span>  <span class="keywordtype">float</span> r = <a class="code hl_function" href="ie__sampler_8c.html#aa74353c6e8d0bfd4561ddd0adc8c5190">rng_next_f01</a>(&amp;s-&gt;<a class="code hl_variable" href="structie__sampler.html#aa5b9670e4b377f91066dbc8323b90c4e">rng</a>);</div>
<div class="line"><span class="lineno">  494</span>  <span class="keywordtype">float</span> acc = 0.0f;</div>
<div class="line"><span class="lineno">  495</span>  uint32_t chosen = s-&gt;<a class="code hl_variable" href="structie__sampler.html#a61f6c74ae9916cd4d064c658987cacd4">items</a>[kept - 1].<a class="code hl_variable" href="structie__prob__item.html#a0cda146346269c60459f2513ae05a888">id</a>;</div>
<div class="line"><span class="lineno">  496</span>  <span class="keywordtype">float</span> chosen_p = s-&gt;<a class="code hl_variable" href="structie__sampler.html#a61f6c74ae9916cd4d064c658987cacd4">items</a>[kept - 1].<a class="code hl_variable" href="structie__prob__item.html#aaeb0be155a0feb423234a1b2e81d8065">p</a> / sum;</div>
<div class="line"><span class="lineno">  497</span> </div>
<div class="line"><span class="lineno">  498</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; kept; ++i) {</div>
<div class="line"><span class="lineno">  499</span>    <span class="keywordtype">float</span> p = s-&gt;<a class="code hl_variable" href="structie__sampler.html#a61f6c74ae9916cd4d064c658987cacd4">items</a>[i].<a class="code hl_variable" href="structie__prob__item.html#aaeb0be155a0feb423234a1b2e81d8065">p</a> / sum;</div>
<div class="line"><span class="lineno">  500</span>    acc += p;</div>
<div class="line"><span class="lineno">  501</span>    <span class="keywordflow">if</span> (r &lt; acc) {</div>
<div class="line"><span class="lineno">  502</span>      chosen = s-&gt;<a class="code hl_variable" href="structie__sampler.html#a61f6c74ae9916cd4d064c658987cacd4">items</a>[i].<a class="code hl_variable" href="structie__prob__item.html#a0cda146346269c60459f2513ae05a888">id</a>;</div>
<div class="line"><span class="lineno">  503</span>      chosen_p = p;</div>
<div class="line"><span class="lineno">  504</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  505</span>    }</div>
<div class="line"><span class="lineno">  506</span>  }</div>
<div class="line"><span class="lineno">  507</span> </div>
<div class="line"><span class="lineno">  508</span>  *out_id = chosen;</div>
<div class="line"><span class="lineno">  509</span>  <span class="keywordflow">if</span> (out_prob) *out_prob = chosen_p;</div>
<div class="line"><span class="lineno">  510</span> </div>
<div class="line"><span class="lineno">  511</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="ie__sampler_8c.html#ae396ca396816809dfb9184ea32455662">debug_topk_should_dump_</a>(g_call_idx)) {</div>
<div class="line"><span class="lineno">  512</span>    <span class="keywordtype">char</span> piece[160];</div>
<div class="line"><span class="lineno">  513</span>    <a class="code hl_function" href="ie__sampler_8c.html#aba2243bcbf50400fcce307c470dee85e">decode_preview_</a>(chosen, piece, <span class="keyword">sizeof</span>(piece));</div>
<div class="line"><span class="lineno">  514</span>    fprintf(stderr,</div>
<div class="line"><span class="lineno">  515</span>            <span class="stringliteral">&quot;[sampler][chosen] call=%&quot;</span> PRIu64 <span class="stringliteral">&quot; id=%&quot;</span> PRIu32 <span class="stringliteral">&quot; prob=%.9g piece=\&quot;%s\&quot;\n&quot;</span>,</div>
<div class="line"><span class="lineno">  516</span>            (uint64_t)g_call_idx,</div>
<div class="line"><span class="lineno">  517</span>            chosen,</div>
<div class="line"><span class="lineno">  518</span>            (<span class="keywordtype">double</span>)chosen_p,</div>
<div class="line"><span class="lineno">  519</span>            piece);</div>
<div class="line"><span class="lineno">  520</span>  }</div>
<div class="line"><span class="lineno">  521</span> </div>
<div class="line"><span class="lineno">  522</span>  <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__sampler_8h.html#a8aaf8521f0528789db5a998a5bb76324a5659a660ca8e7753c25db5c055db2286">IE_SAMPLER_OK</a>;</div>
<div class="line"><span class="lineno">  523</span>}</div>
<div class="ttc" id="aie__sampler_8c_html_a09ebf6bf5245c55a63cb996796da3cf3"><div class="ttname"><a href="ie__sampler_8c.html#a09ebf6bf5245c55a63cb996796da3cf3">argmax_logits</a></div><div class="ttdeci">static int argmax_logits(const float *logits, size_t n, int allow_nan, uint32_t *out_id)</div><div class="ttdoc">Compute argmax of logits, treating NaN as -inf if allowed.</div><div class="ttdef"><b>Definition</b> <a href="ie__sampler_8c_source.html#l00267">ie_sampler.c:267</a></div></div>
<div class="ttc" id="aie__sampler_8c_html_a0f49437bd493fd9354f0a7a355722043"><div class="ttname"><a href="ie__sampler_8c.html#a0f49437bd493fd9354f0a7a355722043">prob_item_cmp_desc</a></div><div class="ttdeci">static int prob_item_cmp_desc(const void *a, const void *b)</div><div class="ttdoc">Comparator for descending probability sort.</div><div class="ttdef"><b>Definition</b> <a href="ie__sampler_8c_source.html#l00254">ie_sampler.c:254</a></div></div>
<div class="ttc" id="aie__sampler_8c_html_a80512fa27903ef264dba3ae7443bcc0b"><div class="ttname"><a href="ie__sampler_8c.html#a80512fa27903ef264dba3ae7443bcc0b">debug_dump_topk_logits_</a></div><div class="ttdeci">static void debug_dump_topk_logits_(const float *logits, const float *probs, size_t n, float temperature, int allow_nan, int k, uint64_t call_idx)</div><div class="ttdef"><b>Definition</b> <a href="ie__sampler_8c_source.html#l00156">ie_sampler.c:156</a></div></div>
<div class="ttc" id="aie__sampler_8c_html_aa74353c6e8d0bfd4561ddd0adc8c5190"><div class="ttname"><a href="ie__sampler_8c.html#aa74353c6e8d0bfd4561ddd0adc8c5190">rng_next_f01</a></div><div class="ttdeci">static float rng_next_f01(uint64_t *state)</div><div class="ttdoc">Convert RNG output to uniform float in [0,1).</div><div class="ttdef"><b>Definition</b> <a href="ie__sampler_8c_source.html#l00245">ie_sampler.c:245</a></div></div>
<div class="ttc" id="aie__sampler_8c_html_ae396ca396816809dfb9184ea32455662"><div class="ttname"><a href="ie__sampler_8c.html#ae396ca396816809dfb9184ea32455662">debug_topk_should_dump_</a></div><div class="ttdeci">static int debug_topk_should_dump_(uint64_t call_idx)</div><div class="ttdef"><b>Definition</b> <a href="ie__sampler_8c_source.html#l00119">ie_sampler.c:119</a></div></div>
<div class="ttc" id="aie__sampler_8c_html_af5f864c248d511ca9d737ae30b857430"><div class="ttname"><a href="ie__sampler_8c.html#af5f864c248d511ca9d737ae30b857430">softmax_probs</a></div><div class="ttdeci">static int softmax_probs(const float *logits, size_t n, float temperature, int allow_nan, float *probs)</div><div class="ttdoc">Compute softmax probabilities from logits with temperature scaling.</div><div class="ttdef"><b>Definition</b> <a href="ie__sampler_8c_source.html#l00299">ie_sampler.c:299</a></div></div>
<div class="ttc" id="astructie__prob__item_html_a0cda146346269c60459f2513ae05a888"><div class="ttname"><a href="structie__prob__item.html#a0cda146346269c60459f2513ae05a888">ie_prob_item::id</a></div><div class="ttdeci">uint32_t id</div><div class="ttdef"><b>Definition</b> <a href="ie__sampler_8c_source.html#l00052">ie_sampler.c:52</a></div></div>
<div class="ttc" id="astructie__prob__item_html_aaeb0be155a0feb423234a1b2e81d8065"><div class="ttname"><a href="structie__prob__item.html#aaeb0be155a0feb423234a1b2e81d8065">ie_prob_item::p</a></div><div class="ttdeci">float p</div><div class="ttdef"><b>Definition</b> <a href="ie__sampler_8c_source.html#l00053">ie_sampler.c:53</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ie__sampler_8h_source.html#l00078">ie_sampler_cfg::allow_nan_logits</a>, <a class="el" href="ie__sampler_8c_source.html#l00267">argmax_logits()</a>, <a class="el" href="ie__sampler_8c_source.html#l00058">ie_sampler::cfg</a>, <a class="el" href="ie__sampler_8c_source.html#l00156">debug_dump_topk_logits_()</a>, <a class="el" href="ie__sampler_8c_source.html#l00083">debug_topk_k_()</a>, <a class="el" href="ie__sampler_8c_source.html#l00119">debug_topk_should_dump_()</a>, <a class="el" href="ie__sampler_8c_source.html#l00135">decode_preview_()</a>, <a class="el" href="ie__sampler_8c_source.html#l00052">ie_prob_item::id</a>, <a class="el" href="ie__sampler_8h_source.html#l00048">IE_SAMPLER_EINVAL</a>, <a class="el" href="ie__sampler_8h_source.html#l00046">IE_SAMPLER_OK</a>, <a class="el" href="ie__sampler_8c_source.html#l00062">ie_sampler::items</a>, <a class="el" href="ie__sampler_8c_source.html#l00053">ie_prob_item::p</a>, <a class="el" href="ie__sampler_8c_source.html#l00254">prob_item_cmp_desc()</a>, <a class="el" href="ie__sampler_8c_source.html#l00061">ie_sampler::probs</a>, <a class="el" href="ie__sampler_8c_source.html#l00059">ie_sampler::rng</a>, <a class="el" href="ie__sampler_8c_source.html#l00245">rng_next_f01()</a>, <a class="el" href="ie__sampler_8c_source.html#l00299">softmax_probs()</a>, <a class="el" href="ie__sampler_8h_source.html#l00072">ie_sampler_cfg::temperature</a>, <a class="el" href="ie__sampler_8h_source.html#l00076">ie_sampler_cfg::top_k</a>, <a class="el" href="ie__sampler_8h_source.html#l00074">ie_sampler_cfg::top_p</a>, and <a class="el" href="ie__sampler_8c_source.html#l00057">ie_sampler::vocab_size</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="ie__sampler_8c_a60cc4d87efcfb6b8aadd27e3f56e789d_cgraph.svg" width="100%" height="589"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="aadb041c9c359bfdb9b412688a6717fa1" name="aadb041c9c359bfdb9b412688a6717fa1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aadb041c9c359bfdb9b412688a6717fa1">&#9670;&#160;</a></span>ie_sampler_set_cfg()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ie__sampler_8h.html#a4f1437d0ac100e556fa81874d894e138">ie_sampler_status_t</a> ie_sampler_set_cfg </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ie__sampler_8h.html#a061b934445c6c6e955d48d6e36d9231a">ie_sampler_t</a> *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ie__sampler_8h.html#a1facc6ea7b61846ca4090794c6930b8b">ie_sampler_cfg_t</a> *&#160;</td>
          <td class="paramname"><em>cfg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Update sampler configuration. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">s</td><td>Sampler handle. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cfg</td><td>New configuration (must be non-NULL). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>IE_SAMPLER_OK on success, negative on error. </dd></dl>

<p class="definition">Definition at line <a class="el" href="ie__sampler_8c_source.html#l00392">392</a> of file <a class="el" href="ie__sampler_8c_source.html">ie_sampler.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  392</span>                                                                                     {</div>
<div class="line"><span class="lineno">  393</span>  <span class="keywordflow">if</span> (!s || !cfg) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__sampler_8h.html#a8aaf8521f0528789db5a998a5bb76324a4ce6136876ea7d720f49c11b93fad6c6">IE_SAMPLER_EINVAL</a>;</div>
<div class="line"><span class="lineno">  394</span>  s-&gt;<a class="code hl_variable" href="structie__sampler.html#a34e2e54b6c55daa94df18d2a4a066f08">cfg</a> = *cfg;</div>
<div class="line"><span class="lineno">  395</span>  <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__sampler_8h.html#a8aaf8521f0528789db5a998a5bb76324a5659a660ca8e7753c25db5c055db2286">IE_SAMPLER_OK</a>;</div>
<div class="line"><span class="lineno">  396</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ie__sampler_8c_source.html#l00058">ie_sampler::cfg</a>, <a class="el" href="ie__sampler_8h_source.html#l00048">IE_SAMPLER_EINVAL</a>, and <a class="el" href="ie__sampler_8h_source.html#l00046">IE_SAMPLER_OK</a>.</p>

</div>
</div>
<a id="a1dcd20a140321046a809f7bd925d2f9e" name="a1dcd20a140321046a809f7bd925d2f9e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1dcd20a140321046a809f7bd925d2f9e">&#9670;&#160;</a></span>ie_sampler_set_seed()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="ie__sampler_8h.html#a4f1437d0ac100e556fa81874d894e138">ie_sampler_status_t</a> ie_sampler_set_seed </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ie__sampler_8h.html#a061b934445c6c6e955d48d6e36d9231a">ie_sampler_t</a> *&#160;</td>
          <td class="paramname"><em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>seed</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reset sampler RNG seed. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">s</td><td>Sampler handle. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">seed</td><td>New seed value. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>IE_SAMPLER_OK on success, negative on error. </dd></dl>

<p class="definition">Definition at line <a class="el" href="ie__sampler_8c_source.html#l00398">398</a> of file <a class="el" href="ie__sampler_8c_source.html">ie_sampler.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  398</span>                                                                        {</div>
<div class="line"><span class="lineno">  399</span>  <span class="keywordflow">if</span> (!s) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__sampler_8h.html#a8aaf8521f0528789db5a998a5bb76324a4ce6136876ea7d720f49c11b93fad6c6">IE_SAMPLER_EINVAL</a>;</div>
<div class="line"><span class="lineno">  400</span>  s-&gt;<a class="code hl_variable" href="structie__sampler.html#aa5b9670e4b377f91066dbc8323b90c4e">rng</a> = seed ? seed : 0x9e3779b97f4a7c15ULL;</div>
<div class="line"><span class="lineno">  401</span>  <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__sampler_8h.html#a8aaf8521f0528789db5a998a5bb76324a5659a660ca8e7753c25db5c055db2286">IE_SAMPLER_OK</a>;</div>
<div class="line"><span class="lineno">  402</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ie__sampler_8h_source.html#l00048">IE_SAMPLER_EINVAL</a>, <a class="el" href="ie__sampler_8h_source.html#l00046">IE_SAMPLER_OK</a>, and <a class="el" href="ie__sampler_8c_source.html#l00059">ie_sampler::rng</a>.</p>

</div>
</div>
<a id="a02c1c1c1c824cc114bccca38e4bf47d6" name="a02c1c1c1c824cc114bccca38e4bf47d6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a02c1c1c1c824cc114bccca38e4bf47d6">&#9670;&#160;</a></span>ie_sampler_status_str()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char * ie_sampler_status_str </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ie__sampler_8h.html#a4f1437d0ac100e556fa81874d894e138">ie_sampler_status_t</a>&#160;</td>
          <td class="paramname"><em>st</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Convert status to string. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">st</td><td>Status code. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Constant string describing the status. </dd></dl>

<p class="definition">Definition at line <a class="el" href="ie__sampler_8c_source.html#l00525">525</a> of file <a class="el" href="ie__sampler_8c_source.html">ie_sampler.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  525</span>                                                          {</div>
<div class="line"><span class="lineno">  526</span>  <span class="keywordflow">switch</span> (st) {</div>
<div class="line"><span class="lineno">  527</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="ie__sampler_8h.html#a8aaf8521f0528789db5a998a5bb76324a5659a660ca8e7753c25db5c055db2286">IE_SAMPLER_OK</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;IE_SAMPLER_OK&quot;</span>;</div>
<div class="line"><span class="lineno">  528</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="ie__sampler_8h.html#a8aaf8521f0528789db5a998a5bb76324a4ce6136876ea7d720f49c11b93fad6c6">IE_SAMPLER_EINVAL</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;IE_SAMPLER_EINVAL&quot;</span>;</div>
<div class="line"><span class="lineno">  529</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="ie__sampler_8h.html#a8aaf8521f0528789db5a998a5bb76324aec6f53192ea282aa48be9f44fa0c8e83">IE_SAMPLER_ENOMEM</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;IE_SAMPLER_ENOMEM&quot;</span>;</div>
<div class="line"><span class="lineno">  530</span>    <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="ie__sampler_8h.html#a8aaf8521f0528789db5a998a5bb76324afc10e916e97c41cca3a49f68ca67f8f4">IE_SAMPLER_EINTERNAL</a>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;IE_SAMPLER_EINTERNAL&quot;</span>;</div>
<div class="line"><span class="lineno">  531</span>    <span class="keywordflow">default</span>: <span class="keywordflow">return</span> <span class="stringliteral">&quot;IE_SAMPLER_UNKNOWN&quot;</span>;</div>
<div class="line"><span class="lineno">  532</span>  }</div>
<div class="line"><span class="lineno">  533</span>}</div>
<div class="ttc" id="aie__sampler_8h_html_a8aaf8521f0528789db5a998a5bb76324afc10e916e97c41cca3a49f68ca67f8f4"><div class="ttname"><a href="ie__sampler_8h.html#a8aaf8521f0528789db5a998a5bb76324afc10e916e97c41cca3a49f68ca67f8f4">IE_SAMPLER_EINTERNAL</a></div><div class="ttdeci">@ IE_SAMPLER_EINTERNAL</div><div class="ttdoc">Internal error (unexpected state).</div><div class="ttdef"><b>Definition</b> <a href="ie__sampler_8h_source.html#l00053">ie_sampler.h:52</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ie__sampler_8h_source.html#l00052">IE_SAMPLER_EINTERNAL</a>, <a class="el" href="ie__sampler_8h_source.html#l00048">IE_SAMPLER_EINVAL</a>, <a class="el" href="ie__sampler_8h_source.html#l00050">IE_SAMPLER_ENOMEM</a>, and <a class="el" href="ie__sampler_8h_source.html#l00046">IE_SAMPLER_OK</a>.</p>

</div>
</div>
<a id="a0f49437bd493fd9354f0a7a355722043" name="a0f49437bd493fd9354f0a7a355722043"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0f49437bd493fd9354f0a7a355722043">&#9670;&#160;</a></span>prob_item_cmp_desc()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int prob_item_cmp_desc </td>
          <td>(</td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Comparator for descending probability sort. </p>

<p class="definition">Definition at line <a class="el" href="ie__sampler_8c_source.html#l00254">254</a> of file <a class="el" href="ie__sampler_8c_source.html">ie_sampler.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  254</span>                                                            {</div>
<div class="line"><span class="lineno">  255</span>  <span class="keyword">const</span> <a class="code hl_struct" href="structie__prob__item.html">ie_prob_item_t</a> *x = (<span class="keyword">const</span> <a class="code hl_struct" href="structie__prob__item.html">ie_prob_item_t</a> *)a;</div>
<div class="line"><span class="lineno">  256</span>  <span class="keyword">const</span> <a class="code hl_struct" href="structie__prob__item.html">ie_prob_item_t</a> *y = (<span class="keyword">const</span> <a class="code hl_struct" href="structie__prob__item.html">ie_prob_item_t</a> *)b;</div>
<div class="line"><span class="lineno">  257</span>  <span class="keywordflow">if</span> (x-&gt;<a class="code hl_variable" href="structie__prob__item.html#aaeb0be155a0feb423234a1b2e81d8065">p</a> &gt; y-&gt;<a class="code hl_variable" href="structie__prob__item.html#aaeb0be155a0feb423234a1b2e81d8065">p</a>) <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  258</span>  <span class="keywordflow">if</span> (x-&gt;<a class="code hl_variable" href="structie__prob__item.html#aaeb0be155a0feb423234a1b2e81d8065">p</a> &lt; y-&gt;<a class="code hl_variable" href="structie__prob__item.html#aaeb0be155a0feb423234a1b2e81d8065">p</a>) <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  259</span>  <span class="keywordflow">if</span> (x-&gt;<a class="code hl_variable" href="structie__prob__item.html#a0cda146346269c60459f2513ae05a888">id</a> &lt; y-&gt;<a class="code hl_variable" href="structie__prob__item.html#a0cda146346269c60459f2513ae05a888">id</a>) <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  260</span>  <span class="keywordflow">if</span> (x-&gt;<a class="code hl_variable" href="structie__prob__item.html#a0cda146346269c60459f2513ae05a888">id</a> &gt; y-&gt;<a class="code hl_variable" href="structie__prob__item.html#a0cda146346269c60459f2513ae05a888">id</a>) <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  261</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  262</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ie__sampler_8c_source.html#l00052">ie_prob_item::id</a>, and <a class="el" href="ie__sampler_8c_source.html#l00053">ie_prob_item::p</a>.</p>

<p class="reference">Referenced by <a class="el" href="ie__sampler_8c_source.html#l00404">ie_sampler_sample()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="ie__sampler_8c_a0f49437bd493fd9354f0a7a355722043_icgraph.svg" width="368" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="aa74353c6e8d0bfd4561ddd0adc8c5190" name="aa74353c6e8d0bfd4561ddd0adc8c5190"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa74353c6e8d0bfd4561ddd0adc8c5190">&#9670;&#160;</a></span>rng_next_f01()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static float rng_next_f01 </td>
          <td>(</td>
          <td class="paramtype">uint64_t *&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Convert RNG output to uniform float in [0,1). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">state</td><td>RNG state. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Uniform float in [0,1). </dd></dl>

<p class="definition">Definition at line <a class="el" href="ie__sampler_8c_source.html#l00245">245</a> of file <a class="el" href="ie__sampler_8c_source.html">ie_sampler.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  245</span>                                           {</div>
<div class="line"><span class="lineno">  246</span>  uint64_t r = <a class="code hl_function" href="ie__sampler_8c.html#a4a70896b3079ea28cde50b95fe2b1d0c">rng_next_u64</a>(state);</div>
<div class="line"><span class="lineno">  247</span>  uint32_t hi = (uint32_t)(r &gt;&gt; 40); <span class="comment">/* 24 bits */</span></div>
<div class="line"><span class="lineno">  248</span>  <span class="keywordflow">return</span> (<span class="keywordtype">float</span>)hi / (float)(1u &lt;&lt; 24);</div>
<div class="line"><span class="lineno">  249</span>}</div>
<div class="ttc" id="aie__sampler_8c_html_a4a70896b3079ea28cde50b95fe2b1d0c"><div class="ttname"><a href="ie__sampler_8c.html#a4a70896b3079ea28cde50b95fe2b1d0c">rng_next_u64</a></div><div class="ttdeci">static uint64_t rng_next_u64(uint64_t *state)</div><div class="ttdoc">Xorshift64* PRNG step.</div><div class="ttdef"><b>Definition</b> <a href="ie__sampler_8c_source.html#l00229">ie_sampler.c:229</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ie__sampler_8c_source.html#l00229">rng_next_u64()</a>.</p>

<p class="reference">Referenced by <a class="el" href="ie__sampler_8c_source.html#l00404">ie_sampler_sample()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="ie__sampler_8c_aa74353c6e8d0bfd4561ddd0adc8c5190_cgraph.svg" width="276" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="ie__sampler_8c_aa74353c6e8d0bfd4561ddd0adc8c5190_icgraph.svg" width="315" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a4a70896b3079ea28cde50b95fe2b1d0c" name="a4a70896b3079ea28cde50b95fe2b1d0c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4a70896b3079ea28cde50b95fe2b1d0c">&#9670;&#160;</a></span>rng_next_u64()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint64_t rng_next_u64 </td>
          <td>(</td>
          <td class="paramtype">uint64_t *&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Xorshift64* PRNG step. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">state</td><td>RNG state (must be nonzero for maximal period). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Next random 64-bit value. </dd></dl>

<p class="definition">Definition at line <a class="el" href="ie__sampler_8c_source.html#l00229">229</a> of file <a class="el" href="ie__sampler_8c_source.html">ie_sampler.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  229</span>                                              {</div>
<div class="line"><span class="lineno">  230</span>  uint64_t x = *state;</div>
<div class="line"><span class="lineno">  231</span>  <span class="keywordflow">if</span> (x == 0) x = 0x9e3779b97f4a7c15ULL;</div>
<div class="line"><span class="lineno">  232</span>  x ^= x &gt;&gt; 12;</div>
<div class="line"><span class="lineno">  233</span>  x ^= x &lt;&lt; 25;</div>
<div class="line"><span class="lineno">  234</span>  x ^= x &gt;&gt; 27;</div>
<div class="line"><span class="lineno">  235</span>  *state = x;</div>
<div class="line"><span class="lineno">  236</span>  <span class="keywordflow">return</span> x * 2685821657736338717ULL;</div>
<div class="line"><span class="lineno">  237</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="ie__sampler_8c_source.html#l00245">rng_next_f01()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="ie__sampler_8c_a4a70896b3079ea28cde50b95fe2b1d0c_icgraph.svg" width="474" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="af5f864c248d511ca9d737ae30b857430" name="af5f864c248d511ca9d737ae30b857430"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af5f864c248d511ca9d737ae30b857430">&#9670;&#160;</a></span>softmax_probs()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int softmax_probs </td>
          <td>(</td>
          <td class="paramtype">const float *&#160;</td>
          <td class="paramname"><em>logits</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>temperature</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>allow_nan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>probs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Compute softmax probabilities from logits with temperature scaling. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">logits</td><td>Input logits. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">n</td><td>Length. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">temperature</td><td>Temperature (must be &gt; 0). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">allow_nan</td><td>If nonzero, NaNs are treated as -inf. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">probs</td><td>Output probabilities (length n). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>1 on success, 0 on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="ie__sampler_8c_source.html#l00299">299</a> of file <a class="el" href="ie__sampler_8c_source.html">ie_sampler.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  303</span>                                       {</div>
<div class="line"><span class="lineno">  304</span>  <span class="keywordflow">if</span> (!logits || !probs || n == 0) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  305</span>  <span class="keywordflow">if</span> (!(temperature &gt; 0.0f)) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  306</span> </div>
<div class="line"><span class="lineno">  307</span>  <span class="keywordtype">float</span> maxv = -FLT_MAX;</div>
<div class="line"><span class="lineno">  308</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; n; ++i) {</div>
<div class="line"><span class="lineno">  309</span>    <span class="keywordtype">float</span> v = logits[i];</div>
<div class="line"><span class="lineno">  310</span>    <span class="keywordflow">if</span> (isnan(v)) {</div>
<div class="line"><span class="lineno">  311</span>      <span class="keywordflow">if</span> (!allow_nan) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  312</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  313</span>    }</div>
<div class="line"><span class="lineno">  314</span>    v = v / temperature;</div>
<div class="line"><span class="lineno">  315</span>    <span class="keywordflow">if</span> (v &gt; maxv) maxv = v;</div>
<div class="line"><span class="lineno">  316</span>  }</div>
<div class="line"><span class="lineno">  317</span> </div>
<div class="line"><span class="lineno">  318</span>  <span class="keywordflow">if</span> (maxv == -FLT_MAX) {</div>
<div class="line"><span class="lineno">  319</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; n; ++i) probs[i] = 0.0f;</div>
<div class="line"><span class="lineno">  320</span>    probs[0] = 1.0f;</div>
<div class="line"><span class="lineno">  321</span>    <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  322</span>  }</div>
<div class="line"><span class="lineno">  323</span> </div>
<div class="line"><span class="lineno">  324</span>  <span class="keywordtype">float</span> sum = 0.0f;</div>
<div class="line"><span class="lineno">  325</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; n; ++i) {</div>
<div class="line"><span class="lineno">  326</span>    <span class="keywordtype">float</span> v = logits[i];</div>
<div class="line"><span class="lineno">  327</span>    <span class="keywordflow">if</span> (isnan(v)) {</div>
<div class="line"><span class="lineno">  328</span>      probs[i] = 0.0f;</div>
<div class="line"><span class="lineno">  329</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  330</span>    }</div>
<div class="line"><span class="lineno">  331</span>    v = v / temperature;</div>
<div class="line"><span class="lineno">  332</span>    <span class="keywordtype">float</span> e = expf(v - maxv);</div>
<div class="line"><span class="lineno">  333</span>    probs[i] = e;</div>
<div class="line"><span class="lineno">  334</span>    sum += e;</div>
<div class="line"><span class="lineno">  335</span>  }</div>
<div class="line"><span class="lineno">  336</span> </div>
<div class="line"><span class="lineno">  337</span>  <span class="keywordflow">if</span> (!(sum &gt; 0.0f) || isnan(sum) || isinf(sum)) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  338</span> </div>
<div class="line"><span class="lineno">  339</span>  <span class="keywordtype">float</span> inv = 1.0f / sum;</div>
<div class="line"><span class="lineno">  340</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; n; ++i) probs[i] *= inv;</div>
<div class="line"><span class="lineno">  341</span>  <span class="keywordflow">return</span> 1;</div>
<div class="line"><span class="lineno">  342</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="ie__sampler_8c_source.html#l00404">ie_sampler_sample()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="ie__sampler_8c_af5f864c248d511ca9d737ae30b857430_icgraph.svg" width="327" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_996f45160da62e1a3d7f6046fad68f51.html">engine</a></li><li class="navelem"><a class="el" href="dir_3d9126aa00c041bc0b8f859d1965a0f4.html">src</a></li><li class="navelem"><a class="el" href="ie__sampler_8c.html">ie_sampler.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
