<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.9.8" xml:lang="en-US">
  <compounddef id="tensor__map_8c" kind="file" language="C++">
    <compoundname>tensor_map.c</compoundname>
    <includes refid="tensor__map_8h" local="yes">tensor_map.h</includes>
    <includes local="no">ctype.h</includes>
    <includes local="no">errno.h</includes>
    <includes local="no">stdio.h</includes>
    <includes local="no">stdlib.h</includes>
    <includes local="no">string.h</includes>
    <incdepgraph>
      <node id="2">
        <label>tensor_map.h</label>
        <link refid="tensor__map_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
      </node>
      <node id="1">
        <label>engine/src/io/tensor_map.c</label>
        <link refid="tensor__map_8c"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
      </node>
      <node id="6">
        <label>ctype.h</label>
      </node>
      <node id="7">
        <label>errno.h</label>
      </node>
      <node id="3">
        <label>stddef.h</label>
      </node>
      <node id="4">
        <label>stdint.h</label>
      </node>
      <node id="5">
        <label>stdio.h</label>
      </node>
      <node id="8">
        <label>stdlib.h</label>
      </node>
      <node id="9">
        <label>string.h</label>
      </node>
    </incdepgraph>
    <innerclass refid="structtm__sort__ref__s" prot="public">tm_sort_ref_s</innerclass>
    <sectiondef kind="define">
      <memberdef kind="define" id="tensor__map_8c_1a3024ccd4a9af5109d24e6c57565d74a1" prot="public" static="no">
        <name>_POSIX_C_SOURCE</name>
        <initializer>200809L</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/io/tensor_map.c" line="5" column="9" bodyfile="engine/src/io/tensor_map.c" bodystart="5" bodyend="-1"/>
      </memberdef>
    </sectiondef>
    <sectiondef kind="typedef">
      <memberdef kind="typedef" id="tensor__map_8c_1a9e71207990621a1e9a86b6c61a93fbbc" prot="public" static="no">
        <type>struct <ref refid="structtm__sort__ref__s" kindref="compound">tm_sort_ref_s</ref></type>
        <definition>typedef struct tm_sort_ref_s tm_sort_ref_t</definition>
        <argsstring></argsstring>
        <name>tm_sort_ref_t</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/io/tensor_map.c" line="679" column="15"/>
      </memberdef>
    </sectiondef>
    <sectiondef kind="func">
      <memberdef kind="function" id="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>const char *</type>
        <definition>static const char * skip_ws</definition>
        <argsstring>(const char *p)</argsstring>
        <name>skip_ws</name>
        <param>
          <type>const char *</type>
          <declname>p</declname>
        </param>
        <briefdescription>
<para>Skip ASCII whitespace in a JSON string. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>p</parametername>
</parameternamelist>
<parameterdescription>
<para>Input pointer. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Pointer to first non-whitespace character (or NUL). </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/io/tensor_map.c" line="24" column="19" bodyfile="engine/src/io/tensor_map.c" bodystart="24" bodyend="27"/>
        <referencedby refid="tensor__map_8c_1a018b3eeeb442114239c9d39d309af8d0" compoundref="tensor__map_8c" startline="341" endline="380">parse_shape_array</referencedby>
        <referencedby refid="tensor__map_8c_1a180580870bc40b8b36b78f81a1c26178" compoundref="tensor__map_8c" startline="397" endline="478">parse_tensor_object</referencedby>
        <referencedby refid="tensor__map_8c_1a532a65d5913530d35874854778a4b444" compoundref="tensor__map_8c" startline="114" endline="128">parse_u64</referencedby>
        <referencedby refid="tensor__map_8c_1a86c69aef66f60185ab7bfe466d7eb1d3" compoundref="tensor__map_8c" startline="137" endline="151">skip_array</referencedby>
        <referencedby refid="tensor__map_8c_1a9e5190012370782147588f3b3b6a4886" compoundref="tensor__map_8c" startline="158" endline="184">skip_object</referencedby>
        <referencedby refid="tensor__map_8c_1a751de8ccde16854a65c185afdfecfdbf" compoundref="tensor__map_8c" startline="191" endline="214">skip_value</referencedby>
        <referencedby refid="tensor__map_8h_1ac4b913e2710929070b5b073b4b67b24c" compoundref="tensor__map_8c" startline="484" endline="648">tensor_map_load</referencedby>
      </memberdef>
      <memberdef kind="function" id="tensor__map_8c_1a9ab7221db47755779150a9cc3c374b8f" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int read_file</definition>
        <argsstring>(const char *path, char **out)</argsstring>
        <name>read_file</name>
        <param>
          <type>const char *</type>
          <declname>path</declname>
        </param>
        <param>
          <type>char **</type>
          <declname>out</declname>
        </param>
        <briefdescription>
<para>Read an entire file into a NUL-terminated buffer. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>path</parametername>
</parameternamelist>
<parameterdescription>
<para>Path to read. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>out</parametername>
</parameternamelist>
<parameterdescription>
<para>Receives malloc&apos;d buffer (caller frees). </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>0 on success, non-zero on failure. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/io/tensor_map.c" line="35" column="12" bodyfile="engine/src/io/tensor_map.c" bodystart="35" bodyend="59"/>
        <referencedby refid="tensor__map_8h_1ac4b913e2710929070b5b073b4b67b24c" compoundref="tensor__map_8c" startline="484" endline="648">tensor_map_load</referencedby>
      </memberdef>
      <memberdef kind="function" id="tensor__map_8c_1a3dae92b1c084251e956a5773e53869b5" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>const char *</type>
        <definition>static const char * parse_string</definition>
        <argsstring>(const char *p, char **out)</argsstring>
        <name>parse_string</name>
        <param>
          <type>const char *</type>
          <declname>p</declname>
        </param>
        <param>
          <type>char **</type>
          <declname>out</declname>
        </param>
        <briefdescription>
<para>Parse a JSON string literal (minimal escape handling). </para>
        </briefdescription>
        <detaileddescription>
<para>This parser preserves escape sequences by copying the escaped character verbatim, which is sufficient for the tensor names used by this project.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>p</parametername>
</parameternamelist>
<parameterdescription>
<para>Input pointer (must point at &apos;&quot;&apos;). </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>out</parametername>
</parameternamelist>
<parameterdescription>
<para>Receives malloc&apos;d C string (caller frees). </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Pointer to first character after the closing quote, or NULL on failure. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/io/tensor_map.c" line="72" column="19" bodyfile="engine/src/io/tensor_map.c" bodystart="72" bodyend="106"/>
        <referencedby refid="tensor__map_8c_1a180580870bc40b8b36b78f81a1c26178" compoundref="tensor__map_8c" startline="397" endline="478">parse_tensor_object</referencedby>
        <referencedby refid="tensor__map_8c_1a9e5190012370782147588f3b3b6a4886" compoundref="tensor__map_8c" startline="158" endline="184">skip_object</referencedby>
        <referencedby refid="tensor__map_8c_1a751de8ccde16854a65c185afdfecfdbf" compoundref="tensor__map_8c" startline="191" endline="214">skip_value</referencedby>
        <referencedby refid="tensor__map_8h_1ac4b913e2710929070b5b073b4b67b24c" compoundref="tensor__map_8c" startline="484" endline="648">tensor_map_load</referencedby>
      </memberdef>
      <memberdef kind="function" id="tensor__map_8c_1a532a65d5913530d35874854778a4b444" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>const char *</type>
        <definition>static const char * parse_u64</definition>
        <argsstring>(const char *p, uint64_t *out)</argsstring>
        <name>parse_u64</name>
        <param>
          <type>const char *</type>
          <declname>p</declname>
        </param>
        <param>
          <type>uint64_t *</type>
          <declname>out</declname>
        </param>
        <briefdescription>
<para>Parse an unsigned decimal integer. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>p</parametername>
</parameternamelist>
<parameterdescription>
<para>Input pointer. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>out</parametername>
</parameternamelist>
<parameterdescription>
<para>Receives parsed value. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Pointer after the number, or NULL on failure. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/io/tensor_map.c" line="114" column="19" bodyfile="engine/src/io/tensor_map.c" bodystart="114" bodyend="128"/>
        <references refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" compoundref="tensor__map_8c" startline="24" endline="27">skip_ws</references>
        <referencedby refid="tensor__map_8c_1a018b3eeeb442114239c9d39d309af8d0" compoundref="tensor__map_8c" startline="341" endline="380">parse_shape_array</referencedby>
        <referencedby refid="tensor__map_8c_1a180580870bc40b8b36b78f81a1c26178" compoundref="tensor__map_8c" startline="397" endline="478">parse_tensor_object</referencedby>
        <referencedby refid="tensor__map_8c_1a751de8ccde16854a65c185afdfecfdbf" compoundref="tensor__map_8c" startline="191" endline="214">skip_value</referencedby>
      </memberdef>
      <memberdef kind="function" id="tensor__map_8c_1a751de8ccde16854a65c185afdfecfdbf" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>const char *</type>
        <definition>static const char * skip_value</definition>
        <argsstring>(const char *p)</argsstring>
        <name>skip_value</name>
        <param>
          <type>const char *</type>
          <declname>p</declname>
        </param>
        <briefdescription>
<para>Skip any JSON value (string/object/array/number/true/false/null). </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>p</parametername>
</parameternamelist>
<parameterdescription>
<para>Input pointer. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Pointer after the value, or NULL on failure. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/io/tensor_map.c" line="191" column="19" bodyfile="engine/src/io/tensor_map.c" bodystart="191" bodyend="214" declfile="engine/src/io/tensor_map.c" declline="130" declcolumn="19"/>
        <references refid="tensor__map_8c_1a3dae92b1c084251e956a5773e53869b5" compoundref="tensor__map_8c" startline="72" endline="106">parse_string</references>
        <references refid="tensor__map_8c_1a532a65d5913530d35874854778a4b444" compoundref="tensor__map_8c" startline="114" endline="128">parse_u64</references>
        <references refid="tensor__map_8c_1a86c69aef66f60185ab7bfe466d7eb1d3" compoundref="tensor__map_8c" startline="137" endline="151">skip_array</references>
        <references refid="tensor__map_8c_1a9e5190012370782147588f3b3b6a4886" compoundref="tensor__map_8c" startline="158" endline="184">skip_object</references>
        <references refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" compoundref="tensor__map_8c" startline="24" endline="27">skip_ws</references>
        <referencedby refid="tensor__map_8c_1a180580870bc40b8b36b78f81a1c26178" compoundref="tensor__map_8c" startline="397" endline="478">parse_tensor_object</referencedby>
        <referencedby refid="tensor__map_8c_1a86c69aef66f60185ab7bfe466d7eb1d3" compoundref="tensor__map_8c" startline="137" endline="151">skip_array</referencedby>
        <referencedby refid="tensor__map_8c_1a9e5190012370782147588f3b3b6a4886" compoundref="tensor__map_8c" startline="158" endline="184">skip_object</referencedby>
        <referencedby refid="tensor__map_8h_1ac4b913e2710929070b5b073b4b67b24c" compoundref="tensor__map_8c" startline="484" endline="648">tensor_map_load</referencedby>
      </memberdef>
      <memberdef kind="function" id="tensor__map_8c_1a86c69aef66f60185ab7bfe466d7eb1d3" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>const char *</type>
        <definition>static const char * skip_array</definition>
        <argsstring>(const char *p)</argsstring>
        <name>skip_array</name>
        <param>
          <type>const char *</type>
          <declname>p</declname>
        </param>
        <briefdescription>
<para>Skip a JSON array value. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>p</parametername>
</parameternamelist>
<parameterdescription>
<para>Input pointer (must point at &apos;[&apos;). </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Pointer after the closing &apos;]&apos;, or NULL on failure. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/io/tensor_map.c" line="137" column="19" bodyfile="engine/src/io/tensor_map.c" bodystart="137" bodyend="151"/>
        <references refid="tensor__map_8c_1a751de8ccde16854a65c185afdfecfdbf" compoundref="tensor__map_8c" startline="191" endline="214">skip_value</references>
        <references refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" compoundref="tensor__map_8c" startline="24" endline="27">skip_ws</references>
        <referencedby refid="tensor__map_8c_1a751de8ccde16854a65c185afdfecfdbf" compoundref="tensor__map_8c" startline="191" endline="214">skip_value</referencedby>
        <referencedby refid="tensor__map_8h_1ac4b913e2710929070b5b073b4b67b24c" compoundref="tensor__map_8c" startline="484" endline="648">tensor_map_load</referencedby>
      </memberdef>
      <memberdef kind="function" id="tensor__map_8c_1a9e5190012370782147588f3b3b6a4886" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>const char *</type>
        <definition>static const char * skip_object</definition>
        <argsstring>(const char *p)</argsstring>
        <name>skip_object</name>
        <param>
          <type>const char *</type>
          <declname>p</declname>
        </param>
        <briefdescription>
<para>Skip a JSON object value. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>p</parametername>
</parameternamelist>
<parameterdescription>
<para>Input pointer (must point at &apos;{&apos;). </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Pointer after the closing &apos;}&apos;, or NULL on failure. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/io/tensor_map.c" line="158" column="19" bodyfile="engine/src/io/tensor_map.c" bodystart="158" bodyend="184"/>
        <references refid="tensor__map_8c_1a3dae92b1c084251e956a5773e53869b5" compoundref="tensor__map_8c" startline="72" endline="106">parse_string</references>
        <references refid="tensor__map_8c_1a751de8ccde16854a65c185afdfecfdbf" compoundref="tensor__map_8c" startline="191" endline="214">skip_value</references>
        <references refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" compoundref="tensor__map_8c" startline="24" endline="27">skip_ws</references>
        <referencedby refid="tensor__map_8c_1a751de8ccde16854a65c185afdfecfdbf" compoundref="tensor__map_8c" startline="191" endline="214">skip_value</referencedby>
        <referencedby refid="tensor__map_8h_1ac4b913e2710929070b5b073b4b67b24c" compoundref="tensor__map_8c" startline="484" endline="648">tensor_map_load</referencedby>
      </memberdef>
      <memberdef kind="function" id="tensor__map_8c_1a16fd8cdfb13d3c08166460f7c2e6d7b2" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>unsigned char</type>
        <definition>static unsigned char ie_tolower_ascii</definition>
        <argsstring>(unsigned char c)</argsstring>
        <name>ie_tolower_ascii</name>
        <param>
          <type>unsigned char</type>
          <declname>c</declname>
        </param>
        <briefdescription>
<para>Lowercase ASCII character without locale effects. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>c</parametername>
</parameternamelist>
<parameterdescription>
<para>Input byte. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Lowercased byte. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/io/tensor_map.c" line="225" column="22" bodyfile="engine/src/io/tensor_map.c" bodystart="225" bodyend="228"/>
        <referencedby refid="tensor__map_8c_1a935215259f1e01927022c50c39b8f197" compoundref="tensor__map_8c" startline="236" endline="244">ie_streq_case_ascii</referencedby>
      </memberdef>
      <memberdef kind="function" id="tensor__map_8c_1a935215259f1e01927022c50c39b8f197" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int ie_streq_case_ascii</definition>
        <argsstring>(const char *a, const char *b)</argsstring>
        <name>ie_streq_case_ascii</name>
        <param>
          <type>const char *</type>
          <declname>a</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>b</declname>
        </param>
        <briefdescription>
<para>Case-insensitive ASCII equality for short identifiers. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>a</parametername>
</parameternamelist>
<parameterdescription>
<para>String A. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>b</parametername>
</parameternamelist>
<parameterdescription>
<para>String B. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>1 if equal, 0 otherwise. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/io/tensor_map.c" line="236" column="12" bodyfile="engine/src/io/tensor_map.c" bodystart="236" bodyend="244"/>
        <references refid="tensor__map_8c_1a16fd8cdfb13d3c08166460f7c2e6d7b2" compoundref="tensor__map_8c" startline="225" endline="228">ie_tolower_ascii</references>
        <referencedby refid="tensor__map_8c_1a86b10318f8d32a99fd516d382b211913" compoundref="tensor__map_8c" startline="260" endline="279">parse_dtype</referencedby>
      </memberdef>
      <memberdef kind="function" id="tensor__map_8c_1a86b10318f8d32a99fd516d382b211913" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="tensor__map_8h_1ac1e5d7196426dbb29e3f26f38f4cde89" kindref="member">tensor_dtype_t</ref></type>
        <definition>static tensor_dtype_t parse_dtype</definition>
        <argsstring>(const char *s)</argsstring>
        <name>parse_dtype</name>
        <param>
          <type>const char *</type>
          <declname>s</declname>
        </param>
        <briefdescription>
<para>Parse dtype string into tensor_dtype_t. </para>
        </briefdescription>
        <detaileddescription>
<para>Accepts common spellings and is ASCII case-insensitive:<itemizedlist>
<listitem><para>&quot;bf16&quot;, &quot;BF16&quot;, &quot;bfloat16&quot;</para>
</listitem><listitem><para>&quot;f16&quot;, &quot;fp16&quot;, &quot;float16&quot;</para>
</listitem><listitem><para>&quot;f32&quot;, &quot;fp32&quot;, &quot;float32&quot;</para>
</listitem><listitem><para>&quot;u8&quot;, &quot;uint8&quot;</para>
</listitem><listitem><para>&quot;int4&quot;</para>
</listitem></itemizedlist>
</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>s</parametername>
</parameternamelist>
<parameterdescription>
<para>Input dtype string. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Parsed dtype tag. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/io/tensor_map.c" line="260" column="23" bodyfile="engine/src/io/tensor_map.c" bodystart="260" bodyend="279"/>
        <references refid="tensor__map_8c_1a935215259f1e01927022c50c39b8f197" compoundref="tensor__map_8c" startline="236" endline="244">ie_streq_case_ascii</references>
        <references refid="tensor__map_8h_1a2a2857711e062d6fafb189e11c772e60a205d1b0175039c386b1f907101942387" compoundref="tensor__map_8h" startline="50">TENSOR_DTYPE_BF16</references>
        <references refid="tensor__map_8h_1a2a2857711e062d6fafb189e11c772e60abd617fa72c8bfbdcd703732a2a74e9fe" compoundref="tensor__map_8h" startline="48">TENSOR_DTYPE_F16</references>
        <references refid="tensor__map_8h_1a2a2857711e062d6fafb189e11c772e60a8be2bde5845696812a062797ff5db779" compoundref="tensor__map_8h" startline="47">TENSOR_DTYPE_F32</references>
        <references refid="tensor__map_8h_1a2a2857711e062d6fafb189e11c772e60a7d14acd31ad346fe41c149dc7270d20d" compoundref="tensor__map_8h" startline="49">TENSOR_DTYPE_INT4</references>
        <references refid="tensor__map_8h_1a2a2857711e062d6fafb189e11c772e60a28cbf2aeff36d35b8a7d954fb0ca333b" compoundref="tensor__map_8h" startline="51">TENSOR_DTYPE_U8</references>
        <references refid="tensor__map_8h_1a2a2857711e062d6fafb189e11c772e60afc9691802827f535b2385da565e74947" compoundref="tensor__map_8h" startline="52">TENSOR_DTYPE_UNKNOWN</references>
        <referencedby refid="tensor__map_8c_1a180580870bc40b8b36b78f81a1c26178" compoundref="tensor__map_8c" startline="397" endline="478">parse_tensor_object</referencedby>
      </memberdef>
      <memberdef kind="function" id="tensor__map_8c_1abce6e7f7fc0bc9c46436c0d41c8a72ae" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void tensor_desc_zero</definition>
        <argsstring>(tensor_desc_t *td)</argsstring>
        <name>tensor_desc_zero</name>
        <param>
          <type><ref refid="tensor__map_8h_1a1ed0f6ce08b1582103651d4fd14a30f1" kindref="member">tensor_desc_t</ref> *</type>
          <declname>td</declname>
        </param>
        <briefdescription>
<para>Zero-initialize a tensor descriptor. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>td</parametername>
</parameternamelist>
<parameterdescription>
<para>Descriptor to clear. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/io/tensor_map.c" line="289" column="13" bodyfile="engine/src/io/tensor_map.c" bodystart="289" bodyend="297"/>
        <references refid="structtensor__desc__s_1ab88eba5b794240beb885009efb7cd5ec" compoundref="tensor__map_8h" startline="100">tensor_desc_s::dtype</references>
        <references refid="structtensor__desc__s_1a1134b2dbce500003f3b011f3e8a3d090" compoundref="tensor__map_8h" startline="94">tensor_desc_s::name</references>
        <references refid="structtensor__desc__s_1a39d73e77fad5a093361fb4d0816c7d5f" compoundref="tensor__map_8h" startline="105">tensor_desc_s::ndim</references>
        <references refid="structtensor__desc__s_1a0abe393a370bda31eda8ab11a5f8df37" compoundref="tensor__map_8h" startline="96">tensor_desc_s::offset</references>
        <references refid="structtensor__desc__s_1afd3b79d2fae3209ac079b6ee551c31c7" compoundref="tensor__map_8h" startline="103">tensor_desc_s::shape</references>
        <references refid="structtensor__desc__s_1a151674f0f1ad60320437f028593d8b26" compoundref="tensor__map_8h" startline="98">tensor_desc_s::size_bytes</references>
        <references refid="tensor__map_8h_1a2a2857711e062d6fafb189e11c772e60afc9691802827f535b2385da565e74947" compoundref="tensor__map_8h" startline="52">TENSOR_DTYPE_UNKNOWN</references>
        <referencedby refid="tensor__map_8c_1a180580870bc40b8b36b78f81a1c26178" compoundref="tensor__map_8c" startline="397" endline="478">parse_tensor_object</referencedby>
        <referencedby refid="tensor__map_8c_1aa6b53de7ce006a1a2877e2b19ad8ce24" compoundref="tensor__map_8c" startline="303" endline="308">tensor_desc_free</referencedby>
      </memberdef>
      <memberdef kind="function" id="tensor__map_8c_1aa6b53de7ce006a1a2877e2b19ad8ce24" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void tensor_desc_free</definition>
        <argsstring>(tensor_desc_t *td)</argsstring>
        <name>tensor_desc_free</name>
        <param>
          <type><ref refid="tensor__map_8h_1a1ed0f6ce08b1582103651d4fd14a30f1" kindref="member">tensor_desc_t</ref> *</type>
          <declname>td</declname>
        </param>
        <briefdescription>
<para>Free owned fields of a tensor descriptor and reset it. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>td</parametername>
</parameternamelist>
<parameterdescription>
<para>Descriptor to free/reset. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/io/tensor_map.c" line="303" column="13" bodyfile="engine/src/io/tensor_map.c" bodystart="303" bodyend="308"/>
        <references refid="structtensor__desc__s_1a1134b2dbce500003f3b011f3e8a3d090" compoundref="tensor__map_8h" startline="94">tensor_desc_s::name</references>
        <references refid="structtensor__desc__s_1afd3b79d2fae3209ac079b6ee551c31c7" compoundref="tensor__map_8h" startline="103">tensor_desc_s::shape</references>
        <references refid="tensor__map_8c_1abce6e7f7fc0bc9c46436c0d41c8a72ae" compoundref="tensor__map_8c" startline="289" endline="297">tensor_desc_zero</references>
        <referencedby refid="tensor__map_8c_1a180580870bc40b8b36b78f81a1c26178" compoundref="tensor__map_8c" startline="397" endline="478">parse_tensor_object</referencedby>
        <referencedby refid="tensor__map_8h_1ac4b913e2710929070b5b073b4b67b24c" compoundref="tensor__map_8c" startline="484" endline="648">tensor_map_load</referencedby>
      </memberdef>
      <memberdef kind="function" id="tensor__map_8c_1a87fc763c39a4a64f091406e88b1c640e" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int push_tensor</definition>
        <argsstring>(tensor_desc_t **arr, uint32_t *count, uint32_t *cap, const tensor_desc_t *src)</argsstring>
        <name>push_tensor</name>
        <param>
          <type><ref refid="tensor__map_8h_1a1ed0f6ce08b1582103651d4fd14a30f1" kindref="member">tensor_desc_t</ref> **</type>
          <declname>arr</declname>
        </param>
        <param>
          <type>uint32_t *</type>
          <declname>count</declname>
        </param>
        <param>
          <type>uint32_t *</type>
          <declname>cap</declname>
        </param>
        <param>
          <type>const <ref refid="tensor__map_8h_1a1ed0f6ce08b1582103651d4fd14a30f1" kindref="member">tensor_desc_t</ref> *</type>
          <declname>src</declname>
        </param>
        <briefdescription>
<para>Append a tensor descriptor to a growable array. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>arr</parametername>
</parameternamelist>
<parameterdescription>
<para>In/out array pointer. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>count</parametername>
</parameternamelist>
<parameterdescription>
<para>In/out count. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>cap</parametername>
</parameternamelist>
<parameterdescription>
<para>In/out capacity. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>src</parametername>
</parameternamelist>
<parameterdescription>
<para>Source descriptor (shallow-copied; ownership transfers to array). </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>0 on success, non-zero on failure. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/io/tensor_map.c" line="318" column="12" bodyfile="engine/src/io/tensor_map.c" bodystart="318" bodyend="332"/>
        <referencedby refid="tensor__map_8h_1ac4b913e2710929070b5b073b4b67b24c" compoundref="tensor__map_8c" startline="484" endline="648">tensor_map_load</referencedby>
      </memberdef>
      <memberdef kind="function" id="tensor__map_8c_1a018b3eeeb442114239c9d39d309af8d0" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>const char *</type>
        <definition>static const char * parse_shape_array</definition>
        <argsstring>(const char *p, uint32_t **out_shape, uint32_t *out_ndim)</argsstring>
        <name>parse_shape_array</name>
        <param>
          <type>const char *</type>
          <declname>p</declname>
        </param>
        <param>
          <type>uint32_t **</type>
          <declname>out_shape</declname>
        </param>
        <param>
          <type>uint32_t *</type>
          <declname>out_ndim</declname>
        </param>
        <briefdescription>
<para>Parse a JSON array of integers into a shape array. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>p</parametername>
</parameternamelist>
<parameterdescription>
<para>Input pointer. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>out_shape</parametername>
</parameternamelist>
<parameterdescription>
<para>Receives malloc&apos;d shape array (caller frees). </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>out_ndim</parametername>
</parameternamelist>
<parameterdescription>
<para>Receives dimension count. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Pointer after the closing &apos;]&apos;, or NULL on failure. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/io/tensor_map.c" line="341" column="19" bodyfile="engine/src/io/tensor_map.c" bodystart="341" bodyend="380"/>
        <references refid="tensor__map_8c_1a532a65d5913530d35874854778a4b444" compoundref="tensor__map_8c" startline="114" endline="128">parse_u64</references>
        <references refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" compoundref="tensor__map_8c" startline="24" endline="27">skip_ws</references>
        <referencedby refid="tensor__map_8c_1a180580870bc40b8b36b78f81a1c26178" compoundref="tensor__map_8c" startline="397" endline="478">parse_tensor_object</referencedby>
      </memberdef>
      <memberdef kind="function" id="tensor__map_8c_1a180580870bc40b8b36b78f81a1c26178" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>const char *</type>
        <definition>static const char * parse_tensor_object</definition>
        <argsstring>(const char *p, const char *map_style_name, tensor_desc_t *td, int *out_ok)</argsstring>
        <name>parse_tensor_object</name>
        <param>
          <type>const char *</type>
          <declname>p</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>map_style_name</declname>
        </param>
        <param>
          <type><ref refid="tensor__map_8h_1a1ed0f6ce08b1582103651d4fd14a30f1" kindref="member">tensor_desc_t</ref> *</type>
          <declname>td</declname>
        </param>
        <param>
          <type>int *</type>
          <declname>out_ok</declname>
        </param>
        <briefdescription>
<para>Parse a tensor descriptor object. </para>
        </briefdescription>
        <detaileddescription>
<para>If <computeroutput>map_style_name</computeroutput> is non-NULL, td-&gt;name is taken from it and &quot;name&quot; is optional. If <computeroutput>map_style_name</computeroutput> is NULL, the &quot;name&quot; field is required.</para>
<para>Also accepts &quot;nbytes&quot; as an alias for &quot;size_bytes&quot; for compatibility with some emitters.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>p</parametername>
</parameternamelist>
<parameterdescription>
<para>Input pointer (must point at &apos;{&apos;). </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>map_style_name</parametername>
</parameternamelist>
<parameterdescription>
<para>Optional name from map-style JSON key. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>td</parametername>
</parameternamelist>
<parameterdescription>
<para>Output descriptor (takes ownership of allocated fields). </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>out_ok</parametername>
</parameternamelist>
<parameterdescription>
<para>Receives 1 if parsed and has a name, 0 otherwise. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Pointer after the closing &apos;}&apos;, or NULL on failure. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/io/tensor_map.c" line="397" column="19" bodyfile="engine/src/io/tensor_map.c" bodystart="397" bodyend="478"/>
        <references refid="structtensor__desc__s_1ab88eba5b794240beb885009efb7cd5ec" compoundref="tensor__map_8h" startline="100">tensor_desc_s::dtype</references>
        <references refid="structtensor__desc__s_1a1134b2dbce500003f3b011f3e8a3d090" compoundref="tensor__map_8h" startline="94">tensor_desc_s::name</references>
        <references refid="structtensor__desc__s_1a39d73e77fad5a093361fb4d0816c7d5f" compoundref="tensor__map_8h" startline="105">tensor_desc_s::ndim</references>
        <references refid="structtensor__desc__s_1a0abe393a370bda31eda8ab11a5f8df37" compoundref="tensor__map_8h" startline="96">tensor_desc_s::offset</references>
        <references refid="tensor__map_8c_1a86b10318f8d32a99fd516d382b211913" compoundref="tensor__map_8c" startline="260" endline="279">parse_dtype</references>
        <references refid="tensor__map_8c_1a018b3eeeb442114239c9d39d309af8d0" compoundref="tensor__map_8c" startline="341" endline="380">parse_shape_array</references>
        <references refid="tensor__map_8c_1a3dae92b1c084251e956a5773e53869b5" compoundref="tensor__map_8c" startline="72" endline="106">parse_string</references>
        <references refid="tensor__map_8c_1a532a65d5913530d35874854778a4b444" compoundref="tensor__map_8c" startline="114" endline="128">parse_u64</references>
        <references refid="structtensor__desc__s_1afd3b79d2fae3209ac079b6ee551c31c7" compoundref="tensor__map_8h" startline="103">tensor_desc_s::shape</references>
        <references refid="structtensor__desc__s_1a151674f0f1ad60320437f028593d8b26" compoundref="tensor__map_8h" startline="98">tensor_desc_s::size_bytes</references>
        <references refid="tensor__map_8c_1a751de8ccde16854a65c185afdfecfdbf" compoundref="tensor__map_8c" startline="191" endline="214">skip_value</references>
        <references refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" compoundref="tensor__map_8c" startline="24" endline="27">skip_ws</references>
        <references refid="tensor__map_8c_1aa6b53de7ce006a1a2877e2b19ad8ce24" compoundref="tensor__map_8c" startline="303" endline="308">tensor_desc_free</references>
        <references refid="tensor__map_8c_1abce6e7f7fc0bc9c46436c0d41c8a72ae" compoundref="tensor__map_8c" startline="289" endline="297">tensor_desc_zero</references>
        <referencedby refid="tensor__map_8h_1ac4b913e2710929070b5b073b4b67b24c" compoundref="tensor__map_8c" startline="484" endline="648">tensor_map_load</referencedby>
      </memberdef>
      <memberdef kind="function" id="tensor__map_8c_1ac4b913e2710929070b5b073b4b67b24c" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int tensor_map_load</definition>
        <argsstring>(const char *path, tensor_map_t *out)</argsstring>
        <name>tensor_map_load</name>
        <param>
          <type>const char *</type>
          <declname>path</declname>
        </param>
        <param>
          <type><ref refid="tensor__map_8h_1a0ae1dced25c800bf85537db1ce9776a7" kindref="member">tensor_map_t</ref> *</type>
          <declname>out</declname>
        </param>
        <briefdescription>
<para>Load tensor_map.json from disk. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>path</parametername>
</parameternamelist>
<parameterdescription>
<para>Path to tensor_map.json. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>out</parametername>
</parameternamelist>
<parameterdescription>
<para>Output tensor map. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>0 on success, non-zero on failure. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/io/tensor_map.c" line="484" column="5" bodyfile="engine/src/io/tensor_map.c" bodystart="484" bodyend="648"/>
        <references refid="tensor__map_8c_1a3dae92b1c084251e956a5773e53869b5" compoundref="tensor__map_8c" startline="72" endline="106">parse_string</references>
        <references refid="tensor__map_8c_1a180580870bc40b8b36b78f81a1c26178" compoundref="tensor__map_8c" startline="397" endline="478">parse_tensor_object</references>
        <references refid="tensor__map_8c_1a87fc763c39a4a64f091406e88b1c640e" compoundref="tensor__map_8c" startline="318" endline="332">push_tensor</references>
        <references refid="tensor__map_8c_1a9ab7221db47755779150a9cc3c374b8f" compoundref="tensor__map_8c" startline="35" endline="59">read_file</references>
        <references refid="tensor__map_8c_1a86c69aef66f60185ab7bfe466d7eb1d3" compoundref="tensor__map_8c" startline="137" endline="151">skip_array</references>
        <references refid="tensor__map_8c_1a9e5190012370782147588f3b3b6a4886" compoundref="tensor__map_8c" startline="158" endline="184">skip_object</references>
        <references refid="tensor__map_8c_1a751de8ccde16854a65c185afdfecfdbf" compoundref="tensor__map_8c" startline="191" endline="214">skip_value</references>
        <references refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" compoundref="tensor__map_8c" startline="24" endline="27">skip_ws</references>
        <references refid="tensor__map_8c_1aa6b53de7ce006a1a2877e2b19ad8ce24" compoundref="tensor__map_8c" startline="303" endline="308">tensor_desc_free</references>
        <referencedby refid="gptoss__weights__index_8h_1ab0abbe94d2373ea44d51f2325c7cc46c" compoundref="gptoss__weights__index_8c" startline="417" endline="490">gptoss_weights_index_open</referencedby>
        <referencedby refid="ie__infer_8h_1a569ac499d7bce188c1e21fa9377b9bae" compoundref="infer__gptoss_8c" startline="1700" endline="2290">ie_gptoss_infer_create</referencedby>
        <referencedby refid="ie__api_8c_1a037b105c112037bdbc1725c6c88fd1ff" compoundref="ie__api_8c" startline="275" endline="311">maybe_correct_head_dim_</referencedby>
      </memberdef>
      <memberdef kind="function" id="tensor__map_8c_1a42d154b3f93b07c41b514e468a61c803" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void tensor_map_free</definition>
        <argsstring>(tensor_map_t *map)</argsstring>
        <name>tensor_map_free</name>
        <param>
          <type><ref refid="tensor__map_8h_1a0ae1dced25c800bf85537db1ce9776a7" kindref="member">tensor_map_t</ref> *</type>
          <declname>map</declname>
        </param>
        <briefdescription>
<para>Free tensor map and all owned memory. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>map</parametername>
</parameternamelist>
<parameterdescription>
<para>Tensor map (may be NULL). </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/io/tensor_map.c" line="650" column="6" bodyfile="engine/src/io/tensor_map.c" bodystart="650" bodyend="660"/>
        <references refid="structtensor__map__s_1a64c31242ffe43f6fc36b465d1ef75462" compoundref="tensor__map_8h" startline="122">tensor_map_s::count</references>
        <references refid="structtensor__desc__s_1a1134b2dbce500003f3b011f3e8a3d090" compoundref="tensor__map_8h" startline="94">tensor_desc_s::name</references>
        <references refid="structtensor__desc__s_1afd3b79d2fae3209ac079b6ee551c31c7" compoundref="tensor__map_8h" startline="103">tensor_desc_s::shape</references>
        <references refid="structtensor__map__s_1a30493d1f3d1e66d1e9de6813c2844293" compoundref="tensor__map_8h" startline="120">tensor_map_s::tensors</references>
        <referencedby refid="gptoss__weights__index_8h_1a943d5a8178000a52f6148bdbccda2252" compoundref="gptoss__weights__index_8c" startline="492" endline="507">gptoss_weights_index_close</referencedby>
        <referencedby refid="gptoss__weights__index_8h_1ab0abbe94d2373ea44d51f2325c7cc46c" compoundref="gptoss__weights__index_8c" startline="417" endline="490">gptoss_weights_index_open</referencedby>
        <referencedby refid="ie__infer_8h_1a569ac499d7bce188c1e21fa9377b9bae" compoundref="infer__gptoss_8c" startline="1700" endline="2290">ie_gptoss_infer_create</referencedby>
        <referencedby refid="ie__infer_8h_1a89e8a91978217f16a8c9ef4adae46048" compoundref="infer__gptoss_8c" startline="2292" endline="2335">ie_gptoss_infer_destroy</referencedby>
        <referencedby refid="ie__api_8c_1a037b105c112037bdbc1725c6c88fd1ff" compoundref="ie__api_8c" startline="275" endline="311">maybe_correct_head_dim_</referencedby>
      </memberdef>
      <memberdef kind="function" id="tensor__map_8c_1abe58b80593931ffe5844ee4bcee805c5" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>const <ref refid="tensor__map_8h_1a1ed0f6ce08b1582103651d4fd14a30f1" kindref="member">tensor_desc_t</ref> *</type>
        <definition>const tensor_desc_t * tensor_map_find</definition>
        <argsstring>(const tensor_map_t *map, const char *name)</argsstring>
        <name>tensor_map_find</name>
        <param>
          <type>const <ref refid="tensor__map_8h_1a0ae1dced25c800bf85537db1ce9776a7" kindref="member">tensor_map_t</ref> *</type>
          <declname>map</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>name</declname>
        </param>
        <briefdescription>
<para>Find a tensor descriptor by exact name. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>map</parametername>
</parameternamelist>
<parameterdescription>
<para>Loaded tensor map. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>name</parametername>
</parameternamelist>
<parameterdescription>
<para>Tensor name. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Pointer to descriptor, or NULL if not found. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/io/tensor_map.c" line="662" column="21" bodyfile="engine/src/io/tensor_map.c" bodystart="662" bodyend="669"/>
        <references refid="structtensor__map__s_1a64c31242ffe43f6fc36b465d1ef75462" compoundref="tensor__map_8h" startline="122">tensor_map_s::count</references>
        <references refid="structtensor__map__s_1acb71d934b0da86d92eb41c1992756bfd" compoundref="tensor__map_8h" startline="124">tensor_map_s::loaded</references>
        <references refid="structtensor__desc__s_1a1134b2dbce500003f3b011f3e8a3d090" compoundref="tensor__map_8h" startline="94">tensor_desc_s::name</references>
        <references refid="structtensor__map__s_1a30493d1f3d1e66d1e9de6813c2844293" compoundref="tensor__map_8h" startline="120">tensor_map_s::tensors</references>
        <referencedby refid="infer__gptoss_8c_1aa3b82aa04620edd8580f7ecf25a76f5f" compoundref="infer__gptoss_8c" startline="798" endline="801">ie_w_find</referencedby>
        <referencedby refid="ie__api_8c_1a037b105c112037bdbc1725c6c88fd1ff" compoundref="ie__api_8c" startline="275" endline="311">maybe_correct_head_dim_</referencedby>
        <referencedby refid="gptoss__weights__index_8c_1a1d0c65a6e45fb8bdf4ef6e703fbe20b5" compoundref="gptoss__weights__index_8c" startline="513" endline="573">widx_detect_arch</referencedby>
        <referencedby refid="gptoss__weights__index_8c_1adc8f01ad4eb156e2f380f2b39e51d0ae" compoundref="gptoss__weights__index_8c" startline="332" endline="349">widx_find_any</referencedby>
        <referencedby refid="gptoss__weights__index_8c_1a59ea306bea1c9226c31583a49f2e7ffd" compoundref="gptoss__weights__index_8c" startline="575" endline="792">widx_resolve_layer_llama</referencedby>
        <referencedby refid="gptoss__weights__index_8c_1aaa150e690297afaababde6bd8bcb7ae7" compoundref="gptoss__weights__index_8c" startline="794" endline="858">widx_resolve_layer_neox</referencedby>
      </memberdef>
      <memberdef kind="function" id="tensor__map_8c_1a9dc54e5679c0402d5d812603754287a8" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int tm_sort_ref_cmp</definition>
        <argsstring>(const void *a, const void *b)</argsstring>
        <name>tm_sort_ref_cmp</name>
        <param>
          <type>const void *</type>
          <declname>a</declname>
        </param>
        <param>
          <type>const void *</type>
          <declname>b</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/io/tensor_map.c" line="681" column="12" bodyfile="engine/src/io/tensor_map.c" bodystart="681" bodyend="689"/>
        <references refid="structtm__sort__ref__s_1a4f38ae166a16e951094d4bdc51c630a9" compoundref="tensor__map_8c" startline="677">tm_sort_ref_s::end</references>
        <references refid="structtm__sort__ref__s_1afaf93178be657b3090952279c97fc940" compoundref="tensor__map_8c" startline="676">tm_sort_ref_s::off</references>
        <referencedby refid="tensor__map_8h_1ad5a6d86e99a96405eb2d6daf95603691" compoundref="tensor__map_8c" startline="696" endline="776">tensor_map_validate_against_bin</referencedby>
      </memberdef>
      <memberdef kind="function" id="tensor__map_8c_1a545cca475e7c6de327d07da7515a67d1" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void tm_set_err</definition>
        <argsstring>(char *err, size_t errsz, const char *msg)</argsstring>
        <name>tm_set_err</name>
        <param>
          <type>char *</type>
          <declname>err</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>errsz</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>msg</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/io/tensor_map.c" line="691" column="13" bodyfile="engine/src/io/tensor_map.c" bodystart="691" bodyend="694"/>
        <referencedby refid="tensor__map_8h_1ad5a6d86e99a96405eb2d6daf95603691" compoundref="tensor__map_8c" startline="696" endline="776">tensor_map_validate_against_bin</referencedby>
      </memberdef>
      <memberdef kind="function" id="tensor__map_8c_1ad5a6d86e99a96405eb2d6daf95603691" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int tensor_map_validate_against_bin</definition>
        <argsstring>(const tensor_map_t *map, size_t bin_size, char *err, size_t errsz)</argsstring>
        <name>tensor_map_validate_against_bin</name>
        <param>
          <type>const <ref refid="tensor__map_8h_1a0ae1dced25c800bf85537db1ce9776a7" kindref="member">tensor_map_t</ref> *</type>
          <declname>map</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>bin_size</declname>
        </param>
        <param>
          <type>char *</type>
          <declname>err</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>errsz</declname>
        </param>
        <briefdescription>
<para>Validate a loaded tensor map against a mapped weights binary. </para>
        </briefdescription>
        <detaileddescription>
<para>This is a hard consistency check intended to catch stale/mismatched tensor_map.json versus model.ie.bin before any inference occurs. It validates:<itemizedlist>
<listitem><para>name is present</para>
</listitem><listitem><para>size_bytes is non-zero</para>
</listitem><listitem><para>offset + size_bytes fits within bin_size</para>
</listitem><listitem><para>no overlaps (after sorting by offset)</para>
</listitem></itemizedlist>
</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>map</parametername>
</parameternamelist>
<parameterdescription>
<para>Loaded tensor map. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>bin_size</parametername>
</parameternamelist>
<parameterdescription>
<para>Size in bytes of the mapped weights file. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>err</parametername>
</parameternamelist>
<parameterdescription>
<para>Optional error buffer for a human-readable error message. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>errsz</parametername>
</parameternamelist>
<parameterdescription>
<para>Size of err buffer. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>0 if valid, non-zero if invalid. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/io/tensor_map.c" line="696" column="5" bodyfile="engine/src/io/tensor_map.c" bodystart="696" bodyend="776"/>
        <references refid="structtensor__map__s_1a64c31242ffe43f6fc36b465d1ef75462" compoundref="tensor__map_8h" startline="122">tensor_map_s::count</references>
        <references refid="structtm__sort__ref__s_1a4f38ae166a16e951094d4bdc51c630a9" compoundref="tensor__map_8c" startline="677">tm_sort_ref_s::end</references>
        <references refid="structtm__sort__ref__s_1ac6b00de37e50d2f99e6935ba63dd5611" compoundref="tensor__map_8c" startline="678">tm_sort_ref_s::idx</references>
        <references refid="structtensor__map__s_1acb71d934b0da86d92eb41c1992756bfd" compoundref="tensor__map_8h" startline="124">tensor_map_s::loaded</references>
        <references refid="structtensor__desc__s_1a1134b2dbce500003f3b011f3e8a3d090" compoundref="tensor__map_8h" startline="94">tensor_desc_s::name</references>
        <references refid="structtm__sort__ref__s_1afaf93178be657b3090952279c97fc940" compoundref="tensor__map_8c" startline="676">tm_sort_ref_s::off</references>
        <references refid="structtensor__desc__s_1a0abe393a370bda31eda8ab11a5f8df37" compoundref="tensor__map_8h" startline="96">tensor_desc_s::offset</references>
        <references refid="structtensor__desc__s_1a151674f0f1ad60320437f028593d8b26" compoundref="tensor__map_8h" startline="98">tensor_desc_s::size_bytes</references>
        <references refid="tensor__map_8h_1ad887f000c7ecd66c30fb2d5cad14376d" compoundref="tensor__map_8h" startline="189" endline="211">tensor_desc_to_string</references>
        <references refid="structtensor__map__s_1a30493d1f3d1e66d1e9de6813c2844293" compoundref="tensor__map_8h" startline="120">tensor_map_s::tensors</references>
        <references refid="tensor__map_8c_1a545cca475e7c6de327d07da7515a67d1" compoundref="tensor__map_8c" startline="691" endline="694">tm_set_err</references>
        <references refid="tensor__map_8c_1a9dc54e5679c0402d5d812603754287a8" compoundref="tensor__map_8c" startline="681" endline="689">tm_sort_ref_cmp</references>
      </memberdef>
    </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">/*<sp/>============================================================================</highlight></codeline>
<codeline lineno="2"><highlight class="comment"><sp/>*<sp/>File:<sp/>engine/src/io/tensor_map.c</highlight></codeline>
<codeline lineno="3"><highlight class="comment"><sp/>*<sp/>============================================================================</highlight></codeline>
<codeline lineno="4"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="5" refid="tensor__map_8c_1a3024ccd4a9af5109d24e6c57565d74a1" refkind="member"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>_POSIX_C_SOURCE<sp/>200809L</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="tensor__map_8h" kindref="compound">tensor_map.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;ctype.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;errno.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;stdio.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;stdlib.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;string.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>=========================================================================<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Internal<sp/>helpers<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>=========================================================================<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight></codeline>
<codeline lineno="24" refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" kindref="member">skip_ws</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*p)<sp/>{</highlight></codeline>
<codeline lineno="25"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(*p<sp/>&amp;&amp;<sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;<sp/>&apos;</highlight><highlight class="normal"><sp/>||<sp/>*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\t&apos;</highlight><highlight class="normal"><sp/>||<sp/>*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\n&apos;</highlight><highlight class="normal"><sp/>||<sp/>*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\r&apos;</highlight><highlight class="normal">))<sp/>++p;</highlight></codeline>
<codeline lineno="26"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>p;</highlight></codeline>
<codeline lineno="27"><highlight class="normal">}</highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight></codeline>
<codeline lineno="35" refid="tensor__map_8c_1a9ab7221db47755779150a9cc3c374b8f" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="tensor__map_8c_1a9ab7221db47755779150a9cc3c374b8f" kindref="member">read_file</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*path,<sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>**out)<sp/>{</highlight></codeline>
<codeline lineno="36"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!path<sp/>||<sp/>!out)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="37"><highlight class="normal"></highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/>FILE<sp/>*f<sp/>=<sp/>fopen(path,<sp/></highlight><highlight class="stringliteral">&quot;rb&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!f)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="40"><highlight class="normal"></highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(fseek(f,<sp/>0,<sp/>SEEK_END)<sp/>!=<sp/>0)<sp/>{<sp/>fclose(f);<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;<sp/>}</highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>ftell(f);</highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>&lt;=<sp/>0)<sp/>{<sp/>fclose(f);<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;<sp/>}</highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(fseek(f,<sp/>0,<sp/>SEEK_SET)<sp/>!=<sp/>0)<sp/>{<sp/>fclose(f);<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;<sp/>}</highlight></codeline>
<codeline lineno="45"><highlight class="normal"></highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*buf<sp/>=<sp/>(</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*)malloc((</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal">)n<sp/>+<sp/>1u);</highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!buf)<sp/>{<sp/>fclose(f);<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;<sp/>}</highlight></codeline>
<codeline lineno="48"><highlight class="normal"></highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>got<sp/>=<sp/>fread(buf,<sp/>1,<sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal">)n,<sp/>f);</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/>fclose(f);</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(got<sp/>!=<sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal">)n)<sp/>{</highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/>free(buf);</highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="55"><highlight class="normal"></highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/>buf[n]<sp/>=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/>*out<sp/>=<sp/>buf;</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="59"><highlight class="normal">}</highlight></codeline>
<codeline lineno="60"><highlight class="normal"></highlight></codeline>
<codeline lineno="72" refid="tensor__map_8c_1a3dae92b1c084251e956a5773e53869b5" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="tensor__map_8c_1a3dae92b1c084251e956a5773e53869b5" kindref="member">parse_string</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*p,<sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>**out)<sp/>{</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!p<sp/>||<sp/>!out)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>!=<sp/></highlight><highlight class="charliteral">&apos;&quot;&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/>++p;</highlight></codeline>
<codeline lineno="76"><highlight class="normal"></highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>cap<sp/>=<sp/>64u,<sp/>len<sp/>=<sp/>0u;</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*buf<sp/>=<sp/>(</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*)malloc(cap);</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!buf)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="80"><highlight class="normal"></highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(*p)<sp/>{</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;&quot;&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>buf[len]<sp/>=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>*out<sp/>=<sp/>buf;</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>p<sp/>+<sp/>1;</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="87"><highlight class="normal"></highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\\&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>++p;</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!*p)<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Keep<sp/>escaped<sp/>char<sp/>verbatim<sp/>(sufficient<sp/>for<sp/>our<sp/>JSON).<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="93"><highlight class="normal"></highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(len<sp/>+<sp/>1u<sp/>&gt;=<sp/>cap)<sp/>{</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>cap<sp/>*=<sp/>2u;</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*nb<sp/>=<sp/>(</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*)realloc(buf,<sp/>cap);</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!nb)<sp/>{<sp/>free(buf);<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;<sp/>}</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>buf<sp/>=<sp/>nb;</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="100"><highlight class="normal"></highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/>buf[len++]<sp/>=<sp/>*p++;</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="103"><highlight class="normal"></highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/>free(buf);</highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="106"><highlight class="normal">}</highlight></codeline>
<codeline lineno="107"><highlight class="normal"></highlight></codeline>
<codeline lineno="114" refid="tensor__map_8c_1a532a65d5913530d35874854778a4b444" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="tensor__map_8c_1a532a65d5913530d35874854778a4b444" kindref="member">parse_u64</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*p,<sp/>uint64_t<sp/>*out)<sp/>{</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!p<sp/>||<sp/>!out)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/>p<sp/>=<sp/><ref refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" kindref="member">skip_ws</ref>(p);</highlight></codeline>
<codeline lineno="117"><highlight class="normal"></highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/>uint64_t<sp/>v<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!isdigit((</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">)*p))<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="120"><highlight class="normal"></highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(isdigit((</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">)*p))<sp/>{</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/>v<sp/>=<sp/>v<sp/>*<sp/>10u<sp/>+<sp/>(uint64_t)(*p<sp/>-<sp/></highlight><highlight class="charliteral">&apos;0&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/>++p;</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="125"><highlight class="normal"></highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/>*out<sp/>=<sp/>v;</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>p;</highlight></codeline>
<codeline lineno="128"><highlight class="normal">}</highlight></codeline>
<codeline lineno="129"><highlight class="normal"></highlight></codeline>
<codeline lineno="130"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="tensor__map_8c_1a751de8ccde16854a65c185afdfecfdbf" kindref="member">skip_value</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*p);</highlight></codeline>
<codeline lineno="131"><highlight class="normal"></highlight></codeline>
<codeline lineno="137" refid="tensor__map_8c_1a86c69aef66f60185ab7bfe466d7eb1d3" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="tensor__map_8c_1a86c69aef66f60185ab7bfe466d7eb1d3" kindref="member">skip_array</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*p)<sp/>{</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>!=<sp/></highlight><highlight class="charliteral">&apos;[&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/>++p;</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(;;)<sp/>{</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/>p<sp/>=<sp/><ref refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" kindref="member">skip_ws</ref>(p);</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!*p)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;]&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>p<sp/>+<sp/>1;</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/>p<sp/>=<sp/><ref refid="tensor__map_8c_1a751de8ccde16854a65c185afdfecfdbf" kindref="member">skip_value</ref>(p);</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!p)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/>p<sp/>=<sp/><ref refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" kindref="member">skip_ws</ref>(p);</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;,&apos;</highlight><highlight class="normal">)<sp/>{<sp/>++p;<sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;<sp/>}</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;]&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>p<sp/>+<sp/>1;</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="151"><highlight class="normal">}</highlight></codeline>
<codeline lineno="152"><highlight class="normal"></highlight></codeline>
<codeline lineno="158" refid="tensor__map_8c_1a9e5190012370782147588f3b3b6a4886" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="tensor__map_8c_1a9e5190012370782147588f3b3b6a4886" kindref="member">skip_object</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*p)<sp/>{</highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>!=<sp/></highlight><highlight class="charliteral">&apos;{&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/>++p;</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(;;)<sp/>{</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/>p<sp/>=<sp/><ref refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" kindref="member">skip_ws</ref>(p);</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!*p)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;}&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>p<sp/>+<sp/>1;</highlight></codeline>
<codeline lineno="165"><highlight class="normal"></highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*k<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/>p<sp/>=<sp/><ref refid="tensor__map_8c_1a3dae92b1c084251e956a5773e53869b5" kindref="member">parse_string</ref>(p,<sp/>&amp;k);</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!p)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/>free(k);</highlight></codeline>
<codeline lineno="170"><highlight class="normal"></highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/>p<sp/>=<sp/><ref refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" kindref="member">skip_ws</ref>(p);</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>!=<sp/></highlight><highlight class="charliteral">&apos;:&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/>++p;</highlight></codeline>
<codeline lineno="174"><highlight class="normal"></highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/>p<sp/>=<sp/><ref refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" kindref="member">skip_ws</ref>(p);</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/>p<sp/>=<sp/><ref refid="tensor__map_8c_1a751de8ccde16854a65c185afdfecfdbf" kindref="member">skip_value</ref>(p);</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!p)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="178"><highlight class="normal"></highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/>p<sp/>=<sp/><ref refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" kindref="member">skip_ws</ref>(p);</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;,&apos;</highlight><highlight class="normal">)<sp/>{<sp/>++p;<sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;<sp/>}</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;}&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>p<sp/>+<sp/>1;</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="184"><highlight class="normal">}</highlight></codeline>
<codeline lineno="185"><highlight class="normal"></highlight></codeline>
<codeline lineno="191" refid="tensor__map_8c_1a751de8ccde16854a65c185afdfecfdbf" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="tensor__map_8c_1a751de8ccde16854a65c185afdfecfdbf" kindref="member">skip_value</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*p)<sp/>{</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/>p<sp/>=<sp/><ref refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" kindref="member">skip_ws</ref>(p);</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!*p)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="194"><highlight class="normal"></highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;&quot;&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*tmp<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*q<sp/>=<sp/><ref refid="tensor__map_8c_1a3dae92b1c084251e956a5773e53869b5" kindref="member">parse_string</ref>(p,<sp/>&amp;tmp);</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/>free(tmp);</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>q;</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;{&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="tensor__map_8c_1a9e5190012370782147588f3b3b6a4886" kindref="member">skip_object</ref>(p);</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;[&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="tensor__map_8c_1a86c69aef66f60185ab7bfe466d7eb1d3" kindref="member">skip_array</ref>(p);</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;-&apos;</highlight><highlight class="normal"><sp/>||<sp/>isdigit((</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">)*p))<sp/>{</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/>uint64_t<sp/>dummy<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*q<sp/>=<sp/><ref refid="tensor__map_8c_1a532a65d5913530d35874854778a4b444" kindref="member">parse_u64</ref>(p,<sp/>&amp;dummy);</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>q<sp/>?<sp/>q<sp/>:<sp/>NULL;</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="208"><highlight class="normal"></highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strncmp(p,<sp/></highlight><highlight class="stringliteral">&quot;true&quot;</highlight><highlight class="normal">,<sp/>4)<sp/>==<sp/>0)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>p<sp/>+<sp/>4;</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strncmp(p,<sp/></highlight><highlight class="stringliteral">&quot;false&quot;</highlight><highlight class="normal">,<sp/>5)<sp/>==<sp/>0)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>p<sp/>+<sp/>5;</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strncmp(p,<sp/></highlight><highlight class="stringliteral">&quot;null&quot;</highlight><highlight class="normal">,<sp/>4)<sp/>==<sp/>0)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>p<sp/>+<sp/>4;</highlight></codeline>
<codeline lineno="212"><highlight class="normal"></highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="214"><highlight class="normal">}</highlight></codeline>
<codeline lineno="215"><highlight class="normal"></highlight></codeline>
<codeline lineno="216"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>=========================================================================<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="217"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>DType<sp/>parsing<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="218"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>=========================================================================<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="219"><highlight class="normal"></highlight></codeline>
<codeline lineno="225" refid="tensor__map_8c_1a16fd8cdfb13d3c08166460f7c2e6d7b2" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/><ref refid="tensor__map_8c_1a16fd8cdfb13d3c08166460f7c2e6d7b2" kindref="member">ie_tolower_ascii</ref>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>c)<sp/>{</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(c<sp/>&gt;=<sp/></highlight><highlight class="charliteral">&apos;A&apos;</highlight><highlight class="normal"><sp/>&amp;&amp;<sp/>c<sp/>&lt;=<sp/></highlight><highlight class="charliteral">&apos;Z&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">)(c<sp/>-<sp/></highlight><highlight class="charliteral">&apos;A&apos;</highlight><highlight class="normal"><sp/>+<sp/></highlight><highlight class="charliteral">&apos;a&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>c;</highlight></codeline>
<codeline lineno="228"><highlight class="normal">}</highlight></codeline>
<codeline lineno="229"><highlight class="normal"></highlight></codeline>
<codeline lineno="236" refid="tensor__map_8c_1a935215259f1e01927022c50c39b8f197" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="tensor__map_8c_1a935215259f1e01927022c50c39b8f197" kindref="member">ie_streq_case_ascii</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*a,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*b)<sp/>{</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!a<sp/>||<sp/>!b)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(*a<sp/>&amp;&amp;<sp/>*b)<sp/>{</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>ca<sp/>=<sp/><ref refid="tensor__map_8c_1a16fd8cdfb13d3c08166460f7c2e6d7b2" kindref="member">ie_tolower_ascii</ref>((</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">)*a++);</highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>cb<sp/>=<sp/><ref refid="tensor__map_8c_1a16fd8cdfb13d3c08166460f7c2e6d7b2" kindref="member">ie_tolower_ascii</ref>((</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">)*b++);</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ca<sp/>!=<sp/>cb)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(*a<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal"><sp/>&amp;&amp;<sp/>*b<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">)<sp/>?<sp/>1<sp/>:<sp/>0;</highlight></codeline>
<codeline lineno="244"><highlight class="normal">}</highlight></codeline>
<codeline lineno="245"><highlight class="normal"></highlight></codeline>
<codeline lineno="260" refid="tensor__map_8c_1a86b10318f8d32a99fd516d382b211913" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="tensor__map_8h_1ac1e5d7196426dbb29e3f26f38f4cde89" kindref="member">tensor_dtype_t</ref><sp/><ref refid="tensor__map_8c_1a86b10318f8d32a99fd516d382b211913" kindref="member">parse_dtype</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*s)<sp/>{</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!s)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="tensor__map_8h_1a2a2857711e062d6fafb189e11c772e60afc9691802827f535b2385da565e74947" kindref="member">TENSOR_DTYPE_UNKNOWN</ref>;</highlight></codeline>
<codeline lineno="262"><highlight class="normal"></highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="tensor__map_8c_1a935215259f1e01927022c50c39b8f197" kindref="member">ie_streq_case_ascii</ref>(s,<sp/></highlight><highlight class="stringliteral">&quot;float32&quot;</highlight><highlight class="normal">)<sp/>||<sp/><ref refid="tensor__map_8c_1a935215259f1e01927022c50c39b8f197" kindref="member">ie_streq_case_ascii</ref>(s,<sp/></highlight><highlight class="stringliteral">&quot;f32&quot;</highlight><highlight class="normal">)<sp/>||<sp/><ref refid="tensor__map_8c_1a935215259f1e01927022c50c39b8f197" kindref="member">ie_streq_case_ascii</ref>(s,<sp/></highlight><highlight class="stringliteral">&quot;fp32&quot;</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="tensor__map_8h_1a2a2857711e062d6fafb189e11c772e60a8be2bde5845696812a062797ff5db779" kindref="member">TENSOR_DTYPE_F32</ref>;</highlight></codeline>
<codeline lineno="265"><highlight class="normal"></highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="tensor__map_8c_1a935215259f1e01927022c50c39b8f197" kindref="member">ie_streq_case_ascii</ref>(s,<sp/></highlight><highlight class="stringliteral">&quot;float16&quot;</highlight><highlight class="normal">)<sp/>||<sp/><ref refid="tensor__map_8c_1a935215259f1e01927022c50c39b8f197" kindref="member">ie_streq_case_ascii</ref>(s,<sp/></highlight><highlight class="stringliteral">&quot;f16&quot;</highlight><highlight class="normal">)<sp/>||<sp/><ref refid="tensor__map_8c_1a935215259f1e01927022c50c39b8f197" kindref="member">ie_streq_case_ascii</ref>(s,<sp/></highlight><highlight class="stringliteral">&quot;fp16&quot;</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="tensor__map_8h_1a2a2857711e062d6fafb189e11c772e60abd617fa72c8bfbdcd703732a2a74e9fe" kindref="member">TENSOR_DTYPE_F16</ref>;</highlight></codeline>
<codeline lineno="268"><highlight class="normal"></highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="tensor__map_8c_1a935215259f1e01927022c50c39b8f197" kindref="member">ie_streq_case_ascii</ref>(s,<sp/></highlight><highlight class="stringliteral">&quot;bf16&quot;</highlight><highlight class="normal">)<sp/>||<sp/><ref refid="tensor__map_8c_1a935215259f1e01927022c50c39b8f197" kindref="member">ie_streq_case_ascii</ref>(s,<sp/></highlight><highlight class="stringliteral">&quot;bfloat16&quot;</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="tensor__map_8h_1a2a2857711e062d6fafb189e11c772e60a205d1b0175039c386b1f907101942387" kindref="member">TENSOR_DTYPE_BF16</ref>;</highlight></codeline>
<codeline lineno="271"><highlight class="normal"></highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="tensor__map_8c_1a935215259f1e01927022c50c39b8f197" kindref="member">ie_streq_case_ascii</ref>(s,<sp/></highlight><highlight class="stringliteral">&quot;u8&quot;</highlight><highlight class="normal">)<sp/>||<sp/><ref refid="tensor__map_8c_1a935215259f1e01927022c50c39b8f197" kindref="member">ie_streq_case_ascii</ref>(s,<sp/></highlight><highlight class="stringliteral">&quot;uint8&quot;</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="tensor__map_8h_1a2a2857711e062d6fafb189e11c772e60a28cbf2aeff36d35b8a7d954fb0ca333b" kindref="member">TENSOR_DTYPE_U8</ref>;</highlight></codeline>
<codeline lineno="274"><highlight class="normal"></highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="tensor__map_8c_1a935215259f1e01927022c50c39b8f197" kindref="member">ie_streq_case_ascii</ref>(s,<sp/></highlight><highlight class="stringliteral">&quot;int4&quot;</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="tensor__map_8h_1a2a2857711e062d6fafb189e11c772e60a7d14acd31ad346fe41c149dc7270d20d" kindref="member">TENSOR_DTYPE_INT4</ref>;</highlight></codeline>
<codeline lineno="277"><highlight class="normal"></highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="tensor__map_8h_1a2a2857711e062d6fafb189e11c772e60afc9691802827f535b2385da565e74947" kindref="member">TENSOR_DTYPE_UNKNOWN</ref>;</highlight></codeline>
<codeline lineno="279"><highlight class="normal">}</highlight></codeline>
<codeline lineno="280"><highlight class="normal"></highlight></codeline>
<codeline lineno="281"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>=========================================================================<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="282"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Tensor<sp/>parsing<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="283"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>=========================================================================<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="284"><highlight class="normal"></highlight></codeline>
<codeline lineno="289" refid="tensor__map_8c_1abce6e7f7fc0bc9c46436c0d41c8a72ae" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="tensor__map_8c_1abce6e7f7fc0bc9c46436c0d41c8a72ae" kindref="member">tensor_desc_zero</ref>(<ref refid="structtensor__desc__s" kindref="compound">tensor_desc_t</ref><sp/>*td)<sp/>{</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!td)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/>td-&gt;<ref refid="structtensor__desc__s_1a1134b2dbce500003f3b011f3e8a3d090" kindref="member">name</ref><sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/>td-&gt;<ref refid="structtensor__desc__s_1a0abe393a370bda31eda8ab11a5f8df37" kindref="member">offset</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/>td-&gt;<ref refid="structtensor__desc__s_1a151674f0f1ad60320437f028593d8b26" kindref="member">size_bytes</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/>td-&gt;<ref refid="structtensor__desc__s_1ab88eba5b794240beb885009efb7cd5ec" kindref="member">dtype</ref><sp/>=<sp/><ref refid="tensor__map_8h_1a2a2857711e062d6fafb189e11c772e60afc9691802827f535b2385da565e74947" kindref="member">TENSOR_DTYPE_UNKNOWN</ref>;</highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/>td-&gt;<ref refid="structtensor__desc__s_1afd3b79d2fae3209ac079b6ee551c31c7" kindref="member">shape</ref><sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/>td-&gt;<ref refid="structtensor__desc__s_1a39d73e77fad5a093361fb4d0816c7d5f" kindref="member">ndim</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="297"><highlight class="normal">}</highlight></codeline>
<codeline lineno="298"><highlight class="normal"></highlight></codeline>
<codeline lineno="303" refid="tensor__map_8c_1aa6b53de7ce006a1a2877e2b19ad8ce24" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="tensor__map_8c_1aa6b53de7ce006a1a2877e2b19ad8ce24" kindref="member">tensor_desc_free</ref>(<ref refid="structtensor__desc__s" kindref="compound">tensor_desc_t</ref><sp/>*td)<sp/>{</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!td)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/>free(td-&gt;<ref refid="structtensor__desc__s_1a1134b2dbce500003f3b011f3e8a3d090" kindref="member">name</ref>);</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/>free(td-&gt;<ref refid="structtensor__desc__s_1afd3b79d2fae3209ac079b6ee551c31c7" kindref="member">shape</ref>);</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><ref refid="tensor__map_8c_1abce6e7f7fc0bc9c46436c0d41c8a72ae" kindref="member">tensor_desc_zero</ref>(td);</highlight></codeline>
<codeline lineno="308"><highlight class="normal">}</highlight></codeline>
<codeline lineno="309"><highlight class="normal"></highlight></codeline>
<codeline lineno="318" refid="tensor__map_8c_1a87fc763c39a4a64f091406e88b1c640e" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="tensor__map_8c_1a87fc763c39a4a64f091406e88b1c640e" kindref="member">push_tensor</ref>(<ref refid="structtensor__desc__s" kindref="compound">tensor_desc_t</ref><sp/>**arr,<sp/>uint32_t<sp/>*count,<sp/>uint32_t<sp/>*cap,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structtensor__desc__s" kindref="compound">tensor_desc_t</ref><sp/>*src)<sp/>{</highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!arr<sp/>||<sp/>!count<sp/>||<sp/>!cap<sp/>||<sp/>!src)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="320"><highlight class="normal"></highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*count<sp/>==<sp/>*cap)<sp/>{</highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/><sp/><sp/>uint32_t<sp/>ncap<sp/>=<sp/>(*cap<sp/>==<sp/>0u)<sp/>?<sp/>256u<sp/>:<sp/>(*cap<sp/>*<sp/>2u);</highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structtensor__desc__s" kindref="compound">tensor_desc_t</ref><sp/>*na<sp/>=<sp/>(<ref refid="structtensor__desc__s" kindref="compound">tensor_desc_t</ref><sp/>*)realloc(*arr,<sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal">)ncap<sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="tensor__map_8h_1a1ed0f6ce08b1582103651d4fd14a30f1" kindref="member">tensor_desc_t</ref>));</highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!na)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/><sp/><sp/>*arr<sp/>=<sp/>na;</highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/>*cap<sp/>=<sp/>ncap;</highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="328"><highlight class="normal"></highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/>(*arr)[*count]<sp/>=<sp/>*src;</highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/>(*count)++;</highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="332"><highlight class="normal">}</highlight></codeline>
<codeline lineno="333"><highlight class="normal"></highlight></codeline>
<codeline lineno="341" refid="tensor__map_8c_1a018b3eeeb442114239c9d39d309af8d0" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="tensor__map_8c_1a018b3eeeb442114239c9d39d309af8d0" kindref="member">parse_shape_array</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*p,<sp/>uint32_t<sp/>**out_shape,<sp/>uint32_t<sp/>*out_ndim)<sp/>{</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!p<sp/>||<sp/>!out_shape<sp/>||<sp/>!out_ndim)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/>*out_shape<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/>*out_ndim<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="345"><highlight class="normal"></highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/>p<sp/>=<sp/><ref refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" kindref="member">skip_ws</ref>(p);</highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>!=<sp/></highlight><highlight class="charliteral">&apos;[&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/>++p;</highlight></codeline>
<codeline lineno="349"><highlight class="normal"></highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/>uint32_t<sp/>tmp[32];</highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/>uint32_t<sp/>nd<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="352"><highlight class="normal"></highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(;;)<sp/>{</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/><sp/><sp/>p<sp/>=<sp/><ref refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" kindref="member">skip_ws</ref>(p);</highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!*p)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;]&apos;</highlight><highlight class="normal">)<sp/>{<sp/>++p;<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;<sp/>}</highlight></codeline>
<codeline lineno="357"><highlight class="normal"></highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/>uint64_t<sp/>v<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*q<sp/>=<sp/><ref refid="tensor__map_8c_1a532a65d5913530d35874854778a4b444" kindref="member">parse_u64</ref>(p,<sp/>&amp;v);</highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!q)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/>p<sp/>=<sp/>q;</highlight></codeline>
<codeline lineno="362"><highlight class="normal"></highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(nd<sp/>&lt;<sp/>32u)<sp/>tmp[nd++]<sp/>=<sp/>(uint32_t)v;</highlight></codeline>
<codeline lineno="364"><highlight class="normal"></highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/>p<sp/>=<sp/><ref refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" kindref="member">skip_ws</ref>(p);</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;,&apos;</highlight><highlight class="normal">)<sp/>{<sp/>++p;<sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;<sp/>}</highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;]&apos;</highlight><highlight class="normal">)<sp/>{<sp/>++p;<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;<sp/>}</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="370"><highlight class="normal"></highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(nd<sp/>&gt;<sp/>0u)<sp/>{</highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/>uint32_t<sp/>*shape<sp/>=<sp/>(uint32_t<sp/>*)malloc((</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal">)nd<sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint32_t));</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!shape)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(shape,<sp/>tmp,<sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal">)nd<sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint32_t));</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/>*out_shape<sp/>=<sp/>shape;</highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/>*out_ndim<sp/>=<sp/>nd;</highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="378"><highlight class="normal"></highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>p;</highlight></codeline>
<codeline lineno="380"><highlight class="normal">}</highlight></codeline>
<codeline lineno="381"><highlight class="normal"></highlight></codeline>
<codeline lineno="397" refid="tensor__map_8c_1a180580870bc40b8b36b78f81a1c26178" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="tensor__map_8c_1a180580870bc40b8b36b78f81a1c26178" kindref="member">parse_tensor_object</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*p,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*map_style_name,<sp/><ref refid="structtensor__desc__s" kindref="compound">tensor_desc_t</ref><sp/>*td,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*out_ok)<sp/>{</highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!p<sp/>||<sp/>!td<sp/>||<sp/>!out_ok)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/>*out_ok<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="400"><highlight class="normal"></highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/>p<sp/>=<sp/><ref refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" kindref="member">skip_ws</ref>(p);</highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>!=<sp/></highlight><highlight class="charliteral">&apos;{&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/>++p;</highlight></codeline>
<codeline lineno="404"><highlight class="normal"></highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/><ref refid="tensor__map_8c_1abce6e7f7fc0bc9c46436c0d41c8a72ae" kindref="member">tensor_desc_zero</ref>(td);</highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(map_style_name)<sp/>{</highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/><sp/><sp/>td-&gt;<ref refid="structtensor__desc__s_1a1134b2dbce500003f3b011f3e8a3d090" kindref="member">name</ref><sp/>=<sp/>(</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*)malloc(strlen(map_style_name)<sp/>+<sp/>1u);</highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!td-&gt;<ref refid="structtensor__desc__s_1a1134b2dbce500003f3b011f3e8a3d090" kindref="member">name</ref>)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(td-&gt;<ref refid="structtensor__desc__s_1a1134b2dbce500003f3b011f3e8a3d090" kindref="member">name</ref>,<sp/>map_style_name,<sp/>strlen(map_style_name)<sp/>+<sp/>1u);</highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="411"><highlight class="normal"></highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(;;)<sp/>{</highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/>p<sp/>=<sp/><ref refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" kindref="member">skip_ws</ref>(p);</highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!*p)<sp/>{<sp/><ref refid="tensor__map_8c_1aa6b53de7ce006a1a2877e2b19ad8ce24" kindref="member">tensor_desc_free</ref>(td);<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;<sp/>}</highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;}&apos;</highlight><highlight class="normal">)<sp/>{<sp/>++p;<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;<sp/>}</highlight></codeline>
<codeline lineno="416"><highlight class="normal"></highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*key<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/>p<sp/>=<sp/><ref refid="tensor__map_8c_1a3dae92b1c084251e956a5773e53869b5" kindref="member">parse_string</ref>(p,<sp/>&amp;key);</highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!p)<sp/>{<sp/><ref refid="tensor__map_8c_1aa6b53de7ce006a1a2877e2b19ad8ce24" kindref="member">tensor_desc_free</ref>(td);<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;<sp/>}</highlight></codeline>
<codeline lineno="420"><highlight class="normal"></highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/><sp/><sp/>p<sp/>=<sp/><ref refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" kindref="member">skip_ws</ref>(p);</highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>!=<sp/></highlight><highlight class="charliteral">&apos;:&apos;</highlight><highlight class="normal">)<sp/>{<sp/>free(key);<sp/><ref refid="tensor__map_8c_1aa6b53de7ce006a1a2877e2b19ad8ce24" kindref="member">tensor_desc_free</ref>(td);<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;<sp/>}</highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/><sp/><sp/>++p;</highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/>p<sp/>=<sp/><ref refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" kindref="member">skip_ws</ref>(p);</highlight></codeline>
<codeline lineno="425"><highlight class="normal"></highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strcmp(key,<sp/></highlight><highlight class="stringliteral">&quot;name&quot;</highlight><highlight class="normal">)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*nm<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*q<sp/>=<sp/><ref refid="tensor__map_8c_1a3dae92b1c084251e956a5773e53869b5" kindref="member">parse_string</ref>(p,<sp/>&amp;nm);</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!q)<sp/>{<sp/>free(key);<sp/><ref refid="tensor__map_8c_1aa6b53de7ce006a1a2877e2b19ad8ce24" kindref="member">tensor_desc_free</ref>(td);<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;<sp/>}</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>p<sp/>=<sp/>q;</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!td-&gt;<ref refid="structtensor__desc__s_1a1134b2dbce500003f3b011f3e8a3d090" kindref="member">name</ref>)<sp/>{</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>td-&gt;<ref refid="structtensor__desc__s_1a1134b2dbce500003f3b011f3e8a3d090" kindref="member">name</ref><sp/>=<sp/>nm;</highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(nm);</highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strcmp(key,<sp/></highlight><highlight class="stringliteral">&quot;offset&quot;</highlight><highlight class="normal">)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*q<sp/>=<sp/><ref refid="tensor__map_8c_1a532a65d5913530d35874854778a4b444" kindref="member">parse_u64</ref>(p,<sp/>&amp;td-&gt;<ref refid="structtensor__desc__s_1a0abe393a370bda31eda8ab11a5f8df37" kindref="member">offset</ref>);</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!q)<sp/>{<sp/>free(key);<sp/><ref refid="tensor__map_8c_1aa6b53de7ce006a1a2877e2b19ad8ce24" kindref="member">tensor_desc_free</ref>(td);<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;<sp/>}</highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>p<sp/>=<sp/>q;</highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strcmp(key,<sp/></highlight><highlight class="stringliteral">&quot;size_bytes&quot;</highlight><highlight class="normal">)<sp/>==<sp/>0<sp/>||<sp/>strcmp(key,<sp/></highlight><highlight class="stringliteral">&quot;nbytes&quot;</highlight><highlight class="normal">)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*q<sp/>=<sp/><ref refid="tensor__map_8c_1a532a65d5913530d35874854778a4b444" kindref="member">parse_u64</ref>(p,<sp/>&amp;td-&gt;<ref refid="structtensor__desc__s_1a151674f0f1ad60320437f028593d8b26" kindref="member">size_bytes</ref>);</highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!q)<sp/>{<sp/>free(key);<sp/><ref refid="tensor__map_8c_1aa6b53de7ce006a1a2877e2b19ad8ce24" kindref="member">tensor_desc_free</ref>(td);<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;<sp/>}</highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>p<sp/>=<sp/>q;</highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strcmp(key,<sp/></highlight><highlight class="stringliteral">&quot;dtype&quot;</highlight><highlight class="normal">)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="445"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*ds<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*q<sp/>=<sp/><ref refid="tensor__map_8c_1a3dae92b1c084251e956a5773e53869b5" kindref="member">parse_string</ref>(p,<sp/>&amp;ds);</highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!q)<sp/>{<sp/>free(key);<sp/><ref refid="tensor__map_8c_1aa6b53de7ce006a1a2877e2b19ad8ce24" kindref="member">tensor_desc_free</ref>(td);<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;<sp/>}</highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>p<sp/>=<sp/>q;</highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>td-&gt;<ref refid="structtensor__desc__s_1ab88eba5b794240beb885009efb7cd5ec" kindref="member">dtype</ref><sp/>=<sp/><ref refid="tensor__map_8c_1a86b10318f8d32a99fd516d382b211913" kindref="member">parse_dtype</ref>(ds);</highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>free(ds);</highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strcmp(key,<sp/></highlight><highlight class="stringliteral">&quot;shape&quot;</highlight><highlight class="normal">)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>uint32_t<sp/>*shape<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>uint32_t<sp/>ndim<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*q<sp/>=<sp/><ref refid="tensor__map_8c_1a018b3eeeb442114239c9d39d309af8d0" kindref="member">parse_shape_array</ref>(p,<sp/>&amp;shape,<sp/>&amp;ndim);</highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!q)<sp/>{<sp/>free(key);<sp/><ref refid="tensor__map_8c_1aa6b53de7ce006a1a2877e2b19ad8ce24" kindref="member">tensor_desc_free</ref>(td);<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;<sp/>}</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>p<sp/>=<sp/>q;</highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>td-&gt;<ref refid="structtensor__desc__s_1afd3b79d2fae3209ac079b6ee551c31c7" kindref="member">shape</ref><sp/>=<sp/>shape;</highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>td-&gt;<ref refid="structtensor__desc__s_1a39d73e77fad5a093361fb4d0816c7d5f" kindref="member">ndim</ref><sp/>=<sp/>ndim;</highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*q<sp/>=<sp/><ref refid="tensor__map_8c_1a751de8ccde16854a65c185afdfecfdbf" kindref="member">skip_value</ref>(p);</highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!q)<sp/>{<sp/>free(key);<sp/><ref refid="tensor__map_8c_1aa6b53de7ce006a1a2877e2b19ad8ce24" kindref="member">tensor_desc_free</ref>(td);<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;<sp/>}</highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>p<sp/>=<sp/>q;</highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="464"><highlight class="normal"></highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/>free(key);</highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/>p<sp/>=<sp/><ref refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" kindref="member">skip_ws</ref>(p);</highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;,&apos;</highlight><highlight class="normal">)<sp/>{<sp/>++p;<sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;<sp/>}</highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;}&apos;</highlight><highlight class="normal">)<sp/>{<sp/>++p;<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;<sp/>}</highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="470"><highlight class="normal"></highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!td-&gt;<ref refid="structtensor__desc__s_1a1134b2dbce500003f3b011f3e8a3d090" kindref="member">name</ref>)<sp/>{</highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="tensor__map_8c_1aa6b53de7ce006a1a2877e2b19ad8ce24" kindref="member">tensor_desc_free</ref>(td);</highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="475"><highlight class="normal"></highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/>*out_ok<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>p;</highlight></codeline>
<codeline lineno="478"><highlight class="normal">}</highlight></codeline>
<codeline lineno="479"><highlight class="normal"></highlight></codeline>
<codeline lineno="480"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>=========================================================================<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="481"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Public<sp/>API<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="482"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>=========================================================================<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="483"><highlight class="normal"></highlight></codeline>
<codeline lineno="484" refid="tensor__map_8h_1ac4b913e2710929070b5b073b4b67b24c" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="tensor__map_8c_1ac4b913e2710929070b5b073b4b67b24c" kindref="member">tensor_map_load</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*path,<sp/><ref refid="structtensor__map__s" kindref="compound">tensor_map_t</ref><sp/>*out)<sp/>{</highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!path<sp/>||<sp/>!out)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/>memset(out,<sp/>0,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(*out));</highlight></codeline>
<codeline lineno="487"><highlight class="normal"></highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*json<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="tensor__map_8c_1a9ab7221db47755779150a9cc3c374b8f" kindref="member">read_file</ref>(path,<sp/>&amp;json)<sp/>!=<sp/>0)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="490"><highlight class="normal"></highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*p<sp/>=<sp/><ref refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" kindref="member">skip_ws</ref>(json);</highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!*p)<sp/>{<sp/>free(json);<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;<sp/>}</highlight></codeline>
<codeline lineno="493"><highlight class="normal"></highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><ref refid="structtensor__desc__s" kindref="compound">tensor_desc_t</ref><sp/>*arr<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/>uint32_t<sp/>count<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/>uint32_t<sp/>cap<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="497"><highlight class="normal"></highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;[&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/>++p;</highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(;;)<sp/>{</highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>p<sp/>=<sp/><ref refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" kindref="member">skip_ws</ref>(p);</highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!*p)<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;]&apos;</highlight><highlight class="normal">)<sp/>{<sp/>++p;<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;<sp/>}</highlight></codeline>
<codeline lineno="504"><highlight class="normal"></highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>!=<sp/></highlight><highlight class="charliteral">&apos;{&apos;</highlight><highlight class="normal">)<sp/>{<sp/>p<sp/>=<sp/><ref refid="tensor__map_8c_1a751de8ccde16854a65c185afdfecfdbf" kindref="member">skip_value</ref>(p);<sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!p)<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;<sp/>}</highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structtensor__desc__s" kindref="compound">tensor_desc_t</ref><sp/>td;</highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ok<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*q<sp/>=<sp/><ref refid="tensor__map_8c_1a180580870bc40b8b36b78f81a1c26178" kindref="member">parse_tensor_object</ref>(p,<sp/>NULL,<sp/>&amp;td,<sp/>&amp;ok);</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!q<sp/>||<sp/>!ok)<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p<sp/>=<sp/>q;</highlight></codeline>
<codeline lineno="512"><highlight class="normal"></highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="tensor__map_8c_1a87fc763c39a4a64f091406e88b1c640e" kindref="member">push_tensor</ref>(&amp;arr,<sp/>&amp;count,<sp/>&amp;cap,<sp/>&amp;td)<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="tensor__map_8c_1aa6b53de7ce006a1a2877e2b19ad8ce24" kindref="member">tensor_desc_free</ref>(&amp;td);</highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="518"><highlight class="normal"></highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>p<sp/>=<sp/><ref refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" kindref="member">skip_ws</ref>(p);</highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;,&apos;</highlight><highlight class="normal">)<sp/>{<sp/>++p;<sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;<sp/>}</highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;]&apos;</highlight><highlight class="normal">)<sp/>{<sp/>++p;<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;<sp/>}</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;{&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/>++p;</highlight></codeline>
<codeline lineno="525"><highlight class="normal"></highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>found_tensors_array<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="527"><highlight class="normal"></highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*scan<sp/>=<sp/>p;</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(*scan)<sp/>{</highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>scan<sp/>=<sp/><ref refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" kindref="member">skip_ws</ref>(scan);</highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*scan<sp/>==<sp/></highlight><highlight class="charliteral">&apos;}&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*scan<sp/>!=<sp/></highlight><highlight class="charliteral">&apos;&quot;&apos;</highlight><highlight class="normal">)<sp/>{<sp/>++scan;<sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;<sp/>}</highlight></codeline>
<codeline lineno="533"><highlight class="normal"></highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*key<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*qk<sp/>=<sp/><ref refid="tensor__map_8c_1a3dae92b1c084251e956a5773e53869b5" kindref="member">parse_string</ref>(scan,<sp/>&amp;key);</highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!qk)<sp/>{<sp/>free(key);<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;<sp/>}</highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>scan<sp/>=<sp/><ref refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" kindref="member">skip_ws</ref>(qk);</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*scan<sp/>!=<sp/></highlight><highlight class="charliteral">&apos;:&apos;</highlight><highlight class="normal">)<sp/>{<sp/>free(key);<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;<sp/>}</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>++scan;</highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>scan<sp/>=<sp/><ref refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" kindref="member">skip_ws</ref>(scan);</highlight></codeline>
<codeline lineno="541"><highlight class="normal"></highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(key<sp/>&amp;&amp;<sp/>strcmp(key,<sp/></highlight><highlight class="stringliteral">&quot;tensors&quot;</highlight><highlight class="normal">)<sp/>==<sp/>0<sp/>&amp;&amp;<sp/>*scan<sp/>==<sp/></highlight><highlight class="charliteral">&apos;[&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>found_tensors_array<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="544"><highlight class="normal"></highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>++scan;</highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(;;)<sp/>{</highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>scan<sp/>=<sp/><ref refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" kindref="member">skip_ws</ref>(scan);</highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!*scan)<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*scan<sp/>==<sp/></highlight><highlight class="charliteral">&apos;]&apos;</highlight><highlight class="normal">)<sp/>{<sp/>++scan;<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;<sp/>}</highlight></codeline>
<codeline lineno="550"><highlight class="normal"></highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*scan<sp/>!=<sp/></highlight><highlight class="charliteral">&apos;{&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>scan<sp/>=<sp/><ref refid="tensor__map_8c_1a751de8ccde16854a65c185afdfecfdbf" kindref="member">skip_value</ref>(scan);</highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!scan)<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structtensor__desc__s" kindref="compound">tensor_desc_t</ref><sp/>td;</highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ok<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*qt<sp/>=<sp/><ref refid="tensor__map_8c_1a180580870bc40b8b36b78f81a1c26178" kindref="member">parse_tensor_object</ref>(scan,<sp/>NULL,<sp/>&amp;td,<sp/>&amp;ok);</highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!qt<sp/>||<sp/>!ok)<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>scan<sp/>=<sp/>qt;</highlight></codeline>
<codeline lineno="560"><highlight class="normal"></highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="tensor__map_8c_1a87fc763c39a4a64f091406e88b1c640e" kindref="member">push_tensor</ref>(&amp;arr,<sp/>&amp;count,<sp/>&amp;cap,<sp/>&amp;td)<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="tensor__map_8c_1aa6b53de7ce006a1a2877e2b19ad8ce24" kindref="member">tensor_desc_free</ref>(&amp;td);</highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="566"><highlight class="normal"></highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>scan<sp/>=<sp/><ref refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" kindref="member">skip_ws</ref>(scan);</highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*scan<sp/>==<sp/></highlight><highlight class="charliteral">&apos;,&apos;</highlight><highlight class="normal">)<sp/>{<sp/>++scan;<sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;<sp/>}</highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*scan<sp/>==<sp/></highlight><highlight class="charliteral">&apos;]&apos;</highlight><highlight class="normal">)<sp/>{<sp/>++scan;<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;<sp/>}</highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="571"><highlight class="normal"></highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(key);</highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="575"><highlight class="normal"></highlight></codeline>
<codeline lineno="576"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*scan<sp/>==<sp/></highlight><highlight class="charliteral">&apos;{&apos;</highlight><highlight class="normal">)<sp/>scan<sp/>=<sp/><ref refid="tensor__map_8c_1a9e5190012370782147588f3b3b6a4886" kindref="member">skip_object</ref>(scan);</highlight></codeline>
<codeline lineno="577"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*scan<sp/>==<sp/></highlight><highlight class="charliteral">&apos;[&apos;</highlight><highlight class="normal">)<sp/>scan<sp/>=<sp/><ref refid="tensor__map_8c_1a86c69aef66f60185ab7bfe466d7eb1d3" kindref="member">skip_array</ref>(scan);</highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>scan<sp/>=<sp/><ref refid="tensor__map_8c_1a751de8ccde16854a65c185afdfecfdbf" kindref="member">skip_value</ref>(scan);</highlight></codeline>
<codeline lineno="579"><highlight class="normal"></highlight></codeline>
<codeline lineno="580"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>free(key);</highlight></codeline>
<codeline lineno="581"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!scan)<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="582"><highlight class="normal"></highlight></codeline>
<codeline lineno="583"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>scan<sp/>=<sp/><ref refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" kindref="member">skip_ws</ref>(scan);</highlight></codeline>
<codeline lineno="584"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*scan<sp/>==<sp/></highlight><highlight class="charliteral">&apos;,&apos;</highlight><highlight class="normal">)<sp/>++scan;</highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="586"><highlight class="normal"></highlight></codeline>
<codeline lineno="587"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!found_tensors_array)<sp/>{</highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(*p)<sp/>{</highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p<sp/>=<sp/><ref refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" kindref="member">skip_ws</ref>(p);</highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!*p)<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;}&apos;</highlight><highlight class="normal">)<sp/>{<sp/>++p;<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;<sp/>}</highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;,&apos;</highlight><highlight class="normal">)<sp/>{<sp/>++p;<sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;<sp/>}</highlight></codeline>
<codeline lineno="593"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>!=<sp/></highlight><highlight class="charliteral">&apos;&quot;&apos;</highlight><highlight class="normal">)<sp/>{<sp/>p<sp/>=<sp/><ref refid="tensor__map_8c_1a751de8ccde16854a65c185afdfecfdbf" kindref="member">skip_value</ref>(p);<sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!p)<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;<sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;<sp/>}</highlight></codeline>
<codeline lineno="594"><highlight class="normal"></highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*name<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="596"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p<sp/>=<sp/><ref refid="tensor__map_8c_1a3dae92b1c084251e956a5773e53869b5" kindref="member">parse_string</ref>(p,<sp/>&amp;name);</highlight></codeline>
<codeline lineno="597"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!p)<sp/>{<sp/>free(name);<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;<sp/>}</highlight></codeline>
<codeline lineno="598"><highlight class="normal"></highlight></codeline>
<codeline lineno="599"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p<sp/>=<sp/><ref refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" kindref="member">skip_ws</ref>(p);</highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>!=<sp/></highlight><highlight class="charliteral">&apos;:&apos;</highlight><highlight class="normal">)<sp/>{<sp/>free(name);<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;<sp/>}</highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>++p;</highlight></codeline>
<codeline lineno="602"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p<sp/>=<sp/><ref refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" kindref="member">skip_ws</ref>(p);</highlight></codeline>
<codeline lineno="603"><highlight class="normal"></highlight></codeline>
<codeline lineno="604"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;{&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="605"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structtensor__desc__s" kindref="compound">tensor_desc_t</ref><sp/>td;</highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ok<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="607"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*q<sp/>=<sp/><ref refid="tensor__map_8c_1a180580870bc40b8b36b78f81a1c26178" kindref="member">parse_tensor_object</ref>(p,<sp/>name,<sp/>&amp;td,<sp/>&amp;ok);</highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!q<sp/>||<sp/>!ok)<sp/>{<sp/>free(name);<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;<sp/>}</highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p<sp/>=<sp/>q;</highlight></codeline>
<codeline lineno="610"><highlight class="normal"></highlight></codeline>
<codeline lineno="611"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="tensor__map_8c_1a87fc763c39a4a64f091406e88b1c640e" kindref="member">push_tensor</ref>(&amp;arr,<sp/>&amp;count,<sp/>&amp;cap,<sp/>&amp;td)<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="tensor__map_8c_1aa6b53de7ce006a1a2877e2b19ad8ce24" kindref="member">tensor_desc_free</ref>(&amp;td);</highlight></codeline>
<codeline lineno="613"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(name);</highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="615"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p<sp/>=<sp/><ref refid="tensor__map_8c_1a751de8ccde16854a65c185afdfecfdbf" kindref="member">skip_value</ref>(p);</highlight></codeline>
<codeline lineno="618"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(name);</highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!p)<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="620"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="621"><highlight class="normal"></highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(name);</highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p<sp/>=<sp/><ref refid="tensor__map_8c_1ae19e0ad12742fe7fdff22f60436aadc7" kindref="member">skip_ws</ref>(p);</highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;,&apos;</highlight><highlight class="normal">)<sp/>++p;</highlight></codeline>
<codeline lineno="625"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="626"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="628"><highlight class="normal"><sp/><sp/><sp/><sp/>free(json);</highlight></codeline>
<codeline lineno="629"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="631"><highlight class="normal"></highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/>free(json);</highlight></codeline>
<codeline lineno="633"><highlight class="normal"></highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!arr<sp/>||<sp/>count<sp/>==<sp/>0u)<sp/>{</highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><sp/><sp/>free(arr);</highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="638"><highlight class="normal"></highlight></codeline>
<codeline lineno="639"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(cap<sp/>&gt;<sp/>count)<sp/>{</highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structtensor__desc__s" kindref="compound">tensor_desc_t</ref><sp/>*na<sp/>=<sp/>(<ref refid="structtensor__desc__s" kindref="compound">tensor_desc_t</ref><sp/>*)realloc(arr,<sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal">)count<sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="tensor__map_8h_1a1ed0f6ce08b1582103651d4fd14a30f1" kindref="member">tensor_desc_t</ref>));</highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(na)<sp/>arr<sp/>=<sp/>na;</highlight></codeline>
<codeline lineno="642"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="643"><highlight class="normal"></highlight></codeline>
<codeline lineno="644"><highlight class="normal"><sp/><sp/>out-&gt;tensors<sp/>=<sp/>arr;</highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/>out-&gt;count<sp/>=<sp/>count;</highlight></codeline>
<codeline lineno="646"><highlight class="normal"><sp/><sp/>out-&gt;loaded<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="648"><highlight class="normal">}</highlight></codeline>
<codeline lineno="649"><highlight class="normal"></highlight></codeline>
<codeline lineno="650" refid="tensor__map_8h_1a42d154b3f93b07c41b514e468a61c803" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="tensor__map_8c_1a42d154b3f93b07c41b514e468a61c803" kindref="member">tensor_map_free</ref>(<ref refid="structtensor__map__s" kindref="compound">tensor_map_t</ref><sp/>*map)<sp/>{</highlight></codeline>
<codeline lineno="651"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!map<sp/>||<sp/>!map-&gt;<ref refid="structtensor__map__s_1a30493d1f3d1e66d1e9de6813c2844293" kindref="member">tensors</ref>)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="652"><highlight class="normal"></highlight></codeline>
<codeline lineno="653"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(uint32_t<sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>map-&gt;<ref refid="structtensor__map__s_1a64c31242ffe43f6fc36b465d1ef75462" kindref="member">count</ref>;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="654"><highlight class="normal"><sp/><sp/><sp/><sp/>free(map-&gt;<ref refid="structtensor__map__s_1a30493d1f3d1e66d1e9de6813c2844293" kindref="member">tensors</ref>[i].<ref refid="structtensor__desc__s_1a1134b2dbce500003f3b011f3e8a3d090" kindref="member">name</ref>);</highlight></codeline>
<codeline lineno="655"><highlight class="normal"><sp/><sp/><sp/><sp/>free(map-&gt;<ref refid="structtensor__map__s_1a30493d1f3d1e66d1e9de6813c2844293" kindref="member">tensors</ref>[i].<ref refid="structtensor__desc__s_1afd3b79d2fae3209ac079b6ee551c31c7" kindref="member">shape</ref>);</highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="657"><highlight class="normal"></highlight></codeline>
<codeline lineno="658"><highlight class="normal"><sp/><sp/>free(map-&gt;<ref refid="structtensor__map__s_1a30493d1f3d1e66d1e9de6813c2844293" kindref="member">tensors</ref>);</highlight></codeline>
<codeline lineno="659"><highlight class="normal"><sp/><sp/>memset(map,<sp/>0,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(*map));</highlight></codeline>
<codeline lineno="660"><highlight class="normal">}</highlight></codeline>
<codeline lineno="661"><highlight class="normal"></highlight></codeline>
<codeline lineno="662" refid="tensor__map_8h_1abe58b80593931ffe5844ee4bcee805c5" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structtensor__desc__s" kindref="compound">tensor_desc_t</ref><sp/>*<ref refid="tensor__map_8c_1abe58b80593931ffe5844ee4bcee805c5" kindref="member">tensor_map_find</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structtensor__map__s" kindref="compound">tensor_map_t</ref><sp/>*map,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*name)<sp/>{</highlight></codeline>
<codeline lineno="663"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!map<sp/>||<sp/>!map-&gt;<ref refid="structtensor__map__s_1acb71d934b0da86d92eb41c1992756bfd" kindref="member">loaded</ref><sp/>||<sp/>!name)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="664"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(uint32_t<sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>map-&gt;<ref refid="structtensor__map__s_1a64c31242ffe43f6fc36b465d1ef75462" kindref="member">count</ref>;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="665"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(map-&gt;<ref refid="structtensor__map__s_1a30493d1f3d1e66d1e9de6813c2844293" kindref="member">tensors</ref>[i].<ref refid="structtensor__desc__s_1a1134b2dbce500003f3b011f3e8a3d090" kindref="member">name</ref><sp/>&amp;&amp;<sp/>strcmp(map-&gt;<ref refid="structtensor__map__s_1a30493d1f3d1e66d1e9de6813c2844293" kindref="member">tensors</ref>[i].<ref refid="structtensor__desc__s_1a1134b2dbce500003f3b011f3e8a3d090" kindref="member">name</ref>,<sp/>name)<sp/>==<sp/>0)</highlight></codeline>
<codeline lineno="666"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>&amp;map-&gt;<ref refid="structtensor__map__s_1a30493d1f3d1e66d1e9de6813c2844293" kindref="member">tensors</ref>[i];</highlight></codeline>
<codeline lineno="667"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="668"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="669"><highlight class="normal">}</highlight></codeline>
<codeline lineno="670"><highlight class="normal"></highlight></codeline>
<codeline lineno="671"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>=========================================================================<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="672"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Validation<sp/>(hard<sp/>tensor_map<sp/><sp/>bin<sp/>consistency<sp/>check)<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="673"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>=========================================================================<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="674"><highlight class="normal"></highlight></codeline>
<codeline lineno="675" refid="structtm__sort__ref__s" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structtm__sort__ref__s" kindref="compound">tm_sort_ref_s</ref><sp/>{</highlight></codeline>
<codeline lineno="676" refid="structtm__sort__ref__s_1afaf93178be657b3090952279c97fc940" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="structtm__sort__ref__s_1afaf93178be657b3090952279c97fc940" kindref="member">uint64_t</ref><sp/><ref refid="structtm__sort__ref__s_1afaf93178be657b3090952279c97fc940" kindref="member">off</ref>;</highlight></codeline>
<codeline lineno="677" refid="structtm__sort__ref__s_1a4f38ae166a16e951094d4bdc51c630a9" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="structtm__sort__ref__s_1afaf93178be657b3090952279c97fc940" kindref="member">uint64_t</ref><sp/><ref refid="structtm__sort__ref__s_1a4f38ae166a16e951094d4bdc51c630a9" kindref="member">end</ref>;</highlight></codeline>
<codeline lineno="678" refid="structtm__sort__ref__s_1ac6b00de37e50d2f99e6935ba63dd5611" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="structtm__sort__ref__s_1afaf93178be657b3090952279c97fc940" kindref="member">uint32_t</ref><sp/><ref refid="structtm__sort__ref__s_1ac6b00de37e50d2f99e6935ba63dd5611" kindref="member">idx</ref>;</highlight></codeline>
<codeline lineno="679" refid="tensor__map_8c_1a9e71207990621a1e9a86b6c61a93fbbc" refkind="member"><highlight class="normal">}<sp/><ref refid="tensor__map_8c_1a9e71207990621a1e9a86b6c61a93fbbc" kindref="member">tm_sort_ref_t</ref>;</highlight></codeline>
<codeline lineno="680"><highlight class="normal"></highlight></codeline>
<codeline lineno="681" refid="tensor__map_8c_1a9dc54e5679c0402d5d812603754287a8" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="tensor__map_8c_1a9dc54e5679c0402d5d812603754287a8" kindref="member">tm_sort_ref_cmp</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*a,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*b)<sp/>{</highlight></codeline>
<codeline lineno="682"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structtm__sort__ref__s" kindref="compound">tm_sort_ref_t</ref><sp/>*A<sp/>=<sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structtm__sort__ref__s" kindref="compound">tm_sort_ref_t</ref><sp/>*)a;</highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structtm__sort__ref__s" kindref="compound">tm_sort_ref_t</ref><sp/>*B<sp/>=<sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structtm__sort__ref__s" kindref="compound">tm_sort_ref_t</ref><sp/>*)b;</highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(A-&gt;<ref refid="structtm__sort__ref__s_1afaf93178be657b3090952279c97fc940" kindref="member">off</ref><sp/>&lt;<sp/>B-&gt;<ref refid="structtm__sort__ref__s_1afaf93178be657b3090952279c97fc940" kindref="member">off</ref>)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(A-&gt;<ref refid="structtm__sort__ref__s_1afaf93178be657b3090952279c97fc940" kindref="member">off</ref><sp/>&gt;<sp/>B-&gt;<ref refid="structtm__sort__ref__s_1afaf93178be657b3090952279c97fc940" kindref="member">off</ref>)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="686"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(A-&gt;<ref refid="structtm__sort__ref__s_1a4f38ae166a16e951094d4bdc51c630a9" kindref="member">end</ref><sp/>&lt;<sp/>B-&gt;<ref refid="structtm__sort__ref__s_1a4f38ae166a16e951094d4bdc51c630a9" kindref="member">end</ref>)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(A-&gt;<ref refid="structtm__sort__ref__s_1a4f38ae166a16e951094d4bdc51c630a9" kindref="member">end</ref><sp/>&gt;<sp/>B-&gt;<ref refid="structtm__sort__ref__s_1a4f38ae166a16e951094d4bdc51c630a9" kindref="member">end</ref>)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="689"><highlight class="normal">}</highlight></codeline>
<codeline lineno="690"><highlight class="normal"></highlight></codeline>
<codeline lineno="691" refid="tensor__map_8c_1a545cca475e7c6de327d07da7515a67d1" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="tensor__map_8c_1a545cca475e7c6de327d07da7515a67d1" kindref="member">tm_set_err</ref>(</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*err,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>errsz,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*msg)<sp/>{</highlight></codeline>
<codeline lineno="692"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!err<sp/>||<sp/>errsz<sp/>==<sp/>0u)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="693"><highlight class="normal"><sp/><sp/>(void)snprintf(err,<sp/>errsz,<sp/></highlight><highlight class="stringliteral">&quot;%s&quot;</highlight><highlight class="normal">,<sp/>msg<sp/>?<sp/>msg<sp/>:<sp/></highlight><highlight class="stringliteral">&quot;unknown<sp/>error&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="694"><highlight class="normal">}</highlight></codeline>
<codeline lineno="695"><highlight class="normal"></highlight></codeline>
<codeline lineno="696" refid="tensor__map_8h_1ad5a6d86e99a96405eb2d6daf95603691" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="tensor__map_8c_1ad5a6d86e99a96405eb2d6daf95603691" kindref="member">tensor_map_validate_against_bin</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structtensor__map__s" kindref="compound">tensor_map_t</ref><sp/>*map,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>bin_size,<sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*err,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>errsz)<sp/>{</highlight></codeline>
<codeline lineno="697"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!map<sp/>||<sp/>!map-&gt;<ref refid="structtensor__map__s_1acb71d934b0da86d92eb41c1992756bfd" kindref="member">loaded</ref><sp/>||<sp/>!map-&gt;<ref refid="structtensor__map__s_1a30493d1f3d1e66d1e9de6813c2844293" kindref="member">tensors</ref><sp/>||<sp/>map-&gt;<ref refid="structtensor__map__s_1a64c31242ffe43f6fc36b465d1ef75462" kindref="member">count</ref><sp/>==<sp/>0u)<sp/>{</highlight></codeline>
<codeline lineno="698"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="tensor__map_8c_1a545cca475e7c6de327d07da7515a67d1" kindref="member">tm_set_err</ref>(err,<sp/>errsz,<sp/></highlight><highlight class="stringliteral">&quot;tensor_map<sp/>not<sp/>loaded&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="700"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="701"><highlight class="normal"></highlight></codeline>
<codeline lineno="702"><highlight class="normal"><sp/><sp/><ref refid="structtm__sort__ref__s" kindref="compound">tm_sort_ref_t</ref><sp/>*refs<sp/>=<sp/>(<ref refid="structtm__sort__ref__s" kindref="compound">tm_sort_ref_t</ref><sp/>*)malloc((</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal">)map-&gt;<ref refid="structtensor__map__s_1a64c31242ffe43f6fc36b465d1ef75462" kindref="member">count</ref><sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(*refs));</highlight></codeline>
<codeline lineno="703"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!refs)<sp/>{</highlight></codeline>
<codeline lineno="704"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="tensor__map_8c_1a545cca475e7c6de327d07da7515a67d1" kindref="member">tm_set_err</ref>(err,<sp/>errsz,<sp/></highlight><highlight class="stringliteral">&quot;OOM<sp/>allocating<sp/>validation<sp/>refs&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="705"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-2;</highlight></codeline>
<codeline lineno="706"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="707"><highlight class="normal"></highlight></codeline>
<codeline lineno="708"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(uint32_t<sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>map-&gt;<ref refid="structtensor__map__s_1a64c31242ffe43f6fc36b465d1ef75462" kindref="member">count</ref>;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structtensor__desc__s" kindref="compound">tensor_desc_t</ref><sp/>*td<sp/>=<sp/>&amp;map-&gt;<ref refid="structtensor__map__s_1a30493d1f3d1e66d1e9de6813c2844293" kindref="member">tensors</ref>[i];</highlight></codeline>
<codeline lineno="710"><highlight class="normal"></highlight></codeline>
<codeline lineno="711"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!td-&gt;<ref refid="structtensor__desc__s_1a1134b2dbce500003f3b011f3e8a3d090" kindref="member">name</ref><sp/>||<sp/>td-&gt;<ref refid="structtensor__desc__s_1a1134b2dbce500003f3b011f3e8a3d090" kindref="member">name</ref>[0]<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="712"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="tensor__map_8c_1a545cca475e7c6de327d07da7515a67d1" kindref="member">tm_set_err</ref>(err,<sp/>errsz,<sp/></highlight><highlight class="stringliteral">&quot;tensor_map<sp/>contains<sp/>entry<sp/>with<sp/>empty<sp/>name&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="713"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>free(refs);</highlight></codeline>
<codeline lineno="714"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-3;</highlight></codeline>
<codeline lineno="715"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(td-&gt;<ref refid="structtensor__desc__s_1a151674f0f1ad60320437f028593d8b26" kindref="member">size_bytes</ref><sp/>==<sp/>0u)<sp/>{</highlight></codeline>
<codeline lineno="717"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>buf[256];</highlight></codeline>
<codeline lineno="718"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="tensor__map_8h_1ad887f000c7ecd66c30fb2d5cad14376d" kindref="member">tensor_desc_to_string</ref>(td,<sp/>buf,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(buf))<sp/>&gt;=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="719"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(void)snprintf(err,<sp/>errsz,<sp/></highlight><highlight class="stringliteral">&quot;tensor_map<sp/>contains<sp/>zero-sized<sp/>tensor:<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>buf);</highlight></codeline>
<codeline lineno="720"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="721"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="tensor__map_8c_1a545cca475e7c6de327d07da7515a67d1" kindref="member">tm_set_err</ref>(err,<sp/>errsz,<sp/></highlight><highlight class="stringliteral">&quot;tensor_map<sp/>contains<sp/>zero-sized<sp/>tensor&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="722"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="723"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>free(refs);</highlight></codeline>
<codeline lineno="724"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-4;</highlight></codeline>
<codeline lineno="725"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="726"><highlight class="normal"></highlight></codeline>
<codeline lineno="727"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint64_t<sp/>end<sp/>=<sp/>td-&gt;<ref refid="structtensor__desc__s_1a0abe393a370bda31eda8ab11a5f8df37" kindref="member">offset</ref><sp/>+<sp/>td-&gt;<ref refid="structtensor__desc__s_1a151674f0f1ad60320437f028593d8b26" kindref="member">size_bytes</ref>;</highlight></codeline>
<codeline lineno="728"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(end<sp/>&lt;<sp/>td-&gt;offset)<sp/>{</highlight></codeline>
<codeline lineno="729"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="tensor__map_8c_1a545cca475e7c6de327d07da7515a67d1" kindref="member">tm_set_err</ref>(err,<sp/>errsz,<sp/></highlight><highlight class="stringliteral">&quot;tensor_map<sp/>offset+size<sp/>overflow&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="730"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>free(refs);</highlight></codeline>
<codeline lineno="731"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-5;</highlight></codeline>
<codeline lineno="732"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="733"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(end<sp/>&gt;<sp/>(uint64_t)bin_size)<sp/>{</highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>buf[256];</highlight></codeline>
<codeline lineno="735"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="tensor__map_8h_1ad887f000c7ecd66c30fb2d5cad14376d" kindref="member">tensor_desc_to_string</ref>(td,<sp/>buf,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(buf))<sp/>&gt;=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="736"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(void)snprintf(err,<sp/>errsz,</highlight></codeline>
<codeline lineno="737"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;tensor_map<sp/>entry<sp/>out<sp/>of<sp/>bounds:<sp/>bin_size=%llu<sp/>%s&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="738"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal">)bin_size,<sp/>buf);</highlight></codeline>
<codeline lineno="739"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="740"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="tensor__map_8c_1a545cca475e7c6de327d07da7515a67d1" kindref="member">tm_set_err</ref>(err,<sp/>errsz,<sp/></highlight><highlight class="stringliteral">&quot;tensor_map<sp/>entry<sp/>out<sp/>of<sp/>bounds&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="741"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="742"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>free(refs);</highlight></codeline>
<codeline lineno="743"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-6;</highlight></codeline>
<codeline lineno="744"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="745"><highlight class="normal"></highlight></codeline>
<codeline lineno="746"><highlight class="normal"><sp/><sp/><sp/><sp/>refs[i].<ref refid="structtm__sort__ref__s_1afaf93178be657b3090952279c97fc940" kindref="member">off</ref><sp/>=<sp/>td-&gt;<ref refid="structtensor__desc__s_1a0abe393a370bda31eda8ab11a5f8df37" kindref="member">offset</ref>;</highlight></codeline>
<codeline lineno="747"><highlight class="normal"><sp/><sp/><sp/><sp/>refs[i].<ref refid="structtm__sort__ref__s_1a4f38ae166a16e951094d4bdc51c630a9" kindref="member">end</ref><sp/>=<sp/>end;</highlight></codeline>
<codeline lineno="748"><highlight class="normal"><sp/><sp/><sp/><sp/>refs[i].<ref refid="structtm__sort__ref__s_1ac6b00de37e50d2f99e6935ba63dd5611" kindref="member">idx</ref><sp/>=<sp/>i;</highlight></codeline>
<codeline lineno="749"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="750"><highlight class="normal"></highlight></codeline>
<codeline lineno="751"><highlight class="normal"><sp/><sp/>qsort(refs,<sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal">)map-&gt;<ref refid="structtensor__map__s_1a64c31242ffe43f6fc36b465d1ef75462" kindref="member">count</ref>,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(*refs),<sp/><ref refid="tensor__map_8c_1a9dc54e5679c0402d5d812603754287a8" kindref="member">tm_sort_ref_cmp</ref>);</highlight></codeline>
<codeline lineno="752"><highlight class="normal"></highlight></codeline>
<codeline lineno="753"><highlight class="normal"><sp/><sp/>uint64_t<sp/>prev_end<sp/>=<sp/>refs[0].<ref refid="structtm__sort__ref__s_1a4f38ae166a16e951094d4bdc51c630a9" kindref="member">end</ref>;</highlight></codeline>
<codeline lineno="754"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(uint32_t<sp/>k<sp/>=<sp/>1;<sp/>k<sp/>&lt;<sp/>map-&gt;<ref refid="structtensor__map__s_1a64c31242ffe43f6fc36b465d1ef75462" kindref="member">count</ref>;<sp/>++k)<sp/>{</highlight></codeline>
<codeline lineno="755"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(refs[k].off<sp/>&lt;<sp/>prev_end)<sp/>{</highlight></codeline>
<codeline lineno="756"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structtensor__desc__s" kindref="compound">tensor_desc_t</ref><sp/>*A<sp/>=<sp/>&amp;map-&gt;<ref refid="structtensor__map__s_1a30493d1f3d1e66d1e9de6813c2844293" kindref="member">tensors</ref>[refs[k<sp/>-<sp/>1].<ref refid="structtm__sort__ref__s_1ac6b00de37e50d2f99e6935ba63dd5611" kindref="member">idx</ref>];</highlight></codeline>
<codeline lineno="757"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structtensor__desc__s" kindref="compound">tensor_desc_t</ref><sp/>*B<sp/>=<sp/>&amp;map-&gt;<ref refid="structtensor__map__s_1a30493d1f3d1e66d1e9de6813c2844293" kindref="member">tensors</ref>[refs[k].<ref refid="structtm__sort__ref__s_1ac6b00de37e50d2f99e6935ba63dd5611" kindref="member">idx</ref>];</highlight></codeline>
<codeline lineno="758"><highlight class="normal"></highlight></codeline>
<codeline lineno="759"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>a_buf[256],<sp/>b_buf[256];</highlight></codeline>
<codeline lineno="760"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>(void)<ref refid="tensor__map_8h_1ad887f000c7ecd66c30fb2d5cad14376d" kindref="member">tensor_desc_to_string</ref>(A,<sp/>a_buf,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(a_buf));</highlight></codeline>
<codeline lineno="761"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>(void)<ref refid="tensor__map_8h_1ad887f000c7ecd66c30fb2d5cad14376d" kindref="member">tensor_desc_to_string</ref>(B,<sp/>b_buf,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(b_buf));</highlight></codeline>
<codeline lineno="762"><highlight class="normal"></highlight></codeline>
<codeline lineno="763"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>(void)snprintf(err,<sp/>errsz,</highlight></codeline>
<codeline lineno="764"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;tensor_map<sp/>overlap<sp/>detected:\n<sp/><sp/>A:<sp/>%s\n<sp/><sp/>B:<sp/>%s&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="765"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>a_buf,<sp/>b_buf);</highlight></codeline>
<codeline lineno="766"><highlight class="normal"></highlight></codeline>
<codeline lineno="767"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>free(refs);</highlight></codeline>
<codeline lineno="768"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-7;</highlight></codeline>
<codeline lineno="769"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="770"><highlight class="normal"><sp/><sp/><sp/><sp/>prev_end<sp/>=<sp/>refs[k].<ref refid="structtm__sort__ref__s_1a4f38ae166a16e951094d4bdc51c630a9" kindref="member">end</ref>;</highlight></codeline>
<codeline lineno="771"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="772"><highlight class="normal"></highlight></codeline>
<codeline lineno="773"><highlight class="normal"><sp/><sp/>free(refs);</highlight></codeline>
<codeline lineno="774"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(err<sp/>&amp;&amp;<sp/>errsz)<sp/>err[0]<sp/>=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="775"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="776"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="engine/src/io/tensor_map.c"/>
  </compounddef>
</doxygen>
