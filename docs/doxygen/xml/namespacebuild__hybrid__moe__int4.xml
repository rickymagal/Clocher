<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.9.8" xml:lang="en-US">
  <compounddef id="namespacebuild__hybrid__moe__int4" kind="namespace" language="Python">
    <compoundname>build_hybrid_moe_int4</compoundname>
    <innerclass refid="classbuild__hybrid__moe__int4_1_1TensorRec" prot="public">build_hybrid_moe_int4::TensorRec</innerclass>
    <sectiondef kind="func">
      <memberdef kind="function" id="namespacebuild__hybrid__moe__int4_1a4a18de2ad15c376f7c5b53dafd74c5a3" prot="protected" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>None</type>
        <definition> None build_hybrid_moe_int4._die</definition>
        <argsstring>(str msg)</argsstring>
        <name>_die</name>
        <qualifiedname>build_hybrid_moe_int4._die</qualifiedname>
        <param>
          <type>str</type>
          <declname>msg</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tools/build_hybrid_moe_int4.py" line="48" column="1" bodyfile="tools/build_hybrid_moe_int4.py" bodystart="48" bodyend="52"/>
        <referencedby refid="namespacebuild__hybrid__moe__int4_1abd102ed06d2529f0f6f89547a9bfe101" compoundref="build__hybrid__moe__int4_8py" startline="158" endline="170">_copy_range</referencedby>
        <referencedby refid="namespacebuild__hybrid__moe__int4_1a5644ff177e02423d64f9e50e2a8c82e1" compoundref="build__hybrid__moe__int4_8py" startline="72" endline="118">_infer_in_bin</referencedby>
        <referencedby refid="namespacebuild__hybrid__moe__int4_1a77c9efd495db03e1ea73e75253ac0ff1" compoundref="build__hybrid__moe__int4_8py" startline="119" endline="157">_parse_tensors</referencedby>
        <referencedby refid="namespacebuild__hybrid__moe__int4_1ac3dd45bc88feb1794147487a51173a28" compoundref="build__hybrid__moe__int4_8py" startline="216" endline="261">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="namespacebuild__hybrid__moe__int4_1a718c5ad44be6628052f71c3535e7df4b" prot="protected" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition> int build_hybrid_moe_int4._align_up</definition>
        <argsstring>(int x, int a)</argsstring>
        <name>_align_up</name>
        <qualifiedname>build_hybrid_moe_int4._align_up</qualifiedname>
        <param>
          <type>int</type>
          <declname>x</declname>
        </param>
        <param>
          <type>int</type>
          <declname>a</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tools/build_hybrid_moe_int4.py" line="53" column="1" bodyfile="tools/build_hybrid_moe_int4.py" bodystart="53" bodyend="59"/>
        <referencedby refid="namespacebuild__hybrid__moe__int4_1a9c411912b0436b919a19d5c0117000cb" compoundref="build__hybrid__moe__int4_8py" startline="176" endline="215">_repack</referencedby>
      </memberdef>
      <memberdef kind="function" id="namespacebuild__hybrid__moe__int4_1ad916a5932587ac47d15b0ec17a1d0215" prot="protected" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>Dict[str, Any]</type>
        <definition> Dict[str, Any] build_hybrid_moe_int4._load_json</definition>
        <argsstring>(str path)</argsstring>
        <name>_load_json</name>
        <qualifiedname>build_hybrid_moe_int4._load_json</qualifiedname>
        <param>
          <type>str</type>
          <declname>path</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tools/build_hybrid_moe_int4.py" line="60" column="1" bodyfile="tools/build_hybrid_moe_int4.py" bodystart="60" bodyend="64"/>
        <referencedby refid="namespacebuild__hybrid__moe__int4_1a9c411912b0436b919a19d5c0117000cb" compoundref="build__hybrid__moe__int4_8py" startline="176" endline="215">_repack</referencedby>
        <referencedby refid="namespacebuild__hybrid__moe__int4_1ac3dd45bc88feb1794147487a51173a28" compoundref="build__hybrid__moe__int4_8py" startline="216" endline="261">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="namespacebuild__hybrid__moe__int4_1acc39d595de43d9b8fafba7ea04159a0c" prot="protected" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>None</type>
        <definition> None build_hybrid_moe_int4._write_json</definition>
        <argsstring>(str path, Dict[str, Any] obj)</argsstring>
        <name>_write_json</name>
        <qualifiedname>build_hybrid_moe_int4._write_json</qualifiedname>
        <param>
          <type>str</type>
          <declname>path</declname>
        </param>
        <param>
          <type>Dict</type>
          <declname>obj</declname>
          <array>[str, Any]</array>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tools/build_hybrid_moe_int4.py" line="65" column="1" bodyfile="tools/build_hybrid_moe_int4.py" bodystart="65" bodyend="71"/>
        <referencedby refid="namespacebuild__hybrid__moe__int4_1a9c411912b0436b919a19d5c0117000cb" compoundref="build__hybrid__moe__int4_8py" startline="176" endline="215">_repack</referencedby>
      </memberdef>
      <memberdef kind="function" id="namespacebuild__hybrid__moe__int4_1a5644ff177e02423d64f9e50e2a8c82e1" prot="protected" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>str</type>
        <definition> str build_hybrid_moe_int4._infer_in_bin</definition>
        <argsstring>(str model_dir, Dict[str, Any] m, Optional[str] in_bin_override)</argsstring>
        <name>_infer_in_bin</name>
        <qualifiedname>build_hybrid_moe_int4._infer_in_bin</qualifiedname>
        <param>
          <type>str</type>
          <declname>model_dir</declname>
        </param>
        <param>
          <type>Dict</type>
          <declname>m</declname>
          <array>[str, Any]</array>
        </param>
        <param>
          <type>Optional</type>
          <declname>in_bin_override</declname>
          <array>[str]</array>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tools/build_hybrid_moe_int4.py" line="72" column="1" bodyfile="tools/build_hybrid_moe_int4.py" bodystart="72" bodyend="118"/>
        <references refid="namespacebuild__hybrid__moe__int4_1a4a18de2ad15c376f7c5b53dafd74c5a3" compoundref="build__hybrid__moe__int4_8py" startline="48" endline="52">_die</references>
        <referencedby refid="namespacebuild__hybrid__moe__int4_1ac3dd45bc88feb1794147487a51173a28" compoundref="build__hybrid__moe__int4_8py" startline="216" endline="261">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="namespacebuild__hybrid__moe__int4_1a77c9efd495db03e1ea73e75253ac0ff1" prot="protected" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>List[<ref refid="classbuild__hybrid__moe__int4_1_1TensorRec" kindref="compound">TensorRec</ref>]</type>
        <definition> List[TensorRec] build_hybrid_moe_int4._parse_tensors</definition>
        <argsstring>(Dict[str, Any] m)</argsstring>
        <name>_parse_tensors</name>
        <qualifiedname>build_hybrid_moe_int4._parse_tensors</qualifiedname>
        <param>
          <type>Dict</type>
          <declname>m</declname>
          <array>[str, Any]</array>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tools/build_hybrid_moe_int4.py" line="119" column="1" bodyfile="tools/build_hybrid_moe_int4.py" bodystart="119" bodyend="157"/>
        <references refid="namespacebuild__hybrid__moe__int4_1a4a18de2ad15c376f7c5b53dafd74c5a3" compoundref="build__hybrid__moe__int4_8py" startline="48" endline="52">_die</references>
        <referencedby refid="namespacebuild__hybrid__moe__int4_1a9c411912b0436b919a19d5c0117000cb" compoundref="build__hybrid__moe__int4_8py" startline="176" endline="215">_repack</referencedby>
      </memberdef>
      <memberdef kind="function" id="namespacebuild__hybrid__moe__int4_1abd102ed06d2529f0f6f89547a9bfe101" prot="protected" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>None</type>
        <definition> None build_hybrid_moe_int4._copy_range</definition>
        <argsstring>(fin, fout, int src_off, int nbytes)</argsstring>
        <name>_copy_range</name>
        <qualifiedname>build_hybrid_moe_int4._copy_range</qualifiedname>
        <param>
          <type>fin</type>
          <defname>fin</defname>
        </param>
        <param>
          <type>fout</type>
          <defname>fout</defname>
        </param>
        <param>
          <type>int</type>
          <declname>src_off</declname>
        </param>
        <param>
          <type>int</type>
          <declname>nbytes</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tools/build_hybrid_moe_int4.py" line="158" column="1" bodyfile="tools/build_hybrid_moe_int4.py" bodystart="158" bodyend="170"/>
        <references refid="namespacebuild__hybrid__moe__int4_1a4a18de2ad15c376f7c5b53dafd74c5a3" compoundref="build__hybrid__moe__int4_8py" startline="48" endline="52">_die</references>
        <referencedby refid="namespacebuild__hybrid__moe__int4_1a9c411912b0436b919a19d5c0117000cb" compoundref="build__hybrid__moe__int4_8py" startline="176" endline="215">_repack</referencedby>
      </memberdef>
      <memberdef kind="function" id="namespacebuild__hybrid__moe__int4_1a9c411912b0436b919a19d5c0117000cb" prot="protected" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>None</type>
        <definition> None build_hybrid_moe_int4._repack</definition>
        <argsstring>(str model_dir, str in_map_path, str in_bin_path, str out_bin_path, str out_map_path, int align)</argsstring>
        <name>_repack</name>
        <qualifiedname>build_hybrid_moe_int4._repack</qualifiedname>
        <param>
          <type>str</type>
          <declname>model_dir</declname>
        </param>
        <param>
          <type>str</type>
          <declname>in_map_path</declname>
        </param>
        <param>
          <type>str</type>
          <declname>in_bin_path</declname>
        </param>
        <param>
          <type>str</type>
          <declname>out_bin_path</declname>
        </param>
        <param>
          <type>str</type>
          <declname>out_map_path</declname>
        </param>
        <param>
          <type>int</type>
          <declname>align</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tools/build_hybrid_moe_int4.py" line="171" column="1" bodyfile="tools/build_hybrid_moe_int4.py" bodystart="176" bodyend="215"/>
        <references refid="namespacebuild__hybrid__moe__int4_1a718c5ad44be6628052f71c3535e7df4b" compoundref="build__hybrid__moe__int4_8py" startline="53" endline="59">_align_up</references>
        <references refid="namespacebuild__hybrid__moe__int4_1abd102ed06d2529f0f6f89547a9bfe101" compoundref="build__hybrid__moe__int4_8py" startline="158" endline="170">_copy_range</references>
        <references refid="namespacebuild__hybrid__moe__int4_1ad916a5932587ac47d15b0ec17a1d0215" compoundref="build__hybrid__moe__int4_8py" startline="60" endline="64">_load_json</references>
        <references refid="namespacebuild__hybrid__moe__int4_1a77c9efd495db03e1ea73e75253ac0ff1" compoundref="build__hybrid__moe__int4_8py" startline="119" endline="157">_parse_tensors</references>
        <references refid="namespacebuild__hybrid__moe__int4_1acc39d595de43d9b8fafba7ea04159a0c" compoundref="build__hybrid__moe__int4_8py" startline="65" endline="71">_write_json</references>
        <referencedby refid="namespacebuild__hybrid__moe__int4_1ac3dd45bc88feb1794147487a51173a28" compoundref="build__hybrid__moe__int4_8py" startline="216" endline="261">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="namespacebuild__hybrid__moe__int4_1ac3dd45bc88feb1794147487a51173a28" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition> int build_hybrid_moe_int4.main</definition>
        <argsstring>()</argsstring>
        <name>main</name>
        <qualifiedname>build_hybrid_moe_int4.main</qualifiedname>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tools/build_hybrid_moe_int4.py" line="216" column="1" bodyfile="tools/build_hybrid_moe_int4.py" bodystart="216" bodyend="261"/>
        <references refid="namespacebuild__hybrid__moe__int4_1a4a18de2ad15c376f7c5b53dafd74c5a3" compoundref="build__hybrid__moe__int4_8py" startline="48" endline="52">_die</references>
        <references refid="namespacebuild__hybrid__moe__int4_1a5644ff177e02423d64f9e50e2a8c82e1" compoundref="build__hybrid__moe__int4_8py" startline="72" endline="118">_infer_in_bin</references>
        <references refid="namespacebuild__hybrid__moe__int4_1ad916a5932587ac47d15b0ec17a1d0215" compoundref="build__hybrid__moe__int4_8py" startline="60" endline="64">_load_json</references>
        <references refid="namespacebuild__hybrid__moe__int4_1a9c411912b0436b919a19d5c0117000cb" compoundref="build__hybrid__moe__int4_8py" startline="176" endline="215">_repack</references>
        <references refid="namespacebuild__hybrid__moe__int4_1ac3dd45bc88feb1794147487a51173a28" compoundref="build__hybrid__moe__int4_8py" startline="216" endline="261">main</references>
        <referencedby refid="namespacebuild__hybrid__moe__int4_1ac3dd45bc88feb1794147487a51173a28" compoundref="build__hybrid__moe__int4_8py" startline="216" endline="261">main</referencedby>
      </memberdef>
    </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
<para><verbatim>build_hybrid_moe_int4.py

Repack an existing IEBIN tensor map + weights binary into a new aligned binary,
and emit a compatible tensor map that points to the new weights bin.

This tool is intentionally tolerant of older tensor-map JSON formats that do not
include a top-level &quot;weights_bin&quot; field. In that case, it defaults to
&quot;model.ie.bin&quot; inside --model-dir (or --in-bin if provided).

Typical usage (matches your invocation):

  MODEL_DIR=&quot;.../models/gpt-oss-20b&quot;
  python3 tools/build_hybrid_moe_int4.py \
    --model-dir &quot;$MODEL_DIR&quot; \
    --out-bin &quot;$MODEL_DIR/model.q4.bin&quot; \
    --out-map &quot;$MODEL_DIR/model.ie.compat.json&quot; \
    --align 256

Notes:
- This script does not perform quantization. It repacks whatever tensors already
  exist in the input weights bin (BF16 weights, INT4 blocks/scales, etc.).
- The engine selects the INT4 artifact pair via --precision int4, which maps to
  model.ie.compat.json + model.q4.bin.
</verbatim> </para>
    </detaileddescription>
    <location file="tools/build_hybrid_moe_int4.py" line="1" column="1"/>
  </compounddef>
</doxygen>
