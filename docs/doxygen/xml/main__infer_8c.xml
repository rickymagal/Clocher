<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.9.8" xml:lang="en-US">
  <compounddef id="main__infer_8c" kind="file" language="C++">
    <compoundname>main_infer.c</compoundname>
    <includes local="no">dlfcn.h</includes>
    <includes local="no">errno.h</includes>
    <includes local="no">fcntl.h</includes>
    <includes local="no">inttypes.h</includes>
    <includes local="no">limits.h</includes>
    <includes local="no">stdint.h</includes>
    <includes local="no">stdio.h</includes>
    <includes local="no">stdlib.h</includes>
    <includes local="no">string.h</includes>
    <includes local="no">sys/mman.h</includes>
    <includes local="no">sys/resource.h</includes>
    <includes local="no">sys/stat.h</includes>
    <includes local="no">time.h</includes>
    <includes local="no">unistd.h</includes>
    <includes refid="ie__api_8h" local="yes">ie_api.h</includes>
    <includes refid="ie__io_8h" local="yes">ie_io.h</includes>
    <includes refid="ie__kv__instrumentation_8h" local="yes">ie_kv_instrumentation.h</includes>
    <includes refid="ie__tokenizer__gptoss_8h" local="yes">ie_tokenizer_gptoss.h</includes>
    <includes refid="util__logging_8h" local="yes">util_logging.h</includes>
    <incdepgraph>
      <node id="16">
        <label>ie_api.h</label>
        <link refid="ie__api_8h"/>
        <childnode refid="17" relation="include">
        </childnode>
      </node>
      <node id="18">
        <label>ie_io.h</label>
        <link refid="ie__io_8h"/>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
      </node>
      <node id="19">
        <label>ie_kv_instrumentation.h</label>
        <link refid="ie__kv__instrumentation_8h"/>
        <childnode refid="7" relation="include">
        </childnode>
      </node>
      <node id="20">
        <label>ie_tokenizer_gptoss.h</label>
        <link refid="ie__tokenizer__gptoss_8h"/>
        <childnode refid="17" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
      </node>
      <node id="21">
        <label>util_logging.h</label>
        <link refid="util__logging_8h"/>
        <childnode refid="22" relation="include">
        </childnode>
      </node>
      <node id="1">
        <label>engine/src/main_infer.c</label>
        <link refid="main__infer_8c"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
        <childnode refid="18" relation="include">
        </childnode>
        <childnode refid="19" relation="include">
        </childnode>
        <childnode refid="20" relation="include">
        </childnode>
        <childnode refid="21" relation="include">
        </childnode>
      </node>
      <node id="2">
        <label>dlfcn.h</label>
      </node>
      <node id="3">
        <label>errno.h</label>
      </node>
      <node id="4">
        <label>fcntl.h</label>
      </node>
      <node id="5">
        <label>inttypes.h</label>
      </node>
      <node id="6">
        <label>limits.h</label>
      </node>
      <node id="22">
        <label>stdarg.h</label>
      </node>
      <node id="17">
        <label>stddef.h</label>
      </node>
      <node id="7">
        <label>stdint.h</label>
      </node>
      <node id="8">
        <label>stdio.h</label>
      </node>
      <node id="9">
        <label>stdlib.h</label>
      </node>
      <node id="10">
        <label>string.h</label>
      </node>
      <node id="11">
        <label>sys/mman.h</label>
      </node>
      <node id="12">
        <label>sys/resource.h</label>
      </node>
      <node id="13">
        <label>sys/stat.h</label>
      </node>
      <node id="14">
        <label>time.h</label>
      </node>
      <node id="15">
        <label>unistd.h</label>
      </node>
    </incdepgraph>
    <innerclass refid="structmodel__mmap__touch" prot="public">model_mmap_touch</innerclass>
    <innerclass refid="structcudart__api" prot="public">cudart_api</innerclass>
    <innerclass refid="structcli__extras" prot="public">cli_extras</innerclass>
    <innerclass refid="structprompt__list" prot="public">prompt_list</innerclass>
    <innerclass refid="structexpected__tokens__entry" prot="public">expected_tokens_entry</innerclass>
    <innerclass refid="structexpected__tokens__table" prot="public">expected_tokens_table</innerclass>
    <innerclass refid="structreport__token__buf" prot="public">report_token_buf</innerclass>
    <innerclass refid="structprompt__round__record" prot="public">prompt_round_record</innerclass>
    <sectiondef kind="define">
      <memberdef kind="define" id="main__infer_8c_1a3024ccd4a9af5109d24e6c57565d74a1" prot="public" static="no">
        <name>_POSIX_C_SOURCE</name>
        <initializer>200809L</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="52" column="11" bodyfile="engine/src/main_infer.c" bodystart="52" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="main__infer_8c_1a78c99ffd76a7bb3c8c74db76207e9ab4" prot="public" static="no">
        <name>_XOPEN_SOURCE</name>
        <initializer>700</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="56" column="11" bodyfile="engine/src/main_infer.c" bodystart="56" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="main__infer_8c_1ae688d728e1acdfe5988c7db45d6f0166" prot="public" static="no">
        <name>PATH_MAX</name>
        <initializer>4096</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="81" column="11" bodyfile="engine/src/main_infer.c" bodystart="81" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="main__infer_8c_1a86d500a34c624c2cae56bc25a31b12f3" prot="public" static="no">
        <name>UNUSED</name>
        <param><defname>x</defname></param>
        <initializer>(void)(x)</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="85" column="11" bodyfile="engine/src/main_infer.c" bodystart="85" bodyend="-1"/>
      </memberdef>
    </sectiondef>
    <sectiondef kind="enum">
      <memberdef kind="enum" id="main__infer_8c_1adf764cbdea00d65edcd07bb9953ad2b7" prot="public" static="no" strong="no">
        <type></type>
        <name></name>
        <enumvalue id="main__infer_8c_1adf764cbdea00d65edcd07bb9953ad2b7a27d0e750ab6de4620beed5f2c3662c77" prot="public">
          <name>CUDA_MEMCPY_HOST_TO_DEVICE</name>
          <initializer>= 1</initializer>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="main__infer_8c_1adf764cbdea00d65edcd07bb9953ad2b7a866c5293b3ba22bb820c78bfae10f9ed" prot="public">
          <name>CUDA_MEMCPY_DEVICE_TO_HOST</name>
          <initializer>= 2</initializer>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="main__infer_8c_1adf764cbdea00d65edcd07bb9953ad2b7a72dd74565a54b7fc09708f72ccf8fd5d" prot="public">
          <name>CUDA_MEMCPY_DEVICE_TO_DEVICE</name>
          <initializer>= 3</initializer>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <briefdescription>
<para>cudaMemcpyKind values used by the strict-touch path. </para>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="632" column="1" bodyfile="engine/src/main_infer.c" bodystart="632" bodyend="636"/>
      </memberdef>
      <memberdef kind="enum" id="main__infer_8c_1ae715f0cc745f58eebd4be50b187dd41d" prot="public" static="no" strong="no">
        <type></type>
        <name>cli_pretranspose_t</name>
        <enumvalue id="main__infer_8c_1ae715f0cc745f58eebd4be50b187dd41da382ceb68dddaaf8b27ac21f144305e74" prot="public">
          <name>CLI_PRETX_NONE</name>
          <initializer>= 0</initializer>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="main__infer_8c_1ae715f0cc745f58eebd4be50b187dd41da9d22d4f265254a65af9fc3a7d648fe5d" prot="public">
          <name>CLI_PRETX_WOH</name>
          <initializer>= 1</initializer>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="main__infer_8c_1ae715f0cc745f58eebd4be50b187dd41da1a251ee24fdcadcaf9c888e0a96140e7" prot="public">
          <name>CLI_PRETX_WXH</name>
          <initializer>= 2</initializer>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <enumvalue id="main__infer_8c_1ae715f0cc745f58eebd4be50b187dd41da4fad867319e4f9197a9c373762a3ad54" prot="public">
          <name>CLI_PRETX_ALL</name>
          <initializer>= 3</initializer>
          <briefdescription>
          </briefdescription>
          <detaileddescription>
          </detaileddescription>
        </enumvalue>
        <briefdescription>
<para>Pretranspose modes for optional weight transforms. </para>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="974" column="1" bodyfile="engine/src/main_infer.c" bodystart="974" bodyend="979"/>
      </memberdef>
    </sectiondef>
    <sectiondef kind="typedef">
      <memberdef kind="typedef" id="main__infer_8c_1a54f0d9b3968af3eb368f8847cd420950" prot="public" static="no">
        <type>struct <ref refid="structmodel__mmap__touch" kindref="compound">model_mmap_touch</ref></type>
        <definition>typedef struct model_mmap_touch model_mmap_touch_t</definition>
        <argsstring></argsstring>
        <name>model_mmap_touch_t</name>
        <briefdescription>
<para>A file-backed mmap context for deterministic &quot;touch&quot; work. </para>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="492" column="20"/>
      </memberdef>
      <memberdef kind="typedef" id="main__infer_8c_1a7056b1ed3833957f6045353293d33a10" prot="public" static="no">
        <type>int</type>
        <definition>typedef int cudart_err_t</definition>
        <argsstring></argsstring>
        <name>cudart_err_t</name>
        <briefdescription>
<para>CUDA runtime error code type (opaque int for dynamic loading). </para>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="618" column="13" bodyfile="engine/src/main_infer.c" bodystart="618" bodyend="-1"/>
      </memberdef>
      <memberdef kind="typedef" id="main__infer_8c_1ac0493a5218ac1cfe7720fd33073a26a4" prot="public" static="no">
        <type><ref refid="main__infer_8c_1a7056b1ed3833957f6045353293d33a10" kindref="member">cudart_err_t</ref>(*</type>
        <definition>typedef cudart_err_t(* cudaFree_fn_t) (void *)</definition>
        <argsstring>)(void *)</argsstring>
        <name>cudaFree_fn_t</name>
        <briefdescription>
<para>cudart function pointer types used by the strict-touch path. </para>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="623" column="9" bodyfile="engine/src/main_infer.c" bodystart="623" bodyend="-1"/>
      </memberdef>
      <memberdef kind="typedef" id="main__infer_8c_1a75d810977debadf83c51df3a9caf508e" prot="public" static="no">
        <type><ref refid="main__infer_8c_1a7056b1ed3833957f6045353293d33a10" kindref="member">cudart_err_t</ref>(*</type>
        <definition>typedef cudart_err_t(* cudaMalloc_fn_t) (void **, size_t)</definition>
        <argsstring>)(void **, size_t)</argsstring>
        <name>cudaMalloc_fn_t</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="624" column="9" bodyfile="engine/src/main_infer.c" bodystart="624" bodyend="-1"/>
      </memberdef>
      <memberdef kind="typedef" id="main__infer_8c_1a012d3ce1c3e56c941279966779621a25" prot="public" static="no">
        <type><ref refid="main__infer_8c_1a7056b1ed3833957f6045353293d33a10" kindref="member">cudart_err_t</ref>(*</type>
        <definition>typedef cudart_err_t(* cudaMemcpy_fn_t) (void *, const void *, size_t, int)</definition>
        <argsstring>)(void *, const void *, size_t, int)</argsstring>
        <name>cudaMemcpy_fn_t</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="625" column="9" bodyfile="engine/src/main_infer.c" bodystart="625" bodyend="-1"/>
      </memberdef>
      <memberdef kind="typedef" id="main__infer_8c_1a2ad4e178cd6cc2f9b58919ba9e4ca7b6" prot="public" static="no">
        <type><ref refid="main__infer_8c_1a7056b1ed3833957f6045353293d33a10" kindref="member">cudart_err_t</ref>(*</type>
        <definition>typedef cudart_err_t(* cudaMemset_fn_t) (void *, int, size_t)</definition>
        <argsstring>)(void *, int, size_t)</argsstring>
        <name>cudaMemset_fn_t</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="626" column="9" bodyfile="engine/src/main_infer.c" bodystart="626" bodyend="-1"/>
      </memberdef>
      <memberdef kind="typedef" id="main__infer_8c_1a84c3a6f8fc81d43ea3d5343bc866773c" prot="public" static="no">
        <type><ref refid="main__infer_8c_1a7056b1ed3833957f6045353293d33a10" kindref="member">cudart_err_t</ref>(*</type>
        <definition>typedef cudart_err_t(* cudaDeviceSynchronize_fn_t) (void)</definition>
        <argsstring>)(void)</argsstring>
        <name>cudaDeviceSynchronize_fn_t</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="627" column="9" bodyfile="engine/src/main_infer.c" bodystart="627" bodyend="-1"/>
      </memberdef>
      <memberdef kind="typedef" id="main__infer_8c_1a47a2371d08ac2298f34240909805e945" prot="public" static="no">
        <type>struct <ref refid="structcudart__api" kindref="compound">cudart_api</ref></type>
        <definition>typedef struct cudart_api cudart_api_t</definition>
        <argsstring></argsstring>
        <name>cudart_api_t</name>
        <briefdescription>
<para>Dynamically loaded cudart API table. </para>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="649" column="14"/>
      </memberdef>
      <memberdef kind="typedef" id="main__infer_8c_1a9973434ae2443cc726369b714df7b2cb" prot="public" static="no">
        <type>struct <ref refid="structcli__extras" kindref="compound">cli_extras</ref></type>
        <definition>typedef struct cli_extras cli_extras_t</definition>
        <argsstring></argsstring>
        <name>cli_extras_t</name>
        <briefdescription>
<para>Parsed CLI options and derived configuration. </para>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="1042" column="14"/>
      </memberdef>
      <memberdef kind="typedef" id="main__infer_8c_1aa2c236bcd5a489e1a409ffd5f4c532f7" prot="public" static="no">
        <type>struct <ref refid="structprompt__list" kindref="compound">prompt_list</ref></type>
        <definition>typedef struct prompt_list prompt_list_t</definition>
        <argsstring></argsstring>
        <name>prompt_list_t</name>
        <briefdescription>
<para>Prompt list (preloaded) to avoid file I/O in the timed window. </para>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="1554" column="15"/>
      </memberdef>
      <memberdef kind="typedef" id="main__infer_8c_1ae3d72519a21dd8c22c60d86104a0c151" prot="public" static="no">
        <type>struct <ref refid="structexpected__tokens__entry" kindref="compound">expected_tokens_entry</ref></type>
        <definition>typedef struct expected_tokens_entry expected_tokens_entry_t</definition>
        <argsstring></argsstring>
        <name>expected_tokens_entry_t</name>
        <briefdescription>
<para>An entry in the expected-tokens table. </para>
        </briefdescription>
        <detaileddescription>
<para>The token list is compared against the engine-generated token IDs for a prompt. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="1744" column="25"/>
      </memberdef>
      <memberdef kind="typedef" id="main__infer_8c_1ac519a155900b9eda4cab9d3a9a74dd62" prot="public" static="no">
        <type>struct <ref refid="structexpected__tokens__table" kindref="compound">expected_tokens_table</ref></type>
        <definition>typedef struct expected_tokens_table expected_tokens_table_t</definition>
        <argsstring></argsstring>
        <name>expected_tokens_table_t</name>
        <briefdescription>
<para>A table of expected tokens, loaded from a text file. </para>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="1753" column="25"/>
      </memberdef>
      <memberdef kind="typedef" id="main__infer_8c_1aeaf1944cb54f4e8f7a914be88b362163" prot="public" static="no">
        <type>struct <ref refid="structreport__token__buf" kindref="compound">report_token_buf</ref></type>
        <definition>typedef struct report_token_buf report_token_buf_t</definition>
        <argsstring></argsstring>
        <name>report_token_buf_t</name>
        <briefdescription>
<para>A token buffer owned by the report (copy of engine output). </para>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="2025" column="20"/>
      </memberdef>
      <memberdef kind="typedef" id="main__infer_8c_1af8802263c4d59c173623fe774ce0abb0" prot="public" static="no">
        <type>struct <ref refid="structprompt__round__record" kindref="compound">prompt_round_record</ref></type>
        <definition>typedef struct prompt_round_record prompt_round_record_t</definition>
        <argsstring></argsstring>
        <name>prompt_round_record_t</name>
        <briefdescription>
<para>Per-prompt per-round record, suitable for JSON reporting. </para>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="2102" column="23"/>
      </memberdef>
    </sectiondef>
    <sectiondef kind="func">
      <memberdef kind="function" id="main__infer_8c_1a42d8c2f3c8817b30177d0a7e39742b03" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>size_t</type>
        <definition>static size_t min_size</definition>
        <argsstring>(size_t a, size_t b)</argsstring>
        <name>min_size</name>
        <param>
          <type>size_t</type>
          <declname>a</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>b</declname>
        </param>
        <briefdescription>
<para>Return the smaller of two size_t values. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>a</parametername>
</parameternamelist>
<parameterdescription>
<para>First value. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>b</parametername>
</parameternamelist>
<parameterdescription>
<para>Second value. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>min(a,b). </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="117" column="15" bodyfile="engine/src/main_infer.c" bodystart="117" bodyend="117"/>
        <referencedby refid="main__infer_8c_1a44a0de9d17f6eff8a4764537268ab5d1" compoundref="main__infer_8c" startline="697" endline="745">cudart_touch_bytes</referencedby>
        <referencedby refid="main__infer_8c_1a4e30eb4737647a78c4dbebb5b008a5bd" compoundref="main__infer_8c" startline="866" endline="965">decode_tokens_best_effort</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a9675b1f5b8b73e24233f92cb11e31f6a" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>long</type>
        <definition>static long env_long</definition>
        <argsstring>(const char *name, long defv)</argsstring>
        <name>env_long</name>
        <param>
          <type>const char *</type>
          <declname>name</declname>
        </param>
        <param>
          <type>long</type>
          <declname>defv</declname>
        </param>
        <briefdescription>
<para>Read a long integer from an environment variable with a default. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>name</parametername>
</parameternamelist>
<parameterdescription>
<para>Environment variable name. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>defv</parametername>
</parameternamelist>
<parameterdescription>
<para>Default value when unset or invalid. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Parsed value or defv.</para>
</simplesect>
env_long.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>name</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>defv</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>See implementation for details. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="133" column="13" bodyfile="engine/src/main_infer.c" bodystart="133" bodyend="139"/>
        <referencedby refid="main__infer_8c_1a3c04138a5bfe5d72780bb7e82a18e627" compoundref="main__infer_8c" startline="2362" endline="2740">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a1da65df4642943745d356d6de2983f02" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>const char *</type>
        <definition>static const char * env_str</definition>
        <argsstring>(const char *name, const char *defv)</argsstring>
        <name>env_str</name>
        <param>
          <type>const char *</type>
          <declname>name</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>defv</declname>
        </param>
        <briefdescription>
<para>Read a string from an environment variable with a default. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>name</parametername>
</parameternamelist>
<parameterdescription>
<para>Environment variable name. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>defv</parametername>
</parameternamelist>
<parameterdescription>
<para>Default string when unset or empty. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Environment value or defv. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="147" column="19" bodyfile="engine/src/main_infer.c" bodystart="147" bodyend="150"/>
        <referencedby refid="main__infer_8c_1a3c04138a5bfe5d72780bb7e82a18e627" compoundref="main__infer_8c" startline="2362" endline="2740">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a72ab94aafe7740f1343d317daa89ca15" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int ascii_ieq</definition>
        <argsstring>(const char *a, const char *b)</argsstring>
        <name>ascii_ieq</name>
        <param>
          <type>const char *</type>
          <declname>a</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>b</declname>
        </param>
        <briefdescription>
<para>Case-insensitive ASCII equality. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>a</parametername>
</parameternamelist>
<parameterdescription>
<para>String A. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>b</parametername>
</parameternamelist>
<parameterdescription>
<para>String B. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>1 when equal (ASCII case-insensitive), 0 otherwise.</para>
</simplesect>
ascii_ieq.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>a</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>b</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>See implementation for details. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="166" column="12" bodyfile="engine/src/main_infer.c" bodystart="166" bodyend="176"/>
        <referencedby refid="main__infer_8c_1ae26c03bc6150b42f62a01df020935733" compoundref="main__infer_8c" startline="2352" endline="2352">device_is_cpu</referencedby>
        <referencedby refid="main__infer_8c_1a43b384fdf1f1e4cc7304e6164461af44" compoundref="main__infer_8c" startline="2345" endline="2345">device_is_cuda</referencedby>
        <referencedby refid="main__infer_8c_1a3c04138a5bfe5d72780bb7e82a18e627" compoundref="main__infer_8c" startline="2362" endline="2740">main</referencedby>
        <referencedby refid="main__infer_8c_1a456ba954f3884bcf5f72fc3e779de284" compoundref="main__infer_8c" startline="1308" endline="1500">parse_flags</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a55469391e7680b876a48cdc0d3d24632" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int starts_with</definition>
        <argsstring>(const char *s, const char *prefix)</argsstring>
        <name>starts_with</name>
        <param>
          <type>const char *</type>
          <declname>s</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>prefix</declname>
        </param>
        <briefdescription>
<para>Check whether a string begins with a given prefix (case-sensitive). </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>s</parametername>
</parameternamelist>
<parameterdescription>
<para>Input string. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>prefix</parametername>
</parameternamelist>
<parameterdescription>
<para>Prefix string. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>1 when s starts with prefix, 0 otherwise.</para>
</simplesect>
starts_with.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>s</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>prefix</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>See implementation for details. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="192" column="12" bodyfile="engine/src/main_infer.c" bodystart="192" bodyend="198"/>
        <referencedby refid="main__infer_8c_1a937426768611822fbe840722069c7043" compoundref="main__infer_8c" startline="359" endline="362">is_int4_precision</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a4fdbfffdaa0f22a01822f6a62bb7e95e" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>double</type>
        <definition>static double now_sec</definition>
        <argsstring>(void)</argsstring>
        <name>now_sec</name>
        <param>
          <type>void</type>
        </param>
        <briefdescription>
<para>Return monotonic time in seconds. </para>
        </briefdescription>
        <detaileddescription>
<para><simplesect kind="return"><para>Seconds since an unspecified epoch (monotonic).</para>
</simplesect>
now_sec.</para>
<para><simplesect kind="return"><para>See implementation for details. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="209" column="15" bodyfile="engine/src/main_infer.c" bodystart="209" bodyend="213"/>
        <referencedby refid="main__infer_8c_1a3c04138a5bfe5d72780bb7e82a18e627" compoundref="main__infer_8c" startline="2362" endline="2740">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a0cbea455e9868581360f43c63db6554c" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int path_exists</definition>
        <argsstring>(const char *p)</argsstring>
        <name>path_exists</name>
        <param>
          <type>const char *</type>
          <declname>p</declname>
        </param>
        <briefdescription>
<para>Determine whether a filesystem path exists (stat succeeds). </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>p</parametername>
</parameternamelist>
<parameterdescription>
<para>Path to test. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>1 when exists, 0 otherwise.</para>
</simplesect>
path_exists.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>p</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>See implementation for details. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="227" column="12" bodyfile="engine/src/main_infer.c" bodystart="227" bodyend="231"/>
        <referencedby refid="main__infer_8c_1a3c04138a5bfe5d72780bb7e82a18e627" compoundref="main__infer_8c" startline="2362" endline="2740">main</referencedby>
        <referencedby refid="main__infer_8c_1ad6b894571e18a35f21d8451e008fae37" compoundref="main__infer_8c" startline="378" endline="426">resolve_model_paths</referencedby>
        <referencedby refid="main__infer_8c_1a0271a21f39c53534b7a1a3cc7eb94596" compoundref="main__infer_8c" startline="810" endline="841">resolve_tokenizer_path</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a2392f4f2060045de53b484a90f85f15f" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int dir_accessible</definition>
        <argsstring>(const char *p)</argsstring>
        <name>dir_accessible</name>
        <param>
          <type>const char *</type>
          <declname>p</declname>
        </param>
        <briefdescription>
<para>Determine whether a directory exists and is accessible (R_OK|X_OK). </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>p</parametername>
</parameternamelist>
<parameterdescription>
<para>Directory path. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>1 when accessible directory, 0 otherwise.</para>
</simplesect>
dir_accessible.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>p</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>See implementation for details. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="245" column="12" bodyfile="engine/src/main_infer.c" bodystart="245" bodyend="251"/>
        <referencedby refid="main__infer_8c_1a3c04138a5bfe5d72780bb7e82a18e627" compoundref="main__infer_8c" startline="2362" endline="2740">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a35a9aadd511e6b3688d01a67a12c7651" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int path_is_abs</definition>
        <argsstring>(const char *p)</argsstring>
        <name>path_is_abs</name>
        <param>
          <type>const char *</type>
          <declname>p</declname>
        </param>
        <briefdescription>
<para>Check if a path is absolute (POSIX). </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>p</parametername>
</parameternamelist>
<parameterdescription>
<para>Path. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>1 when absolute, 0 otherwise. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="258" column="12" bodyfile="engine/src/main_infer.c" bodystart="258" bodyend="258"/>
        <referencedby refid="main__infer_8c_1adca9b33a342b8635e28ba51aecb365f6" compoundref="main__infer_8c" startline="297" endline="314">join_path</referencedby>
        <referencedby refid="main__infer_8c_1ad6b894571e18a35f21d8451e008fae37" compoundref="main__infer_8c" startline="378" endline="426">resolve_model_paths</referencedby>
        <referencedby refid="main__infer_8c_1a0271a21f39c53534b7a1a3cc7eb94596" compoundref="main__infer_8c" startline="810" endline="841">resolve_tokenizer_path</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a210133797f21fcee710ec892841dce42" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void safe_strcpy</definition>
        <argsstring>(char *dst, size_t dstsz, const char *src)</argsstring>
        <name>safe_strcpy</name>
        <param>
          <type>char *</type>
          <declname>dst</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>dstsz</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>src</declname>
        </param>
        <briefdescription>
<para>Safe string copy using snprintf. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>dst</parametername>
</parameternamelist>
<parameterdescription>
<para>Destination buffer. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>dstsz</parametername>
</parameternamelist>
<parameterdescription>
<para>Destination capacity. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>src</parametername>
</parameternamelist>
<parameterdescription>
<para>Source string (may be NULL).</para>
</parameterdescription>
</parameteritem>
</parameterlist>
safe_strcpy.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>dst</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>dstsz</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>src</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="273" column="13" bodyfile="engine/src/main_infer.c" bodystart="273" bodyend="280"/>
        <referencedby refid="main__infer_8c_1a680d5eb9763f52ea89ce1764e01121dc" compoundref="main__infer_8c" startline="332" endline="345">canon_dir</referencedby>
        <referencedby refid="main__infer_8c_1adca9b33a342b8635e28ba51aecb365f6" compoundref="main__infer_8c" startline="297" endline="314">join_path</referencedby>
        <referencedby refid="main__infer_8c_1ad6b894571e18a35f21d8451e008fae37" compoundref="main__infer_8c" startline="378" endline="426">resolve_model_paths</referencedby>
        <referencedby refid="main__infer_8c_1a0271a21f39c53534b7a1a3cc7eb94596" compoundref="main__infer_8c" startline="810" endline="841">resolve_tokenizer_path</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1adca9b33a342b8635e28ba51aecb365f6" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void join_path</definition>
        <argsstring>(char *out, size_t outsz, const char *dir, const char *leaf)</argsstring>
        <name>join_path</name>
        <param>
          <type>char *</type>
          <declname>out</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>outsz</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>dir</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>leaf</declname>
        </param>
        <briefdescription>
<para>Join directory and filename into a single path. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>out</parametername>
</parameternamelist>
<parameterdescription>
<para>Output buffer. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>outsz</parametername>
</parameternamelist>
<parameterdescription>
<para>Output capacity. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>dir</parametername>
</parameternamelist>
<parameterdescription>
<para>Directory component (may be NULL/empty). </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>leaf</parametername>
</parameternamelist>
<parameterdescription>
<para>Leaf component (must be non-NULL).</para>
</parameterdescription>
</parameteritem>
</parameterlist>
join_path.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>out</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>outsz</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>dir</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>leaf</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="297" column="13" bodyfile="engine/src/main_infer.c" bodystart="297" bodyend="314"/>
        <references refid="main__infer_8c_1a35a9aadd511e6b3688d01a67a12c7651" compoundref="main__infer_8c" startline="258" endline="258">path_is_abs</references>
        <references refid="main__infer_8c_1a210133797f21fcee710ec892841dce42" compoundref="main__infer_8c" startline="273" endline="280">safe_strcpy</references>
        <referencedby refid="main__infer_8c_1ad6b894571e18a35f21d8451e008fae37" compoundref="main__infer_8c" startline="378" endline="426">resolve_model_paths</referencedby>
        <referencedby refid="main__infer_8c_1a0271a21f39c53534b7a1a3cc7eb94596" compoundref="main__infer_8c" startline="810" endline="841">resolve_tokenizer_path</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a680d5eb9763f52ea89ce1764e01121dc" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int canon_dir</definition>
        <argsstring>(char *out, size_t outsz, const char *dir)</argsstring>
        <name>canon_dir</name>
        <param>
          <type>char *</type>
          <declname>out</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>outsz</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>dir</declname>
        </param>
        <briefdescription>
<para>Canonicalize a directory path with realpath when possible. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>out</parametername>
</parameternamelist>
<parameterdescription>
<para>Output buffer. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>outsz</parametername>
</parameternamelist>
<parameterdescription>
<para>Output capacity. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>dir</parametername>
</parameternamelist>
<parameterdescription>
<para>Input directory path. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>1 when realpath succeeded, 0 otherwise (out still set to dir).</para>
</simplesect>
canon_dir.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>out</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>outsz</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>dir</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>See implementation for details. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="332" column="12" bodyfile="engine/src/main_infer.c" bodystart="332" bodyend="345"/>
        <references refid="main__infer_8c_1ae688d728e1acdfe5988c7db45d6f0166" compoundref="main__infer_8c" startline="81">PATH_MAX</references>
        <references refid="main__infer_8c_1a210133797f21fcee710ec892841dce42" compoundref="main__infer_8c" startline="273" endline="280">safe_strcpy</references>
        <referencedby refid="main__infer_8c_1ad6b894571e18a35f21d8451e008fae37" compoundref="main__infer_8c" startline="378" endline="426">resolve_model_paths</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a937426768611822fbe840722069c7043" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int is_int4_precision</definition>
        <argsstring>(const char *p)</argsstring>
        <name>is_int4_precision</name>
        <param>
          <type>const char *</type>
          <declname>p</declname>
        </param>
        <briefdescription>
<para>Determine if precision string requests int4 family. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>p</parametername>
</parameternamelist>
<parameterdescription>
<para>Precision label. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>1 if &quot;int4*&quot; else 0.</para>
</simplesect>
is_int4_precision.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>p</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>See implementation for details. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="359" column="12" bodyfile="engine/src/main_infer.c" bodystart="359" bodyend="362"/>
        <references refid="main__infer_8c_1a55469391e7680b876a48cdc0d3d24632" compoundref="main__infer_8c" startline="192" endline="198">starts_with</references>
        <referencedby refid="main__infer_8c_1ad6b894571e18a35f21d8451e008fae37" compoundref="main__infer_8c" startline="378" endline="426">resolve_model_paths</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1ad6b894571e18a35f21d8451e008fae37" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void resolve_model_paths</definition>
        <argsstring>(const char *model_dir, const char *model_json_opt, const char *model_bin_opt, const char *precision, char *out_json, size_t out_json_sz, char *out_bin, size_t out_bin_sz)</argsstring>
        <name>resolve_model_paths</name>
        <param>
          <type>const char *</type>
          <declname>model_dir</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>model_json_opt</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>model_bin_opt</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>precision</declname>
        </param>
        <param>
          <type>char *</type>
          <declname>out_json</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>out_json_sz</declname>
        </param>
        <param>
          <type>char *</type>
          <declname>out_bin</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>out_bin_sz</declname>
        </param>
        <briefdescription>
<para>Resolve model JSON/BIN paths based on model_dir and precision defaults. </para>
        </briefdescription>
        <detaileddescription>
<para>For int4, prefer model.ie.compat.json when present and model.q4.bin when present.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>model_dir</parametername>
</parameternamelist>
<parameterdescription>
<para>Model directory (may be NULL/empty). </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>model_json_opt</parametername>
</parameternamelist>
<parameterdescription>
<para>Optional override for JSON (relative to model_dir unless absolute). </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>model_bin_opt</parametername>
</parameternamelist>
<parameterdescription>
<para>Optional override for BIN (relative to model_dir unless absolute). </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>precision</parametername>
</parameternamelist>
<parameterdescription>
<para>Precision label (used for int4 defaults). </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>out_json</parametername>
</parameternamelist>
<parameterdescription>
<para>Output JSON path. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>out_json_sz</parametername>
</parameternamelist>
<parameterdescription>
<para>Output JSON capacity. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>out_bin</parametername>
</parameternamelist>
<parameterdescription>
<para>Output BIN path. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>out_bin_sz</parametername>
</parameternamelist>
<parameterdescription>
<para>Output BIN capacity. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="378" column="13" bodyfile="engine/src/main_infer.c" bodystart="378" bodyend="426"/>
        <references refid="main__infer_8c_1a680d5eb9763f52ea89ce1764e01121dc" compoundref="main__infer_8c" startline="332" endline="345">canon_dir</references>
        <references refid="main__infer_8c_1a937426768611822fbe840722069c7043" compoundref="main__infer_8c" startline="359" endline="362">is_int4_precision</references>
        <references refid="main__infer_8c_1adca9b33a342b8635e28ba51aecb365f6" compoundref="main__infer_8c" startline="297" endline="314">join_path</references>
        <references refid="main__infer_8c_1a0cbea455e9868581360f43c63db6554c" compoundref="main__infer_8c" startline="227" endline="231">path_exists</references>
        <references refid="main__infer_8c_1a35a9aadd511e6b3688d01a67a12c7651" compoundref="main__infer_8c" startline="258" endline="258">path_is_abs</references>
        <references refid="main__infer_8c_1ae688d728e1acdfe5988c7db45d6f0166" compoundref="main__infer_8c" startline="81">PATH_MAX</references>
        <references refid="main__infer_8c_1a210133797f21fcee710ec892841dce42" compoundref="main__infer_8c" startline="273" endline="280">safe_strcpy</references>
        <referencedby refid="main__infer_8c_1a3c04138a5bfe5d72780bb7e82a18e627" compoundref="main__infer_8c" startline="2362" endline="2740">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a0d90177eef91d08c3d9a38fb00df3e62" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>uint32_t</type>
        <definition>static uint32_t rss_peak_mib</definition>
        <argsstring>(void)</argsstring>
        <name>rss_peak_mib</name>
        <param>
          <type>void</type>
        </param>
        <briefdescription>
<para>Read ru_maxrss and convert to MiB (Linux: ru_maxrss is KiB). </para>
        </briefdescription>
        <detaileddescription>
<para><simplesect kind="return"><para>RSS peak in MiB (rounded down), or 0 on failure.</para>
</simplesect>
rss_peak_mib.</para>
<para><simplesect kind="return"><para>See implementation for details. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="437" column="17" bodyfile="engine/src/main_infer.c" bodystart="437" bodyend="442"/>
        <referencedby refid="main__infer_8c_1a3c04138a5bfe5d72780bb7e82a18e627" compoundref="main__infer_8c" startline="2362" endline="2740">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a39103ce72021a890c3e333b949068a1c" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>char *</type>
        <definition>static char * heap_strdup</definition>
        <argsstring>(const char *s)</argsstring>
        <name>heap_strdup</name>
        <param>
          <type>const char *</type>
          <declname>s</declname>
        </param>
        <briefdescription>
<para>Heap-duplicate a string (portable replacement for strdup). </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>s</parametername>
</parameternamelist>
<parameterdescription>
<para>Input string (may be NULL). </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Newly allocated copy, or NULL. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="449" column="13" bodyfile="engine/src/main_infer.c" bodystart="449" bodyend="456"/>
        <referencedby refid="main__infer_8c_1a3c04138a5bfe5d72780bb7e82a18e627" compoundref="main__infer_8c" startline="2362" endline="2740">main</referencedby>
        <referencedby refid="main__infer_8c_1a9be857b0051297813c2cb218accbb5c8" compoundref="main__infer_8c" startline="1606" endline="1622">prompt_list_push_copy</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a82ba5822565056bddf97d8b9d425d9b9" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int ends_with</definition>
        <argsstring>(const char *s, const char *suf)</argsstring>
        <name>ends_with</name>
        <param>
          <type>const char *</type>
          <declname>s</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>suf</declname>
        </param>
        <briefdescription>
<para>Check if a string ends with a given suffix (case-sensitive). </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>s</parametername>
</parameternamelist>
<parameterdescription>
<para>String (may be NULL). </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>suf</parametername>
</parameternamelist>
<parameterdescription>
<para>Suffix (may be NULL). </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>1 when s ends with suf, 0 otherwise.</para>
</simplesect>
ends_with.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>s</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>suf</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>See implementation for details. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="472" column="12" bodyfile="engine/src/main_infer.c" bodystart="472" bodyend="478"/>
        <referencedby refid="main__infer_8c_1a4e30eb4737647a78c4dbebb5b008a5bd" compoundref="main__infer_8c" startline="866" endline="965">decode_tokens_best_effort</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1ac67780918b483167f77ec879306c781c" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int model_touch_open</definition>
        <argsstring>(model_mmap_touch_t *ctx, const char *path)</argsstring>
        <name>model_touch_open</name>
        <param>
          <type><ref refid="main__infer_8c_1a54f0d9b3968af3eb368f8847cd420950" kindref="member">model_mmap_touch_t</ref> *</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>path</declname>
        </param>
        <briefdescription>
<para>Initialize a file-backed read-only mmap for the given path. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>ctx</parametername>
</parameternamelist>
<parameterdescription>
<para>Context to initialize. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>path</parametername>
</parameternamelist>
<parameterdescription>
<para>File path to map. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>0 on success, nonzero on failure.</para>
</simplesect>
model_touch_open.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>ctx</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>path</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>See implementation for details. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="508" column="12" bodyfile="engine/src/main_infer.c" bodystart="508" bodyend="540"/>
        <references refid="structmodel__mmap__touch_1a54141a2f335b552fc983228129bdd606" compoundref="main__infer_8c" startline="489">model_mmap_touch::base</references>
        <references refid="structmodel__mmap__touch_1a99a97f91127ac01736ee6aad39f22b35" compoundref="main__infer_8c" startline="491">model_mmap_touch::cursor</references>
        <references refid="structmodel__mmap__touch_1aa4b9a2f532f12c85f152012e47a34ff7" compoundref="main__infer_8c" startline="488">model_mmap_touch::fd</references>
        <references refid="structmodel__mmap__touch_1aabdfb060ddd6fa73f42db548196ffe6e" compoundref="main__infer_8c" startline="490">model_mmap_touch::size</references>
        <referencedby refid="main__infer_8c_1a3c04138a5bfe5d72780bb7e82a18e627" compoundref="main__infer_8c" startline="2362" endline="2740">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a6d67a99243e339c4acabd9ed9b84002c" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void model_touch_close</definition>
        <argsstring>(model_mmap_touch_t *ctx)</argsstring>
        <name>model_touch_close</name>
        <param>
          <type><ref refid="main__infer_8c_1a54f0d9b3968af3eb368f8847cd420950" kindref="member">model_mmap_touch_t</ref> *</type>
          <declname>ctx</declname>
        </param>
        <briefdescription>
<para>Close and unmap a model touch context. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>ctx</parametername>
</parameternamelist>
<parameterdescription>
<para>Context to close (safe to call repeatedly).</para>
</parameterdescription>
</parameteritem>
</parameterlist>
model_touch_close.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>ctx</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="551" column="13" bodyfile="engine/src/main_infer.c" bodystart="551" bodyend="559"/>
        <references refid="structmodel__mmap__touch_1a54141a2f335b552fc983228129bdd606" compoundref="main__infer_8c" startline="489">model_mmap_touch::base</references>
        <references refid="structmodel__mmap__touch_1a99a97f91127ac01736ee6aad39f22b35" compoundref="main__infer_8c" startline="491">model_mmap_touch::cursor</references>
        <references refid="structmodel__mmap__touch_1aa4b9a2f532f12c85f152012e47a34ff7" compoundref="main__infer_8c" startline="488">model_mmap_touch::fd</references>
        <references refid="structmodel__mmap__touch_1aabdfb060ddd6fa73f42db548196ffe6e" compoundref="main__infer_8c" startline="490">model_mmap_touch::size</references>
        <referencedby refid="main__infer_8c_1a3c04138a5bfe5d72780bb7e82a18e627" compoundref="main__infer_8c" startline="2362" endline="2740">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1af5ac8d51b8d24639015faa2a2e699ba2" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int model_touch_bytes</definition>
        <argsstring>(model_mmap_touch_t *ctx, size_t bytes_to_touch, size_t stride_bytes, int verify_touch)</argsstring>
        <name>model_touch_bytes</name>
        <param>
          <type><ref refid="main__infer_8c_1a54f0d9b3968af3eb368f8847cd420950" kindref="member">model_mmap_touch_t</ref> *</type>
          <declname>ctx</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>bytes_to_touch</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>stride_bytes</declname>
        </param>
        <param>
          <type>int</type>
          <declname>verify_touch</declname>
        </param>
        <briefdescription>
<para>Deterministically read bytes from the mapped model to force page faults. </para>
        </briefdescription>
        <detaileddescription>
<para>This reads file-backed pages so that RSS/majflt reflect real paging behavior. The reads are strided and continue from ctx-&gt;cursor, wrapping around.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>ctx</parametername>
</parameternamelist>
<parameterdescription>
<para>Open model touch context. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>bytes_to_touch</parametername>
</parameternamelist>
<parameterdescription>
<para>Total bytes to cover (capped to ctx-&gt;size). </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>stride_bytes</parametername>
</parameternamelist>
<parameterdescription>
<para>Read stride (minimum 1). </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>verify_touch</parametername>
</parameternamelist>
<parameterdescription>
<para>If nonzero, perform a small anti-optimization check. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>0 on success, nonzero on error. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="573" column="12" bodyfile="engine/src/main_infer.c" bodystart="573" bodyend="609"/>
        <references refid="structmodel__mmap__touch_1a54141a2f335b552fc983228129bdd606" compoundref="main__infer_8c" startline="489">model_mmap_touch::base</references>
        <references refid="structmodel__mmap__touch_1a99a97f91127ac01736ee6aad39f22b35" compoundref="main__infer_8c" startline="491">model_mmap_touch::cursor</references>
        <references refid="structmodel__mmap__touch_1aabdfb060ddd6fa73f42db548196ffe6e" compoundref="main__infer_8c" startline="490">model_mmap_touch::size</references>
        <referencedby refid="main__infer_8c_1a3c04138a5bfe5d72780bb7e82a18e627" compoundref="main__infer_8c" startline="2362" endline="2740">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1aca4f099fbc130845b4af6c57ca21b3ef" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="main__infer_8c_1a47a2371d08ac2298f34240909805e945" kindref="member">cudart_api_t</ref> *</type>
        <definition>static cudart_api_t * cudart_get_api</definition>
        <argsstring>(void)</argsstring>
        <name>cudart_get_api</name>
        <param>
          <type>void</type>
        </param>
        <briefdescription>
<para>Load cudart symbols via dlopen/dlsym (lazy singleton). </para>
        </briefdescription>
        <detaileddescription>
<para><simplesect kind="return"><para>Pointer to API table on success, NULL otherwise. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="655" column="21" bodyfile="engine/src/main_infer.c" bodystart="655" bodyend="687"/>
        <references refid="structcudart__api_1a8885e8aa343a956388d6fc359994b5b6" compoundref="main__infer_8c" startline="648">cudart_api::cudaDeviceSynchronize</references>
        <references refid="structcudart__api_1a2c3660d016022d753aa36e57b5ed469c" compoundref="main__infer_8c" startline="644">cudart_api::cudaFree</references>
        <references refid="structcudart__api_1a90ebdb0591a336ef47414cd285d15371" compoundref="main__infer_8c" startline="645">cudart_api::cudaMalloc</references>
        <references refid="structcudart__api_1a6e790e818a18bd526582a098649f2f92" compoundref="main__infer_8c" startline="646">cudart_api::cudaMemcpy</references>
        <references refid="structcudart__api_1a7e9b278453c583049fcbb790bfa32c5d" compoundref="main__infer_8c" startline="647">cudart_api::cudaMemset</references>
        <references refid="structcudart__api_1ae8f421003c605dc77bebe8fab65624cc" compoundref="main__infer_8c" startline="642">cudart_api::handle</references>
        <references refid="structcudart__api_1ad3b6ea8382433674c94c19f638d1224e" compoundref="main__infer_8c" startline="643">cudart_api::ok</references>
        <referencedby refid="main__infer_8c_1a44a0de9d17f6eff8a4764537268ab5d1" compoundref="main__infer_8c" startline="697" endline="745">cudart_touch_bytes</referencedby>
        <referencedby refid="main__infer_8c_1a3c04138a5bfe5d72780bb7e82a18e627" compoundref="main__infer_8c" startline="2362" endline="2740">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a44a0de9d17f6eff8a4764537268ab5d1" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int cudart_touch_bytes</definition>
        <argsstring>(size_t bytes_per_token, uint64_t tokens, size_t stride_bytes, int verify_touch)</argsstring>
        <name>cudart_touch_bytes</name>
        <param>
          <type>size_t</type>
          <declname>bytes_per_token</declname>
        </param>
        <param>
          <type>uint64_t</type>
          <declname>tokens</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>stride_bytes</declname>
        </param>
        <param>
          <type>int</type>
          <declname>verify_touch</declname>
        </param>
        <briefdescription>
<para>Strict CUDA touch: cudaMalloc + repeated cudaMemset + optional D2H copy. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>bytes_per_token</parametername>
</parameternamelist>
<parameterdescription>
<para>Bytes per token (0 disables). </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>tokens</parametername>
</parameternamelist>
<parameterdescription>
<para>Number of generated tokens for this call. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>stride_bytes</parametername>
</parameternamelist>
<parameterdescription>
<para>Unused (kept for symmetry with CPU touch). </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>verify_touch</parametername>
</parameternamelist>
<parameterdescription>
<para>If nonzero, perform a small D2H copy. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>0 on success, nonzero on failure. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="697" column="12" bodyfile="engine/src/main_infer.c" bodystart="697" bodyend="745"/>
        <references refid="main__infer_8c_1adf764cbdea00d65edcd07bb9953ad2b7a866c5293b3ba22bb820c78bfae10f9ed" compoundref="main__infer_8c" startline="634">CUDA_MEMCPY_DEVICE_TO_HOST</references>
        <references refid="structcudart__api_1a8885e8aa343a956388d6fc359994b5b6" compoundref="main__infer_8c" startline="648">cudart_api::cudaDeviceSynchronize</references>
        <references refid="structcudart__api_1a2c3660d016022d753aa36e57b5ed469c" compoundref="main__infer_8c" startline="644">cudart_api::cudaFree</references>
        <references refid="structcudart__api_1a90ebdb0591a336ef47414cd285d15371" compoundref="main__infer_8c" startline="645">cudart_api::cudaMalloc</references>
        <references refid="structcudart__api_1a6e790e818a18bd526582a098649f2f92" compoundref="main__infer_8c" startline="646">cudart_api::cudaMemcpy</references>
        <references refid="structcudart__api_1a7e9b278453c583049fcbb790bfa32c5d" compoundref="main__infer_8c" startline="647">cudart_api::cudaMemset</references>
        <references refid="main__infer_8c_1aca4f099fbc130845b4af6c57ca21b3ef" compoundref="main__infer_8c" startline="655" endline="687">cudart_get_api</references>
        <references refid="main__infer_8c_1a42d8c2f3c8817b30177d0a7e39742b03" compoundref="main__infer_8c" startline="117" endline="117">min_size</references>
        <references refid="main__infer_8c_1a86d500a34c624c2cae56bc25a31b12f3" compoundref="main__infer_8c" startline="85">UNUSED</references>
        <referencedby refid="main__infer_8c_1a3c04138a5bfe5d72780bb7e82a18e627" compoundref="main__infer_8c" startline="2362" endline="2740">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a7427a4a1579fb747a4ce22a4a1d4a80a" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void json_print_escaped_string</definition>
        <argsstring>(const char *s)</argsstring>
        <name>json_print_escaped_string</name>
        <param>
          <type>const char *</type>
          <declname>s</declname>
        </param>
        <briefdescription>
<para>JSON-escape and print a string value. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>s</parametername>
</parameternamelist>
<parameterdescription>
<para>Input UTF-8 string (may be NULL).</para>
</parameterdescription>
</parameteritem>
</parameterlist>
json_print_escaped_string.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>s</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="761" column="13" bodyfile="engine/src/main_infer.c" bodystart="761" bodyend="783"/>
        <referencedby refid="main__infer_8c_1a84b40472513bc66398c6d3049891f553" compoundref="main__infer_8c" startline="2171" endline="2334">print_json_result</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a0271a21f39c53534b7a1a3cc7eb94596" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void resolve_tokenizer_path</definition>
        <argsstring>(const char *model_dir, const char *tokenizer_opt, char *out, size_t outsz)</argsstring>
        <name>resolve_tokenizer_path</name>
        <param>
          <type>const char *</type>
          <declname>model_dir</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>tokenizer_opt</declname>
        </param>
        <param>
          <type>char *</type>
          <declname>out</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>outsz</declname>
        </param>
        <briefdescription>
<para>Resolve a tokenizer path under a model directory. </para>
        </briefdescription>
        <detaileddescription>
<para>Search order: 1) explicit override (tokenizer_opt) 2) &lt;model_dir&gt;/hf/original/tokenizer.tiktoken 3) &lt;model_dir&gt;/tokenizer.tiktoken 4) &lt;model_dir&gt;/original/tokenizer.tiktoken 5) &lt;model_dir&gt;/hf/original/tokenizer.json 6) &lt;model_dir&gt;/tokenizer.json 7) &lt;model_dir&gt;/original/tokenizer.json</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>model_dir</parametername>
</parameternamelist>
<parameterdescription>
<para>Model directory. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>tokenizer_opt</parametername>
</parameternamelist>
<parameterdescription>
<para>Optional explicit tokenizer path. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>out</parametername>
</parameternamelist>
<parameterdescription>
<para>Output path. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>outsz</parametername>
</parameternamelist>
<parameterdescription>
<para>Output capacity.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
resolve_tokenizer_path.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>model_dir</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>tokenizer_opt</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>out</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>outsz</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="810" column="13" bodyfile="engine/src/main_infer.c" bodystart="810" bodyend="841"/>
        <references refid="main__infer_8c_1adca9b33a342b8635e28ba51aecb365f6" compoundref="main__infer_8c" startline="297" endline="314">join_path</references>
        <references refid="main__infer_8c_1a0cbea455e9868581360f43c63db6554c" compoundref="main__infer_8c" startline="227" endline="231">path_exists</references>
        <references refid="main__infer_8c_1a35a9aadd511e6b3688d01a67a12c7651" compoundref="main__infer_8c" startline="258" endline="258">path_is_abs</references>
        <references refid="main__infer_8c_1ae688d728e1acdfe5988c7db45d6f0166" compoundref="main__infer_8c" startline="81">PATH_MAX</references>
        <references refid="main__infer_8c_1a210133797f21fcee710ec892841dce42" compoundref="main__infer_8c" startline="273" endline="280">safe_strcpy</references>
        <referencedby refid="main__infer_8c_1a3c04138a5bfe5d72780bb7e82a18e627" compoundref="main__infer_8c" startline="2362" endline="2740">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a4e30eb4737647a78c4dbebb5b008a5bd" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int decode_tokens_best_effort</definition>
        <argsstring>(const char *tok_path, const int *ids, size_t n, char **out_text)</argsstring>
        <name>decode_tokens_best_effort</name>
        <param>
          <type>const char *</type>
          <declname>tok_path</declname>
        </param>
        <param>
          <type>const int *</type>
          <declname>ids</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>n</declname>
        </param>
        <param>
          <type>char **</type>
          <declname>out_text</declname>
        </param>
        <briefdescription>
<para>Decode token IDs into UTF-8 text (best-effort). </para>
        </briefdescription>
        <detaileddescription>
<para>This uses the project tokenizer implementation. If decoding fails or the tokenizer cannot be opened (including vocab mismatch scenarios), a placeholder string &quot;&lt;id&gt;&lt;id&gt;...&quot; is emitted so output remains valid and debuggable.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>tok_path</parametername>
</parameternamelist>
<parameterdescription>
<para>Path to tokenizer file (tokenizer.json or tokenizer.tiktoken). </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>ids</parametername>
</parameternamelist>
<parameterdescription>
<para>Token IDs (engine output). </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>n</parametername>
</parameternamelist>
<parameterdescription>
<para>Number of IDs. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>out_text</parametername>
</parameternamelist>
<parameterdescription>
<para>Output allocated string (caller frees). NULL on failure. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>0 on success, nonzero on failure.</para>
</simplesect>
decode_tokens_best_effort.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>tok_path</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>ids</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>n</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>out_text</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>See implementation for details. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="866" column="12" bodyfile="engine/src/main_infer.c" bodystart="866" bodyend="965"/>
        <references refid="main__infer_8c_1a82ba5822565056bddf97d8b9d425d9b9" compoundref="main__infer_8c" startline="472" endline="478">ends_with</references>
        <references refid="ie__tokenizer__gptoss_8h_1ad4b875bec514bb9c1de945944e1596de" compoundref="tokenizer__gptoss_8c" startline="1795" endline="1811">ie_tok_gptoss_close</references>
        <references refid="ie__tokenizer__gptoss_8h_1ae372932b3912864351defd6ce553ed88" compoundref="tokenizer__gptoss_8c" startline="1818" endline="1889">ie_tok_gptoss_decode</references>
        <references refid="ie__tokenizer__gptoss_8h_1a1305696bd5b44e9ad4e2b624ce1b59f2a6e804d975236c9745c44c1db1baed259" compoundref="ie__tokenizer__gptoss_8h" startline="38">IE_TOK_GPTOSS_OK</references>
        <references refid="ie__tokenizer__gptoss_8h_1ae5c55dc1502414c60d1a99fa9fbdf1bc" compoundref="tokenizer__gptoss_8c" startline="1761" endline="1793">ie_tok_gptoss_open</references>
        <references refid="main__infer_8c_1a42d8c2f3c8817b30177d0a7e39742b03" compoundref="main__infer_8c" startline="117" endline="117">min_size</references>
        <referencedby refid="main__infer_8c_1a3c04138a5bfe5d72780bb7e82a18e627" compoundref="main__infer_8c" startline="2362" endline="2740">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1ad96d407a911fbb914fa8e4cfbf2faf0f" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void usage</definition>
        <argsstring>(void)</argsstring>
        <name>usage</name>
        <param>
          <type>void</type>
        </param>
        <briefdescription>
<para>Print CLI usage to stderr. </para>
        </briefdescription>
        <detaileddescription>
<para>usage. </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="1050" column="13" bodyfile="engine/src/main_infer.c" bodystart="1050" bodyend="1071"/>
        <referencedby refid="main__chat_8c_1a3c04138a5bfe5d72780bb7e82a18e627" compoundref="main__chat_8c" startline="185" endline="231">main</referencedby>
        <referencedby refid="main__infer_8c_1a456ba954f3884bcf5f72fc3e779de284" compoundref="main__infer_8c" startline="1308" endline="1500">parse_flags</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a25c42477bc56f4eb2d2a5c53e4510d70" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void cli_extras_defaults</definition>
        <argsstring>(cli_extras_t *e)</argsstring>
        <name>cli_extras_defaults</name>
        <param>
          <type><ref refid="main__infer_8c_1a9973434ae2443cc726369b714df7b2cb" kindref="member">cli_extras_t</ref> *</type>
          <declname>e</declname>
        </param>
        <briefdescription>
<para>Initialize CLI defaults. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>e</parametername>
</parameternamelist>
<parameterdescription>
<para>Options struct to fill.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
cli_extras_defaults.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>e</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="1082" column="13" bodyfile="engine/src/main_infer.c" bodystart="1082" bodyend="1138"/>
        <references refid="structcli__extras_1a313d0562dfb63a6350db5c84128fc074" compoundref="main__infer_8c" startline="988">cli_extras::affinity</references>
        <references refid="structcli__extras_1a4e233e0c7d76b4fb4338d7460a552707" compoundref="main__infer_8c" startline="996">cli_extras::aggregate</references>
        <references refid="structcli__extras_1a4af612c719a80234b4e753bc559f358c" compoundref="main__infer_8c" startline="993">cli_extras::batch</references>
        <references refid="main__infer_8c_1ae715f0cc745f58eebd4be50b187dd41da382ceb68dddaaf8b27ac21f144305e74" compoundref="main__infer_8c" startline="975">CLI_PRETX_NONE</references>
        <references refid="structcli__extras_1a4803d565f63afbb9307628d9dd82ed76" compoundref="main__infer_8c" startline="1023">cli_extras::debug_decode</references>
        <references refid="structcli__extras_1a5bae3dc5d381b3cfbb8e83a259adfd87" compoundref="main__infer_8c" startline="1024">cli_extras::debug_decode_every</references>
        <references refid="structcli__extras_1abc6b3f1feda1b61a09d60cd8057de580" compoundref="main__infer_8c" startline="1026">cli_extras::debug_topk</references>
        <references refid="structcli__extras_1adf504da6e8c550785c800720a31b9d5c" compoundref="main__infer_8c" startline="1027">cli_extras::debug_topk_every</references>
        <references refid="structcli__extras_1a50cd2ee771a9eee3fd448d2a1c0b5645" compoundref="main__infer_8c" startline="990">cli_extras::device</references>
        <references refid="structcli__extras_1a3b9c2202e0ba68aa4b3112779697a28e" compoundref="main__infer_8c" startline="1000">cli_extras::expected_tokens_file</references>
        <references refid="structcli__extras_1a9254cd2a3a77105eebdf34d7a1157176" compoundref="main__infer_8c" startline="1029">cli_extras::greedy</references>
        <references refid="structcli__extras_1af40082e05bf7e8eabeabec31f850da27" compoundref="main__infer_8c" startline="1021">cli_extras::log_every</references>
        <references refid="structcli__extras_1a9f8297928fead9608d99d8f612797a86" compoundref="main__infer_8c" startline="1020">cli_extras::log_tokens</references>
        <references refid="structcli__extras_1a5eb0317aa09b90f400b657245b41e92c" compoundref="main__infer_8c" startline="986">cli_extras::max_new</references>
        <references refid="structcli__extras_1ae2401ceced12a603aabefd22f57584bd" compoundref="main__infer_8c" startline="1006">cli_extras::model_bin</references>
        <references refid="structcli__extras_1aa52e671b92aa5a9099153b609a0c5792" compoundref="main__infer_8c" startline="1004">cli_extras::model_dir</references>
        <references refid="structcli__extras_1a96d26a6a2f436fb0b232d383f321c3e6" compoundref="main__infer_8c" startline="1005">cli_extras::model_json</references>
        <references refid="structcli__extras_1a49d7c958a59c223a1f66d6aedc796e68" compoundref="main__infer_8c" startline="1009">cli_extras::precision_from_flag</references>
        <references refid="structcli__extras_1a061a8ed1f6671ad018d99db180df06c2" compoundref="main__infer_8c" startline="1008">cli_extras::precision_label</references>
        <references refid="structcli__extras_1a01be4e3c92d754527967d04b729e4ee6" compoundref="main__infer_8c" startline="994">cli_extras::prefetch</references>
        <references refid="structcli__extras_1a648dda8436ede182650f29f0460fa6a3" compoundref="main__infer_8c" startline="989">cli_extras::pretx</references>
        <references refid="structcli__extras_1a553c6e455b22c4ff3cd6f00beb166eb7" compoundref="main__infer_8c" startline="1015">cli_extras::print_text</references>
        <references refid="structcli__extras_1aa45c7376781454d767d2202800c27a3e" compoundref="main__infer_8c" startline="985">cli_extras::prompt</references>
        <references refid="structcli__extras_1a992ba8185b17f227f60e2e570441b63f" compoundref="main__infer_8c" startline="992">cli_extras::prompts_file</references>
        <references refid="structcli__extras_1a69d2dd2e3fe09f5ff877aec31e16de34" compoundref="main__infer_8c" startline="1001">cli_extras::report_tokens</references>
        <references refid="structcli__extras_1a9a0cdb8214e4f1b8cd375e78dc81f064" compoundref="main__infer_8c" startline="1002">cli_extras::report_tokens_max</references>
        <references refid="structcli__extras_1a8c1b8fdbf9dc75a774e8b451608c961b" compoundref="main__infer_8c" startline="997">cli_extras::rounds</references>
        <references refid="structcli__extras_1a1afc1a4316a4a51394f6e5de9cdeff65" compoundref="main__infer_8c" startline="1032">cli_extras::seed</references>
        <references refid="structcli__extras_1afb0601c5b2854fd3375bfb96482cb92f" compoundref="main__infer_8c" startline="1031">cli_extras::seed_set</references>
        <references refid="structcli__extras_1af5f02b3c69e6a0e4882a5427db0ab994" compoundref="main__infer_8c" startline="1011">cli_extras::sparsity</references>
        <references refid="structcli__extras_1aeac7b5044a46ca251e3414887e1e712e" compoundref="main__infer_8c" startline="1012">cli_extras::sparsity_from_flag</references>
        <references refid="structcli__extras_1a272fb04cda4afdb3b9b7d83ce4fe2c8b" compoundref="main__infer_8c" startline="1035">cli_extras::temperature</references>
        <references refid="structcli__extras_1aa3770ad7c181aa251c580ca669993f74" compoundref="main__infer_8c" startline="1034">cli_extras::temperature_set</references>
        <references refid="structcli__extras_1a4e8cdca32127b81f8fcb41047a320844" compoundref="main__infer_8c" startline="987">cli_extras::threads</references>
        <references refid="structcli__extras_1af46939020f3ada099f4c932676dec6b7" compoundref="main__infer_8c" startline="1016">cli_extras::tokenizer_path</references>
        <references refid="structcli__extras_1ae32e771fdfaebdff9ef1f9c9d8cc3f8a" compoundref="main__infer_8c" startline="1041">cli_extras::top_k</references>
        <references refid="structcli__extras_1aa5d005be050ff9fc83025db8ef23076e" compoundref="main__infer_8c" startline="1040">cli_extras::top_k_set</references>
        <references refid="structcli__extras_1a9e2c7ce1dc9e8e4c4d3f110e880ed8c2" compoundref="main__infer_8c" startline="1038">cli_extras::top_p</references>
        <references refid="structcli__extras_1ae8fc1e6538cc0dcf7113755e23a5af2f" compoundref="main__infer_8c" startline="1037">cli_extras::top_p_set</references>
        <references refid="structcli__extras_1a3a19163210b87343cff3a796a2ed7c5a" compoundref="main__infer_8c" startline="1017">cli_extras::trace_ids_path</references>
        <references refid="structcli__extras_1a628bf363ee35fe852bbb6510455647bd" compoundref="main__infer_8c" startline="995">cli_extras::warmup_tokens</references>
        <referencedby refid="main__infer_8c_1a456ba954f3884bcf5f72fc3e779de284" compoundref="main__infer_8c" startline="1308" endline="1500">parse_flags</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a42cabe54dce1190125a12e4c0360ce22" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>long</type>
        <definition>static long safe_atoi</definition>
        <argsstring>(const char *s)</argsstring>
        <name>safe_atoi</name>
        <param>
          <type>const char *</type>
          <declname>s</declname>
        </param>
        <briefdescription>
<para>Parse a decimal integer safely (fatal on invalid input). </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>s</parametername>
</parameternamelist>
<parameterdescription>
<para>Input string. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Parsed value.</para>
</simplesect>
safe_atoi.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>s</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>See implementation for details. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="1152" column="13" bodyfile="engine/src/main_infer.c" bodystart="1152" bodyend="1164"/>
        <referencedby refid="main__infer_8c_1a456ba954f3884bcf5f72fc3e779de284" compoundref="main__infer_8c" startline="1308" endline="1500">parse_flags</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a50f7fd00c4c5f36d1ee065443d688251" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>uint64_t</type>
        <definition>static uint64_t safe_atoull</definition>
        <argsstring>(const char *s)</argsstring>
        <name>safe_atoull</name>
        <param>
          <type>const char *</type>
          <declname>s</declname>
        </param>
        <briefdescription>
<para>Parse an unsigned 64-bit integer safely (fatal on invalid input). </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>s</parametername>
</parameternamelist>
<parameterdescription>
<para>Input string. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Parsed value.</para>
</simplesect>
safe_atoull.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>s</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>See implementation for details. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="1178" column="17" bodyfile="engine/src/main_infer.c" bodystart="1178" bodyend="1190"/>
        <referencedby refid="main__infer_8c_1a456ba954f3884bcf5f72fc3e779de284" compoundref="main__infer_8c" startline="1308" endline="1500">parse_flags</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a040e339c57d801547a44a21545914526" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>double</type>
        <definition>static double safe_atof</definition>
        <argsstring>(const char *s)</argsstring>
        <name>safe_atof</name>
        <param>
          <type>const char *</type>
          <declname>s</declname>
        </param>
        <briefdescription>
<para>Parse a double safely (fatal on invalid input). </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>s</parametername>
</parameternamelist>
<parameterdescription>
<para>Input string. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Parsed value.</para>
</simplesect>
safe_atof.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>s</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>See implementation for details. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="1204" column="15" bodyfile="engine/src/main_infer.c" bodystart="1204" bodyend="1216"/>
        <referencedby refid="main__infer_8c_1a456ba954f3884bcf5f72fc3e779de284" compoundref="main__infer_8c" startline="1308" endline="1500">parse_flags</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1ac50de02cf90e21f66e0681932f39334f" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void apply_cli_debug_env</definition>
        <argsstring>(const cli_extras_t *opt)</argsstring>
        <name>apply_cli_debug_env</name>
        <param>
          <type>const <ref refid="main__infer_8c_1a9973434ae2443cc726369b714df7b2cb" kindref="member">cli_extras_t</ref> *</type>
          <declname>opt</declname>
        </param>
        <briefdescription>
<para>Apply CLI deterministic/debug knobs by setting environment variables. </para>
        </briefdescription>
        <detaileddescription>
<para>This avoids widening the public API and keeps debug behavior available to the benchmark harness and humans consistently.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>opt</parametername>
</parameternamelist>
<parameterdescription>
<para>Parsed CLI options (may be NULL).</para>
</parameterdescription>
</parameteritem>
</parameterlist>
apply_cli_debug_env.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>opt</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="1231" column="13" bodyfile="engine/src/main_infer.c" bodystart="1231" bodyend="1286"/>
        <references refid="structcli__extras_1a4803d565f63afbb9307628d9dd82ed76" compoundref="main__infer_8c" startline="1023">cli_extras::debug_decode</references>
        <references refid="structcli__extras_1a5bae3dc5d381b3cfbb8e83a259adfd87" compoundref="main__infer_8c" startline="1024">cli_extras::debug_decode_every</references>
        <references refid="structcli__extras_1abc6b3f1feda1b61a09d60cd8057de580" compoundref="main__infer_8c" startline="1026">cli_extras::debug_topk</references>
        <references refid="structcli__extras_1adf504da6e8c550785c800720a31b9d5c" compoundref="main__infer_8c" startline="1027">cli_extras::debug_topk_every</references>
        <references refid="structcli__extras_1a9254cd2a3a77105eebdf34d7a1157176" compoundref="main__infer_8c" startline="1029">cli_extras::greedy</references>
        <references refid="structcli__extras_1af40082e05bf7e8eabeabec31f850da27" compoundref="main__infer_8c" startline="1021">cli_extras::log_every</references>
        <references refid="structcli__extras_1a9f8297928fead9608d99d8f612797a86" compoundref="main__infer_8c" startline="1020">cli_extras::log_tokens</references>
        <references refid="structcli__extras_1a1afc1a4316a4a51394f6e5de9cdeff65" compoundref="main__infer_8c" startline="1032">cli_extras::seed</references>
        <references refid="structcli__extras_1afb0601c5b2854fd3375bfb96482cb92f" compoundref="main__infer_8c" startline="1031">cli_extras::seed_set</references>
        <references refid="structcli__extras_1a272fb04cda4afdb3b9b7d83ce4fe2c8b" compoundref="main__infer_8c" startline="1035">cli_extras::temperature</references>
        <references refid="structcli__extras_1aa3770ad7c181aa251c580ca669993f74" compoundref="main__infer_8c" startline="1034">cli_extras::temperature_set</references>
        <references refid="structcli__extras_1ae32e771fdfaebdff9ef1f9c9d8cc3f8a" compoundref="main__infer_8c" startline="1041">cli_extras::top_k</references>
        <references refid="structcli__extras_1aa5d005be050ff9fc83025db8ef23076e" compoundref="main__infer_8c" startline="1040">cli_extras::top_k_set</references>
        <references refid="structcli__extras_1a9e2c7ce1dc9e8e4c4d3f110e880ed8c2" compoundref="main__infer_8c" startline="1038">cli_extras::top_p</references>
        <references refid="structcli__extras_1ae8fc1e6538cc0dcf7113755e23a5af2f" compoundref="main__infer_8c" startline="1037">cli_extras::top_p_set</references>
        <references refid="structcli__extras_1a3a19163210b87343cff3a796a2ed7c5a" compoundref="main__infer_8c" startline="1017">cli_extras::trace_ids_path</references>
        <referencedby refid="main__infer_8c_1a3c04138a5bfe5d72780bb7e82a18e627" compoundref="main__infer_8c" startline="2362" endline="2740">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a456ba954f3884bcf5f72fc3e779de284" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int parse_flags</definition>
        <argsstring>(int argc, char **argv, cli_extras_t *out)</argsstring>
        <name>parse_flags</name>
        <param>
          <type>int</type>
          <declname>argc</declname>
        </param>
        <param>
          <type>char **</type>
          <declname>argv</declname>
        </param>
        <param>
          <type><ref refid="main__infer_8c_1a9973434ae2443cc726369b714df7b2cb" kindref="member">cli_extras_t</ref> *</type>
          <declname>out</declname>
        </param>
        <briefdescription>
<para>Parse CLI flags into cli_extras_t. </para>
        </briefdescription>
        <detaileddescription>
<para>Parsing is intentionally strict: invalid flags or values return nonzero to keep harness behavior deterministic.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>argc</parametername>
</parameternamelist>
<parameterdescription>
<para>argc. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>argv</parametername>
</parameternamelist>
<parameterdescription>
<para>argv. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>out</parametername>
</parameternamelist>
<parameterdescription>
<para>Output options. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>0 on success, nonzero on help/error.</para>
</simplesect>
parse_flags.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>argc</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>argv</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>out</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>See implementation for details. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="1308" column="12" bodyfile="engine/src/main_infer.c" bodystart="1308" bodyend="1500"/>
        <references refid="main__infer_8c_1a72ab94aafe7740f1343d317daa89ca15" compoundref="main__infer_8c" startline="166" endline="176">ascii_ieq</references>
        <references refid="main__infer_8c_1a25c42477bc56f4eb2d2a5c53e4510d70" compoundref="main__infer_8c" startline="1082" endline="1138">cli_extras_defaults</references>
        <references refid="main__infer_8c_1ae715f0cc745f58eebd4be50b187dd41da4fad867319e4f9197a9c373762a3ad54" compoundref="main__infer_8c" startline="978">CLI_PRETX_ALL</references>
        <references refid="main__infer_8c_1ae715f0cc745f58eebd4be50b187dd41da382ceb68dddaaf8b27ac21f144305e74" compoundref="main__infer_8c" startline="975">CLI_PRETX_NONE</references>
        <references refid="main__infer_8c_1ae715f0cc745f58eebd4be50b187dd41da9d22d4f265254a65af9fc3a7d648fe5d" compoundref="main__infer_8c" startline="976">CLI_PRETX_WOH</references>
        <references refid="main__infer_8c_1ae715f0cc745f58eebd4be50b187dd41da1a251ee24fdcadcaf9c888e0a96140e7" compoundref="main__infer_8c" startline="977">CLI_PRETX_WXH</references>
        <references refid="main__infer_8c_1a040e339c57d801547a44a21545914526" compoundref="main__infer_8c" startline="1204" endline="1216">safe_atof</references>
        <references refid="main__infer_8c_1a42cabe54dce1190125a12e4c0360ce22" compoundref="main__infer_8c" startline="1152" endline="1164">safe_atoi</references>
        <references refid="main__infer_8c_1a50f7fd00c4c5f36d1ee065443d688251" compoundref="main__infer_8c" startline="1178" endline="1190">safe_atoull</references>
        <references refid="main__infer_8c_1ad96d407a911fbb914fa8e4cfbf2faf0f" compoundref="main__infer_8c" startline="1050" endline="1071">usage</references>
        <referencedby refid="main__infer_8c_1a3c04138a5bfe5d72780bb7e82a18e627" compoundref="main__infer_8c" startline="2362" endline="2740">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a609fc6d778b714530dadf2ef012acf5c" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int read_first_nonempty_line</definition>
        <argsstring>(const char *path, char *buf, size_t bufsz)</argsstring>
        <name>read_first_nonempty_line</name>
        <param>
          <type>const char *</type>
          <declname>path</declname>
        </param>
        <param>
          <type>char *</type>
          <declname>buf</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>bufsz</declname>
        </param>
        <briefdescription>
<para>Read the first non-empty line from a text file. </para>
        </briefdescription>
        <detaileddescription>
<para>This helper is preserved for compatibility and for quick, human-friendly runs. The benchmark harness should use <computeroutput>--prompts-file</computeroutput> (and will automatically enable <computeroutput>--aggregate</computeroutput> when no explicit <computeroutput>--prompt</computeroutput> is provided).</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>path</parametername>
</parameternamelist>
<parameterdescription>
<para>File path. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>buf</parametername>
</parameternamelist>
<parameterdescription>
<para>Output buffer. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>bufsz</parametername>
</parameternamelist>
<parameterdescription>
<para>Output capacity. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>1 if a line was read, 0 if none, -1 on error.</para>
</simplesect>
read_first_nonempty_line.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>path</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>buf</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>bufsz</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>See implementation for details. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="1527" column="12" bodyfile="engine/src/main_infer.c" bodystart="1527" bodyend="1545"/>
        <referencedby refid="main__infer_8c_1a3c04138a5bfe5d72780bb7e82a18e627" compoundref="main__infer_8c" startline="2362" endline="2740">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a9891db61dca3c60715c6b2f7aad7f5a1" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void prompt_list_init</definition>
        <argsstring>(prompt_list_t *pl)</argsstring>
        <name>prompt_list_init</name>
        <param>
          <type><ref refid="main__infer_8c_1aa2c236bcd5a489e1a409ffd5f4c532f7" kindref="member">prompt_list_t</ref> *</type>
          <declname>pl</declname>
        </param>
        <briefdescription>
<para>Initialize an empty prompt list. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>pl</parametername>
</parameternamelist>
<parameterdescription>
<para>Prompt list to initialize.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
prompt_list_init.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>pl</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="1565" column="13" bodyfile="engine/src/main_infer.c" bodystart="1565" bodyend="1570"/>
        <references refid="structprompt__list_1a1b38f2bff67306ab0d56dfa5017c2302" compoundref="main__infer_8c" startline="1553">prompt_list::cap</references>
        <references refid="structprompt__list_1ab60c60299e5806652f4c2c7a94aca5c3" compoundref="main__infer_8c" startline="1552">prompt_list::count</references>
        <references refid="structprompt__list_1ad4b457e3153a399812c91acb3d2f399f" compoundref="main__infer_8c" startline="1551">prompt_list::items</references>
        <referencedby refid="main__infer_8c_1a3c04138a5bfe5d72780bb7e82a18e627" compoundref="main__infer_8c" startline="2362" endline="2740">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1ab06a46b9f23d08de776ec7d3258b6588" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void prompt_list_free</definition>
        <argsstring>(prompt_list_t *pl)</argsstring>
        <name>prompt_list_free</name>
        <param>
          <type><ref refid="main__infer_8c_1aa2c236bcd5a489e1a409ffd5f4c532f7" kindref="member">prompt_list_t</ref> *</type>
          <declname>pl</declname>
        </param>
        <briefdescription>
<para>Free a prompt list and all owned strings. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>pl</parametername>
</parameternamelist>
<parameterdescription>
<para>Prompt list to free.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
prompt_list_free.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>pl</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="1581" column="13" bodyfile="engine/src/main_infer.c" bodystart="1581" bodyend="1590"/>
        <references refid="structprompt__list_1a1b38f2bff67306ab0d56dfa5017c2302" compoundref="main__infer_8c" startline="1553">prompt_list::cap</references>
        <references refid="structprompt__list_1ab60c60299e5806652f4c2c7a94aca5c3" compoundref="main__infer_8c" startline="1552">prompt_list::count</references>
        <references refid="structprompt__list_1ad4b457e3153a399812c91acb3d2f399f" compoundref="main__infer_8c" startline="1551">prompt_list::items</references>
        <referencedby refid="main__infer_8c_1a3c04138a5bfe5d72780bb7e82a18e627" compoundref="main__infer_8c" startline="2362" endline="2740">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a9be857b0051297813c2cb218accbb5c8" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int prompt_list_push_copy</definition>
        <argsstring>(prompt_list_t *pl, const char *s)</argsstring>
        <name>prompt_list_push_copy</name>
        <param>
          <type><ref refid="main__infer_8c_1aa2c236bcd5a489e1a409ffd5f4c532f7" kindref="member">prompt_list_t</ref> *</type>
          <declname>pl</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>s</declname>
        </param>
        <briefdescription>
<para>Push a prompt string copy into the list. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>pl</parametername>
</parameternamelist>
<parameterdescription>
<para>Prompt list. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>s</parametername>
</parameternamelist>
<parameterdescription>
<para>Prompt string (must be non-NULL). </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>0 on success, nonzero on OOM.</para>
</simplesect>
prompt_list_push_copy.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>pl</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>s</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>See implementation for details. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="1606" column="12" bodyfile="engine/src/main_infer.c" bodystart="1606" bodyend="1622"/>
        <references refid="structprompt__list_1a1b38f2bff67306ab0d56dfa5017c2302" compoundref="main__infer_8c" startline="1553">prompt_list::cap</references>
        <references refid="structprompt__list_1ab60c60299e5806652f4c2c7a94aca5c3" compoundref="main__infer_8c" startline="1552">prompt_list::count</references>
        <references refid="main__infer_8c_1a39103ce72021a890c3e333b949068a1c" compoundref="main__infer_8c" startline="449" endline="456">heap_strdup</references>
        <references refid="structprompt__list_1ad4b457e3153a399812c91acb3d2f399f" compoundref="main__infer_8c" startline="1551">prompt_list::items</references>
        <referencedby refid="main__infer_8c_1a3c04138a5bfe5d72780bb7e82a18e627" compoundref="main__infer_8c" startline="2362" endline="2740">main</referencedby>
        <referencedby refid="main__infer_8c_1a3d826199fc8a9ddb8a49f324c2ff1dc5" compoundref="main__infer_8c" startline="1641" endline="1668">prompt_list_read_file</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a3d826199fc8a9ddb8a49f324c2ff1dc5" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int prompt_list_read_file</definition>
        <argsstring>(const char *path, prompt_list_t *out)</argsstring>
        <name>prompt_list_read_file</name>
        <param>
          <type>const char *</type>
          <declname>path</declname>
        </param>
        <param>
          <type><ref refid="main__infer_8c_1aa2c236bcd5a489e1a409ffd5f4c532f7" kindref="member">prompt_list_t</ref> *</type>
          <declname>out</declname>
        </param>
        <briefdescription>
<para>Read all non-empty lines from a prompts file into memory. </para>
        </briefdescription>
        <detaileddescription>
<para>Lines are trimmed of trailing CR/LF. Empty lines are skipped.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>path</parametername>
</parameternamelist>
<parameterdescription>
<para>Prompts file path. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>out</parametername>
</parameternamelist>
<parameterdescription>
<para>Prompt list to fill (must be initialized). </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>0 on success, nonzero on failure.</para>
</simplesect>
prompt_list_read_file.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>path</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>out</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>See implementation for details. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="1641" column="12" bodyfile="engine/src/main_infer.c" bodystart="1641" bodyend="1668"/>
        <references refid="main__infer_8c_1a9be857b0051297813c2cb218accbb5c8" compoundref="main__infer_8c" startline="1606" endline="1622">prompt_list_push_copy</references>
        <referencedby refid="main__infer_8c_1a3c04138a5bfe5d72780bb7e82a18e627" compoundref="main__infer_8c" startline="2362" endline="2740">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1ad7f42b712b3e86af5d9f8c9942bc8875" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>uint64_t</type>
        <definition>static uint64_t prompt_id_fnv1a64</definition>
        <argsstring>(const char *s)</argsstring>
        <name>prompt_id_fnv1a64</name>
        <param>
          <type>const char *</type>
          <declname>s</declname>
        </param>
        <briefdescription>
<para>Compute a stable 64-bit prompt ID (FNV-1a over bytes). </para>
        </briefdescription>
        <detaileddescription>
<para>This avoids storing or parsing raw prompt strings in the golden file and keeps the comparison logic simple and deterministic.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>s</parametername>
</parameternamelist>
<parameterdescription>
<para>Prompt string (UTF-8). </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>64-bit FNV-1a hash of the prompt bytes.</para>
</simplesect>
prompt_id_fnv1a64.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>s</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>See implementation for details. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="1690" column="17" bodyfile="engine/src/main_infer.c" bodystart="1690" bodyend="1703"/>
        <referencedby refid="main__infer_8c_1a3c04138a5bfe5d72780bb7e82a18e627" compoundref="main__infer_8c" startline="2362" endline="2740">main</referencedby>
        <referencedby refid="main__infer_8c_1a84b40472513bc66398c6d3049891f553" compoundref="main__infer_8c" startline="2171" endline="2334">print_json_result</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a2749355bb9d419963e15e9a58395f63e" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int parse_u64_auto</definition>
        <argsstring>(const char *s, uint64_t *out)</argsstring>
        <name>parse_u64_auto</name>
        <param>
          <type>const char *</type>
          <declname>s</declname>
        </param>
        <param>
          <type>uint64_t *</type>
          <declname>out</declname>
        </param>
        <briefdescription>
<para>Parse an unsigned 64-bit integer in decimal or 0x-prefixed hex. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>s</parametername>
</parameternamelist>
<parameterdescription>
<para>Input string. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>out</parametername>
</parameternamelist>
<parameterdescription>
<para>Parsed value. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>0 on success, nonzero on failure.</para>
</simplesect>
parse_u64_auto.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>s</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>out</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>See implementation for details. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="1719" column="12" bodyfile="engine/src/main_infer.c" bodystart="1719" bodyend="1733"/>
        <referencedby refid="main__infer_8c_1a84acee847ca644179eff86e6406bf230" compoundref="main__infer_8c" startline="1944" endline="1998">expected_tokens_table_load</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a7170af3ba79ee074b29ac13736ec97bf" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void expected_tokens_table_init</definition>
        <argsstring>(expected_tokens_table_t *t)</argsstring>
        <name>expected_tokens_table_init</name>
        <param>
          <type><ref refid="main__infer_8c_1ac519a155900b9eda4cab9d3a9a74dd62" kindref="member">expected_tokens_table_t</ref> *</type>
          <declname>t</declname>
        </param>
        <briefdescription>
<para>Initialize an expected-tokens table. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>t</parametername>
</parameternamelist>
<parameterdescription>
<para>Table.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
expected_tokens_table_init.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>t</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="1764" column="13" bodyfile="engine/src/main_infer.c" bodystart="1764" bodyend="1769"/>
        <references refid="structexpected__tokens__table_1a5193e78a49adc7c59b61f0350048e886" compoundref="main__infer_8c" startline="1752">expected_tokens_table::cap</references>
        <references refid="structexpected__tokens__table_1a4a94ac05263628a477831280444a57a4" compoundref="main__infer_8c" startline="1751">expected_tokens_table::count</references>
        <references refid="structexpected__tokens__table_1a276e1939826f5ce628faaef8db9e126c" compoundref="main__infer_8c" startline="1750">expected_tokens_table::entries</references>
        <referencedby refid="main__infer_8c_1a84acee847ca644179eff86e6406bf230" compoundref="main__infer_8c" startline="1944" endline="1998">expected_tokens_table_load</referencedby>
        <referencedby refid="main__infer_8c_1a3c04138a5bfe5d72780bb7e82a18e627" compoundref="main__infer_8c" startline="2362" endline="2740">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a470ca5b37dd720b5de391932c452af36" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void expected_tokens_table_free</definition>
        <argsstring>(expected_tokens_table_t *t)</argsstring>
        <name>expected_tokens_table_free</name>
        <param>
          <type><ref refid="main__infer_8c_1ac519a155900b9eda4cab9d3a9a74dd62" kindref="member">expected_tokens_table_t</ref> *</type>
          <declname>t</declname>
        </param>
        <briefdescription>
<para>Free an expected-tokens table. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>t</parametername>
</parameternamelist>
<parameterdescription>
<para>Table.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
expected_tokens_table_free.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>t</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="1780" column="13" bodyfile="engine/src/main_infer.c" bodystart="1780" bodyend="1789"/>
        <references refid="structexpected__tokens__table_1a5193e78a49adc7c59b61f0350048e886" compoundref="main__infer_8c" startline="1752">expected_tokens_table::cap</references>
        <references refid="structexpected__tokens__table_1a4a94ac05263628a477831280444a57a4" compoundref="main__infer_8c" startline="1751">expected_tokens_table::count</references>
        <references refid="structexpected__tokens__table_1a276e1939826f5ce628faaef8db9e126c" compoundref="main__infer_8c" startline="1750">expected_tokens_table::entries</references>
        <references refid="structexpected__tokens__entry_1a959f62b26acb1af16f22d85b55b0df78" compoundref="main__infer_8c" startline="1742">expected_tokens_entry::tokens</references>
        <referencedby refid="main__infer_8c_1a84acee847ca644179eff86e6406bf230" compoundref="main__infer_8c" startline="1944" endline="1998">expected_tokens_table_load</referencedby>
        <referencedby refid="main__infer_8c_1a3c04138a5bfe5d72780bb7e82a18e627" compoundref="main__infer_8c" startline="2362" endline="2740">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1adc35a14cb1b2caeca261416dfa41edee" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int expected_tokens_table_push</definition>
        <argsstring>(expected_tokens_table_t *t, uint64_t prompt_id, int *tokens, size_t n_tokens)</argsstring>
        <name>expected_tokens_table_push</name>
        <param>
          <type><ref refid="main__infer_8c_1ac519a155900b9eda4cab9d3a9a74dd62" kindref="member">expected_tokens_table_t</ref> *</type>
          <declname>t</declname>
        </param>
        <param>
          <type>uint64_t</type>
          <declname>prompt_id</declname>
        </param>
        <param>
          <type>int *</type>
          <declname>tokens</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>n_tokens</declname>
        </param>
        <briefdescription>
<para>Append an entry to the expected-tokens table. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>t</parametername>
</parameternamelist>
<parameterdescription>
<para>Table. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>prompt_id</parametername>
</parameternamelist>
<parameterdescription>
<para>Prompt ID. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>tokens</parametername>
</parameternamelist>
<parameterdescription>
<para>Owned token array (moved). </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>n_tokens</parametername>
</parameternamelist>
<parameterdescription>
<para>Number of tokens. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>0 on success, nonzero on failure. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="1799" column="12" bodyfile="engine/src/main_infer.c" bodystart="1799" bodyend="1818"/>
        <references refid="structexpected__tokens__table_1a5193e78a49adc7c59b61f0350048e886" compoundref="main__infer_8c" startline="1752">expected_tokens_table::cap</references>
        <references refid="structexpected__tokens__table_1a4a94ac05263628a477831280444a57a4" compoundref="main__infer_8c" startline="1751">expected_tokens_table::count</references>
        <references refid="structexpected__tokens__table_1a276e1939826f5ce628faaef8db9e126c" compoundref="main__infer_8c" startline="1750">expected_tokens_table::entries</references>
        <references refid="structexpected__tokens__entry_1adbef90e357d95fb8c8658ef20993593f" compoundref="main__infer_8c" startline="1743">expected_tokens_entry::n_tokens</references>
        <references refid="structexpected__tokens__entry_1a916080ab2649c9f4d225ed57d4ee32f5" compoundref="main__infer_8c" startline="1741">expected_tokens_entry::prompt_id</references>
        <references refid="structexpected__tokens__entry_1a959f62b26acb1af16f22d85b55b0df78" compoundref="main__infer_8c" startline="1742">expected_tokens_entry::tokens</references>
        <referencedby refid="main__infer_8c_1a84acee847ca644179eff86e6406bf230" compoundref="main__infer_8c" startline="1944" endline="1998">expected_tokens_table_load</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a3a307125ca4048deb177277c8e72bbfe" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int expected_tokens_compare</definition>
        <argsstring>(const int *expected, size_t n_expected, const int *actual, size_t n_actual, size_t *mismatch_index, int *expected_at, int *actual_at)</argsstring>
        <name>expected_tokens_compare</name>
        <param>
          <type>const int *</type>
          <declname>expected</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>n_expected</declname>
        </param>
        <param>
          <type>const int *</type>
          <declname>actual</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>n_actual</declname>
        </param>
        <param>
          <type>size_t *</type>
          <declname>mismatch_index</declname>
        </param>
        <param>
          <type>int *</type>
          <declname>expected_at</declname>
        </param>
        <param>
          <type>int *</type>
          <declname>actual_at</declname>
        </param>
        <briefdescription>
<para>Compare actual tokens against expected tokens for one prompt. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>expected</parametername>
</parameternamelist>
<parameterdescription>
<para>Expected token IDs. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>n_expected</parametername>
</parameternamelist>
<parameterdescription>
<para>Number of expected tokens. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>actual</parametername>
</parameternamelist>
<parameterdescription>
<para>Actual token IDs. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>n_actual</parametername>
</parameternamelist>
<parameterdescription>
<para>Number of actual tokens. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>mismatch_index</parametername>
</parameternamelist>
<parameterdescription>
<para>Output: first mismatch index (valid when return is nonzero). </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>expected_at</parametername>
</parameternamelist>
<parameterdescription>
<para>Output: expected token at mismatch (valid when return is nonzero). </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>actual_at</parametername>
</parameternamelist>
<parameterdescription>
<para>Output: actual token at mismatch (valid when return is nonzero). </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>0 when equal (length and contents), nonzero otherwise. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="1832" column="12" bodyfile="engine/src/main_infer.c" bodystart="1832" bodyend="1859"/>
        <referencedby refid="main__infer_8c_1a3c04138a5bfe5d72780bb7e82a18e627" compoundref="main__infer_8c" startline="2362" endline="2740">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1adaa53124eb0654f14346cf02af06b891" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int parse_token_list_inplace</definition>
        <argsstring>(char *s, int **out_tokens, size_t *out_n)</argsstring>
        <name>parse_token_list_inplace</name>
        <param>
          <type>char *</type>
          <declname>s</declname>
        </param>
        <param>
          <type>int **</type>
          <declname>out_tokens</declname>
        </param>
        <param>
          <type>size_t *</type>
          <declname>out_n</declname>
        </param>
        <briefdescription>
<para>Parse a comma-separated list of integers. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>s</parametername>
</parameternamelist>
<parameterdescription>
<para>Input string (modified by this function). </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>out_tokens</parametername>
</parameternamelist>
<parameterdescription>
<para>Output allocated token array (owned by caller on success). </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>out_n</parametername>
</parameternamelist>
<parameterdescription>
<para>Output token count. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>0 on success, nonzero on failure.</para>
</simplesect>
parse_token_list_inplace.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>s</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>out_tokens</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>out_n</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>See implementation for details. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="1877" column="12" bodyfile="engine/src/main_infer.c" bodystart="1877" bodyend="1919"/>
        <referencedby refid="main__infer_8c_1a84acee847ca644179eff86e6406bf230" compoundref="main__infer_8c" startline="1944" endline="1998">expected_tokens_table_load</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a84acee847ca644179eff86e6406bf230" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int expected_tokens_table_load</definition>
        <argsstring>(const char *path, expected_tokens_table_t *out)</argsstring>
        <name>expected_tokens_table_load</name>
        <param>
          <type>const char *</type>
          <declname>path</declname>
        </param>
        <param>
          <type><ref refid="main__infer_8c_1ac519a155900b9eda4cab9d3a9a74dd62" kindref="member">expected_tokens_table_t</ref> *</type>
          <declname>out</declname>
        </param>
        <briefdescription>
<para>Load expected tokens from a text file. </para>
        </briefdescription>
        <detaileddescription>
<para>File format (one entry per line):<itemizedlist>
<listitem><para>Leading/trailing whitespace is allowed.</para>
</listitem><listitem><para>Empty lines and lines beginning with &apos;#&apos; are ignored.</para>
</listitem><listitem><para>Each entry is: &lt;prompt_id&gt; &lt;whitespace&gt; &lt;token0,token1,token2,...&gt;</para>
</listitem></itemizedlist>
</para>
<para>prompt_id can be decimal or 0x-prefixed hex. The prompt_id is the FNV-1a hash of the prompt bytes, as returned by <ref refid="main__infer_8c_1ad7f42b712b3e86af5d9f8c9942bc8875" kindref="member">prompt_id_fnv1a64</ref>.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>path</parametername>
</parameternamelist>
<parameterdescription>
<para>Expected tokens file path. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>out</parametername>
</parameternamelist>
<parameterdescription>
<para>Output table (initialized by this function). </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>0 on success, nonzero on failure.</para>
</simplesect>
expected_tokens_table_load.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>path</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>out</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>See implementation for details. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="1944" column="12" bodyfile="engine/src/main_infer.c" bodystart="1944" bodyend="1998"/>
        <references refid="main__infer_8c_1a470ca5b37dd720b5de391932c452af36" compoundref="main__infer_8c" startline="1780" endline="1789">expected_tokens_table_free</references>
        <references refid="main__infer_8c_1a7170af3ba79ee074b29ac13736ec97bf" compoundref="main__infer_8c" startline="1764" endline="1769">expected_tokens_table_init</references>
        <references refid="main__infer_8c_1adc35a14cb1b2caeca261416dfa41edee" compoundref="main__infer_8c" startline="1799" endline="1818">expected_tokens_table_push</references>
        <references refid="main__infer_8c_1adaa53124eb0654f14346cf02af06b891" compoundref="main__infer_8c" startline="1877" endline="1919">parse_token_list_inplace</references>
        <references refid="main__infer_8c_1a2749355bb9d419963e15e9a58395f63e" compoundref="main__infer_8c" startline="1719" endline="1733">parse_u64_auto</references>
        <referencedby refid="main__infer_8c_1a3c04138a5bfe5d72780bb7e82a18e627" compoundref="main__infer_8c" startline="2362" endline="2740">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a0b4d248d44b83ac2a6b5f47b47fe15df" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>const <ref refid="main__infer_8c_1ae3d72519a21dd8c22c60d86104a0c151" kindref="member">expected_tokens_entry_t</ref> *</type>
        <definition>static const expected_tokens_entry_t * expected_tokens_find</definition>
        <argsstring>(const expected_tokens_table_t *t, uint64_t prompt_id)</argsstring>
        <name>expected_tokens_find</name>
        <param>
          <type>const <ref refid="main__infer_8c_1ac519a155900b9eda4cab9d3a9a74dd62" kindref="member">expected_tokens_table_t</ref> *</type>
          <declname>t</declname>
        </param>
        <param>
          <type>uint64_t</type>
          <declname>prompt_id</declname>
        </param>
        <briefdescription>
<para>Find an expected entry by prompt ID. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>t</parametername>
</parameternamelist>
<parameterdescription>
<para>Table (may be NULL). </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>prompt_id</parametername>
</parameternamelist>
<parameterdescription>
<para>Prompt ID. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Pointer to entry or NULL when not found. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="2006" column="38" bodyfile="engine/src/main_infer.c" bodystart="2006" bodyend="2013"/>
        <references refid="structexpected__tokens__table_1a4a94ac05263628a477831280444a57a4" compoundref="main__infer_8c" startline="1751">expected_tokens_table::count</references>
        <references refid="structexpected__tokens__table_1a276e1939826f5ce628faaef8db9e126c" compoundref="main__infer_8c" startline="1750">expected_tokens_table::entries</references>
        <references refid="structexpected__tokens__entry_1a916080ab2649c9f4d225ed57d4ee32f5" compoundref="main__infer_8c" startline="1741">expected_tokens_entry::prompt_id</references>
        <referencedby refid="main__infer_8c_1a3c04138a5bfe5d72780bb7e82a18e627" compoundref="main__infer_8c" startline="2362" endline="2740">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1af91bda098d580c2cf56b5beda68bd2d5" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void report_token_buf_free</definition>
        <argsstring>(report_token_buf_t *b)</argsstring>
        <name>report_token_buf_free</name>
        <param>
          <type><ref refid="main__infer_8c_1aeaf1944cb54f4e8f7a914be88b362163" kindref="member">report_token_buf_t</ref> *</type>
          <declname>b</declname>
        </param>
        <briefdescription>
<para>Free a report token buffer. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>b</parametername>
</parameternamelist>
<parameterdescription>
<para>Buffer.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
report_token_buf_free.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>b</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="2036" column="13" bodyfile="engine/src/main_infer.c" bodystart="2036" bodyend="2041"/>
        <references refid="structreport__token__buf_1a91b6556df06c25b311255a4a16f785dd" compoundref="main__infer_8c" startline="2023">report_token_buf::ids</references>
        <references refid="structreport__token__buf_1a89ffa03443f19bf77470f85a92baa245" compoundref="main__infer_8c" startline="2024">report_token_buf::n</references>
        <referencedby refid="main__infer_8c_1aa8860ddc49714b553fe669c784885cff" compoundref="main__infer_8c" startline="2113" endline="2118">prompt_round_record_free</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a23f6c5852d73ecbdb1dead2be803bcf0" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int report_token_buf_copy</definition>
        <argsstring>(const int *ids, size_t n, size_t max_keep, report_token_buf_t *out)</argsstring>
        <name>report_token_buf_copy</name>
        <param>
          <type>const int *</type>
          <declname>ids</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>n</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>max_keep</declname>
        </param>
        <param>
          <type><ref refid="main__infer_8c_1aeaf1944cb54f4e8f7a914be88b362163" kindref="member">report_token_buf_t</ref> *</type>
          <declname>out</declname>
        </param>
        <briefdescription>
<para>Copy tokens into a report token buffer (truncating if requested). </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>ids</parametername>
</parameternamelist>
<parameterdescription>
<para>Input token IDs. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>n</parametername>
</parameternamelist>
<parameterdescription>
<para>Input token count. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>max_keep</parametername>
</parameternamelist>
<parameterdescription>
<para>Maximum tokens to keep (0 keeps all). </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>out</parametername>
</parameternamelist>
<parameterdescription>
<para>Output buffer (owned). </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>0 on success, nonzero on OOM.</para>
</simplesect>
report_token_buf_copy.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>ids</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>n</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>max_keep</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>out</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>See implementation for details. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="2062" column="12" bodyfile="engine/src/main_infer.c" bodystart="2062" bodyend="2077"/>
        <referencedby refid="main__infer_8c_1a3c04138a5bfe5d72780bb7e82a18e627" compoundref="main__infer_8c" startline="2362" endline="2740">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1aa8860ddc49714b553fe669c784885cff" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void prompt_round_record_free</definition>
        <argsstring>(prompt_round_record_t *r)</argsstring>
        <name>prompt_round_record_free</name>
        <param>
          <type><ref refid="main__infer_8c_1af8802263c4d59c173623fe774ce0abb0" kindref="member">prompt_round_record_t</ref> *</type>
          <declname>r</declname>
        </param>
        <briefdescription>
<para>Free a prompt-round record. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>r</parametername>
</parameternamelist>
<parameterdescription>
<para>Record.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
prompt_round_record_free.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>r</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="2113" column="13" bodyfile="engine/src/main_infer.c" bodystart="2113" bodyend="2118"/>
        <references refid="structprompt__round__record_1a0c260950e8b81d2992debca2f4b49d00" compoundref="main__infer_8c" startline="2101">prompt_round_record::decoded_text</references>
        <references refid="main__infer_8c_1af91bda098d580c2cf56b5beda68bd2d5" compoundref="main__infer_8c" startline="2036" endline="2041">report_token_buf_free</references>
        <references refid="structprompt__round__record_1a51223e3133e92ee93d77d6752e57d1bf" compoundref="main__infer_8c" startline="2089">prompt_round_record::tokens</references>
        <referencedby refid="main__infer_8c_1a3c04138a5bfe5d72780bb7e82a18e627" compoundref="main__infer_8c" startline="2362" endline="2740">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a9205188606b8d4265d29fa8911259cac" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void json_print_int_array</definition>
        <argsstring>(const int *ids, size_t n)</argsstring>
        <name>json_print_int_array</name>
        <param>
          <type>const int *</type>
          <declname>ids</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>n</declname>
        </param>
        <briefdescription>
<para>Print a JSON array of integers. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>ids</parametername>
</parameternamelist>
<parameterdescription>
<para>Token IDs (may be NULL). </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>n</parametername>
</parameternamelist>
<parameterdescription>
<para>Token count.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
json_print_int_array.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>ids</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>n</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="2131" column="13" bodyfile="engine/src/main_infer.c" bodystart="2131" bodyend="2139"/>
        <referencedby refid="main__infer_8c_1a84b40472513bc66398c6d3049891f553" compoundref="main__infer_8c" startline="2171" endline="2334">print_json_result</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a84b40472513bc66398c6d3049891f553" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void print_json_result</definition>
        <argsstring>(size_t n_tok, const int *tokens, double wall_s_in, double prefill_s_in, double decode_s_in, uint64_t kv_hits, uint64_t kv_misses, uint32_t rss_peak_mb, const char *text_decoded, const char *tokenizer_path_used, const char *expected_file, const prompt_list_t *prompts, int rounds, const prompt_round_record_t *recs)</argsstring>
        <name>print_json_result</name>
        <param>
          <type>size_t</type>
          <declname>n_tok</declname>
        </param>
        <param>
          <type>const int *</type>
          <declname>tokens</declname>
        </param>
        <param>
          <type>double</type>
          <declname>wall_s_in</declname>
        </param>
        <param>
          <type>double</type>
          <declname>prefill_s_in</declname>
        </param>
        <param>
          <type>double</type>
          <declname>decode_s_in</declname>
        </param>
        <param>
          <type>uint64_t</type>
          <declname>kv_hits</declname>
        </param>
        <param>
          <type>uint64_t</type>
          <declname>kv_misses</declname>
        </param>
        <param>
          <type>uint32_t</type>
          <declname>rss_peak_mb</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>text_decoded</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>tokenizer_path_used</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>expected_file</declname>
        </param>
        <param>
          <type>const <ref refid="main__infer_8c_1aa2c236bcd5a489e1a409ffd5f4c532f7" kindref="member">prompt_list_t</ref> *</type>
          <declname>prompts</declname>
        </param>
        <param>
          <type>int</type>
          <declname>rounds</declname>
        </param>
        <param>
          <type>const <ref refid="main__infer_8c_1af8802263c4d59c173623fe774ce0abb0" kindref="member">prompt_round_record_t</ref> *</type>
          <declname>recs</declname>
        </param>
        <briefdescription>
<para>Print the single JSON result object to stdout. </para>
        </briefdescription>
        <detaileddescription>
<para>This function prints exactly one JSON object, suitable for strict harness parsing. It preserves all previously emitted fields and appends per-prompt/per-round data under the <computeroutput>&quot;prompts&quot;</computeroutput> key.</para>
<para>TPS policy:<itemizedlist>
<listitem><para>tps_true is decode-only TPS: tokens_generated / decode_time_s (setup/prefill excluded).</para>
</listitem><listitem><para>tps_window is tokens_generated / wall_time_s (entire timed window, includes strict-touch).</para>
</listitem></itemizedlist>
</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>n_tok</parametername>
</parameternamelist>
<parameterdescription>
<para>Number of generated tokens (sum over all prompts and rounds). </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>tokens</parametername>
</parameternamelist>
<parameterdescription>
<para>Optional top-level token buffer (legacy single-prompt behavior). </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>wall_s_in</parametername>
</parameternamelist>
<parameterdescription>
<para>Timed window seconds (strict window). </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>prefill_s_in</parametername>
</parameternamelist>
<parameterdescription>
<para>Summed prefill seconds (engine-reported). </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>decode_s_in</parametername>
</parameternamelist>
<parameterdescription>
<para>Summed decode seconds (engine-reported). </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>kv_hits</parametername>
</parameternamelist>
<parameterdescription>
<para>KV cache hits. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>kv_misses</parametername>
</parameternamelist>
<parameterdescription>
<para>KV cache misses. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>rss_peak_mb</parametername>
</parameternamelist>
<parameterdescription>
<para>RSS peak in MiB. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>text_decoded</parametername>
</parameternamelist>
<parameterdescription>
<para>Optional decoded text (UTF-8) for legacy single prompt. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>tokenizer_path_used</parametername>
</parameternamelist>
<parameterdescription>
<para>Optional resolved tokenizer path used by CLI. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>expected_file</parametername>
</parameternamelist>
<parameterdescription>
<para>Optional expected tokens file path (for reporting only). </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>prompts</parametername>
</parameternamelist>
<parameterdescription>
<para>Prompt list (preloaded). </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>rounds</parametername>
</parameternamelist>
<parameterdescription>
<para>Number of rounds. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>recs</parametername>
</parameternamelist>
<parameterdescription>
<para>Per-prompt/per-round records (length must be prompts-&gt;count * rounds). </para>
</parameterdescription>
</parameteritem>
</parameterlist>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="2171" column="13" bodyfile="engine/src/main_infer.c" bodystart="2171" bodyend="2334"/>
        <references refid="structprompt__round__record_1a24eceb958921c2ab6ecf6fe0cdc5da49" compoundref="main__infer_8c" startline="2099">prompt_round_record::actual_at</references>
        <references refid="structprompt__list_1ab60c60299e5806652f4c2c7a94aca5c3" compoundref="main__infer_8c" startline="1552">prompt_list::count</references>
        <references refid="structprompt__round__record_1aa08726c5eddf5bb4680d15b63b494dc8" compoundref="main__infer_8c" startline="2093">prompt_round_record::decode_time_s</references>
        <references refid="structprompt__round__record_1a0c260950e8b81d2992debca2f4b49d00" compoundref="main__infer_8c" startline="2101">prompt_round_record::decoded_text</references>
        <references refid="structprompt__round__record_1ae372c2117122aeea632490a6ea1526b1" compoundref="main__infer_8c" startline="2098">prompt_round_record::expected_at</references>
        <references refid="structprompt__round__record_1adbf79594fd763d49b2eb13dcbd027c90" compoundref="main__infer_8c" startline="2096">prompt_round_record::expected_ok</references>
        <references refid="structprompt__round__record_1ad67c0f4a359b27e788a90c0477211293" compoundref="main__infer_8c" startline="2095">prompt_round_record::expected_present</references>
        <references refid="structreport__token__buf_1a91b6556df06c25b311255a4a16f785dd" compoundref="main__infer_8c" startline="2023">report_token_buf::ids</references>
        <references refid="structprompt__list_1ad4b457e3153a399812c91acb3d2f399f" compoundref="main__infer_8c" startline="1551">prompt_list::items</references>
        <references refid="main__infer_8c_1a7427a4a1579fb747a4ce22a4a1d4a80a" compoundref="main__infer_8c" startline="761" endline="783">json_print_escaped_string</references>
        <references refid="main__infer_8c_1a9205188606b8d4265d29fa8911259cac" compoundref="main__infer_8c" startline="2131" endline="2139">json_print_int_array</references>
        <references refid="structprompt__round__record_1a639a8578fdf0ba299afe4f0783c47567" compoundref="main__infer_8c" startline="2097">prompt_round_record::mismatch_index</references>
        <references refid="structreport__token__buf_1a89ffa03443f19bf77470f85a92baa245" compoundref="main__infer_8c" startline="2024">report_token_buf::n</references>
        <references refid="structprompt__round__record_1a4ab0f6440e03c15551287b69ed070d94" compoundref="main__infer_8c" startline="2092">prompt_round_record::prefill_time_s</references>
        <references refid="main__infer_8c_1ad7f42b712b3e86af5d9f8c9942bc8875" compoundref="main__infer_8c" startline="1690" endline="1703">prompt_id_fnv1a64</references>
        <references refid="structprompt__round__record_1a51223e3133e92ee93d77d6752e57d1bf" compoundref="main__infer_8c" startline="2089">prompt_round_record::tokens</references>
        <references refid="structprompt__round__record_1a8cc938142194c5202bb275da807b0dbf" compoundref="main__infer_8c" startline="2088">prompt_round_record::tokens_generated</references>
        <references refid="structprompt__round__record_1a8da08c83a326c2b7ab39fd7cfadb762b" compoundref="main__infer_8c" startline="2091">prompt_round_record::window_time_s</references>
        <referencedby refid="main__infer_8c_1a3c04138a5bfe5d72780bb7e82a18e627" compoundref="main__infer_8c" startline="2362" endline="2740">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a43b384fdf1f1e4cc7304e6164461af44" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int device_is_cuda</definition>
        <argsstring>(const char *dev)</argsstring>
        <name>device_is_cuda</name>
        <param>
          <type>const char *</type>
          <declname>dev</declname>
        </param>
        <briefdescription>
<para>Check whether device string selects CUDA. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>dev</parametername>
</parameternamelist>
<parameterdescription>
<para>Device label. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>1 if CUDA, 0 otherwise. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="2345" column="12" bodyfile="engine/src/main_infer.c" bodystart="2345" bodyend="2345"/>
        <references refid="main__infer_8c_1a72ab94aafe7740f1343d317daa89ca15" compoundref="main__infer_8c" startline="166" endline="176">ascii_ieq</references>
        <referencedby refid="main__infer_8c_1a3c04138a5bfe5d72780bb7e82a18e627" compoundref="main__infer_8c" startline="2362" endline="2740">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1ae26c03bc6150b42f62a01df020935733" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int device_is_cpu</definition>
        <argsstring>(const char *dev)</argsstring>
        <name>device_is_cpu</name>
        <param>
          <type>const char *</type>
          <declname>dev</declname>
        </param>
        <briefdescription>
<para>Check whether device string selects CPU. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>dev</parametername>
</parameternamelist>
<parameterdescription>
<para>Device label. </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>1 if CPU, 0 otherwise. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="2352" column="12" bodyfile="engine/src/main_infer.c" bodystart="2352" bodyend="2352"/>
        <references refid="main__infer_8c_1a72ab94aafe7740f1343d317daa89ca15" compoundref="main__infer_8c" startline="166" endline="176">ascii_ieq</references>
        <referencedby refid="main__infer_8c_1a3c04138a5bfe5d72780bb7e82a18e627" compoundref="main__infer_8c" startline="2362" endline="2740">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="main__infer_8c_1a3c04138a5bfe5d72780bb7e82a18e627" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int main</definition>
        <argsstring>(int argc, char **argv)</argsstring>
        <name>main</name>
        <param>
          <type>int</type>
          <declname>argc</declname>
        </param>
        <param>
          <type>char **</type>
          <declname>argv</declname>
        </param>
        <briefdescription>
<para>main. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>argc</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>argv</parametername>
</parameternamelist>
<parameterdescription>
<para>See implementation for details.</para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>See implementation for details. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/main_infer.c" line="2362" column="5" bodyfile="engine/src/main_infer.c" bodystart="2362" bodyend="2740"/>
        <references refid="structprompt__round__record_1a24eceb958921c2ab6ecf6fe0cdc5da49" compoundref="main__infer_8c" startline="2099">prompt_round_record::actual_at</references>
        <references refid="structie__engine__params_1a66599574f8a4b8ed7cd7132fc1c0e051" compoundref="ie__api_8h" startline="62">ie_engine_params::affinity</references>
        <references refid="structcli__extras_1a313d0562dfb63a6350db5c84128fc074" compoundref="main__infer_8c" startline="988">cli_extras::affinity</references>
        <references refid="structcli__extras_1a4e233e0c7d76b4fb4338d7460a552707" compoundref="main__infer_8c" startline="996">cli_extras::aggregate</references>
        <references refid="main__infer_8c_1ac50de02cf90e21f66e0681932f39334f" compoundref="main__infer_8c" startline="1231" endline="1286">apply_cli_debug_env</references>
        <references refid="main__infer_8c_1a72ab94aafe7740f1343d317daa89ca15" compoundref="main__infer_8c" startline="166" endline="176">ascii_ieq</references>
        <references refid="main__infer_8c_1ae715f0cc745f58eebd4be50b187dd41da382ceb68dddaaf8b27ac21f144305e74" compoundref="main__infer_8c" startline="975">CLI_PRETX_NONE</references>
        <references refid="main__infer_8c_1ae715f0cc745f58eebd4be50b187dd41da9d22d4f265254a65af9fc3a7d648fe5d" compoundref="main__infer_8c" startline="976">CLI_PRETX_WOH</references>
        <references refid="main__infer_8c_1ae715f0cc745f58eebd4be50b187dd41da1a251ee24fdcadcaf9c888e0a96140e7" compoundref="main__infer_8c" startline="977">CLI_PRETX_WXH</references>
        <references refid="structprompt__list_1ab60c60299e5806652f4c2c7a94aca5c3" compoundref="main__infer_8c" startline="1552">prompt_list::count</references>
        <references refid="main__infer_8c_1aca4f099fbc130845b4af6c57ca21b3ef" compoundref="main__infer_8c" startline="655" endline="687">cudart_get_api</references>
        <references refid="main__infer_8c_1a44a0de9d17f6eff8a4764537268ab5d1" compoundref="main__infer_8c" startline="697" endline="745">cudart_touch_bytes</references>
        <references refid="structie__generate__stats_1a1b1460ddd99269f59229371ead131768" compoundref="ie__api_8h" startline="123">ie_generate_stats::decode_time_s</references>
        <references refid="structprompt__round__record_1aa08726c5eddf5bb4680d15b63b494dc8" compoundref="main__infer_8c" startline="2093">prompt_round_record::decode_time_s</references>
        <references refid="main__infer_8c_1a4e30eb4737647a78c4dbebb5b008a5bd" compoundref="main__infer_8c" startline="866" endline="965">decode_tokens_best_effort</references>
        <references refid="structprompt__round__record_1a0c260950e8b81d2992debca2f4b49d00" compoundref="main__infer_8c" startline="2101">prompt_round_record::decoded_text</references>
        <references refid="structcli__extras_1a50cd2ee771a9eee3fd448d2a1c0b5645" compoundref="main__infer_8c" startline="990">cli_extras::device</references>
        <references refid="main__infer_8c_1ae26c03bc6150b42f62a01df020935733" compoundref="main__infer_8c" startline="2352" endline="2352">device_is_cpu</references>
        <references refid="main__infer_8c_1a43b384fdf1f1e4cc7304e6164461af44" compoundref="main__infer_8c" startline="2345" endline="2345">device_is_cuda</references>
        <references refid="main__infer_8c_1a2392f4f2060045de53b484a90f85f15f" compoundref="main__infer_8c" startline="245" endline="251">dir_accessible</references>
        <references refid="main__infer_8c_1a9675b1f5b8b73e24233f92cb11e31f6a" compoundref="main__infer_8c" startline="133" endline="139">env_long</references>
        <references refid="main__infer_8c_1a1da65df4642943745d356d6de2983f02" compoundref="main__infer_8c" startline="147" endline="150">env_str</references>
        <references refid="structprompt__round__record_1ae372c2117122aeea632490a6ea1526b1" compoundref="main__infer_8c" startline="2098">prompt_round_record::expected_at</references>
        <references refid="structprompt__round__record_1adbf79594fd763d49b2eb13dcbd027c90" compoundref="main__infer_8c" startline="2096">prompt_round_record::expected_ok</references>
        <references refid="structprompt__round__record_1ad67c0f4a359b27e788a90c0477211293" compoundref="main__infer_8c" startline="2095">prompt_round_record::expected_present</references>
        <references refid="main__infer_8c_1a3a307125ca4048deb177277c8e72bbfe" compoundref="main__infer_8c" startline="1832" endline="1859">expected_tokens_compare</references>
        <references refid="structcli__extras_1a3b9c2202e0ba68aa4b3112779697a28e" compoundref="main__infer_8c" startline="1000">cli_extras::expected_tokens_file</references>
        <references refid="main__infer_8c_1a0b4d248d44b83ac2a6b5f47b47fe15df" compoundref="main__infer_8c" startline="2006" endline="2013">expected_tokens_find</references>
        <references refid="main__infer_8c_1a470ca5b37dd720b5de391932c452af36" compoundref="main__infer_8c" startline="1780" endline="1789">expected_tokens_table_free</references>
        <references refid="main__infer_8c_1a7170af3ba79ee074b29ac13736ec97bf" compoundref="main__infer_8c" startline="1764" endline="1769">expected_tokens_table_init</references>
        <references refid="main__infer_8c_1a84acee847ca644179eff86e6406bf230" compoundref="main__infer_8c" startline="1944" endline="1998">expected_tokens_table_load</references>
        <references refid="main__infer_8c_1a39103ce72021a890c3e333b949068a1c" compoundref="main__infer_8c" startline="449" endline="456">heap_strdup</references>
        <references refid="structreport__token__buf_1a91b6556df06c25b311255a4a16f785dd" compoundref="main__infer_8c" startline="2023">report_token_buf::ids</references>
        <references refid="ie__api_8h_1a84bd87043352946e9d53b0f8a5c4abe0" compoundref="ie__api_8c" startline="535" endline="786">ie_engine_create</references>
        <references refid="ie__api_8h_1a5a9a30f05ef6183f6a75811c616b3a0a" compoundref="ie__api_8c" startline="788" endline="816">ie_engine_destroy</references>
        <references refid="ie__api_8h_1ad32cf2cd209832e4cd577a5a1e31970f" compoundref="ie__api_8c" startline="818" endline="824">ie_engine_generate</references>
        <references refid="ie__api_8h_1a950ac9a0efe5a4fe068a288e57099c4a" compoundref="ie__api_8c" startline="826" endline="1109">ie_engine_generate_ex</references>
        <references refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d" compoundref="ie__io_8h" startline="64">IE_IO_OK</references>
        <references refid="ie__kv__instrumentation_8h_1a0a8ac6ff4fa3502470774c6cb9e6f488" compoundref="ie__kv__instrumentation_8c" startline="31" endline="36">ie_kv_begin_round</references>
        <references refid="ie__kv__instrumentation_8h_1a2c9789a487a67ebc8e6054aa0b991e4e" compoundref="ie__kv__instrumentation_8c" startline="48" endline="75">ie_kv_finish_round</references>
        <references refid="ie__api_8h_1aad1f6716972d7c4560daae2edb134d6aad0e6665e4f13d22e40740ef4ab91d56e" compoundref="ie__api_8h" startline="34">IE_OK</references>
        <references refid="ie__io_8h_1a06c2b7e35d1f82a11e4605e23a1976f5" compoundref="weights_8c" startline="1356" endline="1370">ie_weights_close</references>
        <references refid="ie__io_8h_1a522dac028ee37aae1307ffdb6d65ec1d" compoundref="weights_8c" startline="988" endline="1171">ie_weights_open</references>
        <references refid="structprompt__list_1ad4b457e3153a399812c91acb3d2f399f" compoundref="main__infer_8c" startline="1551">prompt_list::items</references>
        <references refid="structcli__extras_1a5eb0317aa09b90f400b657245b41e92c" compoundref="main__infer_8c" startline="986">cli_extras::max_new</references>
        <references refid="structprompt__round__record_1a639a8578fdf0ba299afe4f0783c47567" compoundref="main__infer_8c" startline="2097">prompt_round_record::mismatch_index</references>
        <references refid="structcli__extras_1ae2401ceced12a603aabefd22f57584bd" compoundref="main__infer_8c" startline="1006">cli_extras::model_bin</references>
        <references refid="structcli__extras_1aa52e671b92aa5a9099153b609a0c5792" compoundref="main__infer_8c" startline="1004">cli_extras::model_dir</references>
        <references refid="structcli__extras_1a96d26a6a2f436fb0b232d383f321c3e6" compoundref="main__infer_8c" startline="1005">cli_extras::model_json</references>
        <references refid="main__infer_8c_1af5ac8d51b8d24639015faa2a2e699ba2" compoundref="main__infer_8c" startline="573" endline="609">model_touch_bytes</references>
        <references refid="main__infer_8c_1a6d67a99243e339c4acabd9ed9b84002c" compoundref="main__infer_8c" startline="551" endline="559">model_touch_close</references>
        <references refid="main__infer_8c_1ac67780918b483167f77ec879306c781c" compoundref="main__infer_8c" startline="508" endline="540">model_touch_open</references>
        <references refid="structreport__token__buf_1a89ffa03443f19bf77470f85a92baa245" compoundref="main__infer_8c" startline="2024">report_token_buf::n</references>
        <references refid="structexpected__tokens__entry_1adbef90e357d95fb8c8658ef20993593f" compoundref="main__infer_8c" startline="1743">expected_tokens_entry::n_tokens</references>
        <references refid="main__infer_8c_1a4fdbfffdaa0f22a01822f6a62bb7e95e" compoundref="main__infer_8c" startline="209" endline="213">now_sec</references>
        <references refid="main__infer_8c_1a456ba954f3884bcf5f72fc3e779de284" compoundref="main__infer_8c" startline="1308" endline="1500">parse_flags</references>
        <references refid="main__infer_8c_1a0cbea455e9868581360f43c63db6554c" compoundref="main__infer_8c" startline="227" endline="231">path_exists</references>
        <references refid="main__infer_8c_1ae688d728e1acdfe5988c7db45d6f0166" compoundref="main__infer_8c" startline="81">PATH_MAX</references>
        <references refid="structie__engine__params_1a92b02bad12cb4e8173728311c00960b7" compoundref="ie__api_8h" startline="56">ie_engine_params::precision</references>
        <references refid="structcli__extras_1a49d7c958a59c223a1f66d6aedc796e68" compoundref="main__infer_8c" startline="1009">cli_extras::precision_from_flag</references>
        <references refid="structcli__extras_1a061a8ed1f6671ad018d99db180df06c2" compoundref="main__infer_8c" startline="1008">cli_extras::precision_label</references>
        <references refid="structie__engine__params_1a34f965300425f8c1115b2408a4adc04a" compoundref="ie__api_8h" startline="68">ie_engine_params::prefetch</references>
        <references refid="structcli__extras_1a01be4e3c92d754527967d04b729e4ee6" compoundref="main__infer_8c" startline="994">cli_extras::prefetch</references>
        <references refid="structie__generate__stats_1a25833e4ea02ba3a80027c68ef1b7df4e" compoundref="ie__api_8h" startline="120">ie_generate_stats::prefill_time_s</references>
        <references refid="structprompt__round__record_1a4ab0f6440e03c15551287b69ed070d94" compoundref="main__infer_8c" startline="2092">prompt_round_record::prefill_time_s</references>
        <references refid="structie__engine__params_1a992270ba61612b2acb319aed5cbfca13" compoundref="ie__api_8h" startline="65">ie_engine_params::pretranspose</references>
        <references refid="structcli__extras_1a648dda8436ede182650f29f0460fa6a3" compoundref="main__infer_8c" startline="989">cli_extras::pretx</references>
        <references refid="main__infer_8c_1a84b40472513bc66398c6d3049891f553" compoundref="main__infer_8c" startline="2171" endline="2334">print_json_result</references>
        <references refid="structcli__extras_1a553c6e455b22c4ff3cd6f00beb166eb7" compoundref="main__infer_8c" startline="1015">cli_extras::print_text</references>
        <references refid="structcli__extras_1aa45c7376781454d767d2202800c27a3e" compoundref="main__infer_8c" startline="985">cli_extras::prompt</references>
        <references refid="structprompt__round__record_1a9b7acfc693dc6c61df0c048c77d59c6f" compoundref="main__infer_8c" startline="2086">prompt_round_record::prompt_id</references>
        <references refid="main__infer_8c_1ad7f42b712b3e86af5d9f8c9942bc8875" compoundref="main__infer_8c" startline="1690" endline="1703">prompt_id_fnv1a64</references>
        <references refid="structprompt__round__record_1a691ac5964e952c5059b957f07a8542f5" compoundref="main__infer_8c" startline="2083">prompt_round_record::prompt_index</references>
        <references refid="main__infer_8c_1ab06a46b9f23d08de776ec7d3258b6588" compoundref="main__infer_8c" startline="1581" endline="1590">prompt_list_free</references>
        <references refid="main__infer_8c_1a9891db61dca3c60715c6b2f7aad7f5a1" compoundref="main__infer_8c" startline="1565" endline="1570">prompt_list_init</references>
        <references refid="main__infer_8c_1a9be857b0051297813c2cb218accbb5c8" compoundref="main__infer_8c" startline="1606" endline="1622">prompt_list_push_copy</references>
        <references refid="main__infer_8c_1a3d826199fc8a9ddb8a49f324c2ff1dc5" compoundref="main__infer_8c" startline="1641" endline="1668">prompt_list_read_file</references>
        <references refid="main__infer_8c_1aa8860ddc49714b553fe669c784885cff" compoundref="main__infer_8c" startline="2113" endline="2118">prompt_round_record_free</references>
        <references refid="structcli__extras_1a992ba8185b17f227f60e2e570441b63f" compoundref="main__infer_8c" startline="992">cli_extras::prompts_file</references>
        <references refid="main__infer_8c_1a609fc6d778b714530dadf2ef012acf5c" compoundref="main__infer_8c" startline="1527" endline="1545">read_first_nonempty_line</references>
        <references refid="main__infer_8c_1a23f6c5852d73ecbdb1dead2be803bcf0" compoundref="main__infer_8c" startline="2062" endline="2077">report_token_buf_copy</references>
        <references refid="structcli__extras_1a69d2dd2e3fe09f5ff877aec31e16de34" compoundref="main__infer_8c" startline="1001">cli_extras::report_tokens</references>
        <references refid="structcli__extras_1a9a0cdb8214e4f1b8cd375e78dc81f064" compoundref="main__infer_8c" startline="1002">cli_extras::report_tokens_max</references>
        <references refid="main__infer_8c_1ad6b894571e18a35f21d8451e008fae37" compoundref="main__infer_8c" startline="378" endline="426">resolve_model_paths</references>
        <references refid="main__infer_8c_1a0271a21f39c53534b7a1a3cc7eb94596" compoundref="main__infer_8c" startline="810" endline="841">resolve_tokenizer_path</references>
        <references refid="structprompt__round__record_1aad02ec5870f35fcf8d7608104ed06304" compoundref="main__infer_8c" startline="2084">prompt_round_record::round_index</references>
        <references refid="structcli__extras_1a8c1b8fdbf9dc75a774e8b451608c961b" compoundref="main__infer_8c" startline="997">cli_extras::rounds</references>
        <references refid="main__infer_8c_1a0d90177eef91d08c3d9a38fb00df3e62" compoundref="main__infer_8c" startline="437" endline="442">rss_peak_mib</references>
        <references refid="structie__engine__params_1a1dff4c9644aa8bf7e389f84426c529e1" compoundref="ie__api_8h" startline="59">ie_engine_params::sparsity</references>
        <references refid="structcli__extras_1af5f02b3c69e6a0e4882a5427db0ab994" compoundref="main__infer_8c" startline="1011">cli_extras::sparsity</references>
        <references refid="structcli__extras_1aeac7b5044a46ca251e3414887e1e712e" compoundref="main__infer_8c" startline="1012">cli_extras::sparsity_from_flag</references>
        <references refid="structie__engine__params_1a0c0b5f7588c98d30e0d2535790f6f24c" compoundref="ie__api_8h" startline="71">ie_engine_params::threads</references>
        <references refid="structcli__extras_1a4e8cdca32127b81f8fcb41047a320844" compoundref="main__infer_8c" startline="987">cli_extras::threads</references>
        <references refid="structie__engine__params_1a16a831d93768c1a6d392163596de8277" compoundref="ie__api_8h" startline="79">ie_engine_params::tokenizer_path</references>
        <references refid="structcli__extras_1af46939020f3ada099f4c932676dec6b7" compoundref="main__infer_8c" startline="1016">cli_extras::tokenizer_path</references>
        <references refid="structexpected__tokens__entry_1a959f62b26acb1af16f22d85b55b0df78" compoundref="main__infer_8c" startline="1742">expected_tokens_entry::tokens</references>
        <references refid="structprompt__round__record_1a51223e3133e92ee93d77d6752e57d1bf" compoundref="main__infer_8c" startline="2089">prompt_round_record::tokens</references>
        <references refid="structprompt__round__record_1a8cc938142194c5202bb275da807b0dbf" compoundref="main__infer_8c" startline="2088">prompt_round_record::tokens_generated</references>
        <references refid="structcli__extras_1a628bf363ee35fe852bbb6510455647bd" compoundref="main__infer_8c" startline="995">cli_extras::warmup_tokens</references>
        <references refid="structprompt__round__record_1a8da08c83a326c2b7ab39fd7cfadb762b" compoundref="main__infer_8c" startline="2091">prompt_round_record::window_time_s</references>
      </memberdef>
    </sectiondef>
    <briefdescription>
<para>CLI entry point for the inference engine (benchmark-friendly, strict-run safe). </para>
    </briefdescription>
    <detaileddescription>
<para>This file implements the standalone CLI binary used by the benchmark harness. It prints exactly one JSON object to stdout (even on errors) so that scripts can reliably parse results.</para>
<para>Timing policy (low-overhead, benchmark-correct):<itemizedlist>
<listitem><para>All setup is performed outside the timed window:<itemizedlist>
<listitem><para>CLI parsing, path resolution, model open, engine create, warmup, tokenizer resolution, prompt file I/O (prompt list is preloaded), strict-touch preflight (mmap open / cudart dlopen).</para>
</listitem></itemizedlist>
</para>
</listitem><listitem><para>The timed window measures only the steady-state &quot;work loop&quot;:<itemizedlist>
<listitem><para>ie_engine_generate calls (and, when enabled, strict-touch work that must be attributed to the run by design).</para>
</listitem></itemizedlist>
</para>
</listitem></itemizedlist>
</para>
<para>Strict-run goals (CPU/CUDA):<itemizedlist>
<listitem><para>When IE_REQUIRE_MODEL=1, model files must open successfully.</para>
</listitem><listitem><para>When IE_VERIFY_TOUCH=1 and IE_BYTES_PER_TOKEN&gt;0, the timed window includes deterministic, measurable work that cannot be optimized away.</para>
</listitem><listitem><para>For CPU, the strict &quot;touch&quot; work is file-backed: it reads from the model weights mmap (not anonymous memory), so RSS/majflt reflect real paging.</para>
</listitem><listitem><para>For CUDA, the strict work uses cudart (if present) to force driver activity inside the timed window without relying on custom kernels.</para>
</listitem></itemizedlist>
</para>
<para>Text output:<itemizedlist>
<listitem><para>By default, the CLI prints tokens in JSON for benchmark tooling.</para>
</listitem><listitem><para>If <ndash/>print-text is provided (or IE_PRINT_TEXT=1), the CLI will also decode the generated token IDs into UTF-8 using the project tokenizer.</para>
</listitem><listitem><para>Tokenizer resolution prefers .tiktoken files (when present) and falls back to tokenizer.json paths.</para>
</listitem></itemizedlist>
</para>
<para>Prompts file behavior (Goal A):<itemizedlist>
<listitem><para>If <ndash/>prompts-file is provided and <ndash/>prompt is NOT provided, the CLI runs all non-empty lines from the prompts file (newline-delimited) in order.</para>
</listitem><listitem><para>This mode is internally treated as &quot;aggregate&quot; mode and still prints exactly one JSON object (aggregated over all prompts and rounds).</para>
</listitem><listitem><para>Empty/whitespace-only lines are ignored.</para>
</listitem></itemizedlist>
</para>
<para>Notes:<itemizedlist>
<listitem><para>This CLI validates model_dir accessibility, resolves default model paths, and supports prompts-file batching for harnesses.</para>
</listitem><listitem><para>Token output types follow <ref refid="ie__api_8h" kindref="compound">ie_api.h</ref>: out_tokens is int[], out_n_tokens is size_t. </para>
</listitem></itemizedlist>
</para>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">/*<sp/>============================================================================</highlight></codeline>
<codeline lineno="2"><highlight class="comment"><sp/>*<sp/>File:<sp/>engine/src/main_infer.c</highlight></codeline>
<codeline lineno="3"><highlight class="comment"><sp/>*<sp/>============================================================================</highlight></codeline>
<codeline lineno="4"><highlight class="comment"><sp/>*/</highlight></codeline>
<codeline lineno="51"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_POSIX_C_SOURCE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="52" refid="main__infer_8c_1a3024ccd4a9af5109d24e6c57565d74a1" refkind="member"><highlight class="normal"></highlight><highlight class="preprocessor">#<sp/><sp/>define<sp/>_POSIX_C_SOURCE<sp/>200809L</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="53"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="54"><highlight class="normal"></highlight></codeline>
<codeline lineno="55"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_XOPEN_SOURCE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="56" refid="main__infer_8c_1a78c99ffd76a7bb3c8c74db76207e9ab4" refkind="member"><highlight class="normal"></highlight><highlight class="preprocessor">#<sp/><sp/>define<sp/>_XOPEN_SOURCE<sp/>700</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="57"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="58"><highlight class="normal"></highlight></codeline>
<codeline lineno="59"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;dlfcn.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="60"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;errno.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="61"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;fcntl.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="62"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;inttypes.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="63"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;limits.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="64"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;stdint.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="65"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;stdio.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="66"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;stdlib.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="67"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;string.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="68"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;sys/mman.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="69"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;sys/resource.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="70"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;sys/stat.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="71"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;time.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="72"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;unistd.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="73"><highlight class="normal"></highlight></codeline>
<codeline lineno="74"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="ie__api_8h" kindref="compound">ie_api.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="75"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="ie__io_8h" kindref="compound">ie_io.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="76"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="ie__kv__instrumentation_8h" kindref="compound">ie_kv_instrumentation.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="77"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="ie__tokenizer__gptoss_8h" kindref="compound">ie_tokenizer_gptoss.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="78"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="util__logging_8h" kindref="compound">util_logging.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="79"><highlight class="normal"></highlight></codeline>
<codeline lineno="80"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>PATH_MAX</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="81" refid="main__infer_8c_1ae688d728e1acdfe5988c7db45d6f0166" refkind="member"><highlight class="normal"></highlight><highlight class="preprocessor">#<sp/><sp/>define<sp/>PATH_MAX<sp/>4096</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="82"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="83"><highlight class="normal"></highlight></codeline>
<codeline lineno="84"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>UNUSED</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="85" refid="main__infer_8c_1a86d500a34c624c2cae56bc25a31b12f3" refkind="member"><highlight class="normal"></highlight><highlight class="preprocessor">#<sp/><sp/>define<sp/>UNUSED(x)<sp/>(void)(x)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="86"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="87"><highlight class="normal"></highlight></codeline>
<codeline lineno="88"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>IE_PREC_FP32</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="89"><highlight class="normal"></highlight><highlight class="preprocessor">#<sp/><sp/>define<sp/>IE_PREC_FP32<sp/>&quot;fp32&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="90"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="91"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>IE_PREC_BF16</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="92"><highlight class="normal"></highlight><highlight class="preprocessor">#<sp/><sp/>define<sp/>IE_PREC_BF16<sp/>&quot;bf16&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="93"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="94"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>IE_PREC_FP16</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="95"><highlight class="normal"></highlight><highlight class="preprocessor">#<sp/><sp/>define<sp/>IE_PREC_FP16<sp/>&quot;fp16&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="96"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="97"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>IE_PREC_INT8W</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="98"><highlight class="normal"></highlight><highlight class="preprocessor">#<sp/><sp/>define<sp/>IE_PREC_INT8W<sp/>&quot;int8w&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="99"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="100"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>IE_PREC_INT4W</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="101"><highlight class="normal"></highlight><highlight class="preprocessor">#<sp/><sp/>define<sp/>IE_PREC_INT4W<sp/>&quot;int4w&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="102"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="103"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>IE_PREC_INT4</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="104"><highlight class="normal"></highlight><highlight class="preprocessor">#<sp/><sp/>define<sp/>IE_PREC_INT4<sp/>&quot;int4&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="105"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="106"><highlight class="normal"></highlight></codeline>
<codeline lineno="107"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>--------------------------------------------------------------------------<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="108"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Local<sp/>helpers<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="109"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>--------------------------------------------------------------------------<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="110"><highlight class="normal"></highlight></codeline>
<codeline lineno="117" refid="main__infer_8c_1a42d8c2f3c8817b30177d0a7e39742b03" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a42d8c2f3c8817b30177d0a7e39742b03" kindref="member">min_size</ref>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>a,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>b)<sp/>{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(a<sp/>&lt;<sp/>b)<sp/>?<sp/>a<sp/>:<sp/>b;<sp/>}</highlight></codeline>
<codeline lineno="118"><highlight class="normal"></highlight></codeline>
<codeline lineno="133" refid="main__infer_8c_1a9675b1f5b8b73e24233f92cb11e31f6a" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a9675b1f5b8b73e24233f92cb11e31f6a" kindref="member">env_long</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*name,<sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>defv)<sp/>{</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*s<sp/>=<sp/>getenv(name);</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!s<sp/>||<sp/>!*s)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>defv;</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*end<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>v<sp/>=<sp/>strtol(s,<sp/>&amp;end,<sp/>10);</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(end<sp/>&amp;&amp;<sp/>*end<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">)<sp/>?<sp/>v<sp/>:<sp/>defv;</highlight></codeline>
<codeline lineno="139"><highlight class="normal">}</highlight></codeline>
<codeline lineno="140"><highlight class="normal"></highlight></codeline>
<codeline lineno="147" refid="main__infer_8c_1a1da65df4642943745d356d6de2983f02" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="main__infer_8c_1a1da65df4642943745d356d6de2983f02" kindref="member">env_str</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*name,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*defv)<sp/>{</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*s<sp/>=<sp/>getenv(name);</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(s<sp/>&amp;&amp;<sp/>*s)<sp/>?<sp/>s<sp/>:<sp/>defv;</highlight></codeline>
<codeline lineno="150"><highlight class="normal">}</highlight></codeline>
<codeline lineno="151"><highlight class="normal"></highlight></codeline>
<codeline lineno="166" refid="main__infer_8c_1a72ab94aafe7740f1343d317daa89ca15" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a72ab94aafe7740f1343d317daa89ca15" kindref="member">ascii_ieq</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*a,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*b)<sp/>{</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!a<sp/>||<sp/>!b)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(*a<sp/>&amp;&amp;<sp/>*b)<sp/>{</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>ca<sp/>=<sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>char)*a++;</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>cb<sp/>=<sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>char)*b++;</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ca<sp/>&gt;=<sp/></highlight><highlight class="charliteral">&apos;A&apos;</highlight><highlight class="normal"><sp/>&amp;&amp;<sp/>ca<sp/>&lt;=<sp/></highlight><highlight class="charliteral">&apos;Z&apos;</highlight><highlight class="normal">)<sp/>ca<sp/>=<sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>char)(ca<sp/>+<sp/>32);</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(cb<sp/>&gt;=<sp/></highlight><highlight class="charliteral">&apos;A&apos;</highlight><highlight class="normal"><sp/>&amp;&amp;<sp/>cb<sp/>&lt;=<sp/></highlight><highlight class="charliteral">&apos;Z&apos;</highlight><highlight class="normal">)<sp/>cb<sp/>=<sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/>char)(cb<sp/>+<sp/>32);</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ca<sp/>!=<sp/>cb)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(*a<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal"><sp/>&amp;&amp;<sp/>*b<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="176"><highlight class="normal">}</highlight></codeline>
<codeline lineno="177"><highlight class="normal"></highlight></codeline>
<codeline lineno="192" refid="main__infer_8c_1a55469391e7680b876a48cdc0d3d24632" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a55469391e7680b876a48cdc0d3d24632" kindref="member">starts_with</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*s,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*prefix)<sp/>{</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!s<sp/>||<sp/>!prefix)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(*prefix)<sp/>{</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*s++<sp/>!=<sp/>*prefix++)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="198"><highlight class="normal">}</highlight></codeline>
<codeline lineno="199"><highlight class="normal"></highlight></codeline>
<codeline lineno="209" refid="main__infer_8c_1a4fdbfffdaa0f22a01822f6a62bb7e95e" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a4fdbfffdaa0f22a01822f6a62bb7e95e" kindref="member">now_sec</ref>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">timespec<sp/>ts;</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/>(void)clock_gettime(CLOCK_MONOTONIC,<sp/>&amp;ts);</highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">)ts.tv_sec<sp/>+<sp/>(double)ts.tv_nsec<sp/>*<sp/>1e-9;</highlight></codeline>
<codeline lineno="213"><highlight class="normal">}</highlight></codeline>
<codeline lineno="214"><highlight class="normal"></highlight></codeline>
<codeline lineno="227" refid="main__infer_8c_1a0cbea455e9868581360f43c63db6554c" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a0cbea455e9868581360f43c63db6554c" kindref="member">path_exists</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*p)<sp/>{</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!p<sp/>||<sp/>!*p)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">stat<sp/>st;</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(stat(p,<sp/>&amp;st)<sp/>==<sp/>0);</highlight></codeline>
<codeline lineno="231"><highlight class="normal">}</highlight></codeline>
<codeline lineno="232"><highlight class="normal"></highlight></codeline>
<codeline lineno="245" refid="main__infer_8c_1a2392f4f2060045de53b484a90f85f15f" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a2392f4f2060045de53b484a90f85f15f" kindref="member">dir_accessible</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*p)<sp/>{</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!p<sp/>||<sp/>!*p)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">stat<sp/>st;</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(stat(p,<sp/>&amp;st)<sp/>!=<sp/>0)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!S_ISDIR(st.st_mode))<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(access(p,<sp/>R_OK<sp/>|<sp/>X_OK)<sp/>==<sp/>0);</highlight></codeline>
<codeline lineno="251"><highlight class="normal">}</highlight></codeline>
<codeline lineno="252"><highlight class="normal"></highlight></codeline>
<codeline lineno="258" refid="main__infer_8c_1a35a9aadd511e6b3688d01a67a12c7651" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a35a9aadd511e6b3688d01a67a12c7651" kindref="member">path_is_abs</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*p)<sp/>{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(p<sp/>&amp;&amp;<sp/>p[0]<sp/>==<sp/></highlight><highlight class="charliteral">&apos;/&apos;</highlight><highlight class="normal">);<sp/>}</highlight></codeline>
<codeline lineno="259"><highlight class="normal"></highlight></codeline>
<codeline lineno="273" refid="main__infer_8c_1a210133797f21fcee710ec892841dce42" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a210133797f21fcee710ec892841dce42" kindref="member">safe_strcpy</ref>(</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*dst,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>dstsz,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*src)<sp/>{</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!dst<sp/>||<sp/>dstsz<sp/>==<sp/>0)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!src)<sp/>{</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/>dst[0]<sp/>=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/>(void)snprintf(dst,<sp/>dstsz,<sp/></highlight><highlight class="stringliteral">&quot;%s&quot;</highlight><highlight class="normal">,<sp/>src);</highlight></codeline>
<codeline lineno="280"><highlight class="normal">}</highlight></codeline>
<codeline lineno="281"><highlight class="normal"></highlight></codeline>
<codeline lineno="297" refid="main__infer_8c_1adca9b33a342b8635e28ba51aecb365f6" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1adca9b33a342b8635e28ba51aecb365f6" kindref="member">join_path</ref>(</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*out,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>outsz,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*dir,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*leaf)<sp/>{</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!out<sp/>||<sp/>outsz<sp/>==<sp/>0)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/>out[0]<sp/>=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!leaf)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="301"><highlight class="normal"></highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1a35a9aadd511e6b3688d01a67a12c7651" kindref="member">path_is_abs</ref>(leaf))<sp/>{</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="main__infer_8c_1a210133797f21fcee710ec892841dce42" kindref="member">safe_strcpy</ref>(out,<sp/>outsz,<sp/>leaf);</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!dir<sp/>||<sp/>!*dir)<sp/>{</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="main__infer_8c_1a210133797f21fcee710ec892841dce42" kindref="member">safe_strcpy</ref>(out,<sp/>outsz,<sp/>leaf);</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="310"><highlight class="normal"></highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>strlen(dir);</highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>&gt;<sp/>0<sp/>&amp;&amp;<sp/>dir[n<sp/>-<sp/>1]<sp/>==<sp/></highlight><highlight class="charliteral">&apos;/&apos;</highlight><highlight class="normal">)<sp/>(void)snprintf(out,<sp/>outsz,<sp/></highlight><highlight class="stringliteral">&quot;%s%s&quot;</highlight><highlight class="normal">,<sp/>dir,<sp/>leaf);</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">)snprintf(out,<sp/>outsz,<sp/></highlight><highlight class="stringliteral">&quot;%s/%s&quot;</highlight><highlight class="normal">,<sp/>dir,<sp/>leaf);</highlight></codeline>
<codeline lineno="314"><highlight class="normal">}</highlight></codeline>
<codeline lineno="315"><highlight class="normal"></highlight></codeline>
<codeline lineno="332" refid="main__infer_8c_1a680d5eb9763f52ea89ce1764e01121dc" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a680d5eb9763f52ea89ce1764e01121dc" kindref="member">canon_dir</ref>(</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*out,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>outsz,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*dir)<sp/>{</highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!out<sp/>||<sp/>outsz<sp/>==<sp/>0)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/>out[0]<sp/>=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!dir<sp/>||<sp/>!*dir)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="336"><highlight class="normal"></highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>tmp[<ref refid="main__infer_8c_1ae688d728e1acdfe5988c7db45d6f0166" kindref="member">PATH_MAX</ref>];</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/>tmp[0]<sp/>=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(realpath(dir,<sp/>tmp))<sp/>{</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="main__infer_8c_1a210133797f21fcee710ec892841dce42" kindref="member">safe_strcpy</ref>(out,<sp/>outsz,<sp/>tmp);</highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><ref refid="main__infer_8c_1a210133797f21fcee710ec892841dce42" kindref="member">safe_strcpy</ref>(out,<sp/>outsz,<sp/>dir);</highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="345"><highlight class="normal">}</highlight></codeline>
<codeline lineno="346"><highlight class="normal"></highlight></codeline>
<codeline lineno="359" refid="main__infer_8c_1a937426768611822fbe840722069c7043" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a937426768611822fbe840722069c7043" kindref="member">is_int4_precision</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*p)<sp/>{</highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!p<sp/>||<sp/>!*p)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a55469391e7680b876a48cdc0d3d24632" kindref="member">starts_with</ref>(p,<sp/></highlight><highlight class="stringliteral">&quot;int4&quot;</highlight><highlight class="normal">)<sp/>?<sp/>1<sp/>:<sp/>0;</highlight></codeline>
<codeline lineno="362"><highlight class="normal">}</highlight></codeline>
<codeline lineno="363"><highlight class="normal"></highlight></codeline>
<codeline lineno="378" refid="main__infer_8c_1ad6b894571e18a35f21d8451e008fae37" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1ad6b894571e18a35f21d8451e008fae37" kindref="member">resolve_model_paths</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*model_dir,</highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*model_json_opt,</highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*model_bin_opt,</highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*precision,</highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*out_json,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>out_json_sz,</highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*out_bin,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>out_bin_sz)<sp/>{</highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>dir_canon[<ref refid="main__infer_8c_1ae688d728e1acdfe5988c7db45d6f0166" kindref="member">PATH_MAX</ref>];</highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/>dir_canon[0]<sp/>=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/>(void)<ref refid="main__infer_8c_1a680d5eb9763f52ea89ce1764e01121dc" kindref="member">canon_dir</ref>(dir_canon,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(dir_canon),<sp/>model_dir);</highlight></codeline>
<codeline lineno="387"><highlight class="normal"></highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*base_dir<sp/>=<sp/>(dir_canon[0]<sp/>?<sp/>dir_canon<sp/>:<sp/>model_dir);</highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>want_int4<sp/>=<sp/><ref refid="main__infer_8c_1a937426768611822fbe840722069c7043" kindref="member">is_int4_precision</ref>(precision);</highlight></codeline>
<codeline lineno="390"><highlight class="normal"></highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(model_json_opt<sp/>&amp;&amp;<sp/>*model_json_opt)<sp/>{</highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1a35a9aadd511e6b3688d01a67a12c7651" kindref="member">path_is_abs</ref>(model_json_opt)<sp/>||<sp/>!base_dir<sp/>||<sp/>!*base_dir)<sp/><ref refid="main__infer_8c_1a210133797f21fcee710ec892841dce42" kindref="member">safe_strcpy</ref>(out_json,<sp/>out_json_sz,<sp/>model_json_opt);</highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1adca9b33a342b8635e28ba51aecb365f6" kindref="member">join_path</ref>(out_json,<sp/>out_json_sz,<sp/>base_dir,<sp/>model_json_opt);</highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(base_dir<sp/>&amp;&amp;<sp/>*base_dir)<sp/>{</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(want_int4)<sp/>{</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>cand[<ref refid="main__infer_8c_1ae688d728e1acdfe5988c7db45d6f0166" kindref="member">PATH_MAX</ref>];</highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="main__infer_8c_1adca9b33a342b8635e28ba51aecb365f6" kindref="member">join_path</ref>(cand,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(cand),<sp/>base_dir,<sp/></highlight><highlight class="stringliteral">&quot;model.ie.compat.json&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1a0cbea455e9868581360f43c63db6554c" kindref="member">path_exists</ref>(cand))<sp/><ref refid="main__infer_8c_1a210133797f21fcee710ec892841dce42" kindref="member">safe_strcpy</ref>(out_json,<sp/>out_json_sz,<sp/>cand);</highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1adca9b33a342b8635e28ba51aecb365f6" kindref="member">join_path</ref>(out_json,<sp/>out_json_sz,<sp/>base_dir,<sp/></highlight><highlight class="stringliteral">&quot;model.ie.json&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="main__infer_8c_1adca9b33a342b8635e28ba51aecb365f6" kindref="member">join_path</ref>(out_json,<sp/>out_json_sz,<sp/>base_dir,<sp/></highlight><highlight class="stringliteral">&quot;model.ie.json&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="main__infer_8c_1a210133797f21fcee710ec892841dce42" kindref="member">safe_strcpy</ref>(out_json,<sp/>out_json_sz,<sp/></highlight><highlight class="stringliteral">&quot;./model.ie.json&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="408"><highlight class="normal"></highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(model_bin_opt<sp/>&amp;&amp;<sp/>*model_bin_opt)<sp/>{</highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1a35a9aadd511e6b3688d01a67a12c7651" kindref="member">path_is_abs</ref>(model_bin_opt)<sp/>||<sp/>!base_dir<sp/>||<sp/>!*base_dir)<sp/><ref refid="main__infer_8c_1a210133797f21fcee710ec892841dce42" kindref="member">safe_strcpy</ref>(out_bin,<sp/>out_bin_sz,<sp/>model_bin_opt);</highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1adca9b33a342b8635e28ba51aecb365f6" kindref="member">join_path</ref>(out_bin,<sp/>out_bin_sz,<sp/>base_dir,<sp/>model_bin_opt);</highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(base_dir<sp/>&amp;&amp;<sp/>*base_dir)<sp/>{</highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(want_int4)<sp/>{</highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>cand[<ref refid="main__infer_8c_1ae688d728e1acdfe5988c7db45d6f0166" kindref="member">PATH_MAX</ref>];</highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="main__infer_8c_1adca9b33a342b8635e28ba51aecb365f6" kindref="member">join_path</ref>(cand,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(cand),<sp/>base_dir,<sp/></highlight><highlight class="stringliteral">&quot;model.q4.bin&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1a0cbea455e9868581360f43c63db6554c" kindref="member">path_exists</ref>(cand))<sp/><ref refid="main__infer_8c_1a210133797f21fcee710ec892841dce42" kindref="member">safe_strcpy</ref>(out_bin,<sp/>out_bin_sz,<sp/>cand);</highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1adca9b33a342b8635e28ba51aecb365f6" kindref="member">join_path</ref>(out_bin,<sp/>out_bin_sz,<sp/>base_dir,<sp/></highlight><highlight class="stringliteral">&quot;model.ie.bin&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="main__infer_8c_1adca9b33a342b8635e28ba51aecb365f6" kindref="member">join_path</ref>(out_bin,<sp/>out_bin_sz,<sp/>base_dir,<sp/></highlight><highlight class="stringliteral">&quot;model.ie.bin&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="main__infer_8c_1a210133797f21fcee710ec892841dce42" kindref="member">safe_strcpy</ref>(out_bin,<sp/>out_bin_sz,<sp/></highlight><highlight class="stringliteral">&quot;./model.ie.bin&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="426"><highlight class="normal">}</highlight></codeline>
<codeline lineno="427"><highlight class="normal"></highlight></codeline>
<codeline lineno="437" refid="main__infer_8c_1a0d90177eef91d08c3d9a38fb00df3e62" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>uint32_t<sp/><ref refid="main__infer_8c_1a0d90177eef91d08c3d9a38fb00df3e62" kindref="member">rss_peak_mib</ref>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">rusage<sp/>ru;</highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(getrusage(RUSAGE_SELF,<sp/>&amp;ru)<sp/>!=<sp/>0)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ru.ru_maxrss<sp/>&lt;=<sp/>0)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(uint32_t)((uint64_t)ru.ru_maxrss<sp/>/<sp/>1024ULL);</highlight></codeline>
<codeline lineno="442"><highlight class="normal">}</highlight></codeline>
<codeline lineno="443"><highlight class="normal"></highlight></codeline>
<codeline lineno="449" refid="main__infer_8c_1a39103ce72021a890c3e333b949068a1c" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="main__infer_8c_1a39103ce72021a890c3e333b949068a1c" kindref="member">heap_strdup</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*s)<sp/>{</highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!s)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>strlen(s)<sp/>+<sp/>1;</highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*p<sp/>=<sp/>(</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*)malloc(n);</highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!p)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/>memcpy(p,<sp/>s,<sp/>n);</highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>p;</highlight></codeline>
<codeline lineno="456"><highlight class="normal">}</highlight></codeline>
<codeline lineno="457"><highlight class="normal"></highlight></codeline>
<codeline lineno="472" refid="main__infer_8c_1a82ba5822565056bddf97d8b9d425d9b9" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a82ba5822565056bddf97d8b9d425d9b9" kindref="member">ends_with</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*s,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*suf)<sp/>{</highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!s<sp/>||<sp/>!suf)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>ns<sp/>=<sp/>strlen(s);</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>nf<sp/>=<sp/>strlen(suf);</highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(nf<sp/>&gt;<sp/>ns)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(memcmp(s<sp/>+<sp/>(ns<sp/>-<sp/>nf),<sp/>suf,<sp/>nf)<sp/>==<sp/>0)<sp/>?<sp/>1<sp/>:<sp/>0;</highlight></codeline>
<codeline lineno="478"><highlight class="normal">}</highlight></codeline>
<codeline lineno="479"><highlight class="normal"></highlight></codeline>
<codeline lineno="480"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>--------------------------------------------------------------------------<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="481"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Strict<sp/>file-backed<sp/>model<sp/>touch<sp/>(CPU)<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="482"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>--------------------------------------------------------------------------<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="483"><highlight class="normal"></highlight></codeline>
<codeline lineno="487" refid="structmodel__mmap__touch" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structmodel__mmap__touch" kindref="compound">model_mmap_touch</ref><sp/>{</highlight></codeline>
<codeline lineno="488" refid="structmodel__mmap__touch_1aa4b9a2f532f12c85f152012e47a34ff7" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structmodel__mmap__touch_1aa4b9a2f532f12c85f152012e47a34ff7" kindref="member">fd</ref>;</highlight></codeline>
<codeline lineno="489" refid="structmodel__mmap__touch_1a54141a2f335b552fc983228129bdd606" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*<ref refid="structmodel__mmap__touch_1a54141a2f335b552fc983228129bdd606" kindref="member">base</ref>;</highlight></codeline>
<codeline lineno="490" refid="structmodel__mmap__touch_1aabdfb060ddd6fa73f42db548196ffe6e" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/><ref refid="structmodel__mmap__touch_1aabdfb060ddd6fa73f42db548196ffe6e" kindref="member">size</ref>;</highlight></codeline>
<codeline lineno="491" refid="structmodel__mmap__touch_1a99a97f91127ac01736ee6aad39f22b35" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/><ref refid="structmodel__mmap__touch_1a99a97f91127ac01736ee6aad39f22b35" kindref="member">cursor</ref>;</highlight></codeline>
<codeline lineno="492" refid="main__infer_8c_1a54f0d9b3968af3eb368f8847cd420950" refkind="member"><highlight class="normal">}<sp/><ref refid="main__infer_8c_1a54f0d9b3968af3eb368f8847cd420950" kindref="member">model_mmap_touch_t</ref>;</highlight></codeline>
<codeline lineno="493"><highlight class="normal"></highlight></codeline>
<codeline lineno="508" refid="main__infer_8c_1ac67780918b483167f77ec879306c781c" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1ac67780918b483167f77ec879306c781c" kindref="member">model_touch_open</ref>(<ref refid="structmodel__mmap__touch" kindref="compound">model_mmap_touch_t</ref><sp/>*ctx,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*path)<sp/>{</highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!ctx)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/>memset(ctx,<sp/>0,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(*ctx));</highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/>ctx-&gt;<ref refid="structmodel__mmap__touch_1aa4b9a2f532f12c85f152012e47a34ff7" kindref="member">fd</ref><sp/>=<sp/>-1;</highlight></codeline>
<codeline lineno="512"><highlight class="normal"></highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!path<sp/>||<sp/>!*path)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>2;</highlight></codeline>
<codeline lineno="514"><highlight class="normal"></highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>fd<sp/>=<sp/>open(path,<sp/>O_RDONLY);</highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(fd<sp/>&lt;<sp/>0)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>3;</highlight></codeline>
<codeline lineno="517"><highlight class="normal"></highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">stat<sp/>st;</highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(fstat(fd,<sp/>&amp;st)<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)close(fd);</highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>4;</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(st.st_size<sp/>&lt;=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)close(fd);</highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>5;</highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="527"><highlight class="normal"></highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>sz<sp/>=<sp/>(size_t)st.st_size;</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*base<sp/>=<sp/>mmap(NULL,<sp/>sz,<sp/>PROT_READ,<sp/>MAP_PRIVATE,<sp/>fd,<sp/>0);</highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(base<sp/>==<sp/>MAP_FAILED)<sp/>{</highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)close(fd);</highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>6;</highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="534"><highlight class="normal"></highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/>ctx-&gt;<ref refid="structmodel__mmap__touch_1aa4b9a2f532f12c85f152012e47a34ff7" kindref="member">fd</ref><sp/>=<sp/>fd;</highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/>ctx-&gt;<ref refid="structmodel__mmap__touch_1a54141a2f335b552fc983228129bdd606" kindref="member">base</ref><sp/>=<sp/>base;</highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/>ctx-&gt;<ref refid="structmodel__mmap__touch_1aabdfb060ddd6fa73f42db548196ffe6e" kindref="member">size</ref><sp/>=<sp/>sz;</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/>ctx-&gt;<ref refid="structmodel__mmap__touch_1a99a97f91127ac01736ee6aad39f22b35" kindref="member">cursor</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="540"><highlight class="normal">}</highlight></codeline>
<codeline lineno="541"><highlight class="normal"></highlight></codeline>
<codeline lineno="551" refid="main__infer_8c_1a6d67a99243e339c4acabd9ed9b84002c" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a6d67a99243e339c4acabd9ed9b84002c" kindref="member">model_touch_close</ref>(<ref refid="structmodel__mmap__touch" kindref="compound">model_mmap_touch_t</ref><sp/>*ctx)<sp/>{</highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!ctx)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ctx-&gt;<ref refid="structmodel__mmap__touch_1a54141a2f335b552fc983228129bdd606" kindref="member">base</ref><sp/>&amp;&amp;<sp/>ctx-&gt;<ref refid="structmodel__mmap__touch_1a54141a2f335b552fc983228129bdd606" kindref="member">base</ref><sp/>!=<sp/>MAP_FAILED<sp/>&amp;&amp;<sp/>ctx-&gt;<ref refid="structmodel__mmap__touch_1aabdfb060ddd6fa73f42db548196ffe6e" kindref="member">size</ref>)<sp/>(void)munmap(ctx-&gt;<ref refid="structmodel__mmap__touch_1a54141a2f335b552fc983228129bdd606" kindref="member">base</ref>,<sp/>ctx-&gt;<ref refid="structmodel__mmap__touch_1aabdfb060ddd6fa73f42db548196ffe6e" kindref="member">size</ref>);</highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/>ctx-&gt;<ref refid="structmodel__mmap__touch_1a54141a2f335b552fc983228129bdd606" kindref="member">base</ref><sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/>ctx-&gt;<ref refid="structmodel__mmap__touch_1aabdfb060ddd6fa73f42db548196ffe6e" kindref="member">size</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ctx-&gt;<ref refid="structmodel__mmap__touch_1aa4b9a2f532f12c85f152012e47a34ff7" kindref="member">fd</ref><sp/>&gt;=<sp/>0)<sp/>(void)close(ctx-&gt;<ref refid="structmodel__mmap__touch_1aa4b9a2f532f12c85f152012e47a34ff7" kindref="member">fd</ref>);</highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/>ctx-&gt;<ref refid="structmodel__mmap__touch_1aa4b9a2f532f12c85f152012e47a34ff7" kindref="member">fd</ref><sp/>=<sp/>-1;</highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/>ctx-&gt;<ref refid="structmodel__mmap__touch_1a99a97f91127ac01736ee6aad39f22b35" kindref="member">cursor</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="559"><highlight class="normal">}</highlight></codeline>
<codeline lineno="560"><highlight class="normal"></highlight></codeline>
<codeline lineno="573" refid="main__infer_8c_1af5ac8d51b8d24639015faa2a2e699ba2" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1af5ac8d51b8d24639015faa2a2e699ba2" kindref="member">model_touch_bytes</ref>(<ref refid="structmodel__mmap__touch" kindref="compound">model_mmap_touch_t</ref><sp/>*ctx,</highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>bytes_to_touch,</highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>stride_bytes,</highlight></codeline>
<codeline lineno="576"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>verify_touch)<sp/>{</highlight></codeline>
<codeline lineno="577"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!ctx<sp/>||<sp/>!ctx-&gt;<ref refid="structmodel__mmap__touch_1a54141a2f335b552fc983228129bdd606" kindref="member">base</ref><sp/>||<sp/>ctx-&gt;<ref refid="structmodel__mmap__touch_1aabdfb060ddd6fa73f42db548196ffe6e" kindref="member">size</ref><sp/>==<sp/>0)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(bytes_to_touch<sp/>==<sp/>0)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="579"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(stride_bytes<sp/>==<sp/>0)<sp/>stride_bytes<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="580"><highlight class="normal"></highlight></codeline>
<codeline lineno="581"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>size<sp/>=<sp/>ctx-&gt;<ref refid="structmodel__mmap__touch_1aabdfb060ddd6fa73f42db548196ffe6e" kindref="member">size</ref>;</highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>bytes_to_touch;</highlight></codeline>
<codeline lineno="583"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>&gt;<sp/>size)<sp/>n<sp/>=<sp/>size;</highlight></codeline>
<codeline lineno="584"><highlight class="normal"></highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">volatile</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*p<sp/>=<sp/>(</highlight><highlight class="keyword">volatile</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*)ctx-&gt;<ref refid="structmodel__mmap__touch_1a54141a2f335b552fc983228129bdd606" kindref="member">base</ref>;</highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">volatile</highlight><highlight class="normal"><sp/>uint64_t<sp/>acc<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="587"><highlight class="normal"></highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>start<sp/>=<sp/>ctx-&gt;<ref refid="structmodel__mmap__touch_1a99a97f91127ac01736ee6aad39f22b35" kindref="member">cursor</ref><sp/>%<sp/>size;</highlight></codeline>
<codeline lineno="589"><highlight class="normal"></highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(start<sp/>+<sp/>n<sp/>&lt;=<sp/>size)<sp/>{</highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>end<sp/>=<sp/>start<sp/>+<sp/>n;</highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>off<sp/>=<sp/>start;<sp/>off<sp/>&lt;<sp/>end;<sp/>off<sp/>+=<sp/>stride_bytes)<sp/>acc<sp/>^=<sp/>(uint64_t)p[off];</highlight></codeline>
<codeline lineno="593"><highlight class="normal"><sp/><sp/><sp/><sp/>ctx-&gt;<ref refid="structmodel__mmap__touch_1a99a97f91127ac01736ee6aad39f22b35" kindref="member">cursor</ref><sp/>=<sp/>end<sp/>%<sp/>size;</highlight></codeline>
<codeline lineno="594"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>first<sp/>=<sp/>size<sp/>-<sp/>start;</highlight></codeline>
<codeline lineno="596"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>off<sp/>=<sp/>start;<sp/>off<sp/>&lt;<sp/>size;<sp/>off<sp/>+=<sp/>stride_bytes)<sp/>acc<sp/>^=<sp/>(uint64_t)p[off];</highlight></codeline>
<codeline lineno="597"><highlight class="normal"></highlight></codeline>
<codeline lineno="598"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>rem<sp/>=<sp/>n<sp/>-<sp/>first;</highlight></codeline>
<codeline lineno="599"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>off<sp/>=<sp/>0;<sp/>off<sp/>&lt;<sp/>rem;<sp/>off<sp/>+=<sp/>stride_bytes)<sp/>acc<sp/>^=<sp/>(uint64_t)p[off];</highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/><sp/><sp/>ctx-&gt;<ref refid="structmodel__mmap__touch_1a99a97f91127ac01736ee6aad39f22b35" kindref="member">cursor</ref><sp/>=<sp/>rem<sp/>%<sp/>size;</highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="602"><highlight class="normal"></highlight></codeline>
<codeline lineno="603"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(verify_touch)<sp/>{</highlight></codeline>
<codeline lineno="604"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(acc<sp/>==<sp/>0x9e3779b97f4a7c15ULL)<sp/>{</highlight></codeline>
<codeline lineno="605"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;touch<sp/>verify:<sp/>improbable<sp/>accumulator<sp/>value<sp/>(ignore)\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="607"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="609"><highlight class="normal">}</highlight></codeline>
<codeline lineno="610"><highlight class="normal"></highlight></codeline>
<codeline lineno="611"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>--------------------------------------------------------------------------<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="612"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Minimal<sp/>cudart<sp/>dynamic<sp/>loader<sp/>(CUDA<sp/>strict<sp/>touch)<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="613"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>--------------------------------------------------------------------------<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="614"><highlight class="normal"></highlight></codeline>
<codeline lineno="618" refid="main__infer_8c_1a7056b1ed3833957f6045353293d33a10" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a7056b1ed3833957f6045353293d33a10" kindref="member">cudart_err_t</ref>;</highlight></codeline>
<codeline lineno="619"><highlight class="normal"></highlight></codeline>
<codeline lineno="623" refid="main__infer_8c_1ac0493a5218ac1cfe7720fd33073a26a4" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a7056b1ed3833957f6045353293d33a10" kindref="member">cudart_err_t</ref><sp/>(*<ref refid="main__infer_8c_1ac0493a5218ac1cfe7720fd33073a26a4" kindref="member">cudaFree_fn_t</ref>)(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*);</highlight></codeline>
<codeline lineno="624" refid="main__infer_8c_1a75d810977debadf83c51df3a9caf508e" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a7056b1ed3833957f6045353293d33a10" kindref="member">cudart_err_t</ref><sp/>(*<ref refid="main__infer_8c_1a75d810977debadf83c51df3a9caf508e" kindref="member">cudaMalloc_fn_t</ref>)(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>**,<sp/>size_t);</highlight></codeline>
<codeline lineno="625" refid="main__infer_8c_1a012d3ce1c3e56c941279966779621a25" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a7056b1ed3833957f6045353293d33a10" kindref="member">cudart_err_t</ref><sp/>(*<ref refid="main__infer_8c_1a012d3ce1c3e56c941279966779621a25" kindref="member">cudaMemcpy_fn_t</ref>)(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*,<sp/>size_t,<sp/>int);</highlight></codeline>
<codeline lineno="626" refid="main__infer_8c_1a2ad4e178cd6cc2f9b58919ba9e4ca7b6" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a7056b1ed3833957f6045353293d33a10" kindref="member">cudart_err_t</ref><sp/>(*<ref refid="main__infer_8c_1a2ad4e178cd6cc2f9b58919ba9e4ca7b6" kindref="member">cudaMemset_fn_t</ref>)(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*,<sp/>int,<sp/>size_t);</highlight></codeline>
<codeline lineno="627" refid="main__infer_8c_1a84c3a6f8fc81d43ea3d5343bc866773c" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a7056b1ed3833957f6045353293d33a10" kindref="member">cudart_err_t</ref><sp/>(*<ref refid="main__infer_8c_1a84c3a6f8fc81d43ea3d5343bc866773c" kindref="member">cudaDeviceSynchronize_fn_t</ref>)(void);</highlight></codeline>
<codeline lineno="628"><highlight class="normal"></highlight></codeline>
<codeline lineno="632"><highlight class="normal"></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="633" refid="main__infer_8c_1adf764cbdea00d65edcd07bb9953ad2b7a27d0e750ab6de4620beed5f2c3662c77" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="main__infer_8c_1adf764cbdea00d65edcd07bb9953ad2b7a27d0e750ab6de4620beed5f2c3662c77" kindref="member">CUDA_MEMCPY_HOST_TO_DEVICE</ref><sp/>=<sp/>1,</highlight></codeline>
<codeline lineno="634" refid="main__infer_8c_1adf764cbdea00d65edcd07bb9953ad2b7a866c5293b3ba22bb820c78bfae10f9ed" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="main__infer_8c_1adf764cbdea00d65edcd07bb9953ad2b7a866c5293b3ba22bb820c78bfae10f9ed" kindref="member">CUDA_MEMCPY_DEVICE_TO_HOST</ref><sp/>=<sp/>2,</highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><ref refid="main__infer_8c_1adf764cbdea00d65edcd07bb9953ad2b7a72dd74565a54b7fc09708f72ccf8fd5d" kindref="member">CUDA_MEMCPY_DEVICE_TO_DEVICE</ref><sp/>=<sp/>3</highlight></codeline>
<codeline lineno="636" refid="main__infer_8c_1adf764cbdea00d65edcd07bb9953ad2b7a72dd74565a54b7fc09708f72ccf8fd5d" refkind="member"><highlight class="normal">};</highlight></codeline>
<codeline lineno="637"><highlight class="normal"></highlight></codeline>
<codeline lineno="641" refid="structcudart__api" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structcudart__api" kindref="compound">cudart_api</ref><sp/>{</highlight></codeline>
<codeline lineno="642" refid="structcudart__api_1ae8f421003c605dc77bebe8fab65624cc" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*<ref refid="structcudart__api_1ae8f421003c605dc77bebe8fab65624cc" kindref="member">handle</ref>;</highlight></codeline>
<codeline lineno="643" refid="structcudart__api_1ad3b6ea8382433674c94c19f638d1224e" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structcudart__api_1ad3b6ea8382433674c94c19f638d1224e" kindref="member">ok</ref>;</highlight></codeline>
<codeline lineno="644" refid="structcudart__api_1a2c3660d016022d753aa36e57b5ed469c" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="main__infer_8c_1ac0493a5218ac1cfe7720fd33073a26a4" kindref="member">cudaFree_fn_t</ref><sp/><ref refid="structcudart__api_1a2c3660d016022d753aa36e57b5ed469c" kindref="member">cudaFree</ref>;</highlight></codeline>
<codeline lineno="645" refid="structcudart__api_1a90ebdb0591a336ef47414cd285d15371" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="main__infer_8c_1a75d810977debadf83c51df3a9caf508e" kindref="member">cudaMalloc_fn_t</ref><sp/><ref refid="structcudart__api_1a90ebdb0591a336ef47414cd285d15371" kindref="member">cudaMalloc</ref>;</highlight></codeline>
<codeline lineno="646" refid="structcudart__api_1a6e790e818a18bd526582a098649f2f92" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="main__infer_8c_1a012d3ce1c3e56c941279966779621a25" kindref="member">cudaMemcpy_fn_t</ref><sp/><ref refid="structcudart__api_1a6e790e818a18bd526582a098649f2f92" kindref="member">cudaMemcpy</ref>;</highlight></codeline>
<codeline lineno="647" refid="structcudart__api_1a7e9b278453c583049fcbb790bfa32c5d" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="main__infer_8c_1a2ad4e178cd6cc2f9b58919ba9e4ca7b6" kindref="member">cudaMemset_fn_t</ref><sp/><ref refid="structcudart__api_1a7e9b278453c583049fcbb790bfa32c5d" kindref="member">cudaMemset</ref>;</highlight></codeline>
<codeline lineno="648" refid="structcudart__api_1a8885e8aa343a956388d6fc359994b5b6" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="main__infer_8c_1a84c3a6f8fc81d43ea3d5343bc866773c" kindref="member">cudaDeviceSynchronize_fn_t</ref><sp/><ref refid="structcudart__api_1a8885e8aa343a956388d6fc359994b5b6" kindref="member">cudaDeviceSynchronize</ref>;</highlight></codeline>
<codeline lineno="649" refid="main__infer_8c_1a47a2371d08ac2298f34240909805e945" refkind="member"><highlight class="normal">}<sp/><ref refid="main__infer_8c_1a47a2371d08ac2298f34240909805e945" kindref="member">cudart_api_t</ref>;</highlight></codeline>
<codeline lineno="650"><highlight class="normal"></highlight></codeline>
<codeline lineno="655" refid="main__infer_8c_1aca4f099fbc130845b4af6c57ca21b3ef" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="structcudart__api" kindref="compound">cudart_api_t</ref><sp/>*<ref refid="main__infer_8c_1aca4f099fbc130845b4af6c57ca21b3ef" kindref="member">cudart_get_api</ref>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="structcudart__api" kindref="compound">cudart_api_t</ref><sp/>api;</highlight></codeline>
<codeline lineno="657"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>inited<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="658"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(inited)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>api.<ref refid="structcudart__api_1ad3b6ea8382433674c94c19f638d1224e" kindref="member">ok</ref><sp/>?<sp/>&amp;api<sp/>:<sp/>NULL;</highlight></codeline>
<codeline lineno="659"><highlight class="normal"><sp/><sp/>inited<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="660"><highlight class="normal"></highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/>memset(&amp;api,<sp/>0,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(api));</highlight></codeline>
<codeline lineno="662"><highlight class="normal"></highlight></codeline>
<codeline lineno="663"><highlight class="normal"><sp/><sp/>api.<ref refid="structcudart__api_1ae8f421003c605dc77bebe8fab65624cc" kindref="member">handle</ref><sp/>=<sp/>dlopen(</highlight><highlight class="stringliteral">&quot;libcudart.so&quot;</highlight><highlight class="normal">,<sp/>RTLD_NOW<sp/>|<sp/>RTLD_LOCAL);</highlight></codeline>
<codeline lineno="664"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!api.<ref refid="structcudart__api_1ae8f421003c605dc77bebe8fab65624cc" kindref="member">handle</ref>)<sp/>api.<ref refid="structcudart__api_1ae8f421003c605dc77bebe8fab65624cc" kindref="member">handle</ref><sp/>=<sp/>dlopen(</highlight><highlight class="stringliteral">&quot;libcudart.so.12&quot;</highlight><highlight class="normal">,<sp/>RTLD_NOW<sp/>|<sp/>RTLD_LOCAL);</highlight></codeline>
<codeline lineno="665"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!api.<ref refid="structcudart__api_1ae8f421003c605dc77bebe8fab65624cc" kindref="member">handle</ref>)<sp/>api.<ref refid="structcudart__api_1ae8f421003c605dc77bebe8fab65624cc" kindref="member">handle</ref><sp/>=<sp/>dlopen(</highlight><highlight class="stringliteral">&quot;libcudart.so.11.0&quot;</highlight><highlight class="normal">,<sp/>RTLD_NOW<sp/>|<sp/>RTLD_LOCAL);</highlight></codeline>
<codeline lineno="666"><highlight class="normal"></highlight></codeline>
<codeline lineno="667"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!api.<ref refid="structcudart__api_1ae8f421003c605dc77bebe8fab65624cc" kindref="member">handle</ref>)<sp/>{</highlight></codeline>
<codeline lineno="668"><highlight class="normal"><sp/><sp/><sp/><sp/>api.<ref refid="structcudart__api_1ad3b6ea8382433674c94c19f638d1224e" kindref="member">ok</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="669"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="670"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="671"><highlight class="normal"></highlight></codeline>
<codeline lineno="672"><highlight class="normal"><sp/><sp/>{<sp/></highlight><highlight class="keyword">union<sp/></highlight><highlight class="normal">{<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*p;<sp/><ref refid="main__infer_8c_1ac0493a5218ac1cfe7720fd33073a26a4" kindref="member">cudaFree_fn_t</ref><sp/>f;<sp/>}<sp/>u;<sp/>u.p<sp/>=<sp/>dlsym(api.<ref refid="structcudart__api_1ae8f421003c605dc77bebe8fab65624cc" kindref="member">handle</ref>,<sp/></highlight><highlight class="stringliteral">&quot;cudaFree&quot;</highlight><highlight class="normal">);<sp/>api.<ref refid="structcudart__api_1a2c3660d016022d753aa36e57b5ed469c" kindref="member">cudaFree</ref><sp/>=<sp/>u.f;<sp/>}</highlight></codeline>
<codeline lineno="673"><highlight class="normal"><sp/><sp/>{<sp/></highlight><highlight class="keyword">union<sp/></highlight><highlight class="normal">{<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*p;<sp/><ref refid="main__infer_8c_1a75d810977debadf83c51df3a9caf508e" kindref="member">cudaMalloc_fn_t</ref><sp/>f;<sp/>}<sp/>u;<sp/>u.p<sp/>=<sp/>dlsym(api.<ref refid="structcudart__api_1ae8f421003c605dc77bebe8fab65624cc" kindref="member">handle</ref>,<sp/></highlight><highlight class="stringliteral">&quot;cudaMalloc&quot;</highlight><highlight class="normal">);<sp/>api.<ref refid="structcudart__api_1a90ebdb0591a336ef47414cd285d15371" kindref="member">cudaMalloc</ref><sp/>=<sp/>u.f;<sp/>}</highlight></codeline>
<codeline lineno="674"><highlight class="normal"><sp/><sp/>{<sp/></highlight><highlight class="keyword">union<sp/></highlight><highlight class="normal">{<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*p;<sp/><ref refid="main__infer_8c_1a012d3ce1c3e56c941279966779621a25" kindref="member">cudaMemcpy_fn_t</ref><sp/>f;<sp/>}<sp/>u;<sp/>u.p<sp/>=<sp/>dlsym(api.<ref refid="structcudart__api_1ae8f421003c605dc77bebe8fab65624cc" kindref="member">handle</ref>,<sp/></highlight><highlight class="stringliteral">&quot;cudaMemcpy&quot;</highlight><highlight class="normal">);<sp/>api.<ref refid="structcudart__api_1a6e790e818a18bd526582a098649f2f92" kindref="member">cudaMemcpy</ref><sp/>=<sp/>u.f;<sp/>}</highlight></codeline>
<codeline lineno="675"><highlight class="normal"><sp/><sp/>{<sp/></highlight><highlight class="keyword">union<sp/></highlight><highlight class="normal">{<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*p;<sp/><ref refid="main__infer_8c_1a2ad4e178cd6cc2f9b58919ba9e4ca7b6" kindref="member">cudaMemset_fn_t</ref><sp/>f;<sp/>}<sp/>u;<sp/>u.p<sp/>=<sp/>dlsym(api.<ref refid="structcudart__api_1ae8f421003c605dc77bebe8fab65624cc" kindref="member">handle</ref>,<sp/></highlight><highlight class="stringliteral">&quot;cudaMemset&quot;</highlight><highlight class="normal">);<sp/>api.<ref refid="structcudart__api_1a7e9b278453c583049fcbb790bfa32c5d" kindref="member">cudaMemset</ref><sp/>=<sp/>u.f;<sp/>}</highlight></codeline>
<codeline lineno="676"><highlight class="normal"><sp/><sp/>{<sp/></highlight><highlight class="keyword">union<sp/></highlight><highlight class="normal">{<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*p;<sp/><ref refid="main__infer_8c_1a84c3a6f8fc81d43ea3d5343bc866773c" kindref="member">cudaDeviceSynchronize_fn_t</ref><sp/>f;<sp/>}<sp/>u;<sp/>u.p<sp/>=<sp/>dlsym(api.<ref refid="structcudart__api_1ae8f421003c605dc77bebe8fab65624cc" kindref="member">handle</ref>,<sp/></highlight><highlight class="stringliteral">&quot;cudaDeviceSynchronize&quot;</highlight><highlight class="normal">);<sp/>api.<ref refid="structcudart__api_1a8885e8aa343a956388d6fc359994b5b6" kindref="member">cudaDeviceSynchronize</ref><sp/>=<sp/>u.f;<sp/>}</highlight></codeline>
<codeline lineno="677"><highlight class="normal"></highlight></codeline>
<codeline lineno="678"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!api.<ref refid="structcudart__api_1a2c3660d016022d753aa36e57b5ed469c" kindref="member">cudaFree</ref><sp/>||<sp/>!api.<ref refid="structcudart__api_1a90ebdb0591a336ef47414cd285d15371" kindref="member">cudaMalloc</ref><sp/>||<sp/>!api.<ref refid="structcudart__api_1a6e790e818a18bd526582a098649f2f92" kindref="member">cudaMemcpy</ref><sp/>||<sp/>!api.<ref refid="structcudart__api_1a7e9b278453c583049fcbb790bfa32c5d" kindref="member">cudaMemset</ref><sp/>||<sp/>!api.<ref refid="structcudart__api_1a8885e8aa343a956388d6fc359994b5b6" kindref="member">cudaDeviceSynchronize</ref>)<sp/>{</highlight></codeline>
<codeline lineno="679"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)dlclose(api.<ref refid="structcudart__api_1ae8f421003c605dc77bebe8fab65624cc" kindref="member">handle</ref>);</highlight></codeline>
<codeline lineno="680"><highlight class="normal"><sp/><sp/><sp/><sp/>api.<ref refid="structcudart__api_1ae8f421003c605dc77bebe8fab65624cc" kindref="member">handle</ref><sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="681"><highlight class="normal"><sp/><sp/><sp/><sp/>api.<ref refid="structcudart__api_1ad3b6ea8382433674c94c19f638d1224e" kindref="member">ok</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="682"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="684"><highlight class="normal"></highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/>api.<ref refid="structcudart__api_1ad3b6ea8382433674c94c19f638d1224e" kindref="member">ok</ref><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="686"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>&amp;api;</highlight></codeline>
<codeline lineno="687"><highlight class="normal">}</highlight></codeline>
<codeline lineno="688"><highlight class="normal"></highlight></codeline>
<codeline lineno="697" refid="main__infer_8c_1a44a0de9d17f6eff8a4764537268ab5d1" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a44a0de9d17f6eff8a4764537268ab5d1" kindref="member">cudart_touch_bytes</ref>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>bytes_per_token,</highlight></codeline>
<codeline lineno="698"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint64_t<sp/>tokens,</highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>stride_bytes,</highlight></codeline>
<codeline lineno="700"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>verify_touch)<sp/>{</highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/><ref refid="main__infer_8c_1a86d500a34c624c2cae56bc25a31b12f3" kindref="member">UNUSED</ref>(stride_bytes);</highlight></codeline>
<codeline lineno="702"><highlight class="normal"></highlight></codeline>
<codeline lineno="703"><highlight class="normal"><sp/><sp/><ref refid="structcudart__api" kindref="compound">cudart_api_t</ref><sp/>*api<sp/>=<sp/><ref refid="main__infer_8c_1aca4f099fbc130845b4af6c57ca21b3ef" kindref="member">cudart_get_api</ref>();</highlight></codeline>
<codeline lineno="704"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!api)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="705"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(bytes_per_token<sp/>==<sp/>0<sp/>||<sp/>tokens<sp/>==<sp/>0)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="706"><highlight class="normal"></highlight></codeline>
<codeline lineno="707"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*d<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="708"><highlight class="normal"><sp/><sp/><ref refid="main__infer_8c_1a7056b1ed3833957f6045353293d33a10" kindref="member">cudart_err_t</ref><sp/>e<sp/>=<sp/>api-&gt;<ref refid="structcudart__api_1a90ebdb0591a336ef47414cd285d15371" kindref="member">cudaMalloc</ref>(&amp;d,<sp/>bytes_per_token);</highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(e<sp/>!=<sp/>0<sp/>||<sp/>!d)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="710"><highlight class="normal"></highlight></codeline>
<codeline lineno="711"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(uint64_t<sp/>t<sp/>=<sp/>0;<sp/>t<sp/>&lt;<sp/>tokens;<sp/>++t)<sp/>{</highlight></codeline>
<codeline lineno="712"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>pattern<sp/>=<sp/>(int)(t<sp/>&amp;<sp/>0xFFu);</highlight></codeline>
<codeline lineno="713"><highlight class="normal"><sp/><sp/><sp/><sp/>e<sp/>=<sp/>api-&gt;<ref refid="structcudart__api_1a7e9b278453c583049fcbb790bfa32c5d" kindref="member">cudaMemset</ref>(d,<sp/>pattern,<sp/>bytes_per_token);</highlight></codeline>
<codeline lineno="714"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(e<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="715"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>(void)api-&gt;<ref refid="structcudart__api_1a2c3660d016022d753aa36e57b5ed469c" kindref="member">cudaFree</ref>(d);</highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>2;</highlight></codeline>
<codeline lineno="717"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="718"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="719"><highlight class="normal"></highlight></codeline>
<codeline lineno="720"><highlight class="normal"><sp/><sp/>e<sp/>=<sp/>api-&gt;<ref refid="structcudart__api_1a8885e8aa343a956388d6fc359994b5b6" kindref="member">cudaDeviceSynchronize</ref>();</highlight></codeline>
<codeline lineno="721"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(e<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="722"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)api-&gt;<ref refid="structcudart__api_1a2c3660d016022d753aa36e57b5ed469c" kindref="member">cudaFree</ref>(d);</highlight></codeline>
<codeline lineno="723"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>3;</highlight></codeline>
<codeline lineno="724"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="725"><highlight class="normal"></highlight></codeline>
<codeline lineno="726"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(verify_touch)<sp/>{</highlight></codeline>
<codeline lineno="727"><highlight class="normal"><sp/><sp/><sp/><sp/>uint64_t<sp/>tmp<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="728"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n<sp/>=<sp/><ref refid="main__infer_8c_1a42d8c2f3c8817b30177d0a7e39742b03" kindref="member">min_size</ref>(</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(tmp),<sp/>bytes_per_token);</highlight></codeline>
<codeline lineno="729"><highlight class="normal"><sp/><sp/><sp/><sp/>e<sp/>=<sp/>api-&gt;<ref refid="structcudart__api_1a6e790e818a18bd526582a098649f2f92" kindref="member">cudaMemcpy</ref>(&amp;tmp,<sp/>d,<sp/>n,<sp/><ref refid="main__infer_8c_1adf764cbdea00d65edcd07bb9953ad2b7a866c5293b3ba22bb820c78bfae10f9ed" kindref="member">CUDA_MEMCPY_DEVICE_TO_HOST</ref>);</highlight></codeline>
<codeline lineno="730"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(e<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="731"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>(void)api-&gt;<ref refid="structcudart__api_1a2c3660d016022d753aa36e57b5ed469c" kindref="member">cudaFree</ref>(d);</highlight></codeline>
<codeline lineno="732"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>4;</highlight></codeline>
<codeline lineno="733"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/><sp/><sp/>e<sp/>=<sp/>api-&gt;<ref refid="structcudart__api_1a8885e8aa343a956388d6fc359994b5b6" kindref="member">cudaDeviceSynchronize</ref>();</highlight></codeline>
<codeline lineno="735"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(e<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="736"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>(void)api-&gt;<ref refid="structcudart__api_1a2c3660d016022d753aa36e57b5ed469c" kindref="member">cudaFree</ref>(d);</highlight></codeline>
<codeline lineno="737"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>5;</highlight></codeline>
<codeline lineno="738"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="739"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)tmp;</highlight></codeline>
<codeline lineno="740"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="741"><highlight class="normal"></highlight></codeline>
<codeline lineno="742"><highlight class="normal"><sp/><sp/>(void)api-&gt;<ref refid="structcudart__api_1a2c3660d016022d753aa36e57b5ed469c" kindref="member">cudaFree</ref>(d);</highlight></codeline>
<codeline lineno="743"><highlight class="normal"><sp/><sp/>(void)api-&gt;<ref refid="structcudart__api_1a8885e8aa343a956388d6fc359994b5b6" kindref="member">cudaDeviceSynchronize</ref>();</highlight></codeline>
<codeline lineno="744"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="745"><highlight class="normal">}</highlight></codeline>
<codeline lineno="746"><highlight class="normal"></highlight></codeline>
<codeline lineno="747"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>--------------------------------------------------------------------------<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="748"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Token<sp/>decoding<sp/>via<sp/>project<sp/>tokenizer<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="749"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>--------------------------------------------------------------------------<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="750"><highlight class="normal"></highlight></codeline>
<codeline lineno="761" refid="main__infer_8c_1a7427a4a1579fb747a4ce22a4a1d4a80a" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a7427a4a1579fb747a4ce22a4a1d4a80a" kindref="member">json_print_escaped_string</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*s)<sp/>{</highlight></codeline>
<codeline lineno="762"><highlight class="normal"><sp/><sp/>fputc(</highlight><highlight class="charliteral">&apos;&quot;&apos;</highlight><highlight class="normal">,<sp/>stdout);</highlight></codeline>
<codeline lineno="763"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!s)<sp/>{</highlight></codeline>
<codeline lineno="764"><highlight class="normal"><sp/><sp/><sp/><sp/>fputc(</highlight><highlight class="charliteral">&apos;&quot;&apos;</highlight><highlight class="normal">,<sp/>stdout);</highlight></codeline>
<codeline lineno="765"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="766"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="767"><highlight class="normal"></highlight></codeline>
<codeline lineno="768"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*p<sp/>=<sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*)s;</highlight></codeline>
<codeline lineno="769"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(*p)<sp/>{</highlight></codeline>
<codeline lineno="770"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>c<sp/>=<sp/>*p++;</highlight></codeline>
<codeline lineno="771"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(c<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\\&apos;</highlight><highlight class="normal">)<sp/>fputs(</highlight><highlight class="stringliteral">&quot;\\\\&quot;</highlight><highlight class="normal">,<sp/>stdout);</highlight></codeline>
<codeline lineno="772"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(c<sp/>==<sp/></highlight><highlight class="charliteral">&apos;&quot;&apos;</highlight><highlight class="normal">)<sp/>fputs(</highlight><highlight class="stringliteral">&quot;\\\&quot;&quot;</highlight><highlight class="normal">,<sp/>stdout);</highlight></codeline>
<codeline lineno="773"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(c<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\n&apos;</highlight><highlight class="normal">)<sp/>fputs(</highlight><highlight class="stringliteral">&quot;\\n&quot;</highlight><highlight class="normal">,<sp/>stdout);</highlight></codeline>
<codeline lineno="774"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(c<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\r&apos;</highlight><highlight class="normal">)<sp/>fputs(</highlight><highlight class="stringliteral">&quot;\\r&quot;</highlight><highlight class="normal">,<sp/>stdout);</highlight></codeline>
<codeline lineno="775"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(c<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\t&apos;</highlight><highlight class="normal">)<sp/>fputs(</highlight><highlight class="stringliteral">&quot;\\t&quot;</highlight><highlight class="normal">,<sp/>stdout);</highlight></codeline>
<codeline lineno="776"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(c<sp/>&lt;<sp/>0x20u)<sp/>{</highlight></codeline>
<codeline lineno="777"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stdout,<sp/></highlight><highlight class="stringliteral">&quot;\\u%04x&quot;</highlight><highlight class="normal">,<sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">)c);</highlight></codeline>
<codeline lineno="778"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="779"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>fputc((</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)c,<sp/>stdout);</highlight></codeline>
<codeline lineno="780"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="781"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="782"><highlight class="normal"><sp/><sp/>fputc(</highlight><highlight class="charliteral">&apos;&quot;&apos;</highlight><highlight class="normal">,<sp/>stdout);</highlight></codeline>
<codeline lineno="783"><highlight class="normal">}</highlight></codeline>
<codeline lineno="784"><highlight class="normal"></highlight></codeline>
<codeline lineno="810" refid="main__infer_8c_1a0271a21f39c53534b7a1a3cc7eb94596" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a0271a21f39c53534b7a1a3cc7eb94596" kindref="member">resolve_tokenizer_path</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*model_dir,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*tokenizer_opt,<sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*out,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>outsz)<sp/>{</highlight></codeline>
<codeline lineno="811"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!out<sp/>||<sp/>outsz<sp/>==<sp/>0)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="812"><highlight class="normal"><sp/><sp/>out[0]<sp/>=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="813"><highlight class="normal"></highlight></codeline>
<codeline lineno="814"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(tokenizer_opt<sp/>&amp;&amp;<sp/>*tokenizer_opt)<sp/>{</highlight></codeline>
<codeline lineno="815"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1a35a9aadd511e6b3688d01a67a12c7651" kindref="member">path_is_abs</ref>(tokenizer_opt)<sp/>||<sp/>!model_dir<sp/>||<sp/>!*model_dir)<sp/><ref refid="main__infer_8c_1a210133797f21fcee710ec892841dce42" kindref="member">safe_strcpy</ref>(out,<sp/>outsz,<sp/>tokenizer_opt);</highlight></codeline>
<codeline lineno="816"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1adca9b33a342b8635e28ba51aecb365f6" kindref="member">join_path</ref>(out,<sp/>outsz,<sp/>model_dir,<sp/>tokenizer_opt);</highlight></codeline>
<codeline lineno="817"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="818"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="819"><highlight class="normal"></highlight></codeline>
<codeline lineno="820"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!model_dir<sp/>||<sp/>!*model_dir)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="821"><highlight class="normal"></highlight></codeline>
<codeline lineno="822"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>cand[<ref refid="main__infer_8c_1ae688d728e1acdfe5988c7db45d6f0166" kindref="member">PATH_MAX</ref>];</highlight></codeline>
<codeline lineno="823"><highlight class="normal"></highlight></codeline>
<codeline lineno="824"><highlight class="normal"><sp/><sp/><ref refid="main__infer_8c_1adca9b33a342b8635e28ba51aecb365f6" kindref="member">join_path</ref>(cand,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(cand),<sp/>model_dir,<sp/></highlight><highlight class="stringliteral">&quot;hf/original/tokenizer.tiktoken&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="825"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1a0cbea455e9868581360f43c63db6554c" kindref="member">path_exists</ref>(cand))<sp/>{<sp/><ref refid="main__infer_8c_1a210133797f21fcee710ec892841dce42" kindref="member">safe_strcpy</ref>(out,<sp/>outsz,<sp/>cand);<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;<sp/>}</highlight></codeline>
<codeline lineno="826"><highlight class="normal"></highlight></codeline>
<codeline lineno="827"><highlight class="normal"><sp/><sp/><ref refid="main__infer_8c_1adca9b33a342b8635e28ba51aecb365f6" kindref="member">join_path</ref>(cand,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(cand),<sp/>model_dir,<sp/></highlight><highlight class="stringliteral">&quot;tokenizer.tiktoken&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="828"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1a0cbea455e9868581360f43c63db6554c" kindref="member">path_exists</ref>(cand))<sp/>{<sp/><ref refid="main__infer_8c_1a210133797f21fcee710ec892841dce42" kindref="member">safe_strcpy</ref>(out,<sp/>outsz,<sp/>cand);<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;<sp/>}</highlight></codeline>
<codeline lineno="829"><highlight class="normal"></highlight></codeline>
<codeline lineno="830"><highlight class="normal"><sp/><sp/><ref refid="main__infer_8c_1adca9b33a342b8635e28ba51aecb365f6" kindref="member">join_path</ref>(cand,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(cand),<sp/>model_dir,<sp/></highlight><highlight class="stringliteral">&quot;original/tokenizer.tiktoken&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="831"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1a0cbea455e9868581360f43c63db6554c" kindref="member">path_exists</ref>(cand))<sp/>{<sp/><ref refid="main__infer_8c_1a210133797f21fcee710ec892841dce42" kindref="member">safe_strcpy</ref>(out,<sp/>outsz,<sp/>cand);<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;<sp/>}</highlight></codeline>
<codeline lineno="832"><highlight class="normal"></highlight></codeline>
<codeline lineno="833"><highlight class="normal"><sp/><sp/><ref refid="main__infer_8c_1adca9b33a342b8635e28ba51aecb365f6" kindref="member">join_path</ref>(cand,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(cand),<sp/>model_dir,<sp/></highlight><highlight class="stringliteral">&quot;hf/original/tokenizer.json&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="834"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1a0cbea455e9868581360f43c63db6554c" kindref="member">path_exists</ref>(cand))<sp/>{<sp/><ref refid="main__infer_8c_1a210133797f21fcee710ec892841dce42" kindref="member">safe_strcpy</ref>(out,<sp/>outsz,<sp/>cand);<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;<sp/>}</highlight></codeline>
<codeline lineno="835"><highlight class="normal"></highlight></codeline>
<codeline lineno="836"><highlight class="normal"><sp/><sp/><ref refid="main__infer_8c_1adca9b33a342b8635e28ba51aecb365f6" kindref="member">join_path</ref>(cand,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(cand),<sp/>model_dir,<sp/></highlight><highlight class="stringliteral">&quot;tokenizer.json&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="837"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1a0cbea455e9868581360f43c63db6554c" kindref="member">path_exists</ref>(cand))<sp/>{<sp/><ref refid="main__infer_8c_1a210133797f21fcee710ec892841dce42" kindref="member">safe_strcpy</ref>(out,<sp/>outsz,<sp/>cand);<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;<sp/>}</highlight></codeline>
<codeline lineno="838"><highlight class="normal"></highlight></codeline>
<codeline lineno="839"><highlight class="normal"><sp/><sp/><ref refid="main__infer_8c_1adca9b33a342b8635e28ba51aecb365f6" kindref="member">join_path</ref>(cand,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(cand),<sp/>model_dir,<sp/></highlight><highlight class="stringliteral">&quot;original/tokenizer.json&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="840"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1a0cbea455e9868581360f43c63db6554c" kindref="member">path_exists</ref>(cand))<sp/>{<sp/><ref refid="main__infer_8c_1a210133797f21fcee710ec892841dce42" kindref="member">safe_strcpy</ref>(out,<sp/>outsz,<sp/>cand);<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;<sp/>}</highlight></codeline>
<codeline lineno="841"><highlight class="normal">}</highlight></codeline>
<codeline lineno="842"><highlight class="normal"></highlight></codeline>
<codeline lineno="866" refid="main__infer_8c_1a4e30eb4737647a78c4dbebb5b008a5bd" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a4e30eb4737647a78c4dbebb5b008a5bd" kindref="member">decode_tokens_best_effort</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*tok_path,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*ids,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n,<sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>**out_text)<sp/>{</highlight></codeline>
<codeline lineno="867"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!out_text)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="868"><highlight class="normal"><sp/><sp/>*out_text<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="869"><highlight class="normal"></highlight></codeline>
<codeline lineno="870"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!tok_path<sp/>||<sp/>!*tok_path)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>2;</highlight></codeline>
<codeline lineno="871"><highlight class="normal"></highlight></codeline>
<codeline lineno="872"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!ids<sp/>||<sp/>n<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="873"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*z<sp/>=<sp/>(</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*)malloc(1);</highlight></codeline>
<codeline lineno="874"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!z)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>3;</highlight></codeline>
<codeline lineno="875"><highlight class="normal"><sp/><sp/><sp/><sp/>z[0]<sp/>=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="876"><highlight class="normal"><sp/><sp/><sp/><sp/>*out_text<sp/>=<sp/>z;</highlight></codeline>
<codeline lineno="877"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="878"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="879"><highlight class="normal"></highlight></codeline>
<codeline lineno="880"><highlight class="normal"><sp/><sp/>uint32_t<sp/>*u32<sp/>=<sp/>(uint32_t<sp/>*)malloc(</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(uint32_t)<sp/>*<sp/>n);</highlight></codeline>
<codeline lineno="881"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!u32)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>4;</highlight></codeline>
<codeline lineno="882"><highlight class="normal"></highlight></codeline>
<codeline lineno="883"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>k<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="884"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>n;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="885"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>v<sp/>=<sp/>ids[i];</highlight></codeline>
<codeline lineno="886"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(v<sp/>&lt;<sp/>0)<sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="887"><highlight class="normal"><sp/><sp/><sp/><sp/>u32[k++]<sp/>=<sp/>(uint32_t)v;</highlight></codeline>
<codeline lineno="888"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="889"><highlight class="normal"></highlight></codeline>
<codeline lineno="890"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(k<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="891"><highlight class="normal"><sp/><sp/><sp/><sp/>free(u32);</highlight></codeline>
<codeline lineno="892"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*z<sp/>=<sp/>(</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*)malloc(1);</highlight></codeline>
<codeline lineno="893"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!z)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>5;</highlight></codeline>
<codeline lineno="894"><highlight class="normal"><sp/><sp/><sp/><sp/>z[0]<sp/>=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="895"><highlight class="normal"><sp/><sp/><sp/><sp/>*out_text<sp/>=<sp/>z;</highlight></codeline>
<codeline lineno="896"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="897"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="898"><highlight class="normal"></highlight></codeline>
<codeline lineno="899"><highlight class="normal"><sp/><sp/><ref refid="structie__tok__gptoss__s" kindref="compound">ie_tok_gptoss_t</ref><sp/>*tok<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="900"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ts<sp/>=<sp/><ref refid="ie__tokenizer__gptoss_8h_1ae5c55dc1502414c60d1a99fa9fbdf1bc" kindref="member">ie_tok_gptoss_open</ref>(tok_path,<sp/>&amp;tok);</highlight></codeline>
<codeline lineno="901"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ts<sp/>==<sp/><ref refid="ie__tokenizer__gptoss_8h_1a1305696bd5b44e9ad4e2b624ce1b59f2a6e804d975236c9745c44c1db1baed259" kindref="member">IE_TOK_GPTOSS_OK</ref><sp/>&amp;&amp;<sp/>tok)<sp/>{</highlight></codeline>
<codeline lineno="902"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>need<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="903"><highlight class="normal"><sp/><sp/><sp/><sp/>ts<sp/>=<sp/><ref refid="ie__tokenizer__gptoss_8h_1ae372932b3912864351defd6ce553ed88" kindref="member">ie_tok_gptoss_decode</ref>(tok,<sp/>u32,<sp/>(uint32_t)<ref refid="main__infer_8c_1a42d8c2f3c8817b30177d0a7e39742b03" kindref="member">min_size</ref>(k,<sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal">)0xFFFFFFFFu),<sp/>NULL,<sp/>&amp;need);</highlight></codeline>
<codeline lineno="904"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ts<sp/>==<sp/><ref refid="ie__tokenizer__gptoss_8h_1a1305696bd5b44e9ad4e2b624ce1b59f2a6e804d975236c9745c44c1db1baed259" kindref="member">IE_TOK_GPTOSS_OK</ref><sp/>&amp;&amp;<sp/>need<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="905"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*buf<sp/>=<sp/>(</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*)malloc(need);</highlight></codeline>
<codeline lineno="906"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!buf)<sp/>{</highlight></codeline>
<codeline lineno="907"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(void)<ref refid="ie__tokenizer__gptoss_8h_1ad4b875bec514bb9c1de945944e1596de" kindref="member">ie_tok_gptoss_close</ref>(tok);</highlight></codeline>
<codeline lineno="908"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(u32);</highlight></codeline>
<codeline lineno="909"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>6;</highlight></codeline>
<codeline lineno="910"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="911"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>outn<sp/>=<sp/>need;</highlight></codeline>
<codeline lineno="912"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>ts<sp/>=<sp/><ref refid="ie__tokenizer__gptoss_8h_1ae372932b3912864351defd6ce553ed88" kindref="member">ie_tok_gptoss_decode</ref>(tok,<sp/>u32,<sp/>(uint32_t)<ref refid="main__infer_8c_1a42d8c2f3c8817b30177d0a7e39742b03" kindref="member">min_size</ref>(k,<sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal">)0xFFFFFFFFu),<sp/>buf,<sp/>&amp;outn);</highlight></codeline>
<codeline lineno="913"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ts<sp/>==<sp/><ref refid="ie__tokenizer__gptoss_8h_1a1305696bd5b44e9ad4e2b624ce1b59f2a6e804d975236c9745c44c1db1baed259" kindref="member">IE_TOK_GPTOSS_OK</ref>)<sp/>{</highlight></codeline>
<codeline lineno="914"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*out_text<sp/>=<sp/>buf;</highlight></codeline>
<codeline lineno="915"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(void)<ref refid="ie__tokenizer__gptoss_8h_1ad4b875bec514bb9c1de945944e1596de" kindref="member">ie_tok_gptoss_close</ref>(tok);</highlight></codeline>
<codeline lineno="916"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(u32);</highlight></codeline>
<codeline lineno="917"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="918"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="919"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>free(buf);</highlight></codeline>
<codeline lineno="920"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="921"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)<ref refid="ie__tokenizer__gptoss_8h_1ad4b875bec514bb9c1de945944e1596de" kindref="member">ie_tok_gptoss_close</ref>(tok);</highlight></codeline>
<codeline lineno="922"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="923"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(stderr,</highlight></codeline>
<codeline lineno="924"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;warn:<sp/>tokenizer_open<sp/>failed<sp/>for<sp/>&apos;%s&apos;<sp/>(status=%d)%s\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="925"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tok_path,</highlight></codeline>
<codeline lineno="926"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)ts,</highlight></codeline>
<codeline lineno="927"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="main__infer_8c_1a82ba5822565056bddf97d8b9d425d9b9" kindref="member">ends_with</ref>(tok_path,<sp/></highlight><highlight class="stringliteral">&quot;.tiktoken&quot;</highlight><highlight class="normal">)<sp/>?<sp/></highlight><highlight class="stringliteral">&quot;<sp/>(tiktoken<sp/>decode<sp/>may<sp/>be<sp/>unimplemented)&quot;</highlight><highlight class="normal"><sp/>:<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="928"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="929"><highlight class="normal"></highlight></codeline>
<codeline lineno="930"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Fallback:<sp/>emit<sp/>placeholders<sp/>so<sp/>the<sp/>output<sp/>stays<sp/>valid<sp/>and<sp/>debuggable.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="931"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="932"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>cap<sp/>=<sp/>256;</highlight></codeline>
<codeline lineno="933"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>len<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="934"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*buf<sp/>=<sp/>(</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*)malloc(cap);</highlight></codeline>
<codeline lineno="935"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!buf)<sp/>{</highlight></codeline>
<codeline lineno="936"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>free(u32);</highlight></codeline>
<codeline lineno="937"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>7;</highlight></codeline>
<codeline lineno="938"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="939"><highlight class="normal"><sp/><sp/><sp/><sp/>buf[0]<sp/>=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="940"><highlight class="normal"></highlight></codeline>
<codeline lineno="941"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>k;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="942"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>tmp[64];</highlight></codeline>
<codeline lineno="943"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>(void)snprintf(tmp,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(tmp),<sp/></highlight><highlight class="stringliteral">&quot;&lt;%u&gt;&quot;</highlight><highlight class="normal">,<sp/>(unsigned)u32[i]);</highlight></codeline>
<codeline lineno="944"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>add<sp/>=<sp/>strlen(tmp);</highlight></codeline>
<codeline lineno="945"><highlight class="normal"></highlight></codeline>
<codeline lineno="946"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(len<sp/>+<sp/>add<sp/>+<sp/>1<sp/>&gt;<sp/>cap)<sp/>{</highlight></codeline>
<codeline lineno="947"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>ncap<sp/>=<sp/>cap;</highlight></codeline>
<codeline lineno="948"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(len<sp/>+<sp/>add<sp/>+<sp/>1<sp/>&gt;<sp/>ncap)<sp/>ncap<sp/>*=<sp/>2;</highlight></codeline>
<codeline lineno="949"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*nb<sp/>=<sp/>(</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*)realloc(buf,<sp/>ncap);</highlight></codeline>
<codeline lineno="950"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!nb)<sp/>{<sp/>free(buf);<sp/>free(u32);<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>8;<sp/>}</highlight></codeline>
<codeline lineno="951"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>buf<sp/>=<sp/>nb;</highlight></codeline>
<codeline lineno="952"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cap<sp/>=<sp/>ncap;</highlight></codeline>
<codeline lineno="953"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="954"><highlight class="normal"></highlight></codeline>
<codeline lineno="955"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(buf<sp/>+<sp/>len,<sp/>tmp,<sp/>add);</highlight></codeline>
<codeline lineno="956"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>len<sp/>+=<sp/>add;</highlight></codeline>
<codeline lineno="957"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>buf[len]<sp/>=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="958"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="959"><highlight class="normal"></highlight></codeline>
<codeline lineno="960"><highlight class="normal"><sp/><sp/><sp/><sp/>*out_text<sp/>=<sp/>buf;</highlight></codeline>
<codeline lineno="961"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="962"><highlight class="normal"></highlight></codeline>
<codeline lineno="963"><highlight class="normal"><sp/><sp/>free(u32);</highlight></codeline>
<codeline lineno="964"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="965"><highlight class="normal">}</highlight></codeline>
<codeline lineno="966"><highlight class="normal"></highlight></codeline>
<codeline lineno="967"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>--------------------------------------------------------------------------<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="968"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>CLI<sp/>options<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="969"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>--------------------------------------------------------------------------<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="970"><highlight class="normal"></highlight></codeline>
<codeline lineno="974" refid="main__infer_8c_1ae715f0cc745f58eebd4be50b187dd41d" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">enum</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="975" refid="main__infer_8c_1ae715f0cc745f58eebd4be50b187dd41da382ceb68dddaaf8b27ac21f144305e74" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="main__infer_8c_1ae715f0cc745f58eebd4be50b187dd41da382ceb68dddaaf8b27ac21f144305e74" kindref="member">CLI_PRETX_NONE</ref><sp/>=<sp/>0,</highlight></codeline>
<codeline lineno="976" refid="main__infer_8c_1ae715f0cc745f58eebd4be50b187dd41da9d22d4f265254a65af9fc3a7d648fe5d" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="main__infer_8c_1ae715f0cc745f58eebd4be50b187dd41da9d22d4f265254a65af9fc3a7d648fe5d" kindref="member">CLI_PRETX_WOH</ref><sp/><sp/>=<sp/>1,</highlight></codeline>
<codeline lineno="977" refid="main__infer_8c_1ae715f0cc745f58eebd4be50b187dd41da1a251ee24fdcadcaf9c888e0a96140e7" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="main__infer_8c_1ae715f0cc745f58eebd4be50b187dd41da1a251ee24fdcadcaf9c888e0a96140e7" kindref="member">CLI_PRETX_WXH</ref><sp/><sp/>=<sp/>2,</highlight></codeline>
<codeline lineno="978"><highlight class="normal"><sp/><sp/><ref refid="main__infer_8c_1ae715f0cc745f58eebd4be50b187dd41da4fad867319e4f9197a9c373762a3ad54" kindref="member">CLI_PRETX_ALL</ref><sp/><sp/>=<sp/>3</highlight></codeline>
<codeline lineno="979" refid="main__infer_8c_1ae715f0cc745f58eebd4be50b187dd41da4fad867319e4f9197a9c373762a3ad54" refkind="member"><highlight class="normal">}<sp/><ref refid="main__infer_8c_1ae715f0cc745f58eebd4be50b187dd41d" kindref="member">cli_pretranspose_t</ref>;</highlight></codeline>
<codeline lineno="980"><highlight class="normal"></highlight></codeline>
<codeline lineno="984" refid="structcli__extras" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structcli__extras" kindref="compound">cli_extras</ref><sp/>{</highlight></codeline>
<codeline lineno="985" refid="structcli__extras_1aa45c7376781454d767d2202800c27a3e" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="structcli__extras_1aa45c7376781454d767d2202800c27a3e" kindref="member">prompt</ref>;</highlight></codeline>
<codeline lineno="986" refid="structcli__extras_1a5eb0317aa09b90f400b657245b41e92c" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/><ref refid="structcli__extras_1a5eb0317aa09b90f400b657245b41e92c" kindref="member">max_new</ref>;</highlight></codeline>
<codeline lineno="987" refid="structcli__extras_1a4e8cdca32127b81f8fcb41047a320844" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structcli__extras_1a4e8cdca32127b81f8fcb41047a320844" kindref="member">threads</ref>;</highlight></codeline>
<codeline lineno="988" refid="structcli__extras_1a313d0562dfb63a6350db5c84128fc074" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="structcli__extras_1a313d0562dfb63a6350db5c84128fc074" kindref="member">affinity</ref>;</highlight></codeline>
<codeline lineno="989" refid="structcli__extras_1a648dda8436ede182650f29f0460fa6a3" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="main__infer_8c_1ae715f0cc745f58eebd4be50b187dd41d" kindref="member">cli_pretranspose_t</ref><sp/><ref refid="structcli__extras_1a648dda8436ede182650f29f0460fa6a3" kindref="member">pretx</ref>;</highlight></codeline>
<codeline lineno="990" refid="structcli__extras_1a50cd2ee771a9eee3fd448d2a1c0b5645" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="structcli__extras_1a50cd2ee771a9eee3fd448d2a1c0b5645" kindref="member">device</ref>;</highlight></codeline>
<codeline lineno="991"><highlight class="normal"></highlight></codeline>
<codeline lineno="992" refid="structcli__extras_1a992ba8185b17f227f60e2e570441b63f" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="structcli__extras_1a992ba8185b17f227f60e2e570441b63f" kindref="member">prompts_file</ref>;</highlight></codeline>
<codeline lineno="993" refid="structcli__extras_1a4af612c719a80234b4e753bc559f358c" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structcli__extras_1a4af612c719a80234b4e753bc559f358c" kindref="member">batch</ref>;</highlight></codeline>
<codeline lineno="994" refid="structcli__extras_1a01be4e3c92d754527967d04b729e4ee6" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="structcli__extras_1a01be4e3c92d754527967d04b729e4ee6" kindref="member">prefetch</ref>;</highlight></codeline>
<codeline lineno="995" refid="structcli__extras_1a628bf363ee35fe852bbb6510455647bd" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structcli__extras_1a628bf363ee35fe852bbb6510455647bd" kindref="member">warmup_tokens</ref>;</highlight></codeline>
<codeline lineno="996" refid="structcli__extras_1a4e233e0c7d76b4fb4338d7460a552707" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structcli__extras_1a4e233e0c7d76b4fb4338d7460a552707" kindref="member">aggregate</ref>;</highlight></codeline>
<codeline lineno="997" refid="structcli__extras_1a8c1b8fdbf9dc75a774e8b451608c961b" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structcli__extras_1a8c1b8fdbf9dc75a774e8b451608c961b" kindref="member">rounds</ref>;</highlight></codeline>
<codeline lineno="998"><highlight class="normal"></highlight></codeline>
<codeline lineno="999"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Optional<sp/>expected-token<sp/>verification<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1000" refid="structcli__extras_1a3b9c2202e0ba68aa4b3112779697a28e" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="structcli__extras_1a3b9c2202e0ba68aa4b3112779697a28e" kindref="member">expected_tokens_file</ref>;</highlight></codeline>
<codeline lineno="1001" refid="structcli__extras_1a69d2dd2e3fe09f5ff877aec31e16de34" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structcli__extras_1a69d2dd2e3fe09f5ff877aec31e16de34" kindref="member">report_tokens</ref>;</highlight></codeline>
<codeline lineno="1002" refid="structcli__extras_1a9a0cdb8214e4f1b8cd375e78dc81f064" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/><ref refid="structcli__extras_1a9a0cdb8214e4f1b8cd375e78dc81f064" kindref="member">report_tokens_max</ref>;</highlight></codeline>
<codeline lineno="1003"><highlight class="normal"></highlight></codeline>
<codeline lineno="1004" refid="structcli__extras_1aa52e671b92aa5a9099153b609a0c5792" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="structcli__extras_1aa52e671b92aa5a9099153b609a0c5792" kindref="member">model_dir</ref>;</highlight></codeline>
<codeline lineno="1005" refid="structcli__extras_1a96d26a6a2f436fb0b232d383f321c3e6" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="structcli__extras_1a96d26a6a2f436fb0b232d383f321c3e6" kindref="member">model_json</ref>;</highlight></codeline>
<codeline lineno="1006" refid="structcli__extras_1ae2401ceced12a603aabefd22f57584bd" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="structcli__extras_1ae2401ceced12a603aabefd22f57584bd" kindref="member">model_bin</ref>;</highlight></codeline>
<codeline lineno="1007"><highlight class="normal"></highlight></codeline>
<codeline lineno="1008" refid="structcli__extras_1a061a8ed1f6671ad018d99db180df06c2" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="structcli__extras_1a061a8ed1f6671ad018d99db180df06c2" kindref="member">precision_label</ref>;</highlight></codeline>
<codeline lineno="1009" refid="structcli__extras_1a49d7c958a59c223a1f66d6aedc796e68" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structcli__extras_1a49d7c958a59c223a1f66d6aedc796e68" kindref="member">precision_from_flag</ref>;</highlight></codeline>
<codeline lineno="1010"><highlight class="normal"></highlight></codeline>
<codeline lineno="1011" refid="structcli__extras_1af5f02b3c69e6a0e4882a5427db0ab994" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="structcli__extras_1af5f02b3c69e6a0e4882a5427db0ab994" kindref="member">sparsity</ref>;</highlight></codeline>
<codeline lineno="1012" refid="structcli__extras_1aeac7b5044a46ca251e3414887e1e712e" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structcli__extras_1aeac7b5044a46ca251e3414887e1e712e" kindref="member">sparsity_from_flag</ref>;</highlight></codeline>
<codeline lineno="1013"><highlight class="normal"></highlight></codeline>
<codeline lineno="1014"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Text<sp/>decode<sp/>options<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1015" refid="structcli__extras_1a553c6e455b22c4ff3cd6f00beb166eb7" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structcli__extras_1a553c6e455b22c4ff3cd6f00beb166eb7" kindref="member">print_text</ref>;</highlight></codeline>
<codeline lineno="1016" refid="structcli__extras_1af46939020f3ada099f4c932676dec6b7" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="structcli__extras_1af46939020f3ada099f4c932676dec6b7" kindref="member">tokenizer_path</ref>;</highlight></codeline>
<codeline lineno="1017" refid="structcli__extras_1a3a19163210b87343cff3a796a2ed7c5a" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="structcli__extras_1a3a19163210b87343cff3a796a2ed7c5a" kindref="member">trace_ids_path</ref>;</highlight></codeline>
<codeline lineno="1018"><highlight class="normal"></highlight></codeline>
<codeline lineno="1019"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Deterministic/debug<sp/>convenience<sp/>flags<sp/>(wired<sp/>to<sp/>env<sp/>vars)<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1020" refid="structcli__extras_1a9f8297928fead9608d99d8f612797a86" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structcli__extras_1a9f8297928fead9608d99d8f612797a86" kindref="member">log_tokens</ref>;</highlight></codeline>
<codeline lineno="1021" refid="structcli__extras_1af40082e05bf7e8eabeabec31f850da27" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structcli__extras_1af40082e05bf7e8eabeabec31f850da27" kindref="member">log_every</ref>;</highlight></codeline>
<codeline lineno="1022"><highlight class="normal"></highlight></codeline>
<codeline lineno="1023" refid="structcli__extras_1a4803d565f63afbb9307628d9dd82ed76" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structcli__extras_1a4803d565f63afbb9307628d9dd82ed76" kindref="member">debug_decode</ref>;</highlight></codeline>
<codeline lineno="1024" refid="structcli__extras_1a5bae3dc5d381b3cfbb8e83a259adfd87" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structcli__extras_1a5bae3dc5d381b3cfbb8e83a259adfd87" kindref="member">debug_decode_every</ref>;</highlight></codeline>
<codeline lineno="1025"><highlight class="normal"></highlight></codeline>
<codeline lineno="1026" refid="structcli__extras_1abc6b3f1feda1b61a09d60cd8057de580" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structcli__extras_1abc6b3f1feda1b61a09d60cd8057de580" kindref="member">debug_topk</ref>;</highlight></codeline>
<codeline lineno="1027" refid="structcli__extras_1adf504da6e8c550785c800720a31b9d5c" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structcli__extras_1adf504da6e8c550785c800720a31b9d5c" kindref="member">debug_topk_every</ref>;</highlight></codeline>
<codeline lineno="1028"><highlight class="normal"></highlight></codeline>
<codeline lineno="1029" refid="structcli__extras_1a9254cd2a3a77105eebdf34d7a1157176" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structcli__extras_1a9254cd2a3a77105eebdf34d7a1157176" kindref="member">greedy</ref>;</highlight></codeline>
<codeline lineno="1030"><highlight class="normal"></highlight></codeline>
<codeline lineno="1031" refid="structcli__extras_1afb0601c5b2854fd3375bfb96482cb92f" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structcli__extras_1afb0601c5b2854fd3375bfb96482cb92f" kindref="member">seed_set</ref>;</highlight></codeline>
<codeline lineno="1032" refid="structcli__extras_1a1afc1a4316a4a51394f6e5de9cdeff65" refkind="member"><highlight class="normal"><sp/><sp/>uint64_t<sp/><ref refid="structcli__extras_1a1afc1a4316a4a51394f6e5de9cdeff65" kindref="member">seed</ref>;</highlight></codeline>
<codeline lineno="1033"><highlight class="normal"></highlight></codeline>
<codeline lineno="1034" refid="structcli__extras_1aa3770ad7c181aa251c580ca669993f74" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structcli__extras_1aa3770ad7c181aa251c580ca669993f74" kindref="member">temperature_set</ref>;</highlight></codeline>
<codeline lineno="1035" refid="structcli__extras_1a272fb04cda4afdb3b9b7d83ce4fe2c8b" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/><ref refid="structcli__extras_1a272fb04cda4afdb3b9b7d83ce4fe2c8b" kindref="member">temperature</ref>;</highlight></codeline>
<codeline lineno="1036"><highlight class="normal"></highlight></codeline>
<codeline lineno="1037" refid="structcli__extras_1ae8fc1e6538cc0dcf7113755e23a5af2f" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structcli__extras_1ae8fc1e6538cc0dcf7113755e23a5af2f" kindref="member">top_p_set</ref>;</highlight></codeline>
<codeline lineno="1038" refid="structcli__extras_1a9e2c7ce1dc9e8e4c4d3f110e880ed8c2" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/><ref refid="structcli__extras_1a9e2c7ce1dc9e8e4c4d3f110e880ed8c2" kindref="member">top_p</ref>;</highlight></codeline>
<codeline lineno="1039"><highlight class="normal"></highlight></codeline>
<codeline lineno="1040" refid="structcli__extras_1aa5d005be050ff9fc83025db8ef23076e" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structcli__extras_1aa5d005be050ff9fc83025db8ef23076e" kindref="member">top_k_set</ref>;</highlight></codeline>
<codeline lineno="1041" refid="structcli__extras_1ae32e771fdfaebdff9ef1f9c9d8cc3f8a" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structcli__extras_1ae32e771fdfaebdff9ef1f9c9d8cc3f8a" kindref="member">top_k</ref>;</highlight></codeline>
<codeline lineno="1042" refid="main__infer_8c_1a9973434ae2443cc726369b714df7b2cb" refkind="member"><highlight class="normal">}<sp/><ref refid="main__infer_8c_1a9973434ae2443cc726369b714df7b2cb" kindref="member">cli_extras_t</ref>;</highlight></codeline>
<codeline lineno="1043"><highlight class="normal"></highlight></codeline>
<codeline lineno="1050" refid="main__infer_8c_1ad96d407a911fbb914fa8e4cfbf2faf0f" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1ad96d407a911fbb914fa8e4cfbf2faf0f" kindref="member">usage</ref>(</highlight><highlight class="keywordtype">void</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="1051"><highlight class="normal"><sp/><sp/>fprintf(stderr,</highlight></codeline>
<codeline lineno="1052"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Usage:<sp/>inference-engine<sp/>[--prompt<sp/>TEXT]<sp/>[--max-new<sp/>N]\n&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1053"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[--threads<sp/>N]\n&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1054"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[--precision<sp/>fp32|bf16|fp16|int8w|int4|int4w]\n&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1055"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[--sparsity<sp/>none|block|auto]\n&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1056"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[--affinity<sp/>auto|compact|scatter]\n&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1057"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[--pretranspose<sp/>none|woh|wxh|all]\n&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1058"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[--device<sp/>auto|cpu|cuda|ze]\n&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1059"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[--model-dir<sp/>PATH]\n&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1060"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[--model-json<sp/>PATH]<sp/>[--model-bin<sp/>PATH]\n&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1061"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[--prompts-file<sp/>PATH]<sp/>[--batch<sp/>N]\n&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1062"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[--prefetch<sp/>on|off|auto|N]<sp/>[--warmup<sp/>N]\n&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1063"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[--rounds<sp/>N]<sp/>[--aggregate]\n&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1064"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[--print-text]<sp/>[--tokenizer<sp/>PATH]\n&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1065"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[--trace-ids<sp/>PATH]\n&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1066"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[--seed<sp/>N]<sp/>[--greedy]\n&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1067"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[--temperature<sp/>F]<sp/>[--top-p<sp/>F]<sp/>[--top-k<sp/>N]\n&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1068"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[--log-tokens]<sp/>[--log-every<sp/>N]\n&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1069"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[--debug-decode]<sp/>[--debug-decode-every<sp/>N]\n&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1070"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[--debug-topk<sp/>K]<sp/>[--debug-topk-every<sp/>N]\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1071"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1072"><highlight class="normal"></highlight></codeline>
<codeline lineno="1082" refid="main__infer_8c_1a25c42477bc56f4eb2d2a5c53e4510d70" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a25c42477bc56f4eb2d2a5c53e4510d70" kindref="member">cli_extras_defaults</ref>(<ref refid="structcli__extras" kindref="compound">cli_extras_t</ref><sp/>*e)<sp/>{</highlight></codeline>
<codeline lineno="1083"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1aa45c7376781454d767d2202800c27a3e" kindref="member">prompt</ref><sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="1084"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1a5eb0317aa09b90f400b657245b41e92c" kindref="member">max_new</ref><sp/>=<sp/>8;</highlight></codeline>
<codeline lineno="1085"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1a4e8cdca32127b81f8fcb41047a320844" kindref="member">threads</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1086"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1a313d0562dfb63a6350db5c84128fc074" kindref="member">affinity</ref><sp/>=<sp/></highlight><highlight class="stringliteral">&quot;auto&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1087"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1a648dda8436ede182650f29f0460fa6a3" kindref="member">pretx</ref><sp/>=<sp/><ref refid="main__infer_8c_1ae715f0cc745f58eebd4be50b187dd41da382ceb68dddaaf8b27ac21f144305e74" kindref="member">CLI_PRETX_NONE</ref>;</highlight></codeline>
<codeline lineno="1088"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1a50cd2ee771a9eee3fd448d2a1c0b5645" kindref="member">device</ref><sp/>=<sp/></highlight><highlight class="stringliteral">&quot;auto&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1089"><highlight class="normal"></highlight></codeline>
<codeline lineno="1090"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1a992ba8185b17f227f60e2e570441b63f" kindref="member">prompts_file</ref><sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="1091"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1a4af612c719a80234b4e753bc559f358c" kindref="member">batch</ref><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="1092"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1a01be4e3c92d754527967d04b729e4ee6" kindref="member">prefetch</ref><sp/>=<sp/></highlight><highlight class="stringliteral">&quot;auto&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1093"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1a628bf363ee35fe852bbb6510455647bd" kindref="member">warmup_tokens</ref><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="1094"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1a4e233e0c7d76b4fb4338d7460a552707" kindref="member">aggregate</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1095"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1a8c1b8fdbf9dc75a774e8b451608c961b" kindref="member">rounds</ref><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="1096"><highlight class="normal"></highlight></codeline>
<codeline lineno="1097"><highlight class="normal"></highlight></codeline>
<codeline lineno="1098"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1a3b9c2202e0ba68aa4b3112779697a28e" kindref="member">expected_tokens_file</ref><sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="1099"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1a69d2dd2e3fe09f5ff877aec31e16de34" kindref="member">report_tokens</ref><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="1100"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1a9a0cdb8214e4f1b8cd375e78dc81f064" kindref="member">report_tokens_max</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1101"><highlight class="normal"></highlight></codeline>
<codeline lineno="1102"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1aa52e671b92aa5a9099153b609a0c5792" kindref="member">model_dir</ref><sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="1103"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1a96d26a6a2f436fb0b232d383f321c3e6" kindref="member">model_json</ref><sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="1104"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1ae2401ceced12a603aabefd22f57584bd" kindref="member">model_bin</ref><sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="1105"><highlight class="normal"></highlight></codeline>
<codeline lineno="1106"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1a061a8ed1f6671ad018d99db180df06c2" kindref="member">precision_label</ref><sp/>=<sp/>IE_PREC_FP32;</highlight></codeline>
<codeline lineno="1107"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1a49d7c958a59c223a1f66d6aedc796e68" kindref="member">precision_from_flag</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1108"><highlight class="normal"></highlight></codeline>
<codeline lineno="1109"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1af5f02b3c69e6a0e4882a5427db0ab994" kindref="member">sparsity</ref><sp/>=<sp/></highlight><highlight class="stringliteral">&quot;none&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1110"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1aeac7b5044a46ca251e3414887e1e712e" kindref="member">sparsity_from_flag</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1111"><highlight class="normal"></highlight></codeline>
<codeline lineno="1112"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1a553c6e455b22c4ff3cd6f00beb166eb7" kindref="member">print_text</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1113"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1af46939020f3ada099f4c932676dec6b7" kindref="member">tokenizer_path</ref><sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="1114"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1a3a19163210b87343cff3a796a2ed7c5a" kindref="member">trace_ids_path</ref><sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="1115"><highlight class="normal"></highlight></codeline>
<codeline lineno="1116"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1a9f8297928fead9608d99d8f612797a86" kindref="member">log_tokens</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1117"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1af40082e05bf7e8eabeabec31f850da27" kindref="member">log_every</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1118"><highlight class="normal"></highlight></codeline>
<codeline lineno="1119"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1a4803d565f63afbb9307628d9dd82ed76" kindref="member">debug_decode</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1120"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1a5bae3dc5d381b3cfbb8e83a259adfd87" kindref="member">debug_decode_every</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1121"><highlight class="normal"></highlight></codeline>
<codeline lineno="1122"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1abc6b3f1feda1b61a09d60cd8057de580" kindref="member">debug_topk</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1123"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1adf504da6e8c550785c800720a31b9d5c" kindref="member">debug_topk_every</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1124"><highlight class="normal"></highlight></codeline>
<codeline lineno="1125"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1a9254cd2a3a77105eebdf34d7a1157176" kindref="member">greedy</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1126"><highlight class="normal"></highlight></codeline>
<codeline lineno="1127"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1afb0601c5b2854fd3375bfb96482cb92f" kindref="member">seed_set</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1128"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1a1afc1a4316a4a51394f6e5de9cdeff65" kindref="member">seed</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1129"><highlight class="normal"></highlight></codeline>
<codeline lineno="1130"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1aa3770ad7c181aa251c580ca669993f74" kindref="member">temperature_set</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1131"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1a272fb04cda4afdb3b9b7d83ce4fe2c8b" kindref="member">temperature</ref><sp/>=<sp/>0.0;</highlight></codeline>
<codeline lineno="1132"><highlight class="normal"></highlight></codeline>
<codeline lineno="1133"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1ae8fc1e6538cc0dcf7113755e23a5af2f" kindref="member">top_p_set</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1134"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1a9e2c7ce1dc9e8e4c4d3f110e880ed8c2" kindref="member">top_p</ref><sp/>=<sp/>0.0;</highlight></codeline>
<codeline lineno="1135"><highlight class="normal"></highlight></codeline>
<codeline lineno="1136"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1aa5d005be050ff9fc83025db8ef23076e" kindref="member">top_k_set</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1137"><highlight class="normal"><sp/><sp/>e-&gt;<ref refid="structcli__extras_1ae32e771fdfaebdff9ef1f9c9d8cc3f8a" kindref="member">top_k</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1138"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1139"><highlight class="normal"></highlight></codeline>
<codeline lineno="1152" refid="main__infer_8c_1a42cabe54dce1190125a12e4c0360ce22" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a42cabe54dce1190125a12e4c0360ce22" kindref="member">safe_atoi</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*s)<sp/>{</highlight></codeline>
<codeline lineno="1153"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!s<sp/>||<sp/>!*s)<sp/>{</highlight></codeline>
<codeline lineno="1154"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;error:<sp/>empty<sp/>integer\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1155"><highlight class="normal"><sp/><sp/><sp/><sp/>exit(2);</highlight></codeline>
<codeline lineno="1156"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1157"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*end<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="1158"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>v<sp/>=<sp/>strtol(s,<sp/>&amp;end,<sp/>10);</highlight></codeline>
<codeline lineno="1159"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(end<sp/>==<sp/>s<sp/>||<sp/>*end)<sp/>{</highlight></codeline>
<codeline lineno="1160"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;error:<sp/>invalid<sp/>integer:<sp/>&apos;%s&apos;\n&quot;</highlight><highlight class="normal">,<sp/>s);</highlight></codeline>
<codeline lineno="1161"><highlight class="normal"><sp/><sp/><sp/><sp/>exit(2);</highlight></codeline>
<codeline lineno="1162"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1163"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>v;</highlight></codeline>
<codeline lineno="1164"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1165"><highlight class="normal"></highlight></codeline>
<codeline lineno="1178" refid="main__infer_8c_1a50f7fd00c4c5f36d1ee065443d688251" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>uint64_t<sp/><ref refid="main__infer_8c_1a50f7fd00c4c5f36d1ee065443d688251" kindref="member">safe_atoull</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*s)<sp/>{</highlight></codeline>
<codeline lineno="1179"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!s<sp/>||<sp/>!*s)<sp/>{</highlight></codeline>
<codeline lineno="1180"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;error:<sp/>empty<sp/>integer\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1181"><highlight class="normal"><sp/><sp/><sp/><sp/>exit(2);</highlight></codeline>
<codeline lineno="1182"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1183"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*end<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="1184"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>v<sp/>=<sp/>strtoull(s,<sp/>&amp;end,<sp/>10);</highlight></codeline>
<codeline lineno="1185"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(end<sp/>==<sp/>s<sp/>||<sp/>*end)<sp/>{</highlight></codeline>
<codeline lineno="1186"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;error:<sp/>invalid<sp/>integer:<sp/>&apos;%s&apos;\n&quot;</highlight><highlight class="normal">,<sp/>s);</highlight></codeline>
<codeline lineno="1187"><highlight class="normal"><sp/><sp/><sp/><sp/>exit(2);</highlight></codeline>
<codeline lineno="1188"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1189"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(uint64_t)v;</highlight></codeline>
<codeline lineno="1190"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1191"><highlight class="normal"></highlight></codeline>
<codeline lineno="1204" refid="main__infer_8c_1a040e339c57d801547a44a21545914526" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a040e339c57d801547a44a21545914526" kindref="member">safe_atof</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*s)<sp/>{</highlight></codeline>
<codeline lineno="1205"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!s<sp/>||<sp/>!*s)<sp/>{</highlight></codeline>
<codeline lineno="1206"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;error:<sp/>empty<sp/>float\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1207"><highlight class="normal"><sp/><sp/><sp/><sp/>exit(2);</highlight></codeline>
<codeline lineno="1208"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1209"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*end<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="1210"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>v<sp/>=<sp/>strtod(s,<sp/>&amp;end);</highlight></codeline>
<codeline lineno="1211"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(end<sp/>==<sp/>s<sp/>||<sp/>*end)<sp/>{</highlight></codeline>
<codeline lineno="1212"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;error:<sp/>invalid<sp/>float:<sp/>&apos;%s&apos;\n&quot;</highlight><highlight class="normal">,<sp/>s);</highlight></codeline>
<codeline lineno="1213"><highlight class="normal"><sp/><sp/><sp/><sp/>exit(2);</highlight></codeline>
<codeline lineno="1214"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1215"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>v;</highlight></codeline>
<codeline lineno="1216"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1217"><highlight class="normal"></highlight></codeline>
<codeline lineno="1231" refid="main__infer_8c_1ac50de02cf90e21f66e0681932f39334f" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1ac50de02cf90e21f66e0681932f39334f" kindref="member">apply_cli_debug_env</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structcli__extras" kindref="compound">cli_extras_t</ref><sp/>*opt)<sp/>{</highlight></codeline>
<codeline lineno="1232"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!opt)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1233"><highlight class="normal"></highlight></codeline>
<codeline lineno="1234"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>buf[128];</highlight></codeline>
<codeline lineno="1235"><highlight class="normal"></highlight></codeline>
<codeline lineno="1236"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(opt-&gt;<ref refid="structcli__extras_1a3a19163210b87343cff3a796a2ed7c5a" kindref="member">trace_ids_path</ref><sp/>&amp;&amp;<sp/>*opt-&gt;<ref refid="structcli__extras_1a3a19163210b87343cff3a796a2ed7c5a" kindref="member">trace_ids_path</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1237"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)setenv(</highlight><highlight class="stringliteral">&quot;IE_TRACE_IDS_JSONL&quot;</highlight><highlight class="normal">,<sp/>opt-&gt;<ref refid="structcli__extras_1a3a19163210b87343cff3a796a2ed7c5a" kindref="member">trace_ids_path</ref>,<sp/>1);</highlight></codeline>
<codeline lineno="1238"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1239"><highlight class="normal"></highlight></codeline>
<codeline lineno="1240"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(opt-&gt;<ref refid="structcli__extras_1a9f8297928fead9608d99d8f612797a86" kindref="member">log_tokens</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1241"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)setenv(</highlight><highlight class="stringliteral">&quot;IE_API_LOG_TOKENS&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;1&quot;</highlight><highlight class="normal">,<sp/>1);</highlight></codeline>
<codeline lineno="1242"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1243"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(opt-&gt;<ref refid="structcli__extras_1af40082e05bf7e8eabeabec31f850da27" kindref="member">log_every</ref><sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1244"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)snprintf(buf,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(buf),<sp/></highlight><highlight class="stringliteral">&quot;%d&quot;</highlight><highlight class="normal">,<sp/>opt-&gt;<ref refid="structcli__extras_1af40082e05bf7e8eabeabec31f850da27" kindref="member">log_every</ref>);</highlight></codeline>
<codeline lineno="1245"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)setenv(</highlight><highlight class="stringliteral">&quot;IE_API_LOG_EVERY&quot;</highlight><highlight class="normal">,<sp/>buf,<sp/>1);</highlight></codeline>
<codeline lineno="1246"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1247"><highlight class="normal"></highlight></codeline>
<codeline lineno="1248"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(opt-&gt;<ref refid="structcli__extras_1a4803d565f63afbb9307628d9dd82ed76" kindref="member">debug_decode</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1249"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)setenv(</highlight><highlight class="stringliteral">&quot;IE_API_DEBUG_DECODE&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;1&quot;</highlight><highlight class="normal">,<sp/>1);</highlight></codeline>
<codeline lineno="1250"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1251"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(opt-&gt;<ref refid="structcli__extras_1a5bae3dc5d381b3cfbb8e83a259adfd87" kindref="member">debug_decode_every</ref><sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1252"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)snprintf(buf,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(buf),<sp/></highlight><highlight class="stringliteral">&quot;%d&quot;</highlight><highlight class="normal">,<sp/>opt-&gt;<ref refid="structcli__extras_1a5bae3dc5d381b3cfbb8e83a259adfd87" kindref="member">debug_decode_every</ref>);</highlight></codeline>
<codeline lineno="1253"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)setenv(</highlight><highlight class="stringliteral">&quot;IE_API_DEBUG_DECODE_EVERY&quot;</highlight><highlight class="normal">,<sp/>buf,<sp/>1);</highlight></codeline>
<codeline lineno="1254"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1255"><highlight class="normal"></highlight></codeline>
<codeline lineno="1256"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(opt-&gt;<ref refid="structcli__extras_1abc6b3f1feda1b61a09d60cd8057de580" kindref="member">debug_topk</ref><sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1257"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)snprintf(buf,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(buf),<sp/></highlight><highlight class="stringliteral">&quot;%d&quot;</highlight><highlight class="normal">,<sp/>opt-&gt;<ref refid="structcli__extras_1abc6b3f1feda1b61a09d60cd8057de580" kindref="member">debug_topk</ref>);</highlight></codeline>
<codeline lineno="1258"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)setenv(</highlight><highlight class="stringliteral">&quot;IE_DEBUG_TOPK&quot;</highlight><highlight class="normal">,<sp/>buf,<sp/>1);</highlight></codeline>
<codeline lineno="1259"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1260"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(opt-&gt;<ref refid="structcli__extras_1adf504da6e8c550785c800720a31b9d5c" kindref="member">debug_topk_every</ref><sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1261"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)snprintf(buf,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(buf),<sp/></highlight><highlight class="stringliteral">&quot;%d&quot;</highlight><highlight class="normal">,<sp/>opt-&gt;<ref refid="structcli__extras_1adf504da6e8c550785c800720a31b9d5c" kindref="member">debug_topk_every</ref>);</highlight></codeline>
<codeline lineno="1262"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)setenv(</highlight><highlight class="stringliteral">&quot;IE_DEBUG_TOPK_EVERY&quot;</highlight><highlight class="normal">,<sp/>buf,<sp/>1);</highlight></codeline>
<codeline lineno="1263"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1264"><highlight class="normal"></highlight></codeline>
<codeline lineno="1265"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(opt-&gt;<ref refid="structcli__extras_1afb0601c5b2854fd3375bfb96482cb92f" kindref="member">seed_set</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1266"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)snprintf(buf,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(buf),<sp/></highlight><highlight class="stringliteral">&quot;%&quot;</highlight><highlight class="normal"><sp/>PRIu64,<sp/>(uint64_t)opt-&gt;<ref refid="structcli__extras_1a1afc1a4316a4a51394f6e5de9cdeff65" kindref="member">seed</ref>);</highlight></codeline>
<codeline lineno="1267"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)setenv(</highlight><highlight class="stringliteral">&quot;IE_SEED&quot;</highlight><highlight class="normal">,<sp/>buf,<sp/>1);</highlight></codeline>
<codeline lineno="1268"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1269"><highlight class="normal"></highlight></codeline>
<codeline lineno="1270"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(opt-&gt;<ref refid="structcli__extras_1a9254cd2a3a77105eebdf34d7a1157176" kindref="member">greedy</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1271"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)setenv(</highlight><highlight class="stringliteral">&quot;IE_GREEDY&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;1&quot;</highlight><highlight class="normal">,<sp/>1);</highlight></codeline>
<codeline lineno="1272"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1273"><highlight class="normal"></highlight></codeline>
<codeline lineno="1274"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(opt-&gt;<ref refid="structcli__extras_1aa3770ad7c181aa251c580ca669993f74" kindref="member">temperature_set</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1275"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)snprintf(buf,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(buf),<sp/></highlight><highlight class="stringliteral">&quot;%.17g&quot;</highlight><highlight class="normal">,<sp/>opt-&gt;<ref refid="structcli__extras_1a272fb04cda4afdb3b9b7d83ce4fe2c8b" kindref="member">temperature</ref>);</highlight></codeline>
<codeline lineno="1276"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)setenv(</highlight><highlight class="stringliteral">&quot;IE_TEMPERATURE&quot;</highlight><highlight class="normal">,<sp/>buf,<sp/>1);</highlight></codeline>
<codeline lineno="1277"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1278"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(opt-&gt;<ref refid="structcli__extras_1ae8fc1e6538cc0dcf7113755e23a5af2f" kindref="member">top_p_set</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1279"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)snprintf(buf,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(buf),<sp/></highlight><highlight class="stringliteral">&quot;%.17g&quot;</highlight><highlight class="normal">,<sp/>opt-&gt;<ref refid="structcli__extras_1a9e2c7ce1dc9e8e4c4d3f110e880ed8c2" kindref="member">top_p</ref>);</highlight></codeline>
<codeline lineno="1280"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)setenv(</highlight><highlight class="stringliteral">&quot;IE_TOP_P&quot;</highlight><highlight class="normal">,<sp/>buf,<sp/>1);</highlight></codeline>
<codeline lineno="1281"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1282"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(opt-&gt;<ref refid="structcli__extras_1aa5d005be050ff9fc83025db8ef23076e" kindref="member">top_k_set</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1283"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)snprintf(buf,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(buf),<sp/></highlight><highlight class="stringliteral">&quot;%d&quot;</highlight><highlight class="normal">,<sp/>opt-&gt;<ref refid="structcli__extras_1ae32e771fdfaebdff9ef1f9c9d8cc3f8a" kindref="member">top_k</ref>);</highlight></codeline>
<codeline lineno="1284"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)setenv(</highlight><highlight class="stringliteral">&quot;IE_TOP_K&quot;</highlight><highlight class="normal">,<sp/>buf,<sp/>1);</highlight></codeline>
<codeline lineno="1285"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1286"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1287"><highlight class="normal"></highlight></codeline>
<codeline lineno="1308" refid="main__infer_8c_1a456ba954f3884bcf5f72fc3e779de284" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a456ba954f3884bcf5f72fc3e779de284" kindref="member">parse_flags</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>argc,<sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>**argv,<sp/><ref refid="structcli__extras" kindref="compound">cli_extras_t</ref><sp/>*out)<sp/>{</highlight></codeline>
<codeline lineno="1309"><highlight class="normal"><sp/><sp/><ref refid="main__infer_8c_1a25c42477bc56f4eb2d2a5c53e4510d70" kindref="member">cli_extras_defaults</ref>(out);</highlight></codeline>
<codeline lineno="1310"><highlight class="normal"></highlight></codeline>
<codeline lineno="1311"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>1;<sp/>i<sp/>&lt;<sp/>argc;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="1312"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*a<sp/>=<sp/>argv[i];</highlight></codeline>
<codeline lineno="1313"><highlight class="normal"></highlight></codeline>
<codeline lineno="1314"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;--help&quot;</highlight><highlight class="normal">)<sp/>||<sp/>!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;-h&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1315"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="main__infer_8c_1ad96d407a911fbb914fa8e4cfbf2faf0f" kindref="member">usage</ref>();</highlight></codeline>
<codeline lineno="1316"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="1317"><highlight class="normal"></highlight></codeline>
<codeline lineno="1318"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;--prompt&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1319"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(++i<sp/>&gt;=<sp/>argc)<sp/>{<sp/><ref refid="main__infer_8c_1ad96d407a911fbb914fa8e4cfbf2faf0f" kindref="member">usage</ref>();<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;<sp/>}</highlight></codeline>
<codeline lineno="1320"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out-&gt;prompt<sp/>=<sp/>argv[i];</highlight></codeline>
<codeline lineno="1321"><highlight class="normal"></highlight></codeline>
<codeline lineno="1322"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;--max-new&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1323"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(++i<sp/>&gt;=<sp/>argc)<sp/>{<sp/><ref refid="main__infer_8c_1ad96d407a911fbb914fa8e4cfbf2faf0f" kindref="member">usage</ref>();<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;<sp/>}</highlight></codeline>
<codeline lineno="1324"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>v<sp/>=<sp/><ref refid="main__infer_8c_1a42cabe54dce1190125a12e4c0360ce22" kindref="member">safe_atoi</ref>(argv[i]);</highlight></codeline>
<codeline lineno="1325"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(v<sp/>&lt;<sp/>0)<sp/>{<sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;error:<sp/>--max-new<sp/>&gt;=<sp/>0\n&quot;</highlight><highlight class="normal">);<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;<sp/>}</highlight></codeline>
<codeline lineno="1326"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out-&gt;max_new<sp/>=<sp/>(size_t)v;</highlight></codeline>
<codeline lineno="1327"><highlight class="normal"></highlight></codeline>
<codeline lineno="1328"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;--threads&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1329"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(++i<sp/>&gt;=<sp/>argc)<sp/>{<sp/><ref refid="main__infer_8c_1ad96d407a911fbb914fa8e4cfbf2faf0f" kindref="member">usage</ref>();<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;<sp/>}</highlight></codeline>
<codeline lineno="1330"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out-&gt;threads<sp/>=<sp/>(int)<ref refid="main__infer_8c_1a42cabe54dce1190125a12e4c0360ce22" kindref="member">safe_atoi</ref>(argv[i]);</highlight></codeline>
<codeline lineno="1331"><highlight class="normal"></highlight></codeline>
<codeline lineno="1332"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;--precision&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1333"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(++i<sp/>&gt;=<sp/>argc)<sp/>{<sp/><ref refid="main__infer_8c_1ad96d407a911fbb914fa8e4cfbf2faf0f" kindref="member">usage</ref>();<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;<sp/>}</highlight></codeline>
<codeline lineno="1334"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*m<sp/>=<sp/>argv[i];</highlight></codeline>
<codeline lineno="1335"><highlight class="normal"></highlight></codeline>
<codeline lineno="1336"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1a72ab94aafe7740f1343d317daa89ca15" kindref="member">ascii_ieq</ref>(m,<sp/>IE_PREC_FP32))<sp/>{<sp/>out-&gt;precision_label<sp/>=<sp/>IE_PREC_FP32;<sp/>out-&gt;precision_from_flag<sp/>=<sp/>1;<sp/>}</highlight></codeline>
<codeline lineno="1337"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1a72ab94aafe7740f1343d317daa89ca15" kindref="member">ascii_ieq</ref>(m,<sp/>IE_PREC_BF16))<sp/>{<sp/>out-&gt;precision_label<sp/>=<sp/>IE_PREC_BF16;<sp/>out-&gt;precision_from_flag<sp/>=<sp/>1;<sp/>}</highlight></codeline>
<codeline lineno="1338"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1a72ab94aafe7740f1343d317daa89ca15" kindref="member">ascii_ieq</ref>(m,<sp/>IE_PREC_FP16))<sp/>{<sp/>out-&gt;precision_label<sp/>=<sp/>IE_PREC_FP16;<sp/>out-&gt;precision_from_flag<sp/>=<sp/>1;<sp/>}</highlight></codeline>
<codeline lineno="1339"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1a72ab94aafe7740f1343d317daa89ca15" kindref="member">ascii_ieq</ref>(m,<sp/>IE_PREC_INT8W))<sp/>{<sp/>out-&gt;precision_label<sp/>=<sp/>IE_PREC_INT8W;<sp/>out-&gt;precision_from_flag<sp/>=<sp/>1;<sp/>}</highlight></codeline>
<codeline lineno="1340"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1a72ab94aafe7740f1343d317daa89ca15" kindref="member">ascii_ieq</ref>(m,<sp/>IE_PREC_INT4W))<sp/>{<sp/>out-&gt;precision_label<sp/>=<sp/>IE_PREC_INT4W;<sp/>out-&gt;precision_from_flag<sp/>=<sp/>1;<sp/>}</highlight></codeline>
<codeline lineno="1341"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1a72ab94aafe7740f1343d317daa89ca15" kindref="member">ascii_ieq</ref>(m,<sp/>IE_PREC_INT4))<sp/>{<sp/>out-&gt;precision_label<sp/>=<sp/>IE_PREC_INT4;<sp/>out-&gt;precision_from_flag<sp/>=<sp/>1;<sp/>}</highlight></codeline>
<codeline lineno="1342"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1343"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;error:<sp/>unknown<sp/>precision<sp/>&apos;%s&apos;\n&quot;</highlight><highlight class="normal">,<sp/>m);</highlight></codeline>
<codeline lineno="1344"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="1345"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1346"><highlight class="normal"></highlight></codeline>
<codeline lineno="1347"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;--sparsity&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1348"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(++i<sp/>&gt;=<sp/>argc)<sp/>{<sp/><ref refid="main__infer_8c_1ad96d407a911fbb914fa8e4cfbf2faf0f" kindref="member">usage</ref>();<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;<sp/>}</highlight></codeline>
<codeline lineno="1349"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*m<sp/>=<sp/>argv[i];</highlight></codeline>
<codeline lineno="1350"><highlight class="normal"></highlight></codeline>
<codeline lineno="1351"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1a72ab94aafe7740f1343d317daa89ca15" kindref="member">ascii_ieq</ref>(m,<sp/></highlight><highlight class="stringliteral">&quot;none&quot;</highlight><highlight class="normal">)<sp/>||<sp/><ref refid="main__infer_8c_1a72ab94aafe7740f1343d317daa89ca15" kindref="member">ascii_ieq</ref>(m,<sp/></highlight><highlight class="stringliteral">&quot;dense&quot;</highlight><highlight class="normal">))<sp/>out-&gt;sparsity<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;none&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1a72ab94aafe7740f1343d317daa89ca15" kindref="member">ascii_ieq</ref>(m,<sp/></highlight><highlight class="stringliteral">&quot;block&quot;</highlight><highlight class="normal">)<sp/>||<sp/><ref refid="main__infer_8c_1a72ab94aafe7740f1343d317daa89ca15" kindref="member">ascii_ieq</ref>(m,<sp/></highlight><highlight class="stringliteral">&quot;blocksparse&quot;</highlight><highlight class="normal">))<sp/>out-&gt;sparsity<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;block&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1353"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1a72ab94aafe7740f1343d317daa89ca15" kindref="member">ascii_ieq</ref>(m,<sp/></highlight><highlight class="stringliteral">&quot;auto&quot;</highlight><highlight class="normal">))<sp/>out-&gt;sparsity<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;auto&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1354"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1355"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;error:<sp/>unknown<sp/>sparsity<sp/>&apos;%s&apos;<sp/>(expected<sp/>none|block|auto)\n&quot;</highlight><highlight class="normal">,<sp/>m);</highlight></codeline>
<codeline lineno="1356"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="1357"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1358"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out-&gt;sparsity_from_flag<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="1359"><highlight class="normal"></highlight></codeline>
<codeline lineno="1360"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;--affinity&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1361"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(++i<sp/>&gt;=<sp/>argc)<sp/>{<sp/><ref refid="main__infer_8c_1ad96d407a911fbb914fa8e4cfbf2faf0f" kindref="member">usage</ref>();<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;<sp/>}</highlight></codeline>
<codeline lineno="1362"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out-&gt;affinity<sp/>=<sp/>argv[i];</highlight></codeline>
<codeline lineno="1363"><highlight class="normal"></highlight></codeline>
<codeline lineno="1364"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;--pretranspose&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1365"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(++i<sp/>&gt;=<sp/>argc)<sp/>{<sp/><ref refid="main__infer_8c_1ad96d407a911fbb914fa8e4cfbf2faf0f" kindref="member">usage</ref>();<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;<sp/>}</highlight></codeline>
<codeline lineno="1366"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*p<sp/>=<sp/>argv[i];</highlight></codeline>
<codeline lineno="1367"><highlight class="normal"></highlight></codeline>
<codeline lineno="1368"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(p,<sp/></highlight><highlight class="stringliteral">&quot;none&quot;</highlight><highlight class="normal">))<sp/>out-&gt;pretx<sp/>=<sp/><ref refid="main__infer_8c_1ae715f0cc745f58eebd4be50b187dd41da382ceb68dddaaf8b27ac21f144305e74" kindref="member">CLI_PRETX_NONE</ref>;</highlight></codeline>
<codeline lineno="1369"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(p,<sp/></highlight><highlight class="stringliteral">&quot;woh&quot;</highlight><highlight class="normal">))<sp/>out-&gt;pretx<sp/>=<sp/><ref refid="main__infer_8c_1ae715f0cc745f58eebd4be50b187dd41da9d22d4f265254a65af9fc3a7d648fe5d" kindref="member">CLI_PRETX_WOH</ref>;</highlight></codeline>
<codeline lineno="1370"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(p,<sp/></highlight><highlight class="stringliteral">&quot;wxh&quot;</highlight><highlight class="normal">))<sp/>out-&gt;pretx<sp/>=<sp/><ref refid="main__infer_8c_1ae715f0cc745f58eebd4be50b187dd41da1a251ee24fdcadcaf9c888e0a96140e7" kindref="member">CLI_PRETX_WXH</ref>;</highlight></codeline>
<codeline lineno="1371"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(p,<sp/></highlight><highlight class="stringliteral">&quot;all&quot;</highlight><highlight class="normal">))<sp/>out-&gt;pretx<sp/>=<sp/><ref refid="main__infer_8c_1ae715f0cc745f58eebd4be50b187dd41da4fad867319e4f9197a9c373762a3ad54" kindref="member">CLI_PRETX_ALL</ref>;</highlight></codeline>
<codeline lineno="1372"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1373"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;error:<sp/>unknown<sp/>pretranspose<sp/>&apos;%s&apos;\n&quot;</highlight><highlight class="normal">,<sp/>p);</highlight></codeline>
<codeline lineno="1374"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="1375"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1376"><highlight class="normal"></highlight></codeline>
<codeline lineno="1377"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;--device&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1378"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(++i<sp/>&gt;=<sp/>argc)<sp/>{<sp/><ref refid="main__infer_8c_1ad96d407a911fbb914fa8e4cfbf2faf0f" kindref="member">usage</ref>();<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;<sp/>}</highlight></codeline>
<codeline lineno="1379"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out-&gt;device<sp/>=<sp/>argv[i];</highlight></codeline>
<codeline lineno="1380"><highlight class="normal"></highlight></codeline>
<codeline lineno="1381"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;--model-dir&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1382"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(++i<sp/>&gt;=<sp/>argc)<sp/>{<sp/><ref refid="main__infer_8c_1ad96d407a911fbb914fa8e4cfbf2faf0f" kindref="member">usage</ref>();<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;<sp/>}</highlight></codeline>
<codeline lineno="1383"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out-&gt;model_dir<sp/>=<sp/>argv[i];</highlight></codeline>
<codeline lineno="1384"><highlight class="normal"></highlight></codeline>
<codeline lineno="1385"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;--model-json&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1386"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(++i<sp/>&gt;=<sp/>argc)<sp/>{<sp/><ref refid="main__infer_8c_1ad96d407a911fbb914fa8e4cfbf2faf0f" kindref="member">usage</ref>();<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;<sp/>}</highlight></codeline>
<codeline lineno="1387"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out-&gt;model_json<sp/>=<sp/>argv[i];</highlight></codeline>
<codeline lineno="1388"><highlight class="normal"></highlight></codeline>
<codeline lineno="1389"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;--model-bin&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1390"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(++i<sp/>&gt;=<sp/>argc)<sp/>{<sp/><ref refid="main__infer_8c_1ad96d407a911fbb914fa8e4cfbf2faf0f" kindref="member">usage</ref>();<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;<sp/>}</highlight></codeline>
<codeline lineno="1391"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out-&gt;model_bin<sp/>=<sp/>argv[i];</highlight></codeline>
<codeline lineno="1392"><highlight class="normal"></highlight></codeline>
<codeline lineno="1393"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;--prompts-file&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1394"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(++i<sp/>&gt;=<sp/>argc)<sp/>{<sp/><ref refid="main__infer_8c_1ad96d407a911fbb914fa8e4cfbf2faf0f" kindref="member">usage</ref>();<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;<sp/>}</highlight></codeline>
<codeline lineno="1395"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out-&gt;prompts_file<sp/>=<sp/>argv[i];</highlight></codeline>
<codeline lineno="1396"><highlight class="normal"></highlight></codeline>
<codeline lineno="1397"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;--batch&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1398"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(++i<sp/>&gt;=<sp/>argc)<sp/>{<sp/><ref refid="main__infer_8c_1ad96d407a911fbb914fa8e4cfbf2faf0f" kindref="member">usage</ref>();<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;<sp/>}</highlight></codeline>
<codeline lineno="1399"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out-&gt;batch<sp/>=<sp/>(int)<ref refid="main__infer_8c_1a42cabe54dce1190125a12e4c0360ce22" kindref="member">safe_atoi</ref>(argv[i]);</highlight></codeline>
<codeline lineno="1400"><highlight class="normal"></highlight></codeline>
<codeline lineno="1401"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;--prefetch&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1402"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(++i<sp/>&gt;=<sp/>argc)<sp/>{<sp/><ref refid="main__infer_8c_1ad96d407a911fbb914fa8e4cfbf2faf0f" kindref="member">usage</ref>();<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;<sp/>}</highlight></codeline>
<codeline lineno="1403"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out-&gt;prefetch<sp/>=<sp/>argv[i];</highlight></codeline>
<codeline lineno="1404"><highlight class="normal"></highlight></codeline>
<codeline lineno="1405"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;--warmup&quot;</highlight><highlight class="normal">)<sp/>||<sp/>!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;--warmup-tokens&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1406"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(++i<sp/>&gt;=<sp/>argc)<sp/>{<sp/><ref refid="main__infer_8c_1ad96d407a911fbb914fa8e4cfbf2faf0f" kindref="member">usage</ref>();<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;<sp/>}</highlight></codeline>
<codeline lineno="1407"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>v<sp/>=<sp/><ref refid="main__infer_8c_1a42cabe54dce1190125a12e4c0360ce22" kindref="member">safe_atoi</ref>(argv[i]);</highlight></codeline>
<codeline lineno="1408"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(v<sp/>&lt;<sp/>0)<sp/>v<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1409"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out-&gt;warmup_tokens<sp/>=<sp/>(int)v;</highlight></codeline>
<codeline lineno="1410"><highlight class="normal"></highlight></codeline>
<codeline lineno="1411"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;--rounds&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1412"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(++i<sp/>&gt;=<sp/>argc)<sp/>{<sp/><ref refid="main__infer_8c_1ad96d407a911fbb914fa8e4cfbf2faf0f" kindref="member">usage</ref>();<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;<sp/>}</highlight></codeline>
<codeline lineno="1413"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>v<sp/>=<sp/><ref refid="main__infer_8c_1a42cabe54dce1190125a12e4c0360ce22" kindref="member">safe_atoi</ref>(argv[i]);</highlight></codeline>
<codeline lineno="1414"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(v<sp/>&lt;<sp/>1)<sp/>v<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="1415"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out-&gt;rounds<sp/>=<sp/>(int)v;</highlight></codeline>
<codeline lineno="1416"><highlight class="normal"></highlight></codeline>
<codeline lineno="1417"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;--aggregate&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1418"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out-&gt;aggregate<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="1419"><highlight class="normal"></highlight></codeline>
<codeline lineno="1420"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;--expected-tokens&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1421"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(++i<sp/>&gt;=<sp/>argc)<sp/>{<sp/><ref refid="main__infer_8c_1ad96d407a911fbb914fa8e4cfbf2faf0f" kindref="member">usage</ref>();<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;<sp/>}</highlight></codeline>
<codeline lineno="1422"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out-&gt;expected_tokens_file<sp/>=<sp/>argv[i];</highlight></codeline>
<codeline lineno="1423"><highlight class="normal"></highlight></codeline>
<codeline lineno="1424"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;--no-report-tokens&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1425"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out-&gt;report_tokens<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1426"><highlight class="normal"></highlight></codeline>
<codeline lineno="1427"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;--report-tokens-max&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1428"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(++i<sp/>&gt;=<sp/>argc)<sp/>{<sp/><ref refid="main__infer_8c_1ad96d407a911fbb914fa8e4cfbf2faf0f" kindref="member">usage</ref>();<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;<sp/>}</highlight></codeline>
<codeline lineno="1429"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>v<sp/>=<sp/><ref refid="main__infer_8c_1a42cabe54dce1190125a12e4c0360ce22" kindref="member">safe_atoi</ref>(argv[i]);</highlight></codeline>
<codeline lineno="1430"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(v<sp/>&lt;<sp/>0)<sp/>v<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1431"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out-&gt;report_tokens_max<sp/>=<sp/>(size_t)v;</highlight></codeline>
<codeline lineno="1432"><highlight class="normal"></highlight></codeline>
<codeline lineno="1433"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;--print-text&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1434"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out-&gt;print_text<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="1435"><highlight class="normal"></highlight></codeline>
<codeline lineno="1436"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;--tokenizer&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1437"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(++i<sp/>&gt;=<sp/>argc)<sp/>{<sp/><ref refid="main__infer_8c_1ad96d407a911fbb914fa8e4cfbf2faf0f" kindref="member">usage</ref>();<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;<sp/>}</highlight></codeline>
<codeline lineno="1438"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out-&gt;tokenizer_path<sp/>=<sp/>argv[i];</highlight></codeline>
<codeline lineno="1439"><highlight class="normal"></highlight></codeline>
<codeline lineno="1440"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;--trace-ids&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1441"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(++i<sp/>&gt;=<sp/>argc)<sp/>{<sp/><ref refid="main__infer_8c_1ad96d407a911fbb914fa8e4cfbf2faf0f" kindref="member">usage</ref>();<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;<sp/>}</highlight></codeline>
<codeline lineno="1442"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out-&gt;trace_ids_path<sp/>=<sp/>argv[i];</highlight></codeline>
<codeline lineno="1443"><highlight class="normal"></highlight></codeline>
<codeline lineno="1444"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;--log-tokens&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1445"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out-&gt;log_tokens<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="1446"><highlight class="normal"></highlight></codeline>
<codeline lineno="1447"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;--log-every&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1448"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(++i<sp/>&gt;=<sp/>argc)<sp/>{<sp/><ref refid="main__infer_8c_1ad96d407a911fbb914fa8e4cfbf2faf0f" kindref="member">usage</ref>();<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;<sp/>}</highlight></codeline>
<codeline lineno="1449"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out-&gt;log_every<sp/>=<sp/>(int)<ref refid="main__infer_8c_1a42cabe54dce1190125a12e4c0360ce22" kindref="member">safe_atoi</ref>(argv[i]);</highlight></codeline>
<codeline lineno="1450"><highlight class="normal"></highlight></codeline>
<codeline lineno="1451"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;--debug-decode&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1452"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out-&gt;debug_decode<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="1453"><highlight class="normal"></highlight></codeline>
<codeline lineno="1454"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;--debug-decode-every&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1455"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(++i<sp/>&gt;=<sp/>argc)<sp/>{<sp/><ref refid="main__infer_8c_1ad96d407a911fbb914fa8e4cfbf2faf0f" kindref="member">usage</ref>();<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;<sp/>}</highlight></codeline>
<codeline lineno="1456"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out-&gt;debug_decode_every<sp/>=<sp/>(int)<ref refid="main__infer_8c_1a42cabe54dce1190125a12e4c0360ce22" kindref="member">safe_atoi</ref>(argv[i]);</highlight></codeline>
<codeline lineno="1457"><highlight class="normal"></highlight></codeline>
<codeline lineno="1458"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;--debug-topk&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1459"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(++i<sp/>&gt;=<sp/>argc)<sp/>{<sp/><ref refid="main__infer_8c_1ad96d407a911fbb914fa8e4cfbf2faf0f" kindref="member">usage</ref>();<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;<sp/>}</highlight></codeline>
<codeline lineno="1460"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out-&gt;debug_topk<sp/>=<sp/>(int)<ref refid="main__infer_8c_1a42cabe54dce1190125a12e4c0360ce22" kindref="member">safe_atoi</ref>(argv[i]);</highlight></codeline>
<codeline lineno="1461"><highlight class="normal"></highlight></codeline>
<codeline lineno="1462"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;--debug-topk-every&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1463"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(++i<sp/>&gt;=<sp/>argc)<sp/>{<sp/><ref refid="main__infer_8c_1ad96d407a911fbb914fa8e4cfbf2faf0f" kindref="member">usage</ref>();<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;<sp/>}</highlight></codeline>
<codeline lineno="1464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out-&gt;debug_topk_every<sp/>=<sp/>(int)<ref refid="main__infer_8c_1a42cabe54dce1190125a12e4c0360ce22" kindref="member">safe_atoi</ref>(argv[i]);</highlight></codeline>
<codeline lineno="1465"><highlight class="normal"></highlight></codeline>
<codeline lineno="1466"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;--seed&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1467"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(++i<sp/>&gt;=<sp/>argc)<sp/>{<sp/><ref refid="main__infer_8c_1ad96d407a911fbb914fa8e4cfbf2faf0f" kindref="member">usage</ref>();<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;<sp/>}</highlight></codeline>
<codeline lineno="1468"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out-&gt;seed<sp/>=<sp/><ref refid="main__infer_8c_1a50f7fd00c4c5f36d1ee065443d688251" kindref="member">safe_atoull</ref>(argv[i]);</highlight></codeline>
<codeline lineno="1469"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out-&gt;seed_set<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="1470"><highlight class="normal"></highlight></codeline>
<codeline lineno="1471"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;--greedy&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1472"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out-&gt;greedy<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="1473"><highlight class="normal"></highlight></codeline>
<codeline lineno="1474"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;--temperature&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1475"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(++i<sp/>&gt;=<sp/>argc)<sp/>{<sp/><ref refid="main__infer_8c_1ad96d407a911fbb914fa8e4cfbf2faf0f" kindref="member">usage</ref>();<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;<sp/>}</highlight></codeline>
<codeline lineno="1476"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out-&gt;temperature<sp/>=<sp/><ref refid="main__infer_8c_1a040e339c57d801547a44a21545914526" kindref="member">safe_atof</ref>(argv[i]);</highlight></codeline>
<codeline lineno="1477"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out-&gt;temperature_set<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="1478"><highlight class="normal"></highlight></codeline>
<codeline lineno="1479"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;--top-p&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1480"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(++i<sp/>&gt;=<sp/>argc)<sp/>{<sp/><ref refid="main__infer_8c_1ad96d407a911fbb914fa8e4cfbf2faf0f" kindref="member">usage</ref>();<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;<sp/>}</highlight></codeline>
<codeline lineno="1481"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out-&gt;top_p<sp/>=<sp/><ref refid="main__infer_8c_1a040e339c57d801547a44a21545914526" kindref="member">safe_atof</ref>(argv[i]);</highlight></codeline>
<codeline lineno="1482"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out-&gt;top_p_set<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="1483"><highlight class="normal"></highlight></codeline>
<codeline lineno="1484"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!strcmp(a,<sp/></highlight><highlight class="stringliteral">&quot;--top-k&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1485"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(++i<sp/>&gt;=<sp/>argc)<sp/>{<sp/><ref refid="main__infer_8c_1ad96d407a911fbb914fa8e4cfbf2faf0f" kindref="member">usage</ref>();<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;<sp/>}</highlight></codeline>
<codeline lineno="1486"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out-&gt;top_k<sp/>=<sp/>(int)<ref refid="main__infer_8c_1a42cabe54dce1190125a12e4c0360ce22" kindref="member">safe_atoi</ref>(argv[i]);</highlight></codeline>
<codeline lineno="1487"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>out-&gt;top_k_set<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="1488"><highlight class="normal"></highlight></codeline>
<codeline lineno="1489"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(a[0]<sp/>==<sp/></highlight><highlight class="charliteral">&apos;-&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="1490"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;error:<sp/>unknown<sp/>flag<sp/>&apos;%s&apos;\n&quot;</highlight><highlight class="normal">,<sp/>a);</highlight></codeline>
<codeline lineno="1491"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="main__infer_8c_1ad96d407a911fbb914fa8e4cfbf2faf0f" kindref="member">usage</ref>();</highlight></codeline>
<codeline lineno="1492"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="1493"><highlight class="normal"></highlight></codeline>
<codeline lineno="1494"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1495"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!out-&gt;prompt)<sp/>out-&gt;prompt<sp/>=<sp/>a;</highlight></codeline>
<codeline lineno="1496"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1497"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1498"><highlight class="normal"></highlight></codeline>
<codeline lineno="1499"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="1500"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1501"><highlight class="normal"></highlight></codeline>
<codeline lineno="1502"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>--------------------------------------------------------------------------<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1503"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Prompts<sp/>helpers<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1504"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>--------------------------------------------------------------------------<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1505"><highlight class="normal"></highlight></codeline>
<codeline lineno="1527" refid="main__infer_8c_1a609fc6d778b714530dadf2ef012acf5c" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a609fc6d778b714530dadf2ef012acf5c" kindref="member">read_first_nonempty_line</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*path,<sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*buf,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>bufsz)<sp/>{</highlight></codeline>
<codeline lineno="1528"><highlight class="normal"><sp/><sp/>FILE<sp/>*f<sp/>=<sp/>fopen(path,<sp/></highlight><highlight class="stringliteral">&quot;r&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1529"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!f)<sp/>{</highlight></codeline>
<codeline lineno="1530"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;warn:<sp/>cannot<sp/>open<sp/>prompts<sp/>file<sp/>&apos;%s&apos;:<sp/>%s\n&quot;</highlight><highlight class="normal">,<sp/>path,<sp/>strerror(errno));</highlight></codeline>
<codeline lineno="1531"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="1532"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1533"><highlight class="normal"></highlight></codeline>
<codeline lineno="1534"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ok<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1535"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(fgets(buf,<sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)bufsz,<sp/>f))<sp/>{</highlight></codeline>
<codeline lineno="1536"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>strlen(buf);</highlight></codeline>
<codeline lineno="1537"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(n<sp/>&amp;&amp;<sp/>(buf[n<sp/>-<sp/>1]<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\n&apos;</highlight><highlight class="normal"><sp/>||<sp/>buf[n<sp/>-<sp/>1]<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\r&apos;</highlight><highlight class="normal">))<sp/>buf[--n]<sp/>=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1538"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>==<sp/>0)<sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1539"><highlight class="normal"><sp/><sp/><sp/><sp/>ok<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="1540"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1541"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1542"><highlight class="normal"></highlight></codeline>
<codeline lineno="1543"><highlight class="normal"><sp/><sp/>(void)fclose(f);</highlight></codeline>
<codeline lineno="1544"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ok<sp/>?<sp/>1<sp/>:<sp/>0;</highlight></codeline>
<codeline lineno="1545"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1546"><highlight class="normal"></highlight></codeline>
<codeline lineno="1550" refid="structprompt__list" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structprompt__list" kindref="compound">prompt_list</ref><sp/>{</highlight></codeline>
<codeline lineno="1551" refid="structprompt__list_1ad4b457e3153a399812c91acb3d2f399f" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>**<ref refid="structprompt__list_1ad4b457e3153a399812c91acb3d2f399f" kindref="member">items</ref>;<sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1552" refid="structprompt__list_1ab60c60299e5806652f4c2c7a94aca5c3" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/><ref refid="structprompt__list_1ab60c60299e5806652f4c2c7a94aca5c3" kindref="member">count</ref>;<sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1553" refid="structprompt__list_1a1b38f2bff67306ab0d56dfa5017c2302" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/><ref refid="structprompt__list_1a1b38f2bff67306ab0d56dfa5017c2302" kindref="member">cap</ref>;<sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1554" refid="main__infer_8c_1aa2c236bcd5a489e1a409ffd5f4c532f7" refkind="member"><highlight class="normal">}<sp/><ref refid="main__infer_8c_1aa2c236bcd5a489e1a409ffd5f4c532f7" kindref="member">prompt_list_t</ref>;</highlight></codeline>
<codeline lineno="1555"><highlight class="normal"></highlight></codeline>
<codeline lineno="1565" refid="main__infer_8c_1a9891db61dca3c60715c6b2f7aad7f5a1" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a9891db61dca3c60715c6b2f7aad7f5a1" kindref="member">prompt_list_init</ref>(<ref refid="structprompt__list" kindref="compound">prompt_list_t</ref><sp/>*pl)<sp/>{</highlight></codeline>
<codeline lineno="1566"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!pl)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1567"><highlight class="normal"><sp/><sp/>pl-&gt;<ref refid="structprompt__list_1ad4b457e3153a399812c91acb3d2f399f" kindref="member">items</ref><sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="1568"><highlight class="normal"><sp/><sp/>pl-&gt;<ref refid="structprompt__list_1ab60c60299e5806652f4c2c7a94aca5c3" kindref="member">count</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1569"><highlight class="normal"><sp/><sp/>pl-&gt;<ref refid="structprompt__list_1a1b38f2bff67306ab0d56dfa5017c2302" kindref="member">cap</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1570"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1571"><highlight class="normal"></highlight></codeline>
<codeline lineno="1581" refid="main__infer_8c_1ab06a46b9f23d08de776ec7d3258b6588" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1ab06a46b9f23d08de776ec7d3258b6588" kindref="member">prompt_list_free</ref>(<ref refid="structprompt__list" kindref="compound">prompt_list_t</ref><sp/>*pl)<sp/>{</highlight></codeline>
<codeline lineno="1582"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!pl)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1583"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pl-&gt;<ref refid="structprompt__list_1ad4b457e3153a399812c91acb3d2f399f" kindref="member">items</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1584"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>pl-&gt;<ref refid="structprompt__list_1ab60c60299e5806652f4c2c7a94aca5c3" kindref="member">count</ref>;<sp/>++i)<sp/>free(pl-&gt;<ref refid="structprompt__list_1ad4b457e3153a399812c91acb3d2f399f" kindref="member">items</ref>[i]);</highlight></codeline>
<codeline lineno="1585"><highlight class="normal"><sp/><sp/><sp/><sp/>free(pl-&gt;<ref refid="structprompt__list_1ad4b457e3153a399812c91acb3d2f399f" kindref="member">items</ref>);</highlight></codeline>
<codeline lineno="1586"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1587"><highlight class="normal"><sp/><sp/>pl-&gt;<ref refid="structprompt__list_1ad4b457e3153a399812c91acb3d2f399f" kindref="member">items</ref><sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="1588"><highlight class="normal"><sp/><sp/>pl-&gt;<ref refid="structprompt__list_1ab60c60299e5806652f4c2c7a94aca5c3" kindref="member">count</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1589"><highlight class="normal"><sp/><sp/>pl-&gt;<ref refid="structprompt__list_1a1b38f2bff67306ab0d56dfa5017c2302" kindref="member">cap</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1590"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1591"><highlight class="normal"></highlight></codeline>
<codeline lineno="1606" refid="main__infer_8c_1a9be857b0051297813c2cb218accbb5c8" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a9be857b0051297813c2cb218accbb5c8" kindref="member">prompt_list_push_copy</ref>(<ref refid="structprompt__list" kindref="compound">prompt_list_t</ref><sp/>*pl,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*s)<sp/>{</highlight></codeline>
<codeline lineno="1607"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!pl<sp/>||<sp/>!s)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="1608"><highlight class="normal"></highlight></codeline>
<codeline lineno="1609"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pl-&gt;<ref refid="structprompt__list_1ab60c60299e5806652f4c2c7a94aca5c3" kindref="member">count</ref><sp/>==<sp/>pl-&gt;<ref refid="structprompt__list_1a1b38f2bff67306ab0d56dfa5017c2302" kindref="member">cap</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1610"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>ncap<sp/>=<sp/>(pl-&gt;<ref refid="structprompt__list_1a1b38f2bff67306ab0d56dfa5017c2302" kindref="member">cap</ref><sp/>==<sp/>0)<sp/>?<sp/>16<sp/>:<sp/>(pl-&gt;<ref refid="structprompt__list_1a1b38f2bff67306ab0d56dfa5017c2302" kindref="member">cap</ref><sp/>*<sp/>2);</highlight></codeline>
<codeline lineno="1611"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>**nitems<sp/>=<sp/>(</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>**)realloc(pl-&gt;<ref refid="structprompt__list_1ad4b457e3153a399812c91acb3d2f399f" kindref="member">items</ref>,<sp/>ncap<sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*));</highlight></codeline>
<codeline lineno="1612"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!nitems)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>2;</highlight></codeline>
<codeline lineno="1613"><highlight class="normal"><sp/><sp/><sp/><sp/>pl-&gt;<ref refid="structprompt__list_1ad4b457e3153a399812c91acb3d2f399f" kindref="member">items</ref><sp/>=<sp/>nitems;</highlight></codeline>
<codeline lineno="1614"><highlight class="normal"><sp/><sp/><sp/><sp/>pl-&gt;<ref refid="structprompt__list_1a1b38f2bff67306ab0d56dfa5017c2302" kindref="member">cap</ref><sp/>=<sp/>ncap;</highlight></codeline>
<codeline lineno="1615"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1616"><highlight class="normal"></highlight></codeline>
<codeline lineno="1617"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*cp<sp/>=<sp/><ref refid="main__infer_8c_1a39103ce72021a890c3e333b949068a1c" kindref="member">heap_strdup</ref>(s);</highlight></codeline>
<codeline lineno="1618"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!cp)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>3;</highlight></codeline>
<codeline lineno="1619"><highlight class="normal"></highlight></codeline>
<codeline lineno="1620"><highlight class="normal"><sp/><sp/>pl-&gt;<ref refid="structprompt__list_1ad4b457e3153a399812c91acb3d2f399f" kindref="member">items</ref>[pl-&gt;<ref refid="structprompt__list_1ab60c60299e5806652f4c2c7a94aca5c3" kindref="member">count</ref>++]<sp/>=<sp/>cp;</highlight></codeline>
<codeline lineno="1621"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="1622"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1623"><highlight class="normal"></highlight></codeline>
<codeline lineno="1641" refid="main__infer_8c_1a3d826199fc8a9ddb8a49f324c2ff1dc5" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a3d826199fc8a9ddb8a49f324c2ff1dc5" kindref="member">prompt_list_read_file</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*path,<sp/><ref refid="structprompt__list" kindref="compound">prompt_list_t</ref><sp/>*out)<sp/>{</highlight></codeline>
<codeline lineno="1642"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!path<sp/>||<sp/>!*path<sp/>||<sp/>!out)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="1643"><highlight class="normal"></highlight></codeline>
<codeline lineno="1644"><highlight class="normal"><sp/><sp/>FILE<sp/>*f<sp/>=<sp/>fopen(path,<sp/></highlight><highlight class="stringliteral">&quot;r&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1645"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!f)<sp/>{</highlight></codeline>
<codeline lineno="1646"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;warn:<sp/>cannot<sp/>open<sp/>prompts<sp/>file<sp/>&apos;%s&apos;:<sp/>%s\n&quot;</highlight><highlight class="normal">,<sp/>path,<sp/>strerror(errno));</highlight></codeline>
<codeline lineno="1647"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>2;</highlight></codeline>
<codeline lineno="1648"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1649"><highlight class="normal"></highlight></codeline>
<codeline lineno="1650"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>line[8192];</highlight></codeline>
<codeline lineno="1651"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>rc<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1652"><highlight class="normal"></highlight></codeline>
<codeline lineno="1653"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(fgets(line,<sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(line),<sp/>f))<sp/>{</highlight></codeline>
<codeline lineno="1654"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>strlen(line);</highlight></codeline>
<codeline lineno="1655"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(n<sp/>&amp;&amp;<sp/>(line[n<sp/>-<sp/>1]<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\n&apos;</highlight><highlight class="normal"><sp/>||<sp/>line[n<sp/>-<sp/>1]<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\r&apos;</highlight><highlight class="normal">))<sp/>line[--n]<sp/>=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1656"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>==<sp/>0)<sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1657"><highlight class="normal"></highlight></codeline>
<codeline lineno="1658"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1a9be857b0051297813c2cb218accbb5c8" kindref="member">prompt_list_push_copy</ref>(out,<sp/>line)<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1659"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>rc<sp/>=<sp/>3;</highlight></codeline>
<codeline lineno="1660"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1661"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1662"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1663"><highlight class="normal"></highlight></codeline>
<codeline lineno="1664"><highlight class="normal"><sp/><sp/>(void)fclose(f);</highlight></codeline>
<codeline lineno="1665"><highlight class="normal"></highlight></codeline>
<codeline lineno="1666"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Empty<sp/>file<sp/>is<sp/>not<sp/>an<sp/>error;<sp/>caller<sp/>can<sp/>decide<sp/>how<sp/>to<sp/>handle<sp/>it.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1667"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>rc;</highlight></codeline>
<codeline lineno="1668"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1669"><highlight class="normal"></highlight></codeline>
<codeline lineno="1670"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>--------------------------------------------------------------------------<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1671"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Expected<sp/>tokens<sp/>(golden<sp/>output)<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1672"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>--------------------------------------------------------------------------<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1673"><highlight class="normal"></highlight></codeline>
<codeline lineno="1690" refid="main__infer_8c_1ad7f42b712b3e86af5d9f8c9942bc8875" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>uint64_t<sp/><ref refid="main__infer_8c_1ad7f42b712b3e86af5d9f8c9942bc8875" kindref="member">prompt_id_fnv1a64</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*s)<sp/>{</highlight></codeline>
<codeline lineno="1691"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint64_t<sp/>FNV_OFF<sp/>=<sp/>1469598103934665603ULL;</highlight></codeline>
<codeline lineno="1692"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint64_t<sp/>FNV_PRIME<sp/>=<sp/>1099511628211ULL;</highlight></codeline>
<codeline lineno="1693"><highlight class="normal"></highlight></codeline>
<codeline lineno="1694"><highlight class="normal"><sp/><sp/>uint64_t<sp/>h<sp/>=<sp/>FNV_OFF;</highlight></codeline>
<codeline lineno="1695"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!s)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>h;</highlight></codeline>
<codeline lineno="1696"><highlight class="normal"></highlight></codeline>
<codeline lineno="1697"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*p<sp/>=<sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*)s;</highlight></codeline>
<codeline lineno="1698"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(*p)<sp/>{</highlight></codeline>
<codeline lineno="1699"><highlight class="normal"><sp/><sp/><sp/><sp/>h<sp/>^=<sp/>(uint64_t)(*p++);</highlight></codeline>
<codeline lineno="1700"><highlight class="normal"><sp/><sp/><sp/><sp/>h<sp/>*=<sp/>FNV_PRIME;</highlight></codeline>
<codeline lineno="1701"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1702"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>h;</highlight></codeline>
<codeline lineno="1703"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1704"><highlight class="normal"></highlight></codeline>
<codeline lineno="1719" refid="main__infer_8c_1a2749355bb9d419963e15e9a58395f63e" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a2749355bb9d419963e15e9a58395f63e" kindref="member">parse_u64_auto</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*s,<sp/>uint64_t<sp/>*out)<sp/>{</highlight></codeline>
<codeline lineno="1720"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!s<sp/>||<sp/>!*s<sp/>||<sp/>!out)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="1721"><highlight class="normal"></highlight></codeline>
<codeline lineno="1722"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>base<sp/>=<sp/>10;</highlight></codeline>
<codeline lineno="1723"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(s[0]<sp/>==<sp/></highlight><highlight class="charliteral">&apos;0&apos;</highlight><highlight class="normal"><sp/>&amp;&amp;<sp/>(s[1]<sp/>==<sp/></highlight><highlight class="charliteral">&apos;x&apos;</highlight><highlight class="normal"><sp/>||<sp/>s[1]<sp/>==<sp/></highlight><highlight class="charliteral">&apos;X&apos;</highlight><highlight class="normal">))<sp/>base<sp/>=<sp/>16;</highlight></codeline>
<codeline lineno="1724"><highlight class="normal"></highlight></codeline>
<codeline lineno="1725"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*end<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="1726"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>v<sp/>=<sp/>strtoull(s,<sp/>&amp;end,<sp/>base);</highlight></codeline>
<codeline lineno="1727"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(end<sp/>==<sp/>s)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>2;</highlight></codeline>
<codeline lineno="1728"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(end<sp/>&amp;&amp;<sp/>(*end<sp/>==<sp/></highlight><highlight class="charliteral">&apos;<sp/>&apos;</highlight><highlight class="normal"><sp/>||<sp/>*end<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\t&apos;</highlight><highlight class="normal"><sp/>||<sp/>*end<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\r&apos;</highlight><highlight class="normal"><sp/>||<sp/>*end<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\n&apos;</highlight><highlight class="normal">))<sp/>++end;</highlight></codeline>
<codeline lineno="1729"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(end<sp/>&amp;&amp;<sp/>*end)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>3;</highlight></codeline>
<codeline lineno="1730"><highlight class="normal"></highlight></codeline>
<codeline lineno="1731"><highlight class="normal"><sp/><sp/>*out<sp/>=<sp/>(uint64_t)v;</highlight></codeline>
<codeline lineno="1732"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="1733"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1734"><highlight class="normal"></highlight></codeline>
<codeline lineno="1740" refid="structexpected__tokens__entry" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structexpected__tokens__entry" kindref="compound">expected_tokens_entry</ref><sp/>{</highlight></codeline>
<codeline lineno="1741" refid="structexpected__tokens__entry_1a916080ab2649c9f4d225ed57d4ee32f5" refkind="member"><highlight class="normal"><sp/><sp/>uint64_t<sp/><ref refid="structexpected__tokens__entry_1a916080ab2649c9f4d225ed57d4ee32f5" kindref="member">prompt_id</ref>;<sp/><sp/></highlight></codeline>
<codeline lineno="1742" refid="structexpected__tokens__entry_1a959f62b26acb1af16f22d85b55b0df78" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*<ref refid="structexpected__tokens__entry_1a959f62b26acb1af16f22d85b55b0df78" kindref="member">tokens</ref>;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1743" refid="structexpected__tokens__entry_1adbef90e357d95fb8c8658ef20993593f" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/><ref refid="structexpected__tokens__entry_1adbef90e357d95fb8c8658ef20993593f" kindref="member">n_tokens</ref>;<sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1744" refid="main__infer_8c_1ae3d72519a21dd8c22c60d86104a0c151" refkind="member"><highlight class="normal">}<sp/><ref refid="main__infer_8c_1ae3d72519a21dd8c22c60d86104a0c151" kindref="member">expected_tokens_entry_t</ref>;</highlight></codeline>
<codeline lineno="1745"><highlight class="normal"></highlight></codeline>
<codeline lineno="1749" refid="structexpected__tokens__table" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structexpected__tokens__table" kindref="compound">expected_tokens_table</ref><sp/>{</highlight></codeline>
<codeline lineno="1750" refid="structexpected__tokens__table_1a276e1939826f5ce628faaef8db9e126c" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="structexpected__tokens__entry" kindref="compound">expected_tokens_entry_t</ref><sp/>*<ref refid="structexpected__tokens__table_1a276e1939826f5ce628faaef8db9e126c" kindref="member">entries</ref>;<sp/></highlight></codeline>
<codeline lineno="1751" refid="structexpected__tokens__table_1a4a94ac05263628a477831280444a57a4" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/><ref refid="structexpected__tokens__table_1a4a94ac05263628a477831280444a57a4" kindref="member">count</ref>;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1752" refid="structexpected__tokens__table_1a5193e78a49adc7c59b61f0350048e886" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/><ref refid="structexpected__tokens__table_1a5193e78a49adc7c59b61f0350048e886" kindref="member">cap</ref>;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1753" refid="main__infer_8c_1ac519a155900b9eda4cab9d3a9a74dd62" refkind="member"><highlight class="normal">}<sp/><ref refid="main__infer_8c_1ac519a155900b9eda4cab9d3a9a74dd62" kindref="member">expected_tokens_table_t</ref>;</highlight></codeline>
<codeline lineno="1754"><highlight class="normal"></highlight></codeline>
<codeline lineno="1764" refid="main__infer_8c_1a7170af3ba79ee074b29ac13736ec97bf" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a7170af3ba79ee074b29ac13736ec97bf" kindref="member">expected_tokens_table_init</ref>(<ref refid="structexpected__tokens__table" kindref="compound">expected_tokens_table_t</ref><sp/>*t)<sp/>{</highlight></codeline>
<codeline lineno="1765"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!t)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1766"><highlight class="normal"><sp/><sp/>t-&gt;<ref refid="structexpected__tokens__table_1a276e1939826f5ce628faaef8db9e126c" kindref="member">entries</ref><sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="1767"><highlight class="normal"><sp/><sp/>t-&gt;<ref refid="structexpected__tokens__table_1a4a94ac05263628a477831280444a57a4" kindref="member">count</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1768"><highlight class="normal"><sp/><sp/>t-&gt;<ref refid="structexpected__tokens__table_1a5193e78a49adc7c59b61f0350048e886" kindref="member">cap</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1769"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1770"><highlight class="normal"></highlight></codeline>
<codeline lineno="1780" refid="main__infer_8c_1a470ca5b37dd720b5de391932c452af36" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a470ca5b37dd720b5de391932c452af36" kindref="member">expected_tokens_table_free</ref>(<ref refid="structexpected__tokens__table" kindref="compound">expected_tokens_table_t</ref><sp/>*t)<sp/>{</highlight></codeline>
<codeline lineno="1781"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!t)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1782"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(t-&gt;<ref refid="structexpected__tokens__table_1a276e1939826f5ce628faaef8db9e126c" kindref="member">entries</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1783"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>t-&gt;<ref refid="structexpected__tokens__table_1a4a94ac05263628a477831280444a57a4" kindref="member">count</ref>;<sp/>++i)<sp/>free(t-&gt;<ref refid="structexpected__tokens__table_1a276e1939826f5ce628faaef8db9e126c" kindref="member">entries</ref>[i].<ref refid="structexpected__tokens__entry_1a959f62b26acb1af16f22d85b55b0df78" kindref="member">tokens</ref>);</highlight></codeline>
<codeline lineno="1784"><highlight class="normal"><sp/><sp/><sp/><sp/>free(t-&gt;<ref refid="structexpected__tokens__table_1a276e1939826f5ce628faaef8db9e126c" kindref="member">entries</ref>);</highlight></codeline>
<codeline lineno="1785"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1786"><highlight class="normal"><sp/><sp/>t-&gt;<ref refid="structexpected__tokens__table_1a276e1939826f5ce628faaef8db9e126c" kindref="member">entries</ref><sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="1787"><highlight class="normal"><sp/><sp/>t-&gt;<ref refid="structexpected__tokens__table_1a4a94ac05263628a477831280444a57a4" kindref="member">count</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1788"><highlight class="normal"><sp/><sp/>t-&gt;<ref refid="structexpected__tokens__table_1a5193e78a49adc7c59b61f0350048e886" kindref="member">cap</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1789"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1790"><highlight class="normal"></highlight></codeline>
<codeline lineno="1799" refid="main__infer_8c_1adc35a14cb1b2caeca261416dfa41edee" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1adc35a14cb1b2caeca261416dfa41edee" kindref="member">expected_tokens_table_push</ref>(<ref refid="structexpected__tokens__table" kindref="compound">expected_tokens_table_t</ref><sp/>*t,</highlight></codeline>
<codeline lineno="1800"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint64_t<sp/>prompt_id,</highlight></codeline>
<codeline lineno="1801"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*tokens,</highlight></codeline>
<codeline lineno="1802"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n_tokens)<sp/>{</highlight></codeline>
<codeline lineno="1803"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!t<sp/>||<sp/>!tokens<sp/>||<sp/>n_tokens<sp/>==<sp/>0)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="1804"><highlight class="normal"></highlight></codeline>
<codeline lineno="1805"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(t-&gt;<ref refid="structexpected__tokens__table_1a4a94ac05263628a477831280444a57a4" kindref="member">count</ref><sp/>==<sp/>t-&gt;<ref refid="structexpected__tokens__table_1a5193e78a49adc7c59b61f0350048e886" kindref="member">cap</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1806"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>ncap<sp/>=<sp/>(t-&gt;<ref refid="structexpected__tokens__table_1a5193e78a49adc7c59b61f0350048e886" kindref="member">cap</ref><sp/>==<sp/>0)<sp/>?<sp/>16<sp/>:<sp/>(t-&gt;<ref refid="structexpected__tokens__table_1a5193e78a49adc7c59b61f0350048e886" kindref="member">cap</ref><sp/>*<sp/>2);</highlight></codeline>
<codeline lineno="1807"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structexpected__tokens__entry" kindref="compound">expected_tokens_entry_t</ref><sp/>*ne<sp/>=<sp/>(<ref refid="structexpected__tokens__entry" kindref="compound">expected_tokens_entry_t</ref><sp/>*)realloc(t-&gt;<ref refid="structexpected__tokens__table_1a276e1939826f5ce628faaef8db9e126c" kindref="member">entries</ref>,<sp/>ncap<sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(*ne));</highlight></codeline>
<codeline lineno="1808"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!ne)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>2;</highlight></codeline>
<codeline lineno="1809"><highlight class="normal"><sp/><sp/><sp/><sp/>t-&gt;<ref refid="structexpected__tokens__table_1a276e1939826f5ce628faaef8db9e126c" kindref="member">entries</ref><sp/>=<sp/>ne;</highlight></codeline>
<codeline lineno="1810"><highlight class="normal"><sp/><sp/><sp/><sp/>t-&gt;<ref refid="structexpected__tokens__table_1a5193e78a49adc7c59b61f0350048e886" kindref="member">cap</ref><sp/>=<sp/>ncap;</highlight></codeline>
<codeline lineno="1811"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1812"><highlight class="normal"></highlight></codeline>
<codeline lineno="1813"><highlight class="normal"><sp/><sp/>t-&gt;<ref refid="structexpected__tokens__table_1a276e1939826f5ce628faaef8db9e126c" kindref="member">entries</ref>[t-&gt;<ref refid="structexpected__tokens__table_1a4a94ac05263628a477831280444a57a4" kindref="member">count</ref>].<ref refid="structexpected__tokens__entry_1a916080ab2649c9f4d225ed57d4ee32f5" kindref="member">prompt_id</ref><sp/>=<sp/>prompt_id;</highlight></codeline>
<codeline lineno="1814"><highlight class="normal"><sp/><sp/>t-&gt;<ref refid="structexpected__tokens__table_1a276e1939826f5ce628faaef8db9e126c" kindref="member">entries</ref>[t-&gt;<ref refid="structexpected__tokens__table_1a4a94ac05263628a477831280444a57a4" kindref="member">count</ref>].<ref refid="structexpected__tokens__entry_1a959f62b26acb1af16f22d85b55b0df78" kindref="member">tokens</ref><sp/>=<sp/>tokens;</highlight></codeline>
<codeline lineno="1815"><highlight class="normal"><sp/><sp/>t-&gt;<ref refid="structexpected__tokens__table_1a276e1939826f5ce628faaef8db9e126c" kindref="member">entries</ref>[t-&gt;<ref refid="structexpected__tokens__table_1a4a94ac05263628a477831280444a57a4" kindref="member">count</ref>].<ref refid="structexpected__tokens__entry_1adbef90e357d95fb8c8658ef20993593f" kindref="member">n_tokens</ref><sp/>=<sp/>n_tokens;</highlight></codeline>
<codeline lineno="1816"><highlight class="normal"><sp/><sp/>t-&gt;<ref refid="structexpected__tokens__table_1a4a94ac05263628a477831280444a57a4" kindref="member">count</ref>++;</highlight></codeline>
<codeline lineno="1817"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="1818"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1819"><highlight class="normal"></highlight></codeline>
<codeline lineno="1832" refid="main__infer_8c_1a3a307125ca4048deb177277c8e72bbfe" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a3a307125ca4048deb177277c8e72bbfe" kindref="member">expected_tokens_compare</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*expected,</highlight></codeline>
<codeline lineno="1833"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n_expected,</highlight></codeline>
<codeline lineno="1834"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*actual,</highlight></codeline>
<codeline lineno="1835"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n_actual,</highlight></codeline>
<codeline lineno="1836"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>*mismatch_index,</highlight></codeline>
<codeline lineno="1837"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*expected_at,</highlight></codeline>
<codeline lineno="1838"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*actual_at)<sp/>{</highlight></codeline>
<codeline lineno="1839"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!expected<sp/>||<sp/>!actual)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="1840"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>(n_expected<sp/>&lt;<sp/>n_actual)<sp/>?<sp/>n_expected<sp/>:<sp/>n_actual;</highlight></codeline>
<codeline lineno="1841"><highlight class="normal"></highlight></codeline>
<codeline lineno="1842"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>n;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="1843"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(expected[i]<sp/>!=<sp/>actual[i])<sp/>{</highlight></codeline>
<codeline lineno="1844"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(mismatch_index)<sp/>*mismatch_index<sp/>=<sp/>i;</highlight></codeline>
<codeline lineno="1845"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(expected_at)<sp/>*expected_at<sp/>=<sp/>expected[i];</highlight></codeline>
<codeline lineno="1846"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(actual_at)<sp/>*actual_at<sp/>=<sp/>actual[i];</highlight></codeline>
<codeline lineno="1847"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>2;</highlight></codeline>
<codeline lineno="1848"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1849"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1850"><highlight class="normal"></highlight></codeline>
<codeline lineno="1851"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n_expected<sp/>!=<sp/>n_actual)<sp/>{</highlight></codeline>
<codeline lineno="1852"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(mismatch_index)<sp/>*mismatch_index<sp/>=<sp/>n;</highlight></codeline>
<codeline lineno="1853"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(expected_at)<sp/>*expected_at<sp/>=<sp/>(n<sp/>&lt;<sp/>n_expected)<sp/>?<sp/>expected[n]<sp/>:<sp/>0;</highlight></codeline>
<codeline lineno="1854"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(actual_at)<sp/>*actual_at<sp/>=<sp/>(n<sp/>&lt;<sp/>n_actual)<sp/>?<sp/>actual[n]<sp/>:<sp/>0;</highlight></codeline>
<codeline lineno="1855"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>3;</highlight></codeline>
<codeline lineno="1856"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1857"><highlight class="normal"></highlight></codeline>
<codeline lineno="1858"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="1859"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1860"><highlight class="normal"></highlight></codeline>
<codeline lineno="1877" refid="main__infer_8c_1adaa53124eb0654f14346cf02af06b891" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1adaa53124eb0654f14346cf02af06b891" kindref="member">parse_token_list_inplace</ref>(</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*s,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>**out_tokens,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>*out_n)<sp/>{</highlight></codeline>
<codeline lineno="1878"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!s<sp/>||<sp/>!out_tokens<sp/>||<sp/>!out_n)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="1879"><highlight class="normal"><sp/><sp/>*out_tokens<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="1880"><highlight class="normal"><sp/><sp/>*out_n<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1881"><highlight class="normal"></highlight></codeline>
<codeline lineno="1882"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>cap<sp/>=<sp/>64;</highlight></codeline>
<codeline lineno="1883"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1884"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*tok<sp/>=<sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*)malloc(cap<sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="1885"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!tok)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>2;</highlight></codeline>
<codeline lineno="1886"><highlight class="normal"></highlight></codeline>
<codeline lineno="1887"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*p<sp/>=<sp/>s;</highlight></codeline>
<codeline lineno="1888"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(*p)<sp/>{</highlight></codeline>
<codeline lineno="1889"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;<sp/>&apos;</highlight><highlight class="normal"><sp/>||<sp/>*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\t&apos;</highlight><highlight class="normal">)<sp/>++p;</highlight></codeline>
<codeline lineno="1890"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!*p)<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1891"><highlight class="normal"></highlight></codeline>
<codeline lineno="1892"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*end<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="1893"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>v<sp/>=<sp/>strtol(p,<sp/>&amp;end,<sp/>10);</highlight></codeline>
<codeline lineno="1894"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(end<sp/>==<sp/>p)<sp/>{<sp/>free(tok);<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>3;<sp/>}</highlight></codeline>
<codeline lineno="1895"><highlight class="normal"></highlight></codeline>
<codeline lineno="1896"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>==<sp/>cap)<sp/>{</highlight></codeline>
<codeline lineno="1897"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>ncap<sp/>=<sp/>cap<sp/>*<sp/>2;</highlight></codeline>
<codeline lineno="1898"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*nt<sp/>=<sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*)realloc(tok,<sp/>ncap<sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="1899"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!nt)<sp/>{<sp/>free(tok);<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>4;<sp/>}</highlight></codeline>
<codeline lineno="1900"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>tok<sp/>=<sp/>nt;</highlight></codeline>
<codeline lineno="1901"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>cap<sp/>=<sp/>ncap;</highlight></codeline>
<codeline lineno="1902"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1903"><highlight class="normal"><sp/><sp/><sp/><sp/>tok[n++]<sp/>=<sp/>(int)v;</highlight></codeline>
<codeline lineno="1904"><highlight class="normal"></highlight></codeline>
<codeline lineno="1905"><highlight class="normal"><sp/><sp/><sp/><sp/>p<sp/>=<sp/>end;</highlight></codeline>
<codeline lineno="1906"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;<sp/>&apos;</highlight><highlight class="normal"><sp/>||<sp/>*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\t&apos;</highlight><highlight class="normal">)<sp/>++p;</highlight></codeline>
<codeline lineno="1907"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;,&apos;</highlight><highlight class="normal">)<sp/>{<sp/>++p;<sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;<sp/>}</highlight></codeline>
<codeline lineno="1908"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal"><sp/>||<sp/>*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\r&apos;</highlight><highlight class="normal"><sp/>||<sp/>*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\n&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1909"><highlight class="normal"></highlight></codeline>
<codeline lineno="1910"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Unexpected<sp/>separator.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1911"><highlight class="normal"><sp/><sp/><sp/><sp/>free(tok);</highlight></codeline>
<codeline lineno="1912"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>5;</highlight></codeline>
<codeline lineno="1913"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1914"><highlight class="normal"></highlight></codeline>
<codeline lineno="1915"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>==<sp/>0)<sp/>{<sp/>free(tok);<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>6;<sp/>}</highlight></codeline>
<codeline lineno="1916"><highlight class="normal"><sp/><sp/>*out_tokens<sp/>=<sp/>tok;</highlight></codeline>
<codeline lineno="1917"><highlight class="normal"><sp/><sp/>*out_n<sp/>=<sp/>n;</highlight></codeline>
<codeline lineno="1918"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="1919"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1920"><highlight class="normal"></highlight></codeline>
<codeline lineno="1944" refid="main__infer_8c_1a84acee847ca644179eff86e6406bf230" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a84acee847ca644179eff86e6406bf230" kindref="member">expected_tokens_table_load</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*path,<sp/><ref refid="structexpected__tokens__table" kindref="compound">expected_tokens_table_t</ref><sp/>*out)<sp/>{</highlight></codeline>
<codeline lineno="1945"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!path<sp/>||<sp/>!*path<sp/>||<sp/>!out)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="1946"><highlight class="normal"></highlight></codeline>
<codeline lineno="1947"><highlight class="normal"><sp/><sp/><ref refid="main__infer_8c_1a7170af3ba79ee074b29ac13736ec97bf" kindref="member">expected_tokens_table_init</ref>(out);</highlight></codeline>
<codeline lineno="1948"><highlight class="normal"></highlight></codeline>
<codeline lineno="1949"><highlight class="normal"><sp/><sp/>FILE<sp/>*f<sp/>=<sp/>fopen(path,<sp/></highlight><highlight class="stringliteral">&quot;r&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1950"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!f)<sp/>{</highlight></codeline>
<codeline lineno="1951"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;warn:<sp/>cannot<sp/>open<sp/>expected<sp/>tokens<sp/>file<sp/>&apos;%s&apos;:<sp/>%s\n&quot;</highlight><highlight class="normal">,<sp/>path,<sp/>strerror(errno));</highlight></codeline>
<codeline lineno="1952"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>2;</highlight></codeline>
<codeline lineno="1953"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1954"><highlight class="normal"></highlight></codeline>
<codeline lineno="1955"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>line[65536];</highlight></codeline>
<codeline lineno="1956"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>rc<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1957"><highlight class="normal"></highlight></codeline>
<codeline lineno="1958"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(fgets(line,<sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(line),<sp/>f))<sp/>{</highlight></codeline>
<codeline lineno="1959"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*p<sp/>=<sp/>line;</highlight></codeline>
<codeline lineno="1960"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;<sp/>&apos;</highlight><highlight class="normal"><sp/>||<sp/>*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\t&apos;</highlight><highlight class="normal">)<sp/>++p;</highlight></codeline>
<codeline lineno="1961"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal"><sp/>||<sp/>*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\r&apos;</highlight><highlight class="normal"><sp/>||<sp/>*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\n&apos;</highlight><highlight class="normal"><sp/>||<sp/>*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;#&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1962"><highlight class="normal"></highlight></codeline>
<codeline lineno="1963"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Split<sp/>at<sp/>first<sp/>whitespace.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1964"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*q<sp/>=<sp/>p;</highlight></codeline>
<codeline lineno="1965"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(*q<sp/>&amp;&amp;<sp/>*q<sp/>!=<sp/></highlight><highlight class="charliteral">&apos;<sp/>&apos;</highlight><highlight class="normal"><sp/>&amp;&amp;<sp/>*q<sp/>!=<sp/></highlight><highlight class="charliteral">&apos;\t&apos;</highlight><highlight class="normal"><sp/>&amp;&amp;<sp/>*q<sp/>!=<sp/></highlight><highlight class="charliteral">&apos;\r&apos;</highlight><highlight class="normal"><sp/>&amp;&amp;<sp/>*q<sp/>!=<sp/></highlight><highlight class="charliteral">&apos;\n&apos;</highlight><highlight class="normal">)<sp/>++q;</highlight></codeline>
<codeline lineno="1966"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*q<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1967"><highlight class="normal"><sp/><sp/><sp/><sp/>*q++<sp/>=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1968"><highlight class="normal"></highlight></codeline>
<codeline lineno="1969"><highlight class="normal"><sp/><sp/><sp/><sp/>uint64_t<sp/>pid<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1970"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1a2749355bb9d419963e15e9a58395f63e" kindref="member">parse_u64_auto</ref>(p,<sp/>&amp;pid)<sp/>!=<sp/>0)<sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1971"><highlight class="normal"></highlight></codeline>
<codeline lineno="1972"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(*q<sp/>==<sp/></highlight><highlight class="charliteral">&apos;<sp/>&apos;</highlight><highlight class="normal"><sp/>||<sp/>*q<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\t&apos;</highlight><highlight class="normal">)<sp/>++q;</highlight></codeline>
<codeline lineno="1973"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*q<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal"><sp/>||<sp/>*q<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\r&apos;</highlight><highlight class="normal"><sp/>||<sp/>*q<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\n&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1974"><highlight class="normal"></highlight></codeline>
<codeline lineno="1975"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Trim<sp/>CR/LF.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1976"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>strlen(q);</highlight></codeline>
<codeline lineno="1977"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(n<sp/>&amp;&amp;<sp/>(q[n<sp/>-<sp/>1]<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\n&apos;</highlight><highlight class="normal"><sp/>||<sp/>q[n<sp/>-<sp/>1]<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\r&apos;</highlight><highlight class="normal">))<sp/>q[--n]<sp/>=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1978"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>==<sp/>0)<sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1979"><highlight class="normal"></highlight></codeline>
<codeline lineno="1980"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*tok<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="1981"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>ntok<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1982"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1adaa53124eb0654f14346cf02af06b891" kindref="member">parse_token_list_inplace</ref>(q,<sp/>&amp;tok,<sp/>&amp;ntok)<sp/>!=<sp/>0)<sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1983"><highlight class="normal"></highlight></codeline>
<codeline lineno="1984"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1adc35a14cb1b2caeca261416dfa41edee" kindref="member">expected_tokens_table_push</ref>(out,<sp/>pid,<sp/>tok,<sp/>ntok)<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1985"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>free(tok);</highlight></codeline>
<codeline lineno="1986"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>rc<sp/>=<sp/>3;</highlight></codeline>
<codeline lineno="1987"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1988"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1989"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1990"><highlight class="normal"></highlight></codeline>
<codeline lineno="1991"><highlight class="normal"><sp/><sp/>(void)fclose(f);</highlight></codeline>
<codeline lineno="1992"><highlight class="normal"></highlight></codeline>
<codeline lineno="1993"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rc<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1994"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="main__infer_8c_1a470ca5b37dd720b5de391932c452af36" kindref="member">expected_tokens_table_free</ref>(out);</highlight></codeline>
<codeline lineno="1995"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>rc;</highlight></codeline>
<codeline lineno="1996"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1997"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="1998"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1999"><highlight class="normal"></highlight></codeline>
<codeline lineno="2006" refid="main__infer_8c_1a0b4d248d44b83ac2a6b5f47b47fe15df" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structexpected__tokens__entry" kindref="compound">expected_tokens_entry_t</ref><sp/>*<ref refid="main__infer_8c_1a0b4d248d44b83ac2a6b5f47b47fe15df" kindref="member">expected_tokens_find</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structexpected__tokens__table" kindref="compound">expected_tokens_table_t</ref><sp/>*t,</highlight></codeline>
<codeline lineno="2007"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint64_t<sp/>prompt_id)<sp/>{</highlight></codeline>
<codeline lineno="2008"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!t<sp/>||<sp/>!t-&gt;<ref refid="structexpected__tokens__table_1a276e1939826f5ce628faaef8db9e126c" kindref="member">entries</ref><sp/>||<sp/>t-&gt;<ref refid="structexpected__tokens__table_1a4a94ac05263628a477831280444a57a4" kindref="member">count</ref><sp/>==<sp/>0)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="2009"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>t-&gt;<ref refid="structexpected__tokens__table_1a4a94ac05263628a477831280444a57a4" kindref="member">count</ref>;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="2010"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(t-&gt;<ref refid="structexpected__tokens__table_1a276e1939826f5ce628faaef8db9e126c" kindref="member">entries</ref>[i].<ref refid="structexpected__tokens__entry_1a916080ab2649c9f4d225ed57d4ee32f5" kindref="member">prompt_id</ref><sp/>==<sp/>prompt_id)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>&amp;t-&gt;<ref refid="structexpected__tokens__table_1a276e1939826f5ce628faaef8db9e126c" kindref="member">entries</ref>[i];</highlight></codeline>
<codeline lineno="2011"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="2012"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="2013"><highlight class="normal">}</highlight></codeline>
<codeline lineno="2014"><highlight class="normal"></highlight></codeline>
<codeline lineno="2015"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>--------------------------------------------------------------------------<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2016"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Per-prompt<sp/>report<sp/>structures<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2017"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>--------------------------------------------------------------------------<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2018"><highlight class="normal"></highlight></codeline>
<codeline lineno="2022" refid="structreport__token__buf" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structreport__token__buf" kindref="compound">report_token_buf</ref><sp/>{</highlight></codeline>
<codeline lineno="2023" refid="structreport__token__buf_1a91b6556df06c25b311255a4a16f785dd" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*<ref refid="structreport__token__buf_1a91b6556df06c25b311255a4a16f785dd" kindref="member">ids</ref>;<sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="2024" refid="structreport__token__buf_1a89ffa03443f19bf77470f85a92baa245" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/><ref refid="structreport__token__buf_1a89ffa03443f19bf77470f85a92baa245" kindref="member">n</ref>;<sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="2025" refid="main__infer_8c_1aeaf1944cb54f4e8f7a914be88b362163" refkind="member"><highlight class="normal">}<sp/><ref refid="main__infer_8c_1aeaf1944cb54f4e8f7a914be88b362163" kindref="member">report_token_buf_t</ref>;</highlight></codeline>
<codeline lineno="2026"><highlight class="normal"></highlight></codeline>
<codeline lineno="2036" refid="main__infer_8c_1af91bda098d580c2cf56b5beda68bd2d5" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1af91bda098d580c2cf56b5beda68bd2d5" kindref="member">report_token_buf_free</ref>(<ref refid="structreport__token__buf" kindref="compound">report_token_buf_t</ref><sp/>*b)<sp/>{</highlight></codeline>
<codeline lineno="2037"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!b)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2038"><highlight class="normal"><sp/><sp/>free(b-&gt;<ref refid="structreport__token__buf_1a91b6556df06c25b311255a4a16f785dd" kindref="member">ids</ref>);</highlight></codeline>
<codeline lineno="2039"><highlight class="normal"><sp/><sp/>b-&gt;<ref refid="structreport__token__buf_1a91b6556df06c25b311255a4a16f785dd" kindref="member">ids</ref><sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="2040"><highlight class="normal"><sp/><sp/>b-&gt;<ref refid="structreport__token__buf_1a89ffa03443f19bf77470f85a92baa245" kindref="member">n</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="2041"><highlight class="normal">}</highlight></codeline>
<codeline lineno="2042"><highlight class="normal"></highlight></codeline>
<codeline lineno="2062" refid="main__infer_8c_1a23f6c5852d73ecbdb1dead2be803bcf0" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a23f6c5852d73ecbdb1dead2be803bcf0" kindref="member">report_token_buf_copy</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*ids,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>max_keep,<sp/><ref refid="structreport__token__buf" kindref="compound">report_token_buf_t</ref><sp/>*out)<sp/>{</highlight></codeline>
<codeline lineno="2063"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!out)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="2064"><highlight class="normal"><sp/><sp/>out-&gt;ids<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="2065"><highlight class="normal"><sp/><sp/>out-&gt;n<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="2066"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!ids<sp/>||<sp/>n<sp/>==<sp/>0)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="2067"><highlight class="normal"></highlight></codeline>
<codeline lineno="2068"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>keep<sp/>=<sp/>n;</highlight></codeline>
<codeline lineno="2069"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(max_keep<sp/>&gt;<sp/>0<sp/>&amp;&amp;<sp/>keep<sp/>&gt;<sp/>max_keep)<sp/>keep<sp/>=<sp/>max_keep;</highlight></codeline>
<codeline lineno="2070"><highlight class="normal"></highlight></codeline>
<codeline lineno="2071"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*cp<sp/>=<sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*)malloc(</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)<sp/>*<sp/>keep);</highlight></codeline>
<codeline lineno="2072"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!cp)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>2;</highlight></codeline>
<codeline lineno="2073"><highlight class="normal"><sp/><sp/>memcpy(cp,<sp/>ids,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)<sp/>*<sp/>keep);</highlight></codeline>
<codeline lineno="2074"><highlight class="normal"><sp/><sp/>out-&gt;ids<sp/>=<sp/>cp;</highlight></codeline>
<codeline lineno="2075"><highlight class="normal"><sp/><sp/>out-&gt;n<sp/>=<sp/>keep;</highlight></codeline>
<codeline lineno="2076"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="2077"><highlight class="normal">}</highlight></codeline>
<codeline lineno="2078"><highlight class="normal"></highlight></codeline>
<codeline lineno="2082" refid="structprompt__round__record" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">typedef</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal"><ref refid="structprompt__round__record" kindref="compound">prompt_round_record</ref><sp/>{</highlight></codeline>
<codeline lineno="2083" refid="structprompt__round__record_1a691ac5964e952c5059b957f07a8542f5" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/><ref refid="structprompt__round__record_1a691ac5964e952c5059b957f07a8542f5" kindref="member">prompt_index</ref>;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="2084" refid="structprompt__round__record_1aad02ec5870f35fcf8d7608104ed06304" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structprompt__round__record_1aad02ec5870f35fcf8d7608104ed06304" kindref="member">round_index</ref>;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="2086" refid="structprompt__round__record_1a9b7acfc693dc6c61df0c048c77d59c6f" refkind="member"><highlight class="normal"><sp/><sp/>uint64_t<sp/><ref refid="structprompt__round__record_1a9b7acfc693dc6c61df0c048c77d59c6f" kindref="member">prompt_id</ref>;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="2088" refid="structprompt__round__record_1a8cc938142194c5202bb275da807b0dbf" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/><ref refid="structprompt__round__record_1a8cc938142194c5202bb275da807b0dbf" kindref="member">tokens_generated</ref>;<sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="2089" refid="structprompt__round__record_1a51223e3133e92ee93d77d6752e57d1bf" refkind="member"><highlight class="normal"><sp/><sp/><ref refid="structreport__token__buf" kindref="compound">report_token_buf_t</ref><sp/><ref refid="structprompt__round__record_1a51223e3133e92ee93d77d6752e57d1bf" kindref="member">tokens</ref>;<sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="2091" refid="structprompt__round__record_1a8da08c83a326c2b7ab39fd7cfadb762b" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/><ref refid="structprompt__round__record_1a8da08c83a326c2b7ab39fd7cfadb762b" kindref="member">window_time_s</ref>;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="2092" refid="structprompt__round__record_1a4ab0f6440e03c15551287b69ed070d94" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/><ref refid="structprompt__round__record_1a4ab0f6440e03c15551287b69ed070d94" kindref="member">prefill_time_s</ref>;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="2093" refid="structprompt__round__record_1aa08726c5eddf5bb4680d15b63b494dc8" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/><ref refid="structprompt__round__record_1aa08726c5eddf5bb4680d15b63b494dc8" kindref="member">decode_time_s</ref>;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="2095" refid="structprompt__round__record_1ad67c0f4a359b27e788a90c0477211293" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structprompt__round__record_1ad67c0f4a359b27e788a90c0477211293" kindref="member">expected_present</ref>;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="2096" refid="structprompt__round__record_1adbf79594fd763d49b2eb13dcbd027c90" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structprompt__round__record_1adbf79594fd763d49b2eb13dcbd027c90" kindref="member">expected_ok</ref>;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="2097" refid="structprompt__round__record_1a639a8578fdf0ba299afe4f0783c47567" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/><ref refid="structprompt__round__record_1a639a8578fdf0ba299afe4f0783c47567" kindref="member">mismatch_index</ref>;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="2098" refid="structprompt__round__record_1ae372c2117122aeea632490a6ea1526b1" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structprompt__round__record_1ae372c2117122aeea632490a6ea1526b1" kindref="member">expected_at</ref>;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="2099" refid="structprompt__round__record_1a24eceb958921c2ab6ecf6fe0cdc5da49" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structprompt__round__record_1a24eceb958921c2ab6ecf6fe0cdc5da49" kindref="member">actual_at</ref>;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="2101" refid="structprompt__round__record_1a0c260950e8b81d2992debca2f4b49d00" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="structprompt__round__record_1a0c260950e8b81d2992debca2f4b49d00" kindref="member">decoded_text</ref>;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="2102" refid="main__infer_8c_1af8802263c4d59c173623fe774ce0abb0" refkind="member"><highlight class="normal">}<sp/><ref refid="main__infer_8c_1af8802263c4d59c173623fe774ce0abb0" kindref="member">prompt_round_record_t</ref>;</highlight></codeline>
<codeline lineno="2103"><highlight class="normal"></highlight></codeline>
<codeline lineno="2113" refid="main__infer_8c_1aa8860ddc49714b553fe669c784885cff" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1aa8860ddc49714b553fe669c784885cff" kindref="member">prompt_round_record_free</ref>(<ref refid="structprompt__round__record" kindref="compound">prompt_round_record_t</ref><sp/>*r)<sp/>{</highlight></codeline>
<codeline lineno="2114"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!r)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2115"><highlight class="normal"><sp/><sp/><ref refid="main__infer_8c_1af91bda098d580c2cf56b5beda68bd2d5" kindref="member">report_token_buf_free</ref>(&amp;r-&gt;<ref refid="structprompt__round__record_1a51223e3133e92ee93d77d6752e57d1bf" kindref="member">tokens</ref>);</highlight></codeline>
<codeline lineno="2116"><highlight class="normal"><sp/><sp/>free(r-&gt;<ref refid="structprompt__round__record_1a0c260950e8b81d2992debca2f4b49d00" kindref="member">decoded_text</ref>);</highlight></codeline>
<codeline lineno="2117"><highlight class="normal"><sp/><sp/>r-&gt;<ref refid="structprompt__round__record_1a0c260950e8b81d2992debca2f4b49d00" kindref="member">decoded_text</ref><sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="2118"><highlight class="normal">}</highlight></codeline>
<codeline lineno="2119"><highlight class="normal"></highlight></codeline>
<codeline lineno="2131" refid="main__infer_8c_1a9205188606b8d4265d29fa8911259cac" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a9205188606b8d4265d29fa8911259cac" kindref="member">json_print_int_array</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*ids,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n)<sp/>{</highlight></codeline>
<codeline lineno="2132"><highlight class="normal"><sp/><sp/>fputc(</highlight><highlight class="charliteral">&apos;[&apos;</highlight><highlight class="normal">,<sp/>stdout);</highlight></codeline>
<codeline lineno="2133"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ids<sp/>&amp;&amp;<sp/>n)<sp/>{</highlight></codeline>
<codeline lineno="2134"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>n;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="2135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stdout,<sp/></highlight><highlight class="stringliteral">&quot;%d%s&quot;</highlight><highlight class="normal">,<sp/>ids[i],<sp/>(i<sp/>+<sp/>1<sp/>&lt;<sp/>n)<sp/>?<sp/></highlight><highlight class="stringliteral">&quot;,&quot;</highlight><highlight class="normal"><sp/>:<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="2136"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2137"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="2138"><highlight class="normal"><sp/><sp/>fputc(</highlight><highlight class="charliteral">&apos;]&apos;</highlight><highlight class="normal">,<sp/>stdout);</highlight></codeline>
<codeline lineno="2139"><highlight class="normal">}</highlight></codeline>
<codeline lineno="2140"><highlight class="normal"></highlight></codeline>
<codeline lineno="2141"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>--------------------------------------------------------------------------<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2142"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>JSON<sp/>emitter<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2143"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>--------------------------------------------------------------------------<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2144"><highlight class="normal"></highlight></codeline>
<codeline lineno="2171" refid="main__infer_8c_1a84b40472513bc66398c6d3049891f553" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a84b40472513bc66398c6d3049891f553" kindref="member">print_json_result</ref>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n_tok,</highlight></codeline>
<codeline lineno="2172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*tokens,</highlight></codeline>
<codeline lineno="2173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>wall_s_in,</highlight></codeline>
<codeline lineno="2174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>prefill_s_in,</highlight></codeline>
<codeline lineno="2175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>decode_s_in,</highlight></codeline>
<codeline lineno="2176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint64_t<sp/>kv_hits,</highlight></codeline>
<codeline lineno="2177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint64_t<sp/>kv_misses,</highlight></codeline>
<codeline lineno="2178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint32_t<sp/>rss_peak_mb,</highlight></codeline>
<codeline lineno="2179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*text_decoded,</highlight></codeline>
<codeline lineno="2180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*tokenizer_path_used,</highlight></codeline>
<codeline lineno="2181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*expected_file,</highlight></codeline>
<codeline lineno="2182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structprompt__list" kindref="compound">prompt_list_t</ref><sp/>*prompts,</highlight></codeline>
<codeline lineno="2183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>rounds,</highlight></codeline>
<codeline lineno="2184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structprompt__round__record" kindref="compound">prompt_round_record_t</ref><sp/>*recs)<sp/>{</highlight></codeline>
<codeline lineno="2185"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>wall_s<sp/>=<sp/>(wall_s_in<sp/>&gt;<sp/>0.0)<sp/>?<sp/>wall_s_in<sp/>:<sp/>0.0;</highlight></codeline>
<codeline lineno="2186"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>prefill_s<sp/>=<sp/>(prefill_s_in<sp/>&gt;<sp/>0.0)<sp/>?<sp/>prefill_s_in<sp/>:<sp/>0.0;</highlight></codeline>
<codeline lineno="2187"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>decode_s<sp/>=<sp/>(decode_s_in<sp/>&gt;<sp/>0.0)<sp/>?<sp/>decode_s_in<sp/>:<sp/>0.0;</highlight></codeline>
<codeline lineno="2188"><highlight class="normal"></highlight></codeline>
<codeline lineno="2189"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>tps_true<sp/>=<sp/>(decode_s<sp/>&gt;<sp/>0.0)<sp/>?<sp/>((</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">)n_tok<sp/>/<sp/>decode_s)<sp/>:<sp/>0.0;</highlight></codeline>
<codeline lineno="2190"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>tps_window<sp/>=<sp/>(wall_s<sp/>&gt;<sp/>0.0)<sp/>?<sp/>((</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">)n_tok<sp/>/<sp/>wall_s)<sp/>:<sp/>0.0;</highlight></codeline>
<codeline lineno="2191"><highlight class="normal"></highlight></codeline>
<codeline lineno="2192"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>p50<sp/>=<sp/>0.0,<sp/>p95<sp/>=<sp/>0.0;</highlight></codeline>
<codeline lineno="2193"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n_tok<sp/>&gt;<sp/>0<sp/>&amp;&amp;<sp/>decode_s<sp/>&gt;<sp/>0.0)<sp/>{</highlight></codeline>
<codeline lineno="2194"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>per_tok_ms<sp/>=<sp/>(decode_s<sp/>*<sp/>1000.0)<sp/>/<sp/>(</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">)n_tok;</highlight></codeline>
<codeline lineno="2195"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(per_tok_ms<sp/>&lt;<sp/>0.001)<sp/>per_tok_ms<sp/>=<sp/>0.001;</highlight></codeline>
<codeline lineno="2196"><highlight class="normal"><sp/><sp/><sp/><sp/>p50<sp/>=<sp/>per_tok_ms;</highlight></codeline>
<codeline lineno="2197"><highlight class="normal"><sp/><sp/><sp/><sp/>p95<sp/>=<sp/>per_tok_ms<sp/>*<sp/>2.0;</highlight></codeline>
<codeline lineno="2198"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="2199"><highlight class="normal"></highlight></codeline>
<codeline lineno="2200"><highlight class="normal"><sp/><sp/>fprintf(stdout,<sp/></highlight><highlight class="stringliteral">&quot;{\&quot;tokens_generated\&quot;:%zu,&quot;</highlight><highlight class="normal">,<sp/>n_tok);</highlight></codeline>
<codeline lineno="2201"><highlight class="normal"></highlight></codeline>
<codeline lineno="2202"><highlight class="normal"><sp/><sp/>fputs(</highlight><highlight class="stringliteral">&quot;\&quot;tokens\&quot;:&quot;</highlight><highlight class="normal">,<sp/>stdout);</highlight></codeline>
<codeline lineno="2203"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(tokens<sp/>&amp;&amp;<sp/>n_tok<sp/>&gt;<sp/>0)<sp/><ref refid="main__infer_8c_1a9205188606b8d4265d29fa8911259cac" kindref="member">json_print_int_array</ref>(tokens,<sp/>n_tok);</highlight></codeline>
<codeline lineno="2204"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a9205188606b8d4265d29fa8911259cac" kindref="member">json_print_int_array</ref>(NULL,<sp/>0);</highlight></codeline>
<codeline lineno="2205"><highlight class="normal"><sp/><sp/>fputs(</highlight><highlight class="stringliteral">&quot;,&quot;</highlight><highlight class="normal">,<sp/>stdout);</highlight></codeline>
<codeline lineno="2206"><highlight class="normal"></highlight></codeline>
<codeline lineno="2207"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(tokenizer_path_used<sp/>&amp;&amp;<sp/>*tokenizer_path_used)<sp/>{</highlight></codeline>
<codeline lineno="2208"><highlight class="normal"><sp/><sp/><sp/><sp/>fputs(</highlight><highlight class="stringliteral">&quot;\&quot;tokenizer_path\&quot;:&quot;</highlight><highlight class="normal">,<sp/>stdout);</highlight></codeline>
<codeline lineno="2209"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="main__infer_8c_1a7427a4a1579fb747a4ce22a4a1d4a80a" kindref="member">json_print_escaped_string</ref>(tokenizer_path_used);</highlight></codeline>
<codeline lineno="2210"><highlight class="normal"><sp/><sp/><sp/><sp/>fputs(</highlight><highlight class="stringliteral">&quot;,&quot;</highlight><highlight class="normal">,<sp/>stdout);</highlight></codeline>
<codeline lineno="2211"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="2212"><highlight class="normal"></highlight></codeline>
<codeline lineno="2213"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(expected_file<sp/>&amp;&amp;<sp/>*expected_file)<sp/>{</highlight></codeline>
<codeline lineno="2214"><highlight class="normal"><sp/><sp/><sp/><sp/>fputs(</highlight><highlight class="stringliteral">&quot;\&quot;expected_tokens_file\&quot;:&quot;</highlight><highlight class="normal">,<sp/>stdout);</highlight></codeline>
<codeline lineno="2215"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="main__infer_8c_1a7427a4a1579fb747a4ce22a4a1d4a80a" kindref="member">json_print_escaped_string</ref>(expected_file);</highlight></codeline>
<codeline lineno="2216"><highlight class="normal"><sp/><sp/><sp/><sp/>fputs(</highlight><highlight class="stringliteral">&quot;,&quot;</highlight><highlight class="normal">,<sp/>stdout);</highlight></codeline>
<codeline lineno="2217"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="2218"><highlight class="normal"></highlight></codeline>
<codeline lineno="2219"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(text_decoded)<sp/>{</highlight></codeline>
<codeline lineno="2220"><highlight class="normal"><sp/><sp/><sp/><sp/>fputs(</highlight><highlight class="stringliteral">&quot;\&quot;text\&quot;:&quot;</highlight><highlight class="normal">,<sp/>stdout);</highlight></codeline>
<codeline lineno="2221"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="main__infer_8c_1a7427a4a1579fb747a4ce22a4a1d4a80a" kindref="member">json_print_escaped_string</ref>(text_decoded);</highlight></codeline>
<codeline lineno="2222"><highlight class="normal"><sp/><sp/><sp/><sp/>fputs(</highlight><highlight class="stringliteral">&quot;,&quot;</highlight><highlight class="normal">,<sp/>stdout);</highlight></codeline>
<codeline lineno="2223"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="2224"><highlight class="normal"></highlight></codeline>
<codeline lineno="2225"><highlight class="normal"><sp/><sp/>fprintf(stdout,</highlight></codeline>
<codeline lineno="2226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;\&quot;wall_time_s\&quot;:%.6f,&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;\&quot;prefill_time_s\&quot;:%.6f,&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;\&quot;decode_time_s\&quot;:%.6f,&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;\&quot;tps_true\&quot;:%.6f,&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;\&quot;tps_window\&quot;:%.6f,&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;\&quot;latency_p50_ms\&quot;:%.3f,&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;\&quot;latency_p95_ms\&quot;:%.3f,&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;\&quot;rss_peak_mb\&quot;:%u,&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;\&quot;kv_hits\&quot;:%&quot;</highlight><highlight class="normal"><sp/>PRIu64<sp/></highlight><highlight class="stringliteral">&quot;,&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;\&quot;kv_misses\&quot;:%&quot;</highlight><highlight class="normal"><sp/>PRIu64<sp/></highlight><highlight class="stringliteral">&quot;,&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="2236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wall_s,</highlight></codeline>
<codeline lineno="2237"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>prefill_s,</highlight></codeline>
<codeline lineno="2238"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>decode_s,</highlight></codeline>
<codeline lineno="2239"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tps_true,</highlight></codeline>
<codeline lineno="2240"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tps_window,</highlight></codeline>
<codeline lineno="2241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p50,</highlight></codeline>
<codeline lineno="2242"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p95,</highlight></codeline>
<codeline lineno="2243"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">)rss_peak_mb,</highlight></codeline>
<codeline lineno="2244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>kv_hits,</highlight></codeline>
<codeline lineno="2245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>kv_misses);</highlight></codeline>
<codeline lineno="2246"><highlight class="normal"></highlight></codeline>
<codeline lineno="2247"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Per-prompt<sp/>details:<sp/>always<sp/>present<sp/>(possibly<sp/>empty).<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2248"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n_prompts<sp/>=<sp/>(prompts<sp/>?<sp/>prompts-&gt;<ref refid="structprompt__list_1ab60c60299e5806652f4c2c7a94aca5c3" kindref="member">count</ref><sp/>:<sp/>0);</highlight></codeline>
<codeline lineno="2249"><highlight class="normal"><sp/><sp/>fprintf(stdout,<sp/></highlight><highlight class="stringliteral">&quot;\&quot;prompts_count\&quot;:%zu,&quot;</highlight><highlight class="normal">,<sp/>n_prompts);</highlight></codeline>
<codeline lineno="2250"><highlight class="normal"><sp/><sp/>fprintf(stdout,<sp/></highlight><highlight class="stringliteral">&quot;\&quot;rounds\&quot;:%d,&quot;</highlight><highlight class="normal">,<sp/>(rounds<sp/>&gt;<sp/>0<sp/>?<sp/>rounds<sp/>:<sp/>1));</highlight></codeline>
<codeline lineno="2251"><highlight class="normal"></highlight></codeline>
<codeline lineno="2252"><highlight class="normal"><sp/><sp/>fputs(</highlight><highlight class="stringliteral">&quot;\&quot;prompts\&quot;:[&quot;</highlight><highlight class="normal">,<sp/>stdout);</highlight></codeline>
<codeline lineno="2253"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(prompts<sp/>&amp;&amp;<sp/>recs<sp/>&amp;&amp;<sp/>n_prompts<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="2254"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>pi<sp/>=<sp/>0;<sp/>pi<sp/>&lt;<sp/>n_prompts;<sp/>++pi)<sp/>{</highlight></codeline>
<codeline lineno="2255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Aggregate<sp/>totals<sp/>for<sp/>this<sp/>prompt.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>tok_sum<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="2257"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>win_sum<sp/>=<sp/>0.0,<sp/>pre_sum<sp/>=<sp/>0.0,<sp/>dec_sum<sp/>=<sp/>0.0;</highlight></codeline>
<codeline lineno="2258"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>exp_present<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="2259"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>exp_all_ok<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="2260"><highlight class="normal"></highlight></codeline>
<codeline lineno="2261"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>rr<sp/>=<sp/>0;<sp/>rr<sp/>&lt;<sp/>(rounds<sp/>&gt;<sp/>0<sp/>?<sp/>rounds<sp/>:<sp/>1);<sp/>++rr)<sp/>{</highlight></codeline>
<codeline lineno="2262"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structprompt__round__record" kindref="compound">prompt_round_record_t</ref><sp/>*r<sp/>=<sp/>&amp;recs[(size_t)rr<sp/>*<sp/>n_prompts<sp/>+<sp/>pi];</highlight></codeline>
<codeline lineno="2263"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tok_sum<sp/>+=<sp/>r-&gt;<ref refid="structprompt__round__record_1a8cc938142194c5202bb275da807b0dbf" kindref="member">tokens_generated</ref>;</highlight></codeline>
<codeline lineno="2264"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>win_sum<sp/>+=<sp/>r-&gt;<ref refid="structprompt__round__record_1a8da08c83a326c2b7ab39fd7cfadb762b" kindref="member">window_time_s</ref>;</highlight></codeline>
<codeline lineno="2265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pre_sum<sp/>+=<sp/>r-&gt;<ref refid="structprompt__round__record_1a4ab0f6440e03c15551287b69ed070d94" kindref="member">prefill_time_s</ref>;</highlight></codeline>
<codeline lineno="2266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dec_sum<sp/>+=<sp/>r-&gt;<ref refid="structprompt__round__record_1aa08726c5eddf5bb4680d15b63b494dc8" kindref="member">decode_time_s</ref>;</highlight></codeline>
<codeline lineno="2267"><highlight class="normal"></highlight></codeline>
<codeline lineno="2268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(r-&gt;<ref refid="structprompt__round__record_1ad67c0f4a359b27e788a90c0477211293" kindref="member">expected_present</ref>)<sp/>exp_present<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="2269"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(r-&gt;<ref refid="structprompt__round__record_1ad67c0f4a359b27e788a90c0477211293" kindref="member">expected_present</ref><sp/>&amp;&amp;<sp/>!r-&gt;<ref refid="structprompt__round__record_1adbf79594fd763d49b2eb13dcbd027c90" kindref="member">expected_ok</ref>)<sp/>exp_all_ok<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="2270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2271"><highlight class="normal"></highlight></codeline>
<codeline lineno="2272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>ptps_true<sp/>=<sp/>(dec_sum<sp/>&gt;<sp/>0.0)<sp/>?<sp/>((</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">)tok_sum<sp/>/<sp/>dec_sum)<sp/>:<sp/>0.0;</highlight></codeline>
<codeline lineno="2273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>ptps_win<sp/>=<sp/>(win_sum<sp/>&gt;<sp/>0.0)<sp/>?<sp/>((</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">)tok_sum<sp/>/<sp/>win_sum)<sp/>:<sp/>0.0;</highlight></codeline>
<codeline lineno="2274"><highlight class="normal"></highlight></codeline>
<codeline lineno="2275"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>fputs(</highlight><highlight class="stringliteral">&quot;{&quot;</highlight><highlight class="normal">,<sp/>stdout);</highlight></codeline>
<codeline lineno="2276"><highlight class="normal"></highlight></codeline>
<codeline lineno="2277"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stdout,<sp/></highlight><highlight class="stringliteral">&quot;\&quot;prompt_index\&quot;:%zu,&quot;</highlight><highlight class="normal">,<sp/>pi);</highlight></codeline>
<codeline lineno="2278"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>fputs(</highlight><highlight class="stringliteral">&quot;\&quot;prompt\&quot;:&quot;</highlight><highlight class="normal">,<sp/>stdout);</highlight></codeline>
<codeline lineno="2279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="main__infer_8c_1a7427a4a1579fb747a4ce22a4a1d4a80a" kindref="member">json_print_escaped_string</ref>(prompts-&gt;<ref refid="structprompt__list_1ad4b457e3153a399812c91acb3d2f399f" kindref="member">items</ref>[pi]);</highlight></codeline>
<codeline lineno="2280"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>fputs(</highlight><highlight class="stringliteral">&quot;,&quot;</highlight><highlight class="normal">,<sp/>stdout);</highlight></codeline>
<codeline lineno="2281"><highlight class="normal"></highlight></codeline>
<codeline lineno="2282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stdout,<sp/></highlight><highlight class="stringliteral">&quot;\&quot;prompt_id\&quot;:\&quot;0x%016&quot;</highlight><highlight class="normal"><sp/>PRIx64<sp/></highlight><highlight class="stringliteral">&quot;\&quot;,&quot;</highlight><highlight class="normal">,<sp/>(uint64_t)<ref refid="main__infer_8c_1ad7f42b712b3e86af5d9f8c9942bc8875" kindref="member">prompt_id_fnv1a64</ref>(prompts-&gt;<ref refid="structprompt__list_1ad4b457e3153a399812c91acb3d2f399f" kindref="member">items</ref>[pi]));</highlight></codeline>
<codeline lineno="2283"><highlight class="normal"></highlight></codeline>
<codeline lineno="2284"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stdout,<sp/></highlight><highlight class="stringliteral">&quot;\&quot;tokens_generated\&quot;:%zu,&quot;</highlight><highlight class="normal">,<sp/>tok_sum);</highlight></codeline>
<codeline lineno="2285"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stdout,<sp/></highlight><highlight class="stringliteral">&quot;\&quot;window_time_s\&quot;:%.6f,&quot;</highlight><highlight class="normal">,<sp/>win_sum);</highlight></codeline>
<codeline lineno="2286"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stdout,<sp/></highlight><highlight class="stringliteral">&quot;\&quot;prefill_time_s\&quot;:%.6f,&quot;</highlight><highlight class="normal">,<sp/>pre_sum);</highlight></codeline>
<codeline lineno="2287"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stdout,<sp/></highlight><highlight class="stringliteral">&quot;\&quot;decode_time_s\&quot;:%.6f,&quot;</highlight><highlight class="normal">,<sp/>dec_sum);</highlight></codeline>
<codeline lineno="2288"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stdout,<sp/></highlight><highlight class="stringliteral">&quot;\&quot;tps_true\&quot;:%.6f,&quot;</highlight><highlight class="normal">,<sp/>ptps_true);</highlight></codeline>
<codeline lineno="2289"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stdout,<sp/></highlight><highlight class="stringliteral">&quot;\&quot;tps_window\&quot;:%.6f,&quot;</highlight><highlight class="normal">,<sp/>ptps_win);</highlight></codeline>
<codeline lineno="2290"><highlight class="normal"></highlight></codeline>
<codeline lineno="2291"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stdout,<sp/></highlight><highlight class="stringliteral">&quot;\&quot;expected_present\&quot;:%s,&quot;</highlight><highlight class="normal">,<sp/>exp_present<sp/>?<sp/></highlight><highlight class="stringliteral">&quot;true&quot;</highlight><highlight class="normal"><sp/>:<sp/></highlight><highlight class="stringliteral">&quot;false&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="2292"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stdout,<sp/></highlight><highlight class="stringliteral">&quot;\&quot;expected_all_ok\&quot;:%s,&quot;</highlight><highlight class="normal">,<sp/>(exp_present<sp/>&amp;&amp;<sp/>exp_all_ok)<sp/>?<sp/></highlight><highlight class="stringliteral">&quot;true&quot;</highlight><highlight class="normal"><sp/>:<sp/></highlight><highlight class="stringliteral">&quot;false&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="2293"><highlight class="normal"></highlight></codeline>
<codeline lineno="2294"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>fputs(</highlight><highlight class="stringliteral">&quot;\&quot;rounds\&quot;:[&quot;</highlight><highlight class="normal">,<sp/>stdout);</highlight></codeline>
<codeline lineno="2295"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>rr<sp/>=<sp/>0;<sp/>rr<sp/>&lt;<sp/>(rounds<sp/>&gt;<sp/>0<sp/>?<sp/>rounds<sp/>:<sp/>1);<sp/>++rr)<sp/>{</highlight></codeline>
<codeline lineno="2296"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structprompt__round__record" kindref="compound">prompt_round_record_t</ref><sp/>*r<sp/>=<sp/>&amp;recs[(size_t)rr<sp/>*<sp/>n_prompts<sp/>+<sp/>pi];</highlight></codeline>
<codeline lineno="2297"><highlight class="normal"></highlight></codeline>
<codeline lineno="2298"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fputs(</highlight><highlight class="stringliteral">&quot;{&quot;</highlight><highlight class="normal">,<sp/>stdout);</highlight></codeline>
<codeline lineno="2299"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stdout,<sp/></highlight><highlight class="stringliteral">&quot;\&quot;round\&quot;:%d,&quot;</highlight><highlight class="normal">,<sp/>rr);</highlight></codeline>
<codeline lineno="2300"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stdout,<sp/></highlight><highlight class="stringliteral">&quot;\&quot;tokens_generated\&quot;:%zu,&quot;</highlight><highlight class="normal">,<sp/>r-&gt;<ref refid="structprompt__round__record_1a8cc938142194c5202bb275da807b0dbf" kindref="member">tokens_generated</ref>);</highlight></codeline>
<codeline lineno="2301"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stdout,<sp/></highlight><highlight class="stringliteral">&quot;\&quot;window_time_s\&quot;:%.6f,&quot;</highlight><highlight class="normal">,<sp/>r-&gt;<ref refid="structprompt__round__record_1a8da08c83a326c2b7ab39fd7cfadb762b" kindref="member">window_time_s</ref>);</highlight></codeline>
<codeline lineno="2302"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stdout,<sp/></highlight><highlight class="stringliteral">&quot;\&quot;prefill_time_s\&quot;:%.6f,&quot;</highlight><highlight class="normal">,<sp/>r-&gt;<ref refid="structprompt__round__record_1a4ab0f6440e03c15551287b69ed070d94" kindref="member">prefill_time_s</ref>);</highlight></codeline>
<codeline lineno="2303"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stdout,<sp/></highlight><highlight class="stringliteral">&quot;\&quot;decode_time_s\&quot;:%.6f,&quot;</highlight><highlight class="normal">,<sp/>r-&gt;<ref refid="structprompt__round__record_1aa08726c5eddf5bb4680d15b63b494dc8" kindref="member">decode_time_s</ref>);</highlight></codeline>
<codeline lineno="2304"><highlight class="normal"></highlight></codeline>
<codeline lineno="2305"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stdout,<sp/></highlight><highlight class="stringliteral">&quot;\&quot;expected_present\&quot;:%s,&quot;</highlight><highlight class="normal">,<sp/>r-&gt;<ref refid="structprompt__round__record_1ad67c0f4a359b27e788a90c0477211293" kindref="member">expected_present</ref><sp/>?<sp/></highlight><highlight class="stringliteral">&quot;true&quot;</highlight><highlight class="normal"><sp/>:<sp/></highlight><highlight class="stringliteral">&quot;false&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="2306"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stdout,<sp/></highlight><highlight class="stringliteral">&quot;\&quot;expected_ok\&quot;:%s,&quot;</highlight><highlight class="normal">,<sp/>(r-&gt;<ref refid="structprompt__round__record_1ad67c0f4a359b27e788a90c0477211293" kindref="member">expected_present</ref><sp/>&amp;&amp;<sp/>r-&gt;<ref refid="structprompt__round__record_1adbf79594fd763d49b2eb13dcbd027c90" kindref="member">expected_ok</ref>)<sp/>?<sp/></highlight><highlight class="stringliteral">&quot;true&quot;</highlight><highlight class="normal"><sp/>:<sp/></highlight><highlight class="stringliteral">&quot;false&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="2307"><highlight class="normal"></highlight></codeline>
<codeline lineno="2308"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(r-&gt;<ref refid="structprompt__round__record_1ad67c0f4a359b27e788a90c0477211293" kindref="member">expected_present</ref><sp/>&amp;&amp;<sp/>!r-&gt;<ref refid="structprompt__round__record_1adbf79594fd763d49b2eb13dcbd027c90" kindref="member">expected_ok</ref>)<sp/>{</highlight></codeline>
<codeline lineno="2309"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stdout,<sp/></highlight><highlight class="stringliteral">&quot;\&quot;mismatch_index\&quot;:%zu,&quot;</highlight><highlight class="normal">,<sp/>r-&gt;<ref refid="structprompt__round__record_1a639a8578fdf0ba299afe4f0783c47567" kindref="member">mismatch_index</ref>);</highlight></codeline>
<codeline lineno="2310"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stdout,<sp/></highlight><highlight class="stringliteral">&quot;\&quot;expected_at\&quot;:%d,&quot;</highlight><highlight class="normal">,<sp/>r-&gt;<ref refid="structprompt__round__record_1ae372c2117122aeea632490a6ea1526b1" kindref="member">expected_at</ref>);</highlight></codeline>
<codeline lineno="2311"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stdout,<sp/></highlight><highlight class="stringliteral">&quot;\&quot;actual_at\&quot;:%d,&quot;</highlight><highlight class="normal">,<sp/>r-&gt;<ref refid="structprompt__round__record_1a24eceb958921c2ab6ecf6fe0cdc5da49" kindref="member">actual_at</ref>);</highlight></codeline>
<codeline lineno="2312"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2313"><highlight class="normal"></highlight></codeline>
<codeline lineno="2314"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fputs(</highlight><highlight class="stringliteral">&quot;\&quot;tokens\&quot;:&quot;</highlight><highlight class="normal">,<sp/>stdout);</highlight></codeline>
<codeline lineno="2315"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="main__infer_8c_1a9205188606b8d4265d29fa8911259cac" kindref="member">json_print_int_array</ref>(r-&gt;<ref refid="structprompt__round__record_1a51223e3133e92ee93d77d6752e57d1bf" kindref="member">tokens</ref>.<ref refid="structreport__token__buf_1a91b6556df06c25b311255a4a16f785dd" kindref="member">ids</ref>,<sp/>r-&gt;<ref refid="structprompt__round__record_1a51223e3133e92ee93d77d6752e57d1bf" kindref="member">tokens</ref>.<ref refid="structreport__token__buf_1a89ffa03443f19bf77470f85a92baa245" kindref="member">n</ref>);</highlight></codeline>
<codeline lineno="2316"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fputs(</highlight><highlight class="stringliteral">&quot;,&quot;</highlight><highlight class="normal">,<sp/>stdout);</highlight></codeline>
<codeline lineno="2317"><highlight class="normal"></highlight></codeline>
<codeline lineno="2318"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(r-&gt;<ref refid="structprompt__round__record_1a0c260950e8b81d2992debca2f4b49d00" kindref="member">decoded_text</ref>)<sp/>{</highlight></codeline>
<codeline lineno="2319"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fputs(</highlight><highlight class="stringliteral">&quot;\&quot;text\&quot;:&quot;</highlight><highlight class="normal">,<sp/>stdout);</highlight></codeline>
<codeline lineno="2320"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="main__infer_8c_1a7427a4a1579fb747a4ce22a4a1d4a80a" kindref="member">json_print_escaped_string</ref>(r-&gt;<ref refid="structprompt__round__record_1a0c260950e8b81d2992debca2f4b49d00" kindref="member">decoded_text</ref>);</highlight></codeline>
<codeline lineno="2321"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="2322"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fputs(</highlight><highlight class="stringliteral">&quot;\&quot;text\&quot;:null&quot;</highlight><highlight class="normal">,<sp/>stdout);</highlight></codeline>
<codeline lineno="2323"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2324"><highlight class="normal"></highlight></codeline>
<codeline lineno="2325"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fputs(</highlight><highlight class="stringliteral">&quot;}&quot;</highlight><highlight class="normal">,<sp/>stdout);</highlight></codeline>
<codeline lineno="2326"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rr<sp/>+<sp/>1<sp/>&lt;<sp/>(rounds<sp/>&gt;<sp/>0<sp/>?<sp/>rounds<sp/>:<sp/>1))<sp/>fputs(</highlight><highlight class="stringliteral">&quot;,&quot;</highlight><highlight class="normal">,<sp/>stdout);</highlight></codeline>
<codeline lineno="2327"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2328"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>fputs(</highlight><highlight class="stringliteral">&quot;]}&quot;</highlight><highlight class="normal">,<sp/>stdout);</highlight></codeline>
<codeline lineno="2329"><highlight class="normal"></highlight></codeline>
<codeline lineno="2330"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pi<sp/>+<sp/>1<sp/>&lt;<sp/>n_prompts)<sp/>fputs(</highlight><highlight class="stringliteral">&quot;,&quot;</highlight><highlight class="normal">,<sp/>stdout);</highlight></codeline>
<codeline lineno="2331"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2332"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="2333"><highlight class="normal"><sp/><sp/>fputs(</highlight><highlight class="stringliteral">&quot;]}\n&quot;</highlight><highlight class="normal">,<sp/>stdout);</highlight></codeline>
<codeline lineno="2334"><highlight class="normal">}</highlight></codeline>
<codeline lineno="2335"><highlight class="normal"></highlight></codeline>
<codeline lineno="2336"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>--------------------------------------------------------------------------<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2337"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>main<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2338"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>--------------------------------------------------------------------------<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2339"><highlight class="normal"></highlight></codeline>
<codeline lineno="2345" refid="main__infer_8c_1a43b384fdf1f1e4cc7304e6164461af44" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a43b384fdf1f1e4cc7304e6164461af44" kindref="member">device_is_cuda</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*dev)<sp/>{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a72ab94aafe7740f1343d317daa89ca15" kindref="member">ascii_ieq</ref>(dev,<sp/></highlight><highlight class="stringliteral">&quot;cuda&quot;</highlight><highlight class="normal">)<sp/>?<sp/>1<sp/>:<sp/>0;<sp/>}</highlight></codeline>
<codeline lineno="2346"><highlight class="normal"></highlight></codeline>
<codeline lineno="2352" refid="main__infer_8c_1ae26c03bc6150b42f62a01df020935733" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1ae26c03bc6150b42f62a01df020935733" kindref="member">device_is_cpu</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*dev)<sp/>{<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="main__infer_8c_1a72ab94aafe7740f1343d317daa89ca15" kindref="member">ascii_ieq</ref>(dev,<sp/></highlight><highlight class="stringliteral">&quot;cpu&quot;</highlight><highlight class="normal">)<sp/>?<sp/>1<sp/>:<sp/>0;<sp/>}</highlight></codeline>
<codeline lineno="2353"><highlight class="normal"></highlight></codeline>
<codeline lineno="2362" refid="main__infer_8c_1a3c04138a5bfe5d72780bb7e82a18e627" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="test__act__quant_8c_1a840291bc02cba5474a4cb46a9b9566fe" kindref="member">main</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>argc,<sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>**argv)<sp/>{</highlight></codeline>
<codeline lineno="2363"><highlight class="normal"><sp/><sp/><ref refid="structcli__extras" kindref="compound">cli_extras_t</ref><sp/>opt;</highlight></codeline>
<codeline lineno="2364"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1a456ba954f3884bcf5f72fc3e779de284" kindref="member">parse_flags</ref>(argc,<sp/>argv,<sp/>&amp;opt)<sp/>!=<sp/>0)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>2;</highlight></codeline>
<codeline lineno="2365"><highlight class="normal"></highlight></codeline>
<codeline lineno="2366"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Apply<sp/>deterministic/debug<sp/>knobs<sp/>early<sp/>(before<sp/>engine<sp/>creation).<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2367"><highlight class="normal"><sp/><sp/><ref refid="main__infer_8c_1ac50de02cf90e21f66e0681932f39334f" kindref="member">apply_cli_debug_env</ref>(&amp;opt);</highlight></codeline>
<codeline lineno="2368"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*trace_path_env<sp/>=<sp/>getenv(</highlight><highlight class="stringliteral">&quot;IE_TRACE_IDS_JSONL&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="2369"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>trace_ids_enabled<sp/>=<sp/>(trace_path_env<sp/>&amp;&amp;<sp/>*trace_path_env)<sp/>?<sp/>1<sp/>:<sp/>0;</highlight></codeline>
<codeline lineno="2370"><highlight class="normal"></highlight></codeline>
<codeline lineno="2371"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Allow<sp/>env<sp/>override<sp/>for<sp/>print-text<sp/>without<sp/>breaking<sp/>harness<sp/>defaults.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2372"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!opt.<ref refid="structcli__extras_1a553c6e455b22c4ff3cd6f00beb166eb7" kindref="member">print_text</ref>)<sp/>opt.<ref refid="structcli__extras_1a553c6e455b22c4ff3cd6f00beb166eb7" kindref="member">print_text</ref><sp/>=<sp/>(int)<ref refid="main__infer_8c_1a9675b1f5b8b73e24233f92cb11e31f6a" kindref="member">env_long</ref>(</highlight><highlight class="stringliteral">&quot;IE_PRINT_TEXT&quot;</highlight><highlight class="normal">,<sp/>0);</highlight></codeline>
<codeline lineno="2373"><highlight class="normal"></highlight></codeline>
<codeline lineno="2374"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!opt.<ref refid="structcli__extras_1a50cd2ee771a9eee3fd448d2a1c0b5645" kindref="member">device</ref><sp/>||<sp/>!*opt.<ref refid="structcli__extras_1a50cd2ee771a9eee3fd448d2a1c0b5645" kindref="member">device</ref><sp/>||<sp/><ref refid="main__infer_8c_1a72ab94aafe7740f1343d317daa89ca15" kindref="member">ascii_ieq</ref>(opt.<ref refid="structcli__extras_1a50cd2ee771a9eee3fd448d2a1c0b5645" kindref="member">device</ref>,<sp/></highlight><highlight class="stringliteral">&quot;auto&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="2375"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*d<sp/>=<sp/>getenv(</highlight><highlight class="stringliteral">&quot;DEVICE&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="2376"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!d<sp/>||<sp/>!*d)<sp/>d<sp/>=<sp/>getenv(</highlight><highlight class="stringliteral">&quot;IE_DEVICE&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="2377"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(d<sp/>&amp;&amp;<sp/>*d)<sp/>opt.<ref refid="structcli__extras_1a50cd2ee771a9eee3fd448d2a1c0b5645" kindref="member">device</ref><sp/>=<sp/>d;</highlight></codeline>
<codeline lineno="2378"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="2379"><highlight class="normal"></highlight></codeline>
<codeline lineno="2380"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!opt.<ref refid="structcli__extras_1a49d7c958a59c223a1f66d6aedc796e68" kindref="member">precision_from_flag</ref>)<sp/>{</highlight></codeline>
<codeline lineno="2381"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*envp<sp/>=<sp/><ref refid="main__infer_8c_1a1da65df4642943745d356d6de2983f02" kindref="member">env_str</ref>(</highlight><highlight class="stringliteral">&quot;IE_PRECISION&quot;</highlight><highlight class="normal">,<sp/><ref refid="main__infer_8c_1a1da65df4642943745d356d6de2983f02" kindref="member">env_str</ref>(</highlight><highlight class="stringliteral">&quot;PRECISION&quot;</highlight><highlight class="normal">,<sp/>IE_PREC_FP32));</highlight></codeline>
<codeline lineno="2382"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1a72ab94aafe7740f1343d317daa89ca15" kindref="member">ascii_ieq</ref>(envp,<sp/>IE_PREC_INT4W))<sp/>opt.<ref refid="structcli__extras_1a061a8ed1f6671ad018d99db180df06c2" kindref="member">precision_label</ref><sp/>=<sp/>IE_PREC_INT4W;</highlight></codeline>
<codeline lineno="2383"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1a72ab94aafe7740f1343d317daa89ca15" kindref="member">ascii_ieq</ref>(envp,<sp/>IE_PREC_INT4))<sp/>opt.<ref refid="structcli__extras_1a061a8ed1f6671ad018d99db180df06c2" kindref="member">precision_label</ref><sp/>=<sp/>IE_PREC_INT4;</highlight></codeline>
<codeline lineno="2384"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1a72ab94aafe7740f1343d317daa89ca15" kindref="member">ascii_ieq</ref>(envp,<sp/>IE_PREC_INT8W))<sp/>opt.<ref refid="structcli__extras_1a061a8ed1f6671ad018d99db180df06c2" kindref="member">precision_label</ref><sp/>=<sp/>IE_PREC_INT8W;</highlight></codeline>
<codeline lineno="2385"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1a72ab94aafe7740f1343d317daa89ca15" kindref="member">ascii_ieq</ref>(envp,<sp/>IE_PREC_BF16))<sp/>opt.<ref refid="structcli__extras_1a061a8ed1f6671ad018d99db180df06c2" kindref="member">precision_label</ref><sp/>=<sp/>IE_PREC_BF16;</highlight></codeline>
<codeline lineno="2386"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1a72ab94aafe7740f1343d317daa89ca15" kindref="member">ascii_ieq</ref>(envp,<sp/>IE_PREC_FP16))<sp/>opt.<ref refid="structcli__extras_1a061a8ed1f6671ad018d99db180df06c2" kindref="member">precision_label</ref><sp/>=<sp/>IE_PREC_FP16;</highlight></codeline>
<codeline lineno="2387"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>opt.<ref refid="structcli__extras_1a061a8ed1f6671ad018d99db180df06c2" kindref="member">precision_label</ref><sp/>=<sp/>IE_PREC_FP32;</highlight></codeline>
<codeline lineno="2388"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="2389"><highlight class="normal"></highlight></codeline>
<codeline lineno="2390"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!opt.<ref refid="structcli__extras_1aeac7b5044a46ca251e3414887e1e712e" kindref="member">sparsity_from_flag</ref>)<sp/>{</highlight></codeline>
<codeline lineno="2391"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*envs<sp/>=<sp/><ref refid="main__infer_8c_1a1da65df4642943745d356d6de2983f02" kindref="member">env_str</ref>(</highlight><highlight class="stringliteral">&quot;IE_SPARSITY&quot;</highlight><highlight class="normal">,<sp/><ref refid="main__infer_8c_1a1da65df4642943745d356d6de2983f02" kindref="member">env_str</ref>(</highlight><highlight class="stringliteral">&quot;SPARSITY&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;none&quot;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="2392"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1a72ab94aafe7740f1343d317daa89ca15" kindref="member">ascii_ieq</ref>(envs,<sp/></highlight><highlight class="stringliteral">&quot;block&quot;</highlight><highlight class="normal">)<sp/>||<sp/><ref refid="main__infer_8c_1a72ab94aafe7740f1343d317daa89ca15" kindref="member">ascii_ieq</ref>(envs,<sp/></highlight><highlight class="stringliteral">&quot;blocksparse&quot;</highlight><highlight class="normal">))<sp/>opt.<ref refid="structcli__extras_1af5f02b3c69e6a0e4882a5427db0ab994" kindref="member">sparsity</ref><sp/>=<sp/></highlight><highlight class="stringliteral">&quot;block&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2393"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1a72ab94aafe7740f1343d317daa89ca15" kindref="member">ascii_ieq</ref>(envs,<sp/></highlight><highlight class="stringliteral">&quot;auto&quot;</highlight><highlight class="normal">))<sp/>opt.<ref refid="structcli__extras_1af5f02b3c69e6a0e4882a5427db0ab994" kindref="member">sparsity</ref><sp/>=<sp/></highlight><highlight class="stringliteral">&quot;auto&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2394"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>opt.<ref refid="structcli__extras_1af5f02b3c69e6a0e4882a5427db0ab994" kindref="member">sparsity</ref><sp/>=<sp/></highlight><highlight class="stringliteral">&quot;none&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2395"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="2396"><highlight class="normal"></highlight></codeline>
<codeline lineno="2397"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*model_dir_eff<sp/>=<sp/>opt.<ref refid="structcli__extras_1aa52e671b92aa5a9099153b609a0c5792" kindref="member">model_dir</ref>;</highlight></codeline>
<codeline lineno="2398"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!model_dir_eff<sp/>||<sp/>!*model_dir_eff)<sp/>model_dir_eff<sp/>=<sp/>getenv(</highlight><highlight class="stringliteral">&quot;MODEL_DIR&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="2399"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!model_dir_eff<sp/>||<sp/>!*model_dir_eff)<sp/>model_dir_eff<sp/>=<sp/>getenv(</highlight><highlight class="stringliteral">&quot;IE_MODEL_DIR&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="2400"><highlight class="normal"></highlight></codeline>
<codeline lineno="2401"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!model_dir_eff<sp/>||<sp/>!*model_dir_eff)<sp/>{</highlight></codeline>
<codeline lineno="2402"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1a0cbea455e9868581360f43c63db6554c" kindref="member">path_exists</ref>(</highlight><highlight class="stringliteral">&quot;models/gpt-oss-20b/model.ie.json&quot;</highlight><highlight class="normal">)<sp/>||</highlight></codeline>
<codeline lineno="2403"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="main__infer_8c_1a0cbea455e9868581360f43c63db6554c" kindref="member">path_exists</ref>(</highlight><highlight class="stringliteral">&quot;models/gpt-oss-20b/model.ie.bin&quot;</highlight><highlight class="normal">)<sp/>||</highlight></codeline>
<codeline lineno="2404"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="main__infer_8c_1a0cbea455e9868581360f43c63db6554c" kindref="member">path_exists</ref>(</highlight><highlight class="stringliteral">&quot;models/gpt-oss-20b/model.ie.compat.json&quot;</highlight><highlight class="normal">)<sp/>||</highlight></codeline>
<codeline lineno="2405"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="main__infer_8c_1a0cbea455e9868581360f43c63db6554c" kindref="member">path_exists</ref>(</highlight><highlight class="stringliteral">&quot;models/gpt-oss-20b/model.q4.bin&quot;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="2406"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>model_dir_eff<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;models/gpt-oss-20b&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2407"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="2408"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>model_dir_eff<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;.&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2409"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2410"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="2411"><highlight class="normal"></highlight></codeline>
<codeline lineno="2412"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(opt.<ref refid="structcli__extras_1aa52e671b92aa5a9099153b609a0c5792" kindref="member">model_dir</ref><sp/>&amp;&amp;<sp/>*opt.<ref refid="structcli__extras_1aa52e671b92aa5a9099153b609a0c5792" kindref="member">model_dir</ref>)<sp/>{</highlight></codeline>
<codeline lineno="2413"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="main__infer_8c_1a2392f4f2060045de53b484a90f85f15f" kindref="member">dir_accessible</ref>(opt.<ref refid="structcli__extras_1aa52e671b92aa5a9099153b609a0c5792" kindref="member">model_dir</ref>))<sp/>{</highlight></codeline>
<codeline lineno="2414"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;error:<sp/>--model-dir<sp/>&apos;%s&apos;<sp/>is<sp/>not<sp/>accessible:<sp/>%s\n&quot;</highlight><highlight class="normal">,<sp/>opt.<ref refid="structcli__extras_1aa52e671b92aa5a9099153b609a0c5792" kindref="member">model_dir</ref>,<sp/>strerror(errno));</highlight></codeline>
<codeline lineno="2415"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="main__infer_8c_1a84b40472513bc66398c6d3049891f553" kindref="member">print_json_result</ref>(0,<sp/>NULL,<sp/>0.0,<sp/>0.0,<sp/>0.0,<sp/>0,<sp/>0,<sp/>0,<sp/>NULL,<sp/>NULL,<sp/>opt.<ref refid="structcli__extras_1a3b9c2202e0ba68aa4b3112779697a28e" kindref="member">expected_tokens_file</ref>,<sp/>NULL,<sp/>1,<sp/>NULL);</highlight></codeline>
<codeline lineno="2416"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>3;</highlight></codeline>
<codeline lineno="2417"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2418"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="2419"><highlight class="normal"></highlight></codeline>
<codeline lineno="2420"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>json_path[<ref refid="main__infer_8c_1ae688d728e1acdfe5988c7db45d6f0166" kindref="member">PATH_MAX</ref>];</highlight></codeline>
<codeline lineno="2421"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>bin_path[<ref refid="main__infer_8c_1ae688d728e1acdfe5988c7db45d6f0166" kindref="member">PATH_MAX</ref>];</highlight></codeline>
<codeline lineno="2422"><highlight class="normal"><sp/><sp/><ref refid="main__infer_8c_1ad6b894571e18a35f21d8451e008fae37" kindref="member">resolve_model_paths</ref>(model_dir_eff,</highlight></codeline>
<codeline lineno="2423"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>opt.<ref refid="structcli__extras_1a96d26a6a2f436fb0b232d383f321c3e6" kindref="member">model_json</ref>,</highlight></codeline>
<codeline lineno="2424"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>opt.<ref refid="structcli__extras_1ae2401ceced12a603aabefd22f57584bd" kindref="member">model_bin</ref>,</highlight></codeline>
<codeline lineno="2425"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>opt.<ref refid="structcli__extras_1a061a8ed1f6671ad018d99db180df06c2" kindref="member">precision_label</ref>,</highlight></codeline>
<codeline lineno="2426"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>json_path,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(json_path),</highlight></codeline>
<codeline lineno="2427"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bin_path,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(bin_path));</highlight></codeline>
<codeline lineno="2428"><highlight class="normal"></highlight></codeline>
<codeline lineno="2429"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>When<sp/>a<sp/>prompts<sp/>file<sp/>is<sp/>provided<sp/>and<sp/>no<sp/>explicit<sp/>prompt<sp/>is<sp/>set,<sp/>default<sp/>to<sp/>aggregate<sp/>mode.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2430"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(opt.<ref refid="structcli__extras_1a992ba8185b17f227f60e2e570441b63f" kindref="member">prompts_file</ref><sp/>&amp;&amp;<sp/>*opt.<ref refid="structcli__extras_1a992ba8185b17f227f60e2e570441b63f" kindref="member">prompts_file</ref><sp/>&amp;&amp;<sp/>!opt.<ref refid="structcli__extras_1aa45c7376781454d767d2202800c27a3e" kindref="member">prompt</ref>)<sp/>opt.<ref refid="structcli__extras_1a4e233e0c7d76b4fb4338d7460a552707" kindref="member">aggregate</ref><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="2431"><highlight class="normal"></highlight></codeline>
<codeline lineno="2432"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!opt.<ref refid="structcli__extras_1aa45c7376781454d767d2202800c27a3e" kindref="member">prompt</ref><sp/>&amp;&amp;<sp/>!opt.<ref refid="structcli__extras_1a992ba8185b17f227f60e2e570441b63f" kindref="member">prompts_file</ref>)<sp/>{</highlight></codeline>
<codeline lineno="2433"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="main__infer_8c_1a84b40472513bc66398c6d3049891f553" kindref="member">print_json_result</ref>(0,<sp/>NULL,<sp/>0.0,<sp/>0.0,<sp/>0.0,<sp/>0,<sp/>0,<sp/>0,<sp/>NULL,<sp/>NULL,<sp/>opt.<ref refid="structcli__extras_1a3b9c2202e0ba68aa4b3112779697a28e" kindref="member">expected_tokens_file</ref>,<sp/>NULL,<sp/>1,<sp/>NULL);</highlight></codeline>
<codeline lineno="2434"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="2435"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="2436"><highlight class="normal"></highlight></codeline>
<codeline lineno="2437"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Resolve<sp/>tokenizer<sp/>path<sp/>once<sp/>(CLI<sp/>+<sp/>engine<sp/>should<sp/>use<sp/>the<sp/>same<sp/>choice).<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2438"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*tok_env<sp/>=<sp/><ref refid="main__infer_8c_1a1da65df4642943745d356d6de2983f02" kindref="member">env_str</ref>(</highlight><highlight class="stringliteral">&quot;IE_TOKENIZER&quot;</highlight><highlight class="normal">,<sp/><ref refid="main__infer_8c_1a1da65df4642943745d356d6de2983f02" kindref="member">env_str</ref>(</highlight><highlight class="stringliteral">&quot;TOKENIZER&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="2439"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*tok_opt<sp/>=<sp/>(opt.<ref refid="structcli__extras_1af46939020f3ada099f4c932676dec6b7" kindref="member">tokenizer_path</ref><sp/>&amp;&amp;<sp/>*opt.<ref refid="structcli__extras_1af46939020f3ada099f4c932676dec6b7" kindref="member">tokenizer_path</ref>)<sp/>?<sp/>opt.<ref refid="structcli__extras_1af46939020f3ada099f4c932676dec6b7" kindref="member">tokenizer_path</ref></highlight></codeline>
<codeline lineno="2440"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:<sp/>((tok_env<sp/>&amp;&amp;<sp/>*tok_env)<sp/>?<sp/>tok_env<sp/>:<sp/>NULL);</highlight></codeline>
<codeline lineno="2441"><highlight class="normal"></highlight></codeline>
<codeline lineno="2442"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>tok_path_buf[<ref refid="main__infer_8c_1ae688d728e1acdfe5988c7db45d6f0166" kindref="member">PATH_MAX</ref>];</highlight></codeline>
<codeline lineno="2443"><highlight class="normal"><sp/><sp/>tok_path_buf[0]<sp/>=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2444"><highlight class="normal"><sp/><sp/><ref refid="main__infer_8c_1a0271a21f39c53534b7a1a3cc7eb94596" kindref="member">resolve_tokenizer_path</ref>(model_dir_eff,<sp/>tok_opt,<sp/>tok_path_buf,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(tok_path_buf));</highlight></codeline>
<codeline lineno="2445"><highlight class="normal"></highlight></codeline>
<codeline lineno="2446"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*tokenizer_path_heap<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="2447"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(tok_path_buf[0])<sp/>tokenizer_path_heap<sp/>=<sp/><ref refid="main__infer_8c_1a39103ce72021a890c3e333b949068a1c" kindref="member">heap_strdup</ref>(tok_path_buf);</highlight></codeline>
<codeline lineno="2448"><highlight class="normal"></highlight></codeline>
<codeline lineno="2449"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>require_model<sp/>=<sp/>(int)<ref refid="main__infer_8c_1a9675b1f5b8b73e24233f92cb11e31f6a" kindref="member">env_long</ref>(</highlight><highlight class="stringliteral">&quot;IE_REQUIRE_MODEL&quot;</highlight><highlight class="normal">,<sp/>0);</highlight></codeline>
<codeline lineno="2450"><highlight class="normal"></highlight></codeline>
<codeline lineno="2451"><highlight class="normal"><sp/><sp/><ref refid="structie__weights__s" kindref="compound">ie_weights_t</ref><sp/>w;</highlight></codeline>
<codeline lineno="2452"><highlight class="normal"><sp/><sp/>memset(&amp;w,<sp/>0,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(w));</highlight></codeline>
<codeline lineno="2453"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>wrc<sp/>=<sp/><ref refid="ie__io_8h_1a522dac028ee37aae1307ffdb6d65ec1d" kindref="member">ie_weights_open</ref>(json_path,<sp/>bin_path,<sp/>&amp;w);</highlight></codeline>
<codeline lineno="2454"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(wrc<sp/>!=<sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d" kindref="member">IE_IO_OK</ref>)<sp/>{</highlight></codeline>
<codeline lineno="2455"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(require_model)<sp/>{</highlight></codeline>
<codeline lineno="2456"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,</highlight></codeline>
<codeline lineno="2457"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;error:<sp/>failed<sp/>to<sp/>open<sp/>model<sp/>(%s,<sp/>%s),<sp/>status=%d,<sp/>errno=%d<sp/>(%s)\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="2458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>json_path,<sp/>bin_path,<sp/>wrc,<sp/>errno,<sp/>strerror(errno));</highlight></codeline>
<codeline lineno="2459"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="main__infer_8c_1a84b40472513bc66398c6d3049891f553" kindref="member">print_json_result</ref>(0,<sp/>NULL,<sp/>0.0,<sp/>0.0,<sp/>0.0,<sp/>0,<sp/>0,<sp/>0,<sp/>NULL,<sp/>tokenizer_path_heap,<sp/>opt.<ref refid="structcli__extras_1a3b9c2202e0ba68aa4b3112779697a28e" kindref="member">expected_tokens_file</ref>,<sp/>NULL,<sp/>1,<sp/>NULL);</highlight></codeline>
<codeline lineno="2460"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>free(tokenizer_path_heap);</highlight></codeline>
<codeline lineno="2461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>3;</highlight></codeline>
<codeline lineno="2462"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2463"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;warn:<sp/>model<sp/>metadata<sp/>not<sp/>found;<sp/>stub<sp/>JSON<sp/>output\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="2464"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="main__infer_8c_1a84b40472513bc66398c6d3049891f553" kindref="member">print_json_result</ref>(0,<sp/>NULL,<sp/>0.0,<sp/>0.0,<sp/>0.0,<sp/>0,<sp/>0,<sp/>0,<sp/>NULL,<sp/>tokenizer_path_heap,<sp/>opt.<ref refid="structcli__extras_1a3b9c2202e0ba68aa4b3112779697a28e" kindref="member">expected_tokens_file</ref>,<sp/>NULL,<sp/>1,<sp/>NULL);</highlight></codeline>
<codeline lineno="2465"><highlight class="normal"><sp/><sp/><sp/><sp/>free(tokenizer_path_heap);</highlight></codeline>
<codeline lineno="2466"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="2467"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="2468"><highlight class="normal"></highlight></codeline>
<codeline lineno="2469"><highlight class="normal"><sp/><sp/><ref refid="structie__engine__params" kindref="compound">ie_engine_params_t</ref><sp/>params;</highlight></codeline>
<codeline lineno="2470"><highlight class="normal"><sp/><sp/>memset(&amp;params,<sp/>0,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(params));</highlight></codeline>
<codeline lineno="2471"><highlight class="normal"><sp/><sp/>params.<ref refid="structie__engine__params_1a92b02bad12cb4e8173728311c00960b7" kindref="member">precision</ref><sp/>=<sp/>opt.<ref refid="structcli__extras_1a061a8ed1f6671ad018d99db180df06c2" kindref="member">precision_label</ref>;</highlight></codeline>
<codeline lineno="2472"><highlight class="normal"><sp/><sp/>params.<ref refid="structie__engine__params_1a66599574f8a4b8ed7cd7132fc1c0e051" kindref="member">affinity</ref><sp/>=<sp/>opt.<ref refid="structcli__extras_1a313d0562dfb63a6350db5c84128fc074" kindref="member">affinity</ref>;</highlight></codeline>
<codeline lineno="2473"><highlight class="normal"><sp/><sp/>params.<ref refid="structie__engine__params_1a992270ba61612b2acb319aed5cbfca13" kindref="member">pretranspose</ref><sp/>=<sp/>(opt.<ref refid="structcli__extras_1a648dda8436ede182650f29f0460fa6a3" kindref="member">pretx</ref><sp/>==<sp/><ref refid="main__infer_8c_1ae715f0cc745f58eebd4be50b187dd41da382ceb68dddaaf8b27ac21f144305e74" kindref="member">CLI_PRETX_NONE</ref><sp/>?<sp/></highlight><highlight class="stringliteral">&quot;none&quot;</highlight><highlight class="normal"><sp/>:</highlight></codeline>
<codeline lineno="2474"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(opt.<ref refid="structcli__extras_1a648dda8436ede182650f29f0460fa6a3" kindref="member">pretx</ref><sp/>==<sp/><ref refid="main__infer_8c_1ae715f0cc745f58eebd4be50b187dd41da9d22d4f265254a65af9fc3a7d648fe5d" kindref="member">CLI_PRETX_WOH</ref><sp/>?<sp/></highlight><highlight class="stringliteral">&quot;woh&quot;</highlight><highlight class="normal"><sp/>:</highlight></codeline>
<codeline lineno="2475"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(opt.<ref refid="structcli__extras_1a648dda8436ede182650f29f0460fa6a3" kindref="member">pretx</ref><sp/>==<sp/><ref refid="main__infer_8c_1ae715f0cc745f58eebd4be50b187dd41da1a251ee24fdcadcaf9c888e0a96140e7" kindref="member">CLI_PRETX_WXH</ref><sp/>?<sp/></highlight><highlight class="stringliteral">&quot;wxh&quot;</highlight><highlight class="normal"><sp/>:<sp/></highlight><highlight class="stringliteral">&quot;all&quot;</highlight><highlight class="normal">)));</highlight></codeline>
<codeline lineno="2476"><highlight class="normal"><sp/><sp/>params.<ref refid="structie__engine__params_1a34f965300425f8c1115b2408a4adc04a" kindref="member">prefetch</ref><sp/>=<sp/>opt.<ref refid="structcli__extras_1a01be4e3c92d754527967d04b729e4ee6" kindref="member">prefetch</ref>;</highlight></codeline>
<codeline lineno="2477"><highlight class="normal"><sp/><sp/>params.<ref refid="structie__engine__params_1a0c0b5f7588c98d30e0d2535790f6f24c" kindref="member">threads</ref><sp/>=<sp/>opt.<ref refid="structcli__extras_1a4e8cdca32127b81f8fcb41047a320844" kindref="member">threads</ref>;</highlight></codeline>
<codeline lineno="2478"><highlight class="normal"><sp/><sp/>params.<ref refid="structie__engine__params_1a1dff4c9644aa8bf7e389f84426c529e1" kindref="member">sparsity</ref><sp/>=<sp/>opt.<ref refid="structcli__extras_1af5f02b3c69e6a0e4882a5427db0ab994" kindref="member">sparsity</ref>;</highlight></codeline>
<codeline lineno="2479"><highlight class="normal"></highlight></codeline>
<codeline lineno="2480"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Unified<sp/>tokenizer<sp/>choice:<sp/>engine<sp/>should<sp/>follow<sp/>the<sp/>same<sp/>resolution<sp/>as<sp/>the<sp/>CLI.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2481"><highlight class="normal"><sp/><sp/>params.<ref refid="structie__engine__params_1a16a831d93768c1a6d392163596de8277" kindref="member">tokenizer_path</ref><sp/>=<sp/>tokenizer_path_heap;</highlight></codeline>
<codeline lineno="2482"><highlight class="normal"></highlight></codeline>
<codeline lineno="2483"><highlight class="normal"><sp/><sp/><ref refid="structie__engine" kindref="compound">ie_engine_t</ref><sp/>*engine<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="2484"><highlight class="normal"><sp/><sp/><ref refid="ie__api_8h_1a14516a42606ffcc6fafaf4eba282c808" kindref="member">ie_status_t</ref><sp/>st<sp/>=<sp/><ref refid="ie__api_8h_1a84bd87043352946e9d53b0f8a5c4abe0" kindref="member">ie_engine_create</ref>(&amp;params,<sp/>opt.<ref refid="structcli__extras_1a50cd2ee771a9eee3fd448d2a1c0b5645" kindref="member">device</ref>,<sp/>model_dir_eff,<sp/>&amp;engine);</highlight></codeline>
<codeline lineno="2485"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(st<sp/>!=<sp/><ref refid="ie__api_8h_1aad1f6716972d7c4560daae2edb134d6aad0e6665e4f13d22e40740ef4ab91d56e" kindref="member">IE_OK</ref><sp/>||<sp/>!engine)<sp/>{</highlight></codeline>
<codeline lineno="2486"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;error:<sp/>ie_engine_create<sp/>failed<sp/>(status=%d)\n&quot;</highlight><highlight class="normal">,<sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)st);</highlight></codeline>
<codeline lineno="2487"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ie__io_8h_1a06c2b7e35d1f82a11e4605e23a1976f5" kindref="member">ie_weights_close</ref>(&amp;w);</highlight></codeline>
<codeline lineno="2488"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="main__infer_8c_1a84b40472513bc66398c6d3049891f553" kindref="member">print_json_result</ref>(0,<sp/>NULL,<sp/>0.0,<sp/>0.0,<sp/>0.0,<sp/>0,<sp/>0,<sp/>0,<sp/>NULL,<sp/>tokenizer_path_heap,<sp/>opt.<ref refid="structcli__extras_1a3b9c2202e0ba68aa4b3112779697a28e" kindref="member">expected_tokens_file</ref>,<sp/>NULL,<sp/>1,<sp/>NULL);</highlight></codeline>
<codeline lineno="2489"><highlight class="normal"><sp/><sp/><sp/><sp/>free(tokenizer_path_heap);</highlight></codeline>
<codeline lineno="2490"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>5;</highlight></codeline>
<codeline lineno="2491"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="2492"><highlight class="normal"></highlight></codeline>
<codeline lineno="2493"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(opt.<ref refid="structcli__extras_1a628bf363ee35fe852bbb6510455647bd" kindref="member">warmup_tokens</ref><sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="2494"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(trace_ids_enabled)<sp/>{</highlight></codeline>
<codeline lineno="2495"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>(void)unsetenv(</highlight><highlight class="stringliteral">&quot;IE_TRACE_PROMPT_INDEX&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="2496"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2497"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*wprompt<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;warmup&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2498"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>wtoks[128];</highlight></codeline>
<codeline lineno="2499"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>wcount<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="2500"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>wmax<sp/>=<sp/>(opt.<ref refid="structcli__extras_1a628bf363ee35fe852bbb6510455647bd" kindref="member">warmup_tokens</ref><sp/>&lt;=<sp/>(int)(</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(wtoks)<sp/>/<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(wtoks[0])))</highlight></codeline>
<codeline lineno="2501"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>?<sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal">)opt.<ref refid="structcli__extras_1a628bf363ee35fe852bbb6510455647bd" kindref="member">warmup_tokens</ref></highlight></codeline>
<codeline lineno="2502"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:<sp/>(</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(wtoks)<sp/>/<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(wtoks[0]));</highlight></codeline>
<codeline lineno="2503"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)<ref refid="ie__api_8h_1ad32cf2cd209832e4cd577a5a1e31970f" kindref="member">ie_engine_generate</ref>(engine,<sp/>wprompt,<sp/>wmax,<sp/>wtoks,<sp/>&amp;wcount);</highlight></codeline>
<codeline lineno="2504"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="2505"><highlight class="normal"></highlight></codeline>
<codeline lineno="2506"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>cap<sp/>=<sp/>(opt.<ref refid="structcli__extras_1a5eb0317aa09b90f400b657245b41e92c" kindref="member">max_new</ref><sp/>&gt;<sp/>0<sp/>?<sp/>opt.<ref refid="structcli__extras_1a5eb0317aa09b90f400b657245b41e92c" kindref="member">max_new</ref><sp/>:<sp/>0);</highlight></codeline>
<codeline lineno="2507"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>cap_alloc<sp/>=<sp/>(cap<sp/>&gt;<sp/>0<sp/>?<sp/>cap<sp/>:<sp/>1);</highlight></codeline>
<codeline lineno="2508"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*tokens<sp/>=<sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*)malloc(</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)<sp/>*<sp/>cap_alloc);</highlight></codeline>
<codeline lineno="2509"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!tokens)<sp/>{</highlight></codeline>
<codeline lineno="2510"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;error:<sp/>OOM<sp/>allocating<sp/>token<sp/>buffer\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="2511"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ie__api_8h_1a5a9a30f05ef6183f6a75811c616b3a0a" kindref="member">ie_engine_destroy</ref>(engine);</highlight></codeline>
<codeline lineno="2512"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ie__io_8h_1a06c2b7e35d1f82a11e4605e23a1976f5" kindref="member">ie_weights_close</ref>(&amp;w);</highlight></codeline>
<codeline lineno="2513"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="main__infer_8c_1a84b40472513bc66398c6d3049891f553" kindref="member">print_json_result</ref>(0,<sp/>NULL,<sp/>0.0,<sp/>0.0,<sp/>0.0,<sp/>0,<sp/>0,<sp/>0,<sp/>NULL,<sp/>tokenizer_path_heap,<sp/>opt.<ref refid="structcli__extras_1a3b9c2202e0ba68aa4b3112779697a28e" kindref="member">expected_tokens_file</ref>,<sp/>NULL,<sp/>1,<sp/>NULL);</highlight></codeline>
<codeline lineno="2514"><highlight class="normal"><sp/><sp/><sp/><sp/>free(tokenizer_path_heap);</highlight></codeline>
<codeline lineno="2515"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>6;</highlight></codeline>
<codeline lineno="2516"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="2517"><highlight class="normal"></highlight></codeline>
<codeline lineno="2518"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>bytes_per_token<sp/>=<sp/>(size_t)<ref refid="main__infer_8c_1a9675b1f5b8b73e24233f92cb11e31f6a" kindref="member">env_long</ref>(</highlight><highlight class="stringliteral">&quot;IE_BYTES_PER_TOKEN&quot;</highlight><highlight class="normal">,<sp/>0);</highlight></codeline>
<codeline lineno="2519"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>stride_bytes<sp/>=<sp/>(size_t)<ref refid="main__infer_8c_1a9675b1f5b8b73e24233f92cb11e31f6a" kindref="member">env_long</ref>(</highlight><highlight class="stringliteral">&quot;IE_STRIDE_BYTES&quot;</highlight><highlight class="normal">,<sp/>256);</highlight></codeline>
<codeline lineno="2520"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>verify_touch<sp/>=<sp/>(int)<ref refid="main__infer_8c_1a9675b1f5b8b73e24233f92cb11e31f6a" kindref="member">env_long</ref>(</highlight><highlight class="stringliteral">&quot;IE_VERIFY_TOUCH&quot;</highlight><highlight class="normal">,<sp/>0);</highlight></codeline>
<codeline lineno="2521"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>want_cuda<sp/>=<sp/><ref refid="main__infer_8c_1a43b384fdf1f1e4cc7304e6164461af44" kindref="member">device_is_cuda</ref>(opt.<ref refid="structcli__extras_1a50cd2ee771a9eee3fd448d2a1c0b5645" kindref="member">device</ref>)<sp/>?<sp/>1<sp/>:<sp/>0;</highlight></codeline>
<codeline lineno="2522"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>want_cpu<sp/>=<sp/><ref refid="main__infer_8c_1ae26c03bc6150b42f62a01df020935733" kindref="member">device_is_cpu</ref>(opt.<ref refid="structcli__extras_1a50cd2ee771a9eee3fd448d2a1c0b5645" kindref="member">device</ref>)<sp/>?<sp/>1<sp/>:<sp/>0;</highlight></codeline>
<codeline lineno="2523"><highlight class="normal"></highlight></codeline>
<codeline lineno="2524"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Preload<sp/>prompts<sp/>so<sp/>file<sp/>I/O<sp/>is<sp/>outside<sp/>the<sp/>timed<sp/>window.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2525"><highlight class="normal"><sp/><sp/><ref refid="structprompt__list" kindref="compound">prompt_list_t</ref><sp/>prompts;</highlight></codeline>
<codeline lineno="2526"><highlight class="normal"><sp/><sp/><ref refid="main__infer_8c_1a9891db61dca3c60715c6b2f7aad7f5a1" kindref="member">prompt_list_init</ref>(&amp;prompts);</highlight></codeline>
<codeline lineno="2527"><highlight class="normal"></highlight></codeline>
<codeline lineno="2528"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(opt.<ref refid="structcli__extras_1a992ba8185b17f227f60e2e570441b63f" kindref="member">prompts_file</ref><sp/>&amp;&amp;<sp/>*opt.<ref refid="structcli__extras_1a992ba8185b17f227f60e2e570441b63f" kindref="member">prompts_file</ref><sp/>&amp;&amp;<sp/>opt.<ref refid="structcli__extras_1a4e233e0c7d76b4fb4338d7460a552707" kindref="member">aggregate</ref>)<sp/>{</highlight></codeline>
<codeline lineno="2529"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)<ref refid="main__infer_8c_1a3d826199fc8a9ddb8a49f324c2ff1dc5" kindref="member">prompt_list_read_file</ref>(opt.<ref refid="structcli__extras_1a992ba8185b17f227f60e2e570441b63f" kindref="member">prompts_file</ref>,<sp/>&amp;prompts);</highlight></codeline>
<codeline lineno="2530"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="2531"><highlight class="normal"></highlight></codeline>
<codeline lineno="2532"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(prompts.<ref refid="structprompt__list_1ab60c60299e5806652f4c2c7a94aca5c3" kindref="member">count</ref><sp/>==<sp/>0<sp/>&amp;&amp;<sp/>opt.<ref refid="structcli__extras_1aa45c7376781454d767d2202800c27a3e" kindref="member">prompt</ref>)<sp/>{</highlight></codeline>
<codeline lineno="2533"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)<ref refid="main__infer_8c_1a9be857b0051297813c2cb218accbb5c8" kindref="member">prompt_list_push_copy</ref>(&amp;prompts,<sp/>opt.<ref refid="structcli__extras_1aa45c7376781454d767d2202800c27a3e" kindref="member">prompt</ref>);</highlight></codeline>
<codeline lineno="2534"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="2535"><highlight class="normal"></highlight></codeline>
<codeline lineno="2536"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(prompts.<ref refid="structprompt__list_1ab60c60299e5806652f4c2c7a94aca5c3" kindref="member">count</ref><sp/>==<sp/>0<sp/>&amp;&amp;<sp/>opt.<ref refid="structcli__extras_1a992ba8185b17f227f60e2e570441b63f" kindref="member">prompts_file</ref><sp/>&amp;&amp;<sp/>*opt.<ref refid="structcli__extras_1a992ba8185b17f227f60e2e570441b63f" kindref="member">prompts_file</ref><sp/>&amp;&amp;<sp/>!opt.<ref refid="structcli__extras_1a4e233e0c7d76b4fb4338d7460a552707" kindref="member">aggregate</ref>)<sp/>{</highlight></codeline>
<codeline lineno="2537"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Legacy<sp/>compatibility:<sp/>if<sp/>the<sp/>user<sp/>explicitly<sp/>disabled<sp/>aggregate,<sp/>run<sp/>first<sp/>line<sp/>only.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2538"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>first[8192];</highlight></codeline>
<codeline lineno="2539"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>r<sp/>=<sp/><ref refid="main__infer_8c_1a609fc6d778b714530dadf2ef012acf5c" kindref="member">read_first_nonempty_line</ref>(opt.<ref refid="structcli__extras_1a992ba8185b17f227f60e2e570441b63f" kindref="member">prompts_file</ref>,<sp/>first,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(first));</highlight></codeline>
<codeline lineno="2540"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(r<sp/>==<sp/>1)<sp/>(void)<ref refid="main__infer_8c_1a9be857b0051297813c2cb218accbb5c8" kindref="member">prompt_list_push_copy</ref>(&amp;prompts,<sp/>first);</highlight></codeline>
<codeline lineno="2541"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="2542"><highlight class="normal"></highlight></codeline>
<codeline lineno="2543"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(prompts.<ref refid="structprompt__list_1ab60c60299e5806652f4c2c7a94aca5c3" kindref="member">count</ref><sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="2544"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Keep<sp/>behavior<sp/>predictable<sp/>even<sp/>with<sp/>empty/unreadable<sp/>prompt<sp/>files.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2545"><highlight class="normal"><sp/><sp/><sp/><sp/>(void)<ref refid="main__infer_8c_1a9be857b0051297813c2cb218accbb5c8" kindref="member">prompt_list_push_copy</ref>(&amp;prompts,<sp/></highlight><highlight class="stringliteral">&quot;bench&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="2546"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="2547"><highlight class="normal"></highlight></codeline>
<codeline lineno="2548"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Load<sp/>expected<sp/>tokens<sp/>table<sp/>(optional).<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2549"><highlight class="normal"><sp/><sp/><ref refid="structexpected__tokens__table" kindref="compound">expected_tokens_table_t</ref><sp/>expected;</highlight></codeline>
<codeline lineno="2550"><highlight class="normal"><sp/><sp/><ref refid="main__infer_8c_1a7170af3ba79ee074b29ac13736ec97bf" kindref="member">expected_tokens_table_init</ref>(&amp;expected);</highlight></codeline>
<codeline lineno="2551"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>expected_loaded<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="2552"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(opt.<ref refid="structcli__extras_1a3b9c2202e0ba68aa4b3112779697a28e" kindref="member">expected_tokens_file</ref><sp/>&amp;&amp;<sp/>*opt.<ref refid="structcli__extras_1a3b9c2202e0ba68aa4b3112779697a28e" kindref="member">expected_tokens_file</ref>)<sp/>{</highlight></codeline>
<codeline lineno="2553"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1a84acee847ca644179eff86e6406bf230" kindref="member">expected_tokens_table_load</ref>(opt.<ref refid="structcli__extras_1a3b9c2202e0ba68aa4b3112779697a28e" kindref="member">expected_tokens_file</ref>,<sp/>&amp;expected)<sp/>==<sp/>0)<sp/>expected_loaded<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="2554"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;warn:<sp/>expected<sp/>tokens<sp/>file<sp/>could<sp/>not<sp/>be<sp/>loaded<sp/>(continuing)\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="2555"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="2556"><highlight class="normal"></highlight></codeline>
<codeline lineno="2557"><highlight class="normal"><sp/><sp/><ref refid="structmodel__mmap__touch" kindref="compound">model_mmap_touch_t</ref><sp/>mt;</highlight></codeline>
<codeline lineno="2558"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>mt_ok<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="2559"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(want_cpu<sp/>&amp;&amp;<sp/>verify_touch<sp/>&amp;&amp;<sp/>bytes_per_token<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="2560"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1ac67780918b483167f77ec879306c781c" kindref="member">model_touch_open</ref>(&amp;mt,<sp/>bin_path)<sp/>==<sp/>0)<sp/>mt_ok<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="2561"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="2562"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;warn:<sp/>strict<sp/>CPU<sp/>model<sp/>mmap<sp/>failed<sp/>(will<sp/>proceed<sp/>without<sp/>file-backed<sp/>touch)\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="2563"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>mt_ok<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="2564"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2565"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="2566"><highlight class="normal"></highlight></codeline>
<codeline lineno="2567"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Preload<sp/>cudart<sp/>(dlopen/dlsym)<sp/>outside<sp/>the<sp/>timed<sp/>window<sp/>to<sp/>avoid<sp/>setup<sp/>overhead.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2568"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(want_cuda<sp/>&amp;&amp;<sp/>verify_touch<sp/>&amp;&amp;<sp/>bytes_per_token<sp/>&gt;<sp/>0)<sp/>(void)<ref refid="main__infer_8c_1aca4f099fbc130845b4af6c57ca21b3ef" kindref="member">cudart_get_api</ref>();</highlight></codeline>
<codeline lineno="2569"><highlight class="normal"></highlight></codeline>
<codeline lineno="2570"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>rounds<sp/>=<sp/>(opt.<ref refid="structcli__extras_1a8c1b8fdbf9dc75a774e8b451608c961b" kindref="member">rounds</ref><sp/>&gt;<sp/>0<sp/>?<sp/>opt.<ref refid="structcli__extras_1a8c1b8fdbf9dc75a774e8b451608c961b" kindref="member">rounds</ref><sp/>:<sp/>1);</highlight></codeline>
<codeline lineno="2571"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n_prompts<sp/>=<sp/>prompts.<ref refid="structprompt__list_1ab60c60299e5806652f4c2c7a94aca5c3" kindref="member">count</ref>;</highlight></codeline>
<codeline lineno="2572"><highlight class="normal"></highlight></codeline>
<codeline lineno="2573"><highlight class="normal"><sp/><sp/><ref refid="structprompt__round__record" kindref="compound">prompt_round_record_t</ref><sp/>*recs<sp/>=<sp/>(<ref refid="structprompt__round__record" kindref="compound">prompt_round_record_t</ref><sp/>*)calloc((</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal">)rounds<sp/>*<sp/>n_prompts,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(*recs));</highlight></codeline>
<codeline lineno="2574"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!recs)<sp/>{</highlight></codeline>
<codeline lineno="2575"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;error:<sp/>OOM<sp/>allocating<sp/>report<sp/>records\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="2576"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(mt_ok)<sp/><ref refid="main__infer_8c_1a6d67a99243e339c4acabd9ed9b84002c" kindref="member">model_touch_close</ref>(&amp;mt);</highlight></codeline>
<codeline lineno="2577"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="main__infer_8c_1a470ca5b37dd720b5de391932c452af36" kindref="member">expected_tokens_table_free</ref>(&amp;expected);</highlight></codeline>
<codeline lineno="2578"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="main__infer_8c_1ab06a46b9f23d08de776ec7d3258b6588" kindref="member">prompt_list_free</ref>(&amp;prompts);</highlight></codeline>
<codeline lineno="2579"><highlight class="normal"><sp/><sp/><sp/><sp/>free(tokens);</highlight></codeline>
<codeline lineno="2580"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ie__api_8h_1a5a9a30f05ef6183f6a75811c616b3a0a" kindref="member">ie_engine_destroy</ref>(engine);</highlight></codeline>
<codeline lineno="2581"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="ie__io_8h_1a06c2b7e35d1f82a11e4605e23a1976f5" kindref="member">ie_weights_close</ref>(&amp;w);</highlight></codeline>
<codeline lineno="2582"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="main__infer_8c_1a84b40472513bc66398c6d3049891f553" kindref="member">print_json_result</ref>(0,<sp/>NULL,<sp/>0.0,<sp/>0.0,<sp/>0.0,<sp/>0,<sp/>0,<sp/><ref refid="main__infer_8c_1a0d90177eef91d08c3d9a38fb00df3e62" kindref="member">rss_peak_mib</ref>(),<sp/>NULL,<sp/>tokenizer_path_heap,<sp/>opt.<ref refid="structcli__extras_1a3b9c2202e0ba68aa4b3112779697a28e" kindref="member">expected_tokens_file</ref>,<sp/>NULL,<sp/>rounds,<sp/>NULL);</highlight></codeline>
<codeline lineno="2583"><highlight class="normal"><sp/><sp/><sp/><sp/>free(tokenizer_path_heap);</highlight></codeline>
<codeline lineno="2584"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>7;</highlight></codeline>
<codeline lineno="2585"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="2586"><highlight class="normal"></highlight></codeline>
<codeline lineno="2587"><highlight class="normal"><sp/><sp/>(void)<ref refid="ie__kv__instrumentation_8h_1a0a8ac6ff4fa3502470774c6cb9e6f488" kindref="member">ie_kv_begin_round</ref>();</highlight></codeline>
<codeline lineno="2588"><highlight class="normal"><sp/><sp/>uint64_t<sp/>total_tokens_this_round<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="2589"><highlight class="normal"></highlight></codeline>
<codeline lineno="2590"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>tokens_generated_total<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="2591"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>prefill_s_total<sp/>=<sp/>0.0;</highlight></codeline>
<codeline lineno="2592"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>decode_s_total<sp/>=<sp/>0.0;</highlight></codeline>
<codeline lineno="2593"><highlight class="normal"></highlight></codeline>
<codeline lineno="2594"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Timed<sp/>window<sp/>begins<sp/>here:<sp/>steady-state<sp/>generation<sp/>+<sp/>strict-touch<sp/>work<sp/>only.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2595"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>t0<sp/>=<sp/><ref refid="main__infer_8c_1a4fdbfffdaa0f22a01822f6a62bb7e95e" kindref="member">now_sec</ref>();</highlight></codeline>
<codeline lineno="2596"><highlight class="normal"></highlight></codeline>
<codeline lineno="2597"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>rr<sp/>=<sp/>0;<sp/>rr<sp/>&lt;<sp/>rounds;<sp/>++rr)<sp/>{</highlight></codeline>
<codeline lineno="2598"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>pi<sp/>=<sp/>0;<sp/>pi<sp/>&lt;<sp/>n_prompts;<sp/>++pi)<sp/>{</highlight></codeline>
<codeline lineno="2599"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*p<sp/>=<sp/>prompts.<ref refid="structprompt__list_1ad4b457e3153a399812c91acb3d2f399f" kindref="member">items</ref>[pi];</highlight></codeline>
<codeline lineno="2600"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>n_here<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="2601"><highlight class="normal"></highlight></codeline>
<codeline lineno="2602"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(trace_ids_enabled)<sp/>{</highlight></codeline>
<codeline lineno="2603"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>buf[32];</highlight></codeline>
<codeline lineno="2604"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(void)snprintf(buf,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(buf),<sp/></highlight><highlight class="stringliteral">&quot;%zu&quot;</highlight><highlight class="normal">,<sp/>pi);</highlight></codeline>
<codeline lineno="2605"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(void)setenv(</highlight><highlight class="stringliteral">&quot;IE_TRACE_PROMPT_INDEX&quot;</highlight><highlight class="normal">,<sp/>buf,<sp/>1);</highlight></codeline>
<codeline lineno="2606"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2607"><highlight class="normal"></highlight></codeline>
<codeline lineno="2608"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structie__generate__stats" kindref="compound">ie_generate_stats_t</ref><sp/>gs;</highlight></codeline>
<codeline lineno="2609"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>memset(&amp;gs,<sp/>0,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(gs));</highlight></codeline>
<codeline lineno="2610"><highlight class="normal"></highlight></codeline>
<codeline lineno="2611"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>pt0<sp/>=<sp/><ref refid="main__infer_8c_1a4fdbfffdaa0f22a01822f6a62bb7e95e" kindref="member">now_sec</ref>();</highlight></codeline>
<codeline lineno="2612"><highlight class="normal"></highlight></codeline>
<codeline lineno="2613"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>st<sp/>=<sp/><ref refid="ie__api_8h_1a950ac9a0efe5a4fe068a288e57099c4a" kindref="member">ie_engine_generate_ex</ref>(engine,<sp/>p,<sp/>cap,<sp/>tokens,<sp/>&amp;n_here,<sp/>&amp;gs);</highlight></codeline>
<codeline lineno="2614"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(st<sp/>!=<sp/><ref refid="ie__api_8h_1aad1f6716972d7c4560daae2edb134d6aad0e6665e4f13d22e40740ef4ab91d56e" kindref="member">IE_OK</ref>)<sp/>{</highlight></codeline>
<codeline lineno="2615"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;error:<sp/>ie_engine_generate_ex<sp/>(status=%d)\n&quot;</highlight><highlight class="normal">,<sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)st);</highlight></codeline>
<codeline lineno="2616"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="2617"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2618"><highlight class="normal"></highlight></codeline>
<codeline lineno="2619"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(want_cuda<sp/>&amp;&amp;<sp/>verify_touch<sp/>&amp;&amp;<sp/>bytes_per_token<sp/>&amp;&amp;<sp/>n_here<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="2620"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>rc<sp/>=<sp/><ref refid="main__infer_8c_1a44a0de9d17f6eff8a4764537268ab5d1" kindref="member">cudart_touch_bytes</ref>(bytes_per_token,<sp/>(uint64_t)n_here,<sp/>stride_bytes,<sp/>verify_touch);</highlight></codeline>
<codeline lineno="2621"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rc<sp/>!=<sp/>0)<sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;error:<sp/>CUDA<sp/>strict<sp/>touch<sp/>failed<sp/>(rc=%d)\n&quot;</highlight><highlight class="normal">,<sp/>rc);</highlight></codeline>
<codeline lineno="2622"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2623"><highlight class="normal"></highlight></codeline>
<codeline lineno="2624"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(want_cpu<sp/>&amp;&amp;<sp/>verify_touch<sp/>&amp;&amp;<sp/>bytes_per_token<sp/>&amp;&amp;<sp/>n_here<sp/>&gt;<sp/>0<sp/>&amp;&amp;<sp/>mt_ok)<sp/>{</highlight></codeline>
<codeline lineno="2625"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(void)<ref refid="main__infer_8c_1af5ac8d51b8d24639015faa2a2e699ba2" kindref="member">model_touch_bytes</ref>(&amp;mt,<sp/>bytes_per_token<sp/>*<sp/>n_here,<sp/>stride_bytes,<sp/>verify_touch);</highlight></codeline>
<codeline lineno="2626"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2627"><highlight class="normal"></highlight></codeline>
<codeline lineno="2628"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>pt1<sp/>=<sp/><ref refid="main__infer_8c_1a4fdbfffdaa0f22a01822f6a62bb7e95e" kindref="member">now_sec</ref>();</highlight></codeline>
<codeline lineno="2629"><highlight class="normal"></highlight></codeline>
<codeline lineno="2630"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>tokens_generated_total<sp/>+=<sp/>n_here;</highlight></codeline>
<codeline lineno="2631"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>total_tokens_this_round<sp/>+=<sp/>(uint64_t)n_here;</highlight></codeline>
<codeline lineno="2632"><highlight class="normal"></highlight></codeline>
<codeline lineno="2633"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>prefill_s_total<sp/>+=<sp/>gs.<ref refid="structie__generate__stats_1a25833e4ea02ba3a80027c68ef1b7df4e" kindref="member">prefill_time_s</ref>;</highlight></codeline>
<codeline lineno="2634"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>decode_s_total<sp/>+=<sp/>gs.<ref refid="structie__generate__stats_1a1b1460ddd99269f59229371ead131768" kindref="member">decode_time_s</ref>;</highlight></codeline>
<codeline lineno="2635"><highlight class="normal"></highlight></codeline>
<codeline lineno="2636"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>ridx<sp/>=<sp/>(size_t)rr<sp/>*<sp/>n_prompts<sp/>+<sp/>pi;</highlight></codeline>
<codeline lineno="2637"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structprompt__round__record" kindref="compound">prompt_round_record_t</ref><sp/>*r<sp/>=<sp/>&amp;recs[ridx];</highlight></codeline>
<codeline lineno="2638"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>memset(r,<sp/>0,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(*r));</highlight></codeline>
<codeline lineno="2639"><highlight class="normal"></highlight></codeline>
<codeline lineno="2640"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>r-&gt;<ref refid="structprompt__round__record_1a691ac5964e952c5059b957f07a8542f5" kindref="member">prompt_index</ref><sp/>=<sp/>pi;</highlight></codeline>
<codeline lineno="2641"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>r-&gt;<ref refid="structprompt__round__record_1aad02ec5870f35fcf8d7608104ed06304" kindref="member">round_index</ref><sp/>=<sp/>rr;</highlight></codeline>
<codeline lineno="2642"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>r-&gt;<ref refid="structprompt__round__record_1a9b7acfc693dc6c61df0c048c77d59c6f" kindref="member">prompt_id</ref><sp/>=<sp/><ref refid="main__infer_8c_1ad7f42b712b3e86af5d9f8c9942bc8875" kindref="member">prompt_id_fnv1a64</ref>(p);</highlight></codeline>
<codeline lineno="2643"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>r-&gt;<ref refid="structprompt__round__record_1a8cc938142194c5202bb275da807b0dbf" kindref="member">tokens_generated</ref><sp/>=<sp/>n_here;</highlight></codeline>
<codeline lineno="2644"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>r-&gt;<ref refid="structprompt__round__record_1a8da08c83a326c2b7ab39fd7cfadb762b" kindref="member">window_time_s</ref><sp/>=<sp/>(pt1<sp/>-<sp/>pt0);</highlight></codeline>
<codeline lineno="2645"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>r-&gt;<ref refid="structprompt__round__record_1a4ab0f6440e03c15551287b69ed070d94" kindref="member">prefill_time_s</ref><sp/>=<sp/>gs.<ref refid="structie__generate__stats_1a25833e4ea02ba3a80027c68ef1b7df4e" kindref="member">prefill_time_s</ref>;</highlight></codeline>
<codeline lineno="2646"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>r-&gt;<ref refid="structprompt__round__record_1aa08726c5eddf5bb4680d15b63b494dc8" kindref="member">decode_time_s</ref><sp/>=<sp/>gs.<ref refid="structie__generate__stats_1a1b1460ddd99269f59229371ead131768" kindref="member">decode_time_s</ref>;</highlight></codeline>
<codeline lineno="2647"><highlight class="normal"></highlight></codeline>
<codeline lineno="2648"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(opt.<ref refid="structcli__extras_1a69d2dd2e3fe09f5ff877aec31e16de34" kindref="member">report_tokens</ref>)<sp/>{</highlight></codeline>
<codeline lineno="2649"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>max_keep<sp/>=<sp/>opt.<ref refid="structcli__extras_1a9a0cdb8214e4f1b8cd375e78dc81f064" kindref="member">report_tokens_max</ref>;</highlight></codeline>
<codeline lineno="2650"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1a23f6c5852d73ecbdb1dead2be803bcf0" kindref="member">report_token_buf_copy</ref>(tokens,<sp/>n_here,<sp/>max_keep,<sp/>&amp;r-&gt;<ref refid="structprompt__round__record_1a51223e3133e92ee93d77d6752e57d1bf" kindref="member">tokens</ref>)<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="2651"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;warn:<sp/>OOM<sp/>while<sp/>copying<sp/>tokens<sp/>for<sp/>report<sp/>(continuing)\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="2652"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2653"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2654"><highlight class="normal"></highlight></codeline>
<codeline lineno="2655"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(expected_loaded)<sp/>{</highlight></codeline>
<codeline lineno="2656"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structexpected__tokens__entry" kindref="compound">expected_tokens_entry_t</ref><sp/>*e<sp/>=<sp/><ref refid="main__infer_8c_1a0b4d248d44b83ac2a6b5f47b47fe15df" kindref="member">expected_tokens_find</ref>(&amp;expected,<sp/>r-&gt;<ref refid="structprompt__round__record_1a9b7acfc693dc6c61df0c048c77d59c6f" kindref="member">prompt_id</ref>);</highlight></codeline>
<codeline lineno="2657"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(e)<sp/>{</highlight></codeline>
<codeline lineno="2658"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>r-&gt;<ref refid="structprompt__round__record_1ad67c0f4a359b27e788a90c0477211293" kindref="member">expected_present</ref><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="2659"><highlight class="normal"></highlight></codeline>
<codeline lineno="2660"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>mi<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="2661"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ea<sp/>=<sp/>0,<sp/>aa<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="2662"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>cmp<sp/>=<sp/><ref refid="main__infer_8c_1a3a307125ca4048deb177277c8e72bbfe" kindref="member">expected_tokens_compare</ref>(e-&gt;<ref refid="structexpected__tokens__entry_1a959f62b26acb1af16f22d85b55b0df78" kindref="member">tokens</ref>,<sp/>e-&gt;<ref refid="structexpected__tokens__entry_1adbef90e357d95fb8c8658ef20993593f" kindref="member">n_tokens</ref>,<sp/>tokens,<sp/>n_here,<sp/>&amp;mi,<sp/>&amp;ea,<sp/>&amp;aa);</highlight></codeline>
<codeline lineno="2663"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>r-&gt;<ref refid="structprompt__round__record_1adbf79594fd763d49b2eb13dcbd027c90" kindref="member">expected_ok</ref><sp/>=<sp/>(cmp<sp/>==<sp/>0)<sp/>?<sp/>1<sp/>:<sp/>0;</highlight></codeline>
<codeline lineno="2664"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>r-&gt;<ref refid="structprompt__round__record_1a639a8578fdf0ba299afe4f0783c47567" kindref="member">mismatch_index</ref><sp/>=<sp/>mi;</highlight></codeline>
<codeline lineno="2665"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>r-&gt;<ref refid="structprompt__round__record_1ae372c2117122aeea632490a6ea1526b1" kindref="member">expected_at</ref><sp/>=<sp/>ea;</highlight></codeline>
<codeline lineno="2666"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>r-&gt;<ref refid="structprompt__round__record_1a24eceb958921c2ab6ecf6fe0cdc5da49" kindref="member">actual_at</ref><sp/>=<sp/>aa;</highlight></codeline>
<codeline lineno="2667"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2668"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2669"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2670"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="2671"><highlight class="normal"></highlight></codeline>
<codeline lineno="2672"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>t1<sp/>=<sp/><ref refid="main__infer_8c_1a4fdbfffdaa0f22a01822f6a62bb7e95e" kindref="member">now_sec</ref>();</highlight></codeline>
<codeline lineno="2673"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Timed<sp/>window<sp/>ends<sp/>here.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2674"><highlight class="normal"></highlight></codeline>
<codeline lineno="2675"><highlight class="normal"><sp/><sp/>uint64_t<sp/>kv_hits_round<sp/>=<sp/>0,<sp/>kv_miss_round<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="2676"><highlight class="normal"><sp/><sp/><ref refid="ie__kv__instrumentation_8h_1a2c9789a487a67ebc8e6054aa0b991e4e" kindref="member">ie_kv_finish_round</ref>(total_tokens_this_round,<sp/>&amp;kv_hits_round,<sp/>&amp;kv_miss_round);</highlight></codeline>
<codeline lineno="2677"><highlight class="normal"></highlight></codeline>
<codeline lineno="2678"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint32_t<sp/>rss_mib<sp/>=<sp/><ref refid="main__infer_8c_1a0d90177eef91d08c3d9a38fb00df3e62" kindref="member">rss_peak_mib</ref>();</highlight></codeline>
<codeline lineno="2679"><highlight class="normal"></highlight></codeline>
<codeline lineno="2680"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Legacy<sp/>single-prompt<sp/>token<sp/>array<sp/>and<sp/>text<sp/>for<sp/>existing<sp/>tooling.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2681"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>legacy_single_prompt<sp/>=<sp/>(opt.<ref refid="structcli__extras_1a992ba8185b17f227f60e2e570441b63f" kindref="member">prompts_file</ref><sp/>==<sp/>NULL<sp/>&amp;&amp;<sp/>n_prompts<sp/>==<sp/>1<sp/>&amp;&amp;<sp/>rounds<sp/>==<sp/>1);</highlight></codeline>
<codeline lineno="2682"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*tokens_to_print<sp/>=<sp/>legacy_single_prompt<sp/>?<sp/>tokens<sp/>:<sp/>NULL;</highlight></codeline>
<codeline lineno="2683"><highlight class="normal"></highlight></codeline>
<codeline lineno="2684"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*decoded_legacy<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="2685"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(opt.<ref refid="structcli__extras_1a553c6e455b22c4ff3cd6f00beb166eb7" kindref="member">print_text</ref><sp/>&amp;&amp;<sp/>legacy_single_prompt<sp/>&amp;&amp;<sp/>tokens_generated_total<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="2686"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(tokenizer_path_heap<sp/>&amp;&amp;<sp/>*tokenizer_path_heap)<sp/>{</highlight></codeline>
<codeline lineno="2687"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1a4e30eb4737647a78c4dbebb5b008a5bd" kindref="member">decode_tokens_best_effort</ref>(tokenizer_path_heap,<sp/>tokens,<sp/>tokens_generated_total,<sp/>&amp;decoded_legacy)<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="2688"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>decoded_legacy<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="2689"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2690"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="2691"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;warn:<sp/>tokenizer<sp/>file<sp/>not<sp/>found<sp/>under<sp/>model<sp/>dir<sp/>&apos;%s&apos;\n&quot;</highlight><highlight class="normal">,<sp/>model_dir_eff);</highlight></codeline>
<codeline lineno="2692"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2693"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="2694"><highlight class="normal"></highlight></codeline>
<codeline lineno="2695"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Optional<sp/>per-record<sp/>decode<sp/>(outside<sp/>the<sp/>timed<sp/>window).<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2696"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(opt.<ref refid="structcli__extras_1a553c6e455b22c4ff3cd6f00beb166eb7" kindref="member">print_text</ref><sp/>&amp;&amp;<sp/>tokenizer_path_heap<sp/>&amp;&amp;<sp/>*tokenizer_path_heap)<sp/>{</highlight></codeline>
<codeline lineno="2697"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>rr<sp/>=<sp/>0;<sp/>rr<sp/>&lt;<sp/>rounds;<sp/>++rr)<sp/>{</highlight></codeline>
<codeline lineno="2698"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>pi<sp/>=<sp/>0;<sp/>pi<sp/>&lt;<sp/>n_prompts;<sp/>++pi)<sp/>{</highlight></codeline>
<codeline lineno="2699"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="structprompt__round__record" kindref="compound">prompt_round_record_t</ref><sp/>*r<sp/>=<sp/>&amp;recs[(size_t)rr<sp/>*<sp/>n_prompts<sp/>+<sp/>pi];</highlight></codeline>
<codeline lineno="2700"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(r-&gt;<ref refid="structprompt__round__record_1a51223e3133e92ee93d77d6752e57d1bf" kindref="member">tokens</ref>.<ref refid="structreport__token__buf_1a91b6556df06c25b311255a4a16f785dd" kindref="member">ids</ref><sp/>&amp;&amp;<sp/>r-&gt;<ref refid="structprompt__round__record_1a51223e3133e92ee93d77d6752e57d1bf" kindref="member">tokens</ref>.<ref refid="structreport__token__buf_1a89ffa03443f19bf77470f85a92baa245" kindref="member">n</ref><sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="2701"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*txt<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="2702"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="main__infer_8c_1a4e30eb4737647a78c4dbebb5b008a5bd" kindref="member">decode_tokens_best_effort</ref>(tokenizer_path_heap,<sp/>r-&gt;<ref refid="structprompt__round__record_1a51223e3133e92ee93d77d6752e57d1bf" kindref="member">tokens</ref>.<ref refid="structreport__token__buf_1a91b6556df06c25b311255a4a16f785dd" kindref="member">ids</ref>,<sp/>r-&gt;<ref refid="structprompt__round__record_1a51223e3133e92ee93d77d6752e57d1bf" kindref="member">tokens</ref>.<ref refid="structreport__token__buf_1a89ffa03443f19bf77470f85a92baa245" kindref="member">n</ref>,<sp/>&amp;txt)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="2703"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>r-&gt;<ref refid="structprompt__round__record_1a0c260950e8b81d2992debca2f4b49d00" kindref="member">decoded_text</ref><sp/>=<sp/>txt;</highlight></codeline>
<codeline lineno="2704"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2705"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2706"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2707"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="2708"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="2709"><highlight class="normal"></highlight></codeline>
<codeline lineno="2710"><highlight class="normal"><sp/><sp/><ref refid="main__infer_8c_1a84b40472513bc66398c6d3049891f553" kindref="member">print_json_result</ref>(tokens_generated_total,</highlight></codeline>
<codeline lineno="2711"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tokens_to_print,</highlight></codeline>
<codeline lineno="2712"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(t1<sp/>-<sp/>t0),</highlight></codeline>
<codeline lineno="2713"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>prefill_s_total,</highlight></codeline>
<codeline lineno="2714"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>decode_s_total,</highlight></codeline>
<codeline lineno="2715"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>kv_hits_round,</highlight></codeline>
<codeline lineno="2716"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>kv_miss_round,</highlight></codeline>
<codeline lineno="2717"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rss_mib,</highlight></codeline>
<codeline lineno="2718"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>decoded_legacy,</highlight></codeline>
<codeline lineno="2719"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(opt.<ref refid="structcli__extras_1a553c6e455b22c4ff3cd6f00beb166eb7" kindref="member">print_text</ref><sp/>?<sp/>tokenizer_path_heap<sp/>:<sp/>NULL),</highlight></codeline>
<codeline lineno="2720"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>opt.<ref refid="structcli__extras_1a3b9c2202e0ba68aa4b3112779697a28e" kindref="member">expected_tokens_file</ref>,</highlight></codeline>
<codeline lineno="2721"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;prompts,</highlight></codeline>
<codeline lineno="2722"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rounds,</highlight></codeline>
<codeline lineno="2723"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>recs);</highlight></codeline>
<codeline lineno="2724"><highlight class="normal"></highlight></codeline>
<codeline lineno="2725"><highlight class="normal"><sp/><sp/>free(decoded_legacy);</highlight></codeline>
<codeline lineno="2726"><highlight class="normal"></highlight></codeline>
<codeline lineno="2727"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(mt_ok)<sp/><ref refid="main__infer_8c_1a6d67a99243e339c4acabd9ed9b84002c" kindref="member">model_touch_close</ref>(&amp;mt);</highlight></codeline>
<codeline lineno="2728"><highlight class="normal"></highlight></codeline>
<codeline lineno="2729"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>(size_t)rounds<sp/>*<sp/>n_prompts;<sp/>++i)<sp/><ref refid="main__infer_8c_1aa8860ddc49714b553fe669c784885cff" kindref="member">prompt_round_record_free</ref>(&amp;recs[i]);</highlight></codeline>
<codeline lineno="2730"><highlight class="normal"><sp/><sp/>free(recs);</highlight></codeline>
<codeline lineno="2731"><highlight class="normal"></highlight></codeline>
<codeline lineno="2732"><highlight class="normal"><sp/><sp/><ref refid="main__infer_8c_1a470ca5b37dd720b5de391932c452af36" kindref="member">expected_tokens_table_free</ref>(&amp;expected);</highlight></codeline>
<codeline lineno="2733"><highlight class="normal"><sp/><sp/><ref refid="main__infer_8c_1ab06a46b9f23d08de776ec7d3258b6588" kindref="member">prompt_list_free</ref>(&amp;prompts);</highlight></codeline>
<codeline lineno="2734"><highlight class="normal"></highlight></codeline>
<codeline lineno="2735"><highlight class="normal"><sp/><sp/>free(tokens);</highlight></codeline>
<codeline lineno="2736"><highlight class="normal"><sp/><sp/><ref refid="ie__api_8h_1a5a9a30f05ef6183f6a75811c616b3a0a" kindref="member">ie_engine_destroy</ref>(engine);</highlight></codeline>
<codeline lineno="2737"><highlight class="normal"><sp/><sp/><ref refid="ie__io_8h_1a06c2b7e35d1f82a11e4605e23a1976f5" kindref="member">ie_weights_close</ref>(&amp;w);</highlight></codeline>
<codeline lineno="2738"><highlight class="normal"><sp/><sp/>free(tokenizer_path_heap);</highlight></codeline>
<codeline lineno="2739"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="2740"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="engine/src/main_infer.c"/>
  </compounddef>
</doxygen>
