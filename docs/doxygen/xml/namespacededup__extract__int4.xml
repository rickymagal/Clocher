<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.9.8" xml:lang="en-US">
  <compounddef id="namespacededup__extract__int4" kind="namespace" language="Python">
    <compoundname>dedup_extract_int4</compoundname>
    <innerclass refid="classdedup__extract__int4_1_1TensorRec" prot="public">dedup_extract_int4::TensorRec</innerclass>
    <sectiondef kind="func">
      <memberdef kind="function" id="namespacededup__extract__int4_1a4a04b8f391981f4146fcfadadde32729" prot="protected" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="ie__kernels__cuda_8cu_1af00402674d56c833c92c62df1cef1e84" kindref="member">object</ref></type>
        <definition> object dedup_extract_int4._load_json</definition>
        <argsstring>(str path)</argsstring>
        <name>_load_json</name>
        <qualifiedname>dedup_extract_int4._load_json</qualifiedname>
        <param>
          <type><ref refid="ie__kernels__cuda_8cu_1af00402674d56c833c92c62df1cef1e84" kindref="member">str</ref></type>
          <declname>path</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Load and parse a JSON file.</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tools/dedup_extract_int4.py" line="67" column="1" bodyfile="tools/dedup_extract_int4.py" bodystart="67" bodyend="72"/>
        <references refid="ie__kernels__cuda_8cu_1af00402674d56c833c92c62df1cef1e84" compoundref="ie__kernels__cuda_8cu" startline="157" endline="189">k_gemv_rowwise_f32</references>
        <referencedby refid="namespacededup__extract__int4_1ac97f2d8358c29021b64dc6d651c3714d" compoundref="dedup__extract__int4_8py" startline="157" endline="272">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="namespacededup__extract__int4_1a41f75afeca7923cb3c3e94c4b8dfd855" prot="protected" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="ie__kernels__cuda_8cu_1af00402674d56c833c92c62df1cef1e84" kindref="member">None</ref></type>
        <definition> None dedup_extract_int4._write_json</definition>
        <argsstring>(str path, object obj)</argsstring>
        <name>_write_json</name>
        <qualifiedname>dedup_extract_int4._write_json</qualifiedname>
        <param>
          <type><ref refid="ie__kernels__cuda_8cu_1af00402674d56c833c92c62df1cef1e84" kindref="member">str</ref></type>
          <declname>path</declname>
        </param>
        <param>
          <type><ref refid="ie__kernels__cuda_8cu_1af00402674d56c833c92c62df1cef1e84" kindref="member">object</ref></type>
          <declname>obj</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Write a JSON file with stable formatting.</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tools/dedup_extract_int4.py" line="73" column="1" bodyfile="tools/dedup_extract_int4.py" bodystart="73" bodyend="79"/>
        <references refid="ie__kernels__cuda_8cu_1af00402674d56c833c92c62df1cef1e84" compoundref="ie__kernels__cuda_8cu" startline="157" endline="189">k_gemv_rowwise_f32</references>
        <referencedby refid="namespacededup__extract__int4_1ac97f2d8358c29021b64dc6d651c3714d" compoundref="dedup__extract__int4_8py" startline="157" endline="272">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="namespacededup__extract__int4_1a79e4668e369ab3af8602b22e2fe13168" prot="protected" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="ie__kernels__cuda_8cu_1af00402674d56c833c92c62df1cef1e84" kindref="member">int</ref></type>
        <definition> int dedup_extract_int4._ceil_div</definition>
        <argsstring>(int a, int b)</argsstring>
        <name>_ceil_div</name>
        <qualifiedname>dedup_extract_int4._ceil_div</qualifiedname>
        <param>
          <type><ref refid="ie__kernels__cuda_8cu_1af00402674d56c833c92c62df1cef1e84" kindref="member">int</ref></type>
          <declname>a</declname>
        </param>
        <param>
          <type><ref refid="ie__kernels__cuda_8cu_1af00402674d56c833c92c62df1cef1e84" kindref="member">int</ref></type>
          <declname>b</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Compute ceil(a/b) for non-negative integers.</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tools/dedup_extract_int4.py" line="80" column="1" bodyfile="tools/dedup_extract_int4.py" bodystart="80" bodyend="84"/>
        <referencedby refid="namespacededup__extract__int4_1a9a19e28b92742a699efc5e008e747841" compoundref="dedup__extract__int4_8py" startline="85" endline="89">_mask_bytes</referencedby>
      </memberdef>
      <memberdef kind="function" id="namespacededup__extract__int4_1a9a19e28b92742a699efc5e008e747841" prot="protected" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="ie__kernels__cuda_8cu_1af00402674d56c833c92c62df1cef1e84" kindref="member">int</ref></type>
        <definition> int dedup_extract_int4._mask_bytes</definition>
        <argsstring>(int nbytes)</argsstring>
        <name>_mask_bytes</name>
        <qualifiedname>dedup_extract_int4._mask_bytes</qualifiedname>
        <param>
          <type><ref refid="ie__kernels__cuda_8cu_1af00402674d56c833c92c62df1cef1e84" kindref="member">int</ref></type>
          <declname>nbytes</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return the number of mask bytes needed for a tensor of size nbytes.</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tools/dedup_extract_int4.py" line="85" column="1" bodyfile="tools/dedup_extract_int4.py" bodystart="85" bodyend="89"/>
        <references refid="namespacededup__extract__int4_1a79e4668e369ab3af8602b22e2fe13168" compoundref="dedup__extract__int4_8py" startline="80" endline="84">_ceil_div</references>
        <referencedby refid="namespacededup__extract__int4_1ad7443195c1d80f3a0e99221c369d9b2a" compoundref="dedup__extract__int4_8py" startline="112" endline="133">_diff_default_target</referencedby>
      </memberdef>
      <memberdef kind="function" id="namespacededup__extract__int4_1a5016107a71fd3ff0d055392d4bd529c3" prot="protected" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="ie__kernels__cuda_8cu_1af00402674d56c833c92c62df1cef1e84" kindref="member">None</ref></type>
        <definition> None dedup_extract_int4._bitset_set</definition>
        <argsstring>(bytearray mask, int bit_index)</argsstring>
        <name>_bitset_set</name>
        <qualifiedname>dedup_extract_int4._bitset_set</qualifiedname>
        <param>
          <type><ref refid="ie__kernels__cuda_8cu_1af00402674d56c833c92c62df1cef1e84" kindref="member">bytearray</ref></type>
          <declname>mask</declname>
        </param>
        <param>
          <type><ref refid="ie__kernels__cuda_8cu_1af00402674d56c833c92c62df1cef1e84" kindref="member">int</ref></type>
          <declname>bit_index</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Set one bit in a little-endian bitset (bit 0 is LSB of byte 0).</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tools/dedup_extract_int4.py" line="90" column="1" bodyfile="tools/dedup_extract_int4.py" bodystart="90" bodyend="96"/>
        <referencedby refid="namespacededup__extract__int4_1ad7443195c1d80f3a0e99221c369d9b2a" compoundref="dedup__extract__int4_8py" startline="112" endline="133">_diff_default_target</referencedby>
      </memberdef>
      <memberdef kind="function" id="namespacededup__extract__int4_1a57d59c8c9f4c8e010b307c3aa29e66a3" prot="protected" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="ie__kernels__cuda_8cu_1af00402674d56c833c92c62df1cef1e84" kindref="member">int</ref></type>
        <definition> int dedup_extract_int4._bitset_popcount</definition>
        <argsstring>(bytes mask)</argsstring>
        <name>_bitset_popcount</name>
        <qualifiedname>dedup_extract_int4._bitset_popcount</qualifiedname>
        <param>
          <type>bytes</type>
          <declname>mask</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Count set bits in a bitset.</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tools/dedup_extract_int4.py" line="97" column="1" bodyfile="tools/dedup_extract_int4.py" bodystart="97" bodyend="101"/>
        <references refid="ie__kernels__cuda_8cu_1af00402674d56c833c92c62df1cef1e84" compoundref="ie__kernels__cuda_8cu" startline="157" endline="189">k_gemv_rowwise_f32</references>
        <referencedby refid="namespacededup__extract__int4_1ac97f2d8358c29021b64dc6d651c3714d" compoundref="dedup__extract__int4_8py" startline="157" endline="272">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="namespacededup__extract__int4_1ada8bb32ca0dc04fb322d3a577018bece" prot="protected" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>bytes</type>
        <definition> bytes dedup_extract_int4._read_slice</definition>
        <argsstring>(str path, int offset, int nbytes)</argsstring>
        <name>_read_slice</name>
        <qualifiedname>dedup_extract_int4._read_slice</qualifiedname>
        <param>
          <type><ref refid="ie__kernels__cuda_8cu_1af00402674d56c833c92c62df1cef1e84" kindref="member">str</ref></type>
          <declname>path</declname>
        </param>
        <param>
          <type><ref refid="ie__kernels__cuda_8cu_1af00402674d56c833c92c62df1cef1e84" kindref="member">int</ref></type>
          <declname>offset</declname>
        </param>
        <param>
          <type><ref refid="ie__kernels__cuda_8cu_1af00402674d56c833c92c62df1cef1e84" kindref="member">int</ref></type>
          <declname>nbytes</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Read a byte slice from a file at a given offset.</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tools/dedup_extract_int4.py" line="102" column="1" bodyfile="tools/dedup_extract_int4.py" bodystart="102" bodyend="111"/>
        <references refid="ie__kernels__cuda_8cu_1af00402674d56c833c92c62df1cef1e84" compoundref="ie__kernels__cuda_8cu" startline="157" endline="189">k_gemv_rowwise_f32</references>
        <referencedby refid="namespacededup__extract__int4_1ac97f2d8358c29021b64dc6d651c3714d" compoundref="dedup__extract__int4_8py" startline="157" endline="272">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="namespacededup__extract__int4_1ad7443195c1d80f3a0e99221c369d9b2a" prot="protected" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>Tuple[bytes, bytes]</type>
        <definition> Tuple[bytes, bytes] dedup_extract_int4._diff_default_target</definition>
        <argsstring>(bytes default_bytes, bytes target_bytes)</argsstring>
        <name>_diff_default_target</name>
        <qualifiedname>dedup_extract_int4._diff_default_target</qualifiedname>
        <param>
          <type>bytes</type>
          <declname>default_bytes</declname>
        </param>
        <param>
          <type>bytes</type>
          <declname>target_bytes</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Compute (mask, exceptions) between default_bytes and target_bytes.

The mask has 1 bit per byte; a 1 means target differs from default at that byte.
Exceptions are the raw target bytes at set-bit positions in ascending index order.
</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tools/dedup_extract_int4.py" line="112" column="1" bodyfile="tools/dedup_extract_int4.py" bodystart="112" bodyend="133"/>
        <references refid="namespacededup__extract__int4_1a5016107a71fd3ff0d055392d4bd529c3" compoundref="dedup__extract__int4_8py" startline="90" endline="96">_bitset_set</references>
        <references refid="namespacededup__extract__int4_1a9a19e28b92742a699efc5e008e747841" compoundref="dedup__extract__int4_8py" startline="85" endline="89">_mask_bytes</references>
        <references refid="ie__kernels__cuda_8cu_1af00402674d56c833c92c62df1cef1e84" compoundref="ie__kernels__cuda_8cu" startline="157" endline="189">k_gemv_rowwise_f32</references>
        <referencedby refid="namespacededup__extract__int4_1ac97f2d8358c29021b64dc6d651c3714d" compoundref="dedup__extract__int4_8py" startline="157" endline="272">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="namespacededup__extract__int4_1a0bdd2995b409d4cc057ba6b3651c7e1a" prot="protected" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>Tuple[<ref refid="ie__kernels__cuda_8cu_1af00402674d56c833c92c62df1cef1e84" kindref="member">str</ref>, Dict[<ref refid="ie__kernels__cuda_8cu_1af00402674d56c833c92c62df1cef1e84" kindref="member">int</ref>, <ref refid="classdedup__extract__int4_1_1TensorRec" kindref="compound">TensorRec</ref>]]</type>
        <definition> Tuple[str, Dict[int, TensorRec]] dedup_extract_int4._parse_tensor_map</definition>
        <argsstring>(object tensor_map)</argsstring>
        <name>_parse_tensor_map</name>
        <qualifiedname>dedup_extract_int4._parse_tensor_map</qualifiedname>
        <param>
          <type><ref refid="ie__kernels__cuda_8cu_1af00402674d56c833c92c62df1cef1e84" kindref="member">object</ref></type>
          <declname>tensor_map</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Parse the tensor map JSON object into a lookup table.</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tools/dedup_extract_int4.py" line="134" column="1" bodyfile="tools/dedup_extract_int4.py" bodystart="134" bodyend="156"/>
        <references refid="ie__kernels__cuda_8cu_1af00402674d56c833c92c62df1cef1e84" compoundref="ie__kernels__cuda_8cu" startline="157" endline="189">k_gemv_rowwise_f32</references>
        <referencedby refid="namespacededup__extract__int4_1ac97f2d8358c29021b64dc6d651c3714d" compoundref="dedup__extract__int4_8py" startline="157" endline="272">main</referencedby>
      </memberdef>
      <memberdef kind="function" id="namespacededup__extract__int4_1ac97f2d8358c29021b64dc6d651c3714d" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="ie__kernels__cuda_8cu_1af00402674d56c833c92c62df1cef1e84" kindref="member">int</ref></type>
        <definition> int dedup_extract_int4.main</definition>
        <argsstring>()</argsstring>
        <name>main</name>
        <qualifiedname>dedup_extract_int4.main</qualifiedname>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Program entry point.</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tools/dedup_extract_int4.py" line="157" column="1" bodyfile="tools/dedup_extract_int4.py" bodystart="157" bodyend="272"/>
        <references refid="namespacededup__extract__int4_1a57d59c8c9f4c8e010b307c3aa29e66a3" compoundref="dedup__extract__int4_8py" startline="97" endline="101">_bitset_popcount</references>
        <references refid="namespacededup__extract__int4_1ad7443195c1d80f3a0e99221c369d9b2a" compoundref="dedup__extract__int4_8py" startline="112" endline="133">_diff_default_target</references>
        <references refid="namespacededup__extract__int4_1a4a04b8f391981f4146fcfadadde32729" compoundref="dedup__extract__int4_8py" startline="67" endline="72">_load_json</references>
        <references refid="namespacededup__extract__int4_1a0bdd2995b409d4cc057ba6b3651c7e1a" compoundref="dedup__extract__int4_8py" startline="134" endline="156">_parse_tensor_map</references>
        <references refid="namespacededup__extract__int4_1ada8bb32ca0dc04fb322d3a577018bece" compoundref="dedup__extract__int4_8py" startline="102" endline="111">_read_slice</references>
        <references refid="namespacededup__extract__int4_1a41f75afeca7923cb3c3e94c4b8dfd855" compoundref="dedup__extract__int4_8py" startline="73" endline="79">_write_json</references>
        <references refid="ie__kernels__cuda_8cu_1af00402674d56c833c92c62df1cef1e84" compoundref="ie__kernels__cuda_8cu" startline="157" endline="189">k_gemv_rowwise_f32</references>
        <references refid="namespacededup__extract__int4_1ac97f2d8358c29021b64dc6d651c3714d" compoundref="dedup__extract__int4_8py" startline="157" endline="272">main</references>
        <referencedby refid="namespacededup__extract__int4_1ac97f2d8358c29021b64dc6d651c3714d" compoundref="dedup__extract__int4_8py" startline="157" endline="272">main</referencedby>
      </memberdef>
    </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
<para><verbatim>dedup_extract_int4.py

Lossless dedup extractor for byte-oriented tensors (including packed INT4 weights).

This tool creates:
  - model.defaults.bin
  - model.masks.bin
  - model.exceptions.bin
  - model.dedup.json

The core contract is byte-level and therefore dtype-agnostic:
  - A tensor is reconstructed exactly as raw bytes.
  - The mask has 1 bit per tensor byte.
  - Exceptions store the exact original bytes at masked indices.

Inputs:
  1) A tensor map JSON describing where each tensor lives in the binary file.
     Expected minimal schema:
     {
       &quot;weights_bin&quot;: &quot;model.ie.bin&quot;,
       &quot;tensors&quot;: [
         { &quot;index&quot;: 0, &quot;name&quot;: &quot;...&quot;, &quot;offset&quot;: 123, &quot;nbytes&quot;: 456 },
         ...
       ]
     }

  2) A groups JSON describing dedup groups:
     [
       {
         &quot;default_index&quot;: 17,
         &quot;targets&quot;: [18, 19, 20]
       },
       ...
     ]

Usage:
  python3 tools/dedup_extract_int4.py \
    --model-dir models/gpt-oss-20b \
    --tensor-map models/gpt-oss-20b/model.tensor_map.json \
    --groups tools/dedup_groups.json \
    --out-prefix models/gpt-oss-20b/model

Notes:
  - This script intentionally does not parse safetensors or HF formats.
  - It expects a simple (offset,nbytes) map to an existing binary file.
</verbatim> </para>
    </detaileddescription>
    <location file="tools/dedup_extract_int4.py" line="1" column="1"/>
  </compounddef>
</doxygen>
