<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.9.8" xml:lang="en-US">
  <compounddef id="gptoss__hparams_8c" kind="file" language="C++">
    <compoundname>gptoss_hparams.c</compoundname>
    <includes refid="gptoss__hparams_8h" local="yes">gptoss_hparams.h</includes>
    <includes refid="ie__io_8h" local="yes">ie_io.h</includes>
    <includes local="no">ctype.h</includes>
    <includes local="no">errno.h</includes>
    <includes local="no">stdint.h</includes>
    <includes local="no">stdio.h</includes>
    <includes local="no">stdlib.h</includes>
    <includes local="no">string.h</includes>
    <includes local="no">sys/stat.h</includes>
    <incdepgraph>
      <node id="2">
        <label>gptoss_hparams.h</label>
        <link refid="gptoss__hparams_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
      </node>
      <node id="5">
        <label>ie_device.h</label>
        <link refid="ie__device_8h"/>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
      </node>
      <node id="4">
        <label>ie_infer.h</label>
        <link refid="ie__infer_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
      </node>
      <node id="7">
        <label>ie_io.h</label>
        <link refid="ie__io_8h"/>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
      </node>
      <node id="8">
        <label>ie_kv_cache.h</label>
        <link refid="ie__kv__cache_8h"/>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
      </node>
      <node id="9">
        <label>ie_quant_act.h</label>
        <link refid="ie__quant__act_8h"/>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
      </node>
      <node id="1">
        <label>engine/src/runtime/gptoss_hparams.c</label>
        <link refid="gptoss__hparams_8c"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
      </node>
      <node id="10">
        <label>ctype.h</label>
      </node>
      <node id="11">
        <label>errno.h</label>
      </node>
      <node id="6">
        <label>stddef.h</label>
      </node>
      <node id="3">
        <label>stdint.h</label>
      </node>
      <node id="12">
        <label>stdio.h</label>
      </node>
      <node id="13">
        <label>stdlib.h</label>
      </node>
      <node id="14">
        <label>string.h</label>
      </node>
      <node id="15">
        <label>sys/stat.h</label>
      </node>
    </incdepgraph>
    <sectiondef kind="define">
      <memberdef kind="define" id="gptoss__hparams_8c_1a3024ccd4a9af5109d24e6c57565d74a1" prot="public" static="no">
        <name>_POSIX_C_SOURCE</name>
        <initializer>200809L</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/runtime/gptoss_hparams.c" line="39" column="9" bodyfile="engine/src/runtime/gptoss_hparams.c" bodystart="39" bodyend="-1"/>
      </memberdef>
    </sectiondef>
    <sectiondef kind="func">
      <memberdef kind="function" id="gptoss__hparams_8c_1a048a6d2c0cf41b0625d7660629b44d52" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int gptoss_join_path</definition>
        <argsstring>(char *out, size_t outsz, const char *dir, const char *file)</argsstring>
        <name>gptoss_join_path</name>
        <param>
          <type>char *</type>
          <declname>out</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>outsz</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>dir</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>file</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/runtime/gptoss_hparams.c" line="57" column="12" bodyfile="engine/src/runtime/gptoss_hparams.c" bodystart="57" bodyend="73"/>
        <references refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239" compoundref="ie__io_8h" startline="65">IE_IO_ERR_ARGS</references>
        <references refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a9b079e5c6f78861150a9bc91623d8c42" compoundref="ie__io_8h" startline="73">IE_IO_ERR_DECODE</references>
        <references refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d" compoundref="ie__io_8h" startline="64">IE_IO_OK</references>
        <referencedby refid="gptoss__hparams_8c_1a9eb7cf7fe4ec59cf516cda8a96454e43" compoundref="gptoss__hparams_8c" startline="519" endline="541">gptoss_resolve_config_path</referencedby>
        <referencedby refid="gptoss__hparams_8c_1a04a8a888cb08a1f787ace99dd860823b" compoundref="gptoss__hparams_8c" startline="543" endline="556">gptoss_resolve_iejson_path</referencedby>
      </memberdef>
      <memberdef kind="function" id="gptoss__hparams_8c_1a3ae59b784f474d4bd03f4a7b5bcc0d7a" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int gptoss_file_exists_regular</definition>
        <argsstring>(const char *path)</argsstring>
        <name>gptoss_file_exists_regular</name>
        <param>
          <type>const char *</type>
          <declname>path</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/runtime/gptoss_hparams.c" line="75" column="12" bodyfile="engine/src/runtime/gptoss_hparams.c" bodystart="75" bodyend="80"/>
        <referencedby refid="gptoss__hparams_8c_1a9eb7cf7fe4ec59cf516cda8a96454e43" compoundref="gptoss__hparams_8c" startline="519" endline="541">gptoss_resolve_config_path</referencedby>
        <referencedby refid="gptoss__hparams_8c_1a04a8a888cb08a1f787ace99dd860823b" compoundref="gptoss__hparams_8c" startline="543" endline="556">gptoss_resolve_iejson_path</referencedby>
      </memberdef>
      <memberdef kind="function" id="gptoss__hparams_8c_1acf6885297534473f02170d46c830a473" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int gptoss_read_all_text</definition>
        <argsstring>(const char *path, char **out_buf, size_t *out_len)</argsstring>
        <name>gptoss_read_all_text</name>
        <param>
          <type>const char *</type>
          <declname>path</declname>
        </param>
        <param>
          <type>char **</type>
          <declname>out_buf</declname>
        </param>
        <param>
          <type>size_t *</type>
          <declname>out_len</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/runtime/gptoss_hparams.c" line="82" column="12" bodyfile="engine/src/runtime/gptoss_hparams.c" bodystart="82" bodyend="131"/>
        <references refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a215c4a31864749ed0fce240433824032" compoundref="ie__io_8h" startline="71">IE_IO_ERR_ALLOC</references>
        <references refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239" compoundref="ie__io_8h" startline="65">IE_IO_ERR_ARGS</references>
        <references refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987aba0321da4352c7a61ea1bda842bb64d0" compoundref="ie__io_8h" startline="69">IE_IO_ERR_OPEN</references>
        <references refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987aa12fce48fd3eee2bd8a75dc61db150a7" compoundref="ie__io_8h" startline="70">IE_IO_ERR_READ</references>
        <references refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d" compoundref="ie__io_8h" startline="64">IE_IO_OK</references>
        <referencedby refid="gptoss__hparams_8c_1ab3bd6e26a9370d7074eec8646171042c" compoundref="gptoss__hparams_8c" startline="558" endline="663">gptoss_apply_iejson_inference</referencedby>
        <referencedby refid="gptoss__hparams_8h_1a44569b4152eff92faec7947f9d7e07a5" compoundref="gptoss__hparams_8c" startline="757" endline="774">gptoss_hparams_load_ex_from_file</referencedby>
      </memberdef>
      <memberdef kind="function" id="gptoss__hparams_8c_1ad4fb7d4f644b140059ab4b8e24adc768" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>const char *</type>
        <definition>static const char * gptoss_skip_ws</definition>
        <argsstring>(const char *p)</argsstring>
        <name>gptoss_skip_ws</name>
        <param>
          <type>const char *</type>
          <declname>p</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/runtime/gptoss_hparams.c" line="137" column="19" bodyfile="engine/src/runtime/gptoss_hparams.c" bodystart="137" bodyend="141"/>
        <referencedby refid="gptoss__hparams_8c_1a0a7a6e8a167338747e3a4b914c01f150" compoundref="gptoss__hparams_8c" startline="143" endline="167">gptoss_find_value_start</referencedby>
        <referencedby refid="gptoss__hparams_8c_1ab9460d8ee96ae89219066f9dee142410" compoundref="gptoss__hparams_8c" startline="248" endline="306">gptoss_scan_object_region</referencedby>
        <referencedby refid="gptoss__hparams_8c_1ad69c47a0f316f2e70fcca2eb0d585fcf" compoundref="gptoss__hparams_8c" startline="214" endline="246">gptoss_scan_string</referencedby>
        <referencedby refid="gptoss__hparams_8c_1a65ed371e841b3ba8a0e8ee5c7fb25fdb" compoundref="gptoss__hparams_8c" startline="336" endline="372">iejson_parse_shape_dims</referencedby>
      </memberdef>
      <memberdef kind="function" id="gptoss__hparams_8c_1a0a7a6e8a167338747e3a4b914c01f150" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>const char *</type>
        <definition>static const char * gptoss_find_value_start</definition>
        <argsstring>(const char *json, const char *key)</argsstring>
        <name>gptoss_find_value_start</name>
        <param>
          <type>const char *</type>
          <declname>json</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>key</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/runtime/gptoss_hparams.c" line="143" column="19" bodyfile="engine/src/runtime/gptoss_hparams.c" bodystart="143" bodyend="167"/>
        <references refid="gptoss__hparams_8c_1ad4fb7d4f644b140059ab4b8e24adc768" compoundref="gptoss__hparams_8c" startline="137" endline="141">gptoss_skip_ws</references>
        <referencedby refid="gptoss__hparams_8c_1a56a0abf4cd1fa4545c84c113acdb6bda" compoundref="gptoss__hparams_8c" startline="198" endline="212">gptoss_scan_bool</referencedby>
        <referencedby refid="gptoss__hparams_8c_1a68f469b55bc97b671cedff90eaead661" compoundref="gptoss__hparams_8c" startline="184" endline="196">gptoss_scan_f32</referencedby>
        <referencedby refid="gptoss__hparams_8c_1ab9460d8ee96ae89219066f9dee142410" compoundref="gptoss__hparams_8c" startline="248" endline="306">gptoss_scan_object_region</referencedby>
        <referencedby refid="gptoss__hparams_8c_1ad69c47a0f316f2e70fcca2eb0d585fcf" compoundref="gptoss__hparams_8c" startline="214" endline="246">gptoss_scan_string</referencedby>
        <referencedby refid="gptoss__hparams_8c_1ac69acc790fac4a66c3839531fb509983" compoundref="gptoss__hparams_8c" startline="169" endline="182">gptoss_scan_u32</referencedby>
      </memberdef>
      <memberdef kind="function" id="gptoss__hparams_8c_1ac69acc790fac4a66c3839531fb509983" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int gptoss_scan_u32</definition>
        <argsstring>(const char *json, const char *key, uint32_t *out_val)</argsstring>
        <name>gptoss_scan_u32</name>
        <param>
          <type>const char *</type>
          <declname>json</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>key</declname>
        </param>
        <param>
          <type>uint32_t *</type>
          <declname>out_val</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/runtime/gptoss_hparams.c" line="169" column="12" bodyfile="engine/src/runtime/gptoss_hparams.c" bodystart="169" bodyend="182"/>
        <references refid="gptoss__hparams_8c_1a0a7a6e8a167338747e3a4b914c01f150" compoundref="gptoss__hparams_8c" startline="143" endline="167">gptoss_find_value_start</references>
        <referencedby refid="gptoss__hparams_8c_1a877e2aad4bef17bb60c9d93f5fcb7d82" compoundref="gptoss__hparams_8c" startline="436" endline="517">gptoss_parse_config_json</referencedby>
      </memberdef>
      <memberdef kind="function" id="gptoss__hparams_8c_1a68f469b55bc97b671cedff90eaead661" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int gptoss_scan_f32</definition>
        <argsstring>(const char *json, const char *key, float *out_val)</argsstring>
        <name>gptoss_scan_f32</name>
        <param>
          <type>const char *</type>
          <declname>json</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>key</declname>
        </param>
        <param>
          <type>float *</type>
          <declname>out_val</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/runtime/gptoss_hparams.c" line="184" column="12" bodyfile="engine/src/runtime/gptoss_hparams.c" bodystart="184" bodyend="196"/>
        <references refid="gptoss__hparams_8c_1a0a7a6e8a167338747e3a4b914c01f150" compoundref="gptoss__hparams_8c" startline="143" endline="167">gptoss_find_value_start</references>
        <referencedby refid="gptoss__hparams_8c_1a877e2aad4bef17bb60c9d93f5fcb7d82" compoundref="gptoss__hparams_8c" startline="436" endline="517">gptoss_parse_config_json</referencedby>
      </memberdef>
      <memberdef kind="function" id="gptoss__hparams_8c_1a56a0abf4cd1fa4545c84c113acdb6bda" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int gptoss_scan_bool</definition>
        <argsstring>(const char *json, const char *key, int *out_val)</argsstring>
        <name>gptoss_scan_bool</name>
        <param>
          <type>const char *</type>
          <declname>json</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>key</declname>
        </param>
        <param>
          <type>int *</type>
          <declname>out_val</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/runtime/gptoss_hparams.c" line="198" column="12" bodyfile="engine/src/runtime/gptoss_hparams.c" bodystart="198" bodyend="212"/>
        <references refid="gptoss__hparams_8c_1a0a7a6e8a167338747e3a4b914c01f150" compoundref="gptoss__hparams_8c" startline="143" endline="167">gptoss_find_value_start</references>
        <referencedby refid="gptoss__hparams_8c_1a877e2aad4bef17bb60c9d93f5fcb7d82" compoundref="gptoss__hparams_8c" startline="436" endline="517">gptoss_parse_config_json</referencedby>
      </memberdef>
      <memberdef kind="function" id="gptoss__hparams_8c_1ad69c47a0f316f2e70fcca2eb0d585fcf" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int gptoss_scan_string</definition>
        <argsstring>(const char *json, const char *key, char *out, size_t outsz)</argsstring>
        <name>gptoss_scan_string</name>
        <param>
          <type>const char *</type>
          <declname>json</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>key</declname>
        </param>
        <param>
          <type>char *</type>
          <declname>out</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>outsz</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/runtime/gptoss_hparams.c" line="214" column="12" bodyfile="engine/src/runtime/gptoss_hparams.c" bodystart="214" bodyend="246"/>
        <references refid="gptoss__hparams_8c_1a0a7a6e8a167338747e3a4b914c01f150" compoundref="gptoss__hparams_8c" startline="143" endline="167">gptoss_find_value_start</references>
        <references refid="gptoss__hparams_8c_1ad4fb7d4f644b140059ab4b8e24adc768" compoundref="gptoss__hparams_8c" startline="137" endline="141">gptoss_skip_ws</references>
        <referencedby refid="gptoss__hparams_8c_1a877e2aad4bef17bb60c9d93f5fcb7d82" compoundref="gptoss__hparams_8c" startline="436" endline="517">gptoss_parse_config_json</referencedby>
      </memberdef>
      <memberdef kind="function" id="gptoss__hparams_8c_1ab9460d8ee96ae89219066f9dee142410" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int gptoss_scan_object_region</definition>
        <argsstring>(const char *json, const char *key, const char **out_obj, size_t *out_len)</argsstring>
        <name>gptoss_scan_object_region</name>
        <param>
          <type>const char *</type>
          <declname>json</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>key</declname>
        </param>
        <param>
          <type>const char **</type>
          <declname>out_obj</declname>
        </param>
        <param>
          <type>size_t *</type>
          <declname>out_len</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/runtime/gptoss_hparams.c" line="248" column="12" bodyfile="engine/src/runtime/gptoss_hparams.c" bodystart="248" bodyend="306"/>
        <references refid="gptoss__hparams_8c_1a0a7a6e8a167338747e3a4b914c01f150" compoundref="gptoss__hparams_8c" startline="143" endline="167">gptoss_find_value_start</references>
        <references refid="gptoss__hparams_8c_1ad4fb7d4f644b140059ab4b8e24adc768" compoundref="gptoss__hparams_8c" startline="137" endline="141">gptoss_skip_ws</references>
        <referencedby refid="gptoss__hparams_8c_1a877e2aad4bef17bb60c9d93f5fcb7d82" compoundref="gptoss__hparams_8c" startline="436" endline="517">gptoss_parse_config_json</referencedby>
      </memberdef>
      <memberdef kind="function" id="gptoss__hparams_8c_1a7c77db21315706297824ec7ac7155f0e" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>const char *</type>
        <definition>static const char * iejson_find_tensor_region</definition>
        <argsstring>(const char *json, const char *tensor_name)</argsstring>
        <name>iejson_find_tensor_region</name>
        <param>
          <type>const char *</type>
          <declname>json</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>tensor_name</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/runtime/gptoss_hparams.c" line="312" column="19" bodyfile="engine/src/runtime/gptoss_hparams.c" bodystart="312" bodyend="334"/>
        <referencedby refid="gptoss__hparams_8c_1a193ca0f7caa47a455b05ad9286cec2cc" compoundref="gptoss__hparams_8c" startline="374" endline="386">gptoss_iejson_get_shape</referencedby>
      </memberdef>
      <memberdef kind="function" id="gptoss__hparams_8c_1a65ed371e841b3ba8a0e8ee5c7fb25fdb" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int iejson_parse_shape_dims</definition>
        <argsstring>(const char *p, uint32_t *dims, size_t max_dims, size_t *out_ndims)</argsstring>
        <name>iejson_parse_shape_dims</name>
        <param>
          <type>const char *</type>
          <declname>p</declname>
        </param>
        <param>
          <type>uint32_t *</type>
          <declname>dims</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>max_dims</declname>
        </param>
        <param>
          <type>size_t *</type>
          <declname>out_ndims</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/runtime/gptoss_hparams.c" line="336" column="12" bodyfile="engine/src/runtime/gptoss_hparams.c" bodystart="336" bodyend="372"/>
        <references refid="gptoss__hparams_8c_1ad4fb7d4f644b140059ab4b8e24adc768" compoundref="gptoss__hparams_8c" startline="137" endline="141">gptoss_skip_ws</references>
        <referencedby refid="gptoss__hparams_8c_1a193ca0f7caa47a455b05ad9286cec2cc" compoundref="gptoss__hparams_8c" startline="374" endline="386">gptoss_iejson_get_shape</referencedby>
      </memberdef>
      <memberdef kind="function" id="gptoss__hparams_8c_1a193ca0f7caa47a455b05ad9286cec2cc" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int gptoss_iejson_get_shape</definition>
        <argsstring>(const char *iejson, const char *tensor_name, uint32_t *dims, size_t max_dims, size_t *out_ndims)</argsstring>
        <name>gptoss_iejson_get_shape</name>
        <param>
          <type>const char *</type>
          <declname>iejson</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>tensor_name</declname>
        </param>
        <param>
          <type>uint32_t *</type>
          <declname>dims</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>max_dims</declname>
        </param>
        <param>
          <type>size_t *</type>
          <declname>out_ndims</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/runtime/gptoss_hparams.c" line="374" column="12" bodyfile="engine/src/runtime/gptoss_hparams.c" bodystart="374" bodyend="386"/>
        <references refid="gptoss__hparams_8c_1a7c77db21315706297824ec7ac7155f0e" compoundref="gptoss__hparams_8c" startline="312" endline="334">iejson_find_tensor_region</references>
        <references refid="gptoss__hparams_8c_1a65ed371e841b3ba8a0e8ee5c7fb25fdb" compoundref="gptoss__hparams_8c" startline="336" endline="372">iejson_parse_shape_dims</references>
        <referencedby refid="gptoss__hparams_8c_1ab3bd6e26a9370d7074eec8646171042c" compoundref="gptoss__hparams_8c" startline="558" endline="663">gptoss_apply_iejson_inference</referencedby>
      </memberdef>
      <memberdef kind="function" id="gptoss__hparams_8c_1a1fc228937b1158daeec7c8473268ef6d" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void gptoss_hparams_ex_defaults</definition>
        <argsstring>(gptoss_hparams_ex_t *out_ex)</argsstring>
        <name>gptoss_hparams_ex_defaults</name>
        <param>
          <type><ref refid="structgptoss__hparams__ex__t" kindref="compound">gptoss_hparams_ex_t</ref> *</type>
          <declname>out_ex</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/runtime/gptoss_hparams.c" line="392" column="13" bodyfile="engine/src/runtime/gptoss_hparams.c" bodystart="392" bodyend="400"/>
        <references refid="structgptoss__hparams__ex__t_1a7c485ce5ab9f23318dd01590e53d5896" compoundref="gptoss__hparams_8h" startline="68">gptoss_hparams_ex_t::rms_norm_eps</references>
        <references refid="structgptoss__hparams__ex__t_1a6506926ad8c409cddfea5c4e819ee5e6" compoundref="gptoss__hparams_8h" startline="80">gptoss_hparams_ex_t::rope_scaling_factor</references>
        <references refid="structgptoss__hparams__ex__t_1a0482634a73ae325d678773a90a9488bb" compoundref="gptoss__hparams_8h" startline="86">gptoss_hparams_ex_t::rope_scaling_original_max_position_embeddings</references>
        <references refid="structgptoss__hparams__ex__t_1ab9e6c60c04ee4743452fdc0abc786090" compoundref="gptoss__hparams_8h" startline="77">gptoss_hparams_ex_t::rope_scaling_type</references>
        <references refid="structgptoss__hparams__ex__t_1ab2801efbde312a24d000be04f19e50a5" compoundref="gptoss__hparams_8h" startline="71">gptoss_hparams_ex_t::rope_theta</references>
        <references refid="structgptoss__hparams__ex__t_1a467ba148f9ecb5525cd19fb3dbfff12b" compoundref="gptoss__hparams_8h" startline="92">gptoss_hparams_ex_t::tie_word_embeddings</references>
        <referencedby refid="gptoss__hparams_8h_1a44569b4152eff92faec7947f9d7e07a5" compoundref="gptoss__hparams_8c" startline="757" endline="774">gptoss_hparams_load_ex_from_file</referencedby>
      </memberdef>
      <memberdef kind="function" id="gptoss__hparams_8c_1aa06d7bffe4f02c80ed7d45c7dcbffead" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>uint32_t</type>
        <definition>static uint32_t gptoss_env_u32</definition>
        <argsstring>(const char *name, uint32_t defval)</argsstring>
        <name>gptoss_env_u32</name>
        <param>
          <type>const char *</type>
          <declname>name</declname>
        </param>
        <param>
          <type>uint32_t</type>
          <declname>defval</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/runtime/gptoss_hparams.c" line="402" column="17" bodyfile="engine/src/runtime/gptoss_hparams.c" bodystart="402" bodyend="411"/>
        <referencedby refid="gptoss__hparams_8c_1ad063ffeef89d45962268a99b62c6a83f" compoundref="gptoss__hparams_8c" startline="665" endline="751">gptoss_finalize_and_validate</referencedby>
      </memberdef>
      <memberdef kind="function" id="gptoss__hparams_8c_1aeb01d26508e2161e666f67d078c810b4" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>static void gptoss_apply_rope_scaling_env_if_absent</definition>
        <argsstring>(const gptoss_hparams_ex_t *ex)</argsstring>
        <name>gptoss_apply_rope_scaling_env_if_absent</name>
        <param>
          <type>const <ref refid="structgptoss__hparams__ex__t" kindref="compound">gptoss_hparams_ex_t</ref> *</type>
          <declname>ex</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/runtime/gptoss_hparams.c" line="413" column="13" bodyfile="engine/src/runtime/gptoss_hparams.c" bodystart="413" bodyend="434"/>
        <references refid="structgptoss__hparams__ex__t_1a6506926ad8c409cddfea5c4e819ee5e6" compoundref="gptoss__hparams_8h" startline="80">gptoss_hparams_ex_t::rope_scaling_factor</references>
        <references refid="structgptoss__hparams__ex__t_1ab9e6c60c04ee4743452fdc0abc786090" compoundref="gptoss__hparams_8h" startline="77">gptoss_hparams_ex_t::rope_scaling_type</references>
        <referencedby refid="gptoss__hparams_8c_1ad063ffeef89d45962268a99b62c6a83f" compoundref="gptoss__hparams_8c" startline="665" endline="751">gptoss_finalize_and_validate</referencedby>
      </memberdef>
      <memberdef kind="function" id="gptoss__hparams_8c_1a877e2aad4bef17bb60c9d93f5fcb7d82" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int gptoss_parse_config_json</definition>
        <argsstring>(const char *json, gptoss_hparams_ex_t *out_ex)</argsstring>
        <name>gptoss_parse_config_json</name>
        <param>
          <type>const char *</type>
          <declname>json</declname>
        </param>
        <param>
          <type><ref refid="structgptoss__hparams__ex__t" kindref="compound">gptoss_hparams_ex_t</ref> *</type>
          <declname>out_ex</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/runtime/gptoss_hparams.c" line="436" column="12" bodyfile="engine/src/runtime/gptoss_hparams.c" bodystart="436" bodyend="517"/>
        <references refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" compoundref="gptoss__hparams_8h" startline="65">gptoss_hparams_ex_t::core</references>
        <references refid="structie__gptoss__hparams_1a6586576d1feb432bf7083cc3f35702d5" compoundref="ie__infer_8h" startline="47">ie_gptoss_hparams::d_ff</references>
        <references refid="structie__gptoss__hparams_1a33df15e8279a7c66842c295db4d955ee" compoundref="ie__infer_8h" startline="45">ie_gptoss_hparams::d_model</references>
        <references refid="gptoss__hparams_8c_1a56a0abf4cd1fa4545c84c113acdb6bda" compoundref="gptoss__hparams_8c" startline="198" endline="212">gptoss_scan_bool</references>
        <references refid="gptoss__hparams_8c_1a68f469b55bc97b671cedff90eaead661" compoundref="gptoss__hparams_8c" startline="184" endline="196">gptoss_scan_f32</references>
        <references refid="gptoss__hparams_8c_1ab9460d8ee96ae89219066f9dee142410" compoundref="gptoss__hparams_8c" startline="248" endline="306">gptoss_scan_object_region</references>
        <references refid="gptoss__hparams_8c_1ad69c47a0f316f2e70fcca2eb0d585fcf" compoundref="gptoss__hparams_8c" startline="214" endline="246">gptoss_scan_string</references>
        <references refid="gptoss__hparams_8c_1ac69acc790fac4a66c3839531fb509983" compoundref="gptoss__hparams_8c" startline="169" endline="182">gptoss_scan_u32</references>
        <references refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239" compoundref="ie__io_8h" startline="65">IE_IO_ERR_ARGS</references>
        <references refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9" compoundref="ie__io_8h" startline="66">IE_IO_ERR_JSON</references>
        <references refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d" compoundref="ie__io_8h" startline="64">IE_IO_OK</references>
        <references refid="structie__gptoss__hparams_1aab0c01be581031776f5fa61bbb10de24" compoundref="ie__infer_8h" startline="49">ie_gptoss_hparams::max_seq</references>
        <references refid="structie__gptoss__hparams_1a5176af7af6c6d8a4c516f7ec1e6be202" compoundref="ie__infer_8h" startline="43">ie_gptoss_hparams::n_heads</references>
        <references refid="structie__gptoss__hparams_1a89acca54a15e45183b174270c137d5ca" compoundref="ie__infer_8h" startline="44">ie_gptoss_hparams::n_kv_heads</references>
        <references refid="structie__gptoss__hparams_1a9f7592ff0ef97a90e4bf510d7323c1e2" compoundref="ie__infer_8h" startline="42">ie_gptoss_hparams::n_layers</references>
        <references refid="structgptoss__hparams__ex__t_1a7c485ce5ab9f23318dd01590e53d5896" compoundref="gptoss__hparams_8h" startline="68">gptoss_hparams_ex_t::rms_norm_eps</references>
        <references refid="structgptoss__hparams__ex__t_1a6506926ad8c409cddfea5c4e819ee5e6" compoundref="gptoss__hparams_8h" startline="80">gptoss_hparams_ex_t::rope_scaling_factor</references>
        <references refid="structgptoss__hparams__ex__t_1a0482634a73ae325d678773a90a9488bb" compoundref="gptoss__hparams_8h" startline="86">gptoss_hparams_ex_t::rope_scaling_original_max_position_embeddings</references>
        <references refid="structgptoss__hparams__ex__t_1ab9e6c60c04ee4743452fdc0abc786090" compoundref="gptoss__hparams_8h" startline="77">gptoss_hparams_ex_t::rope_scaling_type</references>
        <references refid="structgptoss__hparams__ex__t_1ab2801efbde312a24d000be04f19e50a5" compoundref="gptoss__hparams_8h" startline="71">gptoss_hparams_ex_t::rope_theta</references>
        <references refid="structgptoss__hparams__ex__t_1a467ba148f9ecb5525cd19fb3dbfff12b" compoundref="gptoss__hparams_8h" startline="92">gptoss_hparams_ex_t::tie_word_embeddings</references>
        <references refid="structie__gptoss__hparams_1a92d6a3ba26bf70874cd58b8aebfe688c" compoundref="ie__infer_8h" startline="48">ie_gptoss_hparams::vocab_size</references>
        <referencedby refid="gptoss__hparams_8h_1a44569b4152eff92faec7947f9d7e07a5" compoundref="gptoss__hparams_8c" startline="757" endline="774">gptoss_hparams_load_ex_from_file</referencedby>
      </memberdef>
      <memberdef kind="function" id="gptoss__hparams_8c_1a9eb7cf7fe4ec59cf516cda8a96454e43" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int gptoss_resolve_config_path</definition>
        <argsstring>(const char *model_dir, char *out_path, size_t out_sz)</argsstring>
        <name>gptoss_resolve_config_path</name>
        <param>
          <type>const char *</type>
          <declname>model_dir</declname>
        </param>
        <param>
          <type>char *</type>
          <declname>out_path</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>out_sz</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/runtime/gptoss_hparams.c" line="519" column="12" bodyfile="engine/src/runtime/gptoss_hparams.c" bodystart="519" bodyend="541"/>
        <references refid="gptoss__hparams_8c_1a3ae59b784f474d4bd03f4a7b5bcc0d7a" compoundref="gptoss__hparams_8c" startline="75" endline="80">gptoss_file_exists_regular</references>
        <references refid="gptoss__hparams_8c_1a048a6d2c0cf41b0625d7660629b44d52" compoundref="gptoss__hparams_8c" startline="57" endline="73">gptoss_join_path</references>
        <references refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239" compoundref="ie__io_8h" startline="65">IE_IO_ERR_ARGS</references>
        <references refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a9b079e5c6f78861150a9bc91623d8c42" compoundref="ie__io_8h" startline="73">IE_IO_ERR_DECODE</references>
        <references refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987aba0321da4352c7a61ea1bda842bb64d0" compoundref="ie__io_8h" startline="69">IE_IO_ERR_OPEN</references>
        <references refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d" compoundref="ie__io_8h" startline="64">IE_IO_OK</references>
        <referencedby refid="gptoss__hparams_8h_1ab455fc052d5abd5ec9be138ebd71deaf" compoundref="gptoss__hparams_8c" startline="776" endline="787">gptoss_hparams_load_ex</referencedby>
      </memberdef>
      <memberdef kind="function" id="gptoss__hparams_8c_1a04a8a888cb08a1f787ace99dd860823b" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int gptoss_resolve_iejson_path</definition>
        <argsstring>(const char *model_dir, char *out_path, size_t out_sz)</argsstring>
        <name>gptoss_resolve_iejson_path</name>
        <param>
          <type>const char *</type>
          <declname>model_dir</declname>
        </param>
        <param>
          <type>char *</type>
          <declname>out_path</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>out_sz</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/runtime/gptoss_hparams.c" line="543" column="12" bodyfile="engine/src/runtime/gptoss_hparams.c" bodystart="543" bodyend="556"/>
        <references refid="gptoss__hparams_8c_1a3ae59b784f474d4bd03f4a7b5bcc0d7a" compoundref="gptoss__hparams_8c" startline="75" endline="80">gptoss_file_exists_regular</references>
        <references refid="gptoss__hparams_8c_1a048a6d2c0cf41b0625d7660629b44d52" compoundref="gptoss__hparams_8c" startline="57" endline="73">gptoss_join_path</references>
        <references refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239" compoundref="ie__io_8h" startline="65">IE_IO_ERR_ARGS</references>
        <references refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a9b079e5c6f78861150a9bc91623d8c42" compoundref="ie__io_8h" startline="73">IE_IO_ERR_DECODE</references>
        <references refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987aba0321da4352c7a61ea1bda842bb64d0" compoundref="ie__io_8h" startline="69">IE_IO_ERR_OPEN</references>
        <references refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d" compoundref="ie__io_8h" startline="64">IE_IO_OK</references>
        <referencedby refid="gptoss__hparams_8c_1ab3bd6e26a9370d7074eec8646171042c" compoundref="gptoss__hparams_8c" startline="558" endline="663">gptoss_apply_iejson_inference</referencedby>
      </memberdef>
      <memberdef kind="function" id="gptoss__hparams_8c_1ab3bd6e26a9370d7074eec8646171042c" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int gptoss_apply_iejson_inference</definition>
        <argsstring>(const char *model_dir, gptoss_hparams_ex_t *io_ex)</argsstring>
        <name>gptoss_apply_iejson_inference</name>
        <param>
          <type>const char *</type>
          <declname>model_dir</declname>
        </param>
        <param>
          <type><ref refid="structgptoss__hparams__ex__t" kindref="compound">gptoss_hparams_ex_t</ref> *</type>
          <declname>io_ex</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/runtime/gptoss_hparams.c" line="558" column="12" bodyfile="engine/src/runtime/gptoss_hparams.c" bodystart="558" bodyend="663"/>
        <references refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" compoundref="gptoss__hparams_8h" startline="65">gptoss_hparams_ex_t::core</references>
        <references refid="structie__gptoss__hparams_1a6586576d1feb432bf7083cc3f35702d5" compoundref="ie__infer_8h" startline="47">ie_gptoss_hparams::d_ff</references>
        <references refid="structie__gptoss__hparams_1aa4bcfd3715e6fbd18bf3bbad86e017da" compoundref="ie__infer_8h" startline="46">ie_gptoss_hparams::d_head</references>
        <references refid="structie__gptoss__hparams_1a33df15e8279a7c66842c295db4d955ee" compoundref="ie__infer_8h" startline="45">ie_gptoss_hparams::d_model</references>
        <references refid="gptoss__hparams_8c_1a193ca0f7caa47a455b05ad9286cec2cc" compoundref="gptoss__hparams_8c" startline="374" endline="386">gptoss_iejson_get_shape</references>
        <references refid="gptoss__hparams_8c_1acf6885297534473f02170d46c830a473" compoundref="gptoss__hparams_8c" startline="82" endline="131">gptoss_read_all_text</references>
        <references refid="gptoss__hparams_8c_1a04a8a888cb08a1f787ace99dd860823b" compoundref="gptoss__hparams_8c" startline="543" endline="556">gptoss_resolve_iejson_path</references>
        <references refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239" compoundref="ie__io_8h" startline="65">IE_IO_ERR_ARGS</references>
        <references refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a9b079e5c6f78861150a9bc91623d8c42" compoundref="ie__io_8h" startline="73">IE_IO_ERR_DECODE</references>
        <references refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9" compoundref="ie__io_8h" startline="66">IE_IO_ERR_JSON</references>
        <references refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987aa12fce48fd3eee2bd8a75dc61db150a7" compoundref="ie__io_8h" startline="70">IE_IO_ERR_READ</references>
        <references refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d" compoundref="ie__io_8h" startline="64">IE_IO_OK</references>
        <references refid="structie__gptoss__hparams_1a5176af7af6c6d8a4c516f7ec1e6be202" compoundref="ie__infer_8h" startline="43">ie_gptoss_hparams::n_heads</references>
        <references refid="structie__gptoss__hparams_1a89acca54a15e45183b174270c137d5ca" compoundref="ie__infer_8h" startline="44">ie_gptoss_hparams::n_kv_heads</references>
        <referencedby refid="gptoss__hparams_8c_1ad063ffeef89d45962268a99b62c6a83f" compoundref="gptoss__hparams_8c" startline="665" endline="751">gptoss_finalize_and_validate</referencedby>
      </memberdef>
      <memberdef kind="function" id="gptoss__hparams_8c_1ad063ffeef89d45962268a99b62c6a83f" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>static int gptoss_finalize_and_validate</definition>
        <argsstring>(const char *model_dir, gptoss_hparams_ex_t *io_ex)</argsstring>
        <name>gptoss_finalize_and_validate</name>
        <param>
          <type>const char *</type>
          <declname>model_dir</declname>
        </param>
        <param>
          <type><ref refid="structgptoss__hparams__ex__t" kindref="compound">gptoss_hparams_ex_t</ref> *</type>
          <declname>io_ex</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/runtime/gptoss_hparams.c" line="665" column="12" bodyfile="engine/src/runtime/gptoss_hparams.c" bodystart="665" bodyend="751"/>
        <references refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" compoundref="gptoss__hparams_8h" startline="65">gptoss_hparams_ex_t::core</references>
        <references refid="structie__gptoss__hparams_1a6586576d1feb432bf7083cc3f35702d5" compoundref="ie__infer_8h" startline="47">ie_gptoss_hparams::d_ff</references>
        <references refid="structie__gptoss__hparams_1aa4bcfd3715e6fbd18bf3bbad86e017da" compoundref="ie__infer_8h" startline="46">ie_gptoss_hparams::d_head</references>
        <references refid="structie__gptoss__hparams_1a33df15e8279a7c66842c295db4d955ee" compoundref="ie__infer_8h" startline="45">ie_gptoss_hparams::d_model</references>
        <references refid="gptoss__hparams_8c_1ab3bd6e26a9370d7074eec8646171042c" compoundref="gptoss__hparams_8c" startline="558" endline="663">gptoss_apply_iejson_inference</references>
        <references refid="gptoss__hparams_8c_1aeb01d26508e2161e666f67d078c810b4" compoundref="gptoss__hparams_8c" startline="413" endline="434">gptoss_apply_rope_scaling_env_if_absent</references>
        <references refid="gptoss__hparams_8c_1aa06d7bffe4f02c80ed7d45c7dcbffead" compoundref="gptoss__hparams_8c" startline="402" endline="411">gptoss_env_u32</references>
        <references refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239" compoundref="ie__io_8h" startline="65">IE_IO_ERR_ARGS</references>
        <references refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a9b079e5c6f78861150a9bc91623d8c42" compoundref="ie__io_8h" startline="73">IE_IO_ERR_DECODE</references>
        <references refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9" compoundref="ie__io_8h" startline="66">IE_IO_ERR_JSON</references>
        <references refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d" compoundref="ie__io_8h" startline="64">IE_IO_OK</references>
        <references refid="structie__gptoss__hparams_1aab0c01be581031776f5fa61bbb10de24" compoundref="ie__infer_8h" startline="49">ie_gptoss_hparams::max_seq</references>
        <references refid="structie__gptoss__hparams_1a5176af7af6c6d8a4c516f7ec1e6be202" compoundref="ie__infer_8h" startline="43">ie_gptoss_hparams::n_heads</references>
        <references refid="structie__gptoss__hparams_1a89acca54a15e45183b174270c137d5ca" compoundref="ie__infer_8h" startline="44">ie_gptoss_hparams::n_kv_heads</references>
        <references refid="structie__gptoss__hparams_1a9f7592ff0ef97a90e4bf510d7323c1e2" compoundref="ie__infer_8h" startline="42">ie_gptoss_hparams::n_layers</references>
        <references refid="structgptoss__hparams__ex__t_1a6506926ad8c409cddfea5c4e819ee5e6" compoundref="gptoss__hparams_8h" startline="80">gptoss_hparams_ex_t::rope_scaling_factor</references>
        <references refid="structgptoss__hparams__ex__t_1a0482634a73ae325d678773a90a9488bb" compoundref="gptoss__hparams_8h" startline="86">gptoss_hparams_ex_t::rope_scaling_original_max_position_embeddings</references>
        <references refid="structgptoss__hparams__ex__t_1ab9e6c60c04ee4743452fdc0abc786090" compoundref="gptoss__hparams_8h" startline="77">gptoss_hparams_ex_t::rope_scaling_type</references>
        <references refid="structgptoss__hparams__ex__t_1ab2801efbde312a24d000be04f19e50a5" compoundref="gptoss__hparams_8h" startline="71">gptoss_hparams_ex_t::rope_theta</references>
        <references refid="structie__gptoss__hparams_1a92d6a3ba26bf70874cd58b8aebfe688c" compoundref="ie__infer_8h" startline="48">ie_gptoss_hparams::vocab_size</references>
        <referencedby refid="gptoss__hparams_8h_1ab455fc052d5abd5ec9be138ebd71deaf" compoundref="gptoss__hparams_8c" startline="776" endline="787">gptoss_hparams_load_ex</referencedby>
      </memberdef>
      <memberdef kind="function" id="gptoss__hparams_8c_1a44569b4152eff92faec7947f9d7e07a5" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int gptoss_hparams_load_ex_from_file</definition>
        <argsstring>(const char *config_json_path, gptoss_hparams_ex_t *out_ex)</argsstring>
        <name>gptoss_hparams_load_ex_from_file</name>
        <param>
          <type>const char *</type>
          <declname>config_json_path</declname>
        </param>
        <param>
          <type><ref refid="structgptoss__hparams__ex__t" kindref="compound">gptoss_hparams_ex_t</ref> *</type>
          <declname>out_ex</declname>
        </param>
        <briefdescription>
<para>Load extended hyperparameters from an explicit HuggingFace config path. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>config_json_path</parametername>
</parameternamelist>
<parameterdescription>
<para>Path to a HuggingFace <computeroutput>config.json</computeroutput>. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>out_ex</parametername>
</parameternamelist>
<parameterdescription>
<para>Output extended hyperparameter struct (written on success). </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>IE_IO_OK on success, negative <ref refid="ie__io_8h_1aabad0c7dd1649d6261de555346eb68d5" kindref="member">ie_io_status_t</ref> on failure. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/runtime/gptoss_hparams.c" line="757" column="5" bodyfile="engine/src/runtime/gptoss_hparams.c" bodystart="757" bodyend="774"/>
        <references refid="gptoss__hparams_8c_1a1fc228937b1158daeec7c8473268ef6d" compoundref="gptoss__hparams_8c" startline="392" endline="400">gptoss_hparams_ex_defaults</references>
        <references refid="gptoss__hparams_8c_1a877e2aad4bef17bb60c9d93f5fcb7d82" compoundref="gptoss__hparams_8c" startline="436" endline="517">gptoss_parse_config_json</references>
        <references refid="gptoss__hparams_8c_1acf6885297534473f02170d46c830a473" compoundref="gptoss__hparams_8c" startline="82" endline="131">gptoss_read_all_text</references>
        <references refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239" compoundref="ie__io_8h" startline="65">IE_IO_ERR_ARGS</references>
        <references refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987aa12fce48fd3eee2bd8a75dc61db150a7" compoundref="ie__io_8h" startline="70">IE_IO_ERR_READ</references>
        <references refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d" compoundref="ie__io_8h" startline="64">IE_IO_OK</references>
        <referencedby refid="gptoss__hparams_8h_1ab455fc052d5abd5ec9be138ebd71deaf" compoundref="gptoss__hparams_8c" startline="776" endline="787">gptoss_hparams_load_ex</referencedby>
      </memberdef>
      <memberdef kind="function" id="gptoss__hparams_8c_1ab455fc052d5abd5ec9be138ebd71deaf" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int gptoss_hparams_load_ex</definition>
        <argsstring>(const char *model_dir, gptoss_hparams_ex_t *out_ex)</argsstring>
        <name>gptoss_hparams_load_ex</name>
        <param>
          <type>const char *</type>
          <declname>model_dir</declname>
        </param>
        <param>
          <type><ref refid="structgptoss__hparams__ex__t" kindref="compound">gptoss_hparams_ex_t</ref> *</type>
          <declname>out_ex</declname>
        </param>
        <briefdescription>
<para>Load extended hyperparameters from a model directory. </para>
        </briefdescription>
        <detaileddescription>
<para>Same search behavior as <ref refid="gptoss__hparams_8h_1a551745dee25fc47e05d76c79791885a0" kindref="member">gptoss_hparams_load</ref>, but also extracts:<itemizedlist>
<listitem><para>RMSNorm epsilon (keys: <computeroutput>rms_norm_eps</computeroutput>, <computeroutput>rms_epsilon</computeroutput>, <computeroutput>layer_norm_eps</computeroutput>)</para>
</listitem><listitem><para>RoPE theta (<computeroutput>rope_theta</computeroutput>)</para>
</listitem><listitem><para>RoPE scaling object (<computeroutput>rope_scaling.type</computeroutput>, <computeroutput>rope_scaling.factor</computeroutput>)</para>
</listitem><listitem><para>tie_word_embeddings (<computeroutput>tie_word_embeddings</computeroutput>)</para>
</listitem></itemizedlist>
</para>
<para>Missing optional fields are filled with conservative defaults:<itemizedlist>
<listitem><para><computeroutput>rms_norm_eps = 1e-5f</computeroutput></para>
</listitem><listitem><para><computeroutput>rope_theta = 10000.0f</computeroutput></para>
</listitem><listitem><para><computeroutput>rope_scaling_type = &quot;&quot;</computeroutput>, <computeroutput>rope_scaling_factor = 1.0f</computeroutput></para>
</listitem><listitem><para><computeroutput>rope_scaling_original_max_position_embeddings = 0</computeroutput></para>
</listitem><listitem><para><computeroutput>tie_word_embeddings = 0</computeroutput></para>
</listitem></itemizedlist>
</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>model_dir</parametername>
</parameternamelist>
<parameterdescription>
<para>Model directory containing HuggingFace artifacts. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>out_ex</parametername>
</parameternamelist>
<parameterdescription>
<para>Output extended hyperparameter struct (written on success). </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>IE_IO_OK on success, negative <ref refid="ie__io_8h_1aabad0c7dd1649d6261de555346eb68d5" kindref="member">ie_io_status_t</ref> on failure. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/runtime/gptoss_hparams.c" line="776" column="5" bodyfile="engine/src/runtime/gptoss_hparams.c" bodystart="776" bodyend="787"/>
        <references refid="gptoss__hparams_8c_1ad063ffeef89d45962268a99b62c6a83f" compoundref="gptoss__hparams_8c" startline="665" endline="751">gptoss_finalize_and_validate</references>
        <references refid="gptoss__hparams_8c_1a44569b4152eff92faec7947f9d7e07a5" compoundref="gptoss__hparams_8c" startline="757" endline="774">gptoss_hparams_load_ex_from_file</references>
        <references refid="gptoss__hparams_8c_1a9eb7cf7fe4ec59cf516cda8a96454e43" compoundref="gptoss__hparams_8c" startline="519" endline="541">gptoss_resolve_config_path</references>
        <references refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239" compoundref="ie__io_8h" startline="65">IE_IO_ERR_ARGS</references>
        <references refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d" compoundref="ie__io_8h" startline="64">IE_IO_OK</references>
        <referencedby refid="gptoss__hparams_8h_1a551745dee25fc47e05d76c79791885a0" compoundref="gptoss__hparams_8c" startline="789" endline="798">gptoss_hparams_load</referencedby>
        <referencedby refid="ie__api_8h_1a84bd87043352946e9d53b0f8a5c4abe0" compoundref="ie__api_8c" startline="535" endline="786">ie_engine_create</referencedby>
      </memberdef>
      <memberdef kind="function" id="gptoss__hparams_8c_1a551745dee25fc47e05d76c79791885a0" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int gptoss_hparams_load</definition>
        <argsstring>(const char *model_dir, ie_gptoss_hparams_t *out_hp)</argsstring>
        <name>gptoss_hparams_load</name>
        <param>
          <type>const char *</type>
          <declname>model_dir</declname>
        </param>
        <param>
          <type><ref refid="ie__infer_8h_1a03b52084d74cc0c81a96a02ae842fcc7" kindref="member">ie_gptoss_hparams_t</ref> *</type>
          <declname>out_hp</declname>
        </param>
        <briefdescription>
<para>Load core hyperparameters from a model directory. </para>
        </briefdescription>
        <detaileddescription>
<para>This function searches for a HuggingFace <computeroutput>config.json</computeroutput> in: 1) <computeroutput>&lt;model_dir&gt;/config.json</computeroutput> 2) <computeroutput>&lt;model_dir&gt;/hf/original/config.json</computeroutput></para>
<para>It fills <ref refid="ie__infer_8h_1a03b52084d74cc0c81a96a02ae842fcc7" kindref="member">ie_gptoss_hparams_t</ref> with:<itemizedlist>
<listitem><para><computeroutput>n_layers</computeroutput> (HF key: <computeroutput>num_hidden_layers</computeroutput>)</para>
</listitem><listitem><para><computeroutput>n_heads</computeroutput> (HF key: <computeroutput>num_attention_heads</computeroutput>)</para>
</listitem><listitem><para><computeroutput>n_kv_heads</computeroutput> (HF key: <computeroutput>num_key_value_heads</computeroutput>, defaults to <computeroutput>n_heads</computeroutput>)</para>
</listitem><listitem><para><computeroutput>d_model</computeroutput> (HF key: <computeroutput>hidden_size</computeroutput>)</para>
</listitem><listitem><para><computeroutput>d_ff</computeroutput> (HF key: <computeroutput>intermediate_size</computeroutput>)</para>
</listitem><listitem><para><computeroutput>vocab_size</computeroutput> (HF key: <computeroutput>vocab_size</computeroutput>)</para>
</listitem><listitem><para><computeroutput>max_seq</computeroutput> (HF key: <computeroutput>max_position_embeddings</computeroutput>)</para>
</listitem></itemizedlist>
</para>
<para>It also derives:<itemizedlist>
<listitem><para><computeroutput>d_head = d_model / n_heads</computeroutput> (must divide evenly)</para>
</listitem></itemizedlist>
</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>model_dir</parametername>
</parameternamelist>
<parameterdescription>
<para>Model directory containing HuggingFace artifacts. </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>out_hp</parametername>
</parameternamelist>
<parameterdescription>
<para>Output hyperparameter struct (written on success). </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>IE_IO_OK on success, negative <ref refid="ie__io_8h_1aabad0c7dd1649d6261de555346eb68d5" kindref="member">ie_io_status_t</ref> on failure. </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="engine/src/runtime/gptoss_hparams.c" line="789" column="5" bodyfile="engine/src/runtime/gptoss_hparams.c" bodystart="789" bodyend="798"/>
        <references refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" compoundref="gptoss__hparams_8h" startline="65">gptoss_hparams_ex_t::core</references>
        <references refid="gptoss__hparams_8c_1ab455fc052d5abd5ec9be138ebd71deaf" compoundref="gptoss__hparams_8c" startline="776" endline="787">gptoss_hparams_load_ex</references>
        <references refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239" compoundref="ie__io_8h" startline="65">IE_IO_ERR_ARGS</references>
        <references refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d" compoundref="ie__io_8h" startline="64">IE_IO_OK</references>
        <referencedby refid="ie__api_8h_1a84bd87043352946e9d53b0f8a5c4abe0" compoundref="ie__api_8c" startline="535" endline="786">ie_engine_create</referencedby>
        <referencedby refid="generate__gptoss_8h_1ae2b49a4109c69ec3ff996adea490690d" compoundref="generate__gptoss_8c" startline="38" endline="213">ie_generate_gptoss</referencedby>
      </memberdef>
    </sectiondef>
    <briefdescription>
<para>HuggingFace config.json loader for GPT-OSS hyperparameters (with IEJSON shape inference). </para>
    </briefdescription>
    <detaileddescription>
<para>This loader is intentionally small and dependency-free (no JSON library).</para>
<para>Why this file exists:<itemizedlist>
<listitem><para>HF config.json for this model reports hidden_size=2880 and num_attention_heads=64, which implies d_head=45 if you do d_model/n_heads.</para>
</listitem><listitem><para>But model.ie.json shows q_proj.weight shape=[4096, 2880] and k_proj.weight shape=[512, 2880], which implies d_head=64 with n_heads=64 and n_kv_heads=8.</para>
</listitem></itemizedlist>
</para>
<para>So we:<itemizedlist>
<listitem><para>read required fields from config.json (layers, heads, vocab, max_position_embeddings, etc),</para>
</listitem><listitem><para>then read model.ie.json to infer:<itemizedlist>
<listitem><para>q_dim, kv_dim, d_model (from q_proj),</para>
</listitem><listitem><para>d_ff (from MoE down_proj blocks),</para>
</listitem><listitem><para>and set d_head = q_dim / n_heads (not d_model / n_heads).</para>
</listitem></itemizedlist>
</para>
</listitem></itemizedlist>
</para>
<para>Also important:<itemizedlist>
<listitem><para>config.json max_position_embeddings may be huge (e.g. 131072). Allocating KV for that will often fail on a dev machine. We clamp max_seq by default. Override with IE_MAX_SEQ environment variable.</para>
</listitem></itemizedlist>
</para>
<para>RoPE scaling integration:<itemizedlist>
<listitem><para>We parse rope_scaling.{type,factor,original_max_position_embeddings} into <ref refid="structgptoss__hparams__ex__t" kindref="compound">gptoss_hparams_ex_t</ref>.</para>
</listitem><listitem><para>If the model config uses &quot;linear&quot; RoPE scaling AND the user did not set IE_ROPE_LINEAR_SCALE / IE_ROPE_POS_SCALE, we export the scale to the RoPE helper by calling setenv(&quot;IE_ROPE_LINEAR_SCALE&quot;, &quot;&lt;factor&gt;&quot;, 0).</para>
</listitem><listitem><para>This keeps scaling &quot;inside the RoPE helper&quot; without changing inference call sites. </para>
</listitem></itemizedlist>
</para>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">/*<sp/>============================================================================</highlight></codeline>
<codeline lineno="2"><highlight class="comment"><sp/>*<sp/>File:<sp/>engine/src/runtime/gptoss_hparams.c</highlight></codeline>
<codeline lineno="3"><highlight class="comment"><sp/>*<sp/>============================================================================</highlight></codeline>
<codeline lineno="4"><highlight class="comment"><sp/>*/</highlight></codeline>
<codeline lineno="38"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>_POSIX_C_SOURCE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="39" refid="gptoss__hparams_8c_1a3024ccd4a9af5109d24e6c57565d74a1" refkind="member"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>_POSIX_C_SOURCE<sp/>200809L</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="40"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="41"><highlight class="normal"></highlight></codeline>
<codeline lineno="42"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="gptoss__hparams_8h" kindref="compound">gptoss_hparams.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="43"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="ie__io_8h" kindref="compound">ie_io.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="44"><highlight class="normal"></highlight></codeline>
<codeline lineno="45"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;ctype.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="46"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;errno.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="47"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;stdint.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="48"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;stdio.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="49"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;stdlib.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="50"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;string.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="51"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;sys/stat.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="52"><highlight class="normal"></highlight></codeline>
<codeline lineno="53"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>============================================================================</highlight></codeline>
<codeline lineno="54"><highlight class="comment"><sp/>*<sp/>Small<sp/>path<sp/>and<sp/>file<sp/>helpers</highlight></codeline>
<codeline lineno="55"><highlight class="comment"><sp/>*<sp/>==========================================================================<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="56"><highlight class="normal"></highlight></codeline>
<codeline lineno="57" refid="gptoss__hparams_8c_1a048a6d2c0cf41b0625d7660629b44d52" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="gptoss__hparams_8c_1a048a6d2c0cf41b0625d7660629b44d52" kindref="member">gptoss_join_path</ref>(</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*out,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>outsz,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*dir,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*file)<sp/>{</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!out<sp/>||<sp/>outsz<sp/>==<sp/>0<sp/>||<sp/>!file<sp/>||<sp/>!*file)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239" kindref="member">IE_IO_ERR_ARGS</ref>;</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/>out[0]<sp/>=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="60"><highlight class="normal"></highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!dir<sp/>||<sp/>!*dir)<sp/>{</highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>snprintf(out,<sp/>outsz,<sp/></highlight><highlight class="stringliteral">&quot;%s&quot;</highlight><highlight class="normal">,<sp/>file);</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>&lt;<sp/>0<sp/>||<sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal">)n<sp/>&gt;=<sp/>outsz)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a9b079e5c6f78861150a9bc91623d8c42" kindref="member">IE_IO_ERR_DECODE</ref>;</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d" kindref="member">IE_IO_OK</ref>;</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="66"><highlight class="normal"></highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>ld<sp/>=<sp/>strlen(dir);</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>need_slash<sp/>=<sp/>(ld<sp/>&gt;<sp/>0<sp/>&amp;&amp;<sp/>dir[ld<sp/>-<sp/>1]<sp/>!=<sp/></highlight><highlight class="charliteral">&apos;/&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="69"><highlight class="normal"></highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>snprintf(out,<sp/>outsz,<sp/>need_slash<sp/>?<sp/></highlight><highlight class="stringliteral">&quot;%s/%s&quot;</highlight><highlight class="normal"><sp/>:<sp/></highlight><highlight class="stringliteral">&quot;%s%s&quot;</highlight><highlight class="normal">,<sp/>dir,<sp/>file);</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>&lt;<sp/>0<sp/>||<sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal">)n<sp/>&gt;=<sp/>outsz)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a9b079e5c6f78861150a9bc91623d8c42" kindref="member">IE_IO_ERR_DECODE</ref>;</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d" kindref="member">IE_IO_OK</ref>;</highlight></codeline>
<codeline lineno="73"><highlight class="normal">}</highlight></codeline>
<codeline lineno="74"><highlight class="normal"></highlight></codeline>
<codeline lineno="75" refid="gptoss__hparams_8c_1a3ae59b784f474d4bd03f4a7b5bcc0d7a" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="gptoss__hparams_8c_1a3ae59b784f474d4bd03f4a7b5bcc0d7a" kindref="member">gptoss_file_exists_regular</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*path)<sp/>{</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!path<sp/>||<sp/>!*path)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">stat<sp/>st;</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(stat(path,<sp/>&amp;st)<sp/>!=<sp/>0)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>S_ISREG(st.st_mode)<sp/>?<sp/>1<sp/>:<sp/>0;</highlight></codeline>
<codeline lineno="80"><highlight class="normal">}</highlight></codeline>
<codeline lineno="81"><highlight class="normal"></highlight></codeline>
<codeline lineno="82" refid="gptoss__hparams_8c_1acf6885297534473f02170d46c830a473" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="gptoss__hparams_8c_1acf6885297534473f02170d46c830a473" kindref="member">gptoss_read_all_text</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*path,<sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>**out_buf,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>*out_len)<sp/>{</highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!path<sp/>||<sp/>!out_buf)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239" kindref="member">IE_IO_ERR_ARGS</ref>;</highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/>*out_buf<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(out_len)<sp/>*out_len<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="86"><highlight class="normal"></highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/>FILE<sp/>*f<sp/>=<sp/>fopen(path,<sp/></highlight><highlight class="stringliteral">&quot;rb&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!f)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987aba0321da4352c7a61ea1bda842bb64d0" kindref="member">IE_IO_ERR_OPEN</ref>;</highlight></codeline>
<codeline lineno="89"><highlight class="normal"></highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(fseek(f,<sp/>0,<sp/>SEEK_END)<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/>fclose(f);</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987aa12fce48fd3eee2bd8a75dc61db150a7" kindref="member">IE_IO_ERR_READ</ref>;</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>ftell(f);</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>&lt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/>fclose(f);</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987aa12fce48fd3eee2bd8a75dc61db150a7" kindref="member">IE_IO_ERR_READ</ref>;</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(fseek(f,<sp/>0,<sp/>SEEK_SET)<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/>fclose(f);</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987aa12fce48fd3eee2bd8a75dc61db150a7" kindref="member">IE_IO_ERR_READ</ref>;</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="103"><highlight class="normal"></highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>size<sp/>=<sp/>(size_t)n;</highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*buf<sp/>=<sp/>(</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*)malloc(size<sp/>+<sp/>1u);</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!buf)<sp/>{</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/>fclose(f);</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a215c4a31864749ed0fce240433824032" kindref="member">IE_IO_ERR_ALLOC</ref>;</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="110"><highlight class="normal"></highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>rd<sp/>=<sp/>fread(buf,<sp/>1,<sp/>size,<sp/>f);</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/>fclose(f);</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rd<sp/>!=<sp/>size)<sp/>{</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/>free(buf);</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987aa12fce48fd3eee2bd8a75dc61db150a7" kindref="member">IE_IO_ERR_READ</ref>;</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="117"><highlight class="normal"></highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Strip<sp/>UTF-8<sp/>BOM<sp/>if<sp/>present.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(size<sp/>&gt;=<sp/>3u<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">)buf[0]<sp/>==<sp/>0xEFu<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">)buf[1]<sp/>==<sp/>0xBBu<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">)buf[2]<sp/>==<sp/>0xBFu)<sp/>{</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/>memmove(buf,<sp/>buf<sp/>+<sp/>3,<sp/>size<sp/>-<sp/>3u);</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/>size<sp/>-=<sp/>3u;</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="126"><highlight class="normal"></highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/>buf[size]<sp/>=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/>*out_buf<sp/>=<sp/>buf;</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(out_len)<sp/>*out_len<sp/>=<sp/>size;</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d" kindref="member">IE_IO_OK</ref>;</highlight></codeline>
<codeline lineno="131"><highlight class="normal">}</highlight></codeline>
<codeline lineno="132"><highlight class="normal"></highlight></codeline>
<codeline lineno="133"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>============================================================================</highlight></codeline>
<codeline lineno="134"><highlight class="comment"><sp/>*<sp/>Relaxed<sp/>JSON<sp/>scanning<sp/>helpers<sp/>(config.json)</highlight></codeline>
<codeline lineno="135"><highlight class="comment"><sp/>*<sp/>==========================================================================<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="136"><highlight class="normal"></highlight></codeline>
<codeline lineno="137" refid="gptoss__hparams_8c_1ad4fb7d4f644b140059ab4b8e24adc768" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="gptoss__hparams_8c_1ad4fb7d4f644b140059ab4b8e24adc768" kindref="member">gptoss_skip_ws</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*p)<sp/>{</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!p)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;<sp/>&apos;</highlight><highlight class="normal"><sp/>||<sp/>*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\t&apos;</highlight><highlight class="normal"><sp/>||<sp/>*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\r&apos;</highlight><highlight class="normal"><sp/>||<sp/>*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\n&apos;</highlight><highlight class="normal">)<sp/>++p;</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>p;</highlight></codeline>
<codeline lineno="141"><highlight class="normal">}</highlight></codeline>
<codeline lineno="142"><highlight class="normal"></highlight></codeline>
<codeline lineno="143" refid="gptoss__hparams_8c_1a0a7a6e8a167338747e3a4b914c01f150" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="gptoss__hparams_8c_1a0a7a6e8a167338747e3a4b914c01f150" kindref="member">gptoss_find_value_start</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*json,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*key)<sp/>{</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!json<sp/>||<sp/>!key<sp/>||<sp/>!*key)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="145"><highlight class="normal"></highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>klen<sp/>=<sp/>strlen(key);</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*p<sp/>=<sp/>json;</highlight></codeline>
<codeline lineno="148"><highlight class="normal"></highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(;;)<sp/>{</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*q<sp/>=<sp/>strstr(p,<sp/></highlight><highlight class="stringliteral">&quot;\&quot;&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!q)<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/>q++;<sp/></highlight><highlight class="comment">/*<sp/>past<sp/>quote<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strncmp(q,<sp/>key,<sp/>klen)<sp/>==<sp/>0<sp/>&amp;&amp;<sp/>q[klen]<sp/>==<sp/></highlight><highlight class="charliteral">&apos;&quot;&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*c<sp/>=<sp/>q<sp/>+<sp/>klen<sp/>+<sp/>1;</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>c<sp/>=<sp/><ref refid="gptoss__hparams_8c_1ad4fb7d4f644b140059ab4b8e24adc768" kindref="member">gptoss_skip_ws</ref>(c);</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!c<sp/>||<sp/>*c<sp/>!=<sp/></highlight><highlight class="charliteral">&apos;:&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p<sp/>=<sp/>q;</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>c++;</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>c<sp/>=<sp/><ref refid="gptoss__hparams_8c_1ad4fb7d4f644b140059ab4b8e24adc768" kindref="member">gptoss_skip_ws</ref>(c);</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>c;</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/>p<sp/>=<sp/>q;</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="167"><highlight class="normal">}</highlight></codeline>
<codeline lineno="168"><highlight class="normal"></highlight></codeline>
<codeline lineno="169" refid="gptoss__hparams_8c_1ac69acc790fac4a66c3839531fb509983" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="gptoss__hparams_8c_1ac69acc790fac4a66c3839531fb509983" kindref="member">gptoss_scan_u32</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*json,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*key,<sp/>uint32_t<sp/>*out_val)<sp/>{</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!json<sp/>||<sp/>!key<sp/>||<sp/>!out_val)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*v<sp/>=<sp/><ref refid="gptoss__hparams_8c_1a0a7a6e8a167338747e3a4b914c01f150" kindref="member">gptoss_find_value_start</ref>(json,<sp/>key);</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!v)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="173"><highlight class="normal"></highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/>errno<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*end<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>x<sp/>=<sp/>strtoul(v,<sp/>&amp;end,<sp/>10);</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(end<sp/>==<sp/>v<sp/>||<sp/>errno<sp/>!=<sp/>0)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(x<sp/>&gt;<sp/>0xFFFFFFFFul)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="179"><highlight class="normal"></highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/>*out_val<sp/>=<sp/>(uint32_t)x;</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="182"><highlight class="normal">}</highlight></codeline>
<codeline lineno="183"><highlight class="normal"></highlight></codeline>
<codeline lineno="184" refid="gptoss__hparams_8c_1a68f469b55bc97b671cedff90eaead661" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="gptoss__hparams_8c_1a68f469b55bc97b671cedff90eaead661" kindref="member">gptoss_scan_f32</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*json,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*key,<sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>*out_val)<sp/>{</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!json<sp/>||<sp/>!key<sp/>||<sp/>!out_val)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*v<sp/>=<sp/><ref refid="gptoss__hparams_8c_1a0a7a6e8a167338747e3a4b914c01f150" kindref="member">gptoss_find_value_start</ref>(json,<sp/>key);</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!v)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="188"><highlight class="normal"></highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/>errno<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*end<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>x<sp/>=<sp/>strtod(v,<sp/>&amp;end);</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(end<sp/>==<sp/>v<sp/>||<sp/>errno<sp/>!=<sp/>0)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="193"><highlight class="normal"></highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/>*out_val<sp/>=<sp/>(float)x;</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="196"><highlight class="normal">}</highlight></codeline>
<codeline lineno="197"><highlight class="normal"></highlight></codeline>
<codeline lineno="198" refid="gptoss__hparams_8c_1a56a0abf4cd1fa4545c84c113acdb6bda" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="gptoss__hparams_8c_1a56a0abf4cd1fa4545c84c113acdb6bda" kindref="member">gptoss_scan_bool</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*json,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*key,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*out_val)<sp/>{</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!json<sp/>||<sp/>!key<sp/>||<sp/>!out_val)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*v<sp/>=<sp/><ref refid="gptoss__hparams_8c_1a0a7a6e8a167338747e3a4b914c01f150" kindref="member">gptoss_find_value_start</ref>(json,<sp/>key);</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!v)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="202"><highlight class="normal"></highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strncmp(v,<sp/></highlight><highlight class="stringliteral">&quot;true&quot;</highlight><highlight class="normal">,<sp/>4)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/>*out_val<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strncmp(v,<sp/></highlight><highlight class="stringliteral">&quot;false&quot;</highlight><highlight class="normal">,<sp/>5)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/>*out_val<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="212"><highlight class="normal">}</highlight></codeline>
<codeline lineno="213"><highlight class="normal"></highlight></codeline>
<codeline lineno="214" refid="gptoss__hparams_8c_1ad69c47a0f316f2e70fcca2eb0d585fcf" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="gptoss__hparams_8c_1ad69c47a0f316f2e70fcca2eb0d585fcf" kindref="member">gptoss_scan_string</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*json,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*key,<sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*out,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>outsz)<sp/>{</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!json<sp/>||<sp/>!key<sp/>||<sp/>!out<sp/>||<sp/>outsz<sp/>==<sp/>0)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/>out[0]<sp/>=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="217"><highlight class="normal"></highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*v<sp/>=<sp/><ref refid="gptoss__hparams_8c_1a0a7a6e8a167338747e3a4b914c01f150" kindref="member">gptoss_find_value_start</ref>(json,<sp/>key);</highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!v)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="220"><highlight class="normal"></highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/>v<sp/>=<sp/><ref refid="gptoss__hparams_8c_1ad4fb7d4f644b140059ab4b8e24adc768" kindref="member">gptoss_skip_ws</ref>(v);</highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!v<sp/>||<sp/>*v<sp/>!=<sp/></highlight><highlight class="charliteral">&apos;&quot;&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/>v++;</highlight></codeline>
<codeline lineno="224"><highlight class="normal"></highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>di<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*p<sp/>=<sp/>v;<sp/>*p;<sp/>++p)<sp/>{</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;&quot;&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*p<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\\&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>*(p<sp/>+<sp/>1);</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>==<sp/></highlight><highlight class="charliteral">&apos;&quot;&apos;</highlight><highlight class="normal"><sp/>||<sp/>n<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\\&apos;</highlight><highlight class="normal"><sp/>||<sp/>n<sp/>==<sp/></highlight><highlight class="charliteral">&apos;/&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(di<sp/>+<sp/>1<sp/>&lt;<sp/>outsz)<sp/>out[di++]<sp/>=<sp/>n;</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p++;</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>!=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(di<sp/>+<sp/>1<sp/>&lt;<sp/>outsz)<sp/>out[di++]<sp/>=<sp/>n;</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p++;</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(di<sp/>+<sp/>1<sp/>&lt;<sp/>outsz)<sp/>out[di++]<sp/>=<sp/>*p;</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="243"><highlight class="normal"></highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/>out[di]<sp/>=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="246"><highlight class="normal">}</highlight></codeline>
<codeline lineno="247"><highlight class="normal"></highlight></codeline>
<codeline lineno="248" refid="gptoss__hparams_8c_1ab9460d8ee96ae89219066f9dee142410" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="gptoss__hparams_8c_1ab9460d8ee96ae89219066f9dee142410" kindref="member">gptoss_scan_object_region</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*json,</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*key,</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>**out_obj,</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>*out_len)<sp/>{</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!json<sp/>||<sp/>!key<sp/>||<sp/>!out_obj<sp/>||<sp/>!out_len)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/>*out_obj<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/>*out_len<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="255"><highlight class="normal"></highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*v<sp/>=<sp/><ref refid="gptoss__hparams_8c_1a0a7a6e8a167338747e3a4b914c01f150" kindref="member">gptoss_find_value_start</ref>(json,<sp/>key);</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!v)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="258"><highlight class="normal"></highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/>v<sp/>=<sp/><ref refid="gptoss__hparams_8c_1ad4fb7d4f644b140059ab4b8e24adc768" kindref="member">gptoss_skip_ws</ref>(v);</highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!v<sp/>||<sp/>*v<sp/>!=<sp/></highlight><highlight class="charliteral">&apos;{&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="261"><highlight class="normal"></highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*start<sp/>=<sp/>v;</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>depth<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>in_str<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>esc<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="266"><highlight class="normal"></highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*p<sp/>=<sp/>v;<sp/>*p;<sp/>++p)<sp/>{</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>ch<sp/>=<sp/>*p;</highlight></codeline>
<codeline lineno="269"><highlight class="normal"></highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(in_str)<sp/>{</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(esc)<sp/>{</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>esc<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ch<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\\&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>esc<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ch<sp/>==<sp/></highlight><highlight class="charliteral">&apos;&quot;&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>in_str<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="285"><highlight class="normal"></highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ch<sp/>==<sp/></highlight><highlight class="charliteral">&apos;&quot;&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>in_str<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ch<sp/>==<sp/></highlight><highlight class="charliteral">&apos;{&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>depth++;</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ch<sp/>==<sp/></highlight><highlight class="charliteral">&apos;}&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>depth--;</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(depth<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*out_obj<sp/>=<sp/>start;</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*out_len<sp/>=<sp/>(size_t)((p<sp/>+<sp/>1)<sp/>-<sp/>start);</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="304"><highlight class="normal"></highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="306"><highlight class="normal">}</highlight></codeline>
<codeline lineno="307"><highlight class="normal"></highlight></codeline>
<codeline lineno="308"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>============================================================================</highlight></codeline>
<codeline lineno="309"><highlight class="comment"><sp/>*<sp/>IEJSON<sp/>scanning<sp/>helpers<sp/>(model.ie.json)</highlight></codeline>
<codeline lineno="310"><highlight class="comment"><sp/>*<sp/>==========================================================================<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="311"><highlight class="normal"></highlight></codeline>
<codeline lineno="312" refid="gptoss__hparams_8c_1a7c77db21315706297824ec7ac7155f0e" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="gptoss__hparams_8c_1a7c77db21315706297824ec7ac7155f0e" kindref="member">iejson_find_tensor_region</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*json,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*tensor_name)<sp/>{</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!json<sp/>||<sp/>!tensor_name<sp/>||<sp/>!*tensor_name)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="314"><highlight class="normal"></highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>nlen<sp/>=<sp/>strlen(tensor_name);</highlight></codeline>
<codeline lineno="316"><highlight class="normal"></highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>need1<sp/>=<sp/>strlen(</highlight><highlight class="stringliteral">&quot;\&quot;name\&quot;:\&quot;\&quot;&quot;</highlight><highlight class="normal">)<sp/>+<sp/>nlen;</highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*needle1<sp/>=<sp/>(</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*)malloc(need1<sp/>+<sp/>1u);</highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!needle1)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/>snprintf(needle1,<sp/>need1<sp/>+<sp/>1u,<sp/></highlight><highlight class="stringliteral">&quot;\&quot;name\&quot;:\&quot;%s\&quot;&quot;</highlight><highlight class="normal">,<sp/>tensor_name);</highlight></codeline>
<codeline lineno="321"><highlight class="normal"></highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*p<sp/>=<sp/>strstr(json,<sp/>needle1);</highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/>free(needle1);</highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(p)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>p;</highlight></codeline>
<codeline lineno="325"><highlight class="normal"></highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>need2<sp/>=<sp/>strlen(</highlight><highlight class="stringliteral">&quot;\&quot;name\&quot;:<sp/>\&quot;\&quot;&quot;</highlight><highlight class="normal">)<sp/>+<sp/>nlen;</highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*needle2<sp/>=<sp/>(</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*)malloc(need2<sp/>+<sp/>1u);</highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!needle2)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/>snprintf(needle2,<sp/>need2<sp/>+<sp/>1u,<sp/></highlight><highlight class="stringliteral">&quot;\&quot;name\&quot;:<sp/>\&quot;%s\&quot;&quot;</highlight><highlight class="normal">,<sp/>tensor_name);</highlight></codeline>
<codeline lineno="330"><highlight class="normal"></highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/>p<sp/>=<sp/>strstr(json,<sp/>needle2);</highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/>free(needle2);</highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>p;</highlight></codeline>
<codeline lineno="334"><highlight class="normal">}</highlight></codeline>
<codeline lineno="335"><highlight class="normal"></highlight></codeline>
<codeline lineno="336" refid="gptoss__hparams_8c_1a65ed371e841b3ba8a0e8ee5c7fb25fdb" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="gptoss__hparams_8c_1a65ed371e841b3ba8a0e8ee5c7fb25fdb" kindref="member">iejson_parse_shape_dims</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*p,<sp/>uint32_t<sp/>*dims,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>max_dims,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>*out_ndims)<sp/>{</highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!p<sp/>||<sp/>!dims<sp/>||<sp/>max_dims<sp/>==<sp/>0<sp/>||<sp/>!out_ndims)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/>*out_ndims<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="339"><highlight class="normal"></highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*s<sp/>=<sp/>strstr(p,<sp/></highlight><highlight class="stringliteral">&quot;\&quot;shape\&quot;&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!s)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/>s<sp/>=<sp/>strchr(s,<sp/></highlight><highlight class="charliteral">&apos;[&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!s)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/>s++;</highlight></codeline>
<codeline lineno="345"><highlight class="normal"></highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>nd<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(;;)<sp/>{</highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/><sp/><sp/>s<sp/>=<sp/><ref refid="gptoss__hparams_8c_1ad4fb7d4f644b140059ab4b8e24adc768" kindref="member">gptoss_skip_ws</ref>(s);</highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!s<sp/>||<sp/>!*s)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*s<sp/>==<sp/></highlight><highlight class="charliteral">&apos;]&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!isdigit((</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">)*s))<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="352"><highlight class="normal"></highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/>errno<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*end<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>v<sp/>=<sp/>strtoul(s,<sp/>&amp;end,<sp/>10);</highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(end<sp/>==<sp/>s<sp/>||<sp/>errno<sp/>!=<sp/>0)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(v<sp/>&gt;<sp/>0xFFFFFFFFul)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="358"><highlight class="normal"></highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(nd<sp/>&lt;<sp/>max_dims)<sp/>dims[nd]<sp/>=<sp/>(uint32_t)v;</highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/><sp/><sp/>nd++;</highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/>s<sp/>=<sp/>end;</highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/>s<sp/>=<sp/><ref refid="gptoss__hparams_8c_1ad4fb7d4f644b140059ab4b8e24adc768" kindref="member">gptoss_skip_ws</ref>(s);</highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*s<sp/>==<sp/></highlight><highlight class="charliteral">&apos;,&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>s++;</highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(*s<sp/>==<sp/></highlight><highlight class="charliteral">&apos;]&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="369"><highlight class="normal"></highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/>*out_ndims<sp/>=<sp/>nd;</highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="372"><highlight class="normal">}</highlight></codeline>
<codeline lineno="373"><highlight class="normal"></highlight></codeline>
<codeline lineno="374" refid="gptoss__hparams_8c_1a193ca0f7caa47a455b05ad9286cec2cc" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="gptoss__hparams_8c_1a193ca0f7caa47a455b05ad9286cec2cc" kindref="member">gptoss_iejson_get_shape</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*iejson,</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*tensor_name,</highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint32_t<sp/>*dims,</highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>max_dims,</highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>*out_ndims)<sp/>{</highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!iejson<sp/>||<sp/>!tensor_name<sp/>||<sp/>!dims<sp/>||<sp/>!out_ndims)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/>*out_ndims<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="381"><highlight class="normal"></highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*reg<sp/>=<sp/><ref refid="gptoss__hparams_8c_1a7c77db21315706297824ec7ac7155f0e" kindref="member">iejson_find_tensor_region</ref>(iejson,<sp/>tensor_name);</highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!reg)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="384"><highlight class="normal"></highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="gptoss__hparams_8c_1a65ed371e841b3ba8a0e8ee5c7fb25fdb" kindref="member">iejson_parse_shape_dims</ref>(reg,<sp/>dims,<sp/>max_dims,<sp/>out_ndims);</highlight></codeline>
<codeline lineno="386"><highlight class="normal">}</highlight></codeline>
<codeline lineno="387"><highlight class="normal"></highlight></codeline>
<codeline lineno="388"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>============================================================================</highlight></codeline>
<codeline lineno="389"><highlight class="comment"><sp/>*<sp/>Parsing<sp/>and<sp/>validation</highlight></codeline>
<codeline lineno="390"><highlight class="comment"><sp/>*<sp/>==========================================================================<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="391"><highlight class="normal"></highlight></codeline>
<codeline lineno="392" refid="gptoss__hparams_8c_1a1fc228937b1158daeec7c8473268ef6d" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="gptoss__hparams_8c_1a1fc228937b1158daeec7c8473268ef6d" kindref="member">gptoss_hparams_ex_defaults</ref>(<ref refid="structgptoss__hparams__ex__t" kindref="compound">gptoss_hparams_ex_t</ref><sp/>*out_ex)<sp/>{</highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/>memset(out_ex,<sp/>0,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(*out_ex));</highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/>out_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a7c485ce5ab9f23318dd01590e53d5896" kindref="member">rms_norm_eps</ref><sp/>=<sp/>1.0e-5f;</highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/>out_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1ab2801efbde312a24d000be04f19e50a5" kindref="member">rope_theta</ref><sp/>=<sp/>10000.0f;</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/>out_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1ab9e6c60c04ee4743452fdc0abc786090" kindref="member">rope_scaling_type</ref>[0]<sp/>=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/>out_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a6506926ad8c409cddfea5c4e819ee5e6" kindref="member">rope_scaling_factor</ref><sp/>=<sp/>1.0f;</highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/>out_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a0482634a73ae325d678773a90a9488bb" kindref="member">rope_scaling_original_max_position_embeddings</ref><sp/>=<sp/>0u;</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/>out_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a467ba148f9ecb5525cd19fb3dbfff12b" kindref="member">tie_word_embeddings</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="400"><highlight class="normal">}</highlight></codeline>
<codeline lineno="401"><highlight class="normal"></highlight></codeline>
<codeline lineno="402" refid="gptoss__hparams_8c_1aa06d7bffe4f02c80ed7d45c7dcbffead" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>uint32_t<sp/><ref refid="gptoss__hparams_8c_1aa06d7bffe4f02c80ed7d45c7dcbffead" kindref="member">gptoss_env_u32</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*name,<sp/>uint32_t<sp/>defval)<sp/>{</highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*s<sp/>=<sp/>getenv(name);</highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!s<sp/>||<sp/>!*s)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>defval;</highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/>errno<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*end<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>v<sp/>=<sp/>strtoul(s,<sp/>&amp;end,<sp/>10);</highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(end<sp/>==<sp/>s<sp/>||<sp/>errno<sp/>!=<sp/>0)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>defval;</highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(v<sp/>==<sp/>0ul<sp/>||<sp/>v<sp/>&gt;<sp/>0xFFFFFFFFul)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>defval;</highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(uint32_t)v;</highlight></codeline>
<codeline lineno="411"><highlight class="normal">}</highlight></codeline>
<codeline lineno="412"><highlight class="normal"></highlight></codeline>
<codeline lineno="413" refid="gptoss__hparams_8c_1aeb01d26508e2161e666f67d078c810b4" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="gptoss__hparams_8c_1aeb01d26508e2161e666f67d078c810b4" kindref="member">gptoss_apply_rope_scaling_env_if_absent</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="structgptoss__hparams__ex__t" kindref="compound">gptoss_hparams_ex_t</ref><sp/>*ex)<sp/>{</highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!ex)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="415"><highlight class="normal"></highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>User<sp/>override<sp/>wins.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(getenv(</highlight><highlight class="stringliteral">&quot;IE_ROPE_LINEAR_SCALE&quot;</highlight><highlight class="normal">)<sp/>||<sp/>getenv(</highlight><highlight class="stringliteral">&quot;IE_ROPE_POS_SCALE&quot;</highlight><highlight class="normal">))<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="418"><highlight class="normal"></highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ex-&gt;<ref refid="structgptoss__hparams__ex__t_1ab9e6c60c04ee4743452fdc0abc786090" kindref="member">rope_scaling_type</ref>[0]<sp/>==<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!(ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a6506926ad8c409cddfea5c4e819ee5e6" kindref="member">rope_scaling_factor</ref><sp/>&gt;<sp/>0.0f))<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="421"><highlight class="normal"></highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Only<sp/>&quot;linear&quot;<sp/>is<sp/>a<sp/>constant<sp/>position<sp/>rescale.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strcmp(ex-&gt;<ref refid="structgptoss__hparams__ex__t_1ab9e6c60c04ee4743452fdc0abc786090" kindref="member">rope_scaling_type</ref>,<sp/></highlight><highlight class="stringliteral">&quot;linear&quot;</highlight><highlight class="normal">)<sp/>!=<sp/>0)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="424"><highlight class="normal"></highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>tmp[64];</highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>snprintf(tmp,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(tmp),<sp/></highlight><highlight class="stringliteral">&quot;%.9g&quot;</highlight><highlight class="normal">,<sp/>(</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">)ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a6506926ad8c409cddfea5c4e819ee5e6" kindref="member">rope_scaling_factor</ref>);</highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>&lt;=<sp/>0<sp/>||<sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal">)n<sp/>&gt;=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(tmp))<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="428"><highlight class="normal"></highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(setenv(</highlight><highlight class="stringliteral">&quot;IE_ROPE_LINEAR_SCALE&quot;</highlight><highlight class="normal">,<sp/>tmp,<sp/>0)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(stderr,</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;[gptoss_hparams]<sp/>Note:<sp/>exported<sp/>RoPE<sp/>linear<sp/>scaling<sp/>factor=%s<sp/>to<sp/>IE_ROPE_LINEAR_SCALE.\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tmp);</highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="434"><highlight class="normal">}</highlight></codeline>
<codeline lineno="435"><highlight class="normal"></highlight></codeline>
<codeline lineno="436" refid="gptoss__hparams_8c_1a877e2aad4bef17bb60c9d93f5fcb7d82" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="gptoss__hparams_8c_1a877e2aad4bef17bb60c9d93f5fcb7d82" kindref="member">gptoss_parse_config_json</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*json,<sp/><ref refid="structgptoss__hparams__ex__t" kindref="compound">gptoss_hparams_ex_t</ref><sp/>*out_ex)<sp/>{</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!json<sp/>||<sp/>!out_ex)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239" kindref="member">IE_IO_ERR_ARGS</ref>;</highlight></codeline>
<codeline lineno="438"><highlight class="normal"></highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/>uint32_t<sp/>n_layers<sp/>=<sp/>0,<sp/>n_heads<sp/>=<sp/>0,<sp/>d_model_cfg<sp/>=<sp/>0,<sp/>d_ff_cfg<sp/>=<sp/>0,<sp/>vocab_cfg<sp/>=<sp/>0,<sp/>max_seq_cfg<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="440"><highlight class="normal"></highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="gptoss__hparams_8c_1ac69acc790fac4a66c3839531fb509983" kindref="member">gptoss_scan_u32</ref>(json,<sp/></highlight><highlight class="stringliteral">&quot;num_hidden_layers&quot;</highlight><highlight class="normal">,<sp/>&amp;n_layers)<sp/>!=<sp/>1)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9" kindref="member">IE_IO_ERR_JSON</ref>;</highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="gptoss__hparams_8c_1ac69acc790fac4a66c3839531fb509983" kindref="member">gptoss_scan_u32</ref>(json,<sp/></highlight><highlight class="stringliteral">&quot;num_attention_heads&quot;</highlight><highlight class="normal">,<sp/>&amp;n_heads)<sp/>!=<sp/>1)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9" kindref="member">IE_IO_ERR_JSON</ref>;</highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="gptoss__hparams_8c_1ac69acc790fac4a66c3839531fb509983" kindref="member">gptoss_scan_u32</ref>(json,<sp/></highlight><highlight class="stringliteral">&quot;hidden_size&quot;</highlight><highlight class="normal">,<sp/>&amp;d_model_cfg)<sp/>!=<sp/>1)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9" kindref="member">IE_IO_ERR_JSON</ref>;</highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="gptoss__hparams_8c_1ac69acc790fac4a66c3839531fb509983" kindref="member">gptoss_scan_u32</ref>(json,<sp/></highlight><highlight class="stringliteral">&quot;intermediate_size&quot;</highlight><highlight class="normal">,<sp/>&amp;d_ff_cfg)<sp/>!=<sp/>1)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9" kindref="member">IE_IO_ERR_JSON</ref>;</highlight></codeline>
<codeline lineno="445"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="gptoss__hparams_8c_1ac69acc790fac4a66c3839531fb509983" kindref="member">gptoss_scan_u32</ref>(json,<sp/></highlight><highlight class="stringliteral">&quot;vocab_size&quot;</highlight><highlight class="normal">,<sp/>&amp;vocab_cfg)<sp/>!=<sp/>1)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9" kindref="member">IE_IO_ERR_JSON</ref>;</highlight></codeline>
<codeline lineno="446"><highlight class="normal"></highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="gptoss__hparams_8c_1ac69acc790fac4a66c3839531fb509983" kindref="member">gptoss_scan_u32</ref>(json,<sp/></highlight><highlight class="stringliteral">&quot;max_position_embeddings&quot;</highlight><highlight class="normal">,<sp/>&amp;max_seq_cfg)<sp/>!=<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="gptoss__hparams_8c_1ac69acc790fac4a66c3839531fb509983" kindref="member">gptoss_scan_u32</ref>(json,<sp/></highlight><highlight class="stringliteral">&quot;max_seq_len&quot;</highlight><highlight class="normal">,<sp/>&amp;max_seq_cfg)<sp/>!=<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="gptoss__hparams_8c_1ac69acc790fac4a66c3839531fb509983" kindref="member">gptoss_scan_u32</ref>(json,<sp/></highlight><highlight class="stringliteral">&quot;seq_length&quot;</highlight><highlight class="normal">,<sp/>&amp;max_seq_cfg)<sp/>!=<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9" kindref="member">IE_IO_ERR_JSON</ref>;</highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="454"><highlight class="normal"></highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/>uint32_t<sp/>n_kv_heads<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="gptoss__hparams_8c_1ac69acc790fac4a66c3839531fb509983" kindref="member">gptoss_scan_u32</ref>(json,<sp/></highlight><highlight class="stringliteral">&quot;num_key_value_heads&quot;</highlight><highlight class="normal">,<sp/>&amp;n_kv_heads)<sp/>!=<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/>n_kv_heads<sp/>=<sp/>n_heads;</highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="459"><highlight class="normal"></highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n_layers<sp/>==<sp/>0<sp/>||<sp/>n_heads<sp/>==<sp/>0<sp/>||<sp/>n_kv_heads<sp/>==<sp/>0<sp/>||<sp/>d_model_cfg<sp/>==<sp/>0<sp/>||<sp/>d_ff_cfg<sp/>==<sp/>0<sp/>||</highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>vocab_cfg<sp/>==<sp/>0<sp/>||<sp/>max_seq_cfg<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9" kindref="member">IE_IO_ERR_JSON</ref>;</highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="464"><highlight class="normal"></highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/>out_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a9f7592ff0ef97a90e4bf510d7323c1e2" kindref="member">n_layers</ref><sp/>=<sp/>n_layers;</highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/>out_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a5176af7af6c6d8a4c516f7ec1e6be202" kindref="member">n_heads</ref><sp/>=<sp/>n_heads;</highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/>out_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a89acca54a15e45183b174270c137d5ca" kindref="member">n_kv_heads</ref><sp/>=<sp/>n_kv_heads;</highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/>out_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a33df15e8279a7c66842c295db4d955ee" kindref="member">d_model</ref><sp/>=<sp/>d_model_cfg;</highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/>out_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a6586576d1feb432bf7083cc3f35702d5" kindref="member">d_ff</ref><sp/>=<sp/>d_ff_cfg;</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/>out_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a92d6a3ba26bf70874cd58b8aebfe688c" kindref="member">vocab_size</ref><sp/>=<sp/>vocab_cfg;</highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/>out_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1aab0c01be581031776f5fa61bbb10de24" kindref="member">max_seq</ref><sp/>=<sp/>max_seq_cfg;</highlight></codeline>
<codeline lineno="472"><highlight class="normal"></highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/>(void)<ref refid="gptoss__hparams_8c_1a56a0abf4cd1fa4545c84c113acdb6bda" kindref="member">gptoss_scan_bool</ref>(json,<sp/></highlight><highlight class="stringliteral">&quot;tie_word_embeddings&quot;</highlight><highlight class="normal">,<sp/>&amp;out_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a467ba148f9ecb5525cd19fb3dbfff12b" kindref="member">tie_word_embeddings</ref>);</highlight></codeline>
<codeline lineno="474"><highlight class="normal"></highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>eps<sp/>=<sp/>0.0f;</highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="gptoss__hparams_8c_1a68f469b55bc97b671cedff90eaead661" kindref="member">gptoss_scan_f32</ref>(json,<sp/></highlight><highlight class="stringliteral">&quot;rms_norm_eps&quot;</highlight><highlight class="normal">,<sp/>&amp;eps)<sp/>==<sp/>1)<sp/>out_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a7c485ce5ab9f23318dd01590e53d5896" kindref="member">rms_norm_eps</ref><sp/>=<sp/>eps;</highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="gptoss__hparams_8c_1a68f469b55bc97b671cedff90eaead661" kindref="member">gptoss_scan_f32</ref>(json,<sp/></highlight><highlight class="stringliteral">&quot;rms_epsilon&quot;</highlight><highlight class="normal">,<sp/>&amp;eps)<sp/>==<sp/>1)<sp/>out_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a7c485ce5ab9f23318dd01590e53d5896" kindref="member">rms_norm_eps</ref><sp/>=<sp/>eps;</highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="gptoss__hparams_8c_1a68f469b55bc97b671cedff90eaead661" kindref="member">gptoss_scan_f32</ref>(json,<sp/></highlight><highlight class="stringliteral">&quot;layer_norm_eps&quot;</highlight><highlight class="normal">,<sp/>&amp;eps)<sp/>==<sp/>1)<sp/>out_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a7c485ce5ab9f23318dd01590e53d5896" kindref="member">rms_norm_eps</ref><sp/>=<sp/>eps;</highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="481"><highlight class="normal"></highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>theta<sp/>=<sp/>0.0f;</highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="gptoss__hparams_8c_1a68f469b55bc97b671cedff90eaead661" kindref="member">gptoss_scan_f32</ref>(json,<sp/></highlight><highlight class="stringliteral">&quot;rope_theta&quot;</highlight><highlight class="normal">,<sp/>&amp;theta)<sp/>==<sp/>1)<sp/>out_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1ab2801efbde312a24d000be04f19e50a5" kindref="member">rope_theta</ref><sp/>=<sp/>theta;</highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="486"><highlight class="normal"></highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*obj<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>obj_len<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="gptoss__hparams_8c_1ab9460d8ee96ae89219066f9dee142410" kindref="member">gptoss_scan_object_region</ref>(json,<sp/></highlight><highlight class="stringliteral">&quot;rope_scaling&quot;</highlight><highlight class="normal">,<sp/>&amp;obj,<sp/>&amp;obj_len)<sp/>==<sp/>1<sp/>&amp;&amp;<sp/>obj<sp/>&amp;&amp;<sp/>obj_len<sp/>&gt;<sp/>2)<sp/>{</highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>got_type<sp/>=<sp/><ref refid="gptoss__hparams_8c_1ad69c47a0f316f2e70fcca2eb0d585fcf" kindref="member">gptoss_scan_string</ref>(obj,<sp/></highlight><highlight class="stringliteral">&quot;type&quot;</highlight><highlight class="normal">,<sp/>out_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1ab9e6c60c04ee4743452fdc0abc786090" kindref="member">rope_scaling_type</ref>,</highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(out_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1ab9e6c60c04ee4743452fdc0abc786090" kindref="member">rope_scaling_type</ref>));</highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(got_type<sp/>!=<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(void)<ref refid="gptoss__hparams_8c_1ad69c47a0f316f2e70fcca2eb0d585fcf" kindref="member">gptoss_scan_string</ref>(obj,<sp/></highlight><highlight class="stringliteral">&quot;rope_type&quot;</highlight><highlight class="normal">,<sp/>out_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1ab9e6c60c04ee4743452fdc0abc786090" kindref="member">rope_scaling_type</ref>,</highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(out_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1ab9e6c60c04ee4743452fdc0abc786090" kindref="member">rope_scaling_type</ref>));</highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="497"><highlight class="normal"></highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>factor<sp/>=<sp/>0.0f;</highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>got_factor<sp/>=<sp/><ref refid="gptoss__hparams_8c_1a68f469b55bc97b671cedff90eaead661" kindref="member">gptoss_scan_f32</ref>(obj,<sp/></highlight><highlight class="stringliteral">&quot;factor&quot;</highlight><highlight class="normal">,<sp/>&amp;factor);</highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(got_factor<sp/>!=<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>got_factor<sp/>=<sp/><ref refid="gptoss__hparams_8c_1a68f469b55bc97b671cedff90eaead661" kindref="member">gptoss_scan_f32</ref>(obj,<sp/></highlight><highlight class="stringliteral">&quot;scaling_factor&quot;</highlight><highlight class="normal">,<sp/>&amp;factor);</highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(got_factor<sp/>==<sp/>1<sp/>&amp;&amp;<sp/>factor<sp/>&gt;<sp/>0.0f)<sp/>out_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a6506926ad8c409cddfea5c4e819ee5e6" kindref="member">rope_scaling_factor</ref><sp/>=<sp/>factor;</highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="506"><highlight class="normal"></highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint32_t<sp/>orig<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="gptoss__hparams_8c_1ac69acc790fac4a66c3839531fb509983" kindref="member">gptoss_scan_u32</ref>(obj,<sp/></highlight><highlight class="stringliteral">&quot;original_max_position_embeddings&quot;</highlight><highlight class="normal">,<sp/>&amp;orig)<sp/>==<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>out_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a0482634a73ae325d678773a90a9488bb" kindref="member">rope_scaling_original_max_position_embeddings</ref><sp/>=<sp/>orig;</highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="515"><highlight class="normal"></highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d" kindref="member">IE_IO_OK</ref>;</highlight></codeline>
<codeline lineno="517"><highlight class="normal">}</highlight></codeline>
<codeline lineno="518"><highlight class="normal"></highlight></codeline>
<codeline lineno="519" refid="gptoss__hparams_8c_1a9eb7cf7fe4ec59cf516cda8a96454e43" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="gptoss__hparams_8c_1a9eb7cf7fe4ec59cf516cda8a96454e43" kindref="member">gptoss_resolve_config_path</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*model_dir,<sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*out_path,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>out_sz)<sp/>{</highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!model_dir<sp/>||<sp/>!*model_dir<sp/>||<sp/>!out_path<sp/>||<sp/>out_sz<sp/>==<sp/>0)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239" kindref="member">IE_IO_ERR_ARGS</ref>;</highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/>out_path[0]<sp/>=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="522"><highlight class="normal"></highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>p1[1024];</highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>p2[1024];</highlight></codeline>
<codeline lineno="525"><highlight class="normal"></highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="gptoss__hparams_8c_1a048a6d2c0cf41b0625d7660629b44d52" kindref="member">gptoss_join_path</ref>(p1,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(p1),<sp/>model_dir,<sp/></highlight><highlight class="stringliteral">&quot;config.json&quot;</highlight><highlight class="normal">)<sp/>!=<sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d" kindref="member">IE_IO_OK</ref>)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a9b079e5c6f78861150a9bc91623d8c42" kindref="member">IE_IO_ERR_DECODE</ref>;</highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="gptoss__hparams_8c_1a3ae59b784f474d4bd03f4a7b5bcc0d7a" kindref="member">gptoss_file_exists_regular</ref>(p1))<sp/>{</highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>snprintf(out_path,<sp/>out_sz,<sp/></highlight><highlight class="stringliteral">&quot;%s&quot;</highlight><highlight class="normal">,<sp/>p1);</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>&lt;<sp/>0<sp/>||<sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal">)n<sp/>&gt;=<sp/>out_sz)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a9b079e5c6f78861150a9bc91623d8c42" kindref="member">IE_IO_ERR_DECODE</ref>;</highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d" kindref="member">IE_IO_OK</ref>;</highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="532"><highlight class="normal"></highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="gptoss__hparams_8c_1a048a6d2c0cf41b0625d7660629b44d52" kindref="member">gptoss_join_path</ref>(p2,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(p2),<sp/>model_dir,<sp/></highlight><highlight class="stringliteral">&quot;hf/original/config.json&quot;</highlight><highlight class="normal">)<sp/>!=<sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d" kindref="member">IE_IO_OK</ref>)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a9b079e5c6f78861150a9bc91623d8c42" kindref="member">IE_IO_ERR_DECODE</ref>;</highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="gptoss__hparams_8c_1a3ae59b784f474d4bd03f4a7b5bcc0d7a" kindref="member">gptoss_file_exists_regular</ref>(p2))<sp/>{</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>snprintf(out_path,<sp/>out_sz,<sp/></highlight><highlight class="stringliteral">&quot;%s&quot;</highlight><highlight class="normal">,<sp/>p2);</highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>&lt;<sp/>0<sp/>||<sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal">)n<sp/>&gt;=<sp/>out_sz)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a9b079e5c6f78861150a9bc91623d8c42" kindref="member">IE_IO_ERR_DECODE</ref>;</highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d" kindref="member">IE_IO_OK</ref>;</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="539"><highlight class="normal"></highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987aba0321da4352c7a61ea1bda842bb64d0" kindref="member">IE_IO_ERR_OPEN</ref>;</highlight></codeline>
<codeline lineno="541"><highlight class="normal">}</highlight></codeline>
<codeline lineno="542"><highlight class="normal"></highlight></codeline>
<codeline lineno="543" refid="gptoss__hparams_8c_1a04a8a888cb08a1f787ace99dd860823b" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="gptoss__hparams_8c_1a04a8a888cb08a1f787ace99dd860823b" kindref="member">gptoss_resolve_iejson_path</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*model_dir,<sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*out_path,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>out_sz)<sp/>{</highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!model_dir<sp/>||<sp/>!*model_dir<sp/>||<sp/>!out_path<sp/>||<sp/>out_sz<sp/>==<sp/>0)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239" kindref="member">IE_IO_ERR_ARGS</ref>;</highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/>out_path[0]<sp/>=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="546"><highlight class="normal"></highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>p1[1024];</highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="gptoss__hparams_8c_1a048a6d2c0cf41b0625d7660629b44d52" kindref="member">gptoss_join_path</ref>(p1,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(p1),<sp/>model_dir,<sp/></highlight><highlight class="stringliteral">&quot;model.ie.json&quot;</highlight><highlight class="normal">)<sp/>!=<sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d" kindref="member">IE_IO_OK</ref>)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a9b079e5c6f78861150a9bc91623d8c42" kindref="member">IE_IO_ERR_DECODE</ref>;</highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="gptoss__hparams_8c_1a3ae59b784f474d4bd03f4a7b5bcc0d7a" kindref="member">gptoss_file_exists_regular</ref>(p1))<sp/>{</highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>n<sp/>=<sp/>snprintf(out_path,<sp/>out_sz,<sp/></highlight><highlight class="stringliteral">&quot;%s&quot;</highlight><highlight class="normal">,<sp/>p1);</highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>&lt;<sp/>0<sp/>||<sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal">)n<sp/>&gt;=<sp/>out_sz)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a9b079e5c6f78861150a9bc91623d8c42" kindref="member">IE_IO_ERR_DECODE</ref>;</highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d" kindref="member">IE_IO_OK</ref>;</highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="554"><highlight class="normal"></highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987aba0321da4352c7a61ea1bda842bb64d0" kindref="member">IE_IO_ERR_OPEN</ref>;</highlight></codeline>
<codeline lineno="556"><highlight class="normal">}</highlight></codeline>
<codeline lineno="557"><highlight class="normal"></highlight></codeline>
<codeline lineno="558" refid="gptoss__hparams_8c_1ab3bd6e26a9370d7074eec8646171042c" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="gptoss__hparams_8c_1ab3bd6e26a9370d7074eec8646171042c" kindref="member">gptoss_apply_iejson_inference</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*model_dir,<sp/><ref refid="structgptoss__hparams__ex__t" kindref="compound">gptoss_hparams_ex_t</ref><sp/>*io_ex)<sp/>{</highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!model_dir<sp/>||<sp/>!io_ex)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239" kindref="member">IE_IO_ERR_ARGS</ref>;</highlight></codeline>
<codeline lineno="560"><highlight class="normal"></highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>iep[1024];</highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>r<sp/>=<sp/><ref refid="gptoss__hparams_8c_1a04a8a888cb08a1f787ace99dd860823b" kindref="member">gptoss_resolve_iejson_path</ref>(model_dir,<sp/>iep,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(iep));</highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(r<sp/>!=<sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d" kindref="member">IE_IO_OK</ref>)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>r;</highlight></codeline>
<codeline lineno="564"><highlight class="normal"></highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*buf<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="566"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>len<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>rc<sp/>=<sp/><ref refid="gptoss__hparams_8c_1acf6885297534473f02170d46c830a473" kindref="member">gptoss_read_all_text</ref>(iep,<sp/>&amp;buf,<sp/>&amp;len);</highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rc<sp/>!=<sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d" kindref="member">IE_IO_OK</ref>)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>rc;</highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!buf<sp/>||<sp/>len<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/><sp/><sp/>free(buf);</highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987aa12fce48fd3eee2bd8a75dc61db150a7" kindref="member">IE_IO_ERR_READ</ref>;</highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="573"><highlight class="normal"></highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Infer<sp/>q_dim,<sp/>kv_dim,<sp/>and<sp/>d_model<sp/>from<sp/>q_proj/k_proj<sp/>shapes.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/>uint32_t<sp/>q_dims[4]<sp/>=<sp/>{0,<sp/>0,<sp/>0,<sp/>0};</highlight></codeline>
<codeline lineno="576"><highlight class="normal"><sp/><sp/>uint32_t<sp/>k_dims[4]<sp/>=<sp/>{0,<sp/>0,<sp/>0,<sp/>0};</highlight></codeline>
<codeline lineno="577"><highlight class="normal"><sp/><sp/>uint32_t<sp/>v_dims[4]<sp/>=<sp/>{0,<sp/>0,<sp/>0,<sp/>0};</highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>qn<sp/>=<sp/>0,<sp/>kn<sp/>=<sp/>0,<sp/>vn<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="579"><highlight class="normal"></highlight></codeline>
<codeline lineno="580"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>has_q<sp/>=<sp/><ref refid="gptoss__hparams_8c_1a193ca0f7caa47a455b05ad9286cec2cc" kindref="member">gptoss_iejson_get_shape</ref>(buf,<sp/></highlight><highlight class="stringliteral">&quot;model.layers.0.self_attn.q_proj.weight&quot;</highlight><highlight class="normal">,<sp/>q_dims,<sp/>4,<sp/>&amp;qn);</highlight></codeline>
<codeline lineno="581"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>has_k<sp/>=<sp/><ref refid="gptoss__hparams_8c_1a193ca0f7caa47a455b05ad9286cec2cc" kindref="member">gptoss_iejson_get_shape</ref>(buf,<sp/></highlight><highlight class="stringliteral">&quot;model.layers.0.self_attn.k_proj.weight&quot;</highlight><highlight class="normal">,<sp/>k_dims,<sp/>4,<sp/>&amp;kn);</highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>has_v<sp/>=<sp/><ref refid="gptoss__hparams_8c_1a193ca0f7caa47a455b05ad9286cec2cc" kindref="member">gptoss_iejson_get_shape</ref>(buf,<sp/></highlight><highlight class="stringliteral">&quot;model.layers.0.self_attn.v_proj.weight&quot;</highlight><highlight class="normal">,<sp/>v_dims,<sp/>4,<sp/>&amp;vn);</highlight></codeline>
<codeline lineno="583"><highlight class="normal"></highlight></codeline>
<codeline lineno="584"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(has_q<sp/>&amp;&amp;<sp/>has_k<sp/>&amp;&amp;<sp/>has_v<sp/>&amp;&amp;<sp/>qn<sp/>&gt;=<sp/>2<sp/>&amp;&amp;<sp/>kn<sp/>&gt;=<sp/>2<sp/>&amp;&amp;<sp/>vn<sp/>&gt;=<sp/>2)<sp/>{</highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint32_t<sp/>q_dim<sp/>=<sp/>q_dims[0];</highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint32_t<sp/>d_model_ie<sp/>=<sp/>q_dims[1];</highlight></codeline>
<codeline lineno="587"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint32_t<sp/>kv_dim_k<sp/>=<sp/>k_dims[0];</highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint32_t<sp/>kv_dim_v<sp/>=<sp/>v_dims[0];</highlight></codeline>
<codeline lineno="589"><highlight class="normal"></highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(q_dim<sp/>&gt;<sp/>0<sp/>&amp;&amp;<sp/>d_model_ie<sp/>&gt;<sp/>0<sp/>&amp;&amp;<sp/>kv_dim_k<sp/>&gt;<sp/>0<sp/>&amp;&amp;<sp/>kv_dim_k<sp/>==<sp/>kv_dim_v)<sp/>{</highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a33df15e8279a7c66842c295db4d955ee" kindref="member">d_model</ref><sp/>!=<sp/>d_model_ie)<sp/>{</highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,</highlight></codeline>
<codeline lineno="593"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;[gptoss_hparams]<sp/>Note:<sp/>config<sp/>hidden_size=%u<sp/>but<sp/>model.ie.json<sp/>q_proj<sp/>in_dim=%u;<sp/>using<sp/>%u.\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="594"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">)io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a33df15e8279a7c66842c295db4d955ee" kindref="member">d_model</ref>,</highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">)d_model_ie,</highlight></codeline>
<codeline lineno="596"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">)d_model_ie);</highlight></codeline>
<codeline lineno="597"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a33df15e8279a7c66842c295db4d955ee" kindref="member">d_model</ref><sp/>=<sp/>d_model_ie;</highlight></codeline>
<codeline lineno="598"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="599"><highlight class="normal"></highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a5176af7af6c6d8a4c516f7ec1e6be202" kindref="member">n_heads</ref><sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(buf);</highlight></codeline>
<codeline lineno="602"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9" kindref="member">IE_IO_ERR_JSON</ref>;</highlight></codeline>
<codeline lineno="603"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="604"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((q_dim<sp/>%<sp/>io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a5176af7af6c6d8a4c516f7ec1e6be202" kindref="member">n_heads</ref>)<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="605"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,</highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;[gptoss_hparams]<sp/>Error:<sp/>q_dim=%u<sp/>not<sp/>divisible<sp/>by<sp/>n_heads=%u.\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="607"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">)q_dim,<sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">)io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a5176af7af6c6d8a4c516f7ec1e6be202" kindref="member">n_heads</ref>);</highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(buf);</highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a9b079e5c6f78861150a9bc91623d8c42" kindref="member">IE_IO_ERR_DECODE</ref>;</highlight></codeline>
<codeline lineno="610"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="611"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint32_t<sp/>d_head<sp/>=<sp/>q_dim<sp/>/<sp/>io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a5176af7af6c6d8a4c516f7ec1e6be202" kindref="member">n_heads</ref>;</highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(d_head<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="613"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(buf);</highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a9b079e5c6f78861150a9bc91623d8c42" kindref="member">IE_IO_ERR_DECODE</ref>;</highlight></codeline>
<codeline lineno="615"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="616"><highlight class="normal"></highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>uint32_t<sp/>n_kv<sp/>=<sp/>io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a89acca54a15e45183b174270c137d5ca" kindref="member">n_kv_heads</ref>;</highlight></codeline>
<codeline lineno="618"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n_kv<sp/>==<sp/>0<sp/>||<sp/>(kv_dim_k<sp/>!=<sp/>(n_kv<sp/>*<sp/>d_head)))<sp/>{</highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((kv_dim_k<sp/>%<sp/>d_head)<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="620"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,</highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;[gptoss_hparams]<sp/>Error:<sp/>kv_dim=%u<sp/>not<sp/>divisible<sp/>by<sp/>d_head=%u.\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">)kv_dim_k,<sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">)d_head);</highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(buf);</highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a9b079e5c6f78861150a9bc91623d8c42" kindref="member">IE_IO_ERR_DECODE</ref>;</highlight></codeline>
<codeline lineno="625"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="626"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>n_kv<sp/>=<sp/>kv_dim_k<sp/>/<sp/>d_head;</highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,</highlight></codeline>
<codeline lineno="628"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;[gptoss_hparams]<sp/>Note:<sp/>overriding<sp/>n_kv_heads<sp/>to<sp/>%u<sp/>based<sp/>on<sp/>kv_dim=%u<sp/>and<sp/>d_head=%u.\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="629"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">)n_kv,<sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">)kv_dim_k,<sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">)d_head);</highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="631"><highlight class="normal"></highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n_kv<sp/>==<sp/>0<sp/>||<sp/>n_kv<sp/>&gt;<sp/>io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a5176af7af6c6d8a4c516f7ec1e6be202" kindref="member">n_heads</ref>)<sp/>{</highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,</highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;[gptoss_hparams]<sp/>Error:<sp/>inferred<sp/>n_kv_heads=%u<sp/>invalid<sp/>for<sp/>n_heads=%u.\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">)n_kv,<sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">)io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a5176af7af6c6d8a4c516f7ec1e6be202" kindref="member">n_heads</ref>);</highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(buf);</highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a9b079e5c6f78861150a9bc91623d8c42" kindref="member">IE_IO_ERR_DECODE</ref>;</highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="639"><highlight class="normal"></highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1aa4bcfd3715e6fbd18bf3bbad86e017da" kindref="member">d_head</ref><sp/>=<sp/>d_head;</highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a89acca54a15e45183b174270c137d5ca" kindref="member">n_kv_heads</ref><sp/>=<sp/>n_kv;</highlight></codeline>
<codeline lineno="642"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="643"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="644"><highlight class="normal"></highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Infer<sp/>d_ff<sp/>from<sp/>MoE<sp/>down_proj<sp/>blocks:<sp/>shape<sp/>[n_experts,<sp/>d_ff,<sp/>...]<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="646"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/><sp/><sp/>uint32_t<sp/>dp_dims[8]<sp/>=<sp/>{0};</highlight></codeline>
<codeline lineno="648"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>dpn<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="649"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>has_dp<sp/>=<sp/><ref refid="gptoss__hparams_8c_1a193ca0f7caa47a455b05ad9286cec2cc" kindref="member">gptoss_iejson_get_shape</ref>(buf,<sp/></highlight><highlight class="stringliteral">&quot;model.layers.0.mlp.experts.down_proj_blocks&quot;</highlight><highlight class="normal">,<sp/>dp_dims,<sp/>8,<sp/>&amp;dpn);</highlight></codeline>
<codeline lineno="650"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(has_dp<sp/>&amp;&amp;<sp/>dpn<sp/>&gt;=<sp/>2<sp/>&amp;&amp;<sp/>dp_dims[1]<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="651"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint32_t<sp/>dff<sp/>=<sp/>dp_dims[1];</highlight></codeline>
<codeline lineno="652"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a6586576d1feb432bf7083cc3f35702d5" kindref="member">d_ff</ref><sp/>!=<sp/>dff)<sp/>{</highlight></codeline>
<codeline lineno="653"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,</highlight></codeline>
<codeline lineno="654"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;[gptoss_hparams]<sp/>Note:<sp/>overriding<sp/>d_ff<sp/>from<sp/>%u<sp/>to<sp/>%u<sp/>based<sp/>on<sp/>down_proj_blocks.\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="655"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">)io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a6586576d1feb432bf7083cc3f35702d5" kindref="member">d_ff</ref>,<sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">)dff);</highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a6586576d1feb432bf7083cc3f35702d5" kindref="member">d_ff</ref><sp/>=<sp/>dff;</highlight></codeline>
<codeline lineno="657"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="658"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="659"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="660"><highlight class="normal"></highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/>free(buf);</highlight></codeline>
<codeline lineno="662"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d" kindref="member">IE_IO_OK</ref>;</highlight></codeline>
<codeline lineno="663"><highlight class="normal">}</highlight></codeline>
<codeline lineno="664"><highlight class="normal"></highlight></codeline>
<codeline lineno="665" refid="gptoss__hparams_8c_1ad063ffeef89d45962268a99b62c6a83f" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="gptoss__hparams_8c_1ad063ffeef89d45962268a99b62c6a83f" kindref="member">gptoss_finalize_and_validate</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*model_dir,<sp/><ref refid="structgptoss__hparams__ex__t" kindref="compound">gptoss_hparams_ex_t</ref><sp/>*io_ex)<sp/>{</highlight></codeline>
<codeline lineno="666"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!io_ex)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239" kindref="member">IE_IO_ERR_ARGS</ref>;</highlight></codeline>
<codeline lineno="667"><highlight class="normal"></highlight></codeline>
<codeline lineno="668"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Clamp<sp/>max_seq<sp/>to<sp/>avoid<sp/>accidental<sp/>enormous<sp/>KV<sp/>allocations.</highlight></codeline>
<codeline lineno="669"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>Override<sp/>with<sp/>IE_MAX_SEQ<sp/>(must<sp/>be<sp/>&gt;<sp/>0).<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="670"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="671"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint32_t<sp/>max_cfg<sp/>=<sp/>io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1aab0c01be581031776f5fa61bbb10de24" kindref="member">max_seq</ref>;</highlight></codeline>
<codeline lineno="672"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint32_t<sp/>max_env<sp/>=<sp/><ref refid="gptoss__hparams_8c_1aa06d7bffe4f02c80ed7d45c7dcbffead" kindref="member">gptoss_env_u32</ref>(</highlight><highlight class="stringliteral">&quot;IE_MAX_SEQ&quot;</highlight><highlight class="normal">,<sp/>0u);</highlight></codeline>
<codeline lineno="673"><highlight class="normal"><sp/><sp/><sp/><sp/>uint32_t<sp/>max_use<sp/>=<sp/>max_cfg;</highlight></codeline>
<codeline lineno="674"><highlight class="normal"></highlight></codeline>
<codeline lineno="675"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(max_env<sp/>&gt;<sp/>0u)<sp/>{</highlight></codeline>
<codeline lineno="676"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>max_use<sp/>=<sp/>(max_env<sp/>&lt;<sp/>max_cfg)<sp/>?<sp/>max_env<sp/>:<sp/>max_cfg;</highlight></codeline>
<codeline lineno="677"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="678"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint32_t<sp/>clamp_default<sp/>=<sp/>4096u;</highlight></codeline>
<codeline lineno="679"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(max_use<sp/>&gt;<sp/>clamp_default)<sp/>{</highlight></codeline>
<codeline lineno="680"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(stderr,</highlight></codeline>
<codeline lineno="681"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;[gptoss_hparams]<sp/>Note:<sp/>clamping<sp/>max_seq<sp/>from<sp/>%u<sp/>to<sp/>%u<sp/>(set<sp/>IE_MAX_SEQ<sp/>to<sp/>override).\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="682"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">)max_use,<sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">)clamp_default);</highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>max_use<sp/>=<sp/>clamp_default;</highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="686"><highlight class="normal"></highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(max_use<sp/>==<sp/>0u)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9" kindref="member">IE_IO_ERR_JSON</ref>;</highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/><sp/><sp/>io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1aab0c01be581031776f5fa61bbb10de24" kindref="member">max_seq</ref><sp/>=<sp/>max_use;</highlight></codeline>
<codeline lineno="689"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="690"><highlight class="normal"></highlight></codeline>
<codeline lineno="691"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a9f7592ff0ef97a90e4bf510d7323c1e2" kindref="member">n_layers</ref><sp/>==<sp/>0<sp/>||<sp/>io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a5176af7af6c6d8a4c516f7ec1e6be202" kindref="member">n_heads</ref><sp/>==<sp/>0<sp/>||<sp/>io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a89acca54a15e45183b174270c137d5ca" kindref="member">n_kv_heads</ref><sp/>==<sp/>0<sp/>||</highlight></codeline>
<codeline lineno="692"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a33df15e8279a7c66842c295db4d955ee" kindref="member">d_model</ref><sp/>==<sp/>0<sp/>||<sp/>io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a6586576d1feb432bf7083cc3f35702d5" kindref="member">d_ff</ref><sp/>==<sp/>0<sp/>||</highlight></codeline>
<codeline lineno="693"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a92d6a3ba26bf70874cd58b8aebfe688c" kindref="member">vocab_size</ref><sp/>==<sp/>0<sp/>||<sp/>io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1aab0c01be581031776f5fa61bbb10de24" kindref="member">max_seq</ref><sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="694"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(stderr,<sp/></highlight><highlight class="stringliteral">&quot;[gptoss_hparams]<sp/>Error:<sp/>missing<sp/>required<sp/>hyperparameters<sp/>after<sp/>load.\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="695"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9" kindref="member">IE_IO_ERR_JSON</ref>;</highlight></codeline>
<codeline lineno="696"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="697"><highlight class="normal"></highlight></codeline>
<codeline lineno="698"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Apply<sp/>IEJSON<sp/>inference<sp/>(d_head,<sp/>d_ff<sp/>fixes,<sp/>possible<sp/>kv-head<sp/>override).<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(model_dir)<sp/>{</highlight></codeline>
<codeline lineno="700"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>rc<sp/>=<sp/><ref refid="gptoss__hparams_8c_1ab3bd6e26a9370d7074eec8646171042c" kindref="member">gptoss_apply_iejson_inference</ref>(model_dir,<sp/>io_ex);</highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rc<sp/>!=<sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d" kindref="member">IE_IO_OK</ref>)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>rc;</highlight></codeline>
<codeline lineno="702"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="703"><highlight class="normal"></highlight></codeline>
<codeline lineno="704"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Export<sp/>linear<sp/>RoPE<sp/>scaling<sp/>to<sp/>the<sp/>RoPE<sp/>helper,<sp/>if<sp/>present<sp/>and<sp/>not<sp/>overridden.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="705"><highlight class="normal"><sp/><sp/><ref refid="gptoss__hparams_8c_1aeb01d26508e2161e666f67d078c810b4" kindref="member">gptoss_apply_rope_scaling_env_if_absent</ref>(io_ex);</highlight></codeline>
<codeline lineno="706"><highlight class="normal"></highlight></codeline>
<codeline lineno="707"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Validate<sp/>after<sp/>IEJSON<sp/>overrides.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="708"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1aa4bcfd3715e6fbd18bf3bbad86e017da" kindref="member">d_head</ref><sp/>==<sp/>0<sp/>||<sp/>io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a33df15e8279a7c66842c295db4d955ee" kindref="member">d_model</ref><sp/>==<sp/>0)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a9b079e5c6f78861150a9bc91623d8c42" kindref="member">IE_IO_ERR_DECODE</ref>;</highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a5176af7af6c6d8a4c516f7ec1e6be202" kindref="member">n_heads</ref><sp/>==<sp/>0<sp/>||<sp/>io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a89acca54a15e45183b174270c137d5ca" kindref="member">n_kv_heads</ref><sp/>==<sp/>0)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a9b079e5c6f78861150a9bc91623d8c42" kindref="member">IE_IO_ERR_DECODE</ref>;</highlight></codeline>
<codeline lineno="710"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a92d6a3ba26bf70874cd58b8aebfe688c" kindref="member">vocab_size</ref><sp/>==<sp/>0)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a9b079e5c6f78861150a9bc91623d8c42" kindref="member">IE_IO_ERR_DECODE</ref>;</highlight></codeline>
<codeline lineno="711"><highlight class="normal"></highlight></codeline>
<codeline lineno="712"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a89acca54a15e45183b174270c137d5ca" kindref="member">n_kv_heads</ref><sp/>&gt;<sp/>io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a5176af7af6c6d8a4c516f7ec1e6be202" kindref="member">n_heads</ref>)<sp/>{</highlight></codeline>
<codeline lineno="713"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(stderr,</highlight></codeline>
<codeline lineno="714"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;[gptoss_hparams]<sp/>Error:<sp/>n_kv_heads=%u<sp/>&gt;<sp/>n_heads=%u.\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="715"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">)io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a89acca54a15e45183b174270c137d5ca" kindref="member">n_kv_heads</ref>,<sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">)io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a5176af7af6c6d8a4c516f7ec1e6be202" kindref="member">n_heads</ref>);</highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a9b079e5c6f78861150a9bc91623d8c42" kindref="member">IE_IO_ERR_DECODE</ref>;</highlight></codeline>
<codeline lineno="717"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="718"><highlight class="normal"></highlight></codeline>
<codeline lineno="719"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a5176af7af6c6d8a4c516f7ec1e6be202" kindref="member">n_heads</ref><sp/>%<sp/>io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a89acca54a15e45183b174270c137d5ca" kindref="member">n_kv_heads</ref>)<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="720"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(stderr,</highlight></codeline>
<codeline lineno="721"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;[gptoss_hparams]<sp/>Error:<sp/>n_heads=%u<sp/>not<sp/>divisible<sp/>by<sp/>n_kv_heads=%u.\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="722"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">)io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a5176af7af6c6d8a4c516f7ec1e6be202" kindref="member">n_heads</ref>,<sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">)io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a89acca54a15e45183b174270c137d5ca" kindref="member">n_kv_heads</ref>);</highlight></codeline>
<codeline lineno="723"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a9b079e5c6f78861150a9bc91623d8c42" kindref="member">IE_IO_ERR_DECODE</ref>;</highlight></codeline>
<codeline lineno="724"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="725"><highlight class="normal"></highlight></codeline>
<codeline lineno="726"><highlight class="normal"><sp/><sp/>fprintf(stderr,</highlight></codeline>
<codeline lineno="727"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;[gptoss_hparams]<sp/>Loaded:<sp/>layers=%u<sp/>heads=%u<sp/>kv_heads=%u<sp/>d_model=%u<sp/>d_head=%u<sp/>d_ff=%u<sp/>vocab=%u<sp/>max_seq=%u\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="728"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">)io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a9f7592ff0ef97a90e4bf510d7323c1e2" kindref="member">n_layers</ref>,</highlight></codeline>
<codeline lineno="729"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">)io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a5176af7af6c6d8a4c516f7ec1e6be202" kindref="member">n_heads</ref>,</highlight></codeline>
<codeline lineno="730"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">)io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a89acca54a15e45183b174270c137d5ca" kindref="member">n_kv_heads</ref>,</highlight></codeline>
<codeline lineno="731"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">)io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a33df15e8279a7c66842c295db4d955ee" kindref="member">d_model</ref>,</highlight></codeline>
<codeline lineno="732"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">)io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1aa4bcfd3715e6fbd18bf3bbad86e017da" kindref="member">d_head</ref>,</highlight></codeline>
<codeline lineno="733"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">)io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a6586576d1feb432bf7083cc3f35702d5" kindref="member">d_ff</ref>,</highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">)io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1a92d6a3ba26bf70874cd58b8aebfe688c" kindref="member">vocab_size</ref>,</highlight></codeline>
<codeline lineno="735"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">)io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>.<ref refid="structie__gptoss__hparams_1aab0c01be581031776f5fa61bbb10de24" kindref="member">max_seq</ref>);</highlight></codeline>
<codeline lineno="736"><highlight class="normal"></highlight></codeline>
<codeline lineno="737"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1ab9e6c60c04ee4743452fdc0abc786090" kindref="member">rope_scaling_type</ref>[0]<sp/>!=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="738"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(stderr,</highlight></codeline>
<codeline lineno="739"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;[gptoss_hparams]<sp/>RoPE:<sp/>theta=%.9g<sp/>scaling_type=&apos;%s&apos;<sp/>scaling_factor=%.9g<sp/>original_max_pos=%u\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="740"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">)io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1ab2801efbde312a24d000be04f19e50a5" kindref="member">rope_theta</ref>,</highlight></codeline>
<codeline lineno="741"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1ab9e6c60c04ee4743452fdc0abc786090" kindref="member">rope_scaling_type</ref>,</highlight></codeline>
<codeline lineno="742"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">)io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a6506926ad8c409cddfea5c4e819ee5e6" kindref="member">rope_scaling_factor</ref>,</highlight></codeline>
<codeline lineno="743"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal">)io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1a0482634a73ae325d678773a90a9488bb" kindref="member">rope_scaling_original_max_position_embeddings</ref>);</highlight></codeline>
<codeline lineno="744"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="745"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(stderr,</highlight></codeline>
<codeline lineno="746"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;[gptoss_hparams]<sp/>RoPE:<sp/>theta=%.9g<sp/>scaling=none\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="747"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">)io_ex-&gt;<ref refid="structgptoss__hparams__ex__t_1ab2801efbde312a24d000be04f19e50a5" kindref="member">rope_theta</ref>);</highlight></codeline>
<codeline lineno="748"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="749"><highlight class="normal"></highlight></codeline>
<codeline lineno="750"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d" kindref="member">IE_IO_OK</ref>;</highlight></codeline>
<codeline lineno="751"><highlight class="normal">}</highlight></codeline>
<codeline lineno="752"><highlight class="normal"></highlight></codeline>
<codeline lineno="753"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>============================================================================</highlight></codeline>
<codeline lineno="754"><highlight class="comment"><sp/>*<sp/>Public<sp/>API</highlight></codeline>
<codeline lineno="755"><highlight class="comment"><sp/>*<sp/>==========================================================================<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="756"><highlight class="normal"></highlight></codeline>
<codeline lineno="757" refid="gptoss__hparams_8h_1a44569b4152eff92faec7947f9d7e07a5" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="gptoss__hparams_8c_1a44569b4152eff92faec7947f9d7e07a5" kindref="member">gptoss_hparams_load_ex_from_file</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*config_json_path,<sp/><ref refid="structgptoss__hparams__ex__t" kindref="compound">gptoss_hparams_ex_t</ref><sp/>*out_ex)<sp/>{</highlight></codeline>
<codeline lineno="758"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!config_json_path<sp/>||<sp/>!out_ex)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239" kindref="member">IE_IO_ERR_ARGS</ref>;</highlight></codeline>
<codeline lineno="759"><highlight class="normal"></highlight></codeline>
<codeline lineno="760"><highlight class="normal"><sp/><sp/><ref refid="gptoss__hparams_8c_1a1fc228937b1158daeec7c8473268ef6d" kindref="member">gptoss_hparams_ex_defaults</ref>(out_ex);</highlight></codeline>
<codeline lineno="761"><highlight class="normal"></highlight></codeline>
<codeline lineno="762"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*buf<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="763"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>len<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="764"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>rc<sp/>=<sp/><ref refid="gptoss__hparams_8c_1acf6885297534473f02170d46c830a473" kindref="member">gptoss_read_all_text</ref>(config_json_path,<sp/>&amp;buf,<sp/>&amp;len);</highlight></codeline>
<codeline lineno="765"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rc<sp/>!=<sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d" kindref="member">IE_IO_OK</ref>)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>rc;</highlight></codeline>
<codeline lineno="766"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!buf<sp/>||<sp/>len<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="767"><highlight class="normal"><sp/><sp/><sp/><sp/>free(buf);</highlight></codeline>
<codeline lineno="768"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987aa12fce48fd3eee2bd8a75dc61db150a7" kindref="member">IE_IO_ERR_READ</ref>;</highlight></codeline>
<codeline lineno="769"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="770"><highlight class="normal"></highlight></codeline>
<codeline lineno="771"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>prc<sp/>=<sp/><ref refid="gptoss__hparams_8c_1a877e2aad4bef17bb60c9d93f5fcb7d82" kindref="member">gptoss_parse_config_json</ref>(buf,<sp/>out_ex);</highlight></codeline>
<codeline lineno="772"><highlight class="normal"><sp/><sp/>free(buf);</highlight></codeline>
<codeline lineno="773"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>prc;</highlight></codeline>
<codeline lineno="774"><highlight class="normal">}</highlight></codeline>
<codeline lineno="775"><highlight class="normal"></highlight></codeline>
<codeline lineno="776" refid="gptoss__hparams_8h_1ab455fc052d5abd5ec9be138ebd71deaf" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="gptoss__hparams_8c_1ab455fc052d5abd5ec9be138ebd71deaf" kindref="member">gptoss_hparams_load_ex</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*model_dir,<sp/><ref refid="structgptoss__hparams__ex__t" kindref="compound">gptoss_hparams_ex_t</ref><sp/>*out_ex)<sp/>{</highlight></codeline>
<codeline lineno="777"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!model_dir<sp/>||<sp/>!out_ex)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239" kindref="member">IE_IO_ERR_ARGS</ref>;</highlight></codeline>
<codeline lineno="778"><highlight class="normal"></highlight></codeline>
<codeline lineno="779"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>cfg[1024];</highlight></codeline>
<codeline lineno="780"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>r<sp/>=<sp/><ref refid="gptoss__hparams_8c_1a9eb7cf7fe4ec59cf516cda8a96454e43" kindref="member">gptoss_resolve_config_path</ref>(model_dir,<sp/>cfg,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(cfg));</highlight></codeline>
<codeline lineno="781"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(r<sp/>!=<sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d" kindref="member">IE_IO_OK</ref>)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>r;</highlight></codeline>
<codeline lineno="782"><highlight class="normal"></highlight></codeline>
<codeline lineno="783"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>rc<sp/>=<sp/><ref refid="gptoss__hparams_8c_1a44569b4152eff92faec7947f9d7e07a5" kindref="member">gptoss_hparams_load_ex_from_file</ref>(cfg,<sp/>out_ex);</highlight></codeline>
<codeline lineno="784"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rc<sp/>!=<sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d" kindref="member">IE_IO_OK</ref>)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>rc;</highlight></codeline>
<codeline lineno="785"><highlight class="normal"></highlight></codeline>
<codeline lineno="786"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="gptoss__hparams_8c_1ad063ffeef89d45962268a99b62c6a83f" kindref="member">gptoss_finalize_and_validate</ref>(model_dir,<sp/>out_ex);</highlight></codeline>
<codeline lineno="787"><highlight class="normal">}</highlight></codeline>
<codeline lineno="788"><highlight class="normal"></highlight></codeline>
<codeline lineno="789" refid="gptoss__hparams_8h_1a551745dee25fc47e05d76c79791885a0" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="gptoss__hparams_8c_1a551745dee25fc47e05d76c79791885a0" kindref="member">gptoss_hparams_load</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*model_dir,<sp/><ref refid="structie__gptoss__hparams" kindref="compound">ie_gptoss_hparams_t</ref><sp/>*out_hp)<sp/>{</highlight></codeline>
<codeline lineno="790"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!model_dir<sp/>||<sp/>!out_hp)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239" kindref="member">IE_IO_ERR_ARGS</ref>;</highlight></codeline>
<codeline lineno="791"><highlight class="normal"></highlight></codeline>
<codeline lineno="792"><highlight class="normal"><sp/><sp/><ref refid="structgptoss__hparams__ex__t" kindref="compound">gptoss_hparams_ex_t</ref><sp/>ex;</highlight></codeline>
<codeline lineno="793"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>rc<sp/>=<sp/><ref refid="gptoss__hparams_8c_1ab455fc052d5abd5ec9be138ebd71deaf" kindref="member">gptoss_hparams_load_ex</ref>(model_dir,<sp/>&amp;ex);</highlight></codeline>
<codeline lineno="794"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rc<sp/>!=<sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d" kindref="member">IE_IO_OK</ref>)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>rc;</highlight></codeline>
<codeline lineno="795"><highlight class="normal"></highlight></codeline>
<codeline lineno="796"><highlight class="normal"><sp/><sp/>*out_hp<sp/>=<sp/>ex.<ref refid="structgptoss__hparams__ex__t_1a92a0d76344f322ad1a2c57ec2517bba2" kindref="member">core</ref>;</highlight></codeline>
<codeline lineno="797"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="ie__io_8h_1a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d" kindref="member">IE_IO_OK</ref>;</highlight></codeline>
<codeline lineno="798"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="engine/src/runtime/gptoss_hparams.c"/>
  </compounddef>
</doxygen>
