<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Inference Engine (Clocher): engine/include/ie_tokenizer_gptoss.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Inference Engine (Clocher)<span id="projectnumber">&#160;0.2</span>
   </div>
   <div id="projectbrief">C11 CPU/GPU inference baseline with strict metrics &amp; harness</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('ie__tokenizer__gptoss_8h.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">ie_tokenizer_gptoss.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>GPT-OSS tokenizer loader + encode/decode for:  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stddef.h&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for ie_tokenizer_gptoss.h:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="ie__tokenizer__gptoss_8h__incl.svg" width="211" height="124"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
</div><div class="textblock"><div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="ie__tokenizer__gptoss_8h__dep__incl.svg" width="100%" height="470"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
</div>
<p><a href="ie__tokenizer__gptoss_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="typedef-members" name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ae1b205a897f0ece89cc8f2899acc0543" id="r_ae1b205a897f0ece89cc8f2899acc0543"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structie__tok__gptoss__s.html">ie_tok_gptoss_s</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ie__tokenizer__gptoss_8h.html#ae1b205a897f0ece89cc8f2899acc0543">ie_tok_gptoss_t</a></td></tr>
<tr class="separator:ae1b205a897f0ece89cc8f2899acc0543"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a09f39b011164c4c29aa92a25ffbaa55c" id="r_a09f39b011164c4c29aa92a25ffbaa55c"><td class="memItemLeft" align="right" valign="top">typedef enum <a class="el" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2">ie_tok_gptoss_status_e</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ie__tokenizer__gptoss_8h.html#a09f39b011164c4c29aa92a25ffbaa55c">ie_tok_gptoss_status_t</a></td></tr>
<tr class="separator:a09f39b011164c4c29aa92a25ffbaa55c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="enum-members" name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a1305696bd5b44e9ad4e2b624ce1b59f2" id="r_a1305696bd5b44e9ad4e2b624ce1b59f2"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2">ie_tok_gptoss_status_e</a> { <br />
&#160;&#160;<a class="el" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a6e804d975236c9745c44c1db1baed259">IE_TOK_GPTOSS_OK</a> = 0
, <a class="el" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a2bf73548c30949834b4c282d79ef32d4">IE_TOK_GPTOSS_ERR_ARGS</a> = -1
, <a class="el" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a7635c982b781a8ef569aded5c8cbcef7">IE_TOK_GPTOSS_ERR_IO</a> = -2
, <a class="el" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a5b6eb590f3790b4e61df67c181dbf6e6">IE_TOK_GPTOSS_ERR_JSON</a> = -3
, <br />
&#160;&#160;<a class="el" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2aa85c45ba03e4d24b20dd6c893b7e5c66">IE_TOK_GPTOSS_ERR_NOMEM</a> = -4
, <a class="el" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2afeff254edf6b97edc55beca818a7dea9">IE_TOK_GPTOSS_ERR_RANGE</a> = -5
, <a class="el" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a12ba28164c55026e3f7e5301a6ac0189">IE_TOK_GPTOSS_ERR_INTERNAL</a> = -6
<br />
 }</td></tr>
<tr class="separator:a1305696bd5b44e9ad4e2b624ce1b59f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ae5c55dc1502414c60d1a99fa9fbdf1bc" id="r_ae5c55dc1502414c60d1a99fa9fbdf1bc"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ie__tokenizer__gptoss_8h.html#ae5c55dc1502414c60d1a99fa9fbdf1bc">ie_tok_gptoss_open</a> (const char *tokenizer_path, <a class="el" href="ie__tokenizer__gptoss_8h.html#ae1b205a897f0ece89cc8f2899acc0543">ie_tok_gptoss_t</a> **out_tok)</td></tr>
<tr class="memdesc:ae5c55dc1502414c60d1a99fa9fbdf1bc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Open a tokenizer from:  <br /></td></tr>
<tr class="separator:ae5c55dc1502414c60d1a99fa9fbdf1bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4b875bec514bb9c1de945944e1596de" id="r_ad4b875bec514bb9c1de945944e1596de"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ie__tokenizer__gptoss_8h.html#ad4b875bec514bb9c1de945944e1596de">ie_tok_gptoss_close</a> (<a class="el" href="ie__tokenizer__gptoss_8h.html#ae1b205a897f0ece89cc8f2899acc0543">ie_tok_gptoss_t</a> *tok)</td></tr>
<tr class="separator:ad4b875bec514bb9c1de945944e1596de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a4146017408baa0a07ffa747dfae870" id="r_a0a4146017408baa0a07ffa747dfae870"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ie__tokenizer__gptoss_8h.html#a0a4146017408baa0a07ffa747dfae870">ie_tok_gptoss_vocab_size</a> (const <a class="el" href="ie__tokenizer__gptoss_8h.html#ae1b205a897f0ece89cc8f2899acc0543">ie_tok_gptoss_t</a> *tok)</td></tr>
<tr class="separator:a0a4146017408baa0a07ffa747dfae870"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a171cd54148a22d4fd7c1c8d1e9f010de" id="r_a171cd54148a22d4fd7c1c8d1e9f010de"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ie__tokenizer__gptoss_8h.html#a171cd54148a22d4fd7c1c8d1e9f010de">ie_tok_gptoss_encode</a> (const <a class="el" href="ie__tokenizer__gptoss_8h.html#ae1b205a897f0ece89cc8f2899acc0543">ie_tok_gptoss_t</a> *tok, const char *text, uint32_t *ids, uint32_t *inout_count)</td></tr>
<tr class="separator:a171cd54148a22d4fd7c1c8d1e9f010de"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae372932b3912864351defd6ce553ed88" id="r_ae372932b3912864351defd6ce553ed88"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ie__tokenizer__gptoss_8h.html#ae372932b3912864351defd6ce553ed88">ie_tok_gptoss_decode</a> (const <a class="el" href="ie__tokenizer__gptoss_8h.html#ae1b205a897f0ece89cc8f2899acc0543">ie_tok_gptoss_t</a> *tok, const uint32_t *ids, uint32_t count, char *out, size_t *inout_bytes)</td></tr>
<tr class="separator:ae372932b3912864351defd6ce553ed88"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>GPT-OSS tokenizer loader + encode/decode for: </p>
<ul>
<li>HuggingFace <code>tokenizer.json</code> (GPT-2 Byte-Level BPE style)</li>
<li>OpenAI-style <code>.tiktoken</code> rank files (base64 token bytes + rank)</li>
<li>Packed <code>IETOK1</code> format (recommended)</li>
</ul>
<p>Design notes:</p><ul>
<li>No third-party JSON library is used.</li>
<li><code>.tiktoken</code> tokens are stored as raw bytes (binary-safe).</li>
<li>Decode must be correct for "token ids -&gt; coherent text".</li>
<li>Encode is correctness-first. For <code>.tiktoken</code>, we apply byte-level BPE per whitespace/non-whitespace segments (conservative split) to avoid merging across obvious boundaries.</li>
</ul>
<p>Thread-safety:</p><ul>
<li>A tokenizer handle is read-only after open. Encode/decode are re-entrant as long as the caller provides independent output buffers. </li>
</ul>

<p class="definition">Definition in file <a class="el" href="ie__tokenizer__gptoss_8h_source.html">ie_tokenizer_gptoss.h</a>.</p>
</div><h2 class="groupheader">Typedef Documentation</h2>
<a id="a09f39b011164c4c29aa92a25ffbaa55c" name="a09f39b011164c4c29aa92a25ffbaa55c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a09f39b011164c4c29aa92a25ffbaa55c">&#9670;&#160;</a></span>ie_tok_gptoss_status_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef enum <a class="el" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2">ie_tok_gptoss_status_e</a> <a class="el" href="ie__tokenizer__gptoss_8h.html#a09f39b011164c4c29aa92a25ffbaa55c">ie_tok_gptoss_status_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ae1b205a897f0ece89cc8f2899acc0543" name="ae1b205a897f0ece89cc8f2899acc0543"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae1b205a897f0ece89cc8f2899acc0543">&#9670;&#160;</a></span>ie_tok_gptoss_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structie__tok__gptoss__s.html">ie_tok_gptoss_s</a> <a class="el" href="ie__tokenizer__gptoss_8h.html#ae1b205a897f0ece89cc8f2899acc0543">ie_tok_gptoss_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="ie__tokenizer__gptoss_8h_source.html#l00035">35</a> of file <a class="el" href="ie__tokenizer__gptoss_8h_source.html">ie_tokenizer_gptoss.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="a1305696bd5b44e9ad4e2b624ce1b59f2" name="a1305696bd5b44e9ad4e2b624ce1b59f2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1305696bd5b44e9ad4e2b624ce1b59f2">&#9670;&#160;</a></span>ie_tok_gptoss_status_e</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2">ie_tok_gptoss_status_e</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a1305696bd5b44e9ad4e2b624ce1b59f2a6e804d975236c9745c44c1db1baed259" name="a1305696bd5b44e9ad4e2b624ce1b59f2a6e804d975236c9745c44c1db1baed259"></a>IE_TOK_GPTOSS_OK&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a1305696bd5b44e9ad4e2b624ce1b59f2a2bf73548c30949834b4c282d79ef32d4" name="a1305696bd5b44e9ad4e2b624ce1b59f2a2bf73548c30949834b4c282d79ef32d4"></a>IE_TOK_GPTOSS_ERR_ARGS&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a1305696bd5b44e9ad4e2b624ce1b59f2a7635c982b781a8ef569aded5c8cbcef7" name="a1305696bd5b44e9ad4e2b624ce1b59f2a7635c982b781a8ef569aded5c8cbcef7"></a>IE_TOK_GPTOSS_ERR_IO&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a1305696bd5b44e9ad4e2b624ce1b59f2a5b6eb590f3790b4e61df67c181dbf6e6" name="a1305696bd5b44e9ad4e2b624ce1b59f2a5b6eb590f3790b4e61df67c181dbf6e6"></a>IE_TOK_GPTOSS_ERR_JSON&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a1305696bd5b44e9ad4e2b624ce1b59f2aa85c45ba03e4d24b20dd6c893b7e5c66" name="a1305696bd5b44e9ad4e2b624ce1b59f2aa85c45ba03e4d24b20dd6c893b7e5c66"></a>IE_TOK_GPTOSS_ERR_NOMEM&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a1305696bd5b44e9ad4e2b624ce1b59f2afeff254edf6b97edc55beca818a7dea9" name="a1305696bd5b44e9ad4e2b624ce1b59f2afeff254edf6b97edc55beca818a7dea9"></a>IE_TOK_GPTOSS_ERR_RANGE&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a1305696bd5b44e9ad4e2b624ce1b59f2a12ba28164c55026e3f7e5301a6ac0189" name="a1305696bd5b44e9ad4e2b624ce1b59f2a12ba28164c55026e3f7e5301a6ac0189"></a>IE_TOK_GPTOSS_ERR_INTERNAL&#160;</td><td class="fielddoc"></td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="ie__tokenizer__gptoss_8h_source.html#l00037">37</a> of file <a class="el" href="ie__tokenizer__gptoss_8h_source.html">ie_tokenizer_gptoss.h</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   37</span>                                    {</div>
<div class="line"><span class="lineno">   38</span>  <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a6e804d975236c9745c44c1db1baed259">IE_TOK_GPTOSS_OK</a> = 0,</div>
<div class="line"><span class="lineno">   39</span>  <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a2bf73548c30949834b4c282d79ef32d4">IE_TOK_GPTOSS_ERR_ARGS</a> = -1,</div>
<div class="line"><span class="lineno">   40</span>  <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a7635c982b781a8ef569aded5c8cbcef7">IE_TOK_GPTOSS_ERR_IO</a> = -2,</div>
<div class="line"><span class="lineno">   41</span>  <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a5b6eb590f3790b4e61df67c181dbf6e6">IE_TOK_GPTOSS_ERR_JSON</a> = -3,</div>
<div class="line"><span class="lineno">   42</span>  <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2aa85c45ba03e4d24b20dd6c893b7e5c66">IE_TOK_GPTOSS_ERR_NOMEM</a> = -4,</div>
<div class="line"><span class="lineno">   43</span>  <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2afeff254edf6b97edc55beca818a7dea9">IE_TOK_GPTOSS_ERR_RANGE</a> = -5,</div>
<div class="line"><span class="lineno">   44</span>  <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a12ba28164c55026e3f7e5301a6ac0189">IE_TOK_GPTOSS_ERR_INTERNAL</a> = -6</div>
<div class="line"><span class="lineno">   45</span>} <a class="code hl_typedef" href="ie__tokenizer__gptoss_8h.html#a09f39b011164c4c29aa92a25ffbaa55c">ie_tok_gptoss_status_t</a>;</div>
<div class="ttc" id="aie__tokenizer__gptoss_8h_html_a09f39b011164c4c29aa92a25ffbaa55c"><div class="ttname"><a href="ie__tokenizer__gptoss_8h.html#a09f39b011164c4c29aa92a25ffbaa55c">ie_tok_gptoss_status_t</a></div><div class="ttdeci">enum ie_tok_gptoss_status_e ie_tok_gptoss_status_t</div></div>
<div class="ttc" id="aie__tokenizer__gptoss_8h_html_a1305696bd5b44e9ad4e2b624ce1b59f2a12ba28164c55026e3f7e5301a6ac0189"><div class="ttname"><a href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a12ba28164c55026e3f7e5301a6ac0189">IE_TOK_GPTOSS_ERR_INTERNAL</a></div><div class="ttdeci">@ IE_TOK_GPTOSS_ERR_INTERNAL</div><div class="ttdef"><b>Definition</b> <a href="ie__tokenizer__gptoss_8h_source.html#l00045">ie_tokenizer_gptoss.h:44</a></div></div>
<div class="ttc" id="aie__tokenizer__gptoss_8h_html_a1305696bd5b44e9ad4e2b624ce1b59f2a2bf73548c30949834b4c282d79ef32d4"><div class="ttname"><a href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a2bf73548c30949834b4c282d79ef32d4">IE_TOK_GPTOSS_ERR_ARGS</a></div><div class="ttdeci">@ IE_TOK_GPTOSS_ERR_ARGS</div><div class="ttdef"><b>Definition</b> <a href="ie__tokenizer__gptoss_8h_source.html#l00039">ie_tokenizer_gptoss.h:39</a></div></div>
<div class="ttc" id="aie__tokenizer__gptoss_8h_html_a1305696bd5b44e9ad4e2b624ce1b59f2a5b6eb590f3790b4e61df67c181dbf6e6"><div class="ttname"><a href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a5b6eb590f3790b4e61df67c181dbf6e6">IE_TOK_GPTOSS_ERR_JSON</a></div><div class="ttdeci">@ IE_TOK_GPTOSS_ERR_JSON</div><div class="ttdef"><b>Definition</b> <a href="ie__tokenizer__gptoss_8h_source.html#l00041">ie_tokenizer_gptoss.h:41</a></div></div>
<div class="ttc" id="aie__tokenizer__gptoss_8h_html_a1305696bd5b44e9ad4e2b624ce1b59f2a6e804d975236c9745c44c1db1baed259"><div class="ttname"><a href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a6e804d975236c9745c44c1db1baed259">IE_TOK_GPTOSS_OK</a></div><div class="ttdeci">@ IE_TOK_GPTOSS_OK</div><div class="ttdef"><b>Definition</b> <a href="ie__tokenizer__gptoss_8h_source.html#l00038">ie_tokenizer_gptoss.h:38</a></div></div>
<div class="ttc" id="aie__tokenizer__gptoss_8h_html_a1305696bd5b44e9ad4e2b624ce1b59f2a7635c982b781a8ef569aded5c8cbcef7"><div class="ttname"><a href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a7635c982b781a8ef569aded5c8cbcef7">IE_TOK_GPTOSS_ERR_IO</a></div><div class="ttdeci">@ IE_TOK_GPTOSS_ERR_IO</div><div class="ttdef"><b>Definition</b> <a href="ie__tokenizer__gptoss_8h_source.html#l00040">ie_tokenizer_gptoss.h:40</a></div></div>
<div class="ttc" id="aie__tokenizer__gptoss_8h_html_a1305696bd5b44e9ad4e2b624ce1b59f2aa85c45ba03e4d24b20dd6c893b7e5c66"><div class="ttname"><a href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2aa85c45ba03e4d24b20dd6c893b7e5c66">IE_TOK_GPTOSS_ERR_NOMEM</a></div><div class="ttdeci">@ IE_TOK_GPTOSS_ERR_NOMEM</div><div class="ttdef"><b>Definition</b> <a href="ie__tokenizer__gptoss_8h_source.html#l00042">ie_tokenizer_gptoss.h:42</a></div></div>
<div class="ttc" id="aie__tokenizer__gptoss_8h_html_a1305696bd5b44e9ad4e2b624ce1b59f2afeff254edf6b97edc55beca818a7dea9"><div class="ttname"><a href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2afeff254edf6b97edc55beca818a7dea9">IE_TOK_GPTOSS_ERR_RANGE</a></div><div class="ttdeci">@ IE_TOK_GPTOSS_ERR_RANGE</div><div class="ttdef"><b>Definition</b> <a href="ie__tokenizer__gptoss_8h_source.html#l00043">ie_tokenizer_gptoss.h:43</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ad4b875bec514bb9c1de945944e1596de" name="ad4b875bec514bb9c1de945944e1596de"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad4b875bec514bb9c1de945944e1596de">&#9670;&#160;</a></span>ie_tok_gptoss_close()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ie_tok_gptoss_close </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="ie__tokenizer__gptoss_8h.html#ae1b205a897f0ece89cc8f2899acc0543">ie_tok_gptoss_t</a> *&#160;</td>
          <td class="paramname"><em>tok</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tokenizer__gptoss_8c_source.html#l01795">1795</a> of file <a class="el" href="tokenizer__gptoss_8c_source.html">tokenizer_gptoss.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1795</span>                                               {</div>
<div class="line"><span class="lineno"> 1796</span>  <span class="keywordflow">if</span> (!tok) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno"> 1797</span> </div>
<div class="line"><span class="lineno"> 1798</span>  <span class="keywordflow">if</span> (tok-&gt;<a class="code hl_variable" href="structie__tok__gptoss__s.html#a4417459614f97a9b31de9fc980450595">id_to_tok</a>) {</div>
<div class="line"><span class="lineno"> 1799</span>    <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; tok-&gt;<a class="code hl_variable" href="structie__tok__gptoss__s.html#ae859adc2daece05fc5bd98b3f8cb913e">vocab_size</a>; ++i) free(tok-&gt;<a class="code hl_variable" href="structie__tok__gptoss__s.html#a4417459614f97a9b31de9fc980450595">id_to_tok</a>[i]);</div>
<div class="line"><span class="lineno"> 1800</span>    free(tok-&gt;<a class="code hl_variable" href="structie__tok__gptoss__s.html#a4417459614f97a9b31de9fc980450595">id_to_tok</a>);</div>
<div class="line"><span class="lineno"> 1801</span>  }</div>
<div class="line"><span class="lineno"> 1802</span>  free(tok-&gt;<a class="code hl_variable" href="structie__tok__gptoss__s.html#afb1bc0375c07e79a7b248163a17f6251">tok_to_id</a>);</div>
<div class="line"><span class="lineno"> 1803</span>  free(tok-&gt;<a class="code hl_variable" href="structie__tok__gptoss__s.html#a2ecbb2af5975a3422496474dc46bee28">pair_to_rank</a>);</div>
<div class="line"><span class="lineno"> 1804</span>  <a class="code hl_function" href="tokenizer__gptoss_8c.html#a118bc90519292f54b3513029942a3867">intern_free</a>(&amp;tok-&gt;<a class="code hl_variable" href="structie__tok__gptoss__s.html#ac8e89185a8724c5fc8ba846dd3ce7ca1">intern</a>);</div>
<div class="line"><span class="lineno"> 1805</span> </div>
<div class="line"><span class="lineno"> 1806</span>  free(tok-&gt;<a class="code hl_variable" href="structie__tok__gptoss__s.html#a276274c2cba2e0c82defdcf87bd2231a">id_to_bytes</a>);</div>
<div class="line"><span class="lineno"> 1807</span>  free(tok-&gt;<a class="code hl_variable" href="structie__tok__gptoss__s.html#a52cb1e3de301055d8bd236415e78d897">bytes_to_id</a>);</div>
<div class="line"><span class="lineno"> 1808</span>  <a class="code hl_function" href="tokenizer__gptoss_8c.html#ab8470327b8dacfc6949303c5b052a402">bytearena_free</a>(&amp;tok-&gt;<a class="code hl_variable" href="structie__tok__gptoss__s.html#ade8b0a7e2551f0bf21afd715f5ac108c">tt_arena</a>);</div>
<div class="line"><span class="lineno"> 1809</span> </div>
<div class="line"><span class="lineno"> 1810</span>  free(tok);</div>
<div class="line"><span class="lineno"> 1811</span>}</div>
<div class="ttc" id="astructie__tok__gptoss__s_html_a276274c2cba2e0c82defdcf87bd2231a"><div class="ttname"><a href="structie__tok__gptoss__s.html#a276274c2cba2e0c82defdcf87bd2231a">ie_tok_gptoss_s::id_to_bytes</a></div><div class="ttdeci">bytes_view_t * id_to_bytes</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l00808">tokenizer_gptoss.c:808</a></div></div>
<div class="ttc" id="astructie__tok__gptoss__s_html_a2ecbb2af5975a3422496474dc46bee28"><div class="ttname"><a href="structie__tok__gptoss__s.html#a2ecbb2af5975a3422496474dc46bee28">ie_tok_gptoss_s::pair_to_rank</a></div><div class="ttdeci">pairrank_ent_t * pair_to_rank</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l00802">tokenizer_gptoss.c:802</a></div></div>
<div class="ttc" id="astructie__tok__gptoss__s_html_a4417459614f97a9b31de9fc980450595"><div class="ttname"><a href="structie__tok__gptoss__s.html#a4417459614f97a9b31de9fc980450595">ie_tok_gptoss_s::id_to_tok</a></div><div class="ttdeci">char ** id_to_tok</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l00799">tokenizer_gptoss.c:799</a></div></div>
<div class="ttc" id="astructie__tok__gptoss__s_html_a52cb1e3de301055d8bd236415e78d897"><div class="ttname"><a href="structie__tok__gptoss__s.html#a52cb1e3de301055d8bd236415e78d897">ie_tok_gptoss_s::bytes_to_id</a></div><div class="ttdeci">bytesid_ent_t * bytes_to_id</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l00809">tokenizer_gptoss.c:809</a></div></div>
<div class="ttc" id="astructie__tok__gptoss__s_html_ac8e89185a8724c5fc8ba846dd3ce7ca1"><div class="ttname"><a href="structie__tok__gptoss__s.html#ac8e89185a8724c5fc8ba846dd3ce7ca1">ie_tok_gptoss_s::intern</a></div><div class="ttdeci">intern_t intern</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l00804">tokenizer_gptoss.c:804</a></div></div>
<div class="ttc" id="astructie__tok__gptoss__s_html_ade8b0a7e2551f0bf21afd715f5ac108c"><div class="ttname"><a href="structie__tok__gptoss__s.html#ade8b0a7e2551f0bf21afd715f5ac108c">ie_tok_gptoss_s::tt_arena</a></div><div class="ttdeci">bytearena_t tt_arena</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l00811">tokenizer_gptoss.c:811</a></div></div>
<div class="ttc" id="astructie__tok__gptoss__s_html_ae859adc2daece05fc5bd98b3f8cb913e"><div class="ttname"><a href="structie__tok__gptoss__s.html#ae859adc2daece05fc5bd98b3f8cb913e">ie_tok_gptoss_s::vocab_size</a></div><div class="ttdeci">uint32_t vocab_size</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l00796">tokenizer_gptoss.c:796</a></div></div>
<div class="ttc" id="astructie__tok__gptoss__s_html_afb1bc0375c07e79a7b248163a17f6251"><div class="ttname"><a href="structie__tok__gptoss__s.html#afb1bc0375c07e79a7b248163a17f6251">ie_tok_gptoss_s::tok_to_id</a></div><div class="ttdeci">strid_ent_t * tok_to_id</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l00800">tokenizer_gptoss.c:800</a></div></div>
<div class="ttc" id="atokenizer__gptoss_8c_html_a118bc90519292f54b3513029942a3867"><div class="ttname"><a href="tokenizer__gptoss_8c.html#a118bc90519292f54b3513029942a3867">intern_free</a></div><div class="ttdeci">static void intern_free(intern_t *in)</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l00565">tokenizer_gptoss.c:565</a></div></div>
<div class="ttc" id="atokenizer__gptoss_8c_html_ab8470327b8dacfc6949303c5b052a402"><div class="ttname"><a href="tokenizer__gptoss_8c.html#ab8470327b8dacfc6949303c5b052a402">bytearena_free</a></div><div class="ttdeci">static void bytearena_free(bytearena_t *a)</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l00733">tokenizer_gptoss.c:733</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="tokenizer__gptoss_8c_source.html#l00733">bytearena_free()</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l00809">ie_tok_gptoss_s::bytes_to_id</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l00808">ie_tok_gptoss_s::id_to_bytes</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l00799">ie_tok_gptoss_s::id_to_tok</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l00804">ie_tok_gptoss_s::intern</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l00565">intern_free()</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l00802">ie_tok_gptoss_s::pair_to_rank</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l00800">ie_tok_gptoss_s::tok_to_id</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l00811">ie_tok_gptoss_s::tt_arena</a>, and <a class="el" href="tokenizer__gptoss_8c_source.html#l00796">ie_tok_gptoss_s::vocab_size</a>.</p>

<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l00866">decode_tokens_best_effort()</a>, <a class="el" href="ie__api_8c_source.html#l00535">ie_engine_create()</a>, <a class="el" href="ie__api_8c_source.html#l00788">ie_engine_destroy()</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l01761">ie_tok_gptoss_open()</a>, and <a class="el" href="main__chat_8c_source.html#l00185">main()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="ie__tokenizer__gptoss_8h_ad4b875bec514bb9c1de945944e1596de_cgraph.svg" width="334" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="ie__tokenizer__gptoss_8h_ad4b875bec514bb9c1de945944e1596de_icgraph.svg" width="100%" height="450"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="ae372932b3912864351defd6ce553ed88" name="ae372932b3912864351defd6ce553ed88"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae372932b3912864351defd6ce553ed88">&#9670;&#160;</a></span>ie_tok_gptoss_decode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ie_tok_gptoss_decode </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="ie__tokenizer__gptoss_8h.html#ae1b205a897f0ece89cc8f2899acc0543">ie_tok_gptoss_t</a> *&#160;</td>
          <td class="paramname"><em>tok</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint32_t *&#160;</td>
          <td class="paramname"><em>ids</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>inout_bytes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tokenizer__gptoss_8c_source.html#l01818">1818</a> of file <a class="el" href="tokenizer__gptoss_8c_source.html">tokenizer_gptoss.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1822</span>                                              {</div>
<div class="line"><span class="lineno"> 1823</span>  <span class="keywordflow">if</span> (!tok || (!ids &amp;&amp; count) || !inout_bytes) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a2bf73548c30949834b4c282d79ef32d4">IE_TOK_GPTOSS_ERR_ARGS</a>;</div>
<div class="line"><span class="lineno"> 1824</span> </div>
<div class="line"><span class="lineno"> 1825</span>  <a class="code hl_struct" href="structstrbuf__s.html">strbuf_t</a> bytes = {0};</div>
<div class="line"><span class="lineno"> 1826</span> </div>
<div class="line"><span class="lineno"> 1827</span>  <span class="keywordflow">if</span> (tok-&gt;<a class="code hl_variable" href="structie__tok__gptoss__s.html#a41e8b48ef7e4d9c2ac9b53c06681efba">mode</a> == <a class="code hl_enumvalue" href="tokenizer__gptoss_8c.html#a4929967a6058f8fd4514406367d533c0acf2aa74fdd5fb42dd8757c120defadca">IE_TOK_MODE_TIKTOKEN</a>) {</div>
<div class="line"><span class="lineno"> 1828</span>    <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; count; ++i) {</div>
<div class="line"><span class="lineno"> 1829</span>      uint32_t <span class="keywordtype">id</span> = ids[i];</div>
<div class="line"><span class="lineno"> 1830</span>      <span class="keywordflow">if</span> (<span class="keywordtype">id</span> &gt;= tok-&gt;<a class="code hl_variable" href="structie__tok__gptoss__s.html#ae859adc2daece05fc5bd98b3f8cb913e">vocab_size</a>) { <a class="code hl_function" href="tokenizer__gptoss_8c.html#ae1e8b4fd77be0253a87c488246992c63">strbuf_free</a>(&amp;bytes); <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2afeff254edf6b97edc55beca818a7dea9">IE_TOK_GPTOSS_ERR_RANGE</a>; }</div>
<div class="line"><span class="lineno"> 1831</span>      <span class="keyword">const</span> uint8_t *p = tok-&gt;<a class="code hl_variable" href="structie__tok__gptoss__s.html#a276274c2cba2e0c82defdcf87bd2231a">id_to_bytes</a>[id].<a class="code hl_variable" href="structbytes__view__s.html#a1a3cb300987ca32a9fe4adf6423d9db5">p</a>;</div>
<div class="line"><span class="lineno"> 1832</span>      uint32_t n = tok-&gt;<a class="code hl_variable" href="structie__tok__gptoss__s.html#a276274c2cba2e0c82defdcf87bd2231a">id_to_bytes</a>[id].<a class="code hl_variable" href="structbytes__view__s.html#a7563d683f8aebfd7c45a11e8ee386d98">n</a>;</div>
<div class="line"><span class="lineno"> 1833</span>      <span class="keywordflow">if</span> (n &amp;&amp; (!p)) { <a class="code hl_function" href="tokenizer__gptoss_8c.html#ae1e8b4fd77be0253a87c488246992c63">strbuf_free</a>(&amp;bytes); <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a12ba28164c55026e3f7e5301a6ac0189">IE_TOK_GPTOSS_ERR_INTERNAL</a>; }</div>
<div class="line"><span class="lineno"> 1834</span>      <span class="keywordflow">if</span> (n) {</div>
<div class="line"><span class="lineno"> 1835</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="tokenizer__gptoss_8c.html#a7c972b84c8f4ce52042d97c576c1485b">strbuf_append_bytes</a>(&amp;bytes, (<span class="keyword">const</span> <span class="keywordtype">char</span> *)p, (<span class="keywordtype">size_t</span>)n) != 0) { <a class="code hl_function" href="tokenizer__gptoss_8c.html#ae1e8b4fd77be0253a87c488246992c63">strbuf_free</a>(&amp;bytes); <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2aa85c45ba03e4d24b20dd6c893b7e5c66">IE_TOK_GPTOSS_ERR_NOMEM</a>; }</div>
<div class="line"><span class="lineno"> 1836</span>      }</div>
<div class="line"><span class="lineno"> 1837</span>    }</div>
<div class="line"><span class="lineno"> 1838</span> </div>
<div class="line"><span class="lineno"> 1839</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="tokenizer__gptoss_8c.html#a5f7b595a9a9d4bd08b783020e9a6b637">strbuf_reserve</a>(&amp;bytes, 1) != 0) { <a class="code hl_function" href="tokenizer__gptoss_8c.html#ae1e8b4fd77be0253a87c488246992c63">strbuf_free</a>(&amp;bytes); <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2aa85c45ba03e4d24b20dd6c893b7e5c66">IE_TOK_GPTOSS_ERR_NOMEM</a>; }</div>
<div class="line"><span class="lineno"> 1840</span>    bytes.<a class="code hl_variable" href="structstrbuf__s.html#a4e51c5e374bc46c553e4d80459d0c56b">v</a>[bytes.<a class="code hl_variable" href="structstrbuf__s.html#a96ac4933915be79e2d62aaf6d0a757cf">n</a>] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 1841</span> </div>
<div class="line"><span class="lineno"> 1842</span>    <span class="keywordtype">size_t</span> need = bytes.<a class="code hl_variable" href="structstrbuf__s.html#a96ac4933915be79e2d62aaf6d0a757cf">n</a> + 1;</div>
<div class="line"><span class="lineno"> 1843</span>    <span class="keywordflow">if</span> (!out || *inout_bytes == 0) { *inout_bytes = need; <a class="code hl_function" href="tokenizer__gptoss_8c.html#ae1e8b4fd77be0253a87c488246992c63">strbuf_free</a>(&amp;bytes); <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a6e804d975236c9745c44c1db1baed259">IE_TOK_GPTOSS_OK</a>; }</div>
<div class="line"><span class="lineno"> 1844</span>    <span class="keywordflow">if</span> (*inout_bytes &lt; need) { *inout_bytes = need; <a class="code hl_function" href="tokenizer__gptoss_8c.html#ae1e8b4fd77be0253a87c488246992c63">strbuf_free</a>(&amp;bytes); <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2afeff254edf6b97edc55beca818a7dea9">IE_TOK_GPTOSS_ERR_RANGE</a>; }</div>
<div class="line"><span class="lineno"> 1845</span> </div>
<div class="line"><span class="lineno"> 1846</span>    memcpy(out, bytes.<a class="code hl_variable" href="structstrbuf__s.html#a4e51c5e374bc46c553e4d80459d0c56b">v</a>, need);</div>
<div class="line"><span class="lineno"> 1847</span>    *inout_bytes = need;</div>
<div class="line"><span class="lineno"> 1848</span>    <a class="code hl_function" href="tokenizer__gptoss_8c.html#ae1e8b4fd77be0253a87c488246992c63">strbuf_free</a>(&amp;bytes);</div>
<div class="line"><span class="lineno"> 1849</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a6e804d975236c9745c44c1db1baed259">IE_TOK_GPTOSS_OK</a>;</div>
<div class="line"><span class="lineno"> 1850</span>  }</div>
<div class="line"><span class="lineno"> 1851</span> </div>
<div class="line"><span class="lineno"> 1852</span>  <span class="keywordflow">for</span> (uint32_t i = 0; i &lt; count; ++i) {</div>
<div class="line"><span class="lineno"> 1853</span>    uint32_t <span class="keywordtype">id</span> = ids[i];</div>
<div class="line"><span class="lineno"> 1854</span>    <span class="keywordflow">if</span> (<span class="keywordtype">id</span> &gt;= tok-&gt;<a class="code hl_variable" href="structie__tok__gptoss__s.html#ae859adc2daece05fc5bd98b3f8cb913e">vocab_size</a>) { <a class="code hl_function" href="tokenizer__gptoss_8c.html#ae1e8b4fd77be0253a87c488246992c63">strbuf_free</a>(&amp;bytes); <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2afeff254edf6b97edc55beca818a7dea9">IE_TOK_GPTOSS_ERR_RANGE</a>; }</div>
<div class="line"><span class="lineno"> 1855</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *t = tok-&gt;<a class="code hl_variable" href="structie__tok__gptoss__s.html#a4417459614f97a9b31de9fc980450595">id_to_tok</a>[id];</div>
<div class="line"><span class="lineno"> 1856</span>    <span class="keywordflow">if</span> (!t) t = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><span class="lineno"> 1857</span> </div>
<div class="line"><span class="lineno"> 1858</span>    <span class="keyword">const</span> <span class="keywordtype">size_t</span> tlen = strlen(t);</div>
<div class="line"><span class="lineno"> 1859</span>    <span class="keywordtype">size_t</span> pos = 0;</div>
<div class="line"><span class="lineno"> 1860</span>    <span class="keywordflow">while</span> (pos &lt; tlen) {</div>
<div class="line"><span class="lineno"> 1861</span>      uint32_t cp = 0;</div>
<div class="line"><span class="lineno"> 1862</span>      <span class="keywordtype">int</span> st = <a class="code hl_function" href="tokenizer__gptoss_8c.html#a65dda7706f1a61f0bb0affe18aae7e87">utf8_next_cp</a>(t, tlen, &amp;pos, &amp;cp);</div>
<div class="line"><span class="lineno"> 1863</span>      <span class="keywordflow">if</span> (st != 0) { <a class="code hl_function" href="tokenizer__gptoss_8c.html#ae1e8b4fd77be0253a87c488246992c63">strbuf_free</a>(&amp;bytes); <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a12ba28164c55026e3f7e5301a6ac0189">IE_TOK_GPTOSS_ERR_INTERNAL</a>; }</div>
<div class="line"><span class="lineno"> 1864</span> </div>
<div class="line"><span class="lineno"> 1865</span>      uint8_t b = 0;</div>
<div class="line"><span class="lineno"> 1866</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="tokenizer__gptoss_8c.html#a501bba302f86962f8c5332144c6271a8">byteunicode_cp_to_byte</a>(&amp;tok-&gt;<a class="code hl_variable" href="structie__tok__gptoss__s.html#a7a6cf311089944345634de611a756678">bu</a>, cp, &amp;b) == 0) {</div>
<div class="line"><span class="lineno"> 1867</span>        <span class="keywordtype">char</span> c = (char)b;</div>
<div class="line"><span class="lineno"> 1868</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="tokenizer__gptoss_8c.html#a7c972b84c8f4ce52042d97c576c1485b">strbuf_append_bytes</a>(&amp;bytes, &amp;c, 1) != 0) { <a class="code hl_function" href="tokenizer__gptoss_8c.html#ae1e8b4fd77be0253a87c488246992c63">strbuf_free</a>(&amp;bytes); <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2aa85c45ba03e4d24b20dd6c893b7e5c66">IE_TOK_GPTOSS_ERR_NOMEM</a>; }</div>
<div class="line"><span class="lineno"> 1869</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1870</span>        <span class="keywordtype">char</span> tmp[4];</div>
<div class="line"><span class="lineno"> 1871</span>        <span class="keywordtype">size_t</span> wn = <a class="code hl_function" href="tokenizer__gptoss_8c.html#a76ab1829431e0d4b5530c5a262de3d95">utf8_put_cp</a>(tmp, <span class="keyword">sizeof</span>(tmp), cp);</div>
<div class="line"><span class="lineno"> 1872</span>        <span class="keywordflow">if</span> (wn == 0) { <a class="code hl_function" href="tokenizer__gptoss_8c.html#ae1e8b4fd77be0253a87c488246992c63">strbuf_free</a>(&amp;bytes); <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a12ba28164c55026e3f7e5301a6ac0189">IE_TOK_GPTOSS_ERR_INTERNAL</a>; }</div>
<div class="line"><span class="lineno"> 1873</span>        <span class="keywordflow">if</span> (<a class="code hl_function" href="tokenizer__gptoss_8c.html#a7c972b84c8f4ce52042d97c576c1485b">strbuf_append_bytes</a>(&amp;bytes, tmp, wn) != 0) { <a class="code hl_function" href="tokenizer__gptoss_8c.html#ae1e8b4fd77be0253a87c488246992c63">strbuf_free</a>(&amp;bytes); <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2aa85c45ba03e4d24b20dd6c893b7e5c66">IE_TOK_GPTOSS_ERR_NOMEM</a>; }</div>
<div class="line"><span class="lineno"> 1874</span>      }</div>
<div class="line"><span class="lineno"> 1875</span>    }</div>
<div class="line"><span class="lineno"> 1876</span>  }</div>
<div class="line"><span class="lineno"> 1877</span> </div>
<div class="line"><span class="lineno"> 1878</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="tokenizer__gptoss_8c.html#a5f7b595a9a9d4bd08b783020e9a6b637">strbuf_reserve</a>(&amp;bytes, 1) != 0) { <a class="code hl_function" href="tokenizer__gptoss_8c.html#ae1e8b4fd77be0253a87c488246992c63">strbuf_free</a>(&amp;bytes); <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2aa85c45ba03e4d24b20dd6c893b7e5c66">IE_TOK_GPTOSS_ERR_NOMEM</a>; }</div>
<div class="line"><span class="lineno"> 1879</span>  bytes.<a class="code hl_variable" href="structstrbuf__s.html#a4e51c5e374bc46c553e4d80459d0c56b">v</a>[bytes.<a class="code hl_variable" href="structstrbuf__s.html#a96ac4933915be79e2d62aaf6d0a757cf">n</a>] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 1880</span> </div>
<div class="line"><span class="lineno"> 1881</span>  <span class="keywordtype">size_t</span> need = bytes.<a class="code hl_variable" href="structstrbuf__s.html#a96ac4933915be79e2d62aaf6d0a757cf">n</a> + 1;</div>
<div class="line"><span class="lineno"> 1882</span>  <span class="keywordflow">if</span> (!out || *inout_bytes == 0) { *inout_bytes = need; <a class="code hl_function" href="tokenizer__gptoss_8c.html#ae1e8b4fd77be0253a87c488246992c63">strbuf_free</a>(&amp;bytes); <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a6e804d975236c9745c44c1db1baed259">IE_TOK_GPTOSS_OK</a>; }</div>
<div class="line"><span class="lineno"> 1883</span>  <span class="keywordflow">if</span> (*inout_bytes &lt; need) { *inout_bytes = need; <a class="code hl_function" href="tokenizer__gptoss_8c.html#ae1e8b4fd77be0253a87c488246992c63">strbuf_free</a>(&amp;bytes); <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2afeff254edf6b97edc55beca818a7dea9">IE_TOK_GPTOSS_ERR_RANGE</a>; }</div>
<div class="line"><span class="lineno"> 1884</span> </div>
<div class="line"><span class="lineno"> 1885</span>  memcpy(out, bytes.<a class="code hl_variable" href="structstrbuf__s.html#a4e51c5e374bc46c553e4d80459d0c56b">v</a>, need);</div>
<div class="line"><span class="lineno"> 1886</span>  *inout_bytes = need;</div>
<div class="line"><span class="lineno"> 1887</span>  <a class="code hl_function" href="tokenizer__gptoss_8c.html#ae1e8b4fd77be0253a87c488246992c63">strbuf_free</a>(&amp;bytes);</div>
<div class="line"><span class="lineno"> 1888</span>  <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a6e804d975236c9745c44c1db1baed259">IE_TOK_GPTOSS_OK</a>;</div>
<div class="line"><span class="lineno"> 1889</span>}</div>
<div class="ttc" id="astructbytes__view__s_html_a1a3cb300987ca32a9fe4adf6423d9db5"><div class="ttname"><a href="structbytes__view__s.html#a1a3cb300987ca32a9fe4adf6423d9db5">bytes_view_s::p</a></div><div class="ttdeci">const uint8_t * p</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l00790">tokenizer_gptoss.c:790</a></div></div>
<div class="ttc" id="astructbytes__view__s_html_a7563d683f8aebfd7c45a11e8ee386d98"><div class="ttname"><a href="structbytes__view__s.html#a7563d683f8aebfd7c45a11e8ee386d98">bytes_view_s::n</a></div><div class="ttdeci">uint32_t n</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l00791">tokenizer_gptoss.c:791</a></div></div>
<div class="ttc" id="astructie__tok__gptoss__s_html_a41e8b48ef7e4d9c2ac9b53c06681efba"><div class="ttname"><a href="structie__tok__gptoss__s.html#a41e8b48ef7e4d9c2ac9b53c06681efba">ie_tok_gptoss_s::mode</a></div><div class="ttdeci">ie_tok_mode_t mode</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l00795">tokenizer_gptoss.c:795</a></div></div>
<div class="ttc" id="astructie__tok__gptoss__s_html_a7a6cf311089944345634de611a756678"><div class="ttname"><a href="structie__tok__gptoss__s.html#a7a6cf311089944345634de611a756678">ie_tok_gptoss_s::bu</a></div><div class="ttdeci">byteunicode_t bu</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l00805">tokenizer_gptoss.c:805</a></div></div>
<div class="ttc" id="astructstrbuf__s_html"><div class="ttname"><a href="structstrbuf__s.html">strbuf_s</a></div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l00687">tokenizer_gptoss.c:687</a></div></div>
<div class="ttc" id="astructstrbuf__s_html_a4e51c5e374bc46c553e4d80459d0c56b"><div class="ttname"><a href="structstrbuf__s.html#a4e51c5e374bc46c553e4d80459d0c56b">strbuf_s::v</a></div><div class="ttdeci">char * v</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l00688">tokenizer_gptoss.c:688</a></div></div>
<div class="ttc" id="astructstrbuf__s_html_a96ac4933915be79e2d62aaf6d0a757cf"><div class="ttname"><a href="structstrbuf__s.html#a96ac4933915be79e2d62aaf6d0a757cf">strbuf_s::n</a></div><div class="ttdeci">size_t n</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l00689">tokenizer_gptoss.c:689</a></div></div>
<div class="ttc" id="atokenizer__gptoss_8c_html_a4929967a6058f8fd4514406367d533c0acf2aa74fdd5fb42dd8757c120defadca"><div class="ttname"><a href="tokenizer__gptoss_8c.html#a4929967a6058f8fd4514406367d533c0acf2aa74fdd5fb42dd8757c120defadca">IE_TOK_MODE_TIKTOKEN</a></div><div class="ttdeci">@ IE_TOK_MODE_TIKTOKEN</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l00787">tokenizer_gptoss.c:786</a></div></div>
<div class="ttc" id="atokenizer__gptoss_8c_html_a501bba302f86962f8c5332144c6271a8"><div class="ttname"><a href="tokenizer__gptoss_8c.html#a501bba302f86962f8c5332144c6271a8">byteunicode_cp_to_byte</a></div><div class="ttdeci">static int byteunicode_cp_to_byte(const byteunicode_t *m, uint32_t cp, uint8_t *out_b)</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l00658">tokenizer_gptoss.c:658</a></div></div>
<div class="ttc" id="atokenizer__gptoss_8c_html_a5f7b595a9a9d4bd08b783020e9a6b637"><div class="ttname"><a href="tokenizer__gptoss_8c.html#a5f7b595a9a9d4bd08b783020e9a6b637">strbuf_reserve</a></div><div class="ttdeci">static int strbuf_reserve(strbuf_t *b, size_t add)</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l00693">tokenizer_gptoss.c:693</a></div></div>
<div class="ttc" id="atokenizer__gptoss_8c_html_a65dda7706f1a61f0bb0affe18aae7e87"><div class="ttname"><a href="tokenizer__gptoss_8c.html#a65dda7706f1a61f0bb0affe18aae7e87">utf8_next_cp</a></div><div class="ttdeci">static int utf8_next_cp(const char *s, size_t n, size_t *io_i, uint32_t *out_cp)</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l00124">tokenizer_gptoss.c:124</a></div></div>
<div class="ttc" id="atokenizer__gptoss_8c_html_a76ab1829431e0d4b5530c5a262de3d95"><div class="ttname"><a href="tokenizer__gptoss_8c.html#a76ab1829431e0d4b5530c5a262de3d95">utf8_put_cp</a></div><div class="ttdeci">static size_t utf8_put_cp(char *dst, size_t cap, uint32_t cp)</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l00151">tokenizer_gptoss.c:151</a></div></div>
<div class="ttc" id="atokenizer__gptoss_8c_html_a7c972b84c8f4ce52042d97c576c1485b"><div class="ttname"><a href="tokenizer__gptoss_8c.html#a7c972b84c8f4ce52042d97c576c1485b">strbuf_append_bytes</a></div><div class="ttdeci">static int strbuf_append_bytes(strbuf_t *b, const char *s, size_t n)</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l00705">tokenizer_gptoss.c:705</a></div></div>
<div class="ttc" id="atokenizer__gptoss_8c_html_ae1e8b4fd77be0253a87c488246992c63"><div class="ttname"><a href="tokenizer__gptoss_8c.html#ae1e8b4fd77be0253a87c488246992c63">strbuf_free</a></div><div class="ttdeci">static void strbuf_free(strbuf_t *b)</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l00713">tokenizer_gptoss.c:713</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="tokenizer__gptoss_8c_source.html#l00805">ie_tok_gptoss_s::bu</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l00658">byteunicode_cp_to_byte()</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l00808">ie_tok_gptoss_s::id_to_bytes</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l00799">ie_tok_gptoss_s::id_to_tok</a>, <a class="el" href="ie__tokenizer__gptoss_8h_source.html#l00039">IE_TOK_GPTOSS_ERR_ARGS</a>, <a class="el" href="ie__tokenizer__gptoss_8h_source.html#l00044">IE_TOK_GPTOSS_ERR_INTERNAL</a>, <a class="el" href="ie__tokenizer__gptoss_8h_source.html#l00042">IE_TOK_GPTOSS_ERR_NOMEM</a>, <a class="el" href="ie__tokenizer__gptoss_8h_source.html#l00043">IE_TOK_GPTOSS_ERR_RANGE</a>, <a class="el" href="ie__tokenizer__gptoss_8h_source.html#l00038">IE_TOK_GPTOSS_OK</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l00786">IE_TOK_MODE_TIKTOKEN</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l00795">ie_tok_gptoss_s::mode</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l00689">strbuf_s::n</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l00791">bytes_view_s::n</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l00790">bytes_view_s::p</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l00705">strbuf_append_bytes()</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l00713">strbuf_free()</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l00693">strbuf_reserve()</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l00124">utf8_next_cp()</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l00151">utf8_put_cp()</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l00688">strbuf_s::v</a>, and <a class="el" href="tokenizer__gptoss_8c_source.html#l00796">ie_tok_gptoss_s::vocab_size</a>.</p>

<p class="reference">Referenced by <a class="el" href="main__chat_8c_source.html#l00073">cmd_decode()</a>, <a class="el" href="main__chat_8c_source.html#l00141">cmd_roundtrip()</a>, <a class="el" href="ie__api_8c_source.html#l00453">decode_piece_preview_()</a>, <a class="el" href="main__infer_8c_source.html#l00866">decode_tokens_best_effort()</a>, and <a class="el" href="ie__api_8c_source.html#l00826">ie_engine_generate_ex()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="ie__tokenizer__gptoss_8h_ae372932b3912864351defd6ce553ed88_cgraph.svg" width="100%" height="514"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="ie__tokenizer__gptoss_8h_ae372932b3912864351defd6ce553ed88_icgraph.svg" width="100%" height="483"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a171cd54148a22d4fd7c1c8d1e9f010de" name="a171cd54148a22d4fd7c1c8d1e9f010de"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a171cd54148a22d4fd7c1c8d1e9f010de">&#9670;&#160;</a></span>ie_tok_gptoss_encode()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ie_tok_gptoss_encode </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="ie__tokenizer__gptoss_8h.html#ae1b205a897f0ece89cc8f2899acc0543">ie_tok_gptoss_t</a> *&#160;</td>
          <td class="paramname"><em>tok</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>text</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>ids</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t *&#160;</td>
          <td class="paramname"><em>inout_count</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tokenizer__gptoss_8c_source.html#l01891">1891</a> of file <a class="el" href="tokenizer__gptoss_8c_source.html">tokenizer_gptoss.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1894</span>                                                {</div>
<div class="line"><span class="lineno"> 1895</span>  <span class="keywordflow">if</span> (!tok || !text || !inout_count) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a2bf73548c30949834b4c282d79ef32d4">IE_TOK_GPTOSS_ERR_ARGS</a>;</div>
<div class="line"><span class="lineno"> 1896</span> </div>
<div class="line"><span class="lineno"> 1897</span>  <a class="code hl_struct" href="structu32buf__s.html">u32buf_t</a> out_ids = {0};</div>
<div class="line"><span class="lineno"> 1898</span> </div>
<div class="line"><span class="lineno"> 1899</span>  <span class="keywordflow">if</span> (tok-&gt;<a class="code hl_variable" href="structie__tok__gptoss__s.html#a41e8b48ef7e4d9c2ac9b53c06681efba">mode</a> == <a class="code hl_enumvalue" href="tokenizer__gptoss_8c.html#a4929967a6058f8fd4514406367d533c0acf2aa74fdd5fb42dd8757c120defadca">IE_TOK_MODE_TIKTOKEN</a>) {</div>
<div class="line"><span class="lineno"> 1900</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="tokenizer__gptoss_8c.html#a316196e2c96c525919801e2cdd715806">tt_encode_text</a>(tok, text, &amp;out_ids) != 0) { free(out_ids.<a class="code hl_variable" href="structu32buf__s.html#a63ffad1f267a58867d21cc7b6b6f81ee">v</a>); <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a12ba28164c55026e3f7e5301a6ac0189">IE_TOK_GPTOSS_ERR_INTERNAL</a>; }</div>
<div class="line"><span class="lineno"> 1901</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1902</span>    <span class="keywordtype">char</span> **parts = NULL;</div>
<div class="line"><span class="lineno"> 1903</span>    <span class="keywordtype">size_t</span> nparts = 0;</div>
<div class="line"><span class="lineno"> 1904</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="tokenizer__gptoss_8c.html#a2d0b020d093299557c89f6753c85ddf2">pretokenize_basic</a>(text, &amp;parts, &amp;nparts) != 0) { free(out_ids.<a class="code hl_variable" href="structu32buf__s.html#a63ffad1f267a58867d21cc7b6b6f81ee">v</a>); <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a12ba28164c55026e3f7e5301a6ac0189">IE_TOK_GPTOSS_ERR_INTERNAL</a>; }</div>
<div class="line"><span class="lineno"> 1905</span> </div>
<div class="line"><span class="lineno"> 1906</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; nparts; ++i) {</div>
<div class="line"><span class="lineno"> 1907</span>      <span class="keyword">const</span> <span class="keywordtype">char</span> *seg = parts[i];</div>
<div class="line"><span class="lineno"> 1908</span>      <span class="keywordflow">if</span> (!seg || !*seg) { free(parts[i]); <span class="keywordflow">continue</span>; }</div>
<div class="line"><span class="lineno"> 1909</span> </div>
<div class="line"><span class="lineno"> 1910</span>      <a class="code hl_struct" href="structstrbuf__s.html">strbuf_t</a> bl = {0};</div>
<div class="line"><span class="lineno"> 1911</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="tokenizer__gptoss_8c.html#af25b623505fecd332b0925d6c5c1dea2">to_bytelevel_unicode</a>(&amp;tok-&gt;<a class="code hl_variable" href="structie__tok__gptoss__s.html#a7a6cf311089944345634de611a756678">bu</a>, seg, strlen(seg), &amp;bl) != 0) { <a class="code hl_function" href="tokenizer__gptoss_8c.html#ae1e8b4fd77be0253a87c488246992c63">strbuf_free</a>(&amp;bl); <span class="keywordflow">goto</span> fail_gpt2; }</div>
<div class="line"><span class="lineno"> 1912</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="tokenizer__gptoss_8c.html#a5f7b595a9a9d4bd08b783020e9a6b637">strbuf_reserve</a>(&amp;bl, 1) != 0) { <a class="code hl_function" href="tokenizer__gptoss_8c.html#ae1e8b4fd77be0253a87c488246992c63">strbuf_free</a>(&amp;bl); <span class="keywordflow">goto</span> fail_gpt2; }</div>
<div class="line"><span class="lineno"> 1913</span>      bl.<a class="code hl_variable" href="structstrbuf__s.html#a4e51c5e374bc46c553e4d80459d0c56b">v</a>[bl.<a class="code hl_variable" href="structstrbuf__s.html#a96ac4933915be79e2d62aaf6d0a757cf">n</a>] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno"> 1914</span> </div>
<div class="line"><span class="lineno"> 1915</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="tokenizer__gptoss_8c.html#a25fb92de16ca991b41ddb7448780cd1d">bpe_encode_to_ids_gpt2</a>(tok, bl.<a class="code hl_variable" href="structstrbuf__s.html#a4e51c5e374bc46c553e4d80459d0c56b">v</a>, &amp;out_ids) != 0) { <a class="code hl_function" href="tokenizer__gptoss_8c.html#ae1e8b4fd77be0253a87c488246992c63">strbuf_free</a>(&amp;bl); <span class="keywordflow">goto</span> fail_gpt2; }</div>
<div class="line"><span class="lineno"> 1916</span>      <a class="code hl_function" href="tokenizer__gptoss_8c.html#ae1e8b4fd77be0253a87c488246992c63">strbuf_free</a>(&amp;bl);</div>
<div class="line"><span class="lineno"> 1917</span>      free(parts[i]);</div>
<div class="line"><span class="lineno"> 1918</span>    }</div>
<div class="line"><span class="lineno"> 1919</span> </div>
<div class="line"><span class="lineno"> 1920</span>    free(parts);</div>
<div class="line"><span class="lineno"> 1921</span>    parts = NULL;</div>
<div class="line"><span class="lineno"> 1922</span>    nparts = 0;</div>
<div class="line"><span class="lineno"> 1923</span>  }</div>
<div class="line"><span class="lineno"> 1924</span> </div>
<div class="line"><span class="lineno"> 1925</span>  uint32_t need = (uint32_t)out_ids.<a class="code hl_variable" href="structu32buf__s.html#a69bb223dbff5f86425d029f71f2e800b">n</a>;</div>
<div class="line"><span class="lineno"> 1926</span>  <span class="keywordflow">if</span> (!ids || *inout_count == 0) {</div>
<div class="line"><span class="lineno"> 1927</span>    *inout_count = need;</div>
<div class="line"><span class="lineno"> 1928</span>    free(out_ids.<a class="code hl_variable" href="structu32buf__s.html#a63ffad1f267a58867d21cc7b6b6f81ee">v</a>);</div>
<div class="line"><span class="lineno"> 1929</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a6e804d975236c9745c44c1db1baed259">IE_TOK_GPTOSS_OK</a>;</div>
<div class="line"><span class="lineno"> 1930</span>  }</div>
<div class="line"><span class="lineno"> 1931</span> </div>
<div class="line"><span class="lineno"> 1932</span>  <span class="keywordflow">if</span> (*inout_count &lt; need) {</div>
<div class="line"><span class="lineno"> 1933</span>    *inout_count = need;</div>
<div class="line"><span class="lineno"> 1934</span>    free(out_ids.<a class="code hl_variable" href="structu32buf__s.html#a63ffad1f267a58867d21cc7b6b6f81ee">v</a>);</div>
<div class="line"><span class="lineno"> 1935</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2afeff254edf6b97edc55beca818a7dea9">IE_TOK_GPTOSS_ERR_RANGE</a>;</div>
<div class="line"><span class="lineno"> 1936</span>  }</div>
<div class="line"><span class="lineno"> 1937</span> </div>
<div class="line"><span class="lineno"> 1938</span>  memcpy(ids, out_ids.<a class="code hl_variable" href="structu32buf__s.html#a63ffad1f267a58867d21cc7b6b6f81ee">v</a>, (<span class="keywordtype">size_t</span>)need * <span class="keyword">sizeof</span>(uint32_t));</div>
<div class="line"><span class="lineno"> 1939</span>  *inout_count = need;</div>
<div class="line"><span class="lineno"> 1940</span>  free(out_ids.<a class="code hl_variable" href="structu32buf__s.html#a63ffad1f267a58867d21cc7b6b6f81ee">v</a>);</div>
<div class="line"><span class="lineno"> 1941</span>  <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a6e804d975236c9745c44c1db1baed259">IE_TOK_GPTOSS_OK</a>;</div>
<div class="line"><span class="lineno"> 1942</span> </div>
<div class="line"><span class="lineno"> 1943</span>fail_gpt2:</div>
<div class="line"><span class="lineno"> 1944</span>  free(out_ids.<a class="code hl_variable" href="structu32buf__s.html#a63ffad1f267a58867d21cc7b6b6f81ee">v</a>);</div>
<div class="line"><span class="lineno"> 1945</span>  <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a12ba28164c55026e3f7e5301a6ac0189">IE_TOK_GPTOSS_ERR_INTERNAL</a>;</div>
<div class="line"><span class="lineno"> 1946</span>}</div>
<div class="ttc" id="astructu32buf__s_html"><div class="ttname"><a href="structu32buf__s.html">u32buf_s</a></div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l00668">tokenizer_gptoss.c:668</a></div></div>
<div class="ttc" id="astructu32buf__s_html_a63ffad1f267a58867d21cc7b6b6f81ee"><div class="ttname"><a href="structu32buf__s.html#a63ffad1f267a58867d21cc7b6b6f81ee">u32buf_s::v</a></div><div class="ttdeci">uint32_t * v</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l00669">tokenizer_gptoss.c:669</a></div></div>
<div class="ttc" id="astructu32buf__s_html_a69bb223dbff5f86425d029f71f2e800b"><div class="ttname"><a href="structu32buf__s.html#a69bb223dbff5f86425d029f71f2e800b">u32buf_s::n</a></div><div class="ttdeci">size_t n</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l00670">tokenizer_gptoss.c:670</a></div></div>
<div class="ttc" id="atokenizer__gptoss_8c_html_a25fb92de16ca991b41ddb7448780cd1d"><div class="ttname"><a href="tokenizer__gptoss_8c.html#a25fb92de16ca991b41ddb7448780cd1d">bpe_encode_to_ids_gpt2</a></div><div class="ttdeci">static int bpe_encode_to_ids_gpt2(const ie_tok_gptoss_t *tok, const char *in, u32buf_t *out_ids)</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l01553">tokenizer_gptoss.c:1553</a></div></div>
<div class="ttc" id="atokenizer__gptoss_8c_html_a2d0b020d093299557c89f6753c85ddf2"><div class="ttname"><a href="tokenizer__gptoss_8c.html#a2d0b020d093299557c89f6753c85ddf2">pretokenize_basic</a></div><div class="ttdeci">static int pretokenize_basic(const char *text, char ***out_parts, size_t *out_n)</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l01478">tokenizer_gptoss.c:1478</a></div></div>
<div class="ttc" id="atokenizer__gptoss_8c_html_a316196e2c96c525919801e2cdd715806"><div class="ttname"><a href="tokenizer__gptoss_8c.html#a316196e2c96c525919801e2cdd715806">tt_encode_text</a></div><div class="ttdeci">static int tt_encode_text(const ie_tok_gptoss_t *tok, const char *text, u32buf_t *out_ids)</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l01736">tokenizer_gptoss.c:1736</a></div></div>
<div class="ttc" id="atokenizer__gptoss_8c_html_af25b623505fecd332b0925d6c5c1dea2"><div class="ttname"><a href="tokenizer__gptoss_8c.html#af25b623505fecd332b0925d6c5c1dea2">to_bytelevel_unicode</a></div><div class="ttdeci">static int to_bytelevel_unicode(const byteunicode_t *bu, const char *s, size_t n, strbuf_t *out)</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l01465">tokenizer_gptoss.c:1465</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="tokenizer__gptoss_8c_source.html#l01553">bpe_encode_to_ids_gpt2()</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l00805">ie_tok_gptoss_s::bu</a>, <a class="el" href="ie__tokenizer__gptoss_8h_source.html#l00039">IE_TOK_GPTOSS_ERR_ARGS</a>, <a class="el" href="ie__tokenizer__gptoss_8h_source.html#l00044">IE_TOK_GPTOSS_ERR_INTERNAL</a>, <a class="el" href="ie__tokenizer__gptoss_8h_source.html#l00043">IE_TOK_GPTOSS_ERR_RANGE</a>, <a class="el" href="ie__tokenizer__gptoss_8h_source.html#l00038">IE_TOK_GPTOSS_OK</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l00786">IE_TOK_MODE_TIKTOKEN</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l00795">ie_tok_gptoss_s::mode</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l00670">u32buf_s::n</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l00689">strbuf_s::n</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l01478">pretokenize_basic()</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l00713">strbuf_free()</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l00693">strbuf_reserve()</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l01465">to_bytelevel_unicode()</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l01736">tt_encode_text()</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l00669">u32buf_s::v</a>, and <a class="el" href="tokenizer__gptoss_8c_source.html#l00688">strbuf_s::v</a>.</p>

<p class="reference">Referenced by <a class="el" href="main__chat_8c_source.html#l00110">cmd_encode()</a>, <a class="el" href="main__chat_8c_source.html#l00141">cmd_roundtrip()</a>, <a class="el" href="ie__api_8c_source.html#l00826">ie_engine_generate_ex()</a>, and <a class="el" href="generate__gptoss_8c_source.html#l00038">ie_generate_gptoss()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="ie__tokenizer__gptoss_8h_a171cd54148a22d4fd7c1c8d1e9f010de_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="ie__tokenizer__gptoss_8h_a171cd54148a22d4fd7c1c8d1e9f010de_icgraph.svg" width="100%" height="438"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="ae5c55dc1502414c60d1a99fa9fbdf1bc" name="ae5c55dc1502414c60d1a99fa9fbdf1bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae5c55dc1502414c60d1a99fa9fbdf1bc">&#9670;&#160;</a></span>ie_tok_gptoss_open()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ie_tok_gptoss_open </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>tokenizer_path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="ie__tokenizer__gptoss_8h.html#ae1b205a897f0ece89cc8f2899acc0543">ie_tok_gptoss_t</a> **&#160;</td>
          <td class="paramname"><em>out_tok</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Open a tokenizer from: </p>
<ul>
<li>tokenizer.json</li>
<li>tokenizer.tiktoken</li>
<li>packed IETOK1 file</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">tokenizer_path</td><td>Path to tokenizer file. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">out_tok</td><td>Tokenizer handle. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>IE_TOK_GPTOSS_OK on success, negative error otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="tokenizer__gptoss_8c_source.html#l01761">1761</a> of file <a class="el" href="tokenizer__gptoss_8c_source.html">tokenizer_gptoss.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1761</span>                                                                              {</div>
<div class="line"><span class="lineno"> 1762</span>  <span class="keywordflow">if</span> (!tokenizer_path || !out_tok) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a2bf73548c30949834b4c282d79ef32d4">IE_TOK_GPTOSS_ERR_ARGS</a>;</div>
<div class="line"><span class="lineno"> 1763</span>  *out_tok = NULL;</div>
<div class="line"><span class="lineno"> 1764</span> </div>
<div class="line"><span class="lineno"> 1765</span>  <span class="keywordtype">char</span> *buf = NULL;</div>
<div class="line"><span class="lineno"> 1766</span>  <span class="keywordtype">size_t</span> len = 0;</div>
<div class="line"><span class="lineno"> 1767</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="tokenizer__gptoss_8c.html#a84e8a603fef81b42cc1913caf9216f13">read_all_bytes</a>(tokenizer_path, &amp;buf, &amp;len) != 0) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a7635c982b781a8ef569aded5c8cbcef7">IE_TOK_GPTOSS_ERR_IO</a>;</div>
<div class="line"><span class="lineno"> 1768</span> </div>
<div class="line"><span class="lineno"> 1769</span>  <a class="code hl_struct" href="structie__tok__gptoss__s.html">ie_tok_gptoss_t</a> *tok = (<a class="code hl_struct" href="structie__tok__gptoss__s.html">ie_tok_gptoss_t</a> *)<a class="code hl_function" href="tokenizer__gptoss_8c.html#a981c4f4b5894b549eb0b2f0358810c67">xcalloc</a>(1, <span class="keyword">sizeof</span>(*tok));</div>
<div class="line"><span class="lineno"> 1770</span>  <span class="keywordflow">if</span> (!tok) { free(buf); <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2aa85c45ba03e4d24b20dd6c893b7e5c66">IE_TOK_GPTOSS_ERR_NOMEM</a>; }</div>
<div class="line"><span class="lineno"> 1771</span> </div>
<div class="line"><span class="lineno"> 1772</span>  <a class="code hl_function" href="tokenizer__gptoss_8c.html#ad4c1b8d22b27793678d951b45034176d">byteunicode_init</a>(&amp;tok-&gt;<a class="code hl_variable" href="structie__tok__gptoss__s.html#a7a6cf311089944345634de611a756678">bu</a>);</div>
<div class="line"><span class="lineno"> 1773</span> </div>
<div class="line"><span class="lineno"> 1774</span>  <span class="keywordtype">int</span> rc = <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a5b6eb590f3790b4e61df67c181dbf6e6">IE_TOK_GPTOSS_ERR_JSON</a>;</div>
<div class="line"><span class="lineno"> 1775</span> </div>
<div class="line"><span class="lineno"> 1776</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="tokenizer__gptoss_8c.html#ab46d669ba9cff8f9da6f83855783db7b">is_packed_tokenizer</a>((<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)buf, len)) {</div>
<div class="line"><span class="lineno"> 1777</span>    rc = <a class="code hl_function" href="tokenizer__gptoss_8c.html#adf511a811d96d1b3b8892529ed1088d1">parse_tokenizer_packed</a>((<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)buf, len, tok);</div>
<div class="line"><span class="lineno"> 1778</span>  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="tokenizer__gptoss_8c.html#aa12e2f8ade90f9aefa8f1562d02965b8">path_ends_with</a>(tokenizer_path, <span class="stringliteral">&quot;.tiktoken&quot;</span>)) {</div>
<div class="line"><span class="lineno"> 1779</span>    rc = <a class="code hl_function" href="tokenizer__gptoss_8c.html#a32e83b198fce9015f852f307d2bf2953">parse_tokenizer_tiktoken</a>(buf, len, tok);</div>
<div class="line"><span class="lineno"> 1780</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno"> 1781</span>    rc = <a class="code hl_function" href="tokenizer__gptoss_8c.html#a232e17961642239dec21aad8eb19b287">parse_tokenizer_json</a>(buf, tok);</div>
<div class="line"><span class="lineno"> 1782</span>  }</div>
<div class="line"><span class="lineno"> 1783</span> </div>
<div class="line"><span class="lineno"> 1784</span>  free(buf);</div>
<div class="line"><span class="lineno"> 1785</span> </div>
<div class="line"><span class="lineno"> 1786</span>  <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a6e804d975236c9745c44c1db1baed259">IE_TOK_GPTOSS_OK</a>) {</div>
<div class="line"><span class="lineno"> 1787</span>    <a class="code hl_function" href="tokenizer__gptoss_8c.html#ad4b875bec514bb9c1de945944e1596de">ie_tok_gptoss_close</a>(tok);</div>
<div class="line"><span class="lineno"> 1788</span>    <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno"> 1789</span>  }</div>
<div class="line"><span class="lineno"> 1790</span> </div>
<div class="line"><span class="lineno"> 1791</span>  *out_tok = tok;</div>
<div class="line"><span class="lineno"> 1792</span>  <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__tokenizer__gptoss_8h.html#a1305696bd5b44e9ad4e2b624ce1b59f2a6e804d975236c9745c44c1db1baed259">IE_TOK_GPTOSS_OK</a>;</div>
<div class="line"><span class="lineno"> 1793</span>}</div>
<div class="ttc" id="astructie__tok__gptoss__s_html"><div class="ttname"><a href="structie__tok__gptoss__s.html">ie_tok_gptoss_s</a></div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l00794">tokenizer_gptoss.c:794</a></div></div>
<div class="ttc" id="atokenizer__gptoss_8c_html_a232e17961642239dec21aad8eb19b287"><div class="ttname"><a href="tokenizer__gptoss_8c.html#a232e17961642239dec21aad8eb19b287">parse_tokenizer_json</a></div><div class="ttdeci">static int parse_tokenizer_json(const char *json, ie_tok_gptoss_t *tok)</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l01149">tokenizer_gptoss.c:1149</a></div></div>
<div class="ttc" id="atokenizer__gptoss_8c_html_a32e83b198fce9015f852f307d2bf2953"><div class="ttname"><a href="tokenizer__gptoss_8c.html#a32e83b198fce9015f852f307d2bf2953">parse_tokenizer_tiktoken</a></div><div class="ttdeci">static int parse_tokenizer_tiktoken(const char *text, size_t len, ie_tok_gptoss_t *tok)</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l01385">tokenizer_gptoss.c:1385</a></div></div>
<div class="ttc" id="atokenizer__gptoss_8c_html_a84e8a603fef81b42cc1913caf9216f13"><div class="ttname"><a href="tokenizer__gptoss_8c.html#a84e8a603fef81b42cc1913caf9216f13">read_all_bytes</a></div><div class="ttdeci">static int read_all_bytes(const char *path, char **out_buf, size_t *out_len)</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l00087">tokenizer_gptoss.c:87</a></div></div>
<div class="ttc" id="atokenizer__gptoss_8c_html_a981c4f4b5894b549eb0b2f0358810c67"><div class="ttname"><a href="tokenizer__gptoss_8c.html#a981c4f4b5894b549eb0b2f0358810c67">xcalloc</a></div><div class="ttdeci">static void * xcalloc(size_t n, size_t sz)</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l00068">tokenizer_gptoss.c:68</a></div></div>
<div class="ttc" id="atokenizer__gptoss_8c_html_aa12e2f8ade90f9aefa8f1562d02965b8"><div class="ttname"><a href="tokenizer__gptoss_8c.html#aa12e2f8ade90f9aefa8f1562d02965b8">path_ends_with</a></div><div class="ttdeci">static int path_ends_with(const char *path, const char *suf)</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l00112">tokenizer_gptoss.c:112</a></div></div>
<div class="ttc" id="atokenizer__gptoss_8c_html_ab46d669ba9cff8f9da6f83855783db7b"><div class="ttname"><a href="tokenizer__gptoss_8c.html#ab46d669ba9cff8f9da6f83855783db7b">is_packed_tokenizer</a></div><div class="ttdeci">static int is_packed_tokenizer(const unsigned char *buf, size_t n)</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l01276">tokenizer_gptoss.c:1276</a></div></div>
<div class="ttc" id="atokenizer__gptoss_8c_html_ad4b875bec514bb9c1de945944e1596de"><div class="ttname"><a href="tokenizer__gptoss_8c.html#ad4b875bec514bb9c1de945944e1596de">ie_tok_gptoss_close</a></div><div class="ttdeci">void ie_tok_gptoss_close(ie_tok_gptoss_t *tok)</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l01795">tokenizer_gptoss.c:1795</a></div></div>
<div class="ttc" id="atokenizer__gptoss_8c_html_ad4c1b8d22b27793678d951b45034176d"><div class="ttname"><a href="tokenizer__gptoss_8c.html#ad4c1b8d22b27793678d951b45034176d">byteunicode_init</a></div><div class="ttdeci">static void byteunicode_init(byteunicode_t *m)</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l00635">tokenizer_gptoss.c:635</a></div></div>
<div class="ttc" id="atokenizer__gptoss_8c_html_adf511a811d96d1b3b8892529ed1088d1"><div class="ttname"><a href="tokenizer__gptoss_8c.html#adf511a811d96d1b3b8892529ed1088d1">parse_tokenizer_packed</a></div><div class="ttdeci">static int parse_tokenizer_packed(const unsigned char *buf, size_t n, ie_tok_gptoss_t *tok)</div><div class="ttdef"><b>Definition</b> <a href="tokenizer__gptoss_8c_source.html#l01210">tokenizer_gptoss.c:1210</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="tokenizer__gptoss_8c_source.html#l00805">ie_tok_gptoss_s::bu</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l00635">byteunicode_init()</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l01795">ie_tok_gptoss_close()</a>, <a class="el" href="ie__tokenizer__gptoss_8h_source.html#l00039">IE_TOK_GPTOSS_ERR_ARGS</a>, <a class="el" href="ie__tokenizer__gptoss_8h_source.html#l00040">IE_TOK_GPTOSS_ERR_IO</a>, <a class="el" href="ie__tokenizer__gptoss_8h_source.html#l00041">IE_TOK_GPTOSS_ERR_JSON</a>, <a class="el" href="ie__tokenizer__gptoss_8h_source.html#l00042">IE_TOK_GPTOSS_ERR_NOMEM</a>, <a class="el" href="ie__tokenizer__gptoss_8h_source.html#l00038">IE_TOK_GPTOSS_OK</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l01276">is_packed_tokenizer()</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l01149">parse_tokenizer_json()</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l01210">parse_tokenizer_packed()</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l01385">parse_tokenizer_tiktoken()</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l00112">path_ends_with()</a>, <a class="el" href="tokenizer__gptoss_8c_source.html#l00087">read_all_bytes()</a>, and <a class="el" href="tokenizer__gptoss_8c_source.html#l00068">xcalloc()</a>.</p>

<p class="reference">Referenced by <a class="el" href="main__infer_8c_source.html#l00866">decode_tokens_best_effort()</a>, <a class="el" href="ie__api_8c_source.html#l00535">ie_engine_create()</a>, and <a class="el" href="main__chat_8c_source.html#l00185">main()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="ie__tokenizer__gptoss_8h_ae5c55dc1502414c60d1a99fa9fbdf1bc_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="ie__tokenizer__gptoss_8h_ae5c55dc1502414c60d1a99fa9fbdf1bc_icgraph.svg" width="467" height="151"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a0a4146017408baa0a07ffa747dfae870" name="a0a4146017408baa0a07ffa747dfae870"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0a4146017408baa0a07ffa747dfae870">&#9670;&#160;</a></span>ie_tok_gptoss_vocab_size()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t ie_tok_gptoss_vocab_size </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="ie__tokenizer__gptoss_8h.html#ae1b205a897f0ece89cc8f2899acc0543">ie_tok_gptoss_t</a> *&#160;</td>
          <td class="paramname"><em>tok</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="tokenizer__gptoss_8c_source.html#l01813">1813</a> of file <a class="el" href="tokenizer__gptoss_8c_source.html">tokenizer_gptoss.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno"> 1813</span>                                                              {</div>
<div class="line"><span class="lineno"> 1814</span>  <span class="keywordflow">if</span> (!tok) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno"> 1815</span>  <span class="keywordflow">return</span> tok-&gt;<a class="code hl_variable" href="structie__tok__gptoss__s.html#ae859adc2daece05fc5bd98b3f8cb913e">vocab_size</a>;</div>
<div class="line"><span class="lineno"> 1816</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="tokenizer__gptoss_8c_source.html#l00796">ie_tok_gptoss_s::vocab_size</a>.</p>

<p class="reference">Referenced by <a class="el" href="ie__api_8c_source.html#l00535">ie_engine_create()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="ie__tokenizer__gptoss_8h_a0a4146017408baa0a07ffa747dfae870_icgraph.svg" width="486" height="86"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_996f45160da62e1a3d7f6046fad68f51.html">engine</a></li><li class="navelem"><a class="el" href="dir_bafa501d493553e442f19f5f8dd7b29c.html">include</a></li><li class="navelem"><a class="el" href="ie__tokenizer__gptoss_8h.html">ie_tokenizer_gptoss.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
