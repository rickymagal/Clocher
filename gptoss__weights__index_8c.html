<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Inference Engine (Clocher): engine/src/runtime/gptoss_weights_index.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Inference Engine (Clocher)<span id="projectnumber">&#160;0.2</span>
   </div>
   <div id="projectbrief">C11 CPU/GPU inference baseline with strict metrics &amp; harness</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('gptoss__weights__index_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">gptoss_weights_index.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>GPT-OSS weight indexing, name probing, and tensor resolution.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="gptoss__weights__index_8h_source.html">gptoss_weights_index.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="ie__io_8h_source.html">ie_io.h</a>&quot;</code><br />
<code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdlib.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;stdarg.h&gt;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for gptoss_weights_index.c:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8c__incl.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
</div>
<p><a href="gptoss__weights__index_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structgptoss__mapped__file__t.html">gptoss_mapped_file_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Minimal read-only file mapping abstraction.  <a href="structgptoss__mapped__file__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structgptoss__weights__index__t.html">gptoss_weights_index_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Loaded tensor_map + mapped weights binary + optional dedup loader handle.  <a href="structgptoss__weights__index__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a3024ccd4a9af5109d24e6c57565d74a1" id="r_a3024ccd4a9af5109d24e6c57565d74a1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8c.html#a3024ccd4a9af5109d24e6c57565d74a1">_POSIX_C_SOURCE</a>&#160;&#160;&#160;200809L</td></tr>
<tr class="separator:a3024ccd4a9af5109d24e6c57565d74a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="typedef-members" name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:af008d21b3f522095167d29cd9e06652b" id="r_af008d21b3f522095167d29cd9e06652b"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structgptoss__mapped__file__t.html">gptoss_mapped_file_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8c.html#af008d21b3f522095167d29cd9e06652b">gptoss_mapped_file_t</a></td></tr>
<tr class="separator:af008d21b3f522095167d29cd9e06652b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:add8363effbaa37fcdc8b72a4d9a858af" id="r_add8363effbaa37fcdc8b72a4d9a858af"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8c.html#add8363effbaa37fcdc8b72a4d9a858af">widx_trace_enabled</a> (const <a class="el" href="structgptoss__weights__index__t.html">gptoss_weights_index_t</a> *idx)</td></tr>
<tr class="separator:add8363effbaa37fcdc8b72a4d9a858af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a724e4be15ba1676eb3369599e99eccc6" id="r_a724e4be15ba1676eb3369599e99eccc6"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8c.html#a724e4be15ba1676eb3369599e99eccc6">widx_tracef</a> (const <a class="el" href="structgptoss__weights__index__t.html">gptoss_weights_index_t</a> *idx, const char *fmt,...)</td></tr>
<tr class="separator:a724e4be15ba1676eb3369599e99eccc6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4cecf742f93bcd606826e7418359123b" id="r_a4cecf742f93bcd606826e7418359123b"><td class="memItemLeft" align="right" valign="top">static char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8c.html#a4cecf742f93bcd606826e7418359123b">widx_strdup</a> (const char *s)</td></tr>
<tr class="separator:a4cecf742f93bcd606826e7418359123b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a56b6936dd1f3d8668251a331151a96" id="r_a4a56b6936dd1f3d8668251a331151a96"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8c.html#a4a56b6936dd1f3d8668251a331151a96">widx_path_join</a> (char *dst, size_t dst_n, const char *model_dir, const char *leaf)</td></tr>
<tr class="separator:a4a56b6936dd1f3d8668251a331151a96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a38ec37dc422b167e975773834349ec96" id="r_a38ec37dc422b167e975773834349ec96"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8c.html#a38ec37dc422b167e975773834349ec96">widx_mapped_close</a> (<a class="el" href="structgptoss__mapped__file__t.html">gptoss_mapped_file_t</a> *mf)</td></tr>
<tr class="separator:a38ec37dc422b167e975773834349ec96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5db73cd3715cba3c5bae4378335cf0d5" id="r_a5db73cd3715cba3c5bae4378335cf0d5"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8c.html#a5db73cd3715cba3c5bae4378335cf0d5">widx_read_all</a> (const char *path, void **out_base, size_t *out_size)</td></tr>
<tr class="separator:a5db73cd3715cba3c5bae4378335cf0d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae6ffa18bb461a4aff5f94b8b20f71c93" id="r_ae6ffa18bb461a4aff5f94b8b20f71c93"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8c.html#ae6ffa18bb461a4aff5f94b8b20f71c93">widx_mapped_open</a> (<a class="el" href="structgptoss__mapped__file__t.html">gptoss_mapped_file_t</a> *mf, const char *path)</td></tr>
<tr class="separator:ae6ffa18bb461a4aff5f94b8b20f71c93"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a35d07ed424f1010db24d2b69d7ee7bd6" id="r_a35d07ed424f1010db24d2b69d7ee7bd6"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8c.html#a35d07ed424f1010db24d2b69d7ee7bd6">widx_tensor_reset</a> (<a class="el" href="structgptoss__tensor__t.html">gptoss_tensor_t</a> *t)</td></tr>
<tr class="separator:a35d07ed424f1010db24d2b69d7ee7bd6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a51589195af626cbd25188a2f1d138f24" id="r_a51589195af626cbd25188a2f1d138f24"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8c.html#a51589195af626cbd25188a2f1d138f24">widx_tensor_from_desc</a> (const <a class="el" href="structgptoss__weights__index__t.html">gptoss_weights_index_t</a> *idx, const <a class="el" href="tensor__map_8h.html#a1ed0f6ce08b1582103651d4fd14a30f1">tensor_desc_t</a> *desc, <a class="el" href="structgptoss__tensor__t.html">gptoss_tensor_t</a> *out)</td></tr>
<tr class="separator:a51589195af626cbd25188a2f1d138f24"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adc8f01ad4eb156e2f380f2b39e51d0ae" id="r_adc8f01ad4eb156e2f380f2b39e51d0ae"><td class="memItemLeft" align="right" valign="top">static const <a class="el" href="tensor__map_8h.html#a1ed0f6ce08b1582103651d4fd14a30f1">tensor_desc_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8c.html#adc8f01ad4eb156e2f380f2b39e51d0ae">widx_find_any</a> (const <a class="el" href="structgptoss__weights__index__t.html">gptoss_weights_index_t</a> *idx, const <a class="el" href="tensor__map_8h.html#a0ae1dced25c800bf85537db1ce9776a7">tensor_map_t</a> *map, const char *const *names, size_t n)</td></tr>
<tr class="separator:adc8f01ad4eb156e2f380f2b39e51d0ae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0c207c648c00b914718b2dd50416829e" id="r_a0c207c648c00b914718b2dd50416829e"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8c.html#a0c207c648c00b914718b2dd50416829e">widx_fmt_layer</a> (char *dst, size_t dst_n, const char *fmt, uint32_t layer)</td></tr>
<tr class="separator:a0c207c648c00b914718b2dd50416829e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99c6f5457ca59a820436c4b8e8e9fb8b" id="r_a99c6f5457ca59a820436c4b8e8e9fb8b"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8c.html#a99c6f5457ca59a820436c4b8e8e9fb8b">widx_resolve_required</a> (const <a class="el" href="structgptoss__weights__index__t.html">gptoss_weights_index_t</a> *idx, const char *const *names, size_t n, <a class="el" href="structgptoss__tensor__t.html">gptoss_tensor_t</a> *out)</td></tr>
<tr class="separator:a99c6f5457ca59a820436c4b8e8e9fb8b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac8e226ed24bc76176a1fec86157bac99" id="r_ac8e226ed24bc76176a1fec86157bac99"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8c.html#ac8e226ed24bc76176a1fec86157bac99">widx_resolve_optional</a> (const <a class="el" href="structgptoss__weights__index__t.html">gptoss_weights_index_t</a> *idx, const char *const *names, size_t n, <a class="el" href="structgptoss__tensor__t.html">gptoss_tensor_t</a> *out)</td></tr>
<tr class="separator:ac8e226ed24bc76176a1fec86157bac99"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af45e8235976c0b4aa7cd57357c74e449" id="r_af45e8235976c0b4aa7cd57357c74e449"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8c.html#af45e8235976c0b4aa7cd57357c74e449">gptoss_tensor_is_valid</a> (const <a class="el" href="structgptoss__tensor__t.html">gptoss_tensor_t</a> *t)</td></tr>
<tr class="memdesc:af45e8235976c0b4aa7cd57357c74e449"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check whether a tensor handle is populated.  <br /></td></tr>
<tr class="separator:af45e8235976c0b4aa7cd57357c74e449"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95ad38a811c68d493a4103e19875720f" id="r_a95ad38a811c68d493a4103e19875720f"><td class="memItemLeft" align="right" valign="top">const uint8_t *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8c.html#a95ad38a811c68d493a4103e19875720f">gptoss_tensor_bytes</a> (const <a class="el" href="structgptoss__tensor__t.html">gptoss_tensor_t</a> *t)</td></tr>
<tr class="memdesc:a95ad38a811c68d493a4103e19875720f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return a direct pointer to tensor bytes if available.  <br /></td></tr>
<tr class="separator:a95ad38a811c68d493a4103e19875720f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad72abbe402df6e08a0fc9fa8bf0f7d64" id="r_ad72abbe402df6e08a0fc9fa8bf0f7d64"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8c.html#ad72abbe402df6e08a0fc9fa8bf0f7d64">gptoss_tensor_materialize</a> (const <a class="el" href="structgptoss__tensor__t.html">gptoss_tensor_t</a> *t, void *dst, size_t dst_nbytes)</td></tr>
<tr class="memdesc:ad72abbe402df6e08a0fc9fa8bf0f7d64"><td class="mdescLeft">&#160;</td><td class="mdescRight">Materialize tensor bytes into a caller-provided buffer.  <br /></td></tr>
<tr class="separator:ad72abbe402df6e08a0fc9fa8bf0f7d64"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab0abbe94d2373ea44d51f2325c7cc46c" id="r_ab0abbe94d2373ea44d51f2325c7cc46c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8c.html#ab0abbe94d2373ea44d51f2325c7cc46c">gptoss_weights_index_open</a> (<a class="el" href="structgptoss__weights__index__t.html">gptoss_weights_index_t</a> *out, const char *model_dir, const <a class="el" href="ie__io_8h.html#af68ad3cdc2eb244fe4feed94372d7806">ie_weights_t</a> *weights)</td></tr>
<tr class="memdesc:ab0abbe94d2373ea44d51f2325c7cc46c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Open a weights index for a given model directory and weights descriptor.  <br /></td></tr>
<tr class="separator:ab0abbe94d2373ea44d51f2325c7cc46c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a943d5a8178000a52f6148bdbccda2252" id="r_a943d5a8178000a52f6148bdbccda2252"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8c.html#a943d5a8178000a52f6148bdbccda2252">gptoss_weights_index_close</a> (<a class="el" href="structgptoss__weights__index__t.html">gptoss_weights_index_t</a> *idx)</td></tr>
<tr class="memdesc:a943d5a8178000a52f6148bdbccda2252"><td class="mdescLeft">&#160;</td><td class="mdescRight">Close an index and free all owned resources.  <br /></td></tr>
<tr class="separator:a943d5a8178000a52f6148bdbccda2252"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1d0c65a6e45fb8bdf4ef6e703fbe20b5" id="r_a1d0c65a6e45fb8bdf4ef6e703fbe20b5"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8c.html#a1d0c65a6e45fb8bdf4ef6e703fbe20b5">widx_detect_arch</a> (const <a class="el" href="structgptoss__weights__index__t.html">gptoss_weights_index_t</a> *idx, <a class="el" href="gptoss__weights__index_8h.html#a5ba3978bcdac9a88ae300e42940692bd">gptoss_arch_kind_t</a> *out_arch, int *out_fused_qkv, int *out_swiglu)</td></tr>
<tr class="separator:a1d0c65a6e45fb8bdf4ef6e703fbe20b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59ea306bea1c9226c31583a49f2e7ffd" id="r_a59ea306bea1c9226c31583a49f2e7ffd"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8c.html#a59ea306bea1c9226c31583a49f2e7ffd">widx_resolve_layer_llama</a> (const <a class="el" href="structgptoss__weights__index__t.html">gptoss_weights_index_t</a> *idx, uint32_t layer, int fused_qkv, int swiglu, <a class="el" href="structgptoss__layer__weights__t.html">gptoss_layer_weights_t</a> *out)</td></tr>
<tr class="separator:a59ea306bea1c9226c31583a49f2e7ffd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaa150e690297afaababde6bd8bcb7ae7" id="r_aaa150e690297afaababde6bd8bcb7ae7"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8c.html#aaa150e690297afaababde6bd8bcb7ae7">widx_resolve_layer_neox</a> (const <a class="el" href="structgptoss__weights__index__t.html">gptoss_weights_index_t</a> *idx, uint32_t layer, <a class="el" href="structgptoss__layer__weights__t.html">gptoss_layer_weights_t</a> *out)</td></tr>
<tr class="separator:aaa150e690297afaababde6bd8bcb7ae7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a121bde9c9fb693a485dd9bc9459a124f" id="r_a121bde9c9fb693a485dd9bc9459a124f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8c.html#a121bde9c9fb693a485dd9bc9459a124f">gptoss_weights_index_build_model</a> (const <a class="el" href="structgptoss__weights__index__t.html">gptoss_weights_index_t</a> *idx, const <a class="el" href="ie__infer_8h.html#a03b52084d74cc0c81a96a02ae842fcc7">ie_gptoss_hparams_t</a> *hp, <a class="el" href="structgptoss__model__weights__t.html">gptoss_model_weights_t</a> *out)</td></tr>
<tr class="memdesc:a121bde9c9fb693a485dd9bc9459a124f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Resolve and validate all tensors required by the GPT-OSS forward pass.  <br /></td></tr>
<tr class="separator:a121bde9c9fb693a485dd9bc9459a124f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d2ef0237f98560c09bff44c015e3b81" id="r_a8d2ef0237f98560c09bff44c015e3b81"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="gptoss__weights__index_8c.html#a8d2ef0237f98560c09bff44c015e3b81">gptoss_model_weights_free</a> (<a class="el" href="structgptoss__model__weights__t.html">gptoss_model_weights_t</a> *mw)</td></tr>
<tr class="memdesc:a8d2ef0237f98560c09bff44c015e3b81"><td class="mdescLeft">&#160;</td><td class="mdescRight">Free the per-layer array allocated by <a class="el" href="gptoss__weights__index_8h.html#a121bde9c9fb693a485dd9bc9459a124f" title="Resolve and validate all tensors required by the GPT-OSS forward pass.">gptoss_weights_index_build_model</a>.  <br /></td></tr>
<tr class="separator:a8d2ef0237f98560c09bff44c015e3b81"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>GPT-OSS weight indexing, name probing, and tensor resolution. </p>
<p>This module bridges the IO layer (tensor_map.json + model.ie.bin + optional dedup artifacts) with the runtime forward pass. It provides:</p><ul>
<li>A stable way to resolve model tensors by probing multiple naming schemes.</li>
<li>A unified tensor handle that supports direct pointers and dedup views.</li>
<li>Optional verbose tracing controlled by the IE_TRACE_LOOKUPS environment variable.</li>
</ul>
<p>Tracing:</p><ul>
<li>Set IE_TRACE_LOOKUPS=1 to print candidate lookups and failures to stderr.</li>
</ul>
<p>Performance constraints:</p><ul>
<li>No per-token allocations.</li>
<li>No file IO after initialization (open/build_model). </li>
</ul>

<p class="definition">Definition in file <a class="el" href="gptoss__weights__index_8c_source.html">gptoss_weights_index.c</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a3024ccd4a9af5109d24e6c57565d74a1" name="a3024ccd4a9af5109d24e6c57565d74a1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3024ccd4a9af5109d24e6c57565d74a1">&#9670;&#160;</a></span>_POSIX_C_SOURCE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _POSIX_C_SOURCE&#160;&#160;&#160;200809L</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="gptoss__weights__index_8c_source.html#l00025">25</a> of file <a class="el" href="gptoss__weights__index_8c_source.html">gptoss_weights_index.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="af008d21b3f522095167d29cd9e06652b" name="af008d21b3f522095167d29cd9e06652b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af008d21b3f522095167d29cd9e06652b">&#9670;&#160;</a></span>gptoss_mapped_file_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structgptoss__mapped__file__t.html">gptoss_mapped_file_t</a> <a class="el" href="structgptoss__mapped__file__t.html">gptoss_mapped_file_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a8d2ef0237f98560c09bff44c015e3b81" name="a8d2ef0237f98560c09bff44c015e3b81"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8d2ef0237f98560c09bff44c015e3b81">&#9670;&#160;</a></span>gptoss_model_weights_free()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void gptoss_model_weights_free </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structgptoss__model__weights__t.html">gptoss_model_weights_t</a> *&#160;</td>
          <td class="paramname"><em>mw</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Free the per-layer array allocated by <a class="el" href="gptoss__weights__index_8h.html#a121bde9c9fb693a485dd9bc9459a124f" title="Resolve and validate all tensors required by the GPT-OSS forward pass.">gptoss_weights_index_build_model</a>. </p>
<p>This does not close the underlying <a class="el" href="structgptoss__weights__index__t.html" title="Loaded tensor_map + mapped weights binary + optional dedup loader handle.">gptoss_weights_index_t</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">mw</td><td>Model weights. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="gptoss__weights__index_8c_source.html#l00954">954</a> of file <a class="el" href="gptoss__weights__index_8c_source.html">gptoss_weights_index.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  954</span>                                                           {</div>
<div class="line"><span class="lineno">  955</span>  <span class="keywordflow">if</span> (!mw) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  956</span>  free(mw-&gt;<a class="code hl_variable" href="structgptoss__model__weights__t.html#a92dc55178f42d7a22a5a6db56e2d1b58">layers</a>);</div>
<div class="line"><span class="lineno">  957</span>  memset(mw, 0, <span class="keyword">sizeof</span>(*mw));</div>
<div class="line"><span class="lineno">  958</span>}</div>
<div class="ttc" id="astructgptoss__model__weights__t_html_a92dc55178f42d7a22a5a6db56e2d1b58"><div class="ttname"><a href="structgptoss__model__weights__t.html#a92dc55178f42d7a22a5a6db56e2d1b58">gptoss_model_weights_t::layers</a></div><div class="ttdeci">gptoss_layer_weights_t * layers</div><div class="ttdoc">Layer array (length = hp-&gt;n_layers).</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8h_source.html#l00156">gptoss_weights_index.h:156</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="gptoss__weights__index_8h_source.html#l00156">gptoss_model_weights_t::layers</a>.</p>

<p class="reference">Referenced by <a class="el" href="gptoss__weights__index_8c_source.html#l00860">gptoss_weights_index_build_model()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8c_a8d2ef0237f98560c09bff44c015e3b81_icgraph.svg" width="430" height="51"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a95ad38a811c68d493a4103e19875720f" name="a95ad38a811c68d493a4103e19875720f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a95ad38a811c68d493a4103e19875720f">&#9670;&#160;</a></span>gptoss_tensor_bytes()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const uint8_t * gptoss_tensor_bytes </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structgptoss__tensor__t.html">gptoss_tensor_t</a> *&#160;</td>
          <td class="paramname"><em>t</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return a direct pointer to tensor bytes if available. </p>
<p>For IE_WVIEW_DEDUP tensors, this returns NULL; callers must use <a class="el" href="gptoss__weights__index_8h.html#ad72abbe402df6e08a0fc9fa8bf0f7d64" title="Materialize tensor bytes into a caller-provided buffer.">gptoss_tensor_materialize</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">t</td><td>Tensor handle. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Pointer to bytes, or NULL if materialization is required. </dd></dl>

<p class="definition">Definition at line <a class="el" href="gptoss__weights__index_8c_source.html#l00394">394</a> of file <a class="el" href="gptoss__weights__index_8c_source.html">gptoss_weights_index.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  394</span>                                                             {</div>
<div class="line"><span class="lineno">  395</span>  <span class="keywordflow">if</span> (!t) <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  396</span>  <span class="keywordflow">return</span> t-&gt;<a class="code hl_variable" href="structgptoss__tensor__t.html#ad0c9cdc4c1e57f961c191910d058aa35">direct</a>;</div>
<div class="line"><span class="lineno">  397</span>}</div>
<div class="ttc" id="astructgptoss__tensor__t_html_ad0c9cdc4c1e57f961c191910d058aa35"><div class="ttname"><a href="structgptoss__tensor__t.html#ad0c9cdc4c1e57f961c191910d058aa35">gptoss_tensor_t::direct</a></div><div class="ttdeci">const uint8_t * direct</div><div class="ttdoc">Direct pointer to bytes when available:</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8h_source.html#l00096">gptoss_weights_index.h:96</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="gptoss__weights__index_8h_source.html#l00096">gptoss_tensor_t::direct</a>.</p>

</div>
</div>
<a id="af45e8235976c0b4aa7cd57357c74e449" name="af45e8235976c0b4aa7cd57357c74e449"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af45e8235976c0b4aa7cd57357c74e449">&#9670;&#160;</a></span>gptoss_tensor_is_valid()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int gptoss_tensor_is_valid </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structgptoss__tensor__t.html">gptoss_tensor_t</a> *&#160;</td>
          <td class="paramname"><em>t</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check whether a tensor handle is populated. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">t</td><td>Tensor handle. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Non-zero if populated, 0 otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="gptoss__weights__index_8c_source.html#l00390">390</a> of file <a class="el" href="gptoss__weights__index_8c_source.html">gptoss_weights_index.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  390</span>                                                     {</div>
<div class="line"><span class="lineno">  391</span>  <span class="keywordflow">return</span> (t &amp;&amp; t-&gt;<a class="code hl_variable" href="structgptoss__tensor__t.html#afdce873cb214bb06c6603c4ab84771ea">desc</a> != NULL);</div>
<div class="line"><span class="lineno">  392</span>}</div>
<div class="ttc" id="astructgptoss__tensor__t_html_afdce873cb214bb06c6603c4ab84771ea"><div class="ttname"><a href="structgptoss__tensor__t.html#afdce873cb214bb06c6603c4ab84771ea">gptoss_tensor_t::desc</a></div><div class="ttdeci">const tensor_desc_t * desc</div><div class="ttdoc">Tensor descriptor from tensor_map.json (shape/dtype/size/offset).</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8h_source.html#l00082">gptoss_weights_index.h:82</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="gptoss__weights__index_8h_source.html#l00082">gptoss_tensor_t::desc</a>.</p>

</div>
</div>
<a id="ad72abbe402df6e08a0fc9fa8bf0f7d64" name="ad72abbe402df6e08a0fc9fa8bf0f7d64"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad72abbe402df6e08a0fc9fa8bf0f7d64">&#9670;&#160;</a></span>gptoss_tensor_materialize()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t gptoss_tensor_materialize </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structgptoss__tensor__t.html">gptoss_tensor_t</a> *&#160;</td>
          <td class="paramname"><em>t</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>dst_nbytes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Materialize tensor bytes into a caller-provided buffer. </p>
<ul>
<li>For non-dedup tensors, this copies from the mapped <code>model.ie.bin</code>.</li>
<li>For IE_WVIEW_DIRECT, this copies from <code>view.data</code>.</li>
<li>For IE_WVIEW_DEDUP, this reconstructs bytes via <a class="el" href="weights__dedup_8h.html#a82069e1a7a2e1c0eaaebdd566ab44abe" title="Materialize a view into a contiguous destination buffer.">ie_weights_dedup_materialize</a>.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">t</td><td>Tensor handle. </td></tr>
    <tr><td class="paramname">dst</td><td>Destination buffer. </td></tr>
    <tr><td class="paramname">dst_nbytes</td><td>Capacity of destination buffer. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Number of bytes written (0 on failure). </dd></dl>

<p class="definition">Definition at line <a class="el" href="gptoss__weights__index_8c_source.html#l00399">399</a> of file <a class="el" href="gptoss__weights__index_8c_source.html">gptoss_weights_index.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  399</span>                                                                                         {</div>
<div class="line"><span class="lineno">  400</span>  <span class="keywordflow">if</span> (!t || !t-&gt;<a class="code hl_variable" href="structgptoss__tensor__t.html#afdce873cb214bb06c6603c4ab84771ea">desc</a> || !dst || dst_nbytes == 0) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  401</span>  <span class="keywordflow">if</span> (t-&gt;<a class="code hl_variable" href="structgptoss__tensor__t.html#ad0c9cdc4c1e57f961c191910d058aa35">direct</a>) {</div>
<div class="line"><span class="lineno">  402</span>    <span class="keywordtype">size_t</span> n = t-&gt;<a class="code hl_variable" href="structgptoss__tensor__t.html#a1c259985f27e4775ef5983ffffcaf0a0">nbytes</a>;</div>
<div class="line"><span class="lineno">  403</span>    <span class="keywordflow">if</span> (n &gt; dst_nbytes) <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  404</span>    memcpy(dst, t-&gt;<a class="code hl_variable" href="structgptoss__tensor__t.html#ad0c9cdc4c1e57f961c191910d058aa35">direct</a>, n);</div>
<div class="line"><span class="lineno">  405</span>    <span class="keywordflow">return</span> n;</div>
<div class="line"><span class="lineno">  406</span>  }</div>
<div class="line"><span class="lineno">  407</span>  <span class="keywordflow">if</span> (t-&gt;<a class="code hl_variable" href="structgptoss__tensor__t.html#add37a18cbc25e8f1ba05c82e6a7a67cf">is_dedup</a>) {</div>
<div class="line"><span class="lineno">  408</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="weights__dedup_8h.html#a82069e1a7a2e1c0eaaebdd566ab44abe">ie_weights_dedup_materialize</a>(&amp;t-&gt;<a class="code hl_variable" href="structgptoss__tensor__t.html#a446f9086c133c923e46137346669d8ee">view</a>, dst, dst_nbytes);</div>
<div class="line"><span class="lineno">  409</span>  }</div>
<div class="line"><span class="lineno">  410</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  411</span>}</div>
<div class="ttc" id="astructgptoss__tensor__t_html_a1c259985f27e4775ef5983ffffcaf0a0"><div class="ttname"><a href="structgptoss__tensor__t.html#a1c259985f27e4775ef5983ffffcaf0a0">gptoss_tensor_t::nbytes</a></div><div class="ttdeci">size_t nbytes</div><div class="ttdoc">Byte size of the logical tensor payload.</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8h_source.html#l00099">gptoss_weights_index.h:99</a></div></div>
<div class="ttc" id="astructgptoss__tensor__t_html_a446f9086c133c923e46137346669d8ee"><div class="ttname"><a href="structgptoss__tensor__t.html#a446f9086c133c923e46137346669d8ee">gptoss_tensor_t::view</a></div><div class="ttdeci">ie_weight_view_t view</div><div class="ttdoc">Valid when is_dedup != 0.</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8h_source.html#l00088">gptoss_weights_index.h:88</a></div></div>
<div class="ttc" id="astructgptoss__tensor__t_html_add37a18cbc25e8f1ba05c82e6a7a67cf"><div class="ttname"><a href="structgptoss__tensor__t.html#add37a18cbc25e8f1ba05c82e6a7a67cf">gptoss_tensor_t::is_dedup</a></div><div class="ttdeci">int is_dedup</div><div class="ttdoc">Non-zero if this tensor must be accessed through the dedup loader.</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8h_source.html#l00085">gptoss_weights_index.h:85</a></div></div>
<div class="ttc" id="aweights__dedup_8h_html_a82069e1a7a2e1c0eaaebdd566ab44abe"><div class="ttname"><a href="weights__dedup_8h.html#a82069e1a7a2e1c0eaaebdd566ab44abe">ie_weights_dedup_materialize</a></div><div class="ttdeci">size_t ie_weights_dedup_materialize(const ie_weight_view_t *view, void *dst, size_t dst_nbytes)</div><div class="ttdoc">Materialize a view into a contiguous destination buffer.</div><div class="ttdef"><b>Definition</b> <a href="weights__dedup_8c_source.html#l01336">weights_dedup.c:1336</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="gptoss__weights__index_8h_source.html#l00082">gptoss_tensor_t::desc</a>, <a class="el" href="gptoss__weights__index_8h_source.html#l00096">gptoss_tensor_t::direct</a>, <a class="el" href="weights__dedup_8c_source.html#l01336">ie_weights_dedup_materialize()</a>, <a class="el" href="gptoss__weights__index_8h_source.html#l00085">gptoss_tensor_t::is_dedup</a>, <a class="el" href="gptoss__weights__index_8h_source.html#l00099">gptoss_tensor_t::nbytes</a>, and <a class="el" href="gptoss__weights__index_8h_source.html#l00088">gptoss_tensor_t::view</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8c_ad72abbe402df6e08a0fc9fa8bf0f7d64_cgraph.svg" width="663" height="135"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a121bde9c9fb693a485dd9bc9459a124f" name="a121bde9c9fb693a485dd9bc9459a124f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a121bde9c9fb693a485dd9bc9459a124f">&#9670;&#160;</a></span>gptoss_weights_index_build_model()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int gptoss_weights_index_build_model </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structgptoss__weights__index__t.html">gptoss_weights_index_t</a> *&#160;</td>
          <td class="paramname"><em>idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ie__infer_8h.html#a03b52084d74cc0c81a96a02ae842fcc7">ie_gptoss_hparams_t</a> *&#160;</td>
          <td class="paramname"><em>hp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structgptoss__model__weights__t.html">gptoss_model_weights_t</a> *&#160;</td>
          <td class="paramname"><em>out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Resolve and validate all tensors required by the GPT-OSS forward pass. </p>
<p>This performs name-resolution for a known set of tensors (embedding, norms, per-layer projections, and LM head). It allocates <code>out-&gt;layers</code> and fills every <a class="el" href="structgptoss__tensor__t.html" title="A resolved tensor handle.">gptoss_tensor_t</a> with a descriptor and a pointer/view.</p>
<p>Missing optional tensors (e.g., pos_embed, lm_head when tied) are left empty (desc == NULL). Missing required tensors produce an error.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">idx</td><td>Opened weights index. </td></tr>
    <tr><td class="paramname">hp</td><td>Hyperparameters (used for layer count). </td></tr>
    <tr><td class="paramname">out</td><td>Output model weights index (written on success). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>IE_IO_OK on success, negative <a class="el" href="ie__io_8h.html#aabad0c7dd1649d6261de555346eb68d5">ie_io_status_t</a> on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="gptoss__weights__index_8c_source.html#l00860">860</a> of file <a class="el" href="gptoss__weights__index_8c_source.html">gptoss_weights_index.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  862</span>                                                                 {</div>
<div class="line"><span class="lineno">  863</span>  <span class="keywordflow">if</span> (!idx || !hp || !out) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239">IE_IO_ERR_ARGS</a>;</div>
<div class="line"><span class="lineno">  864</span> </div>
<div class="line"><span class="lineno">  865</span>  memset(out, 0, <span class="keyword">sizeof</span>(*out));</div>
<div class="line"><span class="lineno">  866</span> </div>
<div class="line"><span class="lineno">  867</span>  <a class="code hl_enumeration" href="gptoss__weights__index_8h.html#a5ba3978bcdac9a88ae300e42940692bd">gptoss_arch_kind_t</a> arch;</div>
<div class="line"><span class="lineno">  868</span>  <span class="keywordtype">int</span> fused_qkv = 0;</div>
<div class="line"><span class="lineno">  869</span>  <span class="keywordtype">int</span> swiglu = 0;</div>
<div class="line"><span class="lineno">  870</span> </div>
<div class="line"><span class="lineno">  871</span>  {</div>
<div class="line"><span class="lineno">  872</span>    <span class="keywordtype">int</span> rc = <a class="code hl_function" href="gptoss__weights__index_8c.html#a1d0c65a6e45fb8bdf4ef6e703fbe20b5">widx_detect_arch</a>(idx, &amp;arch, &amp;fused_qkv, &amp;swiglu);</div>
<div class="line"><span class="lineno">  873</span>    <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>) <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  874</span>  }</div>
<div class="line"><span class="lineno">  875</span> </div>
<div class="line"><span class="lineno">  876</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;arch = arch;</div>
<div class="line"><span class="lineno">  877</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;attn_fused_qkv = fused_qkv;</div>
<div class="line"><span class="lineno">  878</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;mlp_swiglu = swiglu;</div>
<div class="line"><span class="lineno">  879</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;n_layers = hp-&gt;<a class="code hl_variable" href="structie__gptoss__hparams.html#a9f7592ff0ef97a90e4bf510d7323c1e2">n_layers</a>;</div>
<div class="line"><span class="lineno">  880</span> </div>
<div class="line"><span class="lineno">  881</span>  {</div>
<div class="line"><span class="lineno">  882</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *embed_names[] = {</div>
<div class="line"><span class="lineno">  883</span>      <span class="stringliteral">&quot;model.embed_tokens.weight&quot;</span>,</div>
<div class="line"><span class="lineno">  884</span>      <span class="stringliteral">&quot;tok_embeddings.weight&quot;</span>,</div>
<div class="line"><span class="lineno">  885</span>      <span class="stringliteral">&quot;model.tok_embeddings.weight&quot;</span>,</div>
<div class="line"><span class="lineno">  886</span>      <span class="stringliteral">&quot;transformer.wte.weight&quot;</span>,</div>
<div class="line"><span class="lineno">  887</span>      <span class="stringliteral">&quot;gpt_neox.embed_in.weight&quot;</span></div>
<div class="line"><span class="lineno">  888</span>    };</div>
<div class="line"><span class="lineno">  889</span>    <span class="keywordtype">int</span> rc = <a class="code hl_function" href="gptoss__weights__index_8c.html#a99c6f5457ca59a820436c4b8e8e9fb8b">widx_resolve_required</a>(idx, embed_names, <span class="keyword">sizeof</span>(embed_names)/<span class="keyword">sizeof</span>(embed_names[0]), &amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;tok_embed_w);</div>
<div class="line"><span class="lineno">  890</span>    <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>) <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  891</span>  }</div>
<div class="line"><span class="lineno">  892</span> </div>
<div class="line"><span class="lineno">  893</span>  {</div>
<div class="line"><span class="lineno">  894</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *pos_names[] = {</div>
<div class="line"><span class="lineno">  895</span>      <span class="stringliteral">&quot;model.embed_positions.weight&quot;</span>,</div>
<div class="line"><span class="lineno">  896</span>      <span class="stringliteral">&quot;transformer.wpe.weight&quot;</span>,</div>
<div class="line"><span class="lineno">  897</span>      <span class="stringliteral">&quot;gpt_neox.embed_positions.weight&quot;</span></div>
<div class="line"><span class="lineno">  898</span>    };</div>
<div class="line"><span class="lineno">  899</span>    <span class="keywordtype">int</span> rc = <a class="code hl_function" href="gptoss__weights__index_8c.html#ac8e226ed24bc76176a1fec86157bac99">widx_resolve_optional</a>(idx, pos_names, <span class="keyword">sizeof</span>(pos_names)/<span class="keyword">sizeof</span>(pos_names[0]), &amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;pos_embed_w);</div>
<div class="line"><span class="lineno">  900</span>    <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>) <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  901</span>  }</div>
<div class="line"><span class="lineno">  902</span> </div>
<div class="line"><span class="lineno">  903</span>  {</div>
<div class="line"><span class="lineno">  904</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *norm_names[] = {</div>
<div class="line"><span class="lineno">  905</span>      <span class="stringliteral">&quot;model.norm.weight&quot;</span>,</div>
<div class="line"><span class="lineno">  906</span>      <span class="stringliteral">&quot;transformer.norm.weight&quot;</span>,</div>
<div class="line"><span class="lineno">  907</span>      <span class="stringliteral">&quot;gpt_neox.final_layer_norm.weight&quot;</span>,</div>
<div class="line"><span class="lineno">  908</span>      <span class="stringliteral">&quot;final_layer_norm.weight&quot;</span></div>
<div class="line"><span class="lineno">  909</span>    };</div>
<div class="line"><span class="lineno">  910</span>    <span class="keywordtype">int</span> rc = <a class="code hl_function" href="gptoss__weights__index_8c.html#a99c6f5457ca59a820436c4b8e8e9fb8b">widx_resolve_required</a>(idx, norm_names, <span class="keyword">sizeof</span>(norm_names)/<span class="keyword">sizeof</span>(norm_names[0]), &amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;final_norm_w);</div>
<div class="line"><span class="lineno">  911</span>    <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>) <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  912</span>  }</div>
<div class="line"><span class="lineno">  913</span> </div>
<div class="line"><span class="lineno">  914</span>  {</div>
<div class="line"><span class="lineno">  915</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *lm_head_names[] = {</div>
<div class="line"><span class="lineno">  916</span>      <span class="stringliteral">&quot;lm_head.weight&quot;</span>,</div>
<div class="line"><span class="lineno">  917</span>      <span class="stringliteral">&quot;model.lm_head.weight&quot;</span>,</div>
<div class="line"><span class="lineno">  918</span>      <span class="stringliteral">&quot;transformer.lm_head.weight&quot;</span>,</div>
<div class="line"><span class="lineno">  919</span>      <span class="stringliteral">&quot;embed_out.weight&quot;</span>,</div>
<div class="line"><span class="lineno">  920</span>      <span class="stringliteral">&quot;gpt_neox.embed_out.weight&quot;</span></div>
<div class="line"><span class="lineno">  921</span>    };</div>
<div class="line"><span class="lineno">  922</span>    <span class="keywordtype">int</span> rc = <a class="code hl_function" href="gptoss__weights__index_8c.html#ac8e226ed24bc76176a1fec86157bac99">widx_resolve_optional</a>(idx, lm_head_names, <span class="keyword">sizeof</span>(lm_head_names)/<span class="keyword">sizeof</span>(lm_head_names[0]), &amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;lm_head_w);</div>
<div class="line"><span class="lineno">  923</span>    <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>) <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  924</span> </div>
<div class="line"><span class="lineno">  925</span>    <span class="keywordflow">if</span> (!<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;lm_head_w.desc) {</div>
<div class="line"><span class="lineno">  926</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;lm_head_w = <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;tok_embed_w;</div>
<div class="line"><span class="lineno">  927</span>    }</div>
<div class="line"><span class="lineno">  928</span>  }</div>
<div class="line"><span class="lineno">  929</span> </div>
<div class="line"><span class="lineno">  930</span>  <span class="keywordflow">if</span> (hp-&gt;<a class="code hl_variable" href="structie__gptoss__hparams.html#a9f7592ff0ef97a90e4bf510d7323c1e2">n_layers</a> == 0) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239">IE_IO_ERR_ARGS</a>;</div>
<div class="line"><span class="lineno">  931</span> </div>
<div class="line"><span class="lineno">  932</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;layers = (<a class="code hl_struct" href="structgptoss__layer__weights__t.html">gptoss_layer_weights_t</a>*)calloc((<span class="keywordtype">size_t</span>)hp-&gt;<a class="code hl_variable" href="structie__gptoss__hparams.html#a9f7592ff0ef97a90e4bf510d7323c1e2">n_layers</a>, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="structgptoss__layer__weights__t.html">gptoss_layer_weights_t</a>));</div>
<div class="line"><span class="lineno">  933</span>  <span class="keywordflow">if</span> (!<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;layers) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a4effb7bf4fea909987b433ca4cf26380">IE_IO_ERR_OOM</a>;</div>
<div class="line"><span class="lineno">  934</span> </div>
<div class="line"><span class="lineno">  935</span>  <span class="keywordflow">for</span> (uint32_t l = 0; l &lt; hp-&gt;<a class="code hl_variable" href="structie__gptoss__hparams.html#a9f7592ff0ef97a90e4bf510d7323c1e2">n_layers</a>; ++l) {</div>
<div class="line"><span class="lineno">  936</span>    <span class="keywordtype">int</span> rc;</div>
<div class="line"><span class="lineno">  937</span>    <span class="keywordflow">if</span> (arch == <a class="code hl_enumvalue" href="gptoss__weights__index_8h.html#a5ba3978bcdac9a88ae300e42940692bdade1572936286502eb2604bbf70812e26">GPTOSS_ARCH_LLAMA</a>) {</div>
<div class="line"><span class="lineno">  938</span>      rc = <a class="code hl_function" href="gptoss__weights__index_8c.html#a59ea306bea1c9226c31583a49f2e7ffd">widx_resolve_layer_llama</a>(idx, l, fused_qkv, swiglu, &amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;layers[l]);</div>
<div class="line"><span class="lineno">  939</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (arch == <a class="code hl_enumvalue" href="gptoss__weights__index_8h.html#a5ba3978bcdac9a88ae300e42940692bdaca48309b567bec1419ac072f6057c724">GPTOSS_ARCH_GPTNEOX</a>) {</div>
<div class="line"><span class="lineno">  940</span>      rc = <a class="code hl_function" href="gptoss__weights__index_8c.html#aaa150e690297afaababde6bd8bcb7ae7">widx_resolve_layer_neox</a>(idx, l, &amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;layers[l]);</div>
<div class="line"><span class="lineno">  941</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  942</span>      rc = <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9">IE_IO_ERR_JSON</a>;</div>
<div class="line"><span class="lineno">  943</span>    }</div>
<div class="line"><span class="lineno">  944</span> </div>
<div class="line"><span class="lineno">  945</span>    <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>) {</div>
<div class="line"><span class="lineno">  946</span>      <a class="code hl_function" href="gptoss__weights__index_8c.html#a8d2ef0237f98560c09bff44c015e3b81">gptoss_model_weights_free</a>(out);</div>
<div class="line"><span class="lineno">  947</span>      <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  948</span>    }</div>
<div class="line"><span class="lineno">  949</span>  }</div>
<div class="line"><span class="lineno">  950</span> </div>
<div class="line"><span class="lineno">  951</span>  <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>;</div>
<div class="line"><span class="lineno">  952</span>}</div>
<div class="ttc" id="agptoss__weights__index_8c_html_a1d0c65a6e45fb8bdf4ef6e703fbe20b5"><div class="ttname"><a href="gptoss__weights__index_8c.html#a1d0c65a6e45fb8bdf4ef6e703fbe20b5">widx_detect_arch</a></div><div class="ttdeci">static int widx_detect_arch(const gptoss_weights_index_t *idx, gptoss_arch_kind_t *out_arch, int *out_fused_qkv, int *out_swiglu)</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00513">gptoss_weights_index.c:513</a></div></div>
<div class="ttc" id="agptoss__weights__index_8c_html_a59ea306bea1c9226c31583a49f2e7ffd"><div class="ttname"><a href="gptoss__weights__index_8c.html#a59ea306bea1c9226c31583a49f2e7ffd">widx_resolve_layer_llama</a></div><div class="ttdeci">static int widx_resolve_layer_llama(const gptoss_weights_index_t *idx, uint32_t layer, int fused_qkv, int swiglu, gptoss_layer_weights_t *out)</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00575">gptoss_weights_index.c:575</a></div></div>
<div class="ttc" id="agptoss__weights__index_8c_html_a8d2ef0237f98560c09bff44c015e3b81"><div class="ttname"><a href="gptoss__weights__index_8c.html#a8d2ef0237f98560c09bff44c015e3b81">gptoss_model_weights_free</a></div><div class="ttdeci">void gptoss_model_weights_free(gptoss_model_weights_t *mw)</div><div class="ttdoc">Free the per-layer array allocated by gptoss_weights_index_build_model.</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00954">gptoss_weights_index.c:954</a></div></div>
<div class="ttc" id="agptoss__weights__index_8c_html_a99c6f5457ca59a820436c4b8e8e9fb8b"><div class="ttname"><a href="gptoss__weights__index_8c.html#a99c6f5457ca59a820436c4b8e8e9fb8b">widx_resolve_required</a></div><div class="ttdeci">static int widx_resolve_required(const gptoss_weights_index_t *idx, const char *const *names, size_t n, gptoss_tensor_t *out)</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00359">gptoss_weights_index.c:359</a></div></div>
<div class="ttc" id="agptoss__weights__index_8c_html_aaa150e690297afaababde6bd8bcb7ae7"><div class="ttname"><a href="gptoss__weights__index_8c.html#aaa150e690297afaababde6bd8bcb7ae7">widx_resolve_layer_neox</a></div><div class="ttdeci">static int widx_resolve_layer_neox(const gptoss_weights_index_t *idx, uint32_t layer, gptoss_layer_weights_t *out)</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00794">gptoss_weights_index.c:794</a></div></div>
<div class="ttc" id="agptoss__weights__index_8c_html_ac8e226ed24bc76176a1fec86157bac99"><div class="ttname"><a href="gptoss__weights__index_8c.html#ac8e226ed24bc76176a1fec86157bac99">widx_resolve_optional</a></div><div class="ttdeci">static int widx_resolve_optional(const gptoss_weights_index_t *idx, const char *const *names, size_t n, gptoss_tensor_t *out)</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00374">gptoss_weights_index.c:374</a></div></div>
<div class="ttc" id="agptoss__weights__index_8h_html_a5ba3978bcdac9a88ae300e42940692bd"><div class="ttname"><a href="gptoss__weights__index_8h.html#a5ba3978bcdac9a88ae300e42940692bd">gptoss_arch_kind_t</a></div><div class="ttdeci">gptoss_arch_kind_t</div><div class="ttdoc">Logical weight naming scheme detected in tensor_map.json.</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8h_source.html#l00063">gptoss_weights_index.h:63</a></div></div>
<div class="ttc" id="agptoss__weights__index_8h_html_a5ba3978bcdac9a88ae300e42940692bdaca48309b567bec1419ac072f6057c724"><div class="ttname"><a href="gptoss__weights__index_8h.html#a5ba3978bcdac9a88ae300e42940692bdaca48309b567bec1419ac072f6057c724">GPTOSS_ARCH_GPTNEOX</a></div><div class="ttdeci">@ GPTOSS_ARCH_GPTNEOX</div><div class="ttdoc">GPT-NeoX-style: gpt_neox.layers.N.</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8h_source.html#l00067">gptoss_weights_index.h:66</a></div></div>
<div class="ttc" id="agptoss__weights__index_8h_html_a5ba3978bcdac9a88ae300e42940692bdade1572936286502eb2604bbf70812e26"><div class="ttname"><a href="gptoss__weights__index_8h.html#a5ba3978bcdac9a88ae300e42940692bdade1572936286502eb2604bbf70812e26">GPTOSS_ARCH_LLAMA</a></div><div class="ttdeci">@ GPTOSS_ARCH_LLAMA</div><div class="ttdoc">LLaMA-style: model.layers.N.</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8h_source.html#l00065">gptoss_weights_index.h:65</a></div></div>
<div class="ttc" id="aie__io_8h_html_a4c501870bd45dbe373416745a03de987a4effb7bf4fea909987b433ca4cf26380"><div class="ttname"><a href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a4effb7bf4fea909987b433ca4cf26380">IE_IO_ERR_OOM</a></div><div class="ttdeci">@ IE_IO_ERR_OOM</div><div class="ttdoc">Alias for older/newer code expecting OOM name.</div><div class="ttdef"><b>Definition</b> <a href="ie__io_8h_source.html#l00072">ie_io.h:72</a></div></div>
<div class="ttc" id="aie__io_8h_html_a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239"><div class="ttname"><a href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239">IE_IO_ERR_ARGS</a></div><div class="ttdeci">@ IE_IO_ERR_ARGS</div><div class="ttdoc">Invalid arguments.</div><div class="ttdef"><b>Definition</b> <a href="ie__io_8h_source.html#l00065">ie_io.h:65</a></div></div>
<div class="ttc" id="aie__io_8h_html_a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d"><div class="ttname"><a href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a></div><div class="ttdeci">@ IE_IO_OK</div><div class="ttdoc">Success.</div><div class="ttdef"><b>Definition</b> <a href="ie__io_8h_source.html#l00064">ie_io.h:64</a></div></div>
<div class="ttc" id="aie__io_8h_html_a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9"><div class="ttname"><a href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9">IE_IO_ERR_JSON</a></div><div class="ttdeci">@ IE_IO_ERR_JSON</div><div class="ttdoc">JSON parse failure or missing required fields.</div><div class="ttdef"><b>Definition</b> <a href="ie__io_8h_source.html#l00066">ie_io.h:66</a></div></div>
<div class="ttc" id="anamespaceconvert__dtypes__to__numeric_html_a0332296ea5bde95f8e72005df06144a8"><div class="ttname"><a href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">convert_dtypes_to_numeric.out</a></div><div class="ttdeci">dict out</div><div class="ttdef"><b>Definition</b> <a href="convert__dtypes__to__numeric_8py_source.html#l00029">convert_dtypes_to_numeric.py:29</a></div></div>
<div class="ttc" id="astructgptoss__layer__weights__t_html"><div class="ttname"><a href="structgptoss__layer__weights__t.html">gptoss_layer_weights_t</a></div><div class="ttdoc">Per-layer weight handles for a GPT-OSS transformer block.</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8h_source.html#l00106">gptoss_weights_index.h:106</a></div></div>
<div class="ttc" id="astructie__gptoss__hparams_html_a9f7592ff0ef97a90e4bf510d7323c1e2"><div class="ttname"><a href="structie__gptoss__hparams.html#a9f7592ff0ef97a90e4bf510d7323c1e2">ie_gptoss_hparams::n_layers</a></div><div class="ttdeci">uint32_t n_layers</div><div class="ttdoc">Number of transformer layers.</div><div class="ttdef"><b>Definition</b> <a href="ie__infer_8h_source.html#l00042">ie_infer.h:42</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="gptoss__weights__index_8h_source.html#l00066">GPTOSS_ARCH_GPTNEOX</a>, <a class="el" href="gptoss__weights__index_8h_source.html#l00065">GPTOSS_ARCH_LLAMA</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00954">gptoss_model_weights_free()</a>, <a class="el" href="ie__io_8h_source.html#l00065">IE_IO_ERR_ARGS</a>, <a class="el" href="ie__io_8h_source.html#l00066">IE_IO_ERR_JSON</a>, <a class="el" href="ie__io_8h_source.html#l00072">IE_IO_ERR_OOM</a>, <a class="el" href="ie__io_8h_source.html#l00064">IE_IO_OK</a>, <a class="el" href="ie__infer_8h_source.html#l00042">ie_gptoss_hparams::n_layers</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00513">widx_detect_arch()</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00575">widx_resolve_layer_llama()</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00794">widx_resolve_layer_neox()</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00374">widx_resolve_optional()</a>, and <a class="el" href="gptoss__weights__index_8c_source.html#l00359">widx_resolve_required()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8c_a121bde9c9fb693a485dd9bc9459a124f_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a943d5a8178000a52f6148bdbccda2252" name="a943d5a8178000a52f6148bdbccda2252"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a943d5a8178000a52f6148bdbccda2252">&#9670;&#160;</a></span>gptoss_weights_index_close()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void gptoss_weights_index_close </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structgptoss__weights__index__t.html">gptoss_weights_index_t</a> *&#160;</td>
          <td class="paramname"><em>idx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Close an index and free all owned resources. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">idx</td><td>Index handle (may be NULL). </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="gptoss__weights__index_8c_source.html#l00492">492</a> of file <a class="el" href="gptoss__weights__index_8c_source.html">gptoss_weights_index.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  492</span>                                                             {</div>
<div class="line"><span class="lineno">  493</span>  <span class="keywordflow">if</span> (!idx) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  494</span> </div>
<div class="line"><span class="lineno">  495</span>  <span class="keywordflow">if</span> (idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a10551567a23a0b23cf07c258deaacaaa">dedup_owned</a>) {</div>
<div class="line"><span class="lineno">  496</span>    <a class="code hl_struct" href="structie__weights__dedup.html">ie_weights_dedup_t</a> *h = idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a10551567a23a0b23cf07c258deaacaaa">dedup_owned</a>;</div>
<div class="line"><span class="lineno">  497</span>    <a class="code hl_function" href="weights__dedup_8h.html#a3ad33a6fe3c7a81072c092d1ee510fce">ie_weights_dedup_close</a>(&amp;h);</div>
<div class="line"><span class="lineno">  498</span>    idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a10551567a23a0b23cf07c258deaacaaa">dedup_owned</a> = NULL;</div>
<div class="line"><span class="lineno">  499</span>    idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#af655091ccb0f124d27d604287d6313b5">dedup</a> = NULL;</div>
<div class="line"><span class="lineno">  500</span>  }</div>
<div class="line"><span class="lineno">  501</span> </div>
<div class="line"><span class="lineno">  502</span>  <a class="code hl_function" href="tensor__map_8h.html#a42d154b3f93b07c41b514e468a61c803">tensor_map_free</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>);</div>
<div class="line"><span class="lineno">  503</span>  <a class="code hl_function" href="gptoss__weights__index_8c.html#a38ec37dc422b167e975773834349ec96">widx_mapped_close</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#ac96503b84bb4f2ea6158113639b660f9">bin</a>);</div>
<div class="line"><span class="lineno">  504</span> </div>
<div class="line"><span class="lineno">  505</span>  memset(idx, 0, <span class="keyword">sizeof</span>(*idx));</div>
<div class="line"><span class="lineno">  506</span>  idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#ac96503b84bb4f2ea6158113639b660f9">bin</a>.<a class="code hl_variable" href="structgptoss__mapped__file__t.html#a535fd2744904c614c9bdddf441984ca4">fd</a> = -1;</div>
<div class="line"><span class="lineno">  507</span>}</div>
<div class="ttc" id="agptoss__weights__index_8c_html_a38ec37dc422b167e975773834349ec96"><div class="ttname"><a href="gptoss__weights__index_8c.html#a38ec37dc422b167e975773834349ec96">widx_mapped_close</a></div><div class="ttdeci">static void widx_mapped_close(gptoss_mapped_file_t *mf)</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00139">gptoss_weights_index.c:139</a></div></div>
<div class="ttc" id="astructgptoss__mapped__file__t_html_a535fd2744904c614c9bdddf441984ca4"><div class="ttname"><a href="structgptoss__mapped__file__t.html#a535fd2744904c614c9bdddf441984ca4">gptoss_mapped_file_t::fd</a></div><div class="ttdeci">int fd</div><div class="ttdoc">File descriptor (POSIX only).</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00059">gptoss_weights_index.c:59</a></div></div>
<div class="ttc" id="astructgptoss__weights__index__t_html_a10551567a23a0b23cf07c258deaacaaa"><div class="ttname"><a href="structgptoss__weights__index__t.html#a10551567a23a0b23cf07c258deaacaaa">gptoss_weights_index_t::dedup_owned</a></div><div class="ttdeci">ie_weights_dedup_t * dedup_owned</div><div class="ttdoc">If non-NULL, we own this handle and must close.</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00078">gptoss_weights_index.c:78</a></div></div>
<div class="ttc" id="astructgptoss__weights__index__t_html_a3b13756eb517ad4a8c378fcc8a76175b"><div class="ttname"><a href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">gptoss_weights_index_t::tmap</a></div><div class="ttdeci">tensor_map_t tmap</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00072">gptoss_weights_index.c:72</a></div></div>
<div class="ttc" id="astructgptoss__weights__index__t_html_ac96503b84bb4f2ea6158113639b660f9"><div class="ttname"><a href="structgptoss__weights__index__t.html#ac96503b84bb4f2ea6158113639b660f9">gptoss_weights_index_t::bin</a></div><div class="ttdeci">gptoss_mapped_file_t bin</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00074">gptoss_weights_index.c:74</a></div></div>
<div class="ttc" id="astructgptoss__weights__index__t_html_af655091ccb0f124d27d604287d6313b5"><div class="ttname"><a href="structgptoss__weights__index__t.html#af655091ccb0f124d27d604287d6313b5">gptoss_weights_index_t::dedup</a></div><div class="ttdeci">const ie_weights_dedup_t * dedup</div><div class="ttdoc">Borrowed or locally-owned (see dedup_owned).</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00077">gptoss_weights_index.c:77</a></div></div>
<div class="ttc" id="astructie__weights__dedup_html"><div class="ttname"><a href="structie__weights__dedup.html">ie_weights_dedup</a></div><div class="ttdef"><b>Definition</b> <a href="weights__dedup_8c_source.html#l00747">weights_dedup.c:747</a></div></div>
<div class="ttc" id="atensor__map_8h_html_a42d154b3f93b07c41b514e468a61c803"><div class="ttname"><a href="tensor__map_8h.html#a42d154b3f93b07c41b514e468a61c803">tensor_map_free</a></div><div class="ttdeci">void tensor_map_free(tensor_map_t *map)</div><div class="ttdoc">Free tensor map and all owned memory.</div><div class="ttdef"><b>Definition</b> <a href="tensor__map_8c_source.html#l00650">tensor_map.c:650</a></div></div>
<div class="ttc" id="aweights__dedup_8h_html_a3ad33a6fe3c7a81072c092d1ee510fce"><div class="ttname"><a href="weights__dedup_8h.html#a3ad33a6fe3c7a81072c092d1ee510fce">ie_weights_dedup_close</a></div><div class="ttdeci">void ie_weights_dedup_close(ie_weights_dedup_t **h)</div><div class="ttdoc">Close the loader and free all associated memory.</div><div class="ttdef"><b>Definition</b> <a href="weights__dedup_8c_source.html#l01236">weights_dedup.c:1236</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="gptoss__weights__index_8c_source.html#l00074">gptoss_weights_index_t::bin</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00077">gptoss_weights_index_t::dedup</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00078">gptoss_weights_index_t::dedup_owned</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00059">gptoss_mapped_file_t::fd</a>, <a class="el" href="weights__dedup_8c_source.html#l01236">ie_weights_dedup_close()</a>, <a class="el" href="tensor__map_8c_source.html#l00650">tensor_map_free()</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00072">gptoss_weights_index_t::tmap</a>, and <a class="el" href="gptoss__weights__index_8c_source.html#l00139">widx_mapped_close()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8c_a943d5a8178000a52f6148bdbccda2252_cgraph.svg" width="615" height="159"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ab0abbe94d2373ea44d51f2325c7cc46c" name="ab0abbe94d2373ea44d51f2325c7cc46c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab0abbe94d2373ea44d51f2325c7cc46c">&#9670;&#160;</a></span>gptoss_weights_index_open()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int gptoss_weights_index_open </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structgptoss__weights__index__t.html">gptoss_weights_index_t</a> *&#160;</td>
          <td class="paramname"><em>out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>model_dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="ie__io_8h.html#af68ad3cdc2eb244fe4feed94372d7806">ie_weights_t</a> *&#160;</td>
          <td class="paramname"><em>weights</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Open a weights index for a given model directory and weights descriptor. </p>
<p>This loads <code>tensor_map.json</code> and maps <code>model.ie.bin</code>.</p>
<p>If <code>weights-&gt;is_dedup != 0</code> and <code>weights-&gt;dedup_handle != NULL</code>, this function will reuse that dedup loader (borrowed, not owned). If dedup is requested but no handle is present, it attempts to open a dedup loader from <code>model_dir</code>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">out</td><td>Output index (written on success). </td></tr>
    <tr><td class="paramname">model_dir</td><td>Model directory (used to locate tensor_map.json and dedup files). </td></tr>
    <tr><td class="paramname">weights</td><td>Weights descriptor opened by <a class="el" href="ie__io_8h.html#a522dac028ee37aae1307ffdb6d65ec1d" title="Open and parse an IEBIN v1 model description.">ie_weights_open</a>. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>IE_IO_OK on success, negative <a class="el" href="ie__io_8h.html#aabad0c7dd1649d6261de555346eb68d5">ie_io_status_t</a> on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="gptoss__weights__index_8c_source.html#l00417">417</a> of file <a class="el" href="gptoss__weights__index_8c_source.html">gptoss_weights_index.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  419</span>                                                          {</div>
<div class="line"><span class="lineno">  420</span>  <span class="keywordflow">if</span> (!out || !model_dir || !weights) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239">IE_IO_ERR_ARGS</a>;</div>
<div class="line"><span class="lineno">  421</span> </div>
<div class="line"><span class="lineno">  422</span>  memset(out, 0, <span class="keyword">sizeof</span>(*out));</div>
<div class="line"><span class="lineno">  423</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;bin.fd = -1;</div>
<div class="line"><span class="lineno">  424</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;weights = weights;</div>
<div class="line"><span class="lineno">  425</span> </div>
<div class="line"><span class="lineno">  426</span>  {</div>
<div class="line"><span class="lineno">  427</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *tr = getenv(<span class="stringliteral">&quot;IE_TRACE_LOOKUPS&quot;</span>);</div>
<div class="line"><span class="lineno">  428</span>    <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;trace = (tr &amp;&amp; tr[0] &amp;&amp; strcmp(tr, <span class="stringliteral">&quot;0&quot;</span>) != 0);</div>
<div class="line"><span class="lineno">  429</span>  }</div>
<div class="line"><span class="lineno">  430</span> </div>
<div class="line"><span class="lineno">  431</span>  <span class="keywordflow">if</span> (strlen(model_dir) &gt;= <span class="keyword">sizeof</span>(<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;model_dir)) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239">IE_IO_ERR_ARGS</a>;</div>
<div class="line"><span class="lineno">  432</span>  memcpy(<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;model_dir, model_dir, strlen(model_dir) + 1u);</div>
<div class="line"><span class="lineno">  433</span> </div>
<div class="line"><span class="lineno">  434</span>  <span class="keywordtype">char</span> tmap_path[1024];</div>
<div class="line"><span class="lineno">  435</span>  memset(tmap_path, 0, <span class="keyword">sizeof</span>(tmap_path));</div>
<div class="line"><span class="lineno">  436</span> </div>
<div class="line"><span class="lineno">  437</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="gptoss__weights__index_8c.html#a4a56b6936dd1f3d8668251a331151a96">widx_path_join</a>(tmap_path, <span class="keyword">sizeof</span>(tmap_path), model_dir, <span class="stringliteral">&quot;tensor_map.json&quot;</span>) != 0) {</div>
<div class="line"><span class="lineno">  438</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239">IE_IO_ERR_ARGS</a>;</div>
<div class="line"><span class="lineno">  439</span>  }</div>
<div class="line"><span class="lineno">  440</span> </div>
<div class="line"><span class="lineno">  441</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="tensor__map_8h.html#ac4b913e2710929070b5b073b4b67b24c">tensor_map_load</a>(tmap_path, &amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;tmap) != 0) {</div>
<div class="line"><span class="lineno">  442</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="gptoss__weights__index_8c.html#a4a56b6936dd1f3d8668251a331151a96">widx_path_join</a>(tmap_path, <span class="keyword">sizeof</span>(tmap_path), model_dir, <span class="stringliteral">&quot;hf/original/tensor_map.json&quot;</span>) != 0) {</div>
<div class="line"><span class="lineno">  443</span>      <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9">IE_IO_ERR_JSON</a>;</div>
<div class="line"><span class="lineno">  444</span>    }</div>
<div class="line"><span class="lineno">  445</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="tensor__map_8h.html#ac4b913e2710929070b5b073b4b67b24c">tensor_map_load</a>(tmap_path, &amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;tmap) != 0) {</div>
<div class="line"><span class="lineno">  446</span>      <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9">IE_IO_ERR_JSON</a>;</div>
<div class="line"><span class="lineno">  447</span>    }</div>
<div class="line"><span class="lineno">  448</span>  }</div>
<div class="line"><span class="lineno">  449</span> </div>
<div class="line"><span class="lineno">  450</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="gptoss__weights__index_8c.html#add8363effbaa37fcdc8b72a4d9a858af">widx_trace_enabled</a>(out)) {</div>
<div class="line"><span class="lineno">  451</span>    <a class="code hl_function" href="gptoss__weights__index_8c.html#a724e4be15ba1676eb3369599e99eccc6">widx_tracef</a>(out, <span class="stringliteral">&quot;[widx] tensor_map loaded from &#39;%s&#39;\n&quot;</span>, tmap_path);</div>
<div class="line"><span class="lineno">  452</span>  }</div>
<div class="line"><span class="lineno">  453</span> </div>
<div class="line"><span class="lineno">  454</span>  <span class="keywordflow">if</span> (!weights-&gt;<a class="code hl_variable" href="structie__weights__s.html#ab6a61099d0af4a47854d02dc4fef5b8f">weights_path</a>[0]) {</div>
<div class="line"><span class="lineno">  455</span>    <a class="code hl_function" href="tensor__map_8h.html#a42d154b3f93b07c41b514e468a61c803">tensor_map_free</a>(&amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;tmap);</div>
<div class="line"><span class="lineno">  456</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a66046f2226981286e47bb2f33ab56862">IE_IO_ERR_BIN_UNSPEC</a>;</div>
<div class="line"><span class="lineno">  457</span>  }</div>
<div class="line"><span class="lineno">  458</span> </div>
<div class="line"><span class="lineno">  459</span>  {</div>
<div class="line"><span class="lineno">  460</span>    <span class="keywordtype">int</span> rc = <a class="code hl_function" href="gptoss__weights__index_8c.html#ae6ffa18bb461a4aff5f94b8b20f71c93">widx_mapped_open</a>(&amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;bin, weights-&gt;<a class="code hl_variable" href="structie__weights__s.html#ab6a61099d0af4a47854d02dc4fef5b8f">weights_path</a>);</div>
<div class="line"><span class="lineno">  461</span>    <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>) {</div>
<div class="line"><span class="lineno">  462</span>      <a class="code hl_function" href="tensor__map_8h.html#a42d154b3f93b07c41b514e468a61c803">tensor_map_free</a>(&amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;tmap);</div>
<div class="line"><span class="lineno">  463</span>      <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  464</span>    }</div>
<div class="line"><span class="lineno">  465</span>  }</div>
<div class="line"><span class="lineno">  466</span> </div>
<div class="line"><span class="lineno">  467</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;dedup = NULL;</div>
<div class="line"><span class="lineno">  468</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;dedup_owned = NULL;</div>
<div class="line"><span class="lineno">  469</span> </div>
<div class="line"><span class="lineno">  470</span>  <span class="keywordflow">if</span> (weights-&gt;<a class="code hl_variable" href="structie__weights__s.html#ab1e17ac4f44125571f2c63e603d967da">is_dedup</a>) {</div>
<div class="line"><span class="lineno">  471</span>    <span class="keywordflow">if</span> (weights-&gt;<a class="code hl_variable" href="structie__weights__s.html#a6cffa1c1904346d68932cc9542b8ff32">dedup_handle</a>) {</div>
<div class="line"><span class="lineno">  472</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;dedup = (<span class="keyword">const</span> <a class="code hl_struct" href="structie__weights__dedup.html">ie_weights_dedup_t</a>*)weights-&gt;<a class="code hl_variable" href="structie__weights__s.html#a6cffa1c1904346d68932cc9542b8ff32">dedup_handle</a>;</div>
<div class="line"><span class="lineno">  473</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  474</span>      <a class="code hl_struct" href="structie__weights__dedup.html">ie_weights_dedup_t</a> *h = NULL;</div>
<div class="line"><span class="lineno">  475</span>      <a class="code hl_struct" href="structie__weights__dedup__opts__t.html">ie_weights_dedup_opts_t</a> opts;</div>
<div class="line"><span class="lineno">  476</span>      memset(&amp;opts, 0, <span class="keyword">sizeof</span>(opts));</div>
<div class="line"><span class="lineno">  477</span>      opts.<a class="code hl_variable" href="structie__weights__dedup__opts__t.html#a86ae82fb8029f319a275251de5918035">prefault_policy</a> = 0;</div>
<div class="line"><span class="lineno">  478</span>      <a class="code hl_enumeration" href="weights__dedup_8h.html#a58857f75f23e827eb7a07572c0b93f2f">ie_wdedup_status_t</a> st = <a class="code hl_function" href="weights__dedup_8h.html#aa625b41ce2a24826f8cb464661ace8ec">ie_weights_dedup_open</a>(&amp;h, model_dir, &amp;opts);</div>
<div class="line"><span class="lineno">  479</span>      <span class="keywordflow">if</span> (st != <a class="code hl_enumvalue" href="weights__dedup_8h.html#a58857f75f23e827eb7a07572c0b93f2fa0baf1bf45e91e9558e44038d27d20e2f">IE_WDEDUP_OK</a>) {</div>
<div class="line"><span class="lineno">  480</span>        <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;dedup = NULL;</div>
<div class="line"><span class="lineno">  481</span>        <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;dedup_owned = NULL;</div>
<div class="line"><span class="lineno">  482</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  483</span>        <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;dedup = h;</div>
<div class="line"><span class="lineno">  484</span>        <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;dedup_owned = h;</div>
<div class="line"><span class="lineno">  485</span>      }</div>
<div class="line"><span class="lineno">  486</span>    }</div>
<div class="line"><span class="lineno">  487</span>  }</div>
<div class="line"><span class="lineno">  488</span> </div>
<div class="line"><span class="lineno">  489</span>  <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>;</div>
<div class="line"><span class="lineno">  490</span>}</div>
<div class="ttc" id="agptoss__weights__index_8c_html_a4a56b6936dd1f3d8668251a331151a96"><div class="ttname"><a href="gptoss__weights__index_8c.html#a4a56b6936dd1f3d8668251a331151a96">widx_path_join</a></div><div class="ttdeci">static int widx_path_join(char *dst, size_t dst_n, const char *model_dir, const char *leaf)</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00113">gptoss_weights_index.c:113</a></div></div>
<div class="ttc" id="agptoss__weights__index_8c_html_a724e4be15ba1676eb3369599e99eccc6"><div class="ttname"><a href="gptoss__weights__index_8c.html#a724e4be15ba1676eb3369599e99eccc6">widx_tracef</a></div><div class="ttdeci">static void widx_tracef(const gptoss_weights_index_t *idx, const char *fmt,...)</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00091">gptoss_weights_index.c:91</a></div></div>
<div class="ttc" id="agptoss__weights__index_8c_html_add8363effbaa37fcdc8b72a4d9a858af"><div class="ttname"><a href="gptoss__weights__index_8c.html#add8363effbaa37fcdc8b72a4d9a858af">widx_trace_enabled</a></div><div class="ttdeci">static int widx_trace_enabled(const gptoss_weights_index_t *idx)</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00087">gptoss_weights_index.c:87</a></div></div>
<div class="ttc" id="agptoss__weights__index_8c_html_ae6ffa18bb461a4aff5f94b8b20f71c93"><div class="ttname"><a href="gptoss__weights__index_8c.html#ae6ffa18bb461a4aff5f94b8b20f71c93">widx_mapped_open</a></div><div class="ttdeci">static int widx_mapped_open(gptoss_mapped_file_t *mf, const char *path)</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00201">gptoss_weights_index.c:201</a></div></div>
<div class="ttc" id="aie__io_8h_html_a4c501870bd45dbe373416745a03de987a66046f2226981286e47bb2f33ab56862"><div class="ttname"><a href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a66046f2226981286e47bb2f33ab56862">IE_IO_ERR_BIN_UNSPEC</a></div><div class="ttdeci">@ IE_IO_ERR_BIN_UNSPEC</div><div class="ttdoc">Binary path unspecified and not inferable.</div><div class="ttdef"><b>Definition</b> <a href="ie__io_8h_source.html#l00067">ie_io.h:67</a></div></div>
<div class="ttc" id="astructie__weights__dedup__opts__t_html"><div class="ttname"><a href="structie__weights__dedup__opts__t.html">ie_weights_dedup_opts_t</a></div><div class="ttdoc">Loader options.</div><div class="ttdef"><b>Definition</b> <a href="weights__dedup_8h_source.html#l00091">weights_dedup.h:91</a></div></div>
<div class="ttc" id="astructie__weights__dedup__opts__t_html_a86ae82fb8029f319a275251de5918035"><div class="ttname"><a href="structie__weights__dedup__opts__t.html#a86ae82fb8029f319a275251de5918035">ie_weights_dedup_opts_t::prefault_policy</a></div><div class="ttdeci">int prefault_policy</div><div class="ttdoc">Prefault policy for mmapped blobs: 0 = none, 1 = sequential, 2 = will-need.</div><div class="ttdef"><b>Definition</b> <a href="weights__dedup_8h_source.html#l00098">weights_dedup.h:98</a></div></div>
<div class="ttc" id="astructie__weights__s_html_a6cffa1c1904346d68932cc9542b8ff32"><div class="ttname"><a href="structie__weights__s.html#a6cffa1c1904346d68932cc9542b8ff32">ie_weights_s::dedup_handle</a></div><div class="ttdeci">void * dedup_handle</div><div class="ttdoc">Opaque dedup handle (owned by this struct).</div><div class="ttdef"><b>Definition</b> <a href="ie__io_8h_source.html#l00105">ie_io.h:105</a></div></div>
<div class="ttc" id="astructie__weights__s_html_ab1e17ac4f44125571f2c63e603d967da"><div class="ttname"><a href="structie__weights__s.html#ab1e17ac4f44125571f2c63e603d967da">ie_weights_s::is_dedup</a></div><div class="ttdeci">int is_dedup</div><div class="ttdoc">Non-zero if dedup artifacts were opened.</div><div class="ttdef"><b>Definition</b> <a href="ie__io_8h_source.html#l00104">ie_io.h:104</a></div></div>
<div class="ttc" id="astructie__weights__s_html_ab6a61099d0af4a47854d02dc4fef5b8f"><div class="ttname"><a href="structie__weights__s.html#ab6a61099d0af4a47854d02dc4fef5b8f">ie_weights_s::weights_path</a></div><div class="ttdeci">char weights_path[512]</div><div class="ttdoc">Resolved path to model.ie.bin.</div><div class="ttdef"><b>Definition</b> <a href="ie__io_8h_source.html#l00099">ie_io.h:99</a></div></div>
<div class="ttc" id="atensor__map_8h_html_ac4b913e2710929070b5b073b4b67b24c"><div class="ttname"><a href="tensor__map_8h.html#ac4b913e2710929070b5b073b4b67b24c">tensor_map_load</a></div><div class="ttdeci">int tensor_map_load(const char *path, tensor_map_t *out)</div><div class="ttdoc">Load tensor_map.json from disk.</div><div class="ttdef"><b>Definition</b> <a href="tensor__map_8c_source.html#l00484">tensor_map.c:484</a></div></div>
<div class="ttc" id="aweights__dedup_8h_html_a58857f75f23e827eb7a07572c0b93f2f"><div class="ttname"><a href="weights__dedup_8h.html#a58857f75f23e827eb7a07572c0b93f2f">ie_wdedup_status_t</a></div><div class="ttdeci">ie_wdedup_status_t</div><div class="ttdoc">Error/status codes for the dedup loader.</div><div class="ttdef"><b>Definition</b> <a href="weights__dedup_8h_source.html#l00034">weights_dedup.h:34</a></div></div>
<div class="ttc" id="aweights__dedup_8h_html_a58857f75f23e827eb7a07572c0b93f2fa0baf1bf45e91e9558e44038d27d20e2f"><div class="ttname"><a href="weights__dedup_8h.html#a58857f75f23e827eb7a07572c0b93f2fa0baf1bf45e91e9558e44038d27d20e2f">IE_WDEDUP_OK</a></div><div class="ttdeci">@ IE_WDEDUP_OK</div><div class="ttdef"><b>Definition</b> <a href="weights__dedup_8h_source.html#l00035">weights_dedup.h:35</a></div></div>
<div class="ttc" id="aweights__dedup_8h_html_aa625b41ce2a24826f8cb464661ace8ec"><div class="ttname"><a href="weights__dedup_8h.html#aa625b41ce2a24826f8cb464661ace8ec">ie_weights_dedup_open</a></div><div class="ttdeci">ie_wdedup_status_t ie_weights_dedup_open(ie_weights_dedup_t **out, const char *model_dir, const ie_weights_dedup_opts_t *opts)</div><div class="ttdoc">Open the dedup weights loader from a model directory.</div><div class="ttdef"><b>Definition</b> <a href="weights__dedup_8c_source.html#l01055">weights_dedup.c:1055</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ie__io_8h_source.html#l00105">ie_weights_s::dedup_handle</a>, <a class="el" href="ie__io_8h_source.html#l00065">IE_IO_ERR_ARGS</a>, <a class="el" href="ie__io_8h_source.html#l00067">IE_IO_ERR_BIN_UNSPEC</a>, <a class="el" href="ie__io_8h_source.html#l00066">IE_IO_ERR_JSON</a>, <a class="el" href="ie__io_8h_source.html#l00064">IE_IO_OK</a>, <a class="el" href="weights__dedup_8h_source.html#l00035">IE_WDEDUP_OK</a>, <a class="el" href="weights__dedup_8c_source.html#l01055">ie_weights_dedup_open()</a>, <a class="el" href="ie__io_8h_source.html#l00104">ie_weights_s::is_dedup</a>, <a class="el" href="weights__dedup_8h_source.html#l00098">ie_weights_dedup_opts_t::prefault_policy</a>, <a class="el" href="tensor__map_8c_source.html#l00650">tensor_map_free()</a>, <a class="el" href="tensor__map_8c_source.html#l00484">tensor_map_load()</a>, <a class="el" href="ie__io_8h_source.html#l00099">ie_weights_s::weights_path</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00201">widx_mapped_open()</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00113">widx_path_join()</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00087">widx_trace_enabled()</a>, and <a class="el" href="gptoss__weights__index_8c_source.html#l00091">widx_tracef()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8c_ab0abbe94d2373ea44d51f2325c7cc46c_cgraph.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a1d0c65a6e45fb8bdf4ef6e703fbe20b5" name="a1d0c65a6e45fb8bdf4ef6e703fbe20b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1d0c65a6e45fb8bdf4ef6e703fbe20b5">&#9670;&#160;</a></span>widx_detect_arch()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int widx_detect_arch </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structgptoss__weights__index__t.html">gptoss_weights_index_t</a> *&#160;</td>
          <td class="paramname"><em>idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="gptoss__weights__index_8h.html#a5ba3978bcdac9a88ae300e42940692bd">gptoss_arch_kind_t</a> *&#160;</td>
          <td class="paramname"><em>out_arch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>out_fused_qkv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>out_swiglu</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="gptoss__weights__index_8c_source.html#l00513">513</a> of file <a class="el" href="gptoss__weights__index_8c_source.html">gptoss_weights_index.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  516</span>                                             {</div>
<div class="line"><span class="lineno">  517</span>  <span class="keywordflow">if</span> (!idx || !out_arch || !out_fused_qkv || !out_swiglu) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239">IE_IO_ERR_ARGS</a>;</div>
<div class="line"><span class="lineno">  518</span> </div>
<div class="line"><span class="lineno">  519</span>  *out_arch = <a class="code hl_enumvalue" href="gptoss__weights__index_8h.html#a5ba3978bcdac9a88ae300e42940692bdae8e64fc15398950e8e54c4dbc859dcba">GPTOSS_ARCH_UNKNOWN</a>;</div>
<div class="line"><span class="lineno">  520</span>  *out_fused_qkv = 0;</div>
<div class="line"><span class="lineno">  521</span>  *out_swiglu = 0;</div>
<div class="line"><span class="lineno">  522</span> </div>
<div class="line"><span class="lineno">  523</span>  {</div>
<div class="line"><span class="lineno">  524</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *llama_q_names[] = {</div>
<div class="line"><span class="lineno">  525</span>      <span class="stringliteral">&quot;model.layers.0.self_attn.q_proj.weight&quot;</span>,</div>
<div class="line"><span class="lineno">  526</span>      <span class="stringliteral">&quot;model.layers.0.attn.q_proj.weight&quot;</span></div>
<div class="line"><span class="lineno">  527</span>    };</div>
<div class="line"><span class="lineno">  528</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *llama_fused_names[] = {</div>
<div class="line"><span class="lineno">  529</span>      <span class="stringliteral">&quot;model.layers.0.self_attn.qkv_proj.weight&quot;</span>,</div>
<div class="line"><span class="lineno">  530</span>      <span class="stringliteral">&quot;model.layers.0.self_attn.qkv.weight&quot;</span>,</div>
<div class="line"><span class="lineno">  531</span>      <span class="stringliteral">&quot;model.layers.0.attn.qkv_proj.weight&quot;</span>,</div>
<div class="line"><span class="lineno">  532</span>      <span class="stringliteral">&quot;model.layers.0.attn.qkv.weight&quot;</span></div>
<div class="line"><span class="lineno">  533</span>    };</div>
<div class="line"><span class="lineno">  534</span> </div>
<div class="line"><span class="lineno">  535</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="gptoss__weights__index_8c.html#adc8f01ad4eb156e2f380f2b39e51d0ae">widx_find_any</a>(idx, &amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, llama_q_names, <span class="keyword">sizeof</span>(llama_q_names)/<span class="keyword">sizeof</span>(llama_q_names[0])) ||</div>
<div class="line"><span class="lineno">  536</span>        <a class="code hl_function" href="gptoss__weights__index_8c.html#adc8f01ad4eb156e2f380f2b39e51d0ae">widx_find_any</a>(idx, &amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, llama_fused_names, <span class="keyword">sizeof</span>(llama_fused_names)/<span class="keyword">sizeof</span>(llama_fused_names[0]))) {</div>
<div class="line"><span class="lineno">  537</span>      *out_arch = <a class="code hl_enumvalue" href="gptoss__weights__index_8h.html#a5ba3978bcdac9a88ae300e42940692bdade1572936286502eb2604bbf70812e26">GPTOSS_ARCH_LLAMA</a>;</div>
<div class="line"><span class="lineno">  538</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="gptoss__weights__index_8c.html#adc8f01ad4eb156e2f380f2b39e51d0ae">widx_find_any</a>(idx, &amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, llama_fused_names, <span class="keyword">sizeof</span>(llama_fused_names)/<span class="keyword">sizeof</span>(llama_fused_names[0]))) {</div>
<div class="line"><span class="lineno">  539</span>        *out_fused_qkv = 1;</div>
<div class="line"><span class="lineno">  540</span>      }</div>
<div class="line"><span class="lineno">  541</span> </div>
<div class="line"><span class="lineno">  542</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="tensor__map_8h.html#abe58b80593931ffe5844ee4bcee805c5">tensor_map_find</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, <span class="stringliteral">&quot;model.layers.0.mlp.gate_proj.weight&quot;</span>) ||</div>
<div class="line"><span class="lineno">  543</span>          <a class="code hl_function" href="tensor__map_8h.html#abe58b80593931ffe5844ee4bcee805c5">tensor_map_find</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, <span class="stringliteral">&quot;model.layers.0.feed_forward.gate_proj.weight&quot;</span>)) {</div>
<div class="line"><span class="lineno">  544</span>        *out_swiglu = 1;</div>
<div class="line"><span class="lineno">  545</span>      } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  546</span>        *out_swiglu = 0;</div>
<div class="line"><span class="lineno">  547</span>      }</div>
<div class="line"><span class="lineno">  548</span> </div>
<div class="line"><span class="lineno">  549</span>      <a class="code hl_function" href="gptoss__weights__index_8c.html#a724e4be15ba1676eb3369599e99eccc6">widx_tracef</a>(idx, <span class="stringliteral">&quot;[widx] arch=LLAMA fused_qkv=%d swiglu=%d\n&quot;</span>, *out_fused_qkv, *out_swiglu);</div>
<div class="line"><span class="lineno">  550</span>      <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>;</div>
<div class="line"><span class="lineno">  551</span>    }</div>
<div class="line"><span class="lineno">  552</span>  }</div>
<div class="line"><span class="lineno">  553</span> </div>
<div class="line"><span class="lineno">  554</span>  {</div>
<div class="line"><span class="lineno">  555</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *neox_fused_qkv[] = {</div>
<div class="line"><span class="lineno">  556</span>      <span class="stringliteral">&quot;gpt_neox.layers.0.attention.query_key_value.weight&quot;</span></div>
<div class="line"><span class="lineno">  557</span>    };</div>
<div class="line"><span class="lineno">  558</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="gptoss__weights__index_8c.html#adc8f01ad4eb156e2f380f2b39e51d0ae">widx_find_any</a>(idx, &amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, neox_fused_qkv, <span class="keyword">sizeof</span>(neox_fused_qkv)/<span class="keyword">sizeof</span>(neox_fused_qkv[0])) ||</div>
<div class="line"><span class="lineno">  559</span>        <a class="code hl_function" href="tensor__map_8h.html#abe58b80593931ffe5844ee4bcee805c5">tensor_map_find</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, <span class="stringliteral">&quot;gpt_neox.layers.0.attention.query.weight&quot;</span>)) {</div>
<div class="line"><span class="lineno">  560</span>      *out_arch = <a class="code hl_enumvalue" href="gptoss__weights__index_8h.html#a5ba3978bcdac9a88ae300e42940692bdaca48309b567bec1419ac072f6057c724">GPTOSS_ARCH_GPTNEOX</a>;</div>
<div class="line"><span class="lineno">  561</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="gptoss__weights__index_8c.html#adc8f01ad4eb156e2f380f2b39e51d0ae">widx_find_any</a>(idx, &amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, neox_fused_qkv, <span class="keyword">sizeof</span>(neox_fused_qkv)/<span class="keyword">sizeof</span>(neox_fused_qkv[0]))) {</div>
<div class="line"><span class="lineno">  562</span>        *out_fused_qkv = 1;</div>
<div class="line"><span class="lineno">  563</span>      }</div>
<div class="line"><span class="lineno">  564</span>      *out_swiglu = 0;</div>
<div class="line"><span class="lineno">  565</span> </div>
<div class="line"><span class="lineno">  566</span>      <a class="code hl_function" href="gptoss__weights__index_8c.html#a724e4be15ba1676eb3369599e99eccc6">widx_tracef</a>(idx, <span class="stringliteral">&quot;[widx] arch=GPTNEOX fused_qkv=%d swiglu=%d\n&quot;</span>, *out_fused_qkv, *out_swiglu);</div>
<div class="line"><span class="lineno">  567</span>      <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>;</div>
<div class="line"><span class="lineno">  568</span>    }</div>
<div class="line"><span class="lineno">  569</span>  }</div>
<div class="line"><span class="lineno">  570</span> </div>
<div class="line"><span class="lineno">  571</span>  <a class="code hl_function" href="gptoss__weights__index_8c.html#a724e4be15ba1676eb3369599e99eccc6">widx_tracef</a>(idx, <span class="stringliteral">&quot;[widx] arch detection failed\n&quot;</span>);</div>
<div class="line"><span class="lineno">  572</span>  <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9">IE_IO_ERR_JSON</a>;</div>
<div class="line"><span class="lineno">  573</span>}</div>
<div class="ttc" id="agptoss__weights__index_8c_html_adc8f01ad4eb156e2f380f2b39e51d0ae"><div class="ttname"><a href="gptoss__weights__index_8c.html#adc8f01ad4eb156e2f380f2b39e51d0ae">widx_find_any</a></div><div class="ttdeci">static const tensor_desc_t * widx_find_any(const gptoss_weights_index_t *idx, const tensor_map_t *map, const char *const *names, size_t n)</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00332">gptoss_weights_index.c:332</a></div></div>
<div class="ttc" id="agptoss__weights__index_8h_html_a5ba3978bcdac9a88ae300e42940692bdae8e64fc15398950e8e54c4dbc859dcba"><div class="ttname"><a href="gptoss__weights__index_8h.html#a5ba3978bcdac9a88ae300e42940692bdae8e64fc15398950e8e54c4dbc859dcba">GPTOSS_ARCH_UNKNOWN</a></div><div class="ttdeci">@ GPTOSS_ARCH_UNKNOWN</div><div class="ttdoc">Unrecognized naming scheme.</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8h_source.html#l00064">gptoss_weights_index.h:64</a></div></div>
<div class="ttc" id="atensor__map_8h_html_abe58b80593931ffe5844ee4bcee805c5"><div class="ttname"><a href="tensor__map_8h.html#abe58b80593931ffe5844ee4bcee805c5">tensor_map_find</a></div><div class="ttdeci">const tensor_desc_t * tensor_map_find(const tensor_map_t *map, const char *name)</div><div class="ttdoc">Find a tensor descriptor by exact name.</div><div class="ttdef"><b>Definition</b> <a href="tensor__map_8c_source.html#l00662">tensor_map.c:662</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="gptoss__weights__index_8h_source.html#l00066">GPTOSS_ARCH_GPTNEOX</a>, <a class="el" href="gptoss__weights__index_8h_source.html#l00065">GPTOSS_ARCH_LLAMA</a>, <a class="el" href="gptoss__weights__index_8h_source.html#l00064">GPTOSS_ARCH_UNKNOWN</a>, <a class="el" href="ie__io_8h_source.html#l00065">IE_IO_ERR_ARGS</a>, <a class="el" href="ie__io_8h_source.html#l00066">IE_IO_ERR_JSON</a>, <a class="el" href="ie__io_8h_source.html#l00064">IE_IO_OK</a>, <a class="el" href="tensor__map_8c_source.html#l00662">tensor_map_find()</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00072">gptoss_weights_index_t::tmap</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00332">widx_find_any()</a>, and <a class="el" href="gptoss__weights__index_8c_source.html#l00091">widx_tracef()</a>.</p>

<p class="reference">Referenced by <a class="el" href="gptoss__weights__index_8c_source.html#l00860">gptoss_weights_index_build_model()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8c_a1d0c65a6e45fb8bdf4ef6e703fbe20b5_cgraph.svg" width="100%" height="403"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8c_a1d0c65a6e45fb8bdf4ef6e703fbe20b5_icgraph.svg" width="362" height="51"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="adc8f01ad4eb156e2f380f2b39e51d0ae" name="adc8f01ad4eb156e2f380f2b39e51d0ae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adc8f01ad4eb156e2f380f2b39e51d0ae">&#9670;&#160;</a></span>widx_find_any()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static const <a class="el" href="tensor__map_8h.html#a1ed0f6ce08b1582103651d4fd14a30f1">tensor_desc_t</a> * widx_find_any </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structgptoss__weights__index__t.html">gptoss_weights_index_t</a> *&#160;</td>
          <td class="paramname"><em>idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="tensor__map_8h.html#a0ae1dced25c800bf85537db1ce9776a7">tensor_map_t</a> *&#160;</td>
          <td class="paramname"><em>map</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const *&#160;</td>
          <td class="paramname"><em>names</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>n</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="gptoss__weights__index_8c_source.html#l00332">332</a> of file <a class="el" href="gptoss__weights__index_8c_source.html">gptoss_weights_index.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  335</span>                                                    {</div>
<div class="line"><span class="lineno">  336</span>  <span class="keywordflow">if</span> (!map || !names) <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  337</span> </div>
<div class="line"><span class="lineno">  338</span>  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; n; ++i) {</div>
<div class="line"><span class="lineno">  339</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *name = names[i];</div>
<div class="line"><span class="lineno">  340</span>    <span class="keywordflow">if</span> (!name) <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  341</span> </div>
<div class="line"><span class="lineno">  342</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structtensor__desc__s.html">tensor_desc_t</a> *d = <a class="code hl_function" href="tensor__map_8h.html#abe58b80593931ffe5844ee4bcee805c5">tensor_map_find</a>(map, name);</div>
<div class="line"><span class="lineno">  343</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="gptoss__weights__index_8c.html#add8363effbaa37fcdc8b72a4d9a858af">widx_trace_enabled</a>(idx)) {</div>
<div class="line"><span class="lineno">  344</span>      <a class="code hl_function" href="gptoss__weights__index_8c.html#a724e4be15ba1676eb3369599e99eccc6">widx_tracef</a>(idx, <span class="stringliteral">&quot;[widx] probe: &#39;%s&#39; -&gt; %s\n&quot;</span>, name, d ? <span class="stringliteral">&quot;FOUND&quot;</span> : <span class="stringliteral">&quot;MISS&quot;</span>);</div>
<div class="line"><span class="lineno">  345</span>    }</div>
<div class="line"><span class="lineno">  346</span>    <span class="keywordflow">if</span> (d) <span class="keywordflow">return</span> d;</div>
<div class="line"><span class="lineno">  347</span>  }</div>
<div class="line"><span class="lineno">  348</span>  <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  349</span>}</div>
<div class="ttc" id="astructtensor__desc__s_html"><div class="ttname"><a href="structtensor__desc__s.html">tensor_desc_s</a></div><div class="ttdoc">Tensor descriptor resolved from tensor_map.json.</div><div class="ttdef"><b>Definition</b> <a href="tensor__map_8h_source.html#l00092">tensor_map.h:92</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="tensor__map_8c_source.html#l00662">tensor_map_find()</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00087">widx_trace_enabled()</a>, and <a class="el" href="gptoss__weights__index_8c_source.html#l00091">widx_tracef()</a>.</p>

<p class="reference">Referenced by <a class="el" href="gptoss__weights__index_8c_source.html#l00513">widx_detect_arch()</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00374">widx_resolve_optional()</a>, and <a class="el" href="gptoss__weights__index_8c_source.html#l00359">widx_resolve_required()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8c_adc8f01ad4eb156e2f380f2b39e51d0ae_cgraph.svg" width="504" height="138"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8c_adc8f01ad4eb156e2f380f2b39e51d0ae_icgraph.svg" width="558" height="135"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a0c207c648c00b914718b2dd50416829e" name="a0c207c648c00b914718b2dd50416829e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0c207c648c00b914718b2dd50416829e">&#9670;&#160;</a></span>widx_fmt_layer()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int widx_fmt_layer </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>dst_n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>layer</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="gptoss__weights__index_8c_source.html#l00351">351</a> of file <a class="el" href="gptoss__weights__index_8c_source.html">gptoss_weights_index.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  351</span>                                                                                    {</div>
<div class="line"><span class="lineno">  352</span>  <span class="keywordflow">if</span> (!dst || dst_n == 0 || !fmt) <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  353</span>  <span class="keywordtype">int</span> n = snprintf(dst, dst_n, fmt, (<span class="keywordtype">unsigned</span>)layer);</div>
<div class="line"><span class="lineno">  354</span>  <span class="keywordflow">if</span> (n &lt; 0) <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  355</span>  <span class="keywordflow">if</span> ((<span class="keywordtype">size_t</span>)n &gt;= dst_n) <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  356</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  357</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="gptoss__weights__index_8c_source.html#l00575">widx_resolve_layer_llama()</a>, and <a class="el" href="gptoss__weights__index_8c_source.html#l00794">widx_resolve_layer_neox()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8c_a0c207c648c00b914718b2dd50416829e_icgraph.svg" width="583" height="102"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a38ec37dc422b167e975773834349ec96" name="a38ec37dc422b167e975773834349ec96"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a38ec37dc422b167e975773834349ec96">&#9670;&#160;</a></span>widx_mapped_close()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void widx_mapped_close </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structgptoss__mapped__file__t.html">gptoss_mapped_file_t</a> *&#160;</td>
          <td class="paramname"><em>mf</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="gptoss__weights__index_8c_source.html#l00139">139</a> of file <a class="el" href="gptoss__weights__index_8c_source.html">gptoss_weights_index.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  139</span>                                                        {</div>
<div class="line"><span class="lineno">  140</span>  <span class="keywordflow">if</span> (!mf) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  141</span> </div>
<div class="line"><span class="lineno">  142</span><span class="preprocessor">#if defined(__unix__) || defined(__APPLE__)</span></div>
<div class="line"><span class="lineno">  143</span>  <span class="keywordflow">if</span> (mf-&gt;<a class="code hl_variable" href="structgptoss__mapped__file__t.html#ac0c9d90b334315d80adc5e0d4d131b1c">is_mmap</a> &amp;&amp; mf-&gt;<a class="code hl_variable" href="structgptoss__mapped__file__t.html#a82d6f9794be52794709bc995a27ac557">base</a> &amp;&amp; mf-&gt;<a class="code hl_variable" href="structgptoss__mapped__file__t.html#af9e6c58ee54250f1ab602509b247878f">size</a>) {</div>
<div class="line"><span class="lineno">  144</span>    (void)munmap(mf-&gt;<a class="code hl_variable" href="structgptoss__mapped__file__t.html#a82d6f9794be52794709bc995a27ac557">base</a>, mf-&gt;<a class="code hl_variable" href="structgptoss__mapped__file__t.html#af9e6c58ee54250f1ab602509b247878f">size</a>);</div>
<div class="line"><span class="lineno">  145</span>  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!mf-&gt;<a class="code hl_variable" href="structgptoss__mapped__file__t.html#ac0c9d90b334315d80adc5e0d4d131b1c">is_mmap</a> &amp;&amp; mf-&gt;<a class="code hl_variable" href="structgptoss__mapped__file__t.html#a82d6f9794be52794709bc995a27ac557">base</a>) {</div>
<div class="line"><span class="lineno">  146</span>    free(mf-&gt;<a class="code hl_variable" href="structgptoss__mapped__file__t.html#a82d6f9794be52794709bc995a27ac557">base</a>);</div>
<div class="line"><span class="lineno">  147</span>  }</div>
<div class="line"><span class="lineno">  148</span> </div>
<div class="line"><span class="lineno">  149</span>  <span class="keywordflow">if</span> (mf-&gt;<a class="code hl_variable" href="structgptoss__mapped__file__t.html#a535fd2744904c614c9bdddf441984ca4">fd</a> &gt;= 0) {</div>
<div class="line"><span class="lineno">  150</span>    (void)close(mf-&gt;<a class="code hl_variable" href="structgptoss__mapped__file__t.html#a535fd2744904c614c9bdddf441984ca4">fd</a>);</div>
<div class="line"><span class="lineno">  151</span>  }</div>
<div class="line"><span class="lineno">  152</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  153</span>  <span class="keywordflow">if</span> (mf-&gt;<a class="code hl_variable" href="structgptoss__mapped__file__t.html#a82d6f9794be52794709bc995a27ac557">base</a>) free(mf-&gt;<a class="code hl_variable" href="structgptoss__mapped__file__t.html#a82d6f9794be52794709bc995a27ac557">base</a>);</div>
<div class="line"><span class="lineno">  154</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  155</span> </div>
<div class="line"><span class="lineno">  156</span>  free(mf-&gt;<a class="code hl_variable" href="structgptoss__mapped__file__t.html#ae12a2115e2dff50eb33db5556e828d53">path</a>);</div>
<div class="line"><span class="lineno">  157</span>  memset(mf, 0, <span class="keyword">sizeof</span>(*mf));</div>
<div class="line"><span class="lineno">  158</span>  mf-&gt;<a class="code hl_variable" href="structgptoss__mapped__file__t.html#a535fd2744904c614c9bdddf441984ca4">fd</a> = -1;</div>
<div class="line"><span class="lineno">  159</span>}</div>
<div class="ttc" id="astructgptoss__mapped__file__t_html_a82d6f9794be52794709bc995a27ac557"><div class="ttname"><a href="structgptoss__mapped__file__t.html#a82d6f9794be52794709bc995a27ac557">gptoss_mapped_file_t::base</a></div><div class="ttdeci">void * base</div><div class="ttdoc">Base pointer (mmap or malloc buffer).</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00060">gptoss_weights_index.c:60</a></div></div>
<div class="ttc" id="astructgptoss__mapped__file__t_html_ac0c9d90b334315d80adc5e0d4d131b1c"><div class="ttname"><a href="structgptoss__mapped__file__t.html#ac0c9d90b334315d80adc5e0d4d131b1c">gptoss_mapped_file_t::is_mmap</a></div><div class="ttdeci">int is_mmap</div><div class="ttdoc">Non-zero if base is an mmap mapping.</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00062">gptoss_weights_index.c:62</a></div></div>
<div class="ttc" id="astructgptoss__mapped__file__t_html_ae12a2115e2dff50eb33db5556e828d53"><div class="ttname"><a href="structgptoss__mapped__file__t.html#ae12a2115e2dff50eb33db5556e828d53">gptoss_mapped_file_t::path</a></div><div class="ttdeci">char * path</div><div class="ttdoc">Owned file path string.</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00058">gptoss_weights_index.c:58</a></div></div>
<div class="ttc" id="astructgptoss__mapped__file__t_html_af9e6c58ee54250f1ab602509b247878f"><div class="ttname"><a href="structgptoss__mapped__file__t.html#af9e6c58ee54250f1ab602509b247878f">gptoss_mapped_file_t::size</a></div><div class="ttdeci">size_t size</div><div class="ttdoc">File size in bytes.</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00061">gptoss_weights_index.c:61</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="gptoss__weights__index_8c_source.html#l00060">gptoss_mapped_file_t::base</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00059">gptoss_mapped_file_t::fd</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00062">gptoss_mapped_file_t::is_mmap</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00058">gptoss_mapped_file_t::path</a>, and <a class="el" href="gptoss__weights__index_8c_source.html#l00061">gptoss_mapped_file_t::size</a>.</p>

<p class="reference">Referenced by <a class="el" href="gptoss__weights__index_8c_source.html#l00492">gptoss_weights_index_close()</a>, and <a class="el" href="gptoss__weights__index_8c_source.html#l00201">widx_mapped_open()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8c_a38ec37dc422b167e975773834349ec96_icgraph.svg" width="634" height="102"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ae6ffa18bb461a4aff5f94b8b20f71c93" name="ae6ffa18bb461a4aff5f94b8b20f71c93"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae6ffa18bb461a4aff5f94b8b20f71c93">&#9670;&#160;</a></span>widx_mapped_open()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int widx_mapped_open </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structgptoss__mapped__file__t.html">gptoss_mapped_file_t</a> *&#160;</td>
          <td class="paramname"><em>mf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="gptoss__weights__index_8c_source.html#l00201">201</a> of file <a class="el" href="gptoss__weights__index_8c_source.html">gptoss_weights_index.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  201</span>                                                                        {</div>
<div class="line"><span class="lineno">  202</span>  <span class="keywordflow">if</span> (!mf || !path) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239">IE_IO_ERR_ARGS</a>;</div>
<div class="line"><span class="lineno">  203</span> </div>
<div class="line"><span class="lineno">  204</span>  memset(mf, 0, <span class="keyword">sizeof</span>(*mf));</div>
<div class="line"><span class="lineno">  205</span>  mf-&gt;<a class="code hl_variable" href="structgptoss__mapped__file__t.html#a535fd2744904c614c9bdddf441984ca4">fd</a> = -1;</div>
<div class="line"><span class="lineno">  206</span> </div>
<div class="line"><span class="lineno">  207</span>  mf-&gt;<a class="code hl_variable" href="structgptoss__mapped__file__t.html#ae12a2115e2dff50eb33db5556e828d53">path</a> = <a class="code hl_function" href="gptoss__weights__index_8c.html#a4cecf742f93bcd606826e7418359123b">widx_strdup</a>(path);</div>
<div class="line"><span class="lineno">  208</span>  <span class="keywordflow">if</span> (!mf-&gt;<a class="code hl_variable" href="structgptoss__mapped__file__t.html#ae12a2115e2dff50eb33db5556e828d53">path</a>) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a4effb7bf4fea909987b433ca4cf26380">IE_IO_ERR_OOM</a>;</div>
<div class="line"><span class="lineno">  209</span> </div>
<div class="line"><span class="lineno">  210</span><span class="preprocessor">#if defined(__unix__) || defined(__APPLE__)</span></div>
<div class="line"><span class="lineno">  211</span>  mf-&gt;<a class="code hl_variable" href="structgptoss__mapped__file__t.html#a535fd2744904c614c9bdddf441984ca4">fd</a> = open(path, O_RDONLY);</div>
<div class="line"><span class="lineno">  212</span>  <span class="keywordflow">if</span> (mf-&gt;<a class="code hl_variable" href="structgptoss__mapped__file__t.html#a535fd2744904c614c9bdddf441984ca4">fd</a> &lt; 0) {</div>
<div class="line"><span class="lineno">  213</span>    <a class="code hl_function" href="gptoss__weights__index_8c.html#a38ec37dc422b167e975773834349ec96">widx_mapped_close</a>(mf);</div>
<div class="line"><span class="lineno">  214</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aba0321da4352c7a61ea1bda842bb64d0">IE_IO_ERR_OPEN</a>;</div>
<div class="line"><span class="lineno">  215</span>  }</div>
<div class="line"><span class="lineno">  216</span> </div>
<div class="line"><span class="lineno">  217</span>  <span class="keyword">struct </span>stat st;</div>
<div class="line"><span class="lineno">  218</span>  <span class="keywordflow">if</span> (fstat(mf-&gt;<a class="code hl_variable" href="structgptoss__mapped__file__t.html#a535fd2744904c614c9bdddf441984ca4">fd</a>, &amp;st) != 0) {</div>
<div class="line"><span class="lineno">  219</span>    <a class="code hl_function" href="gptoss__weights__index_8c.html#a38ec37dc422b167e975773834349ec96">widx_mapped_close</a>(mf);</div>
<div class="line"><span class="lineno">  220</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a82517853bf5084320fad8c88f67d29bb">IE_IO_ERR_STAT</a>;</div>
<div class="line"><span class="lineno">  221</span>  }</div>
<div class="line"><span class="lineno">  222</span> </div>
<div class="line"><span class="lineno">  223</span>  <span class="keywordflow">if</span> (st.st_size &lt;= 0) {</div>
<div class="line"><span class="lineno">  224</span>    <a class="code hl_function" href="gptoss__weights__index_8c.html#a38ec37dc422b167e975773834349ec96">widx_mapped_close</a>(mf);</div>
<div class="line"><span class="lineno">  225</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a82517853bf5084320fad8c88f67d29bb">IE_IO_ERR_STAT</a>;</div>
<div class="line"><span class="lineno">  226</span>  }</div>
<div class="line"><span class="lineno">  227</span> </div>
<div class="line"><span class="lineno">  228</span>  mf-&gt;<a class="code hl_variable" href="structgptoss__mapped__file__t.html#af9e6c58ee54250f1ab602509b247878f">size</a> = (size_t)st.st_size;</div>
<div class="line"><span class="lineno">  229</span> </div>
<div class="line"><span class="lineno">  230</span>  <span class="keywordtype">void</span> *base = mmap(NULL, mf-&gt;<a class="code hl_variable" href="structgptoss__mapped__file__t.html#af9e6c58ee54250f1ab602509b247878f">size</a>, PROT_READ, MAP_PRIVATE, mf-&gt;<a class="code hl_variable" href="structgptoss__mapped__file__t.html#a535fd2744904c614c9bdddf441984ca4">fd</a>, 0);</div>
<div class="line"><span class="lineno">  231</span>  <span class="keywordflow">if</span> (base == MAP_FAILED) {</div>
<div class="line"><span class="lineno">  232</span>    mf-&gt;<a class="code hl_variable" href="structgptoss__mapped__file__t.html#a82d6f9794be52794709bc995a27ac557">base</a> = NULL;</div>
<div class="line"><span class="lineno">  233</span>    mf-&gt;<a class="code hl_variable" href="structgptoss__mapped__file__t.html#af9e6c58ee54250f1ab602509b247878f">size</a> = 0;</div>
<div class="line"><span class="lineno">  234</span>    mf-&gt;<a class="code hl_variable" href="structgptoss__mapped__file__t.html#ac0c9d90b334315d80adc5e0d4d131b1c">is_mmap</a> = 0;</div>
<div class="line"><span class="lineno">  235</span> </div>
<div class="line"><span class="lineno">  236</span>    <span class="keywordtype">void</span> *buf = NULL;</div>
<div class="line"><span class="lineno">  237</span>    <span class="keywordtype">size_t</span> n = 0;</div>
<div class="line"><span class="lineno">  238</span>    <span class="keywordtype">int</span> rc = <a class="code hl_function" href="gptoss__weights__index_8c.html#a5db73cd3715cba3c5bae4378335cf0d5">widx_read_all</a>(path, &amp;buf, &amp;n);</div>
<div class="line"><span class="lineno">  239</span>    <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>) {</div>
<div class="line"><span class="lineno">  240</span>      <a class="code hl_function" href="gptoss__weights__index_8c.html#a38ec37dc422b167e975773834349ec96">widx_mapped_close</a>(mf);</div>
<div class="line"><span class="lineno">  241</span>      <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  242</span>    }</div>
<div class="line"><span class="lineno">  243</span> </div>
<div class="line"><span class="lineno">  244</span>    mf-&gt;<a class="code hl_variable" href="structgptoss__mapped__file__t.html#a82d6f9794be52794709bc995a27ac557">base</a> = buf;</div>
<div class="line"><span class="lineno">  245</span>    mf-&gt;<a class="code hl_variable" href="structgptoss__mapped__file__t.html#af9e6c58ee54250f1ab602509b247878f">size</a> = n;</div>
<div class="line"><span class="lineno">  246</span>    mf-&gt;<a class="code hl_variable" href="structgptoss__mapped__file__t.html#ac0c9d90b334315d80adc5e0d4d131b1c">is_mmap</a> = 0;</div>
<div class="line"><span class="lineno">  247</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>;</div>
<div class="line"><span class="lineno">  248</span>  }</div>
<div class="line"><span class="lineno">  249</span> </div>
<div class="line"><span class="lineno">  250</span>  mf-&gt;<a class="code hl_variable" href="structgptoss__mapped__file__t.html#a82d6f9794be52794709bc995a27ac557">base</a> = base;</div>
<div class="line"><span class="lineno">  251</span>  mf-&gt;<a class="code hl_variable" href="structgptoss__mapped__file__t.html#ac0c9d90b334315d80adc5e0d4d131b1c">is_mmap</a> = 1;</div>
<div class="line"><span class="lineno">  252</span>  <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>;</div>
<div class="line"><span class="lineno">  253</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  254</span>  <span class="keywordtype">void</span> *buf = NULL;</div>
<div class="line"><span class="lineno">  255</span>  <span class="keywordtype">size_t</span> n = 0;</div>
<div class="line"><span class="lineno">  256</span>  <span class="keywordtype">int</span> rc = <a class="code hl_function" href="gptoss__weights__index_8c.html#a5db73cd3715cba3c5bae4378335cf0d5">widx_read_all</a>(path, &amp;buf, &amp;n);</div>
<div class="line"><span class="lineno">  257</span>  <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>) {</div>
<div class="line"><span class="lineno">  258</span>    <a class="code hl_function" href="gptoss__weights__index_8c.html#a38ec37dc422b167e975773834349ec96">widx_mapped_close</a>(mf);</div>
<div class="line"><span class="lineno">  259</span>    <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  260</span>  }</div>
<div class="line"><span class="lineno">  261</span> </div>
<div class="line"><span class="lineno">  262</span>  mf-&gt;<a class="code hl_variable" href="structgptoss__mapped__file__t.html#a82d6f9794be52794709bc995a27ac557">base</a> = buf;</div>
<div class="line"><span class="lineno">  263</span>  mf-&gt;<a class="code hl_variable" href="structgptoss__mapped__file__t.html#af9e6c58ee54250f1ab602509b247878f">size</a> = n;</div>
<div class="line"><span class="lineno">  264</span>  mf-&gt;<a class="code hl_variable" href="structgptoss__mapped__file__t.html#ac0c9d90b334315d80adc5e0d4d131b1c">is_mmap</a> = 0;</div>
<div class="line"><span class="lineno">  265</span>  <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>;</div>
<div class="line"><span class="lineno">  266</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  267</span>}</div>
<div class="ttc" id="agptoss__weights__index_8c_html_a4cecf742f93bcd606826e7418359123b"><div class="ttname"><a href="gptoss__weights__index_8c.html#a4cecf742f93bcd606826e7418359123b">widx_strdup</a></div><div class="ttdeci">static char * widx_strdup(const char *s)</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00103">gptoss_weights_index.c:103</a></div></div>
<div class="ttc" id="agptoss__weights__index_8c_html_a5db73cd3715cba3c5bae4378335cf0d5"><div class="ttname"><a href="gptoss__weights__index_8c.html#a5db73cd3715cba3c5bae4378335cf0d5">widx_read_all</a></div><div class="ttdeci">static int widx_read_all(const char *path, void **out_base, size_t *out_size)</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00161">gptoss_weights_index.c:161</a></div></div>
<div class="ttc" id="aie__io_8h_html_a4c501870bd45dbe373416745a03de987a82517853bf5084320fad8c88f67d29bb"><div class="ttname"><a href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a82517853bf5084320fad8c88f67d29bb">IE_IO_ERR_STAT</a></div><div class="ttdeci">@ IE_IO_ERR_STAT</div><div class="ttdoc">stat(2) failure or invalid file metadata.</div><div class="ttdef"><b>Definition</b> <a href="ie__io_8h_source.html#l00068">ie_io.h:68</a></div></div>
<div class="ttc" id="aie__io_8h_html_a4c501870bd45dbe373416745a03de987aba0321da4352c7a61ea1bda842bb64d0"><div class="ttname"><a href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aba0321da4352c7a61ea1bda842bb64d0">IE_IO_ERR_OPEN</a></div><div class="ttdeci">@ IE_IO_ERR_OPEN</div><div class="ttdoc">open(2) failure.</div><div class="ttdef"><b>Definition</b> <a href="ie__io_8h_source.html#l00069">ie_io.h:69</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="gptoss__weights__index_8c_source.html#l00060">gptoss_mapped_file_t::base</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00059">gptoss_mapped_file_t::fd</a>, <a class="el" href="ie__io_8h_source.html#l00065">IE_IO_ERR_ARGS</a>, <a class="el" href="ie__io_8h_source.html#l00072">IE_IO_ERR_OOM</a>, <a class="el" href="ie__io_8h_source.html#l00069">IE_IO_ERR_OPEN</a>, <a class="el" href="ie__io_8h_source.html#l00068">IE_IO_ERR_STAT</a>, <a class="el" href="ie__io_8h_source.html#l00064">IE_IO_OK</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00062">gptoss_mapped_file_t::is_mmap</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00058">gptoss_mapped_file_t::path</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00061">gptoss_mapped_file_t::size</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00139">widx_mapped_close()</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00161">widx_read_all()</a>, and <a class="el" href="gptoss__weights__index_8c_source.html#l00103">widx_strdup()</a>.</p>

<p class="reference">Referenced by <a class="el" href="gptoss__weights__index_8c_source.html#l00417">gptoss_weights_index_open()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8c_ae6ffa18bb461a4aff5f94b8b20f71c93_cgraph.svg" width="366" height="135"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8c_ae6ffa18bb461a4aff5f94b8b20f71c93_icgraph.svg" width="416" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a4a56b6936dd1f3d8668251a331151a96" name="a4a56b6936dd1f3d8668251a331151a96"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4a56b6936dd1f3d8668251a331151a96">&#9670;&#160;</a></span>widx_path_join()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int widx_path_join </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>dst_n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>model_dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>leaf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="gptoss__weights__index_8c_source.html#l00113">113</a> of file <a class="el" href="gptoss__weights__index_8c_source.html">gptoss_weights_index.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  113</span>                                                                                            {</div>
<div class="line"><span class="lineno">  114</span>  <span class="keywordflow">if</span> (!dst || dst_n == 0 || !model_dir || !leaf) <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  115</span> </div>
<div class="line"><span class="lineno">  116</span>  <span class="keywordtype">size_t</span> a = strlen(model_dir);</div>
<div class="line"><span class="lineno">  117</span>  <span class="keywordtype">size_t</span> b = strlen(leaf);</div>
<div class="line"><span class="lineno">  118</span>  <span class="keyword">const</span> <span class="keywordtype">int</span> need_slash = (a &gt; 0 &amp;&amp; model_dir[a - 1] != <span class="charliteral">&#39;/&#39;</span>);</div>
<div class="line"><span class="lineno">  119</span> </div>
<div class="line"><span class="lineno">  120</span>  <span class="keywordtype">size_t</span> need = a + (need_slash ? 1u : 0u) + b + 1u;</div>
<div class="line"><span class="lineno">  121</span>  <span class="keywordflow">if</span> (need &gt; dst_n) <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  122</span> </div>
<div class="line"><span class="lineno">  123</span>  memcpy(dst, model_dir, a);</div>
<div class="line"><span class="lineno">  124</span>  <span class="keywordflow">if</span> (need_slash) {</div>
<div class="line"><span class="lineno">  125</span>    <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a415d14a7ade776b6bb2e544f0be25e6b">dst</a>[a] = <span class="charliteral">&#39;/&#39;</span>;</div>
<div class="line"><span class="lineno">  126</span>    memcpy(dst + a + 1u, leaf, b);</div>
<div class="line"><span class="lineno">  127</span>    <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a415d14a7ade776b6bb2e544f0be25e6b">dst</a>[a + 1u + b] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  128</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  129</span>    memcpy(dst + a, leaf, b);</div>
<div class="line"><span class="lineno">  130</span>    <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a415d14a7ade776b6bb2e544f0be25e6b">dst</a>[a + b] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  131</span>  }</div>
<div class="line"><span class="lineno">  132</span>  <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  133</span>}</div>
<div class="ttc" id="anamespaceconvert__dtypes__to__numeric_html_a415d14a7ade776b6bb2e544f0be25e6b"><div class="ttname"><a href="namespaceconvert__dtypes__to__numeric.html#a415d14a7ade776b6bb2e544f0be25e6b">convert_dtypes_to_numeric.dst</a></div><div class="ttdeci">dst</div><div class="ttdef"><b>Definition</b> <a href="convert__dtypes__to__numeric_8py_source.html#l00027">convert_dtypes_to_numeric.py:27</a></div></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="gptoss__weights__index_8c_source.html#l00417">gptoss_weights_index_open()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8c_a4a56b6936dd1f3d8668251a331151a96_icgraph.svg" width="384" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a5db73cd3715cba3c5bae4378335cf0d5" name="a5db73cd3715cba3c5bae4378335cf0d5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5db73cd3715cba3c5bae4378335cf0d5">&#9670;&#160;</a></span>widx_read_all()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int widx_read_all </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void **&#160;</td>
          <td class="paramname"><em>out_base</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>out_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="gptoss__weights__index_8c_source.html#l00161">161</a> of file <a class="el" href="gptoss__weights__index_8c_source.html">gptoss_weights_index.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  161</span>                                                                              {</div>
<div class="line"><span class="lineno">  162</span>  <span class="keywordflow">if</span> (!path || !out_base || !out_size) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239">IE_IO_ERR_ARGS</a>;</div>
<div class="line"><span class="lineno">  163</span> </div>
<div class="line"><span class="lineno">  164</span>  FILE *f = fopen(path, <span class="stringliteral">&quot;rb&quot;</span>);</div>
<div class="line"><span class="lineno">  165</span>  <span class="keywordflow">if</span> (!f) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aba0321da4352c7a61ea1bda842bb64d0">IE_IO_ERR_OPEN</a>;</div>
<div class="line"><span class="lineno">  166</span> </div>
<div class="line"><span class="lineno">  167</span>  <span class="keywordflow">if</span> (fseek(f, 0, SEEK_END) != 0) {</div>
<div class="line"><span class="lineno">  168</span>    fclose(f);</div>
<div class="line"><span class="lineno">  169</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a82517853bf5084320fad8c88f67d29bb">IE_IO_ERR_STAT</a>;</div>
<div class="line"><span class="lineno">  170</span>  }</div>
<div class="line"><span class="lineno">  171</span> </div>
<div class="line"><span class="lineno">  172</span>  <span class="keywordtype">long</span> n = ftell(f);</div>
<div class="line"><span class="lineno">  173</span>  <span class="keywordflow">if</span> (n &lt; 0) {</div>
<div class="line"><span class="lineno">  174</span>    fclose(f);</div>
<div class="line"><span class="lineno">  175</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a82517853bf5084320fad8c88f67d29bb">IE_IO_ERR_STAT</a>;</div>
<div class="line"><span class="lineno">  176</span>  }</div>
<div class="line"><span class="lineno">  177</span>  <span class="keywordflow">if</span> (fseek(f, 0, SEEK_SET) != 0) {</div>
<div class="line"><span class="lineno">  178</span>    fclose(f);</div>
<div class="line"><span class="lineno">  179</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a82517853bf5084320fad8c88f67d29bb">IE_IO_ERR_STAT</a>;</div>
<div class="line"><span class="lineno">  180</span>  }</div>
<div class="line"><span class="lineno">  181</span> </div>
<div class="line"><span class="lineno">  182</span>  <span class="keywordtype">void</span> *buf = malloc((<span class="keywordtype">size_t</span>)n);</div>
<div class="line"><span class="lineno">  183</span>  <span class="keywordflow">if</span> (!buf) {</div>
<div class="line"><span class="lineno">  184</span>    fclose(f);</div>
<div class="line"><span class="lineno">  185</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a4effb7bf4fea909987b433ca4cf26380">IE_IO_ERR_OOM</a>;</div>
<div class="line"><span class="lineno">  186</span>  }</div>
<div class="line"><span class="lineno">  187</span> </div>
<div class="line"><span class="lineno">  188</span>  <span class="keywordtype">size_t</span> got = fread(buf, 1, (<span class="keywordtype">size_t</span>)n, f);</div>
<div class="line"><span class="lineno">  189</span>  fclose(f);</div>
<div class="line"><span class="lineno">  190</span> </div>
<div class="line"><span class="lineno">  191</span>  <span class="keywordflow">if</span> (got != (<span class="keywordtype">size_t</span>)n) {</div>
<div class="line"><span class="lineno">  192</span>    free(buf);</div>
<div class="line"><span class="lineno">  193</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aa12fce48fd3eee2bd8a75dc61db150a7">IE_IO_ERR_READ</a>;</div>
<div class="line"><span class="lineno">  194</span>  }</div>
<div class="line"><span class="lineno">  195</span> </div>
<div class="line"><span class="lineno">  196</span>  *out_base = buf;</div>
<div class="line"><span class="lineno">  197</span>  *out_size = (size_t)n;</div>
<div class="line"><span class="lineno">  198</span>  <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>;</div>
<div class="line"><span class="lineno">  199</span>}</div>
<div class="ttc" id="aie__io_8h_html_a4c501870bd45dbe373416745a03de987aa12fce48fd3eee2bd8a75dc61db150a7"><div class="ttname"><a href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aa12fce48fd3eee2bd8a75dc61db150a7">IE_IO_ERR_READ</a></div><div class="ttdeci">@ IE_IO_ERR_READ</div><div class="ttdoc">read(2) failure or short read.</div><div class="ttdef"><b>Definition</b> <a href="ie__io_8h_source.html#l00070">ie_io.h:70</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ie__io_8h_source.html#l00065">IE_IO_ERR_ARGS</a>, <a class="el" href="ie__io_8h_source.html#l00072">IE_IO_ERR_OOM</a>, <a class="el" href="ie__io_8h_source.html#l00069">IE_IO_ERR_OPEN</a>, <a class="el" href="ie__io_8h_source.html#l00070">IE_IO_ERR_READ</a>, <a class="el" href="ie__io_8h_source.html#l00068">IE_IO_ERR_STAT</a>, and <a class="el" href="ie__io_8h_source.html#l00064">IE_IO_OK</a>.</p>

<p class="reference">Referenced by <a class="el" href="gptoss__weights__index_8c_source.html#l00201">widx_mapped_open()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8c_a5db73cd3715cba3c5bae4378335cf0d5_icgraph.svg" width="576" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a59ea306bea1c9226c31583a49f2e7ffd" name="a59ea306bea1c9226c31583a49f2e7ffd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a59ea306bea1c9226c31583a49f2e7ffd">&#9670;&#160;</a></span>widx_resolve_layer_llama()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int widx_resolve_layer_llama </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structgptoss__weights__index__t.html">gptoss_weights_index_t</a> *&#160;</td>
          <td class="paramname"><em>idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>layer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fused_qkv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>swiglu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structgptoss__layer__weights__t.html">gptoss_layer_weights_t</a> *&#160;</td>
          <td class="paramname"><em>out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="gptoss__weights__index_8c_source.html#l00575">575</a> of file <a class="el" href="gptoss__weights__index_8c_source.html">gptoss_weights_index.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  579</span>                                                                {</div>
<div class="line"><span class="lineno">  580</span>  <span class="keywordflow">if</span> (!idx || !out) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239">IE_IO_ERR_ARGS</a>;</div>
<div class="line"><span class="lineno">  581</span>  memset(out, 0, <span class="keyword">sizeof</span>(*out));</div>
<div class="line"><span class="lineno">  582</span> </div>
<div class="line"><span class="lineno">  583</span>  <span class="keywordtype">char</span> name[256];</div>
<div class="line"><span class="lineno">  584</span> </div>
<div class="line"><span class="lineno">  585</span>  {</div>
<div class="line"><span class="lineno">  586</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structtensor__desc__s.html">tensor_desc_t</a> *d = NULL;</div>
<div class="line"><span class="lineno">  587</span> </div>
<div class="line"><span class="lineno">  588</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="gptoss__weights__index_8c.html#a0c207c648c00b914718b2dd50416829e">widx_fmt_layer</a>(name, <span class="keyword">sizeof</span>(name), <span class="stringliteral">&quot;model.layers.%u.input_layernorm.weight&quot;</span>, layer) == 0) {</div>
<div class="line"><span class="lineno">  589</span>      d = <a class="code hl_function" href="tensor__map_8h.html#abe58b80593931ffe5844ee4bcee805c5">tensor_map_find</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, name);</div>
<div class="line"><span class="lineno">  590</span>    }</div>
<div class="line"><span class="lineno">  591</span>    <span class="keywordflow">if</span> (!d &amp;&amp; <a class="code hl_function" href="gptoss__weights__index_8c.html#a0c207c648c00b914718b2dd50416829e">widx_fmt_layer</a>(name, <span class="keyword">sizeof</span>(name), <span class="stringliteral">&quot;model.layers.%u.attn_norm.weight&quot;</span>, layer) == 0) {</div>
<div class="line"><span class="lineno">  592</span>      d = <a class="code hl_function" href="tensor__map_8h.html#abe58b80593931ffe5844ee4bcee805c5">tensor_map_find</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, name);</div>
<div class="line"><span class="lineno">  593</span>    }</div>
<div class="line"><span class="lineno">  594</span>    <span class="keywordflow">if</span> (!d &amp;&amp; <a class="code hl_function" href="gptoss__weights__index_8c.html#a0c207c648c00b914718b2dd50416829e">widx_fmt_layer</a>(name, <span class="keyword">sizeof</span>(name), <span class="stringliteral">&quot;model.layers.%u.attn.norm.scale&quot;</span>, layer) == 0) {</div>
<div class="line"><span class="lineno">  595</span>      d = <a class="code hl_function" href="tensor__map_8h.html#abe58b80593931ffe5844ee4bcee805c5">tensor_map_find</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, name);</div>
<div class="line"><span class="lineno">  596</span>    }</div>
<div class="line"><span class="lineno">  597</span> </div>
<div class="line"><span class="lineno">  598</span>    <span class="keywordflow">if</span> (!d) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9">IE_IO_ERR_JSON</a>;</div>
<div class="line"><span class="lineno">  599</span>    {</div>
<div class="line"><span class="lineno">  600</span>      <span class="keywordtype">int</span> rc = <a class="code hl_function" href="gptoss__weights__index_8c.html#a51589195af626cbd25188a2f1d138f24">widx_tensor_from_desc</a>(idx, d, &amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;attn_norm_w);</div>
<div class="line"><span class="lineno">  601</span>      <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>) <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  602</span>    }</div>
<div class="line"><span class="lineno">  603</span>  }</div>
<div class="line"><span class="lineno">  604</span> </div>
<div class="line"><span class="lineno">  605</span>  {</div>
<div class="line"><span class="lineno">  606</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structtensor__desc__s.html">tensor_desc_t</a> *d = NULL;</div>
<div class="line"><span class="lineno">  607</span> </div>
<div class="line"><span class="lineno">  608</span>    <span class="keywordflow">if</span> (<a class="code hl_function" href="gptoss__weights__index_8c.html#a0c207c648c00b914718b2dd50416829e">widx_fmt_layer</a>(name, <span class="keyword">sizeof</span>(name), <span class="stringliteral">&quot;model.layers.%u.post_attention_layernorm.weight&quot;</span>, layer) == 0) {</div>
<div class="line"><span class="lineno">  609</span>      d = <a class="code hl_function" href="tensor__map_8h.html#abe58b80593931ffe5844ee4bcee805c5">tensor_map_find</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, name);</div>
<div class="line"><span class="lineno">  610</span>    }</div>
<div class="line"><span class="lineno">  611</span>    <span class="keywordflow">if</span> (!d &amp;&amp; <a class="code hl_function" href="gptoss__weights__index_8c.html#a0c207c648c00b914718b2dd50416829e">widx_fmt_layer</a>(name, <span class="keyword">sizeof</span>(name), <span class="stringliteral">&quot;model.layers.%u.mlp_norm.weight&quot;</span>, layer) == 0) {</div>
<div class="line"><span class="lineno">  612</span>      d = <a class="code hl_function" href="tensor__map_8h.html#abe58b80593931ffe5844ee4bcee805c5">tensor_map_find</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, name);</div>
<div class="line"><span class="lineno">  613</span>    }</div>
<div class="line"><span class="lineno">  614</span>    <span class="keywordflow">if</span> (!d &amp;&amp; <a class="code hl_function" href="gptoss__weights__index_8c.html#a0c207c648c00b914718b2dd50416829e">widx_fmt_layer</a>(name, <span class="keyword">sizeof</span>(name), <span class="stringliteral">&quot;model.layers.%u.mlp.norm.scale&quot;</span>, layer) == 0) {</div>
<div class="line"><span class="lineno">  615</span>      d = <a class="code hl_function" href="tensor__map_8h.html#abe58b80593931ffe5844ee4bcee805c5">tensor_map_find</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, name);</div>
<div class="line"><span class="lineno">  616</span>    }</div>
<div class="line"><span class="lineno">  617</span> </div>
<div class="line"><span class="lineno">  618</span>    <span class="keywordflow">if</span> (!d) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9">IE_IO_ERR_JSON</a>;</div>
<div class="line"><span class="lineno">  619</span>    {</div>
<div class="line"><span class="lineno">  620</span>      <span class="keywordtype">int</span> rc = <a class="code hl_function" href="gptoss__weights__index_8c.html#a51589195af626cbd25188a2f1d138f24">widx_tensor_from_desc</a>(idx, d, &amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;mlp_norm_w);</div>
<div class="line"><span class="lineno">  621</span>      <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>) <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  622</span>    }</div>
<div class="line"><span class="lineno">  623</span>  }</div>
<div class="line"><span class="lineno">  624</span> </div>
<div class="line"><span class="lineno">  625</span>  <span class="keywordflow">if</span> (fused_qkv) {</div>
<div class="line"><span class="lineno">  626</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structtensor__desc__s.html">tensor_desc_t</a> *d = NULL;</div>
<div class="line"><span class="lineno">  627</span> </div>
<div class="line"><span class="lineno">  628</span>    <span class="keywordflow">if</span> (!d &amp;&amp; <a class="code hl_function" href="gptoss__weights__index_8c.html#a0c207c648c00b914718b2dd50416829e">widx_fmt_layer</a>(name, <span class="keyword">sizeof</span>(name), <span class="stringliteral">&quot;model.layers.%u.self_attn.qkv_proj.weight&quot;</span>, layer) == 0) {</div>
<div class="line"><span class="lineno">  629</span>      d = <a class="code hl_function" href="tensor__map_8h.html#abe58b80593931ffe5844ee4bcee805c5">tensor_map_find</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, name);</div>
<div class="line"><span class="lineno">  630</span>    }</div>
<div class="line"><span class="lineno">  631</span>    <span class="keywordflow">if</span> (!d &amp;&amp; <a class="code hl_function" href="gptoss__weights__index_8c.html#a0c207c648c00b914718b2dd50416829e">widx_fmt_layer</a>(name, <span class="keyword">sizeof</span>(name), <span class="stringliteral">&quot;model.layers.%u.self_attn.qkv.weight&quot;</span>, layer) == 0) {</div>
<div class="line"><span class="lineno">  632</span>      d = <a class="code hl_function" href="tensor__map_8h.html#abe58b80593931ffe5844ee4bcee805c5">tensor_map_find</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, name);</div>
<div class="line"><span class="lineno">  633</span>    }</div>
<div class="line"><span class="lineno">  634</span>    <span class="keywordflow">if</span> (!d &amp;&amp; <a class="code hl_function" href="gptoss__weights__index_8c.html#a0c207c648c00b914718b2dd50416829e">widx_fmt_layer</a>(name, <span class="keyword">sizeof</span>(name), <span class="stringliteral">&quot;model.layers.%u.attn.qkv_proj.weight&quot;</span>, layer) == 0) {</div>
<div class="line"><span class="lineno">  635</span>      d = <a class="code hl_function" href="tensor__map_8h.html#abe58b80593931ffe5844ee4bcee805c5">tensor_map_find</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, name);</div>
<div class="line"><span class="lineno">  636</span>    }</div>
<div class="line"><span class="lineno">  637</span>    <span class="keywordflow">if</span> (!d &amp;&amp; <a class="code hl_function" href="gptoss__weights__index_8c.html#a0c207c648c00b914718b2dd50416829e">widx_fmt_layer</a>(name, <span class="keyword">sizeof</span>(name), <span class="stringliteral">&quot;model.layers.%u.attn.qkv.weight&quot;</span>, layer) == 0) {</div>
<div class="line"><span class="lineno">  638</span>      d = <a class="code hl_function" href="tensor__map_8h.html#abe58b80593931ffe5844ee4bcee805c5">tensor_map_find</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, name);</div>
<div class="line"><span class="lineno">  639</span>    }</div>
<div class="line"><span class="lineno">  640</span> </div>
<div class="line"><span class="lineno">  641</span>    <span class="keywordflow">if</span> (!d) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9">IE_IO_ERR_JSON</a>;</div>
<div class="line"><span class="lineno">  642</span> </div>
<div class="line"><span class="lineno">  643</span>    {</div>
<div class="line"><span class="lineno">  644</span>      <span class="keywordtype">int</span> rc = <a class="code hl_function" href="gptoss__weights__index_8c.html#a51589195af626cbd25188a2f1d138f24">widx_tensor_from_desc</a>(idx, d, &amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;qkv_proj_w);</div>
<div class="line"><span class="lineno">  645</span>      <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>) <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  646</span>    }</div>
<div class="line"><span class="lineno">  647</span> </div>
<div class="line"><span class="lineno">  648</span>    <a class="code hl_function" href="gptoss__weights__index_8c.html#a35d07ed424f1010db24d2b69d7ee7bd6">widx_tensor_reset</a>(&amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;q_proj_w);</div>
<div class="line"><span class="lineno">  649</span>    <a class="code hl_function" href="gptoss__weights__index_8c.html#a35d07ed424f1010db24d2b69d7ee7bd6">widx_tensor_reset</a>(&amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;k_proj_w);</div>
<div class="line"><span class="lineno">  650</span>    <a class="code hl_function" href="gptoss__weights__index_8c.html#a35d07ed424f1010db24d2b69d7ee7bd6">widx_tensor_reset</a>(&amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;v_proj_w);</div>
<div class="line"><span class="lineno">  651</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  652</span>    <a class="code hl_struct" href="structgptoss__tensor__t.html">gptoss_tensor_t</a> *dsts[] = { &amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;q_proj_w, &amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;k_proj_w, &amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;v_proj_w };</div>
<div class="line"><span class="lineno">  653</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *fmts[] = {</div>
<div class="line"><span class="lineno">  654</span>      <span class="stringliteral">&quot;model.layers.%u.self_attn.q_proj.weight&quot;</span>,</div>
<div class="line"><span class="lineno">  655</span>      <span class="stringliteral">&quot;model.layers.%u.self_attn.k_proj.weight&quot;</span>,</div>
<div class="line"><span class="lineno">  656</span>      <span class="stringliteral">&quot;model.layers.%u.self_attn.v_proj.weight&quot;</span></div>
<div class="line"><span class="lineno">  657</span>    };</div>
<div class="line"><span class="lineno">  658</span> </div>
<div class="line"><span class="lineno">  659</span>    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; ++i) {</div>
<div class="line"><span class="lineno">  660</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="gptoss__weights__index_8c.html#a0c207c648c00b914718b2dd50416829e">widx_fmt_layer</a>(name, <span class="keyword">sizeof</span>(name), fmts[i], layer) != 0) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239">IE_IO_ERR_ARGS</a>;</div>
<div class="line"><span class="lineno">  661</span> </div>
<div class="line"><span class="lineno">  662</span>      <span class="keyword">const</span> <a class="code hl_struct" href="structtensor__desc__s.html">tensor_desc_t</a> *d = <a class="code hl_function" href="tensor__map_8h.html#abe58b80593931ffe5844ee4bcee805c5">tensor_map_find</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, name);</div>
<div class="line"><span class="lineno">  663</span>      <span class="keywordflow">if</span> (!d) {</div>
<div class="line"><span class="lineno">  664</span>        <span class="keyword">const</span> <span class="keywordtype">char</span> *fmt2 = NULL;</div>
<div class="line"><span class="lineno">  665</span>        <span class="keywordflow">if</span> (i == 0) fmt2 = <span class="stringliteral">&quot;model.layers.%u.attn.q_proj.weight&quot;</span>;</div>
<div class="line"><span class="lineno">  666</span>        <span class="keywordflow">if</span> (i == 1) fmt2 = <span class="stringliteral">&quot;model.layers.%u.attn.k_proj.weight&quot;</span>;</div>
<div class="line"><span class="lineno">  667</span>        <span class="keywordflow">if</span> (i == 2) fmt2 = <span class="stringliteral">&quot;model.layers.%u.attn.v_proj.weight&quot;</span>;</div>
<div class="line"><span class="lineno">  668</span> </div>
<div class="line"><span class="lineno">  669</span>        <span class="keywordflow">if</span> (fmt2 &amp;&amp; <a class="code hl_function" href="gptoss__weights__index_8c.html#a0c207c648c00b914718b2dd50416829e">widx_fmt_layer</a>(name, <span class="keyword">sizeof</span>(name), fmt2, layer) != 0) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239">IE_IO_ERR_ARGS</a>;</div>
<div class="line"><span class="lineno">  670</span>        d = fmt2 ? <a class="code hl_function" href="tensor__map_8h.html#abe58b80593931ffe5844ee4bcee805c5">tensor_map_find</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, name) : NULL;</div>
<div class="line"><span class="lineno">  671</span>      }</div>
<div class="line"><span class="lineno">  672</span> </div>
<div class="line"><span class="lineno">  673</span>      <span class="keywordflow">if</span> (!d) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9">IE_IO_ERR_JSON</a>;</div>
<div class="line"><span class="lineno">  674</span> </div>
<div class="line"><span class="lineno">  675</span>      {</div>
<div class="line"><span class="lineno">  676</span>        <span class="keywordtype">int</span> rc = <a class="code hl_function" href="gptoss__weights__index_8c.html#a51589195af626cbd25188a2f1d138f24">widx_tensor_from_desc</a>(idx, d, dsts[i]);</div>
<div class="line"><span class="lineno">  677</span>        <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>) <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  678</span>      }</div>
<div class="line"><span class="lineno">  679</span>    }</div>
<div class="line"><span class="lineno">  680</span> </div>
<div class="line"><span class="lineno">  681</span>    <a class="code hl_function" href="gptoss__weights__index_8c.html#a35d07ed424f1010db24d2b69d7ee7bd6">widx_tensor_reset</a>(&amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;qkv_proj_w);</div>
<div class="line"><span class="lineno">  682</span>  }</div>
<div class="line"><span class="lineno">  683</span> </div>
<div class="line"><span class="lineno">  684</span>  {</div>
<div class="line"><span class="lineno">  685</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structtensor__desc__s.html">tensor_desc_t</a> *d = NULL;</div>
<div class="line"><span class="lineno">  686</span> </div>
<div class="line"><span class="lineno">  687</span>    <span class="keywordflow">if</span> (!d &amp;&amp; <a class="code hl_function" href="gptoss__weights__index_8c.html#a0c207c648c00b914718b2dd50416829e">widx_fmt_layer</a>(name, <span class="keyword">sizeof</span>(name), <span class="stringliteral">&quot;model.layers.%u.self_attn.o_proj.weight&quot;</span>, layer) == 0) {</div>
<div class="line"><span class="lineno">  688</span>      d = <a class="code hl_function" href="tensor__map_8h.html#abe58b80593931ffe5844ee4bcee805c5">tensor_map_find</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, name);</div>
<div class="line"><span class="lineno">  689</span>    }</div>
<div class="line"><span class="lineno">  690</span>    <span class="keywordflow">if</span> (!d &amp;&amp; <a class="code hl_function" href="gptoss__weights__index_8c.html#a0c207c648c00b914718b2dd50416829e">widx_fmt_layer</a>(name, <span class="keyword">sizeof</span>(name), <span class="stringliteral">&quot;model.layers.%u.attn.o_proj.weight&quot;</span>, layer) == 0) {</div>
<div class="line"><span class="lineno">  691</span>      d = <a class="code hl_function" href="tensor__map_8h.html#abe58b80593931ffe5844ee4bcee805c5">tensor_map_find</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, name);</div>
<div class="line"><span class="lineno">  692</span>    }</div>
<div class="line"><span class="lineno">  693</span>    <span class="keywordflow">if</span> (!d &amp;&amp; <a class="code hl_function" href="gptoss__weights__index_8c.html#a0c207c648c00b914718b2dd50416829e">widx_fmt_layer</a>(name, <span class="keyword">sizeof</span>(name), <span class="stringliteral">&quot;model.layers.%u.attn.out.weight&quot;</span>, layer) == 0) {</div>
<div class="line"><span class="lineno">  694</span>      d = <a class="code hl_function" href="tensor__map_8h.html#abe58b80593931ffe5844ee4bcee805c5">tensor_map_find</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, name);</div>
<div class="line"><span class="lineno">  695</span>    }</div>
<div class="line"><span class="lineno">  696</span> </div>
<div class="line"><span class="lineno">  697</span>    <span class="keywordflow">if</span> (!d) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9">IE_IO_ERR_JSON</a>;</div>
<div class="line"><span class="lineno">  698</span>    {</div>
<div class="line"><span class="lineno">  699</span>      <span class="keywordtype">int</span> rc = <a class="code hl_function" href="gptoss__weights__index_8c.html#a51589195af626cbd25188a2f1d138f24">widx_tensor_from_desc</a>(idx, d, &amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;o_proj_w);</div>
<div class="line"><span class="lineno">  700</span>      <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>) <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  701</span>    }</div>
<div class="line"><span class="lineno">  702</span>  }</div>
<div class="line"><span class="lineno">  703</span> </div>
<div class="line"><span class="lineno">  704</span>  <span class="keywordflow">if</span> (swiglu) {</div>
<div class="line"><span class="lineno">  705</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *gate_fmt[] = {</div>
<div class="line"><span class="lineno">  706</span>      <span class="stringliteral">&quot;model.layers.%u.mlp.gate_proj.weight&quot;</span>,</div>
<div class="line"><span class="lineno">  707</span>      <span class="stringliteral">&quot;model.layers.%u.feed_forward.gate_proj.weight&quot;</span></div>
<div class="line"><span class="lineno">  708</span>    };</div>
<div class="line"><span class="lineno">  709</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *up_fmt[] = {</div>
<div class="line"><span class="lineno">  710</span>      <span class="stringliteral">&quot;model.layers.%u.mlp.up_proj.weight&quot;</span>,</div>
<div class="line"><span class="lineno">  711</span>      <span class="stringliteral">&quot;model.layers.%u.feed_forward.up_proj.weight&quot;</span></div>
<div class="line"><span class="lineno">  712</span>    };</div>
<div class="line"><span class="lineno">  713</span>    <span class="keyword">const</span> <span class="keywordtype">char</span> *down_fmt[] = {</div>
<div class="line"><span class="lineno">  714</span>      <span class="stringliteral">&quot;model.layers.%u.mlp.down_proj.weight&quot;</span>,</div>
<div class="line"><span class="lineno">  715</span>      <span class="stringliteral">&quot;model.layers.%u.feed_forward.down_proj.weight&quot;</span></div>
<div class="line"><span class="lineno">  716</span>    };</div>
<div class="line"><span class="lineno">  717</span> </div>
<div class="line"><span class="lineno">  718</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structtensor__desc__s.html">tensor_desc_t</a> *d_gate = NULL;</div>
<div class="line"><span class="lineno">  719</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> k = 0; k &lt; <span class="keyword">sizeof</span>(gate_fmt)/<span class="keyword">sizeof</span>(gate_fmt[0]); ++k) {</div>
<div class="line"><span class="lineno">  720</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="gptoss__weights__index_8c.html#a0c207c648c00b914718b2dd50416829e">widx_fmt_layer</a>(name, <span class="keyword">sizeof</span>(name), gate_fmt[k], layer) == 0) {</div>
<div class="line"><span class="lineno">  721</span>        d_gate = <a class="code hl_function" href="tensor__map_8h.html#abe58b80593931ffe5844ee4bcee805c5">tensor_map_find</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, name);</div>
<div class="line"><span class="lineno">  722</span>        <span class="keywordflow">if</span> (d_gate) <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  723</span>      }</div>
<div class="line"><span class="lineno">  724</span>    }</div>
<div class="line"><span class="lineno">  725</span> </div>
<div class="line"><span class="lineno">  726</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structtensor__desc__s.html">tensor_desc_t</a> *d_up = NULL;</div>
<div class="line"><span class="lineno">  727</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> k = 0; k &lt; <span class="keyword">sizeof</span>(up_fmt)/<span class="keyword">sizeof</span>(up_fmt[0]); ++k) {</div>
<div class="line"><span class="lineno">  728</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="gptoss__weights__index_8c.html#a0c207c648c00b914718b2dd50416829e">widx_fmt_layer</a>(name, <span class="keyword">sizeof</span>(name), up_fmt[k], layer) == 0) {</div>
<div class="line"><span class="lineno">  729</span>        d_up = <a class="code hl_function" href="tensor__map_8h.html#abe58b80593931ffe5844ee4bcee805c5">tensor_map_find</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, name);</div>
<div class="line"><span class="lineno">  730</span>        <span class="keywordflow">if</span> (d_up) <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  731</span>      }</div>
<div class="line"><span class="lineno">  732</span>    }</div>
<div class="line"><span class="lineno">  733</span> </div>
<div class="line"><span class="lineno">  734</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structtensor__desc__s.html">tensor_desc_t</a> *d_down = NULL;</div>
<div class="line"><span class="lineno">  735</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> k = 0; k &lt; <span class="keyword">sizeof</span>(down_fmt)/<span class="keyword">sizeof</span>(down_fmt[0]); ++k) {</div>
<div class="line"><span class="lineno">  736</span>      <span class="keywordflow">if</span> (<a class="code hl_function" href="gptoss__weights__index_8c.html#a0c207c648c00b914718b2dd50416829e">widx_fmt_layer</a>(name, <span class="keyword">sizeof</span>(name), down_fmt[k], layer) == 0) {</div>
<div class="line"><span class="lineno">  737</span>        d_down = <a class="code hl_function" href="tensor__map_8h.html#abe58b80593931ffe5844ee4bcee805c5">tensor_map_find</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, name);</div>
<div class="line"><span class="lineno">  738</span>        <span class="keywordflow">if</span> (d_down) <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  739</span>      }</div>
<div class="line"><span class="lineno">  740</span>    }</div>
<div class="line"><span class="lineno">  741</span> </div>
<div class="line"><span class="lineno">  742</span>    <span class="keywordflow">if</span> (!d_gate || !d_up || !d_down) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9">IE_IO_ERR_JSON</a>;</div>
<div class="line"><span class="lineno">  743</span> </div>
<div class="line"><span class="lineno">  744</span>    {</div>
<div class="line"><span class="lineno">  745</span>      <span class="keywordtype">int</span> rc = <a class="code hl_function" href="gptoss__weights__index_8c.html#a51589195af626cbd25188a2f1d138f24">widx_tensor_from_desc</a>(idx, d_gate, &amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;gate_proj_w);</div>
<div class="line"><span class="lineno">  746</span>      <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>) <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  747</span>      rc = <a class="code hl_function" href="gptoss__weights__index_8c.html#a51589195af626cbd25188a2f1d138f24">widx_tensor_from_desc</a>(idx, d_up, &amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;up_proj_w);</div>
<div class="line"><span class="lineno">  748</span>      <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>) <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  749</span>      rc = <a class="code hl_function" href="gptoss__weights__index_8c.html#a51589195af626cbd25188a2f1d138f24">widx_tensor_from_desc</a>(idx, d_down, &amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;down_proj_w);</div>
<div class="line"><span class="lineno">  750</span>      <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>) <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  751</span>    }</div>
<div class="line"><span class="lineno">  752</span> </div>
<div class="line"><span class="lineno">  753</span>    <a class="code hl_function" href="gptoss__weights__index_8c.html#a35d07ed424f1010db24d2b69d7ee7bd6">widx_tensor_reset</a>(&amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;fc_in_w);</div>
<div class="line"><span class="lineno">  754</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  755</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structtensor__desc__s.html">tensor_desc_t</a> *d_in = NULL;</div>
<div class="line"><span class="lineno">  756</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structtensor__desc__s.html">tensor_desc_t</a> *d_out = NULL;</div>
<div class="line"><span class="lineno">  757</span> </div>
<div class="line"><span class="lineno">  758</span>    <span class="keywordflow">if</span> (!d_in &amp;&amp; <a class="code hl_function" href="gptoss__weights__index_8c.html#a0c207c648c00b914718b2dd50416829e">widx_fmt_layer</a>(name, <span class="keyword">sizeof</span>(name), <span class="stringliteral">&quot;model.layers.%u.mlp.fc_in.weight&quot;</span>, layer) == 0) {</div>
<div class="line"><span class="lineno">  759</span>      d_in = <a class="code hl_function" href="tensor__map_8h.html#abe58b80593931ffe5844ee4bcee805c5">tensor_map_find</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, name);</div>
<div class="line"><span class="lineno">  760</span>    }</div>
<div class="line"><span class="lineno">  761</span>    <span class="keywordflow">if</span> (!d_in &amp;&amp; <a class="code hl_function" href="gptoss__weights__index_8c.html#a0c207c648c00b914718b2dd50416829e">widx_fmt_layer</a>(name, <span class="keyword">sizeof</span>(name), <span class="stringliteral">&quot;model.layers.%u.mlp.w1.weight&quot;</span>, layer) == 0) {</div>
<div class="line"><span class="lineno">  762</span>      d_in = <a class="code hl_function" href="tensor__map_8h.html#abe58b80593931ffe5844ee4bcee805c5">tensor_map_find</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, name);</div>
<div class="line"><span class="lineno">  763</span>    }</div>
<div class="line"><span class="lineno">  764</span>    <span class="keywordflow">if</span> (!d_in &amp;&amp; <a class="code hl_function" href="gptoss__weights__index_8c.html#a0c207c648c00b914718b2dd50416829e">widx_fmt_layer</a>(name, <span class="keyword">sizeof</span>(name), <span class="stringliteral">&quot;model.layers.%u.mlp.mlp1.weight&quot;</span>, layer) == 0) {</div>
<div class="line"><span class="lineno">  765</span>      d_in = <a class="code hl_function" href="tensor__map_8h.html#abe58b80593931ffe5844ee4bcee805c5">tensor_map_find</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, name);</div>
<div class="line"><span class="lineno">  766</span>    }</div>
<div class="line"><span class="lineno">  767</span> </div>
<div class="line"><span class="lineno">  768</span>    <span class="keywordflow">if</span> (!d_out &amp;&amp; <a class="code hl_function" href="gptoss__weights__index_8c.html#a0c207c648c00b914718b2dd50416829e">widx_fmt_layer</a>(name, <span class="keyword">sizeof</span>(name), <span class="stringliteral">&quot;model.layers.%u.mlp.fc_out.weight&quot;</span>, layer) == 0) {</div>
<div class="line"><span class="lineno">  769</span>      d_out = <a class="code hl_function" href="tensor__map_8h.html#abe58b80593931ffe5844ee4bcee805c5">tensor_map_find</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, name);</div>
<div class="line"><span class="lineno">  770</span>    }</div>
<div class="line"><span class="lineno">  771</span>    <span class="keywordflow">if</span> (!d_out &amp;&amp; <a class="code hl_function" href="gptoss__weights__index_8c.html#a0c207c648c00b914718b2dd50416829e">widx_fmt_layer</a>(name, <span class="keyword">sizeof</span>(name), <span class="stringliteral">&quot;model.layers.%u.mlp.w2.weight&quot;</span>, layer) == 0) {</div>
<div class="line"><span class="lineno">  772</span>      d_out = <a class="code hl_function" href="tensor__map_8h.html#abe58b80593931ffe5844ee4bcee805c5">tensor_map_find</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, name);</div>
<div class="line"><span class="lineno">  773</span>    }</div>
<div class="line"><span class="lineno">  774</span>    <span class="keywordflow">if</span> (!d_out &amp;&amp; <a class="code hl_function" href="gptoss__weights__index_8c.html#a0c207c648c00b914718b2dd50416829e">widx_fmt_layer</a>(name, <span class="keyword">sizeof</span>(name), <span class="stringliteral">&quot;model.layers.%u.mlp.mlp2.weight&quot;</span>, layer) == 0) {</div>
<div class="line"><span class="lineno">  775</span>      d_out = <a class="code hl_function" href="tensor__map_8h.html#abe58b80593931ffe5844ee4bcee805c5">tensor_map_find</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, name);</div>
<div class="line"><span class="lineno">  776</span>    }</div>
<div class="line"><span class="lineno">  777</span> </div>
<div class="line"><span class="lineno">  778</span>    <span class="keywordflow">if</span> (!d_in || !d_out) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9">IE_IO_ERR_JSON</a>;</div>
<div class="line"><span class="lineno">  779</span> </div>
<div class="line"><span class="lineno">  780</span>    {</div>
<div class="line"><span class="lineno">  781</span>      <span class="keywordtype">int</span> rc = <a class="code hl_function" href="gptoss__weights__index_8c.html#a51589195af626cbd25188a2f1d138f24">widx_tensor_from_desc</a>(idx, d_in, &amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;fc_in_w);</div>
<div class="line"><span class="lineno">  782</span>      <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>) <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  783</span>      rc = <a class="code hl_function" href="gptoss__weights__index_8c.html#a51589195af626cbd25188a2f1d138f24">widx_tensor_from_desc</a>(idx, d_out, &amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;down_proj_w);</div>
<div class="line"><span class="lineno">  784</span>      <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>) <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  785</span>    }</div>
<div class="line"><span class="lineno">  786</span> </div>
<div class="line"><span class="lineno">  787</span>    <a class="code hl_function" href="gptoss__weights__index_8c.html#a35d07ed424f1010db24d2b69d7ee7bd6">widx_tensor_reset</a>(&amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;gate_proj_w);</div>
<div class="line"><span class="lineno">  788</span>    <a class="code hl_function" href="gptoss__weights__index_8c.html#a35d07ed424f1010db24d2b69d7ee7bd6">widx_tensor_reset</a>(&amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;up_proj_w);</div>
<div class="line"><span class="lineno">  789</span>  }</div>
<div class="line"><span class="lineno">  790</span> </div>
<div class="line"><span class="lineno">  791</span>  <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>;</div>
<div class="line"><span class="lineno">  792</span>}</div>
<div class="ttc" id="agptoss__weights__index_8c_html_a0c207c648c00b914718b2dd50416829e"><div class="ttname"><a href="gptoss__weights__index_8c.html#a0c207c648c00b914718b2dd50416829e">widx_fmt_layer</a></div><div class="ttdeci">static int widx_fmt_layer(char *dst, size_t dst_n, const char *fmt, uint32_t layer)</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00351">gptoss_weights_index.c:351</a></div></div>
<div class="ttc" id="agptoss__weights__index_8c_html_a35d07ed424f1010db24d2b69d7ee7bd6"><div class="ttname"><a href="gptoss__weights__index_8c.html#a35d07ed424f1010db24d2b69d7ee7bd6">widx_tensor_reset</a></div><div class="ttdeci">static void widx_tensor_reset(gptoss_tensor_t *t)</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00273">gptoss_weights_index.c:273</a></div></div>
<div class="ttc" id="agptoss__weights__index_8c_html_a51589195af626cbd25188a2f1d138f24"><div class="ttname"><a href="gptoss__weights__index_8c.html#a51589195af626cbd25188a2f1d138f24">widx_tensor_from_desc</a></div><div class="ttdeci">static int widx_tensor_from_desc(const gptoss_weights_index_t *idx, const tensor_desc_t *desc, gptoss_tensor_t *out)</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00278">gptoss_weights_index.c:278</a></div></div>
<div class="ttc" id="astructgptoss__tensor__t_html"><div class="ttname"><a href="structgptoss__tensor__t.html">gptoss_tensor_t</a></div><div class="ttdoc">A resolved tensor handle.</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8h_source.html#l00080">gptoss_weights_index.h:80</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ie__io_8h_source.html#l00065">IE_IO_ERR_ARGS</a>, <a class="el" href="ie__io_8h_source.html#l00066">IE_IO_ERR_JSON</a>, <a class="el" href="ie__io_8h_source.html#l00064">IE_IO_OK</a>, <a class="el" href="tensor__map_8c_source.html#l00662">tensor_map_find()</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00072">gptoss_weights_index_t::tmap</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00351">widx_fmt_layer()</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00278">widx_tensor_from_desc()</a>, and <a class="el" href="gptoss__weights__index_8c_source.html#l00273">widx_tensor_reset()</a>.</p>

<p class="reference">Referenced by <a class="el" href="gptoss__weights__index_8c_source.html#l00860">gptoss_weights_index_build_model()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8c_a59ea306bea1c9226c31583a49f2e7ffd_cgraph.svg" width="100%" height="439"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8c_a59ea306bea1c9226c31583a49f2e7ffd_icgraph.svg" width="374" height="51"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="aaa150e690297afaababde6bd8bcb7ae7" name="aaa150e690297afaababde6bd8bcb7ae7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaa150e690297afaababde6bd8bcb7ae7">&#9670;&#160;</a></span>widx_resolve_layer_neox()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int widx_resolve_layer_neox </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structgptoss__weights__index__t.html">gptoss_weights_index_t</a> *&#160;</td>
          <td class="paramname"><em>idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>layer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structgptoss__layer__weights__t.html">gptoss_layer_weights_t</a> *&#160;</td>
          <td class="paramname"><em>out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="gptoss__weights__index_8c_source.html#l00794">794</a> of file <a class="el" href="gptoss__weights__index_8c_source.html">gptoss_weights_index.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  796</span>                                                               {</div>
<div class="line"><span class="lineno">  797</span>  <span class="keywordflow">if</span> (!idx || !out) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239">IE_IO_ERR_ARGS</a>;</div>
<div class="line"><span class="lineno">  798</span>  memset(out, 0, <span class="keyword">sizeof</span>(*out));</div>
<div class="line"><span class="lineno">  799</span> </div>
<div class="line"><span class="lineno">  800</span>  <span class="keywordtype">char</span> name[256];</div>
<div class="line"><span class="lineno">  801</span> </div>
<div class="line"><span class="lineno">  802</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="gptoss__weights__index_8c.html#a0c207c648c00b914718b2dd50416829e">widx_fmt_layer</a>(name, <span class="keyword">sizeof</span>(name), <span class="stringliteral">&quot;gpt_neox.layers.%u.input_layernorm.weight&quot;</span>, layer) != 0) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239">IE_IO_ERR_ARGS</a>;</div>
<div class="line"><span class="lineno">  803</span>  {</div>
<div class="line"><span class="lineno">  804</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structtensor__desc__s.html">tensor_desc_t</a> *d = <a class="code hl_function" href="tensor__map_8h.html#abe58b80593931ffe5844ee4bcee805c5">tensor_map_find</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, name);</div>
<div class="line"><span class="lineno">  805</span>    <span class="keywordflow">if</span> (!d) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9">IE_IO_ERR_JSON</a>;</div>
<div class="line"><span class="lineno">  806</span>    <span class="keywordtype">int</span> rc = <a class="code hl_function" href="gptoss__weights__index_8c.html#a51589195af626cbd25188a2f1d138f24">widx_tensor_from_desc</a>(idx, d, &amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;attn_norm_w);</div>
<div class="line"><span class="lineno">  807</span>    <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>) <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  808</span>  }</div>
<div class="line"><span class="lineno">  809</span> </div>
<div class="line"><span class="lineno">  810</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="gptoss__weights__index_8c.html#a0c207c648c00b914718b2dd50416829e">widx_fmt_layer</a>(name, <span class="keyword">sizeof</span>(name), <span class="stringliteral">&quot;gpt_neox.layers.%u.post_attention_layernorm.weight&quot;</span>, layer) != 0) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239">IE_IO_ERR_ARGS</a>;</div>
<div class="line"><span class="lineno">  811</span>  {</div>
<div class="line"><span class="lineno">  812</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structtensor__desc__s.html">tensor_desc_t</a> *d = <a class="code hl_function" href="tensor__map_8h.html#abe58b80593931ffe5844ee4bcee805c5">tensor_map_find</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, name);</div>
<div class="line"><span class="lineno">  813</span>    <span class="keywordflow">if</span> (!d) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9">IE_IO_ERR_JSON</a>;</div>
<div class="line"><span class="lineno">  814</span>    <span class="keywordtype">int</span> rc = <a class="code hl_function" href="gptoss__weights__index_8c.html#a51589195af626cbd25188a2f1d138f24">widx_tensor_from_desc</a>(idx, d, &amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;mlp_norm_w);</div>
<div class="line"><span class="lineno">  815</span>    <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>) <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  816</span>  }</div>
<div class="line"><span class="lineno">  817</span> </div>
<div class="line"><span class="lineno">  818</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="gptoss__weights__index_8c.html#a0c207c648c00b914718b2dd50416829e">widx_fmt_layer</a>(name, <span class="keyword">sizeof</span>(name), <span class="stringliteral">&quot;gpt_neox.layers.%u.attention.query_key_value.weight&quot;</span>, layer) != 0) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239">IE_IO_ERR_ARGS</a>;</div>
<div class="line"><span class="lineno">  819</span>  {</div>
<div class="line"><span class="lineno">  820</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structtensor__desc__s.html">tensor_desc_t</a> *d = <a class="code hl_function" href="tensor__map_8h.html#abe58b80593931ffe5844ee4bcee805c5">tensor_map_find</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, name);</div>
<div class="line"><span class="lineno">  821</span>    <span class="keywordflow">if</span> (!d) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9">IE_IO_ERR_JSON</a>;</div>
<div class="line"><span class="lineno">  822</span>    <span class="keywordtype">int</span> rc = <a class="code hl_function" href="gptoss__weights__index_8c.html#a51589195af626cbd25188a2f1d138f24">widx_tensor_from_desc</a>(idx, d, &amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;qkv_proj_w);</div>
<div class="line"><span class="lineno">  823</span>    <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>) <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  824</span>  }</div>
<div class="line"><span class="lineno">  825</span> </div>
<div class="line"><span class="lineno">  826</span>  <a class="code hl_function" href="gptoss__weights__index_8c.html#a35d07ed424f1010db24d2b69d7ee7bd6">widx_tensor_reset</a>(&amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;q_proj_w);</div>
<div class="line"><span class="lineno">  827</span>  <a class="code hl_function" href="gptoss__weights__index_8c.html#a35d07ed424f1010db24d2b69d7ee7bd6">widx_tensor_reset</a>(&amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;k_proj_w);</div>
<div class="line"><span class="lineno">  828</span>  <a class="code hl_function" href="gptoss__weights__index_8c.html#a35d07ed424f1010db24d2b69d7ee7bd6">widx_tensor_reset</a>(&amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;v_proj_w);</div>
<div class="line"><span class="lineno">  829</span> </div>
<div class="line"><span class="lineno">  830</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="gptoss__weights__index_8c.html#a0c207c648c00b914718b2dd50416829e">widx_fmt_layer</a>(name, <span class="keyword">sizeof</span>(name), <span class="stringliteral">&quot;gpt_neox.layers.%u.attention.dense.weight&quot;</span>, layer) != 0) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239">IE_IO_ERR_ARGS</a>;</div>
<div class="line"><span class="lineno">  831</span>  {</div>
<div class="line"><span class="lineno">  832</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structtensor__desc__s.html">tensor_desc_t</a> *d = <a class="code hl_function" href="tensor__map_8h.html#abe58b80593931ffe5844ee4bcee805c5">tensor_map_find</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, name);</div>
<div class="line"><span class="lineno">  833</span>    <span class="keywordflow">if</span> (!d) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9">IE_IO_ERR_JSON</a>;</div>
<div class="line"><span class="lineno">  834</span>    <span class="keywordtype">int</span> rc = <a class="code hl_function" href="gptoss__weights__index_8c.html#a51589195af626cbd25188a2f1d138f24">widx_tensor_from_desc</a>(idx, d, &amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;o_proj_w);</div>
<div class="line"><span class="lineno">  835</span>    <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>) <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  836</span>  }</div>
<div class="line"><span class="lineno">  837</span> </div>
<div class="line"><span class="lineno">  838</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="gptoss__weights__index_8c.html#a0c207c648c00b914718b2dd50416829e">widx_fmt_layer</a>(name, <span class="keyword">sizeof</span>(name), <span class="stringliteral">&quot;gpt_neox.layers.%u.mlp.dense_h_to_4h.weight&quot;</span>, layer) != 0) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239">IE_IO_ERR_ARGS</a>;</div>
<div class="line"><span class="lineno">  839</span>  {</div>
<div class="line"><span class="lineno">  840</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structtensor__desc__s.html">tensor_desc_t</a> *d = <a class="code hl_function" href="tensor__map_8h.html#abe58b80593931ffe5844ee4bcee805c5">tensor_map_find</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, name);</div>
<div class="line"><span class="lineno">  841</span>    <span class="keywordflow">if</span> (!d) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9">IE_IO_ERR_JSON</a>;</div>
<div class="line"><span class="lineno">  842</span>    <span class="keywordtype">int</span> rc = <a class="code hl_function" href="gptoss__weights__index_8c.html#a51589195af626cbd25188a2f1d138f24">widx_tensor_from_desc</a>(idx, d, &amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;fc_in_w);</div>
<div class="line"><span class="lineno">  843</span>    <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>) <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  844</span>  }</div>
<div class="line"><span class="lineno">  845</span> </div>
<div class="line"><span class="lineno">  846</span>  <span class="keywordflow">if</span> (<a class="code hl_function" href="gptoss__weights__index_8c.html#a0c207c648c00b914718b2dd50416829e">widx_fmt_layer</a>(name, <span class="keyword">sizeof</span>(name), <span class="stringliteral">&quot;gpt_neox.layers.%u.mlp.dense_4h_to_h.weight&quot;</span>, layer) != 0) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239">IE_IO_ERR_ARGS</a>;</div>
<div class="line"><span class="lineno">  847</span>  {</div>
<div class="line"><span class="lineno">  848</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structtensor__desc__s.html">tensor_desc_t</a> *d = <a class="code hl_function" href="tensor__map_8h.html#abe58b80593931ffe5844ee4bcee805c5">tensor_map_find</a>(&amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, name);</div>
<div class="line"><span class="lineno">  849</span>    <span class="keywordflow">if</span> (!d) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9">IE_IO_ERR_JSON</a>;</div>
<div class="line"><span class="lineno">  850</span>    <span class="keywordtype">int</span> rc = <a class="code hl_function" href="gptoss__weights__index_8c.html#a51589195af626cbd25188a2f1d138f24">widx_tensor_from_desc</a>(idx, d, &amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;down_proj_w);</div>
<div class="line"><span class="lineno">  851</span>    <span class="keywordflow">if</span> (rc != <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>) <span class="keywordflow">return</span> rc;</div>
<div class="line"><span class="lineno">  852</span>  }</div>
<div class="line"><span class="lineno">  853</span> </div>
<div class="line"><span class="lineno">  854</span>  <a class="code hl_function" href="gptoss__weights__index_8c.html#a35d07ed424f1010db24d2b69d7ee7bd6">widx_tensor_reset</a>(&amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;gate_proj_w);</div>
<div class="line"><span class="lineno">  855</span>  <a class="code hl_function" href="gptoss__weights__index_8c.html#a35d07ed424f1010db24d2b69d7ee7bd6">widx_tensor_reset</a>(&amp;<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;up_proj_w);</div>
<div class="line"><span class="lineno">  856</span> </div>
<div class="line"><span class="lineno">  857</span>  <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>;</div>
<div class="line"><span class="lineno">  858</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ie__io_8h_source.html#l00065">IE_IO_ERR_ARGS</a>, <a class="el" href="ie__io_8h_source.html#l00066">IE_IO_ERR_JSON</a>, <a class="el" href="ie__io_8h_source.html#l00064">IE_IO_OK</a>, <a class="el" href="tensor__map_8c_source.html#l00662">tensor_map_find()</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00072">gptoss_weights_index_t::tmap</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00351">widx_fmt_layer()</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00278">widx_tensor_from_desc()</a>, and <a class="el" href="gptoss__weights__index_8c_source.html#l00273">widx_tensor_reset()</a>.</p>

<p class="reference">Referenced by <a class="el" href="gptoss__weights__index_8c_source.html#l00860">gptoss_weights_index_build_model()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8c_aaa150e690297afaababde6bd8bcb7ae7_cgraph.svg" width="100%" height="439"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8c_aaa150e690297afaababde6bd8bcb7ae7_icgraph.svg" width="412" height="51"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ac8e226ed24bc76176a1fec86157bac99" name="ac8e226ed24bc76176a1fec86157bac99"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac8e226ed24bc76176a1fec86157bac99">&#9670;&#160;</a></span>widx_resolve_optional()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int widx_resolve_optional </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structgptoss__weights__index__t.html">gptoss_weights_index_t</a> *&#160;</td>
          <td class="paramname"><em>idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const *&#160;</td>
          <td class="paramname"><em>names</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structgptoss__tensor__t.html">gptoss_tensor_t</a> *&#160;</td>
          <td class="paramname"><em>out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="gptoss__weights__index_8c_source.html#l00374">374</a> of file <a class="el" href="gptoss__weights__index_8c_source.html">gptoss_weights_index.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  377</span>                                                       {</div>
<div class="line"><span class="lineno">  378</span>  <span class="keyword">const</span> <a class="code hl_struct" href="structtensor__desc__s.html">tensor_desc_t</a> *d = <a class="code hl_function" href="gptoss__weights__index_8c.html#adc8f01ad4eb156e2f380f2b39e51d0ae">widx_find_any</a>(idx, &amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, names, n);</div>
<div class="line"><span class="lineno">  379</span>  <span class="keywordflow">if</span> (!d) {</div>
<div class="line"><span class="lineno">  380</span>    <a class="code hl_function" href="gptoss__weights__index_8c.html#a35d07ed424f1010db24d2b69d7ee7bd6">widx_tensor_reset</a>(out);</div>
<div class="line"><span class="lineno">  381</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>;</div>
<div class="line"><span class="lineno">  382</span>  }</div>
<div class="line"><span class="lineno">  383</span>  <span class="keywordflow">return</span> <a class="code hl_function" href="gptoss__weights__index_8c.html#a51589195af626cbd25188a2f1d138f24">widx_tensor_from_desc</a>(idx, d, out);</div>
<div class="line"><span class="lineno">  384</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ie__io_8h_source.html#l00064">IE_IO_OK</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00072">gptoss_weights_index_t::tmap</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00332">widx_find_any()</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00278">widx_tensor_from_desc()</a>, and <a class="el" href="gptoss__weights__index_8c_source.html#l00273">widx_tensor_reset()</a>.</p>

<p class="reference">Referenced by <a class="el" href="gptoss__weights__index_8c_source.html#l00860">gptoss_weights_index_build_model()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8c_ac8e226ed24bc76176a1fec86157bac99_cgraph.svg" width="100%" height="489"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8c_ac8e226ed24bc76176a1fec86157bac99_icgraph.svg" width="394" height="51"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a99c6f5457ca59a820436c4b8e8e9fb8b" name="a99c6f5457ca59a820436c4b8e8e9fb8b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a99c6f5457ca59a820436c4b8e8e9fb8b">&#9670;&#160;</a></span>widx_resolve_required()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int widx_resolve_required </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structgptoss__weights__index__t.html">gptoss_weights_index_t</a> *&#160;</td>
          <td class="paramname"><em>idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *const *&#160;</td>
          <td class="paramname"><em>names</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structgptoss__tensor__t.html">gptoss_tensor_t</a> *&#160;</td>
          <td class="paramname"><em>out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="gptoss__weights__index_8c_source.html#l00359">359</a> of file <a class="el" href="gptoss__weights__index_8c_source.html">gptoss_weights_index.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  362</span>                                                       {</div>
<div class="line"><span class="lineno">  363</span>  <span class="keyword">const</span> <a class="code hl_struct" href="structtensor__desc__s.html">tensor_desc_t</a> *d = <a class="code hl_function" href="gptoss__weights__index_8c.html#adc8f01ad4eb156e2f380f2b39e51d0ae">widx_find_any</a>(idx, &amp;idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a3b13756eb517ad4a8c378fcc8a76175b">tmap</a>, names, n);</div>
<div class="line"><span class="lineno">  364</span>  <span class="keywordflow">if</span> (!d) {</div>
<div class="line"><span class="lineno">  365</span>    <a class="code hl_function" href="gptoss__weights__index_8c.html#a724e4be15ba1676eb3369599e99eccc6">widx_tracef</a>(idx, <span class="stringliteral">&quot;[widx] REQUIRED tensor missing. Candidates:\n&quot;</span>);</div>
<div class="line"><span class="lineno">  366</span>    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; n; ++i) {</div>
<div class="line"><span class="lineno">  367</span>      <span class="keywordflow">if</span> (names[i]) <a class="code hl_function" href="gptoss__weights__index_8c.html#a724e4be15ba1676eb3369599e99eccc6">widx_tracef</a>(idx, <span class="stringliteral">&quot;  - %s\n&quot;</span>, names[i]);</div>
<div class="line"><span class="lineno">  368</span>    }</div>
<div class="line"><span class="lineno">  369</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9">IE_IO_ERR_JSON</a>;</div>
<div class="line"><span class="lineno">  370</span>  }</div>
<div class="line"><span class="lineno">  371</span>  <span class="keywordflow">return</span> <a class="code hl_function" href="gptoss__weights__index_8c.html#a51589195af626cbd25188a2f1d138f24">widx_tensor_from_desc</a>(idx, d, out);</div>
<div class="line"><span class="lineno">  372</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="ie__io_8h_source.html#l00066">IE_IO_ERR_JSON</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00072">gptoss_weights_index_t::tmap</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00332">widx_find_any()</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00278">widx_tensor_from_desc()</a>, and <a class="el" href="gptoss__weights__index_8c_source.html#l00091">widx_tracef()</a>.</p>

<p class="reference">Referenced by <a class="el" href="gptoss__weights__index_8c_source.html#l00860">gptoss_weights_index_build_model()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8c_a99c6f5457ca59a820436c4b8e8e9fb8b_cgraph.svg" width="100%" height="489"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8c_a99c6f5457ca59a820436c4b8e8e9fb8b_icgraph.svg" width="395" height="51"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a4cecf742f93bcd606826e7418359123b" name="a4cecf742f93bcd606826e7418359123b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4cecf742f93bcd606826e7418359123b">&#9670;&#160;</a></span>widx_strdup()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static char * widx_strdup </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>s</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="gptoss__weights__index_8c_source.html#l00103">103</a> of file <a class="el" href="gptoss__weights__index_8c_source.html">gptoss_weights_index.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  103</span>                                        {</div>
<div class="line"><span class="lineno">  104</span>  <span class="keywordflow">if</span> (!s) <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  105</span>  <span class="keywordtype">size_t</span> n = strlen(s);</div>
<div class="line"><span class="lineno">  106</span>  <span class="keywordtype">char</span> *p = (<span class="keywordtype">char</span>*)malloc(n + 1u);</div>
<div class="line"><span class="lineno">  107</span>  <span class="keywordflow">if</span> (!p) <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  108</span>  memcpy(p, s, n);</div>
<div class="line"><span class="lineno">  109</span>  p[n] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><span class="lineno">  110</span>  <span class="keywordflow">return</span> p;</div>
<div class="line"><span class="lineno">  111</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="gptoss__weights__index_8c_source.html#l00201">widx_mapped_open()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8c_a4cecf742f93bcd606826e7418359123b_icgraph.svg" width="566" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a51589195af626cbd25188a2f1d138f24" name="a51589195af626cbd25188a2f1d138f24"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a51589195af626cbd25188a2f1d138f24">&#9670;&#160;</a></span>widx_tensor_from_desc()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int widx_tensor_from_desc </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structgptoss__weights__index__t.html">gptoss_weights_index_t</a> *&#160;</td>
          <td class="paramname"><em>idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="tensor__map_8h.html#a1ed0f6ce08b1582103651d4fd14a30f1">tensor_desc_t</a> *&#160;</td>
          <td class="paramname"><em>desc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structgptoss__tensor__t.html">gptoss_tensor_t</a> *&#160;</td>
          <td class="paramname"><em>out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="gptoss__weights__index_8c_source.html#l00278">278</a> of file <a class="el" href="gptoss__weights__index_8c_source.html">gptoss_weights_index.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  280</span>                                                       {</div>
<div class="line"><span class="lineno">  281</span>  <span class="keywordflow">if</span> (!idx || !desc || !out) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a579de46204c4454f99e9620965e58239">IE_IO_ERR_ARGS</a>;</div>
<div class="line"><span class="lineno">  282</span> </div>
<div class="line"><span class="lineno">  283</span>  <a class="code hl_function" href="gptoss__weights__index_8c.html#a35d07ed424f1010db24d2b69d7ee7bd6">widx_tensor_reset</a>(out);</div>
<div class="line"><span class="lineno">  284</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;desc = desc;</div>
<div class="line"><span class="lineno">  285</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;nbytes = (size_t)desc-&gt;<a class="code hl_variable" href="structtensor__desc__s.html#a151674f0f1ad60320437f028593d8b26">size_bytes</a>;</div>
<div class="line"><span class="lineno">  286</span> </div>
<div class="line"><span class="lineno">  287</span>  <span class="keywordflow">if</span> (idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a45a099889fb703a3304defd9fd3e429e">weights</a> &amp;&amp; idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a45a099889fb703a3304defd9fd3e429e">weights</a>-&gt;<a class="code hl_variable" href="structie__weights__s.html#ab1e17ac4f44125571f2c63e603d967da">is_dedup</a> &amp;&amp; idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#af655091ccb0f124d27d604287d6313b5">dedup</a>) {</div>
<div class="line"><span class="lineno">  288</span>    <a class="code hl_struct" href="structie__weight__view__t.html">ie_weight_view_t</a> view;</div>
<div class="line"><span class="lineno">  289</span>    memset(&amp;view, 0, <span class="keyword">sizeof</span>(view));</div>
<div class="line"><span class="lineno">  290</span>    <a class="code hl_enumeration" href="weights__dedup_8h.html#a58857f75f23e827eb7a07572c0b93f2f">ie_wdedup_status_t</a> st = <a class="code hl_function" href="weights__dedup_8h.html#a3dde6478a937f4d2288026c1e9a9d499">ie_weights_dedup_get_weight_view</a>(idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#af655091ccb0f124d27d604287d6313b5">dedup</a>, desc-&gt;<a class="code hl_variable" href="structtensor__desc__s.html#a1134b2dbce500003f3b011f3e8a3d090">name</a>, &amp;view);</div>
<div class="line"><span class="lineno">  291</span>    <span class="keywordflow">if</span> (st != <a class="code hl_enumvalue" href="weights__dedup_8h.html#a58857f75f23e827eb7a07572c0b93f2fa0baf1bf45e91e9558e44038d27d20e2f">IE_WDEDUP_OK</a>) {</div>
<div class="line"><span class="lineno">  292</span>      <a class="code hl_function" href="gptoss__weights__index_8c.html#a724e4be15ba1676eb3369599e99eccc6">widx_tracef</a>(idx, <span class="stringliteral">&quot;[widx] dedup view missing for &#39;%s&#39;\n&quot;</span>, desc-&gt;<a class="code hl_variable" href="structtensor__desc__s.html#a1134b2dbce500003f3b011f3e8a3d090">name</a>);</div>
<div class="line"><span class="lineno">  293</span>      <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987aa02b300fcfbce31fe86de69090fc9fa9">IE_IO_ERR_JSON</a>;</div>
<div class="line"><span class="lineno">  294</span>    }</div>
<div class="line"><span class="lineno">  295</span> </div>
<div class="line"><span class="lineno">  296</span>    <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;is_dedup = 1;</div>
<div class="line"><span class="lineno">  297</span>    <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;view = view;</div>
<div class="line"><span class="lineno">  298</span> </div>
<div class="line"><span class="lineno">  299</span>    <span class="keywordflow">if</span> (view.<a class="code hl_variable" href="structie__weight__view__t.html#a068b4df0c2d3213839f897eea779e4a2">kind</a> == <a class="code hl_enumvalue" href="weights__dedup_8h.html#a5579991d9297cadd067b31d66b3005a5a41b14f68e6dd2f5b95d10ae10f55cfd2">IE_WVIEW_DIRECT</a> &amp;&amp; view.<a class="code hl_variable" href="structie__weight__view__t.html#a0dc2c68fe4543391855f083b035e7a79">data</a> &amp;&amp; view.<a class="code hl_variable" href="structie__weight__view__t.html#aaf93cc566a043394c3cb05949dbc9f3e">nbytes</a> &gt; 0) {</div>
<div class="line"><span class="lineno">  300</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;direct = (<span class="keyword">const</span> uint8_t*)view.<a class="code hl_variable" href="structie__weight__view__t.html#a0dc2c68fe4543391855f083b035e7a79">data</a>;</div>
<div class="line"><span class="lineno">  301</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;nbytes = view.<a class="code hl_variable" href="structie__weight__view__t.html#aaf93cc566a043394c3cb05949dbc9f3e">nbytes</a>;</div>
<div class="line"><span class="lineno">  302</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  303</span>      <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;direct = NULL;</div>
<div class="line"><span class="lineno">  304</span>      <span class="keywordflow">if</span> (<a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;nbytes == 0 &amp;&amp; view.<a class="code hl_variable" href="structie__weight__view__t.html#aaf93cc566a043394c3cb05949dbc9f3e">nbytes</a> &gt; 0) <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;nbytes = view.<a class="code hl_variable" href="structie__weight__view__t.html#aaf93cc566a043394c3cb05949dbc9f3e">nbytes</a>;</div>
<div class="line"><span class="lineno">  305</span>    }</div>
<div class="line"><span class="lineno">  306</span> </div>
<div class="line"><span class="lineno">  307</span>    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>;</div>
<div class="line"><span class="lineno">  308</span>  }</div>
<div class="line"><span class="lineno">  309</span> </div>
<div class="line"><span class="lineno">  310</span>  <span class="keywordflow">if</span> (!idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#ac96503b84bb4f2ea6158113639b660f9">bin</a>.<a class="code hl_variable" href="structgptoss__mapped__file__t.html#a82d6f9794be52794709bc995a27ac557">base</a> || idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#ac96503b84bb4f2ea6158113639b660f9">bin</a>.<a class="code hl_variable" href="structgptoss__mapped__file__t.html#af9e6c58ee54250f1ab602509b247878f">size</a> == 0) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a66046f2226981286e47bb2f33ab56862">IE_IO_ERR_BIN_UNSPEC</a>;</div>
<div class="line"><span class="lineno">  311</span> </div>
<div class="line"><span class="lineno">  312</span>  {</div>
<div class="line"><span class="lineno">  313</span>    uint64_t off = desc-&gt;<a class="code hl_variable" href="structtensor__desc__s.html#a0abe393a370bda31eda8ab11a5f8df37">offset</a>;</div>
<div class="line"><span class="lineno">  314</span>    uint64_t end = off + desc-&gt;<a class="code hl_variable" href="structtensor__desc__s.html#a151674f0f1ad60320437f028593d8b26">size_bytes</a>;</div>
<div class="line"><span class="lineno">  315</span>    <span class="keywordflow">if</span> (end &lt; off) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a9b079e5c6f78861150a9bc91623d8c42">IE_IO_ERR_DECODE</a>;</div>
<div class="line"><span class="lineno">  316</span>    <span class="keywordflow">if</span> (end &gt; (uint64_t)idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#ac96503b84bb4f2ea6158113639b660f9">bin</a>.<a class="code hl_variable" href="structgptoss__mapped__file__t.html#af9e6c58ee54250f1ab602509b247878f">size</a>) {</div>
<div class="line"><span class="lineno">  317</span>      <a class="code hl_function" href="gptoss__weights__index_8c.html#a724e4be15ba1676eb3369599e99eccc6">widx_tracef</a>(idx, <span class="stringliteral">&quot;[widx] OOB tensor &#39;%s&#39;: off=%llu size=%llu bin=%zu\n&quot;</span>,</div>
<div class="line"><span class="lineno">  318</span>                  desc-&gt;<a class="code hl_variable" href="structtensor__desc__s.html#a1134b2dbce500003f3b011f3e8a3d090">name</a>,</div>
<div class="line"><span class="lineno">  319</span>                  (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>)off,</div>
<div class="line"><span class="lineno">  320</span>                  (<span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>)desc-&gt;<a class="code hl_variable" href="structtensor__desc__s.html#a151674f0f1ad60320437f028593d8b26">size_bytes</a>,</div>
<div class="line"><span class="lineno">  321</span>                  idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#ac96503b84bb4f2ea6158113639b660f9">bin</a>.<a class="code hl_variable" href="structgptoss__mapped__file__t.html#af9e6c58ee54250f1ab602509b247878f">size</a>);</div>
<div class="line"><span class="lineno">  322</span>      <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a9b079e5c6f78861150a9bc91623d8c42">IE_IO_ERR_DECODE</a>;</div>
<div class="line"><span class="lineno">  323</span>    }</div>
<div class="line"><span class="lineno">  324</span> </div>
<div class="line"><span class="lineno">  325</span>    <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;direct = (<span class="keyword">const</span> uint8_t*)idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#ac96503b84bb4f2ea6158113639b660f9">bin</a>.<a class="code hl_variable" href="structgptoss__mapped__file__t.html#a82d6f9794be52794709bc995a27ac557">base</a> + (<span class="keywordtype">size_t</span>)off;</div>
<div class="line"><span class="lineno">  326</span>  }</div>
<div class="line"><span class="lineno">  327</span> </div>
<div class="line"><span class="lineno">  328</span>  <a class="code hl_variable" href="namespaceconvert__dtypes__to__numeric.html#a0332296ea5bde95f8e72005df06144a8">out</a>-&gt;is_dedup = 0;</div>
<div class="line"><span class="lineno">  329</span>  <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a81b076a3d2516e2f45170c664c0fa57d">IE_IO_OK</a>;</div>
<div class="line"><span class="lineno">  330</span>}</div>
<div class="ttc" id="aie__io_8h_html_a4c501870bd45dbe373416745a03de987a9b079e5c6f78861150a9bc91623d8c42"><div class="ttname"><a href="ie__io_8h.html#a4c501870bd45dbe373416745a03de987a9b079e5c6f78861150a9bc91623d8c42">IE_IO_ERR_DECODE</a></div><div class="ttdeci">@ IE_IO_ERR_DECODE</div><div class="ttdoc">Decode failure (corrupt or incompatible data).</div><div class="ttdef"><b>Definition</b> <a href="ie__io_8h_source.html#l00074">ie_io.h:73</a></div></div>
<div class="ttc" id="astructgptoss__weights__index__t_html_a45a099889fb703a3304defd9fd3e429e"><div class="ttname"><a href="structgptoss__weights__index__t.html#a45a099889fb703a3304defd9fd3e429e">gptoss_weights_index_t::weights</a></div><div class="ttdeci">const ie_weights_t * weights</div><div class="ttdoc">Borrowed pointer to weights descriptor.</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00076">gptoss_weights_index.c:76</a></div></div>
<div class="ttc" id="astructie__weight__view__t_html"><div class="ttname"><a href="structie__weight__view__t.html">ie_weight_view_t</a></div><div class="ttdoc">A lightweight view into the weight bytes.</div><div class="ttdef"><b>Definition</b> <a href="weights__dedup_8h_source.html#l00059">weights_dedup.h:59</a></div></div>
<div class="ttc" id="astructie__weight__view__t_html_a068b4df0c2d3213839f897eea779e4a2"><div class="ttname"><a href="structie__weight__view__t.html#a068b4df0c2d3213839f897eea779e4a2">ie_weight_view_t::kind</a></div><div class="ttdeci">ie_weight_view_kind_t kind</div><div class="ttdef"><b>Definition</b> <a href="weights__dedup_8h_source.html#l00060">weights_dedup.h:60</a></div></div>
<div class="ttc" id="astructie__weight__view__t_html_a0dc2c68fe4543391855f083b035e7a79"><div class="ttname"><a href="structie__weight__view__t.html#a0dc2c68fe4543391855f083b035e7a79">ie_weight_view_t::data</a></div><div class="ttdeci">const uint8_t * data</div><div class="ttdoc">For IE_WVIEW_DIRECT: pointer/size.</div><div class="ttdef"><b>Definition</b> <a href="weights__dedup_8h_source.html#l00073">weights_dedup.h:73</a></div></div>
<div class="ttc" id="astructie__weight__view__t_html_aaf93cc566a043394c3cb05949dbc9f3e"><div class="ttname"><a href="structie__weight__view__t.html#aaf93cc566a043394c3cb05949dbc9f3e">ie_weight_view_t::nbytes</a></div><div class="ttdeci">size_t nbytes</div><div class="ttdef"><b>Definition</b> <a href="weights__dedup_8h_source.html#l00074">weights_dedup.h:74</a></div></div>
<div class="ttc" id="astructtensor__desc__s_html_a0abe393a370bda31eda8ab11a5f8df37"><div class="ttname"><a href="structtensor__desc__s.html#a0abe393a370bda31eda8ab11a5f8df37">tensor_desc_s::offset</a></div><div class="ttdeci">uint64_t offset</div><div class="ttdoc">Byte offset in model.ie.bin.</div><div class="ttdef"><b>Definition</b> <a href="tensor__map_8h_source.html#l00096">tensor_map.h:96</a></div></div>
<div class="ttc" id="astructtensor__desc__s_html_a1134b2dbce500003f3b011f3e8a3d090"><div class="ttname"><a href="structtensor__desc__s.html#a1134b2dbce500003f3b011f3e8a3d090">tensor_desc_s::name</a></div><div class="ttdeci">char * name</div><div class="ttdoc">Tensor name (owned, heap).</div><div class="ttdef"><b>Definition</b> <a href="tensor__map_8h_source.html#l00094">tensor_map.h:94</a></div></div>
<div class="ttc" id="astructtensor__desc__s_html_a151674f0f1ad60320437f028593d8b26"><div class="ttname"><a href="structtensor__desc__s.html#a151674f0f1ad60320437f028593d8b26">tensor_desc_s::size_bytes</a></div><div class="ttdeci">uint64_t size_bytes</div><div class="ttdoc">Size in bytes.</div><div class="ttdef"><b>Definition</b> <a href="tensor__map_8h_source.html#l00098">tensor_map.h:98</a></div></div>
<div class="ttc" id="aweights__dedup_8h_html_a3dde6478a937f4d2288026c1e9a9d499"><div class="ttname"><a href="weights__dedup_8h.html#a3dde6478a937f4d2288026c1e9a9d499">ie_weights_dedup_get_weight_view</a></div><div class="ttdeci">ie_wdedup_status_t ie_weights_dedup_get_weight_view(const ie_weights_dedup_t *h, const char *name, ie_weight_view_t *out)</div><div class="ttdoc">Get a weight view by tensor name.</div><div class="ttdef"><b>Definition</b> <a href="weights__dedup_8c_source.html#l01262">weights_dedup.c:1262</a></div></div>
<div class="ttc" id="aweights__dedup_8h_html_a5579991d9297cadd067b31d66b3005a5a41b14f68e6dd2f5b95d10ae10f55cfd2"><div class="ttname"><a href="weights__dedup_8h.html#a5579991d9297cadd067b31d66b3005a5a41b14f68e6dd2f5b95d10ae10f55cfd2">IE_WVIEW_DIRECT</a></div><div class="ttdeci">@ IE_WVIEW_DIRECT</div><div class="ttdoc">Direct contiguous bytes; no mask/exceptions needed.</div><div class="ttdef"><b>Definition</b> <a href="weights__dedup_8h_source.html#l00050">weights_dedup.h:50</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="gptoss__weights__index_8c_source.html#l00060">gptoss_mapped_file_t::base</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00074">gptoss_weights_index_t::bin</a>, <a class="el" href="weights__dedup_8h_source.html#l00073">ie_weight_view_t::data</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00077">gptoss_weights_index_t::dedup</a>, <a class="el" href="ie__io_8h_source.html#l00065">IE_IO_ERR_ARGS</a>, <a class="el" href="ie__io_8h_source.html#l00067">IE_IO_ERR_BIN_UNSPEC</a>, <a class="el" href="ie__io_8h_source.html#l00073">IE_IO_ERR_DECODE</a>, <a class="el" href="ie__io_8h_source.html#l00066">IE_IO_ERR_JSON</a>, <a class="el" href="ie__io_8h_source.html#l00064">IE_IO_OK</a>, <a class="el" href="weights__dedup_8h_source.html#l00035">IE_WDEDUP_OK</a>, <a class="el" href="weights__dedup_8c_source.html#l01262">ie_weights_dedup_get_weight_view()</a>, <a class="el" href="weights__dedup_8h_source.html#l00050">IE_WVIEW_DIRECT</a>, <a class="el" href="ie__io_8h_source.html#l00104">ie_weights_s::is_dedup</a>, <a class="el" href="weights__dedup_8h_source.html#l00060">ie_weight_view_t::kind</a>, <a class="el" href="tensor__map_8h_source.html#l00094">tensor_desc_s::name</a>, <a class="el" href="weights__dedup_8h_source.html#l00074">ie_weight_view_t::nbytes</a>, <a class="el" href="tensor__map_8h_source.html#l00096">tensor_desc_s::offset</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00061">gptoss_mapped_file_t::size</a>, <a class="el" href="tensor__map_8h_source.html#l00098">tensor_desc_s::size_bytes</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00076">gptoss_weights_index_t::weights</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00273">widx_tensor_reset()</a>, and <a class="el" href="gptoss__weights__index_8c_source.html#l00091">widx_tracef()</a>.</p>

<p class="reference">Referenced by <a class="el" href="gptoss__weights__index_8c_source.html#l00575">widx_resolve_layer_llama()</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00794">widx_resolve_layer_neox()</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00374">widx_resolve_optional()</a>, and <a class="el" href="gptoss__weights__index_8c_source.html#l00359">widx_resolve_required()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8c_a51589195af626cbd25188a2f1d138f24_cgraph.svg" width="100%" height="413"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8c_a51589195af626cbd25188a2f1d138f24_icgraph.svg" width="636" height="200"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a35d07ed424f1010db24d2b69d7ee7bd6" name="a35d07ed424f1010db24d2b69d7ee7bd6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a35d07ed424f1010db24d2b69d7ee7bd6">&#9670;&#160;</a></span>widx_tensor_reset()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void widx_tensor_reset </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structgptoss__tensor__t.html">gptoss_tensor_t</a> *&#160;</td>
          <td class="paramname"><em>t</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="gptoss__weights__index_8c_source.html#l00273">273</a> of file <a class="el" href="gptoss__weights__index_8c_source.html">gptoss_weights_index.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  273</span>                                                  {</div>
<div class="line"><span class="lineno">  274</span>  <span class="keywordflow">if</span> (!t) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  275</span>  memset(t, 0, <span class="keyword">sizeof</span>(*t));</div>
<div class="line"><span class="lineno">  276</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="gptoss__weights__index_8c_source.html#l00575">widx_resolve_layer_llama()</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00794">widx_resolve_layer_neox()</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00374">widx_resolve_optional()</a>, and <a class="el" href="gptoss__weights__index_8c_source.html#l00278">widx_tensor_from_desc()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8c_a35d07ed424f1010db24d2b69d7ee7bd6_icgraph.svg" width="100%" height="450"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="add8363effbaa37fcdc8b72a4d9a858af" name="add8363effbaa37fcdc8b72a4d9a858af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#add8363effbaa37fcdc8b72a4d9a858af">&#9670;&#160;</a></span>widx_trace_enabled()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int widx_trace_enabled </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structgptoss__weights__index__t.html">gptoss_weights_index_t</a> *&#160;</td>
          <td class="paramname"><em>idx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="gptoss__weights__index_8c_source.html#l00087">87</a> of file <a class="el" href="gptoss__weights__index_8c_source.html">gptoss_weights_index.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   87</span>                                                                 {</div>
<div class="line"><span class="lineno">   88</span>  <span class="keywordflow">return</span> (idx &amp;&amp; idx-&gt;<a class="code hl_variable" href="structgptoss__weights__index__t.html#a03882aec69b569b9ec5fe509d86ff47d">trace</a> != 0);</div>
<div class="line"><span class="lineno">   89</span>}</div>
<div class="ttc" id="astructgptoss__weights__index__t_html_a03882aec69b569b9ec5fe509d86ff47d"><div class="ttname"><a href="structgptoss__weights__index__t.html#a03882aec69b569b9ec5fe509d86ff47d">gptoss_weights_index_t::trace</a></div><div class="ttdeci">int trace</div><div class="ttdoc">Non-zero if IE_TRACE_LOOKUPS is enabled.</div><div class="ttdef"><b>Definition</b> <a href="gptoss__weights__index_8c_source.html#l00080">gptoss_weights_index.c:80</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="gptoss__weights__index_8c_source.html#l00080">gptoss_weights_index_t::trace</a>.</p>

<p class="reference">Referenced by <a class="el" href="gptoss__weights__index_8c_source.html#l00417">gptoss_weights_index_open()</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00332">widx_find_any()</a>, and <a class="el" href="gptoss__weights__index_8c_source.html#l00091">widx_tracef()</a>.</p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8c_add8363effbaa37fcdc8b72a4d9a858af_icgraph.svg" width="100%" height="487"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a724e4be15ba1676eb3369599e99eccc6" name="a724e4be15ba1676eb3369599e99eccc6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a724e4be15ba1676eb3369599e99eccc6">&#9670;&#160;</a></span>widx_tracef()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void widx_tracef </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structgptoss__weights__index__t.html">gptoss_weights_index_t</a> *&#160;</td>
          <td class="paramname"><em>idx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="gptoss__weights__index_8c_source.html#l00091">91</a> of file <a class="el" href="gptoss__weights__index_8c_source.html">gptoss_weights_index.c</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   91</span>                                                                                 {</div>
<div class="line"><span class="lineno">   92</span>  <span class="keywordflow">if</span> (!<a class="code hl_function" href="gptoss__weights__index_8c.html#add8363effbaa37fcdc8b72a4d9a858af">widx_trace_enabled</a>(idx) || !fmt) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">   93</span>  va_list ap;</div>
<div class="line"><span class="lineno">   94</span>  va_start(ap, fmt);</div>
<div class="line"><span class="lineno">   95</span>  (void)vfprintf(stderr, fmt, ap);</div>
<div class="line"><span class="lineno">   96</span>  va_end(ap);</div>
<div class="line"><span class="lineno">   97</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="gptoss__weights__index_8c_source.html#l00087">widx_trace_enabled()</a>.</p>

<p class="reference">Referenced by <a class="el" href="gptoss__weights__index_8c_source.html#l00417">gptoss_weights_index_open()</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00513">widx_detect_arch()</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00332">widx_find_any()</a>, <a class="el" href="gptoss__weights__index_8c_source.html#l00359">widx_resolve_required()</a>, and <a class="el" href="gptoss__weights__index_8c_source.html#l00278">widx_tensor_from_desc()</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8c_a724e4be15ba1676eb3369599e99eccc6_cgraph.svg" width="310" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="gptoss__weights__index_8c_a724e4be15ba1676eb3369599e99eccc6_icgraph.svg" width="100%" height="527"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_996f45160da62e1a3d7f6046fad68f51.html">engine</a></li><li class="navelem"><a class="el" href="dir_3d9126aa00c041bc0b8f859d1965a0f4.html">src</a></li><li class="navelem"><a class="el" href="dir_25af579fff40d90ea7ba98c1764ae1f1.html">runtime</a></li><li class="navelem"><a class="el" href="gptoss__weights__index_8c.html">gptoss_weights_index.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
